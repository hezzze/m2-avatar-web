function pT(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var It=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function E7(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}),n}var V4={exports:{}},yS={},j4={exports:{}},Ut={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v0=Symbol.for("react.element"),R7=Symbol.for("react.portal"),b7=Symbol.for("react.fragment"),T7=Symbol.for("react.strict_mode"),A7=Symbol.for("react.profiler"),P7=Symbol.for("react.provider"),I7=Symbol.for("react.context"),M7=Symbol.for("react.forward_ref"),k7=Symbol.for("react.suspense"),L7=Symbol.for("react.memo"),D7=Symbol.for("react.lazy"),lI=Symbol.iterator;function N7(t){return t===null||typeof t!="object"?null:(t=lI&&t[lI]||t["@@iterator"],typeof t=="function"?t:null)}var W4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},G4=Object.assign,q4={};function tp(t,e,n){this.props=t,this.context=e,this.refs=q4,this.updater=n||W4}tp.prototype.isReactComponent={};tp.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};tp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function X4(){}X4.prototype=tp.prototype;function fT(t,e,n){this.props=t,this.context=e,this.refs=q4,this.updater=n||W4}var mT=fT.prototype=new X4;mT.constructor=fT;G4(mT,tp.prototype);mT.isPureReactComponent=!0;var uI=Array.isArray,K4=Object.prototype.hasOwnProperty,gT={current:null},Y4={key:!0,ref:!0,__self:!0,__source:!0};function J4(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)K4.call(e,i)&&!Y4.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:v0,type:t,key:s,ref:o,props:r,_owner:gT.current}}function O7(t,e){return{$$typeof:v0,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vT(t){return typeof t=="object"&&t!==null&&t.$$typeof===v0}function F7(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var hI=/\/+/g;function ZC(t,e){return typeof t=="object"&&t!==null&&t.key!=null?F7(""+t.key):e.toString(36)}function yy(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case v0:case R7:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+ZC(o,0):i,uI(r)?(n="",t!=null&&(n=t.replace(hI,"$&/")+"/"),yy(r,e,n,"",function(l){return l})):r!=null&&(vT(r)&&(r=O7(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(hI,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",uI(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+ZC(s,a);o+=yy(s,e,n,c,r)}else if(c=N7(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+ZC(s,a++),o+=yy(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function iv(t,e,n){if(t==null)return t;var i=[],r=0;return yy(t,i,"","",function(s){return e.call(n,s,r++)}),i}function z7(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ir={current:null},Sy={transition:null},U7={ReactCurrentDispatcher:Ir,ReactCurrentBatchConfig:Sy,ReactCurrentOwner:gT};function Q4(){throw Error("act(...) is not supported in production builds of React.")}Ut.Children={map:iv,forEach:function(t,e,n){iv(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return iv(t,function(){e++}),e},toArray:function(t){return iv(t,function(e){return e})||[]},only:function(t){if(!vT(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ut.Component=tp;Ut.Fragment=b7;Ut.Profiler=A7;Ut.PureComponent=fT;Ut.StrictMode=T7;Ut.Suspense=k7;Ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U7;Ut.act=Q4;Ut.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=G4({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=gT.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)K4.call(e,c)&&!Y4.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:v0,type:t.type,key:r,ref:s,props:i,_owner:o}};Ut.createContext=function(t){return t={$$typeof:I7,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:P7,_context:t},t.Consumer=t};Ut.createElement=J4;Ut.createFactory=function(t){var e=J4.bind(null,t);return e.type=t,e};Ut.createRef=function(){return{current:null}};Ut.forwardRef=function(t){return{$$typeof:M7,render:t}};Ut.isValidElement=vT;Ut.lazy=function(t){return{$$typeof:D7,_payload:{_status:-1,_result:t},_init:z7}};Ut.memo=function(t,e){return{$$typeof:L7,type:t,compare:e===void 0?null:e}};Ut.startTransition=function(t){var e=Sy.transition;Sy.transition={};try{t()}finally{Sy.transition=e}};Ut.unstable_act=Q4;Ut.useCallback=function(t,e){return Ir.current.useCallback(t,e)};Ut.useContext=function(t){return Ir.current.useContext(t)};Ut.useDebugValue=function(){};Ut.useDeferredValue=function(t){return Ir.current.useDeferredValue(t)};Ut.useEffect=function(t,e){return Ir.current.useEffect(t,e)};Ut.useId=function(){return Ir.current.useId()};Ut.useImperativeHandle=function(t,e,n){return Ir.current.useImperativeHandle(t,e,n)};Ut.useInsertionEffect=function(t,e){return Ir.current.useInsertionEffect(t,e)};Ut.useLayoutEffect=function(t,e){return Ir.current.useLayoutEffect(t,e)};Ut.useMemo=function(t,e){return Ir.current.useMemo(t,e)};Ut.useReducer=function(t,e,n){return Ir.current.useReducer(t,e,n)};Ut.useRef=function(t){return Ir.current.useRef(t)};Ut.useState=function(t){return Ir.current.useState(t)};Ut.useSyncExternalStore=function(t,e,n){return Ir.current.useSyncExternalStore(t,e,n)};Ut.useTransition=function(){return Ir.current.useTransition()};Ut.version="18.3.1";j4.exports=Ut;var re=j4.exports;const yT=vS(re),B7=pT({__proto__:null,default:yT},[re]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $7=re,H7=Symbol.for("react.element"),V7=Symbol.for("react.fragment"),j7=Object.prototype.hasOwnProperty,W7=$7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G7={key:!0,ref:!0,__self:!0,__source:!0};function Z4(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)j7.call(e,i)&&!G7.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:H7,type:t,key:s,ref:o,props:r,_owner:W7.current}}yS.Fragment=V7;yS.jsx=Z4;yS.jsxs=Z4;V4.exports=yS;var ce=V4.exports,eF={exports:{}},ws={},tF={exports:{}},nF={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,ne){var P=D.length;D.push(ne);e:for(;0<P;){var ee=P-1>>>1,ge=D[ee];if(0<r(ge,ne))D[ee]=ne,D[P]=ge,P=ee;else break e}}function n(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var ne=D[0],P=D.pop();if(P!==ne){D[0]=P;e:for(var ee=0,ge=D.length,I=ge>>>1;ee<I;){var $=2*(ee+1)-1,K=D[$],oe=$+1,he=D[oe];if(0>r(K,P))oe<ge&&0>r(he,K)?(D[ee]=he,D[oe]=P,ee=oe):(D[ee]=K,D[$]=P,ee=$);else if(oe<ge&&0>r(he,P))D[ee]=he,D[oe]=P,ee=oe;else break e}}return ne}function r(D,ne){var P=D.sortIndex-ne.sortIndex;return P!==0?P:D.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(D){for(var ne=n(l);ne!==null;){if(ne.callback===null)i(l);else if(ne.startTime<=D)i(l),ne.sortIndex=ne.expirationTime,e(c,ne);else break;ne=n(l)}}function x(D){if(v=!1,S(D),!f)if(n(c)!==null)f=!0,G(w);else{var ne=n(l);ne!==null&&J(x,ne.startTime-D)}}function w(D,ne){f=!1,v&&(v=!1,m(b),b=-1),p=!0;var P=d;try{for(S(ne),h=n(c);h!==null&&(!(h.expirationTime>ne)||D&&!R());){var ee=h.callback;if(typeof ee=="function"){h.callback=null,d=h.priorityLevel;var ge=ee(h.expirationTime<=ne);ne=t.unstable_now(),typeof ge=="function"?h.callback=ge:h===n(c)&&i(c),S(ne)}else i(c);h=n(c)}if(h!==null)var I=!0;else{var $=n(l);$!==null&&J(x,$.startTime-ne),I=!1}return I}finally{h=null,d=P,p=!1}}var C=!1,E=null,b=-1,M=5,_=-1;function R(){return!(t.unstable_now()-_<M)}function L(){if(E!==null){var D=t.unstable_now();_=D;var ne=!0;try{ne=E(!0,D)}finally{ne?O():(C=!1,E=null)}}else C=!1}var O;if(typeof y=="function")O=function(){y(L)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,X=V.port2;V.port1.onmessage=L,O=function(){X.postMessage(null)}}else O=function(){g(L,0)};function G(D){E=D,C||(C=!0,O())}function J(D,ne){b=g(function(){D(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,G(w))},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(D){switch(d){case 1:case 2:case 3:var ne=3;break;default:ne=d}var P=d;d=ne;try{return D()}finally{d=P}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(D,ne){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var P=d;d=D;try{return ne()}finally{d=P}},t.unstable_scheduleCallback=function(D,ne,P){var ee=t.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?ee+P:ee):P=ee,D){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=P+ge,D={id:u++,callback:ne,priorityLevel:D,startTime:P,expirationTime:ge,sortIndex:-1},P>ee?(D.sortIndex=P,e(l,D),n(c)===null&&D===n(l)&&(v?(m(b),b=-1):v=!0,J(x,P-ee))):(D.sortIndex=ge,e(c,D),f||p||(f=!0,G(w))),D},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(D){var ne=d;return function(){var P=d;d=ne;try{return D.apply(this,arguments)}finally{d=P}}}})(nF);tF.exports=nF;var q7=tF.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X7=re,xs=q7;function Se(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var iF=new Set,Pg={};function Wu(t,e){Cd(t,e),Cd(t+"Capture",e)}function Cd(t,e){for(Pg[t]=e,t=0;t<e.length;t++)iF.add(e[t])}var Wa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),SE=Object.prototype.hasOwnProperty,K7=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,dI={},pI={};function Y7(t){return SE.call(pI,t)?!0:SE.call(dI,t)?!1:K7.test(t)?pI[t]=!0:(dI[t]=!0,!1)}function J7(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Q7(t,e,n,i){if(e===null||typeof e>"u"||J7(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mr(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Gi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Gi[t]=new Mr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Gi[e]=new Mr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Gi[t]=new Mr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Gi[t]=new Mr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Gi[t]=new Mr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Gi[t]=new Mr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Gi[t]=new Mr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Gi[t]=new Mr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Gi[t]=new Mr(t,5,!1,t.toLowerCase(),null,!1,!1)});var ST=/[\-:]([a-z])/g;function xT(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ST,xT);Gi[e]=new Mr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ST,xT);Gi[e]=new Mr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ST,xT);Gi[e]=new Mr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Gi[t]=new Mr(t,1,!1,t.toLowerCase(),null,!1,!1)});Gi.xlinkHref=new Mr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Gi[t]=new Mr(t,1,!1,t.toLowerCase(),null,!0,!0)});function CT(t,e,n,i){var r=Gi.hasOwnProperty(e)?Gi[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Q7(e,n,r,i)&&(n=null),i||r===null?Y7(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var ec=X7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rv=Symbol.for("react.element"),Oh=Symbol.for("react.portal"),Fh=Symbol.for("react.fragment"),_T=Symbol.for("react.strict_mode"),xE=Symbol.for("react.profiler"),rF=Symbol.for("react.provider"),sF=Symbol.for("react.context"),wT=Symbol.for("react.forward_ref"),CE=Symbol.for("react.suspense"),_E=Symbol.for("react.suspense_list"),ET=Symbol.for("react.memo"),xc=Symbol.for("react.lazy"),oF=Symbol.for("react.offscreen"),fI=Symbol.iterator;function Np(t){return t===null||typeof t!="object"?null:(t=fI&&t[fI]||t["@@iterator"],typeof t=="function"?t:null)}var jn=Object.assign,e_;function Xm(t){if(e_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);e_=e&&e[1]||""}return`
`+e_+t}var t_=!1;function n_(t,e){if(!t||t_)return"";t_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{t_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Xm(t):""}function Z7(t){switch(t.tag){case 5:return Xm(t.type);case 16:return Xm("Lazy");case 13:return Xm("Suspense");case 19:return Xm("SuspenseList");case 0:case 2:case 15:return t=n_(t.type,!1),t;case 11:return t=n_(t.type.render,!1),t;case 1:return t=n_(t.type,!0),t;default:return""}}function wE(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Fh:return"Fragment";case Oh:return"Portal";case xE:return"Profiler";case _T:return"StrictMode";case CE:return"Suspense";case _E:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case sF:return(t.displayName||"Context")+".Consumer";case rF:return(t._context.displayName||"Context")+".Provider";case wT:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ET:return e=t.displayName||null,e!==null?e:wE(t.type)||"Memo";case xc:e=t._payload,t=t._init;try{return wE(t(e))}catch{}}return null}function ej(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wE(e);case 8:return e===_T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function nl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function aF(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tj(t){var e=aF(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function sv(t){t._valueTracker||(t._valueTracker=tj(t))}function cF(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=aF(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Qy(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function EE(t,e){var n=e.checked;return jn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function mI(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=nl(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function lF(t,e){e=e.checked,e!=null&&CT(t,"checked",e,!1)}function RE(t,e){lF(t,e);var n=nl(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?bE(t,e.type,n):e.hasOwnProperty("defaultValue")&&bE(t,e.type,nl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function gI(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function bE(t,e,n){(e!=="number"||Qy(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Km=Array.isArray;function nd(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+nl(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function TE(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Se(91));return jn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function vI(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Se(92));if(Km(n)){if(1<n.length)throw Error(Se(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:nl(n)}}function uF(t,e){var n=nl(e.value),i=nl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function yI(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function hF(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function AE(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?hF(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ov,dF=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ov=ov||document.createElement("div"),ov.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ov.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ig(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var lg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nj=["Webkit","ms","Moz","O"];Object.keys(lg).forEach(function(t){nj.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),lg[e]=lg[t]})});function pF(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||lg.hasOwnProperty(t)&&lg[t]?(""+e).trim():e+"px"}function fF(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=pF(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var ij=jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function PE(t,e){if(e){if(ij[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Se(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Se(62))}}function IE(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ME=null;function RT(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var kE=null,id=null,rd=null;function SI(t){if(t=x0(t)){if(typeof kE!="function")throw Error(Se(280));var e=t.stateNode;e&&(e=wS(e),kE(t.stateNode,t.type,e))}}function mF(t){id?rd?rd.push(t):rd=[t]:id=t}function gF(){if(id){var t=id,e=rd;if(rd=id=null,SI(t),e)for(t=0;t<e.length;t++)SI(e[t])}}function vF(t,e){return t(e)}function yF(){}var i_=!1;function SF(t,e,n){if(i_)return t(e,n);i_=!0;try{return vF(t,e,n)}finally{i_=!1,(id!==null||rd!==null)&&(yF(),gF())}}function Mg(t,e){var n=t.stateNode;if(n===null)return null;var i=wS(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Se(231,e,typeof n));return n}var LE=!1;if(Wa)try{var Op={};Object.defineProperty(Op,"passive",{get:function(){LE=!0}}),window.addEventListener("test",Op,Op),window.removeEventListener("test",Op,Op)}catch{LE=!1}function rj(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var ug=!1,Zy=null,e1=!1,DE=null,sj={onError:function(t){ug=!0,Zy=t}};function oj(t,e,n,i,r,s,o,a,c){ug=!1,Zy=null,rj.apply(sj,arguments)}function aj(t,e,n,i,r,s,o,a,c){if(oj.apply(this,arguments),ug){if(ug){var l=Zy;ug=!1,Zy=null}else throw Error(Se(198));e1||(e1=!0,DE=l)}}function Gu(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function xF(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function xI(t){if(Gu(t)!==t)throw Error(Se(188))}function cj(t){var e=t.alternate;if(!e){if(e=Gu(t),e===null)throw Error(Se(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return xI(r),t;if(s===i)return xI(r),e;s=s.sibling}throw Error(Se(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(Se(189))}}if(n.alternate!==i)throw Error(Se(190))}if(n.tag!==3)throw Error(Se(188));return n.stateNode.current===n?t:e}function CF(t){return t=cj(t),t!==null?_F(t):null}function _F(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=_F(t);if(e!==null)return e;t=t.sibling}return null}var wF=xs.unstable_scheduleCallback,CI=xs.unstable_cancelCallback,lj=xs.unstable_shouldYield,uj=xs.unstable_requestPaint,ni=xs.unstable_now,hj=xs.unstable_getCurrentPriorityLevel,bT=xs.unstable_ImmediatePriority,EF=xs.unstable_UserBlockingPriority,t1=xs.unstable_NormalPriority,dj=xs.unstable_LowPriority,RF=xs.unstable_IdlePriority,SS=null,ra=null;function pj(t){if(ra&&typeof ra.onCommitFiberRoot=="function")try{ra.onCommitFiberRoot(SS,t,void 0,(t.current.flags&128)===128)}catch{}}var bo=Math.clz32?Math.clz32:gj,fj=Math.log,mj=Math.LN2;function gj(t){return t>>>=0,t===0?32:31-(fj(t)/mj|0)|0}var av=64,cv=4194304;function Ym(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function n1(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Ym(a):(s&=o,s!==0&&(i=Ym(s)))}else o=n&~r,o!==0?i=Ym(o):s!==0&&(i=Ym(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-bo(e),r=1<<n,i|=t[n],e&=~r;return i}function vj(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yj(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-bo(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=vj(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function NE(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function bF(){var t=av;return av<<=1,!(av&4194240)&&(av=64),t}function r_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function y0(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-bo(e),t[e]=n}function Sj(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-bo(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function TT(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-bo(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ln=0;function TF(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var AF,AT,PF,IF,MF,OE=!1,lv=[],Bc=null,$c=null,Hc=null,kg=new Map,Lg=new Map,Tc=[],xj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _I(t,e){switch(t){case"focusin":case"focusout":Bc=null;break;case"dragenter":case"dragleave":$c=null;break;case"mouseover":case"mouseout":Hc=null;break;case"pointerover":case"pointerout":kg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lg.delete(e.pointerId)}}function Fp(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=x0(e),e!==null&&AT(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Cj(t,e,n,i,r){switch(e){case"focusin":return Bc=Fp(Bc,t,e,n,i,r),!0;case"dragenter":return $c=Fp($c,t,e,n,i,r),!0;case"mouseover":return Hc=Fp(Hc,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return kg.set(s,Fp(kg.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Lg.set(s,Fp(Lg.get(s)||null,t,e,n,i,r)),!0}return!1}function kF(t){var e=lu(t.target);if(e!==null){var n=Gu(e);if(n!==null){if(e=n.tag,e===13){if(e=xF(n),e!==null){t.blockedOn=e,MF(t.priority,function(){PF(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function xy(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=FE(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);ME=i,n.target.dispatchEvent(i),ME=null}else return e=x0(n),e!==null&&AT(e),t.blockedOn=n,!1;e.shift()}return!0}function wI(t,e,n){xy(t)&&n.delete(e)}function _j(){OE=!1,Bc!==null&&xy(Bc)&&(Bc=null),$c!==null&&xy($c)&&($c=null),Hc!==null&&xy(Hc)&&(Hc=null),kg.forEach(wI),Lg.forEach(wI)}function zp(t,e){t.blockedOn===e&&(t.blockedOn=null,OE||(OE=!0,xs.unstable_scheduleCallback(xs.unstable_NormalPriority,_j)))}function Dg(t){function e(r){return zp(r,t)}if(0<lv.length){zp(lv[0],t);for(var n=1;n<lv.length;n++){var i=lv[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Bc!==null&&zp(Bc,t),$c!==null&&zp($c,t),Hc!==null&&zp(Hc,t),kg.forEach(e),Lg.forEach(e),n=0;n<Tc.length;n++)i=Tc[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Tc.length&&(n=Tc[0],n.blockedOn===null);)kF(n),n.blockedOn===null&&Tc.shift()}var sd=ec.ReactCurrentBatchConfig,i1=!0;function wj(t,e,n,i){var r=ln,s=sd.transition;sd.transition=null;try{ln=1,PT(t,e,n,i)}finally{ln=r,sd.transition=s}}function Ej(t,e,n,i){var r=ln,s=sd.transition;sd.transition=null;try{ln=4,PT(t,e,n,i)}finally{ln=r,sd.transition=s}}function PT(t,e,n,i){if(i1){var r=FE(t,e,n,i);if(r===null)f_(t,e,i,r1,n),_I(t,i);else if(Cj(r,t,e,n,i))i.stopPropagation();else if(_I(t,i),e&4&&-1<xj.indexOf(t)){for(;r!==null;){var s=x0(r);if(s!==null&&AF(s),s=FE(t,e,n,i),s===null&&f_(t,e,i,r1,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else f_(t,e,i,null,n)}}var r1=null;function FE(t,e,n,i){if(r1=null,t=RT(i),t=lu(t),t!==null)if(e=Gu(t),e===null)t=null;else if(n=e.tag,n===13){if(t=xF(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return r1=t,null}function LF(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hj()){case bT:return 1;case EF:return 4;case t1:case dj:return 16;case RF:return 536870912;default:return 16}default:return 16}}var kc=null,IT=null,Cy=null;function DF(){if(Cy)return Cy;var t,e=IT,n=e.length,i,r="value"in kc?kc.value:kc.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Cy=r.slice(t,1<i?1-i:void 0)}function _y(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function uv(){return!0}function EI(){return!1}function Es(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?uv:EI,this.isPropagationStopped=EI,this}return jn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=uv)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=uv)},persist:function(){},isPersistent:uv}),e}var np={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},MT=Es(np),S0=jn({},np,{view:0,detail:0}),Rj=Es(S0),s_,o_,Up,xS=jn({},S0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kT,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Up&&(Up&&t.type==="mousemove"?(s_=t.screenX-Up.screenX,o_=t.screenY-Up.screenY):o_=s_=0,Up=t),s_)},movementY:function(t){return"movementY"in t?t.movementY:o_}}),RI=Es(xS),bj=jn({},xS,{dataTransfer:0}),Tj=Es(bj),Aj=jn({},S0,{relatedTarget:0}),a_=Es(Aj),Pj=jn({},np,{animationName:0,elapsedTime:0,pseudoElement:0}),Ij=Es(Pj),Mj=jn({},np,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),kj=Es(Mj),Lj=jn({},np,{data:0}),bI=Es(Lj),Dj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Oj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fj(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Oj[t])?!!e[t]:!1}function kT(){return Fj}var zj=jn({},S0,{key:function(t){if(t.key){var e=Dj[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=_y(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Nj[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kT,charCode:function(t){return t.type==="keypress"?_y(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?_y(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Uj=Es(zj),Bj=jn({},xS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),TI=Es(Bj),$j=jn({},S0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kT}),Hj=Es($j),Vj=jn({},np,{propertyName:0,elapsedTime:0,pseudoElement:0}),jj=Es(Vj),Wj=jn({},xS,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Gj=Es(Wj),qj=[9,13,27,32],LT=Wa&&"CompositionEvent"in window,hg=null;Wa&&"documentMode"in document&&(hg=document.documentMode);var Xj=Wa&&"TextEvent"in window&&!hg,NF=Wa&&(!LT||hg&&8<hg&&11>=hg),AI=" ",PI=!1;function OF(t,e){switch(t){case"keyup":return qj.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function FF(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var zh=!1;function Kj(t,e){switch(t){case"compositionend":return FF(e);case"keypress":return e.which!==32?null:(PI=!0,AI);case"textInput":return t=e.data,t===AI&&PI?null:t;default:return null}}function Yj(t,e){if(zh)return t==="compositionend"||!LT&&OF(t,e)?(t=DF(),Cy=IT=kc=null,zh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return NF&&e.locale!=="ko"?null:e.data;default:return null}}var Jj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function II(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Jj[t.type]:e==="textarea"}function zF(t,e,n,i){mF(i),e=s1(e,"onChange"),0<e.length&&(n=new MT("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var dg=null,Ng=null;function Qj(t){KF(t,0)}function CS(t){var e=$h(t);if(cF(e))return t}function Zj(t,e){if(t==="change")return e}var UF=!1;if(Wa){var c_;if(Wa){var l_="oninput"in document;if(!l_){var MI=document.createElement("div");MI.setAttribute("oninput","return;"),l_=typeof MI.oninput=="function"}c_=l_}else c_=!1;UF=c_&&(!document.documentMode||9<document.documentMode)}function kI(){dg&&(dg.detachEvent("onpropertychange",BF),Ng=dg=null)}function BF(t){if(t.propertyName==="value"&&CS(Ng)){var e=[];zF(e,Ng,t,RT(t)),SF(Qj,e)}}function e9(t,e,n){t==="focusin"?(kI(),dg=e,Ng=n,dg.attachEvent("onpropertychange",BF)):t==="focusout"&&kI()}function t9(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return CS(Ng)}function n9(t,e){if(t==="click")return CS(e)}function i9(t,e){if(t==="input"||t==="change")return CS(e)}function r9(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Po=typeof Object.is=="function"?Object.is:r9;function Og(t,e){if(Po(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!SE.call(e,r)||!Po(t[r],e[r]))return!1}return!0}function LI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function DI(t,e){var n=LI(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=LI(n)}}function $F(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?$F(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function HF(){for(var t=window,e=Qy();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Qy(t.document)}return e}function DT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function s9(t){var e=HF(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&$F(n.ownerDocument.documentElement,n)){if(i!==null&&DT(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=DI(n,s);var o=DI(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var o9=Wa&&"documentMode"in document&&11>=document.documentMode,Uh=null,zE=null,pg=null,UE=!1;function NI(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;UE||Uh==null||Uh!==Qy(i)||(i=Uh,"selectionStart"in i&&DT(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),pg&&Og(pg,i)||(pg=i,i=s1(zE,"onSelect"),0<i.length&&(e=new MT("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Uh)))}function hv(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Bh={animationend:hv("Animation","AnimationEnd"),animationiteration:hv("Animation","AnimationIteration"),animationstart:hv("Animation","AnimationStart"),transitionend:hv("Transition","TransitionEnd")},u_={},VF={};Wa&&(VF=document.createElement("div").style,"AnimationEvent"in window||(delete Bh.animationend.animation,delete Bh.animationiteration.animation,delete Bh.animationstart.animation),"TransitionEvent"in window||delete Bh.transitionend.transition);function _S(t){if(u_[t])return u_[t];if(!Bh[t])return t;var e=Bh[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in VF)return u_[t]=e[n];return t}var jF=_S("animationend"),WF=_S("animationiteration"),GF=_S("animationstart"),qF=_S("transitionend"),XF=new Map,OI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fl(t,e){XF.set(t,e),Wu(e,[t])}for(var h_=0;h_<OI.length;h_++){var d_=OI[h_],a9=d_.toLowerCase(),c9=d_[0].toUpperCase()+d_.slice(1);fl(a9,"on"+c9)}fl(jF,"onAnimationEnd");fl(WF,"onAnimationIteration");fl(GF,"onAnimationStart");fl("dblclick","onDoubleClick");fl("focusin","onFocus");fl("focusout","onBlur");fl(qF,"onTransitionEnd");Cd("onMouseEnter",["mouseout","mouseover"]);Cd("onMouseLeave",["mouseout","mouseover"]);Cd("onPointerEnter",["pointerout","pointerover"]);Cd("onPointerLeave",["pointerout","pointerover"]);Wu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l9=new Set("cancel close invalid load scroll toggle".split(" ").concat(Jm));function FI(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,aj(i,e,void 0,t),t.currentTarget=null}function KF(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;FI(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;FI(r,a,l),s=c}}}if(e1)throw t=DE,e1=!1,DE=null,t}function An(t,e){var n=e[jE];n===void 0&&(n=e[jE]=new Set);var i=t+"__bubble";n.has(i)||(YF(e,t,2,!1),n.add(i))}function p_(t,e,n){var i=0;e&&(i|=4),YF(n,t,i,e)}var dv="_reactListening"+Math.random().toString(36).slice(2);function Fg(t){if(!t[dv]){t[dv]=!0,iF.forEach(function(n){n!=="selectionchange"&&(l9.has(n)||p_(n,!1,t),p_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[dv]||(e[dv]=!0,p_("selectionchange",!1,e))}}function YF(t,e,n,i){switch(LF(e)){case 1:var r=wj;break;case 4:r=Ej;break;default:r=PT}n=r.bind(null,e,n,t),r=void 0,!LE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function f_(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=lu(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}SF(function(){var l=s,u=RT(n),h=[];e:{var d=XF.get(t);if(d!==void 0){var p=MT,f=t;switch(t){case"keypress":if(_y(n)===0)break e;case"keydown":case"keyup":p=Uj;break;case"focusin":f="focus",p=a_;break;case"focusout":f="blur",p=a_;break;case"beforeblur":case"afterblur":p=a_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=RI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Tj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Hj;break;case jF:case WF:case GF:p=Ij;break;case qF:p=jj;break;case"scroll":p=Rj;break;case"wheel":p=Gj;break;case"copy":case"cut":case"paste":p=kj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=TI}var v=(e&4)!==0,g=!v&&t==="scroll",m=v?d!==null?d+"Capture":null:d;v=[];for(var y=l,S;y!==null;){S=y;var x=S.stateNode;if(S.tag===5&&x!==null&&(S=x,m!==null&&(x=Mg(y,m),x!=null&&v.push(zg(y,x,S)))),g)break;y=y.return}0<v.length&&(d=new p(d,f,null,n,u),h.push({event:d,listeners:v}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",d&&n!==ME&&(f=n.relatedTarget||n.fromElement)&&(lu(f)||f[Ga]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=n.relatedTarget||n.toElement,p=l,f=f?lu(f):null,f!==null&&(g=Gu(f),f!==g||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=l),p!==f)){if(v=RI,x="onMouseLeave",m="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(v=TI,x="onPointerLeave",m="onPointerEnter",y="pointer"),g=p==null?d:$h(p),S=f==null?d:$h(f),d=new v(x,y+"leave",p,n,u),d.target=g,d.relatedTarget=S,x=null,lu(u)===l&&(v=new v(m,y+"enter",f,n,u),v.target=S,v.relatedTarget=g,x=v),g=x,p&&f)t:{for(v=p,m=f,y=0,S=v;S;S=ch(S))y++;for(S=0,x=m;x;x=ch(x))S++;for(;0<y-S;)v=ch(v),y--;for(;0<S-y;)m=ch(m),S--;for(;y--;){if(v===m||m!==null&&v===m.alternate)break t;v=ch(v),m=ch(m)}v=null}else v=null;p!==null&&zI(h,d,p,v,!1),f!==null&&g!==null&&zI(h,g,f,v,!0)}}e:{if(d=l?$h(l):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var w=Zj;else if(II(d))if(UF)w=i9;else{w=t9;var C=e9}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(w=n9);if(w&&(w=w(t,l))){zF(h,w,n,u);break e}C&&C(t,d,l),t==="focusout"&&(C=d._wrapperState)&&C.controlled&&d.type==="number"&&bE(d,"number",d.value)}switch(C=l?$h(l):window,t){case"focusin":(II(C)||C.contentEditable==="true")&&(Uh=C,zE=l,pg=null);break;case"focusout":pg=zE=Uh=null;break;case"mousedown":UE=!0;break;case"contextmenu":case"mouseup":case"dragend":UE=!1,NI(h,n,u);break;case"selectionchange":if(o9)break;case"keydown":case"keyup":NI(h,n,u)}var E;if(LT)e:{switch(t){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else zh?OF(t,n)&&(b="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(b="onCompositionStart");b&&(NF&&n.locale!=="ko"&&(zh||b!=="onCompositionStart"?b==="onCompositionEnd"&&zh&&(E=DF()):(kc=u,IT="value"in kc?kc.value:kc.textContent,zh=!0)),C=s1(l,b),0<C.length&&(b=new bI(b,t,null,n,u),h.push({event:b,listeners:C}),E?b.data=E:(E=FF(n),E!==null&&(b.data=E)))),(E=Xj?Kj(t,n):Yj(t,n))&&(l=s1(l,"onBeforeInput"),0<l.length&&(u=new bI("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:l}),u.data=E))}KF(h,e)})}function zg(t,e,n){return{instance:t,listener:e,currentTarget:n}}function s1(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Mg(t,n),s!=null&&i.unshift(zg(t,s,r)),s=Mg(t,e),s!=null&&i.push(zg(t,s,r))),t=t.return}return i}function ch(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function zI(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=Mg(n,s),c!=null&&o.unshift(zg(n,c,a))):r||(c=Mg(n,s),c!=null&&o.push(zg(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var u9=/\r\n?/g,h9=/\u0000|\uFFFD/g;function UI(t){return(typeof t=="string"?t:""+t).replace(u9,`
`).replace(h9,"")}function pv(t,e,n){if(e=UI(e),UI(t)!==e&&n)throw Error(Se(425))}function o1(){}var BE=null,$E=null;function HE(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var VE=typeof setTimeout=="function"?setTimeout:void 0,d9=typeof clearTimeout=="function"?clearTimeout:void 0,BI=typeof Promise=="function"?Promise:void 0,p9=typeof queueMicrotask=="function"?queueMicrotask:typeof BI<"u"?function(t){return BI.resolve(null).then(t).catch(f9)}:VE;function f9(t){setTimeout(function(){throw t})}function m_(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Dg(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Dg(e)}function Vc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function $I(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ip=Math.random().toString(36).slice(2),Qo="__reactFiber$"+ip,Ug="__reactProps$"+ip,Ga="__reactContainer$"+ip,jE="__reactEvents$"+ip,m9="__reactListeners$"+ip,g9="__reactHandles$"+ip;function lu(t){var e=t[Qo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ga]||n[Qo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=$I(t);t!==null;){if(n=t[Qo])return n;t=$I(t)}return e}t=n,n=t.parentNode}return null}function x0(t){return t=t[Qo]||t[Ga],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function $h(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Se(33))}function wS(t){return t[Ug]||null}var WE=[],Hh=-1;function ml(t){return{current:t}}function Mn(t){0>Hh||(t.current=WE[Hh],WE[Hh]=null,Hh--)}function _n(t,e){Hh++,WE[Hh]=t.current,t.current=e}var il={},fr=ml(il),jr=ml(!1),wu=il;function _d(t,e){var n=t.type.contextTypes;if(!n)return il;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Wr(t){return t=t.childContextTypes,t!=null}function a1(){Mn(jr),Mn(fr)}function HI(t,e,n){if(fr.current!==il)throw Error(Se(168));_n(fr,e),_n(jr,n)}function JF(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(Se(108,ej(t)||"Unknown",r));return jn({},n,i)}function c1(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||il,wu=fr.current,_n(fr,t),_n(jr,jr.current),!0}function VI(t,e,n){var i=t.stateNode;if(!i)throw Error(Se(169));n?(t=JF(t,e,wu),i.__reactInternalMemoizedMergedChildContext=t,Mn(jr),Mn(fr),_n(fr,t)):Mn(jr),_n(jr,n)}var Ma=null,ES=!1,g_=!1;function QF(t){Ma===null?Ma=[t]:Ma.push(t)}function v9(t){ES=!0,QF(t)}function gl(){if(!g_&&Ma!==null){g_=!0;var t=0,e=ln;try{var n=Ma;for(ln=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Ma=null,ES=!1}catch(r){throw Ma!==null&&(Ma=Ma.slice(t+1)),wF(bT,gl),r}finally{ln=e,g_=!1}}return null}var Vh=[],jh=0,l1=null,u1=0,Ds=[],Ns=0,Eu=null,Oa=1,Fa="";function Jl(t,e){Vh[jh++]=u1,Vh[jh++]=l1,l1=t,u1=e}function ZF(t,e,n){Ds[Ns++]=Oa,Ds[Ns++]=Fa,Ds[Ns++]=Eu,Eu=t;var i=Oa;t=Fa;var r=32-bo(i)-1;i&=~(1<<r),n+=1;var s=32-bo(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Oa=1<<32-bo(e)+r|n<<r|i,Fa=s+t}else Oa=1<<s|n<<r|i,Fa=t}function NT(t){t.return!==null&&(Jl(t,1),ZF(t,1,0))}function OT(t){for(;t===l1;)l1=Vh[--jh],Vh[jh]=null,u1=Vh[--jh],Vh[jh]=null;for(;t===Eu;)Eu=Ds[--Ns],Ds[Ns]=null,Fa=Ds[--Ns],Ds[Ns]=null,Oa=Ds[--Ns],Ds[Ns]=null}var vs=null,ps=null,Nn=!1,yo=null;function ez(t,e){var n=Us(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function jI(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,vs=t,ps=Vc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,vs=t,ps=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Eu!==null?{id:Oa,overflow:Fa}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Us(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,vs=t,ps=null,!0):!1;default:return!1}}function GE(t){return(t.mode&1)!==0&&(t.flags&128)===0}function qE(t){if(Nn){var e=ps;if(e){var n=e;if(!jI(t,e)){if(GE(t))throw Error(Se(418));e=Vc(n.nextSibling);var i=vs;e&&jI(t,e)?ez(i,n):(t.flags=t.flags&-4097|2,Nn=!1,vs=t)}}else{if(GE(t))throw Error(Se(418));t.flags=t.flags&-4097|2,Nn=!1,vs=t}}}function WI(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;vs=t}function fv(t){if(t!==vs)return!1;if(!Nn)return WI(t),Nn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!HE(t.type,t.memoizedProps)),e&&(e=ps)){if(GE(t))throw tz(),Error(Se(418));for(;e;)ez(t,e),e=Vc(e.nextSibling)}if(WI(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Se(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ps=Vc(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ps=null}}else ps=vs?Vc(t.stateNode.nextSibling):null;return!0}function tz(){for(var t=ps;t;)t=Vc(t.nextSibling)}function wd(){ps=vs=null,Nn=!1}function FT(t){yo===null?yo=[t]:yo.push(t)}var y9=ec.ReactCurrentBatchConfig;function Bp(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Se(309));var i=n.stateNode}if(!i)throw Error(Se(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(Se(284));if(!n._owner)throw Error(Se(290,t))}return t}function mv(t,e){throw t=Object.prototype.toString.call(e),Error(Se(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function GI(t){var e=t._init;return e(t._payload)}function nz(t){function e(m,y){if(t){var S=m.deletions;S===null?(m.deletions=[y],m.flags|=16):S.push(y)}}function n(m,y){if(!t)return null;for(;y!==null;)e(m,y),y=y.sibling;return null}function i(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function r(m,y){return m=qc(m,y),m.index=0,m.sibling=null,m}function s(m,y,S){return m.index=S,t?(S=m.alternate,S!==null?(S=S.index,S<y?(m.flags|=2,y):S):(m.flags|=2,y)):(m.flags|=1048576,y)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,y,S,x){return y===null||y.tag!==6?(y=w_(S,m.mode,x),y.return=m,y):(y=r(y,S),y.return=m,y)}function c(m,y,S,x){var w=S.type;return w===Fh?u(m,y,S.props.children,x,S.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===xc&&GI(w)===y.type)?(x=r(y,S.props),x.ref=Bp(m,y,S),x.return=m,x):(x=Py(S.type,S.key,S.props,null,m.mode,x),x.ref=Bp(m,y,S),x.return=m,x)}function l(m,y,S,x){return y===null||y.tag!==4||y.stateNode.containerInfo!==S.containerInfo||y.stateNode.implementation!==S.implementation?(y=E_(S,m.mode,x),y.return=m,y):(y=r(y,S.children||[]),y.return=m,y)}function u(m,y,S,x,w){return y===null||y.tag!==7?(y=yu(S,m.mode,x,w),y.return=m,y):(y=r(y,S),y.return=m,y)}function h(m,y,S){if(typeof y=="string"&&y!==""||typeof y=="number")return y=w_(""+y,m.mode,S),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case rv:return S=Py(y.type,y.key,y.props,null,m.mode,S),S.ref=Bp(m,null,y),S.return=m,S;case Oh:return y=E_(y,m.mode,S),y.return=m,y;case xc:var x=y._init;return h(m,x(y._payload),S)}if(Km(y)||Np(y))return y=yu(y,m.mode,S,null),y.return=m,y;mv(m,y)}return null}function d(m,y,S,x){var w=y!==null?y.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return w!==null?null:a(m,y,""+S,x);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case rv:return S.key===w?c(m,y,S,x):null;case Oh:return S.key===w?l(m,y,S,x):null;case xc:return w=S._init,d(m,y,w(S._payload),x)}if(Km(S)||Np(S))return w!==null?null:u(m,y,S,x,null);mv(m,S)}return null}function p(m,y,S,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return m=m.get(S)||null,a(y,m,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case rv:return m=m.get(x.key===null?S:x.key)||null,c(y,m,x,w);case Oh:return m=m.get(x.key===null?S:x.key)||null,l(y,m,x,w);case xc:var C=x._init;return p(m,y,S,C(x._payload),w)}if(Km(x)||Np(x))return m=m.get(S)||null,u(y,m,x,w,null);mv(y,x)}return null}function f(m,y,S,x){for(var w=null,C=null,E=y,b=y=0,M=null;E!==null&&b<S.length;b++){E.index>b?(M=E,E=null):M=E.sibling;var _=d(m,E,S[b],x);if(_===null){E===null&&(E=M);break}t&&E&&_.alternate===null&&e(m,E),y=s(_,y,b),C===null?w=_:C.sibling=_,C=_,E=M}if(b===S.length)return n(m,E),Nn&&Jl(m,b),w;if(E===null){for(;b<S.length;b++)E=h(m,S[b],x),E!==null&&(y=s(E,y,b),C===null?w=E:C.sibling=E,C=E);return Nn&&Jl(m,b),w}for(E=i(m,E);b<S.length;b++)M=p(E,m,b,S[b],x),M!==null&&(t&&M.alternate!==null&&E.delete(M.key===null?b:M.key),y=s(M,y,b),C===null?w=M:C.sibling=M,C=M);return t&&E.forEach(function(R){return e(m,R)}),Nn&&Jl(m,b),w}function v(m,y,S,x){var w=Np(S);if(typeof w!="function")throw Error(Se(150));if(S=w.call(S),S==null)throw Error(Se(151));for(var C=w=null,E=y,b=y=0,M=null,_=S.next();E!==null&&!_.done;b++,_=S.next()){E.index>b?(M=E,E=null):M=E.sibling;var R=d(m,E,_.value,x);if(R===null){E===null&&(E=M);break}t&&E&&R.alternate===null&&e(m,E),y=s(R,y,b),C===null?w=R:C.sibling=R,C=R,E=M}if(_.done)return n(m,E),Nn&&Jl(m,b),w;if(E===null){for(;!_.done;b++,_=S.next())_=h(m,_.value,x),_!==null&&(y=s(_,y,b),C===null?w=_:C.sibling=_,C=_);return Nn&&Jl(m,b),w}for(E=i(m,E);!_.done;b++,_=S.next())_=p(E,m,b,_.value,x),_!==null&&(t&&_.alternate!==null&&E.delete(_.key===null?b:_.key),y=s(_,y,b),C===null?w=_:C.sibling=_,C=_);return t&&E.forEach(function(L){return e(m,L)}),Nn&&Jl(m,b),w}function g(m,y,S,x){if(typeof S=="object"&&S!==null&&S.type===Fh&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case rv:e:{for(var w=S.key,C=y;C!==null;){if(C.key===w){if(w=S.type,w===Fh){if(C.tag===7){n(m,C.sibling),y=r(C,S.props.children),y.return=m,m=y;break e}}else if(C.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===xc&&GI(w)===C.type){n(m,C.sibling),y=r(C,S.props),y.ref=Bp(m,C,S),y.return=m,m=y;break e}n(m,C);break}else e(m,C);C=C.sibling}S.type===Fh?(y=yu(S.props.children,m.mode,x,S.key),y.return=m,m=y):(x=Py(S.type,S.key,S.props,null,m.mode,x),x.ref=Bp(m,y,S),x.return=m,m=x)}return o(m);case Oh:e:{for(C=S.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===S.containerInfo&&y.stateNode.implementation===S.implementation){n(m,y.sibling),y=r(y,S.children||[]),y.return=m,m=y;break e}else{n(m,y);break}else e(m,y);y=y.sibling}y=E_(S,m.mode,x),y.return=m,m=y}return o(m);case xc:return C=S._init,g(m,y,C(S._payload),x)}if(Km(S))return f(m,y,S,x);if(Np(S))return v(m,y,S,x);mv(m,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,y!==null&&y.tag===6?(n(m,y.sibling),y=r(y,S),y.return=m,m=y):(n(m,y),y=w_(S,m.mode,x),y.return=m,m=y),o(m)):n(m,y)}return g}var Ed=nz(!0),iz=nz(!1),h1=ml(null),d1=null,Wh=null,zT=null;function UT(){zT=Wh=d1=null}function BT(t){var e=h1.current;Mn(h1),t._currentValue=e}function XE(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function od(t,e){d1=t,zT=Wh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Hr=!0),t.firstContext=null)}function Xs(t){var e=t._currentValue;if(zT!==t)if(t={context:t,memoizedValue:e,next:null},Wh===null){if(d1===null)throw Error(Se(308));Wh=t,d1.dependencies={lanes:0,firstContext:t}}else Wh=Wh.next=t;return e}var uu=null;function $T(t){uu===null?uu=[t]:uu.push(t)}function rz(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,$T(e)):(n.next=r.next,r.next=n),e.interleaved=n,qa(t,i)}function qa(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Cc=!1;function HT(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sz(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $a(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function jc(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Yt&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,qa(t,n)}return r=i.interleaved,r===null?(e.next=e,$T(i)):(e.next=r.next,r.next=e),i.interleaved=e,qa(t,n)}function wy(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,TT(t,n)}}function qI(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function p1(t,e,n,i){var r=t.updateQueue;Cc=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var h=r.baseState;o=0,u=l=c=null,a=s;do{var d=a.lane,p=a.eventTime;if((i&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=t,v=a;switch(d=e,p=n,v.tag){case 1:if(f=v.payload,typeof f=="function"){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=v.payload,d=typeof f=="function"?f.call(p,h,d):f,d==null)break e;h=jn({},h,d);break e;case 2:Cc=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=p,c=h):u=u.next=p,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(u===null&&(c=h),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);bu|=o,t.lanes=o,t.memoizedState=h}}function XI(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(Se(191,r));r.call(i)}}}var C0={},sa=ml(C0),Bg=ml(C0),$g=ml(C0);function hu(t){if(t===C0)throw Error(Se(174));return t}function VT(t,e){switch(_n($g,e),_n(Bg,t),_n(sa,C0),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:AE(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=AE(e,t)}Mn(sa),_n(sa,e)}function Rd(){Mn(sa),Mn(Bg),Mn($g)}function oz(t){hu($g.current);var e=hu(sa.current),n=AE(e,t.type);e!==n&&(_n(Bg,t),_n(sa,n))}function jT(t){Bg.current===t&&(Mn(sa),Mn(Bg))}var Un=ml(0);function f1(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var v_=[];function WT(){for(var t=0;t<v_.length;t++)v_[t]._workInProgressVersionPrimary=null;v_.length=0}var Ey=ec.ReactCurrentDispatcher,y_=ec.ReactCurrentBatchConfig,Ru=0,Vn=null,gi=null,Mi=null,m1=!1,fg=!1,Hg=0,S9=0;function Ji(){throw Error(Se(321))}function GT(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Po(t[n],e[n]))return!1;return!0}function qT(t,e,n,i,r,s){if(Ru=s,Vn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ey.current=t===null||t.memoizedState===null?w9:E9,t=n(i,r),fg){s=0;do{if(fg=!1,Hg=0,25<=s)throw Error(Se(301));s+=1,Mi=gi=null,e.updateQueue=null,Ey.current=R9,t=n(i,r)}while(fg)}if(Ey.current=g1,e=gi!==null&&gi.next!==null,Ru=0,Mi=gi=Vn=null,m1=!1,e)throw Error(Se(300));return t}function XT(){var t=Hg!==0;return Hg=0,t}function qo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mi===null?Vn.memoizedState=Mi=t:Mi=Mi.next=t,Mi}function Ks(){if(gi===null){var t=Vn.alternate;t=t!==null?t.memoizedState:null}else t=gi.next;var e=Mi===null?Vn.memoizedState:Mi.next;if(e!==null)Mi=e,gi=t;else{if(t===null)throw Error(Se(310));gi=t,t={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},Mi===null?Vn.memoizedState=Mi=t:Mi=Mi.next=t}return Mi}function Vg(t,e){return typeof e=="function"?e(t):e}function S_(t){var e=Ks(),n=e.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=t;var i=gi,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((Ru&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var h={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=i):c=c.next=h,Vn.lanes|=u,bu|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,Po(i,e.memoizedState)||(Hr=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Vn.lanes|=s,bu|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function x_(t){var e=Ks(),n=e.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Po(s,e.memoizedState)||(Hr=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function az(){}function cz(t,e){var n=Vn,i=Ks(),r=e(),s=!Po(i.memoizedState,r);if(s&&(i.memoizedState=r,Hr=!0),i=i.queue,KT(hz.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Mi!==null&&Mi.memoizedState.tag&1){if(n.flags|=2048,jg(9,uz.bind(null,n,i,r,e),void 0,null),Li===null)throw Error(Se(349));Ru&30||lz(n,e,r)}return r}function lz(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Vn.updateQueue,e===null?(e={lastEffect:null,stores:null},Vn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function uz(t,e,n,i){e.value=n,e.getSnapshot=i,dz(e)&&pz(t)}function hz(t,e,n){return n(function(){dz(e)&&pz(t)})}function dz(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Po(t,n)}catch{return!0}}function pz(t){var e=qa(t,1);e!==null&&To(e,t,1,-1)}function KI(t){var e=qo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vg,lastRenderedState:t},e.queue=t,t=t.dispatch=_9.bind(null,Vn,t),[e.memoizedState,t]}function jg(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Vn.updateQueue,e===null?(e={lastEffect:null,stores:null},Vn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function fz(){return Ks().memoizedState}function Ry(t,e,n,i){var r=qo();Vn.flags|=t,r.memoizedState=jg(1|e,n,void 0,i===void 0?null:i)}function RS(t,e,n,i){var r=Ks();i=i===void 0?null:i;var s=void 0;if(gi!==null){var o=gi.memoizedState;if(s=o.destroy,i!==null&&GT(i,o.deps)){r.memoizedState=jg(e,n,s,i);return}}Vn.flags|=t,r.memoizedState=jg(1|e,n,s,i)}function YI(t,e){return Ry(8390656,8,t,e)}function KT(t,e){return RS(2048,8,t,e)}function mz(t,e){return RS(4,2,t,e)}function gz(t,e){return RS(4,4,t,e)}function vz(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function yz(t,e,n){return n=n!=null?n.concat([t]):null,RS(4,4,vz.bind(null,e,t),n)}function YT(){}function Sz(t,e){var n=Ks();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&GT(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function xz(t,e){var n=Ks();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&GT(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Cz(t,e,n){return Ru&21?(Po(n,e)||(n=bF(),Vn.lanes|=n,bu|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Hr=!0),t.memoizedState=n)}function x9(t,e){var n=ln;ln=n!==0&&4>n?n:4,t(!0);var i=y_.transition;y_.transition={};try{t(!1),e()}finally{ln=n,y_.transition=i}}function _z(){return Ks().memoizedState}function C9(t,e,n){var i=Gc(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},wz(t))Ez(e,n);else if(n=rz(t,e,n,i),n!==null){var r=Rr();To(n,t,i,r),Rz(n,e,i)}}function _9(t,e,n){var i=Gc(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(wz(t))Ez(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Po(a,o)){var c=e.interleaved;c===null?(r.next=r,$T(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=rz(t,e,r,i),n!==null&&(r=Rr(),To(n,t,i,r),Rz(n,e,i))}}function wz(t){var e=t.alternate;return t===Vn||e!==null&&e===Vn}function Ez(t,e){fg=m1=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Rz(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,TT(t,n)}}var g1={readContext:Xs,useCallback:Ji,useContext:Ji,useEffect:Ji,useImperativeHandle:Ji,useInsertionEffect:Ji,useLayoutEffect:Ji,useMemo:Ji,useReducer:Ji,useRef:Ji,useState:Ji,useDebugValue:Ji,useDeferredValue:Ji,useTransition:Ji,useMutableSource:Ji,useSyncExternalStore:Ji,useId:Ji,unstable_isNewReconciler:!1},w9={readContext:Xs,useCallback:function(t,e){return qo().memoizedState=[t,e===void 0?null:e],t},useContext:Xs,useEffect:YI,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Ry(4194308,4,vz.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ry(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ry(4,2,t,e)},useMemo:function(t,e){var n=qo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=qo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=C9.bind(null,Vn,t),[i.memoizedState,t]},useRef:function(t){var e=qo();return t={current:t},e.memoizedState=t},useState:KI,useDebugValue:YT,useDeferredValue:function(t){return qo().memoizedState=t},useTransition:function(){var t=KI(!1),e=t[0];return t=x9.bind(null,t[1]),qo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Vn,r=qo();if(Nn){if(n===void 0)throw Error(Se(407));n=n()}else{if(n=e(),Li===null)throw Error(Se(349));Ru&30||lz(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,YI(hz.bind(null,i,s,t),[t]),i.flags|=2048,jg(9,uz.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=qo(),e=Li.identifierPrefix;if(Nn){var n=Fa,i=Oa;n=(i&~(1<<32-bo(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Hg++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=S9++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},E9={readContext:Xs,useCallback:Sz,useContext:Xs,useEffect:KT,useImperativeHandle:yz,useInsertionEffect:mz,useLayoutEffect:gz,useMemo:xz,useReducer:S_,useRef:fz,useState:function(){return S_(Vg)},useDebugValue:YT,useDeferredValue:function(t){var e=Ks();return Cz(e,gi.memoizedState,t)},useTransition:function(){var t=S_(Vg)[0],e=Ks().memoizedState;return[t,e]},useMutableSource:az,useSyncExternalStore:cz,useId:_z,unstable_isNewReconciler:!1},R9={readContext:Xs,useCallback:Sz,useContext:Xs,useEffect:KT,useImperativeHandle:yz,useInsertionEffect:mz,useLayoutEffect:gz,useMemo:xz,useReducer:x_,useRef:fz,useState:function(){return x_(Vg)},useDebugValue:YT,useDeferredValue:function(t){var e=Ks();return gi===null?e.memoizedState=t:Cz(e,gi.memoizedState,t)},useTransition:function(){var t=x_(Vg)[0],e=Ks().memoizedState;return[t,e]},useMutableSource:az,useSyncExternalStore:cz,useId:_z,unstable_isNewReconciler:!1};function po(t,e){if(t&&t.defaultProps){e=jn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function KE(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:jn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var bS={isMounted:function(t){return(t=t._reactInternals)?Gu(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Rr(),r=Gc(t),s=$a(i,r);s.payload=e,n!=null&&(s.callback=n),e=jc(t,s,r),e!==null&&(To(e,t,r,i),wy(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Rr(),r=Gc(t),s=$a(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=jc(t,s,r),e!==null&&(To(e,t,r,i),wy(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Rr(),i=Gc(t),r=$a(n,i);r.tag=2,e!=null&&(r.callback=e),e=jc(t,r,i),e!==null&&(To(e,t,i,n),wy(e,t,i))}};function JI(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Og(n,i)||!Og(r,s):!0}function bz(t,e,n){var i=!1,r=il,s=e.contextType;return typeof s=="object"&&s!==null?s=Xs(s):(r=Wr(e)?wu:fr.current,i=e.contextTypes,s=(i=i!=null)?_d(t,r):il),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=bS,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function QI(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&bS.enqueueReplaceState(e,e.state,null)}function YE(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},HT(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Xs(s):(s=Wr(e)?wu:fr.current,r.context=_d(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(KE(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&bS.enqueueReplaceState(r,r.state,null),p1(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function bd(t,e){try{var n="",i=e;do n+=Z7(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function C_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function JE(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var b9=typeof WeakMap=="function"?WeakMap:Map;function Tz(t,e,n){n=$a(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){y1||(y1=!0,aR=i),JE(t,e)},n}function Az(t,e,n){n=$a(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){JE(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){JE(t,e),typeof i!="function"&&(Wc===null?Wc=new Set([this]):Wc.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function ZI(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new b9;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=B9.bind(null,t,e,n),e.then(t,t))}function eM(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function tM(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=$a(-1,1),e.tag=2,jc(n,e,1))),n.lanes|=1),t)}var T9=ec.ReactCurrentOwner,Hr=!1;function _r(t,e,n,i){e.child=t===null?iz(e,null,n,i):Ed(e,t.child,n,i)}function nM(t,e,n,i,r){n=n.render;var s=e.ref;return od(e,r),i=qT(t,e,n,i,s,r),n=XT(),t!==null&&!Hr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Xa(t,e,r)):(Nn&&n&&NT(e),e.flags|=1,_r(t,e,i,r),e.child)}function iM(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!r2(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Pz(t,e,s,i,r)):(t=Py(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Og,n(o,i)&&t.ref===e.ref)return Xa(t,e,r)}return e.flags|=1,t=qc(s,i),t.ref=e.ref,t.return=e,e.child=t}function Pz(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Og(s,i)&&t.ref===e.ref)if(Hr=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Hr=!0);else return e.lanes=t.lanes,Xa(t,e,r)}return QE(t,e,n,i,r)}function Iz(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_n(qh,us),us|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,_n(qh,us),us|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,_n(qh,us),us|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,_n(qh,us),us|=i;return _r(t,e,r,n),e.child}function Mz(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function QE(t,e,n,i,r){var s=Wr(n)?wu:fr.current;return s=_d(e,s),od(e,r),n=qT(t,e,n,i,s,r),i=XT(),t!==null&&!Hr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Xa(t,e,r)):(Nn&&i&&NT(e),e.flags|=1,_r(t,e,n,r),e.child)}function rM(t,e,n,i,r){if(Wr(n)){var s=!0;c1(e)}else s=!1;if(od(e,r),e.stateNode===null)by(t,e),bz(e,n,i),YE(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Xs(l):(l=Wr(n)?wu:fr.current,l=_d(e,l));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&QI(e,o,i,l),Cc=!1;var d=e.memoizedState;o.state=d,p1(e,i,o,r),c=e.memoizedState,a!==i||d!==c||jr.current||Cc?(typeof u=="function"&&(KE(e,n,u,i),c=e.memoizedState),(a=Cc||JI(e,n,a,i,d,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,sz(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:po(e.type,a),o.props=l,h=e.pendingProps,d=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Xs(c):(c=Wr(n)?wu:fr.current,c=_d(e,c));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==c)&&QI(e,o,i,c),Cc=!1,d=e.memoizedState,o.state=d,p1(e,i,o,r);var f=e.memoizedState;a!==h||d!==f||jr.current||Cc?(typeof p=="function"&&(KE(e,n,p,i),f=e.memoizedState),(l=Cc||JI(e,n,l,i,d,f,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,f,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,f,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return ZE(t,e,n,i,s,r)}function ZE(t,e,n,i,r,s){Mz(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&VI(e,n,!1),Xa(t,e,s);i=e.stateNode,T9.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Ed(e,t.child,null,s),e.child=Ed(e,null,a,s)):_r(t,e,a,s),e.memoizedState=i.state,r&&VI(e,n,!0),e.child}function kz(t){var e=t.stateNode;e.pendingContext?HI(t,e.pendingContext,e.pendingContext!==e.context):e.context&&HI(t,e.context,!1),VT(t,e.containerInfo)}function sM(t,e,n,i,r){return wd(),FT(r),e.flags|=256,_r(t,e,n,i),e.child}var eR={dehydrated:null,treeContext:null,retryLane:0};function tR(t){return{baseLanes:t,cachePool:null,transitions:null}}function Lz(t,e,n){var i=e.pendingProps,r=Un.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),_n(Un,r&1),t===null)return qE(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=PS(o,i,0,null),t=yu(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=tR(n),e.memoizedState=eR,t):JT(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return A9(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=qc(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=qc(a,s):(s=yu(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?tR(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=eR,i}return s=t.child,t=s.sibling,i=qc(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function JT(t,e){return e=PS({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function gv(t,e,n,i){return i!==null&&FT(i),Ed(e,t.child,null,n),t=JT(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function A9(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=C_(Error(Se(422))),gv(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=PS({mode:"visible",children:i.children},r,0,null),s=yu(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Ed(e,t.child,null,o),e.child.memoizedState=tR(o),e.memoizedState=eR,s);if(!(e.mode&1))return gv(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(Se(419)),i=C_(s,i,void 0),gv(t,e,o,i)}if(a=(o&t.childLanes)!==0,Hr||a){if(i=Li,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,qa(t,r),To(i,t,r,-1))}return i2(),i=C_(Error(Se(421))),gv(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=$9.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,ps=Vc(r.nextSibling),vs=e,Nn=!0,yo=null,t!==null&&(Ds[Ns++]=Oa,Ds[Ns++]=Fa,Ds[Ns++]=Eu,Oa=t.id,Fa=t.overflow,Eu=e),e=JT(e,i.children),e.flags|=4096,e)}function oM(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),XE(t.return,e,n)}function __(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Dz(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(_r(t,e,i.children,n),i=Un.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&oM(t,n,e);else if(t.tag===19)oM(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(_n(Un,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&f1(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),__(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&f1(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}__(e,!0,n,null,s);break;case"together":__(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function by(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xa(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),bu|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Se(153));if(e.child!==null){for(t=e.child,n=qc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=qc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function P9(t,e,n){switch(e.tag){case 3:kz(e),wd();break;case 5:oz(e);break;case 1:Wr(e.type)&&c1(e);break;case 4:VT(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;_n(h1,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(_n(Un,Un.current&1),e.flags|=128,null):n&e.child.childLanes?Lz(t,e,n):(_n(Un,Un.current&1),t=Xa(t,e,n),t!==null?t.sibling:null);_n(Un,Un.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Dz(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),_n(Un,Un.current),i)break;return null;case 22:case 23:return e.lanes=0,Iz(t,e,n)}return Xa(t,e,n)}var Nz,nR,Oz,Fz;Nz=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};nR=function(){};Oz=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,hu(sa.current);var s=null;switch(n){case"input":r=EE(t,r),i=EE(t,i),s=[];break;case"select":r=jn({},r,{value:void 0}),i=jn({},i,{value:void 0}),s=[];break;case"textarea":r=TE(t,r),i=TE(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=o1)}PE(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Pg.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Pg.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&An("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Fz=function(t,e,n,i){n!==i&&(e.flags|=4)};function $p(t,e){if(!Nn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Qi(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function I9(t,e,n){var i=e.pendingProps;switch(OT(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qi(e),null;case 1:return Wr(e.type)&&a1(),Qi(e),null;case 3:return i=e.stateNode,Rd(),Mn(jr),Mn(fr),WT(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(fv(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,yo!==null&&(uR(yo),yo=null))),nR(t,e),Qi(e),null;case 5:jT(e);var r=hu($g.current);if(n=e.type,t!==null&&e.stateNode!=null)Oz(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Se(166));return Qi(e),null}if(t=hu(sa.current),fv(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Qo]=e,i[Ug]=s,t=(e.mode&1)!==0,n){case"dialog":An("cancel",i),An("close",i);break;case"iframe":case"object":case"embed":An("load",i);break;case"video":case"audio":for(r=0;r<Jm.length;r++)An(Jm[r],i);break;case"source":An("error",i);break;case"img":case"image":case"link":An("error",i),An("load",i);break;case"details":An("toggle",i);break;case"input":mI(i,s),An("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},An("invalid",i);break;case"textarea":vI(i,s),An("invalid",i)}PE(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&pv(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&pv(i.textContent,a,t),r=["children",""+a]):Pg.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&An("scroll",i)}switch(n){case"input":sv(i),gI(i,s,!0);break;case"textarea":sv(i),yI(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=o1)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=hF(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Qo]=e,t[Ug]=i,Nz(t,e,!1,!1),e.stateNode=t;e:{switch(o=IE(n,i),n){case"dialog":An("cancel",t),An("close",t),r=i;break;case"iframe":case"object":case"embed":An("load",t),r=i;break;case"video":case"audio":for(r=0;r<Jm.length;r++)An(Jm[r],t);r=i;break;case"source":An("error",t),r=i;break;case"img":case"image":case"link":An("error",t),An("load",t),r=i;break;case"details":An("toggle",t),r=i;break;case"input":mI(t,i),r=EE(t,i),An("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=jn({},i,{value:void 0}),An("invalid",t);break;case"textarea":vI(t,i),r=TE(t,i),An("invalid",t);break;default:r=i}PE(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?fF(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&dF(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ig(t,c):typeof c=="number"&&Ig(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Pg.hasOwnProperty(s)?c!=null&&s==="onScroll"&&An("scroll",t):c!=null&&CT(t,s,c,o))}switch(n){case"input":sv(t),gI(t,i,!1);break;case"textarea":sv(t),yI(t);break;case"option":i.value!=null&&t.setAttribute("value",""+nl(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?nd(t,!!i.multiple,s,!1):i.defaultValue!=null&&nd(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=o1)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Qi(e),null;case 6:if(t&&e.stateNode!=null)Fz(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Se(166));if(n=hu($g.current),hu(sa.current),fv(e)){if(i=e.stateNode,n=e.memoizedProps,i[Qo]=e,(s=i.nodeValue!==n)&&(t=vs,t!==null))switch(t.tag){case 3:pv(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&pv(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Qo]=e,e.stateNode=i}return Qi(e),null;case 13:if(Mn(Un),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Nn&&ps!==null&&e.mode&1&&!(e.flags&128))tz(),wd(),e.flags|=98560,s=!1;else if(s=fv(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(Se(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Se(317));s[Qo]=e}else wd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Qi(e),s=!1}else yo!==null&&(uR(yo),yo=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Un.current&1?xi===0&&(xi=3):i2())),e.updateQueue!==null&&(e.flags|=4),Qi(e),null);case 4:return Rd(),nR(t,e),t===null&&Fg(e.stateNode.containerInfo),Qi(e),null;case 10:return BT(e.type._context),Qi(e),null;case 17:return Wr(e.type)&&a1(),Qi(e),null;case 19:if(Mn(Un),s=e.memoizedState,s===null)return Qi(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)$p(s,!1);else{if(xi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=f1(t),o!==null){for(e.flags|=128,$p(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return _n(Un,Un.current&1|2),e.child}t=t.sibling}s.tail!==null&&ni()>Td&&(e.flags|=128,i=!0,$p(s,!1),e.lanes=4194304)}else{if(!i)if(t=f1(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),$p(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Nn)return Qi(e),null}else 2*ni()-s.renderingStartTime>Td&&n!==1073741824&&(e.flags|=128,i=!0,$p(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ni(),e.sibling=null,n=Un.current,_n(Un,i?n&1|2:n&1),e):(Qi(e),null);case 22:case 23:return n2(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?us&1073741824&&(Qi(e),e.subtreeFlags&6&&(e.flags|=8192)):Qi(e),null;case 24:return null;case 25:return null}throw Error(Se(156,e.tag))}function M9(t,e){switch(OT(e),e.tag){case 1:return Wr(e.type)&&a1(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Rd(),Mn(jr),Mn(fr),WT(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return jT(e),null;case 13:if(Mn(Un),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Se(340));wd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Mn(Un),null;case 4:return Rd(),null;case 10:return BT(e.type._context),null;case 22:case 23:return n2(),null;case 24:return null;default:return null}}var vv=!1,cr=!1,k9=typeof WeakSet=="function"?WeakSet:Set,$e=null;function Gh(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Xn(t,e,i)}else n.current=null}function iR(t,e,n){try{n()}catch(i){Xn(t,e,i)}}var aM=!1;function L9(t,e){if(BE=i1,t=HF(),DT(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,h=t,d=null;t:for(;;){for(var p;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==s||i!==0&&h.nodeType!==3||(c=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===t)break t;if(d===n&&++l===r&&(a=o),d===s&&++u===i&&(c=o),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for($E={focusedElem:t,selectionRange:n},i1=!1,$e=e;$e!==null;)if(e=$e,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,$e=t;else for(;$e!==null;){e=$e;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var v=f.memoizedProps,g=f.memoizedState,m=e.stateNode,y=m.getSnapshotBeforeUpdate(e.elementType===e.type?v:po(e.type,v),g);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(x){Xn(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,$e=t;break}$e=e.return}return f=aM,aM=!1,f}function mg(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&iR(e,n,s)}r=r.next}while(r!==i)}}function TS(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function rR(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function zz(t){var e=t.alternate;e!==null&&(t.alternate=null,zz(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qo],delete e[Ug],delete e[jE],delete e[m9],delete e[g9])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Uz(t){return t.tag===5||t.tag===3||t.tag===4}function cM(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Uz(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function sR(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=o1));else if(i!==4&&(t=t.child,t!==null))for(sR(t,e,n),t=t.sibling;t!==null;)sR(t,e,n),t=t.sibling}function oR(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(oR(t,e,n),t=t.sibling;t!==null;)oR(t,e,n),t=t.sibling}var $i=null,mo=!1;function ac(t,e,n){for(n=n.child;n!==null;)Bz(t,e,n),n=n.sibling}function Bz(t,e,n){if(ra&&typeof ra.onCommitFiberUnmount=="function")try{ra.onCommitFiberUnmount(SS,n)}catch{}switch(n.tag){case 5:cr||Gh(n,e);case 6:var i=$i,r=mo;$i=null,ac(t,e,n),$i=i,mo=r,$i!==null&&(mo?(t=$i,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):$i.removeChild(n.stateNode));break;case 18:$i!==null&&(mo?(t=$i,n=n.stateNode,t.nodeType===8?m_(t.parentNode,n):t.nodeType===1&&m_(t,n),Dg(t)):m_($i,n.stateNode));break;case 4:i=$i,r=mo,$i=n.stateNode.containerInfo,mo=!0,ac(t,e,n),$i=i,mo=r;break;case 0:case 11:case 14:case 15:if(!cr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&iR(n,e,o),r=r.next}while(r!==i)}ac(t,e,n);break;case 1:if(!cr&&(Gh(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Xn(n,e,a)}ac(t,e,n);break;case 21:ac(t,e,n);break;case 22:n.mode&1?(cr=(i=cr)||n.memoizedState!==null,ac(t,e,n),cr=i):ac(t,e,n);break;default:ac(t,e,n)}}function lM(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new k9),e.forEach(function(i){var r=H9.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function ao(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:$i=a.stateNode,mo=!1;break e;case 3:$i=a.stateNode.containerInfo,mo=!0;break e;case 4:$i=a.stateNode.containerInfo,mo=!0;break e}a=a.return}if($i===null)throw Error(Se(160));Bz(s,o,r),$i=null,mo=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){Xn(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)$z(e,t),e=e.sibling}function $z(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ao(e,t),Vo(t),i&4){try{mg(3,t,t.return),TS(3,t)}catch(v){Xn(t,t.return,v)}try{mg(5,t,t.return)}catch(v){Xn(t,t.return,v)}}break;case 1:ao(e,t),Vo(t),i&512&&n!==null&&Gh(n,n.return);break;case 5:if(ao(e,t),Vo(t),i&512&&n!==null&&Gh(n,n.return),t.flags&32){var r=t.stateNode;try{Ig(r,"")}catch(v){Xn(t,t.return,v)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&lF(r,s),IE(a,o);var l=IE(a,s);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?fF(r,h):u==="dangerouslySetInnerHTML"?dF(r,h):u==="children"?Ig(r,h):CT(r,u,h,l)}switch(a){case"input":RE(r,s);break;case"textarea":uF(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?nd(r,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?nd(r,!!s.multiple,s.defaultValue,!0):nd(r,!!s.multiple,s.multiple?[]:"",!1))}r[Ug]=s}catch(v){Xn(t,t.return,v)}}break;case 6:if(ao(e,t),Vo(t),i&4){if(t.stateNode===null)throw Error(Se(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(v){Xn(t,t.return,v)}}break;case 3:if(ao(e,t),Vo(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Dg(e.containerInfo)}catch(v){Xn(t,t.return,v)}break;case 4:ao(e,t),Vo(t);break;case 13:ao(e,t),Vo(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(e2=ni())),i&4&&lM(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(cr=(l=cr)||u,ao(e,t),cr=l):ao(e,t),Vo(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for($e=t,u=t.child;u!==null;){for(h=$e=u;$e!==null;){switch(d=$e,p=d.child,d.tag){case 0:case 11:case 14:case 15:mg(4,d,d.return);break;case 1:Gh(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){i=d,n=d.return;try{e=i,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(v){Xn(i,n,v)}}break;case 5:Gh(d,d.return);break;case 22:if(d.memoizedState!==null){hM(h);continue}}p!==null?(p.return=d,$e=p):hM(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=pF("display",o))}catch(v){Xn(t,t.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(v){Xn(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ao(e,t),Vo(t),i&4&&lM(t);break;case 21:break;default:ao(e,t),Vo(t)}}function Vo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Uz(n)){var i=n;break e}n=n.return}throw Error(Se(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Ig(r,""),i.flags&=-33);var s=cM(t);oR(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=cM(t);sR(t,a,o);break;default:throw Error(Se(161))}}catch(c){Xn(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function D9(t,e,n){$e=t,Hz(t)}function Hz(t,e,n){for(var i=(t.mode&1)!==0;$e!==null;){var r=$e,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||vv;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||cr;a=vv;var l=cr;if(vv=o,(cr=c)&&!l)for($e=r;$e!==null;)o=$e,c=o.child,o.tag===22&&o.memoizedState!==null?dM(r):c!==null?(c.return=o,$e=c):dM(r);for(;s!==null;)$e=s,Hz(s),s=s.sibling;$e=r,vv=a,cr=l}uM(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,$e=s):uM(t)}}function uM(t){for(;$e!==null;){var e=$e;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:cr||TS(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!cr)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:po(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&XI(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}XI(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Dg(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}cr||e.flags&512&&rR(e)}catch(d){Xn(e,e.return,d)}}if(e===t){$e=null;break}if(n=e.sibling,n!==null){n.return=e.return,$e=n;break}$e=e.return}}function hM(t){for(;$e!==null;){var e=$e;if(e===t){$e=null;break}var n=e.sibling;if(n!==null){n.return=e.return,$e=n;break}$e=e.return}}function dM(t){for(;$e!==null;){var e=$e;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{TS(4,e)}catch(c){Xn(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){Xn(e,r,c)}}var s=e.return;try{rR(e)}catch(c){Xn(e,s,c)}break;case 5:var o=e.return;try{rR(e)}catch(c){Xn(e,o,c)}}}catch(c){Xn(e,e.return,c)}if(e===t){$e=null;break}var a=e.sibling;if(a!==null){a.return=e.return,$e=a;break}$e=e.return}}var N9=Math.ceil,v1=ec.ReactCurrentDispatcher,QT=ec.ReactCurrentOwner,Gs=ec.ReactCurrentBatchConfig,Yt=0,Li=null,ui=null,ji=0,us=0,qh=ml(0),xi=0,Wg=null,bu=0,AS=0,ZT=0,gg=null,$r=null,e2=0,Td=1/0,Pa=null,y1=!1,aR=null,Wc=null,yv=!1,Lc=null,S1=0,vg=0,cR=null,Ty=-1,Ay=0;function Rr(){return Yt&6?ni():Ty!==-1?Ty:Ty=ni()}function Gc(t){return t.mode&1?Yt&2&&ji!==0?ji&-ji:y9.transition!==null?(Ay===0&&(Ay=bF()),Ay):(t=ln,t!==0||(t=window.event,t=t===void 0?16:LF(t.type)),t):1}function To(t,e,n,i){if(50<vg)throw vg=0,cR=null,Error(Se(185));y0(t,n,i),(!(Yt&2)||t!==Li)&&(t===Li&&(!(Yt&2)&&(AS|=n),xi===4&&Ac(t,ji)),Gr(t,i),n===1&&Yt===0&&!(e.mode&1)&&(Td=ni()+500,ES&&gl()))}function Gr(t,e){var n=t.callbackNode;yj(t,e);var i=n1(t,t===Li?ji:0);if(i===0)n!==null&&CI(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&CI(n),e===1)t.tag===0?v9(pM.bind(null,t)):QF(pM.bind(null,t)),p9(function(){!(Yt&6)&&gl()}),n=null;else{switch(TF(i)){case 1:n=bT;break;case 4:n=EF;break;case 16:n=t1;break;case 536870912:n=RF;break;default:n=t1}n=Yz(n,Vz.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Vz(t,e){if(Ty=-1,Ay=0,Yt&6)throw Error(Se(327));var n=t.callbackNode;if(ad()&&t.callbackNode!==n)return null;var i=n1(t,t===Li?ji:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=x1(t,i);else{e=i;var r=Yt;Yt|=2;var s=Wz();(Li!==t||ji!==e)&&(Pa=null,Td=ni()+500,vu(t,e));do try{z9();break}catch(a){jz(t,a)}while(!0);UT(),v1.current=s,Yt=r,ui!==null?e=0:(Li=null,ji=0,e=xi)}if(e!==0){if(e===2&&(r=NE(t),r!==0&&(i=r,e=lR(t,r))),e===1)throw n=Wg,vu(t,0),Ac(t,i),Gr(t,ni()),n;if(e===6)Ac(t,i);else{if(r=t.current.alternate,!(i&30)&&!O9(r)&&(e=x1(t,i),e===2&&(s=NE(t),s!==0&&(i=s,e=lR(t,s))),e===1))throw n=Wg,vu(t,0),Ac(t,i),Gr(t,ni()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(Se(345));case 2:Ql(t,$r,Pa);break;case 3:if(Ac(t,i),(i&130023424)===i&&(e=e2+500-ni(),10<e)){if(n1(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Rr(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=VE(Ql.bind(null,t,$r,Pa),e);break}Ql(t,$r,Pa);break;case 4:if(Ac(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-bo(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=ni()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*N9(i/1960))-i,10<i){t.timeoutHandle=VE(Ql.bind(null,t,$r,Pa),i);break}Ql(t,$r,Pa);break;case 5:Ql(t,$r,Pa);break;default:throw Error(Se(329))}}}return Gr(t,ni()),t.callbackNode===n?Vz.bind(null,t):null}function lR(t,e){var n=gg;return t.current.memoizedState.isDehydrated&&(vu(t,e).flags|=256),t=x1(t,e),t!==2&&(e=$r,$r=n,e!==null&&uR(e)),t}function uR(t){$r===null?$r=t:$r.push.apply($r,t)}function O9(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Po(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ac(t,e){for(e&=~ZT,e&=~AS,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-bo(e),i=1<<n;t[n]=-1,e&=~i}}function pM(t){if(Yt&6)throw Error(Se(327));ad();var e=n1(t,0);if(!(e&1))return Gr(t,ni()),null;var n=x1(t,e);if(t.tag!==0&&n===2){var i=NE(t);i!==0&&(e=i,n=lR(t,i))}if(n===1)throw n=Wg,vu(t,0),Ac(t,e),Gr(t,ni()),n;if(n===6)throw Error(Se(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ql(t,$r,Pa),Gr(t,ni()),null}function t2(t,e){var n=Yt;Yt|=1;try{return t(e)}finally{Yt=n,Yt===0&&(Td=ni()+500,ES&&gl())}}function Tu(t){Lc!==null&&Lc.tag===0&&!(Yt&6)&&ad();var e=Yt;Yt|=1;var n=Gs.transition,i=ln;try{if(Gs.transition=null,ln=1,t)return t()}finally{ln=i,Gs.transition=n,Yt=e,!(Yt&6)&&gl()}}function n2(){us=qh.current,Mn(qh)}function vu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,d9(n)),ui!==null)for(n=ui.return;n!==null;){var i=n;switch(OT(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&a1();break;case 3:Rd(),Mn(jr),Mn(fr),WT();break;case 5:jT(i);break;case 4:Rd();break;case 13:Mn(Un);break;case 19:Mn(Un);break;case 10:BT(i.type._context);break;case 22:case 23:n2()}n=n.return}if(Li=t,ui=t=qc(t.current,null),ji=us=e,xi=0,Wg=null,ZT=AS=bu=0,$r=gg=null,uu!==null){for(e=0;e<uu.length;e++)if(n=uu[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}uu=null}return t}function jz(t,e){do{var n=ui;try{if(UT(),Ey.current=g1,m1){for(var i=Vn.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}m1=!1}if(Ru=0,Mi=gi=Vn=null,fg=!1,Hg=0,QT.current=null,n===null||n.return===null){xi=1,Wg=e,ui=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=ji,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=eM(o);if(p!==null){p.flags&=-257,tM(p,o,a,s,e),p.mode&1&&ZI(s,l,e),e=p,c=l;var f=e.updateQueue;if(f===null){var v=new Set;v.add(c),e.updateQueue=v}else f.add(c);break e}else{if(!(e&1)){ZI(s,l,e),i2();break e}c=Error(Se(426))}}else if(Nn&&a.mode&1){var g=eM(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),tM(g,o,a,s,e),FT(bd(c,a));break e}}s=c=bd(c,a),xi!==4&&(xi=2),gg===null?gg=[s]:gg.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=Tz(s,c,e);qI(s,m);break e;case 1:a=c;var y=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Wc===null||!Wc.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var x=Az(s,a,e);qI(s,x);break e}}s=s.return}while(s!==null)}qz(n)}catch(w){e=w,ui===n&&n!==null&&(ui=n=n.return);continue}break}while(!0)}function Wz(){var t=v1.current;return v1.current=g1,t===null?g1:t}function i2(){(xi===0||xi===3||xi===2)&&(xi=4),Li===null||!(bu&268435455)&&!(AS&268435455)||Ac(Li,ji)}function x1(t,e){var n=Yt;Yt|=2;var i=Wz();(Li!==t||ji!==e)&&(Pa=null,vu(t,e));do try{F9();break}catch(r){jz(t,r)}while(!0);if(UT(),Yt=n,v1.current=i,ui!==null)throw Error(Se(261));return Li=null,ji=0,xi}function F9(){for(;ui!==null;)Gz(ui)}function z9(){for(;ui!==null&&!lj();)Gz(ui)}function Gz(t){var e=Kz(t.alternate,t,us);t.memoizedProps=t.pendingProps,e===null?qz(t):ui=e,QT.current=null}function qz(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=M9(n,e),n!==null){n.flags&=32767,ui=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xi=6,ui=null;return}}else if(n=I9(n,e,us),n!==null){ui=n;return}if(e=e.sibling,e!==null){ui=e;return}ui=e=t}while(e!==null);xi===0&&(xi=5)}function Ql(t,e,n){var i=ln,r=Gs.transition;try{Gs.transition=null,ln=1,U9(t,e,n,i)}finally{Gs.transition=r,ln=i}return null}function U9(t,e,n,i){do ad();while(Lc!==null);if(Yt&6)throw Error(Se(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Se(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Sj(t,s),t===Li&&(ui=Li=null,ji=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||yv||(yv=!0,Yz(t1,function(){return ad(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Gs.transition,Gs.transition=null;var o=ln;ln=1;var a=Yt;Yt|=4,QT.current=null,L9(t,n),$z(n,t),s9($E),i1=!!BE,$E=BE=null,t.current=n,D9(n),uj(),Yt=a,ln=o,Gs.transition=s}else t.current=n;if(yv&&(yv=!1,Lc=t,S1=r),s=t.pendingLanes,s===0&&(Wc=null),pj(n.stateNode),Gr(t,ni()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(y1)throw y1=!1,t=aR,aR=null,t;return S1&1&&t.tag!==0&&ad(),s=t.pendingLanes,s&1?t===cR?vg++:(vg=0,cR=t):vg=0,gl(),null}function ad(){if(Lc!==null){var t=TF(S1),e=Gs.transition,n=ln;try{if(Gs.transition=null,ln=16>t?16:t,Lc===null)var i=!1;else{if(t=Lc,Lc=null,S1=0,Yt&6)throw Error(Se(331));var r=Yt;for(Yt|=4,$e=t.current;$e!==null;){var s=$e,o=s.child;if($e.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for($e=l;$e!==null;){var u=$e;switch(u.tag){case 0:case 11:case 15:mg(8,u,s)}var h=u.child;if(h!==null)h.return=u,$e=h;else for(;$e!==null;){u=$e;var d=u.sibling,p=u.return;if(zz(u),u===l){$e=null;break}if(d!==null){d.return=p,$e=d;break}$e=p}}}var f=s.alternate;if(f!==null){var v=f.child;if(v!==null){f.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(v!==null)}}$e=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,$e=o;else e:for(;$e!==null;){if(s=$e,s.flags&2048)switch(s.tag){case 0:case 11:case 15:mg(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,$e=m;break e}$e=s.return}}var y=t.current;for($e=y;$e!==null;){o=$e;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,$e=S;else e:for(o=y;$e!==null;){if(a=$e,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:TS(9,a)}}catch(w){Xn(a,a.return,w)}if(a===o){$e=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,$e=x;break e}$e=a.return}}if(Yt=r,gl(),ra&&typeof ra.onPostCommitFiberRoot=="function")try{ra.onPostCommitFiberRoot(SS,t)}catch{}i=!0}return i}finally{ln=n,Gs.transition=e}}return!1}function fM(t,e,n){e=bd(n,e),e=Tz(t,e,1),t=jc(t,e,1),e=Rr(),t!==null&&(y0(t,1,e),Gr(t,e))}function Xn(t,e,n){if(t.tag===3)fM(t,t,n);else for(;e!==null;){if(e.tag===3){fM(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Wc===null||!Wc.has(i))){t=bd(n,t),t=Az(e,t,1),e=jc(e,t,1),t=Rr(),e!==null&&(y0(e,1,t),Gr(e,t));break}}e=e.return}}function B9(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Rr(),t.pingedLanes|=t.suspendedLanes&n,Li===t&&(ji&n)===n&&(xi===4||xi===3&&(ji&130023424)===ji&&500>ni()-e2?vu(t,0):ZT|=n),Gr(t,e)}function Xz(t,e){e===0&&(t.mode&1?(e=cv,cv<<=1,!(cv&130023424)&&(cv=4194304)):e=1);var n=Rr();t=qa(t,e),t!==null&&(y0(t,e,n),Gr(t,n))}function $9(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Xz(t,n)}function H9(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Se(314))}i!==null&&i.delete(e),Xz(t,n)}var Kz;Kz=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||jr.current)Hr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Hr=!1,P9(t,e,n);Hr=!!(t.flags&131072)}else Hr=!1,Nn&&e.flags&1048576&&ZF(e,u1,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;by(t,e),t=e.pendingProps;var r=_d(e,fr.current);od(e,n),r=qT(null,e,i,t,r,n);var s=XT();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Wr(i)?(s=!0,c1(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,HT(e),r.updater=bS,e.stateNode=r,r._reactInternals=e,YE(e,i,t,n),e=ZE(null,e,i,!0,s,n)):(e.tag=0,Nn&&s&&NT(e),_r(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(by(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=j9(i),t=po(i,t),r){case 0:e=QE(null,e,i,t,n);break e;case 1:e=rM(null,e,i,t,n);break e;case 11:e=nM(null,e,i,t,n);break e;case 14:e=iM(null,e,i,po(i.type,t),n);break e}throw Error(Se(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),QE(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),rM(t,e,i,r,n);case 3:e:{if(kz(e),t===null)throw Error(Se(387));i=e.pendingProps,s=e.memoizedState,r=s.element,sz(t,e),p1(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=bd(Error(Se(423)),e),e=sM(t,e,i,n,r);break e}else if(i!==r){r=bd(Error(Se(424)),e),e=sM(t,e,i,n,r);break e}else for(ps=Vc(e.stateNode.containerInfo.firstChild),vs=e,Nn=!0,yo=null,n=iz(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wd(),i===r){e=Xa(t,e,n);break e}_r(t,e,i,n)}e=e.child}return e;case 5:return oz(e),t===null&&qE(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,HE(i,r)?o=null:s!==null&&HE(i,s)&&(e.flags|=32),Mz(t,e),_r(t,e,o,n),e.child;case 6:return t===null&&qE(e),null;case 13:return Lz(t,e,n);case 4:return VT(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Ed(e,null,i,n):_r(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),nM(t,e,i,r,n);case 7:return _r(t,e,e.pendingProps,n),e.child;case 8:return _r(t,e,e.pendingProps.children,n),e.child;case 12:return _r(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,_n(h1,i._currentValue),i._currentValue=o,s!==null)if(Po(s.value,o)){if(s.children===r.children&&!jr.current){e=Xa(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=$a(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),XE(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Se(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),XE(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}_r(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,od(e,n),r=Xs(r),i=i(r),e.flags|=1,_r(t,e,i,n),e.child;case 14:return i=e.type,r=po(i,e.pendingProps),r=po(i.type,r),iM(t,e,i,r,n);case 15:return Pz(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),by(t,e),e.tag=1,Wr(i)?(t=!0,c1(e)):t=!1,od(e,n),bz(e,i,r),YE(e,i,r,n),ZE(null,e,i,!0,t,n);case 19:return Dz(t,e,n);case 22:return Iz(t,e,n)}throw Error(Se(156,e.tag))};function Yz(t,e){return wF(t,e)}function V9(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(t,e,n,i){return new V9(t,e,n,i)}function r2(t){return t=t.prototype,!(!t||!t.isReactComponent)}function j9(t){if(typeof t=="function")return r2(t)?1:0;if(t!=null){if(t=t.$$typeof,t===wT)return 11;if(t===ET)return 14}return 2}function qc(t,e){var n=t.alternate;return n===null?(n=Us(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Py(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")r2(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Fh:return yu(n.children,r,s,e);case _T:o=8,r|=8;break;case xE:return t=Us(12,n,e,r|2),t.elementType=xE,t.lanes=s,t;case CE:return t=Us(13,n,e,r),t.elementType=CE,t.lanes=s,t;case _E:return t=Us(19,n,e,r),t.elementType=_E,t.lanes=s,t;case oF:return PS(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case rF:o=10;break e;case sF:o=9;break e;case wT:o=11;break e;case ET:o=14;break e;case xc:o=16,i=null;break e}throw Error(Se(130,t==null?t:typeof t,""))}return e=Us(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function yu(t,e,n,i){return t=Us(7,t,i,e),t.lanes=n,t}function PS(t,e,n,i){return t=Us(22,t,i,e),t.elementType=oF,t.lanes=n,t.stateNode={isHidden:!1},t}function w_(t,e,n){return t=Us(6,t,null,e),t.lanes=n,t}function E_(t,e,n){return e=Us(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function W9(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=r_(0),this.expirationTimes=r_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=r_(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function s2(t,e,n,i,r,s,o,a,c){return t=new W9(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Us(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},HT(s),t}function G9(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oh,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Jz(t){if(!t)return il;t=t._reactInternals;e:{if(Gu(t)!==t||t.tag!==1)throw Error(Se(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Wr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Se(171))}if(t.tag===1){var n=t.type;if(Wr(n))return JF(t,n,e)}return e}function Qz(t,e,n,i,r,s,o,a,c){return t=s2(n,i,!0,t,r,s,o,a,c),t.context=Jz(null),n=t.current,i=Rr(),r=Gc(n),s=$a(i,r),s.callback=e??null,jc(n,s,r),t.current.lanes=r,y0(t,r,i),Gr(t,i),t}function IS(t,e,n,i){var r=e.current,s=Rr(),o=Gc(r);return n=Jz(n),e.context===null?e.context=n:e.pendingContext=n,e=$a(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=jc(r,e,o),t!==null&&(To(t,r,o,s),wy(t,r,o)),o}function C1(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function mM(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function o2(t,e){mM(t,e),(t=t.alternate)&&mM(t,e)}function q9(){return null}var Zz=typeof reportError=="function"?reportError:function(t){console.error(t)};function a2(t){this._internalRoot=t}MS.prototype.render=a2.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Se(409));IS(t,e,null,null)};MS.prototype.unmount=a2.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Tu(function(){IS(null,t,null,null)}),e[Ga]=null}};function MS(t){this._internalRoot=t}MS.prototype.unstable_scheduleHydration=function(t){if(t){var e=IF();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Tc.length&&e!==0&&e<Tc[n].priority;n++);Tc.splice(n,0,t),n===0&&kF(t)}};function c2(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function kS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function gM(){}function X9(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=C1(o);s.call(l)}}var o=Qz(e,i,t,0,null,!1,!1,"",gM);return t._reactRootContainer=o,t[Ga]=o.current,Fg(t.nodeType===8?t.parentNode:t),Tu(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=C1(c);a.call(l)}}var c=s2(t,0,!1,null,null,!1,!1,"",gM);return t._reactRootContainer=c,t[Ga]=c.current,Fg(t.nodeType===8?t.parentNode:t),Tu(function(){IS(e,c,n,i)}),c}function LS(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=C1(o);a.call(c)}}IS(e,o,t,r)}else o=X9(n,e,t,r,i);return C1(o)}AF=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ym(e.pendingLanes);n!==0&&(TT(e,n|1),Gr(e,ni()),!(Yt&6)&&(Td=ni()+500,gl()))}break;case 13:Tu(function(){var i=qa(t,1);if(i!==null){var r=Rr();To(i,t,1,r)}}),o2(t,1)}};AT=function(t){if(t.tag===13){var e=qa(t,134217728);if(e!==null){var n=Rr();To(e,t,134217728,n)}o2(t,134217728)}};PF=function(t){if(t.tag===13){var e=Gc(t),n=qa(t,e);if(n!==null){var i=Rr();To(n,t,e,i)}o2(t,e)}};IF=function(){return ln};MF=function(t,e){var n=ln;try{return ln=t,e()}finally{ln=n}};kE=function(t,e,n){switch(e){case"input":if(RE(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=wS(i);if(!r)throw Error(Se(90));cF(i),RE(i,r)}}}break;case"textarea":uF(t,n);break;case"select":e=n.value,e!=null&&nd(t,!!n.multiple,e,!1)}};vF=t2;yF=Tu;var K9={usingClientEntryPoint:!1,Events:[x0,$h,wS,mF,gF,t2]},Hp={findFiberByHostInstance:lu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Y9={bundleType:Hp.bundleType,version:Hp.version,rendererPackageName:Hp.rendererPackageName,rendererConfig:Hp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ec.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=CF(t),t===null?null:t.stateNode},findFiberByHostInstance:Hp.findFiberByHostInstance||q9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sv.isDisabled&&Sv.supportsFiber)try{SS=Sv.inject(Y9),ra=Sv}catch{}}ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K9;ws.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c2(e))throw Error(Se(200));return G9(t,e,null,n)};ws.createRoot=function(t,e){if(!c2(t))throw Error(Se(299));var n=!1,i="",r=Zz;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=s2(t,1,!1,null,null,n,!1,i,r),t[Ga]=e.current,Fg(t.nodeType===8?t.parentNode:t),new a2(e)};ws.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Se(188)):(t=Object.keys(t).join(","),Error(Se(268,t)));return t=CF(e),t=t===null?null:t.stateNode,t};ws.flushSync=function(t){return Tu(t)};ws.hydrate=function(t,e,n){if(!kS(e))throw Error(Se(200));return LS(null,t,e,!0,n)};ws.hydrateRoot=function(t,e,n){if(!c2(t))throw Error(Se(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Zz;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Qz(e,null,t,1,n??null,r,!1,s,o),t[Ga]=e.current,Fg(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new MS(e)};ws.render=function(t,e,n){if(!kS(e))throw Error(Se(200));return LS(null,t,e,!1,n)};ws.unmountComponentAtNode=function(t){if(!kS(t))throw Error(Se(40));return t._reactRootContainer?(Tu(function(){LS(null,null,t,!1,function(){t._reactRootContainer=null,t[Ga]=null})}),!0):!1};ws.unstable_batchedUpdates=t2;ws.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!kS(n))throw Error(Se(200));if(t==null||t._reactInternals===void 0)throw Error(Se(38));return LS(t,e,n,!1,i)};ws.version="18.3.1-next-f1338f8080-20240426";function eU(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(eU)}catch(t){console.error(t)}}eU(),eF.exports=ws;var l2=eF.exports;const J9=vS(l2),Q9=pT({__proto__:null,default:J9},[l2]);var tU,vM=l2;tU=vM.createRoot,vM.hydrateRoot;/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z9=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),nU=(...t)=>t.filter((e,n,i)=>!!e&&i.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var eW={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tW=re.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:s,iconNode:o,...a},c)=>re.createElement("svg",{ref:c,...eW,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:nU("lucide",r),...a},[...o.map(([l,u])=>re.createElement(l,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iU=(t,e)=>{const n=re.forwardRef(({className:i,...r},s)=>re.createElement(tW,{ref:s,iconNode:e,className:nU(`lucide-${Z9(t)}`,i),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nW=iU("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iW=iU("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var Qm={},R_={},DS={},b_={},qn={},rp={},Ys={},rU={},NS={},OS={};Object.defineProperty(OS,"__esModule",{value:!0});OS.default=sW;let xv;const rW=new Uint8Array(16);function sW(){if(!xv&&(xv=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!xv))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xv(rW)}var vl={},qu={},FS={};Object.defineProperty(FS,"__esModule",{value:!0});FS.default=void 0;var oW=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;FS.default=oW;Object.defineProperty(qu,"__esModule",{value:!0});qu.default=void 0;var aW=cW(FS);function cW(t){return t&&t.__esModule?t:{default:t}}function lW(t){return typeof t=="string"&&aW.default.test(t)}var uW=lW;qu.default=uW;Object.defineProperty(vl,"__esModule",{value:!0});vl.default=void 0;vl.unsafeStringify=sU;var hW=dW(qu);function dW(t){return t&&t.__esModule?t:{default:t}}const Bi=[];for(let t=0;t<256;++t)Bi.push((t+256).toString(16).slice(1));function sU(t,e=0){return Bi[t[e+0]]+Bi[t[e+1]]+Bi[t[e+2]]+Bi[t[e+3]]+"-"+Bi[t[e+4]]+Bi[t[e+5]]+"-"+Bi[t[e+6]]+Bi[t[e+7]]+"-"+Bi[t[e+8]]+Bi[t[e+9]]+"-"+Bi[t[e+10]]+Bi[t[e+11]]+Bi[t[e+12]]+Bi[t[e+13]]+Bi[t[e+14]]+Bi[t[e+15]]}function pW(t,e=0){const n=sU(t,e);if(!(0,hW.default)(n))throw TypeError("Stringified UUID is invalid");return n}var fW=pW;vl.default=fW;Object.defineProperty(NS,"__esModule",{value:!0});NS.default=void 0;var mW=vW(OS),gW=vl;function vW(t){return t&&t.__esModule?t:{default:t}}let yM,T_,A_=0,P_=0;function yW(t,e,n){let i=e&&n||0;const r=e||new Array(16);t=t||{};let s=t.node||yM,o=t.clockseq!==void 0?t.clockseq:T_;if(s==null||o==null){const d=t.random||(t.rng||mW.default)();s==null&&(s=yM=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),o==null&&(o=T_=(d[6]<<8|d[7])&16383)}let a=t.msecs!==void 0?t.msecs:Date.now(),c=t.nsecs!==void 0?t.nsecs:P_+1;const l=a-A_+(c-P_)/1e4;if(l<0&&t.clockseq===void 0&&(o=o+1&16383),(l<0||a>A_)&&t.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");A_=a,P_=c,T_=o,a+=122192928e5;const u=((a&268435455)*1e4+c)%4294967296;r[i++]=u>>>24&255,r[i++]=u>>>16&255,r[i++]=u>>>8&255,r[i++]=u&255;const h=a/4294967296*1e4&268435455;r[i++]=h>>>8&255,r[i++]=h&255,r[i++]=h>>>24&15|16,r[i++]=h>>>16&255,r[i++]=o>>>8|128,r[i++]=o&255;for(let d=0;d<6;++d)r[i+d]=s[d];return e||(0,gW.unsafeStringify)(r)}var SW=yW;NS.default=SW;var zS={},rl={},_0={};Object.defineProperty(_0,"__esModule",{value:!0});_0.default=void 0;var xW=CW(qu);function CW(t){return t&&t.__esModule?t:{default:t}}function _W(t){if(!(0,xW.default)(t))throw TypeError("Invalid UUID");let e;const n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}var wW=_W;_0.default=wW;Object.defineProperty(rl,"__esModule",{value:!0});rl.URL=rl.DNS=void 0;rl.default=AW;var EW=vl,RW=bW(_0);function bW(t){return t&&t.__esModule?t:{default:t}}function TW(t){t=unescape(encodeURIComponent(t));const e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}const oU="6ba7b810-9dad-11d1-80b4-00c04fd430c8";rl.DNS=oU;const aU="6ba7b811-9dad-11d1-80b4-00c04fd430c8";rl.URL=aU;function AW(t,e,n){function i(r,s,o,a){var c;if(typeof r=="string"&&(r=TW(r)),typeof s=="string"&&(s=(0,RW.default)(s)),((c=s)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+r.length);if(l.set(s),l.set(r,s.length),l=n(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=l[u];return o}return(0,EW.unsafeStringify)(l)}try{i.name=t}catch{}return i.DNS=oU,i.URL=aU,i}var US={};Object.defineProperty(US,"__esModule",{value:!0});US.default=void 0;function PW(t){if(typeof t=="string"){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n)}return IW(MW(kW(t),t.length*8))}function IW(t){const e=[],n=t.length*32,i="0123456789abcdef";for(let r=0;r<n;r+=8){const s=t[r>>5]>>>r%32&255,o=parseInt(i.charAt(s>>>4&15)+i.charAt(s&15),16);e.push(o)}return e}function cU(t){return(t+64>>>9<<4)+14+1}function MW(t,e){t[e>>5]|=128<<e%32,t[cU(e)-1]=e;let n=1732584193,i=-271733879,r=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=n,c=i,l=r,u=s;n=Zi(n,i,r,s,t[o],7,-680876936),s=Zi(s,n,i,r,t[o+1],12,-389564586),r=Zi(r,s,n,i,t[o+2],17,606105819),i=Zi(i,r,s,n,t[o+3],22,-1044525330),n=Zi(n,i,r,s,t[o+4],7,-176418897),s=Zi(s,n,i,r,t[o+5],12,1200080426),r=Zi(r,s,n,i,t[o+6],17,-1473231341),i=Zi(i,r,s,n,t[o+7],22,-45705983),n=Zi(n,i,r,s,t[o+8],7,1770035416),s=Zi(s,n,i,r,t[o+9],12,-1958414417),r=Zi(r,s,n,i,t[o+10],17,-42063),i=Zi(i,r,s,n,t[o+11],22,-1990404162),n=Zi(n,i,r,s,t[o+12],7,1804603682),s=Zi(s,n,i,r,t[o+13],12,-40341101),r=Zi(r,s,n,i,t[o+14],17,-1502002290),i=Zi(i,r,s,n,t[o+15],22,1236535329),n=er(n,i,r,s,t[o+1],5,-165796510),s=er(s,n,i,r,t[o+6],9,-1069501632),r=er(r,s,n,i,t[o+11],14,643717713),i=er(i,r,s,n,t[o],20,-373897302),n=er(n,i,r,s,t[o+5],5,-701558691),s=er(s,n,i,r,t[o+10],9,38016083),r=er(r,s,n,i,t[o+15],14,-660478335),i=er(i,r,s,n,t[o+4],20,-405537848),n=er(n,i,r,s,t[o+9],5,568446438),s=er(s,n,i,r,t[o+14],9,-1019803690),r=er(r,s,n,i,t[o+3],14,-187363961),i=er(i,r,s,n,t[o+8],20,1163531501),n=er(n,i,r,s,t[o+13],5,-1444681467),s=er(s,n,i,r,t[o+2],9,-51403784),r=er(r,s,n,i,t[o+7],14,1735328473),i=er(i,r,s,n,t[o+12],20,-1926607734),n=tr(n,i,r,s,t[o+5],4,-378558),s=tr(s,n,i,r,t[o+8],11,-2022574463),r=tr(r,s,n,i,t[o+11],16,1839030562),i=tr(i,r,s,n,t[o+14],23,-35309556),n=tr(n,i,r,s,t[o+1],4,-1530992060),s=tr(s,n,i,r,t[o+4],11,1272893353),r=tr(r,s,n,i,t[o+7],16,-155497632),i=tr(i,r,s,n,t[o+10],23,-1094730640),n=tr(n,i,r,s,t[o+13],4,681279174),s=tr(s,n,i,r,t[o],11,-358537222),r=tr(r,s,n,i,t[o+3],16,-722521979),i=tr(i,r,s,n,t[o+6],23,76029189),n=tr(n,i,r,s,t[o+9],4,-640364487),s=tr(s,n,i,r,t[o+12],11,-421815835),r=tr(r,s,n,i,t[o+15],16,530742520),i=tr(i,r,s,n,t[o+2],23,-995338651),n=nr(n,i,r,s,t[o],6,-198630844),s=nr(s,n,i,r,t[o+7],10,1126891415),r=nr(r,s,n,i,t[o+14],15,-1416354905),i=nr(i,r,s,n,t[o+5],21,-57434055),n=nr(n,i,r,s,t[o+12],6,1700485571),s=nr(s,n,i,r,t[o+3],10,-1894986606),r=nr(r,s,n,i,t[o+10],15,-1051523),i=nr(i,r,s,n,t[o+1],21,-2054922799),n=nr(n,i,r,s,t[o+8],6,1873313359),s=nr(s,n,i,r,t[o+15],10,-30611744),r=nr(r,s,n,i,t[o+6],15,-1560198380),i=nr(i,r,s,n,t[o+13],21,1309151649),n=nr(n,i,r,s,t[o+4],6,-145523070),s=nr(s,n,i,r,t[o+11],10,-1120210379),r=nr(r,s,n,i,t[o+2],15,718787259),i=nr(i,r,s,n,t[o+9],21,-343485551),n=Dc(n,a),i=Dc(i,c),r=Dc(r,l),s=Dc(s,u)}return[n,i,r,s]}function kW(t){if(t.length===0)return[];const e=t.length*8,n=new Uint32Array(cU(e));for(let i=0;i<e;i+=8)n[i>>5]|=(t[i/8]&255)<<i%32;return n}function Dc(t,e){const n=(t&65535)+(e&65535);return(t>>16)+(e>>16)+(n>>16)<<16|n&65535}function LW(t,e){return t<<e|t>>>32-e}function BS(t,e,n,i,r,s){return Dc(LW(Dc(Dc(e,t),Dc(i,s)),r),n)}function Zi(t,e,n,i,r,s,o){return BS(e&n|~e&i,t,e,r,s,o)}function er(t,e,n,i,r,s,o){return BS(e&i|n&~i,t,e,r,s,o)}function tr(t,e,n,i,r,s,o){return BS(e^n^i,t,e,r,s,o)}function nr(t,e,n,i,r,s,o){return BS(n^(e|~i),t,e,r,s,o)}var DW=PW;US.default=DW;Object.defineProperty(zS,"__esModule",{value:!0});zS.default=void 0;var NW=lU(rl),OW=lU(US);function lU(t){return t&&t.__esModule?t:{default:t}}const FW=(0,NW.default)("v3",48,OW.default);var zW=FW;zS.default=zW;var $S={},HS={};Object.defineProperty(HS,"__esModule",{value:!0});HS.default=void 0;const UW=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var BW={randomUUID:UW};HS.default=BW;Object.defineProperty($S,"__esModule",{value:!0});$S.default=void 0;var SM=uU(HS),$W=uU(OS),HW=vl;function uU(t){return t&&t.__esModule?t:{default:t}}function VW(t,e,n){if(SM.default.randomUUID&&!e&&!t)return SM.default.randomUUID();t=t||{};const i=t.random||(t.rng||$W.default)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){n=n||0;for(let r=0;r<16;++r)e[n+r]=i[r];return e}return(0,HW.unsafeStringify)(i)}var jW=VW;$S.default=jW;var VS={},jS={};Object.defineProperty(jS,"__esModule",{value:!0});jS.default=void 0;function WW(t,e,n,i){switch(t){case 0:return e&n^~e&i;case 1:return e^n^i;case 2:return e&n^e&i^n&i;case 3:return e^n^i}}function I_(t,e){return t<<e|t>>>32-e}function GW(t){const e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){const o=unescape(encodeURIComponent(t));t=[];for(let a=0;a<o.length;++a)t.push(o.charCodeAt(a))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const i=t.length/4+2,r=Math.ceil(i/16),s=new Array(r);for(let o=0;o<r;++o){const a=new Uint32Array(16);for(let c=0;c<16;++c)a[c]=t[o*64+c*4]<<24|t[o*64+c*4+1]<<16|t[o*64+c*4+2]<<8|t[o*64+c*4+3];s[o]=a}s[r-1][14]=(t.length-1)*8/Math.pow(2,32),s[r-1][14]=Math.floor(s[r-1][14]),s[r-1][15]=(t.length-1)*8&4294967295;for(let o=0;o<r;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=s[o][p];for(let p=16;p<80;++p)a[p]=I_(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let c=n[0],l=n[1],u=n[2],h=n[3],d=n[4];for(let p=0;p<80;++p){const f=Math.floor(p/20),v=I_(c,5)+WW(f,l,u,h)+d+e[f]+a[p]>>>0;d=h,h=u,u=I_(l,30)>>>0,l=c,c=v}n[0]=n[0]+c>>>0,n[1]=n[1]+l>>>0,n[2]=n[2]+u>>>0,n[3]=n[3]+h>>>0,n[4]=n[4]+d>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var qW=GW;jS.default=qW;Object.defineProperty(VS,"__esModule",{value:!0});VS.default=void 0;var XW=hU(rl),KW=hU(jS);function hU(t){return t&&t.__esModule?t:{default:t}}const YW=(0,XW.default)("v5",80,KW.default);var JW=YW;VS.default=JW;var WS={};Object.defineProperty(WS,"__esModule",{value:!0});WS.default=void 0;var QW="00000000-0000-0000-0000-000000000000";WS.default=QW;var GS={};Object.defineProperty(GS,"__esModule",{value:!0});GS.default=void 0;var ZW=eG(qu);function eG(t){return t&&t.__esModule?t:{default:t}}function tG(t){if(!(0,ZW.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}var nG=tG;GS.default=nG;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return o.default}});var e=u(NS),n=u(zS),i=u($S),r=u(VS),s=u(WS),o=u(GS),a=u(qu),c=u(vl),l=u(_0);function u(h){return h&&h.__esModule?h:{default:h}}})(rU);Object.defineProperty(Ys,"__esModule",{value:!0});Ys.createNoDashGuid=Ys.createGuid=void 0;const iG=rU,dU=()=>iG.v4();Ys.createGuid=dU;const rG=()=>dU().replace(new RegExp("-","g"),"").toUpperCase();Ys.createNoDashGuid=rG;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformEvent=t.EventType=void 0;const e=Ys;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warning=2]="Warning",i[i.Error=3]="Error",i[i.None=4]="None"})(t.EventType||(t.EventType={}));class n{constructor(r,s){this.privName=r,this.privEventId=e.createNoDashGuid(),this.privEventTime=new Date().toISOString(),this.privEventType=s,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}t.PlatformEvent=n})(rp);Object.defineProperty(qn,"__esModule",{value:!0});qn.AudioStreamNodeErrorEvent=qn.AudioStreamNodeDetachedEvent=qn.AudioStreamNodeAttachedEvent=qn.AudioStreamNodeAttachingEvent=qn.AudioStreamNodeEvent=qn.AudioSourceErrorEvent=qn.AudioSourceOffEvent=qn.AudioSourceReadyEvent=qn.AudioSourceInitializingEvent=qn.AudioSourceEvent=void 0;const hR=rp;class sp extends hR.PlatformEvent{constructor(e,n,i=hR.EventType.Info){super(e,i),this.privAudioSourceId=n}get audioSourceId(){return this.privAudioSourceId}}qn.AudioSourceEvent=sp;class sG extends sp{constructor(e){super("AudioSourceInitializingEvent",e)}}qn.AudioSourceInitializingEvent=sG;class oG extends sp{constructor(e){super("AudioSourceReadyEvent",e)}}qn.AudioSourceReadyEvent=oG;class aG extends sp{constructor(e){super("AudioSourceOffEvent",e)}}qn.AudioSourceOffEvent=aG;class cG extends sp{constructor(e,n){super("AudioSourceErrorEvent",e,hR.EventType.Error),this.privError=n}get error(){return this.privError}}qn.AudioSourceErrorEvent=cG;class w0 extends sp{constructor(e,n,i){super(e,n),this.privAudioNodeId=i}get audioNodeId(){return this.privAudioNodeId}}qn.AudioStreamNodeEvent=w0;class lG extends w0{constructor(e,n){super("AudioStreamNodeAttachingEvent",e,n)}}qn.AudioStreamNodeAttachingEvent=lG;class uG extends w0{constructor(e,n){super("AudioStreamNodeAttachedEvent",e,n)}}qn.AudioStreamNodeAttachedEvent=uG;class hG extends w0{constructor(e,n){super("AudioStreamNodeDetachedEvent",e,n)}}qn.AudioStreamNodeDetachedEvent=hG;class dG extends w0{constructor(e,n,i){super("AudioStreamNodeErrorEvent",e,n),this.privError=i}get error(){return this.privError}}qn.AudioStreamNodeErrorEvent=dG;var li={};Object.defineProperty(li,"__esModule",{value:!0});li.ConnectionMessageSentEvent=li.ConnectionMessageReceivedEvent=li.ConnectionEstablishErrorEvent=li.ConnectionErrorEvent=li.ConnectionClosedEvent=li.ConnectionEstablishedEvent=li.ConnectionStartEvent=li.ConnectionEvent=li.ServiceEvent=void 0;const Au=rp;class pG extends Au.PlatformEvent{constructor(e,n,i=Au.EventType.Info){super(e,i),this.privJsonResult=n}get jsonString(){return this.privJsonResult}}li.ServiceEvent=pG;class yl extends Au.PlatformEvent{constructor(e,n,i=Au.EventType.Info){super(e,i),this.privConnectionId=n}get connectionId(){return this.privConnectionId}}li.ConnectionEvent=yl;class fG extends yl{constructor(e,n,i){super("ConnectionStartEvent",e),this.privUri=n,this.privHeaders=i}get uri(){return this.privUri}get headers(){return this.privHeaders}}li.ConnectionStartEvent=fG;class mG extends yl{constructor(e){super("ConnectionEstablishedEvent",e)}}li.ConnectionEstablishedEvent=mG;class gG extends yl{constructor(e,n,i){super("ConnectionClosedEvent",e,Au.EventType.Debug),this.privReason=i,this.privStatusCode=n}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}li.ConnectionClosedEvent=gG;class vG extends yl{constructor(e,n,i){super("ConnectionErrorEvent",e,Au.EventType.Debug),this.privMessage=n,this.privType=i}get message(){return this.privMessage}get type(){return this.privType}}li.ConnectionErrorEvent=vG;class yG extends yl{constructor(e,n,i){super("ConnectionEstablishErrorEvent",e,Au.EventType.Error),this.privStatusCode=n,this.privReason=i}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}li.ConnectionEstablishErrorEvent=yG;class SG extends yl{constructor(e,n,i){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=n,this.privMessage=i}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}li.ConnectionMessageReceivedEvent=SG;class xG extends yl{constructor(e,n,i){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=n,this.privMessage=i}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}li.ConnectionMessageSentEvent=xG;var u2={},Wi={};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.ObjectDisposedError=Wi.InvalidOperationError=Wi.ArgumentNullError=void 0;class CG extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}}Wi.ArgumentNullError=CG;class _G extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}}Wi.InvalidOperationError=_G;class wG extends Error{constructor(e,n){super(n),this.name=e+"ObjectDisposed",this.message=n}}Wi.ObjectDisposedError=wG;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionMessage=t.MessageType=void 0;const e=Wi,n=Ys;var i;(function(s){s[s.Text=0]="Text",s[s.Binary=1]="Binary"})(i=t.MessageType||(t.MessageType={}));class r{constructor(o,a,c,l){if(this.privBody=null,o===i.Text&&a&&typeof a!="string")throw new e.InvalidOperationError("Payload must be a string");if(o===i.Binary&&a&&!(a instanceof ArrayBuffer))throw new e.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=o,this.privBody=a,this.privHeaders=c||{},this.privId=l||n.createNoDashGuid(),this.messageType){case i.Binary:this.privSize=this.binaryBody!==null?this.binaryBody.byteLength:0;break;case i.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===i.Binary)throw new e.InvalidOperationError("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===i.Text)throw new e.InvalidOperationError("Not supported for text message");return this.privBody}get id(){return this.privId}}t.ConnectionMessage=r})(u2);var qS={};Object.defineProperty(qS,"__esModule",{value:!0});qS.ConnectionOpenResponse=void 0;class EG{constructor(e,n){this.privStatusCode=e,this.privReason=n}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}qS.ConnectionOpenResponse=EG;var XS={};Object.defineProperty(XS,"__esModule",{value:!0});XS.DeferralMap=void 0;class RG{constructor(){this.privMap={}}add(e,n){this.privMap[e]=n}getId(e){return this.privMap[e]}complete(e,n){try{this.privMap[e].resolve(n)}catch(i){this.privMap[e].reject(i)}finally{this.privMap[e]=void 0}}}XS.DeferralMap=RG;var Pu={};Object.defineProperty(Pu,"__esModule",{value:!0});Pu.SendingAgentContextMessageEvent=Pu.DialogEvent=void 0;const xM=rp;class pU extends xM.PlatformEvent{constructor(e,n=xM.EventType.Info){super(e,n)}}Pu.DialogEvent=pU;class bG extends pU{constructor(e){super("SendingAgentContextMessageEvent"),this.privAgentConfig=e}get agentConfig(){return this.privAgentConfig}}Pu.SendingAgentContextMessageEvent=bG;var KS={},E0={};Object.defineProperty(E0,"__esModule",{value:!0});E0.EventSource=void 0;const TG=Wi,AG=Ys;class PG{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new TG.ObjectDisposedError("EventSource");if(this.metadata)for(const n in this.metadata)n&&e.metadata&&(e.metadata[n]||(e.metadata[n]=this.metadata[n]));for(const n in this.privEventListeners)n&&this.privEventListeners[n]&&this.privEventListeners[n](e)}attach(e){const n=AG.createNoDashGuid();return this.privEventListeners[n]=e,{detach:()=>(delete this.privEventListeners[n],Promise.resolve())}}attachListener(e){return this.attach(n=>e.onEvent(n))}attachConsoleListener(e){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(n=>e.onEvent(n)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}}E0.EventSource=PG;Object.defineProperty(KS,"__esModule",{value:!0});KS.Events=void 0;const IG=Wi,MG=E0;class Gg{static setEventSource(e){if(!e)throw new IG.ArgumentNullError("eventSource");Gg.privInstance=e}static get instance(){return Gg.privInstance}}KS.Events=Gg;Gg.privInstance=new MG.EventSource;var fU={};Object.defineProperty(fU,"__esModule",{value:!0});var mU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionState=void 0,function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected"}(t.ConnectionState||(t.ConnectionState={}))})(mU);var gU={};Object.defineProperty(gU,"__esModule",{value:!0});var vU={};Object.defineProperty(vU,"__esModule",{value:!0});var yU={};Object.defineProperty(yU,"__esModule",{value:!0});var SU={};Object.defineProperty(SU,"__esModule",{value:!0});var xU={};Object.defineProperty(xU,"__esModule",{value:!0});var CU={};Object.defineProperty(CU,"__esModule",{value:!0});var _U={};Object.defineProperty(_U,"__esModule",{value:!0});var wU={};Object.defineProperty(wU,"__esModule",{value:!0});var R0={};Object.defineProperty(R0,"__esModule",{value:!0});R0.List=void 0;const kG=Wi;class _c{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(const n of e)this.privList.push(n)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,n){this.throwIfDisposed(),e===0?this.privList.unshift(n):e===this.privList.length?this.privList.push(n):this.privList.splice(e,0,n),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,n){this.throwIfDisposed();const i=this.privList.splice(e,n);return this.triggerSubscriptions(this.privRemoveSubscriptions),i}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[n]=e,{detach:()=>(delete this.privAddSubscriptions[n],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[n]=e,{detach:()=>(delete this.privRemoveSubscriptions[n],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[n]=e,{detach:()=>(delete this.privDisposedSubscriptions[n],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){const e=Array();return this.privList.forEach(n=>{e.push(n)}),e}any(e){return this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(e){this.throwIfDisposed();for(let n=0;n<this.length();n++)e(this.privList[n],n)}select(e){this.throwIfDisposed();const n=[];for(let i=0;i<this.privList.length;i++)n.push(e(this.privList[i],i));return new _c(n)}where(e){this.throwIfDisposed();const n=new _c;for(let i=0;i<this.privList.length;i++)e(this.privList[i],i)&&n.add(this.privList[i]);return n}orderBy(e){this.throwIfDisposed();const i=this.toArray().sort(e);return new _c(i)}orderByDesc(e){return this.throwIfDisposed(),this.orderBy((n,i)=>e(i,n))}clone(){return this.throwIfDisposed(),new _c(this.toArray())}concat(e){return this.throwIfDisposed(),new _c(this.privList.concat(e.toArray()))}concatArray(e){return this.throwIfDisposed(),new _c(this.privList.concat(e))}isDisposed(){return this.privList==null}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new kG.ObjectDisposedError("List",this.privDisposeReason)}triggerSubscriptions(e){if(e)for(const n in e)n&&e[n]()}}R0.List=_c;var h2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.marshalPromiseToCallbacks=t.Sink=t.Deferred=t.PromiseResultEventSource=t.PromiseResult=t.PromiseState=void 0;var e;(function(a){a[a.None=0]="None",a[a.Resolved=1]="Resolved",a[a.Rejected=2]="Rejected"})(e=t.PromiseState||(t.PromiseState={}));class n{constructor(c){this.throwIfError=()=>{if(this.isError)throw this.error},c.on(l=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=l)},l=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=l)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}}t.PromiseResult=n;class i{constructor(){this.setResult=c=>{this.privOnSetResult(c)},this.setError=c=>{this.privOnSetError(c)},this.on=(c,l)=>{this.privOnSetResult=c,this.privOnSetError=l}}}t.PromiseResultEventSource=i;class r{constructor(){this.resolve=c=>(this.privResolve(c),this),this.reject=c=>(this.privReject(c),this),this.privPromise=new Promise((c,l)=>{this.privResolve=c,this.privReject=l})}get promise(){return this.privPromise}}t.Deferred=r;class s{constructor(){this.privState=e.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new i,this.privPromiseResult=new n(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(c){if(this.privState!==e.None)throw new Error("'Cannot resolve a completed promise'");this.privState=e.Resolved,this.privPromiseResultEvents.setResult(c);for(let l=0;l<this.privSuccessHandlers.length;l++)this.executeSuccessCallback(c,this.privSuccessHandlers[l],this.privErrorHandlers[l]);this.detachHandlers()}reject(c){if(this.privState!==e.None)throw new Error("'Cannot reject a completed promise'");this.privState=e.Rejected,this.privPromiseResultEvents.setError(c);for(const l of this.privErrorHandlers)this.executeErrorCallback(c,l);this.detachHandlers()}on(c,l){c==null&&(c=()=>{}),this.privState===e.None?(this.privSuccessHandlers.push(c),this.privErrorHandlers.push(l)):(this.privState===e.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,c,l):this.privState===e.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,l),this.detachHandlers())}executeSuccessCallback(c,l,u){try{l(c)}catch(h){this.executeErrorCallback(`'Unhandled callback error: ${h}'`,u)}}executeErrorCallback(c,l){if(l)try{l(c)}catch(u){throw new Error(`'Unhandled callback error: ${u}. InnerError: ${c}'`)}else throw new Error(`'Unhandled error: ${c}'`)}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}}t.Sink=s;function o(a,c,l){a.then(u=>{try{c&&c(u)}catch(h){if(l)try{if(h instanceof Error){const d=h;l(d.name+": "+d.message)}else l(h)}catch{}}},u=>{if(l)try{if(u instanceof Error){const h=u;l(h.name+": "+h.message)}else l(u)}catch{}})}t.marshalPromiseToCallbacks=o})(h2);var b0={};Object.defineProperty(b0,"__esModule",{value:!0});b0.Queue=void 0;const M_=Wi,k_=R0,CM=h2;var yg;(function(t){t[t.Dequeue=0]="Dequeue",t[t.Peek=1]="Peek"})(yg||(yg={}));class LG{constructor(e){this.privPromiseStore=new k_.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new k_.List,this.privDetachables=[],this.privSubscribers=new k_.List,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(e){this.throwIfDispose(),this.enqueueFromPromise(new Promise(n=>n(e)))}enqueueFromPromise(e){this.throwIfDispose(),e.then(n=>{this.privList.add(n)},()=>{})}dequeue(){this.throwIfDispose();const e=new CM.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:yg.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();const e=new CM.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:yg.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return this.privSubscribers==null}async drainAndDispose(e,n){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=n,this.privIsDisposing=!0;const i=this.privSubscribers;if(i){for(;i.length()>0;)i.removeFirst().deferral.resolve(void 0);this.privSubscribers===i&&(this.privSubscribers=i)}for(const r of this.privDetachables)await r.detach();if(this.privPromiseStore.length()>0&&e){const r=[];return this.privPromiseStore.toArray().forEach(s=>{r.push(s)}),Promise.all(r).finally(()=>{this.privSubscribers=null,this.privList.forEach(s=>{e(s)}),this.privList=null}).then()}else this.privSubscribers=null,this.privList=null}}async dispose(e){await this.drainAndDispose(null,e)}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const e=this.privSubscribers,n=this.privList;if(e&&n){for(;n.length()>0&&e.length()>0&&!this.privIsDisposing;){const i=e.removeFirst();if(i.type===yg.Peek)i.deferral.resolve(n.first());else{const r=n.removeFirst();i.deferral.resolve(r)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===n&&(this.privList=n)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed())throw this.privDisposeReason?new M_.InvalidOperationError(this.privDisposeReason):new M_.ObjectDisposedError("Queue");if(this.privIsDisposing)throw new M_.InvalidOperationError("Queue disposing")}}b0.Queue=LG;var YS={};Object.defineProperty(YS,"__esModule",{value:!0});YS.RawWebsocketMessage=void 0;const Cv=u2,Vp=Wi,DG=Ys;class NG{constructor(e,n,i){if(this.privPayload=null,!n)throw new Vp.ArgumentNullError("payload");if(e===Cv.MessageType.Binary&&Object.getPrototypeOf(n).constructor.name!=="ArrayBuffer")throw new Vp.InvalidOperationError("Payload must be ArrayBuffer");if(e===Cv.MessageType.Text&&typeof n!="string")throw new Vp.InvalidOperationError("Payload must be a string");this.privMessageType=e,this.privPayload=n,this.privId=i||DG.createNoDashGuid()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===Cv.MessageType.Binary)throw new Vp.InvalidOperationError("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===Cv.MessageType.Text)throw new Vp.InvalidOperationError("Not supported for text message");return this.privPayload}get id(){return this.privId}}YS.RawWebsocketMessage=NG;var JS={};Object.defineProperty(JS,"__esModule",{value:!0});JS.RiffPcmEncoder=void 0;class OG{constructor(e,n){this.privActualSampleRate=e,this.privDesiredSampleRate=n}encode(e){const n=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!n)return null;const i=n.length*2,r=new ArrayBuffer(i),s=new DataView(r);return this.floatTo16BitPCM(s,0,n),r}setString(e,n,i){for(let r=0;r<i.length;r++)e.setUint8(n+r,i.charCodeAt(r))}floatTo16BitPCM(e,n,i){for(let r=0;r<i.length;r++,n+=2){const s=Math.max(-1,Math.min(1,i[r]));e.setInt16(n,s<0?s*32768:s*32767,!0)}}downSampleAudioFrame(e,n,i){if(!e)return null;if(i===n||i>n)return e;const r=n/i,s=Math.round(e.length/r),o=new Float32Array(s);let a=0,c=0;for(;c<s;){const l=Math.round((c+1)*r);let u=0,h=0;for(;a<l&&a<e.length;)u+=e[a++],h++;o[c++]=u/h}return o}}JS.RiffPcmEncoder=OG;var QS={};Object.defineProperty(QS,"__esModule",{value:!0});QS.Stream=void 0;const _M=Wi,FG=Ys,wM=b0;class zG{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||FG.createNoDashGuid(),this.privReaderQueue=new wM.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch{}}read(){if(this.privIsReadEnded)throw new _M.InvalidOperationError("Stream read has already finished");return this.privReaderQueue.dequeue().then(async e=>((e===void 0||e.isEnd)&&await this.privReaderQueue.dispose("End of stream reached"),e))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new wM.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new _M.InvalidOperationError("Stream closed")}}QS.Stream=zG;var ZS={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TranslationStatus=void 0,function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(t.TranslationStatus||(t.TranslationStatus={}))})(ZS);var jp={},EM;function UG(){if(EM)return jp;EM=1,Object.defineProperty(jp,"__esModule",{value:!0}),jp.ChunkedArrayBufferStream=void 0;const t=ht();let e=class extends t.Stream{constructor(i,r){super(r),this.privTargetChunkSize=i,this.privNextBufferReadyBytes=0}writeStreamChunk(i){if(i.isEnd||this.privNextBufferReadyBytes===0&&i.buffer.byteLength===this.privTargetChunkSize){super.writeStreamChunk(i);return}let r=0;for(;r<i.buffer.byteLength;){this.privNextBufferToWrite===void 0&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=i.timeReceived);const s=Math.min(i.buffer.byteLength-r,this.privTargetChunkSize-this.privNextBufferReadyBytes),o=new Uint8Array(this.privNextBufferToWrite),a=new Uint8Array(i.buffer.slice(r,s+r));o.set(a,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=s,r+=s,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){this.privNextBufferReadyBytes!==0&&!this.isClosed&&super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}};return jp.ChunkedArrayBufferStream=e,jp}var EU={};Object.defineProperty(EU,"__esModule",{value:!0});var ex={};Object.defineProperty(ex,"__esModule",{value:!0});ex.Timeout=void 0;class or{static load(){const e=new Map([[0,()=>{}]]),n=new Map,r="data:text/javascript;base64,"+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`),s=new Worker(r);return s.addEventListener("message",({data:c})=>{if(or.isCallNotification(c)){const{params:{timerId:l}}=c,u=e.get(l);if(typeof u=="number"){const h=n.get(u);if(h===void 0||h!==l)throw new Error("The timer is in an undefined state.")}else if(typeof u<"u")u(),e.delete(l);else throw new Error("The timer is in an undefined state.")}else if(or.isClearResponse(c)){const{id:l}=c,u=n.get(l);if(u===void 0)throw new Error("The timer is in an undefined state.");n.delete(l),e.delete(u)}else{const{error:{message:l}}=c;throw new Error(l)}}),{clearTimeout:c=>{const l=Math.random();n.set(l,c),e.set(c,l),s.postMessage({id:l,method:"clear",params:{timerId:c}})},setTimeout:(c,l)=>{const u=Math.random();return e.set(u,c),s.postMessage({id:null,method:"set",params:{delay:l,now:performance.now(),timerId:u}}),u}}}static loadWorkerTimers(){return()=>(or.workerTimers!==null||(or.workerTimers=or.load()),or.workerTimers)}static isCallNotification(e){return e.method!==void 0&&e.method==="call"}static isClearResponse(e){return e.error===null&&typeof e.id=="number"}}ex.Timeout=or;or.workerTimers=null;or.clearTimeout=t=>or.timers().clearTimeout(t);or.setTimeout=(t,e)=>or.timers().setTimeout(t,e);or.timers=or.loadWorkerTimers();var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.OCSPCacheUpdateErrorEvent=Bt.OCSPResponseRetrievedEvent=Bt.OCSPCacheFetchErrorEvent=Bt.OCSPVerificationFailedEvent=Bt.OCSPCacheHitEvent=Bt.OCSPCacheEntryNeedsRefreshEvent=Bt.OCSPCacheEntryExpiredEvent=Bt.OCSPWSUpgradeStartedEvent=Bt.OCSPStapleReceivedEvent=Bt.OCSPCacheUpdateCompleteEvent=Bt.OCSPDiskCacheStoreEvent=Bt.OCSPMemoryCacheStoreEvent=Bt.OCSPCacheUpdateNeededEvent=Bt.OCSPDiskCacheHitEvent=Bt.OCSPCacheMissEvent=Bt.OCSPMemoryCacheHitEvent=Bt.OCSPEvent=void 0;const Xi=rp;class Ki extends Xi.PlatformEvent{constructor(e,n,i){super(e,n),this.privSignature=i}}Bt.OCSPEvent=Ki;class BG extends Ki{constructor(e){super("OCSPMemoryCacheHitEvent",Xi.EventType.Debug,e)}}Bt.OCSPMemoryCacheHitEvent=BG;class $G extends Ki{constructor(e){super("OCSPCacheMissEvent",Xi.EventType.Debug,e)}}Bt.OCSPCacheMissEvent=$G;class HG extends Ki{constructor(e){super("OCSPDiskCacheHitEvent",Xi.EventType.Debug,e)}}Bt.OCSPDiskCacheHitEvent=HG;class VG extends Ki{constructor(e){super("OCSPCacheUpdateNeededEvent",Xi.EventType.Debug,e)}}Bt.OCSPCacheUpdateNeededEvent=VG;class jG extends Ki{constructor(e){super("OCSPMemoryCacheStoreEvent",Xi.EventType.Debug,e)}}Bt.OCSPMemoryCacheStoreEvent=jG;class WG extends Ki{constructor(e){super("OCSPDiskCacheStoreEvent",Xi.EventType.Debug,e)}}Bt.OCSPDiskCacheStoreEvent=WG;class GG extends Ki{constructor(e){super("OCSPCacheUpdateCompleteEvent",Xi.EventType.Debug,e)}}Bt.OCSPCacheUpdateCompleteEvent=GG;class qG extends Ki{constructor(){super("OCSPStapleReceivedEvent",Xi.EventType.Debug,"")}}Bt.OCSPStapleReceivedEvent=qG;class XG extends Ki{constructor(e){super("OCSPWSUpgradeStartedEvent",Xi.EventType.Debug,e)}}Bt.OCSPWSUpgradeStartedEvent=XG;class KG extends Ki{constructor(e,n){super("OCSPCacheEntryExpiredEvent",Xi.EventType.Debug,e),this.privExpireTime=n}}Bt.OCSPCacheEntryExpiredEvent=KG;class YG extends Ki{constructor(e,n,i){super("OCSPCacheEntryNeedsRefreshEvent",Xi.EventType.Debug,e),this.privExpireTime=i,this.privStartTime=n}}Bt.OCSPCacheEntryNeedsRefreshEvent=YG;class JG extends Ki{constructor(e,n,i){super("OCSPCacheHitEvent",Xi.EventType.Debug,e),this.privExpireTime=i,this.privExpireTimeString=new Date(i).toLocaleDateString(),this.privStartTime=n,this.privStartTimeString=new Date(n).toLocaleTimeString()}}Bt.OCSPCacheHitEvent=JG;class QG extends Ki{constructor(e,n){super("OCSPVerificationFailedEvent",Xi.EventType.Debug,e),this.privError=n}}Bt.OCSPVerificationFailedEvent=QG;class ZG extends Ki{constructor(e,n){super("OCSPCacheFetchErrorEvent",Xi.EventType.Debug,e),this.privError=n}}Bt.OCSPCacheFetchErrorEvent=ZG;class eq extends Ki{constructor(e){super("OCSPResponseRetrievedEvent",Xi.EventType.Debug,e)}}Bt.OCSPResponseRetrievedEvent=eq;class tq extends Ki{constructor(e,n){super("OCSPCacheUpdateErrorEvent",Xi.EventType.Debug,e),this.privError=n}}Bt.OCSPCacheUpdateErrorEvent=tq;var Wp={},RM;function nq(){if(RM)return Wp;RM=1,Object.defineProperty(Wp,"__esModule",{value:!0}),Wp.BackgroundEvent=void 0;const t=ht();class e extends t.PlatformEvent{constructor(i){super("BackgroundEvent",t.EventType.Error),this.privError=i}get error(){return this.privError}}return Wp.BackgroundEvent=e,Wp}var bM;function ht(){return bM||(bM=1,function(t){var e=It&&It.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o),Object.defineProperty(r,a,{enumerable:!0,get:function(){return s[o]}})}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=It&&It.__exportStar||function(r,s){for(var o in r)o!=="default"&&!s.hasOwnProperty(o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(qn,t),n(li,t),n(u2,t),n(qS,t),n(XS,t),n(Pu,t),n(Wi,t),n(KS,t),n(E0,t),n(Ys,t),n(fU,t),n(mU,t),n(gU,t),n(vU,t),n(yU,t),n(SU,t),n(xU,t),n(CU,t),n(_U,t),n(wU,t),n(R0,t),n(rp,t),n(h2,t),n(b0,t),n(YS,t),n(JS,t),n(QS,t);var i=ZS;Object.defineProperty(t,"TranslationStatus",{enumerable:!0,get:function(){return i.TranslationStatus}}),n(UG(),t),n(EU,t),n(ex,t),n(Bt,t),n(nq(),t)}(b_)),b_}var Fi={};Object.defineProperty(Fi,"__esModule",{value:!0});Fi.HeaderNames=void 0;class Lo{}Fi.HeaderNames=Lo;Lo.AuthKey="Ocp-Apim-Subscription-Key";Lo.Authorization="Authorization";Lo.SpIDAuthKey="Apim-Subscription-Id";Lo.ConnectionId="X-ConnectionId";Lo.ContentType="Content-Type";Lo.CustomCommandsAppId="X-CommandsAppId";Lo.Path="Path";Lo.RequestId="X-RequestId";Lo.RequestStreamId="X-StreamId";Lo.RequestTimestamp="X-Timestamp";var op={};Object.defineProperty(op,"__esModule",{value:!0});op.AuthInfo=void 0;class iq{constructor(e,n){this.privHeaderName=e,this.privToken=n}get headerName(){return this.privHeaderName}get token(){return this.privToken}}op.AuthInfo=iq;Object.defineProperty(DS,"__esModule",{value:!0});DS.CognitiveSubscriptionKeyAuthentication=void 0;const rq=ht(),sq=Fi,oq=op;class aq{constructor(e){if(!e)throw new rq.ArgumentNullError("subscriptionKey");this.privAuthInfo=new oq.AuthInfo(sq.HeaderNames.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}}DS.CognitiveSubscriptionKeyAuthentication=aq;var tx={};Object.defineProperty(tx,"__esModule",{value:!0});tx.CognitiveTokenAuthentication=void 0;const TM=ht(),AM=op,PM=Fi;class qg{constructor(e,n){if(!e)throw new TM.ArgumentNullError("fetchCallback");if(!n)throw new TM.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=n}fetch(e){return this.privFetchCallback(e).then(n=>new AM.AuthInfo(PM.HeaderNames.Authorization,n===void 0?void 0:qg.privTokenPrefix+n))}fetchOnExpiry(e){return this.privFetchOnExpiryCallback(e).then(n=>new AM.AuthInfo(PM.HeaderNames.Authorization,n===void 0?void 0:qg.privTokenPrefix+n))}}tx.CognitiveTokenAuthentication=qg;qg.privTokenPrefix="Bearer ";var RU={};Object.defineProperty(RU,"__esModule",{value:!0});var bU={};Object.defineProperty(bU,"__esModule",{value:!0});var Gp={},L_={},nx={};const cq={},lq=Object.freeze(Object.defineProperty({__proto__:null,default:cq},Symbol.toStringTag,{value:"Module"})),Xu=E7(lq);var d2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.LogLevel=void 0;const e=ht();Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return e.EventType}})})(d2);var _t={};Object.defineProperty(_t,"__esModule",{value:!0});_t.Contracts=void 0;class wc{static throwIfNullOrUndefined(e,n){if(e==null)throw new Error("throwIfNullOrUndefined:"+n)}static throwIfNull(e,n){if(e===null)throw new Error("throwIfNull:"+n)}static throwIfNullOrWhitespace(e,n){if(wc.throwIfNullOrUndefined(e,n),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+n)}static throwIfNullOrTooLong(e,n,i){if(wc.throwIfNullOrUndefined(e,n),(""+e).length>i)throw new Error("throwIfNullOrTooLong:"+n+" (more than "+i.toString()+" characters)")}static throwIfNullOrTooShort(e,n,i){if(wc.throwIfNullOrUndefined(e,n),(""+e).length<i)throw new Error("throwIfNullOrTooShort:"+n+" (less than "+i.toString()+" characters)")}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,n){if(wc.throwIfNullOrUndefined(e,n),e.length===0)throw new Error("throwIfArrayEmptyOrWhitespace:"+n);for(const i of e)wc.throwIfNullOrWhitespace(i,n)}static throwIfFileDoesNotExist(e,n){wc.throwIfNullOrWhitespace(e,n)}static throwIfNotUndefined(e,n){if(e!==void 0)throw new Error("throwIfNotUndefined:"+n)}}_t.Contracts=wc;var uq=It&&It.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),hq=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),dq=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.hasOwnProperty.call(t,n)&&uq(e,t,n);return hq(e,t),e};Object.defineProperty(nx,"__esModule",{value:!0});nx.ConsoleLoggingListener=void 0;const IM=dq(Xu),qp=d2,pq=_t;class fq{constructor(e=qp.LogLevel.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=e}set logPath(e){pq.Contracts.throwIfNullOrUndefined(IM.openSync,`
File System access not available`),this.privLogPath=e}set enableConsoleOutput(e){this.privEnableConsoleOutput=e}onEvent(e){if(e.eventType>=this.privLogLevelFilter){const n=this.toString(e);if(this.logCallback&&this.logCallback(n),this.privLogPath&&IM.writeFileSync(this.privLogPath,n+`
`,{flag:"a+"}),this.privEnableConsoleOutput)switch(e.eventType){case qp.LogLevel.Debug:console.debug(n);break;case qp.LogLevel.Info:console.info(n);break;case qp.LogLevel.Warning:console.warn(n);break;case qp.LogLevel.Error:console.error(n);break;default:console.log(n);break}}}toString(e){const n=[`${e.eventTime}`,`${e.name}`],i=e;for(const r in i)if(r&&e.hasOwnProperty(r)&&r!=="eventTime"&&r!=="eventType"&&r!=="eventId"&&r!=="name"&&r!=="constructor"){const s=i[r];let o="<NULL>";s!=null&&(typeof s=="number"||typeof s=="string"?o=s.toString():o=JSON.stringify(s)),n.push(`${r}: ${o}`)}return n.join(" | ")}}nx.ConsoleLoggingListener=fq;var TU={};Object.defineProperty(TU,"__esModule",{value:!0});var D_={},Sl={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioStreamFormatImpl=t.AudioStreamFormat=t.AudioFormatTag=void 0;var e;(function(r){r[r.PCM=1]="PCM",r[r.MuLaw=2]="MuLaw",r[r.Siren=3]="Siren",r[r.MP3=4]="MP3",r[r.SILKSkype=5]="SILKSkype",r[r.OGG_OPUS=6]="OGG_OPUS",r[r.WEBM_OPUS=7]="WEBM_OPUS",r[r.ALaw=8]="ALaw",r[r.FLAC=9]="FLAC",r[r.OPUS=10]="OPUS",r[r.AMR_WB=11]="AMR_WB",r[r.G722=12]="G722"})(e=t.AudioFormatTag||(t.AudioFormatTag={}));class n{static getDefaultInputFormat(){return i.getDefaultInputFormat()}static getWaveFormat(s,o,a,c){return new i(s,o,a,c)}static getWaveFormatPCM(s,o,a){return new i(s,o,a)}}t.AudioStreamFormat=n;class i extends n{constructor(s=16e3,o=16,a=1,c=e.PCM){super();let l=!0;switch(c){case e.PCM:this.formatTag=1;break;case e.ALaw:this.formatTag=6;break;case e.MuLaw:this.formatTag=7;break;default:l=!1}if(this.bitsPerSample=o,this.samplesPerSec=s,this.channels=a,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),l){this.privHeader=new ArrayBuffer(44);const u=new DataView(this.privHeader);this.setString(u,0,"RIFF"),u.setUint32(4,0,!0),this.setString(u,8,"WAVEfmt "),u.setUint32(16,16,!0),u.setUint16(20,this.formatTag,!0),u.setUint16(22,this.channels,!0),u.setUint32(24,this.samplesPerSec,!0),u.setUint32(28,this.avgBytesPerSec,!0),u.setUint16(32,this.channels*(this.bitsPerSample/8),!0),u.setUint16(34,this.bitsPerSample,!0),this.setString(u,36,"data"),u.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new i}static getAudioContext(s){const o=window.AudioContext||window.webkitAudioContext||!1;if(o)return s!==void 0&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new o({sampleRate:s}):new o;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(s,o,a){for(let c=0;c<a.length;c++)s.setUint8(o+c,a.charCodeAt(c))}}t.AudioStreamFormatImpl=i})(Sl);var MM;function mq(){return MM||(MM=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.MicAudioSource=t.AudioWorkletSourceURLPropertyName=void 0;const e=We(),n=ht(),i=Sl;t.AudioWorkletSourceURLPropertyName="MICROPHONE-WorkletSourceUrl";class r{constructor(o,a,c,l){this.privRecorder=o,this.deviceId=a,this.privStreams={},this.privOutputChunkSize=r.AUDIOFORMAT.avgBytesPerSec/10,this.privId=c||n.createNoDashGuid(),this.privEvents=new n.EventSource,this.privMediaStream=l||null,this.privIsClosing=!1}get format(){return Promise.resolve(r.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new n.Deferred;try{this.createAudioContext()}catch(c){if(c instanceof Error){const l=c;this.privInitializeDeferral.reject(l.name+": "+l.message)}else this.privInitializeDeferral.reject(c);return this.privInitializeDeferral.promise}const o=window.navigator;let a=o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia;if(o.mediaDevices&&(a=(c,l,u)=>{o.mediaDevices.getUserMedia(c).then(l).catch(u)}),a){const c=()=>{this.onEvent(new n.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):a({audio:this.deviceId?{deviceId:this.deviceId}:!0,video:!1},l=>{this.privMediaStream=l,this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()},l=>{const u=`Error occurred during microphone initialization: ${l}`;this.privInitializeDeferral.reject(u),this.onEvent(new n.AudioSourceErrorEvent(this.privId,u))})};this.privContext.state==="suspended"?this.privContext.resume().then(c).catch(l=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${l}`)}):c()}else{const c="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(c),this.onEvent(new n.AudioSourceErrorEvent(c,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(o){return this.onEvent(new n.AudioStreamNodeAttachingEvent(this.privId,o)),this.listen(o).then(a=>(this.onEvent(new n.AudioStreamNodeAttachedEvent(this.privId,o)),{detach:async()=>(a.readEnded(),delete this.privStreams[o],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,o)),this.turnOff()),id:()=>o,read:()=>a.read()}))}detach(o){o&&this.privStreams[o]&&(this.privStreams[o].close(),delete this.privStreams[o],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,o)))}async turnOff(){for(const o in this.privStreams)if(o){const a=this.privStreams[o];a&&a.close()}this.onEvent(new n.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&(await this.privInitializeDeferral,this.privInitializeDeferral=null),await this.destroyAudioContext()}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(o=>({bitspersample:r.AUDIOFORMAT.bitsPerSample,channelcount:r.AUDIOFORMAT.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:o,samplerate:r.AUDIOFORMAT.samplesPerSec,type:e.type.Microphones}))}setProperty(o,a){if(o===t.AudioWorkletSourceURLPropertyName)this.privRecorder.setWorkletUrl(a);else throw new Error("Property '"+o+"' is not supported on Microphone.")}getMicrophoneLabel(){const o="microphone";if(this.privMicrophoneLabel!==void 0)return Promise.resolve(this.privMicrophoneLabel);if(this.privMediaStream===void 0||!this.privMediaStream.active)return Promise.resolve(o);this.privMicrophoneLabel=o;const a=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(a===void 0)return Promise.resolve(this.privMicrophoneLabel);const c=new n.Deferred;return navigator.mediaDevices.enumerateDevices().then(l=>{for(const u of l)if(u.deviceId===a){this.privMicrophoneLabel=u.label;break}c.resolve(this.privMicrophoneLabel)},()=>c.resolve(this.privMicrophoneLabel)),c.promise}async listen(o){await this.turnOn();const a=new n.ChunkedArrayBufferStream(this.privOutputChunkSize,o);this.privStreams[o]=a;try{this.privRecorder.record(this.privContext,this.privMediaStream,a)}catch(l){throw this.onEvent(new n.AudioStreamNodeErrorEvent(this.privId,o,l)),l}return a}onEvent(o){this.privEvents.onEvent(o),n.Events.instance.onEvent(o)}createAudioContext(){this.privContext||(this.privContext=i.AudioStreamFormatImpl.getAudioContext(r.AUDIOFORMAT.samplesPerSec))}async destroyAudioContext(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let o=!1;"close"in this.privContext&&(o=!0),o?this.privIsClosing||(this.privIsClosing=!0,await this.privContext.close(),this.privContext=null,this.privIsClosing=!1):this.privContext!==null&&this.privContext.state==="running"&&await this.privContext.suspend()}}t.MicAudioSource=r,r.AUDIOFORMAT=i.AudioStreamFormat.getDefaultInputFormat()}(D_)),D_}var Xp={},kM;function gq(){if(kM)return Xp;kM=1,Object.defineProperty(Xp,"__esModule",{value:!0}),Xp.FileAudioSource=void 0;const t=We(),e=ht(),n=Sl;let i=class{constructor(s,o,a){this.privStreams={},this.privHeaderEnd=44,this.privId=a||e.createNoDashGuid(),this.privEvents=new e.EventSource,this.privSource=s,typeof window<"u"&&typeof Blob<"u"&&this.privSource instanceof Blob?this.privFilename=s.name:this.privFilename=o||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){const s=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new e.AudioSourceErrorEvent(s,"")),Promise.reject(s)}this.onEvent(new e.AudioSourceInitializingEvent(this.privId)),this.onEvent(new e.AudioSourceReadyEvent(this.privId))}id(){return this.privId}async attach(s){this.onEvent(new e.AudioStreamNodeAttachingEvent(this.privId,s));const o=await this.upload(s);return this.onEvent(new e.AudioStreamNodeAttachedEvent(this.privId,s)),Promise.resolve({detach:async()=>{o.readEnded(),delete this.privStreams[s],this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,s)),await this.turnOff()},id:()=>s,read:()=>o.read()})}detach(s){s&&this.privStreams[s]&&(this.privStreams[s].close(),delete this.privStreams[s],this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,s)))}turnOff(){for(const s in this.privStreams)if(s){const o=this.privStreams[s];o&&!o.isClosed&&o.close()}return this.onEvent(new e.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(s=>Promise.resolve({bitspersample:s.bitsPerSample,channelcount:s.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:s.samplesPerSec,type:t.type.File}))}readHeader(){const o=this.privSource.slice(0,4296),a=new e.Deferred,c=l=>{const u=new DataView(l),h=m=>String.fromCharCode(u.getUint8(m),u.getUint8(m+1),u.getUint8(m+2),u.getUint8(m+3));if(h(0)!=="RIFF"){a.reject("Invalid WAV header in file, RIFF was not found");return}if(h(8)!=="WAVE"||h(12)!=="fmt "){a.reject("Invalid WAV header in file, WAVEfmt was not found");return}const d=u.getInt32(16,!0),p=u.getUint16(22,!0),f=u.getUint32(24,!0),v=u.getUint16(34,!0);let g=36+Math.max(d-16,0);for(;h(g)!=="data";g+=2)if(g>4288){a.reject("Invalid WAV header in file, data block was not found");return}this.privHeaderEnd=g+8,a.resolve(n.AudioStreamFormat.getWaveFormatPCM(f,v,p))};if(typeof window<"u"&&typeof Blob<"u"&&o instanceof Blob){const l=new FileReader;l.onload=u=>{const h=u.target.result;c(h)},l.readAsArrayBuffer(o)}else{const l=o;c(l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength))}return a.promise}async upload(s){const o=a=>{const c=`Error occurred while processing '${this.privFilename}'. ${a}`;throw this.onEvent(new e.AudioStreamNodeErrorEvent(this.privId,s,c)),new Error(c)};try{await this.turnOn();const a=await this.privAudioFormatPromise,c=new e.ChunkedArrayBufferStream(a.avgBytesPerSec/10,s);this.privStreams[s]=c;const l=this.privSource.slice(this.privHeaderEnd),u=h=>{c.isClosed||(c.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()}),c.close())};if(typeof window<"u"&&typeof Blob<"u"&&l instanceof Blob){const h=new FileReader;h.onerror=d=>o(d.toString()),h.onload=d=>{const p=d.target.result;u(p)},h.readAsArrayBuffer(l)}else{const h=l;u(h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength))}return c}catch(a){o(a)}}onEvent(s){this.privEvents.onEvent(s),e.Events.instance.onEvent(s)}};return Xp.FileAudioSource=i,Xp}var ix={};Object.defineProperty(ix,"__esModule",{value:!0});ix.PcmRecorder=void 0;const vq=ht();class yq{constructor(e){this.privStopInputOnRelease=e}record(e,n,i){const s=new vq.RiffPcmEncoder(e.sampleRate,16e3),o=e.createMediaStreamSource(n),a=()=>{const l=(()=>{let u=0;try{return e.createScriptProcessor(u,1,1)}catch{u=2048;let d=e.sampleRate;for(;u<16384&&d>=32e3;)u<<=1,d>>=1;return e.createScriptProcessor(u,1,1)}})();l.onaudioprocess=u=>{const h=u.inputBuffer.getChannelData(0);if(i&&!i.isClosed){const d=s.encode(h);d&&i.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()})}},o.connect(l),l.connect(e.destination),this.privMediaResources={scriptProcessorNode:l,source:o,stream:n}},c=!!this.privSpeechProcessorScript&&this.privSpeechProcessorScript.toLowerCase()==="ignore";if(e.audioWorklet&&!c){if(!this.privSpeechProcessorScript){const l=`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`,u=new Blob([l],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(u)}e.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{const l=new AudioWorkletNode(e,"speech-processor");l.port.onmessage=u=>{const h=u.data;if(i&&!i.isClosed){const d=s.encode(h);d&&i.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()})}},o.connect(l),l.connect(e.destination),this.privMediaResources={scriptProcessorNode:l,source:o,stream:n}}).catch(()=>{a()})}else try{a()}catch(l){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${l}`)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(n=>n.stop()),this.privMediaResources.source=null))}setWorkletUrl(e){this.privSpeechProcessorScript=e}}ix.PcmRecorder=yq;var rx={},T0={},Sq=It&&It.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),xq=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),AU=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.hasOwnProperty.call(t,n)&&Sq(e,t,n);return xq(e,t),e},p2=It&&It.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(T0,"__esModule",{value:!0});T0.WebsocketMessageAdapter=void 0;const Cq=AU(Xu),_q=AU(Xu),wq=p2(Xu),Eq=p2(Xu),Rq=p2(Xu),bq=Fi,Et=ht();class Xg{constructor(e,n,i,r,s,o){if(!e)throw new Et.ArgumentNullError("uri");if(!i)throw new Et.ArgumentNullError("messageFormatter");this.proxyInfo=r,this.privConnectionEvents=new Et.EventSource,this.privConnectionId=n,this.privMessageFormatter=i,this.privConnectionState=Et.ConnectionState.None,this.privUri=e,this.privHeaders=s,this.privEnableCompression=o,this.privHeaders[bq.HeaderNames.ConnectionId]=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===Et.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new Et.Deferred,this.privCertificateValidatedDeferral=new Et.Deferred,this.privConnectionState=Et.ConnectionState.Connecting;try{if(typeof WebSocket<"u"&&!Xg.forceNpmWebSocket)this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);else{const e={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression};this.privCertificateValidatedDeferral.resolve(),e.agent=this.getAgent();let i=new URL(this.privUri).protocol;(i==null?void 0:i.toLocaleLowerCase())==="wss:"?i="https:":(i==null?void 0:i.toLocaleLowerCase())==="ws:"&&(i="http:"),e.agent.protocol=i,this.privWebsocketClient=new Rq.default(this.privUri,e)}this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new Et.Queue,this.privDisconnectDeferral=new Et.Deferred,this.privSendMessageQueue=new Et.Queue,this.processSendQueue().catch(e=>{Et.Events.instance.onEvent(new Et.BackgroundEvent(e))})}catch(e){return this.privConnectionEstablishDeferral.resolve(new Et.ConnectionOpenResponse(500,e)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new Et.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=Et.ConnectionState.Connected,this.onEvent(new Et.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new Et.ConnectionOpenResponse(200,""))},e=>{this.privConnectionEstablishDeferral.reject(e)})},this.privWebsocketClient.onerror=e=>{this.onEvent(new Et.ConnectionErrorEvent(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===Et.ConnectionState.Connecting?(this.privConnectionState=Et.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new Et.ConnectionOpenResponse(e.code,e.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=Et.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new Et.ConnectionClosedEvent(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch(n=>{Et.Events.instance.onEvent(new Et.BackgroundEvent(n))})},this.privWebsocketClient.onmessage=e=>{const n=new Date().toISOString();if(this.privConnectionState===Et.ConnectionState.Connected){const i=new Et.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(i.promise),e.data instanceof ArrayBuffer){const r=new Et.RawWebsocketMessage(Et.MessageType.Binary,e.data);this.privMessageFormatter.toConnectionMessage(r).then(s=>{this.onEvent(new Et.ConnectionMessageReceivedEvent(this.privConnectionId,n,s)),i.resolve(s)},s=>{i.reject(`Invalid binary message format. Error: ${s}`)})}else{const r=new Et.RawWebsocketMessage(Et.MessageType.Text,e.data);this.privMessageFormatter.toConnectionMessage(r).then(s=>{this.onEvent(new Et.ConnectionMessageReceivedEvent(this.privConnectionId,n,s)),i.resolve(s)},s=>{i.reject(`Invalid text message format. Error: ${s}`)})}}},this.privConnectionEstablishDeferral.promise}send(e){if(this.privConnectionState!==Et.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${Et.ConnectionState[this.privConnectionState]} state`);const n=new Et.Deferred,i=new Et.Deferred;return this.privSendMessageQueue.enqueueFromPromise(i.promise),this.privMessageFormatter.fromConnectionMessage(e).then(r=>{i.resolve({Message:e,RawWebsocketMessage:r,sendStatusDeferral:n})},r=>{i.reject(`Error formatting the message. ${r}`)}),n.promise}read(){return this.privConnectionState!==Et.ConnectionState.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(e){if(this.privWebsocketClient)this.privConnectionState!==Et.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client");else return Promise.resolve();return this.privDisconnectDeferral.promise}get events(){return this.privConnectionEvents}sendRawMessage(e){try{if(!e)return Promise.resolve();if(this.onEvent(new Et.ConnectionMessageSentEvent(this.privConnectionId,new Date().toISOString(),e.Message)),this.isWebsocketOpen)this.privWebsocketClient.send(e.RawWebsocketMessage.payload);else return Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+e.Message.id+" "+new Error().stack);return Promise.resolve()}catch(n){return Promise.reject(`websocket send error: ${n}`)}}async onClose(e,n){const i=`Connection closed. ${e}: ${n}`;this.privConnectionState=Et.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),await this.privReceivingMessageQueue.drainAndDispose(()=>{},i),await this.privSendMessageQueue.drainAndDispose(r=>{r.sendStatusDeferral.reject(i)},i)}async processSendQueue(){for(;;){const n=await this.privSendMessageQueue.dequeue();if(!n)return;try{await this.sendRawMessage(n),n.sendStatusDeferral.resolve()}catch(i){n.sendStatusDeferral.reject(i)}}}onEvent(e){this.privConnectionEvents.onEvent(e),Et.Events.instance.onEvent(e)}getAgent(){const e=new wq.default.Agent(this.createConnection);return this.proxyInfo!==void 0&&this.proxyInfo.HostName!==void 0&&this.proxyInfo.Port>0&&(e.proxyInfo=this.proxyInfo),e}static GetProxyAgent(e){const n={host:e.HostName,port:e.Port};return e.UserName?n.headers={"Proxy-Authentication":"Basic "+new Buffer(`${e.UserName}:${e.Password===void 0?"":e.Password}`).toString("base64")}:n.headers={},n.headers.requestOCSP="true",new Eq.default(n)}createConnection(e,n){let i;if(n={...n,requestOCSP:!0,servername:n.host},this.proxyInfo){const s=Xg.GetProxyAgent(this.proxyInfo);i=new Promise((o,a)=>{s.callback(e,n,(c,l)=>{c?a(c):o(l)})})}else n.secureEndpoint?i=Promise.resolve(_q.connect(n)):i=Promise.resolve(Cq.connect(n));return i}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}}T0.WebsocketMessageAdapter=Xg;Xg.forceNpmWebSocket=!1;Object.defineProperty(rx,"__esModule",{value:!0});rx.WebsocketConnection=void 0;const N_=ht(),Tq=T0;class Aq{constructor(e,n,i,r,s,o=!1,a){if(this.privIsDisposed=!1,!e)throw new N_.ArgumentNullError("uri");if(!r)throw new N_.ArgumentNullError("messageFormatter");this.privMessageFormatter=r;let c="",l=0;if(n){for(const u in n)if(u){c+=l===0&&e.indexOf("?")===-1?"?":"&";const h=encodeURIComponent(u);c+=h;let d=n[u];d&&(d=encodeURIComponent(d),c+=`=${d}`),l++}}if(i){for(const u in i)if(u){c+=l===0&&e.indexOf("?")===-1?"?":"&";const h=encodeURIComponent(i[u]);c+=`${u}=${h}`,l++}}this.privUri=e+c,this.privId=a||N_.createNoDashGuid(),this.privConnectionMessageAdapter=new Tq.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,s,i,o)}async dispose(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&await this.privConnectionMessageAdapter.close()}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}}rx.WebsocketConnection=Aq;var sx={};Object.defineProperty(sx,"__esModule",{value:!0});sx.ReplayableAudioNode=void 0;class Pq{constructor(e,n){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=n}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&this.privBuffers.length!==0){const e=this.privReplayOffset-this.privBufferStartOffset;let n=Math.round(e*this.privBytesPerSecond*1e-7);n%2!==0&&n++;let i=0;for(;i<this.privBuffers.length&&n>=this.privBuffers[i].chunk.buffer.byteLength;)n-=this.privBuffers[i++].chunk.buffer.byteLength;if(i<this.privBuffers.length){const r=this.privBuffers[i].chunk.buffer.slice(n);return this.privReplayOffset+=r.byteLength/this.privBytesPerSecond*1e7,i===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:r,isEnd:!1,timeReceived:this.privBuffers[i].chunk.timeReceived})}}return this.privAudioNode.read().then(e=>(e&&e.buffer&&(this.privBuffers.push(new Iq(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&this.privBuffers.length!==0&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(this.privBuffers===void 0||this.privBuffers.length===0)return;this.privLastShrinkOffset=e;const n=e-this.privBufferStartOffset;let i=Math.round(n*this.privBytesPerSecond*1e-7),r=0;for(;r<this.privBuffers.length&&i>=this.privBuffers[r].chunk.buffer.byteLength;)i-=this.privBuffers[r++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-i/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(r)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||this.privBuffers===void 0)return 0;for(const n of this.privBuffers){const i=n.byteOffset/this.privBytesPerSecond*1e7,r=i+n.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=i&&e<=r)return n.chunk.timeReceived}return 0}}sx.ReplayableAudioNode=Pq;class Iq{constructor(e,n,i){this.chunk=e,this.serial=n,this.byteOffset=i}}var Kp={},O_={},ya={},A0={},Mq=It&&It.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),kq=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Lq=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.hasOwnProperty.call(t,n)&&Mq(e,t,n);return kq(e,t),e};Object.defineProperty(A0,"__esModule",{value:!0});A0.AudioFileWriter=void 0;const Yp=Lq(Xu),F_=_t;class Dq{constructor(e){F_.Contracts.throwIfNullOrUndefined(Yp.openSync,`
File System access not available, please use Push or PullAudioOutputStream`),this.privFd=Yp.openSync(e,"w")}set format(e){F_.Contracts.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=e;let n=0;this.privAudioFormat.hasHeader&&(n=this.privAudioFormat.header.byteLength),this.privFd!==void 0&&(this.privWriteStream=Yp.createWriteStream("",{fd:this.privFd,start:n,autoClose:!1}))}write(e){F_.Contracts.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),this.privWriteStream!==void 0&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){this.privFd!==void 0&&(this.privWriteStream.on("finish",()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),Yp.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),Yp.closeSync(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}}A0.AudioFileWriter=Dq;var ns={},LM;function PU(){if(LM)return ns;LM=1,Object.defineProperty(ns,"__esModule",{value:!0}),ns.PullAudioInputStreamImpl=ns.PullAudioInputStream=ns.PushAudioInputStreamImpl=ns.PushAudioInputStream=ns.AudioInputStream=void 0;const t=We(),e=ht(),n=Ys,i=ye(),r=Sl;let s=class{constructor(){}static createPushStream(h){return o.create(h)}static createPullStream(h,d){return c.create(h,d)}};ns.AudioInputStream=s;class o extends s{static create(h){return new a(h)}}ns.PushAudioInputStream=o;class a extends o{constructor(h){super(),h===void 0?this.privFormat=r.AudioStreamFormatImpl.getDefaultInputFormat():this.privFormat=h,this.privEvents=new e.EventSource,this.privId=n.createNoDashGuid(),this.privStream=new e.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(h){this.privStream.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new e.AudioSourceInitializingEvent(this.privId)),this.onEvent(new e.AudioSourceReadyEvent(this.privId))}async attach(h){this.onEvent(new e.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn();const d=this.privStream;return this.onEvent(new e.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:async()=>(this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>d.read()}}detach(h){this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:t.type.Stream})}onEvent(h){this.privEvents.onEvent(h),e.Events.instance.onEvent(h)}toBuffer(h){const d=Buffer.alloc(h.byteLength),p=new Uint8Array(h);for(let f=0;f<d.length;++f)d[f]=p[f];return d}}ns.PushAudioInputStreamImpl=a;class c extends s{constructor(){super()}static create(h,d){return new l(h,d)}}ns.PullAudioInputStream=c;class l extends c{constructor(h,d){super(),d===void 0?this.privFormat=i.AudioStreamFormat.getDefaultInputFormat():this.privFormat=d,this.privEvents=new e.EventSource,this.privId=n.createNoDashGuid(),this.privCallback=h,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new e.AudioSourceInitializingEvent(this.privId)),this.onEvent(new e.AudioSourceReadyEvent(this.privId))}async attach(h){return this.onEvent(new e.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn(),this.onEvent(new e.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:()=>(this.privCallback.close(),this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>{let d=0,p;for(;d<this.privBufferSize;){const f=new ArrayBuffer(this.privBufferSize-d),v=this.privCallback.read(f);if(p===void 0?p=f:new Int8Array(p).set(new Int8Array(f),d),v===0)break;d+=v}return Promise.resolve({buffer:p.slice(0,d),isEnd:this.privIsClosed||d===0,timeReceived:Date.now()})}}}detach(h){this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:t.type.Stream})}onEvent(h){this.privEvents.onEvent(h),e.Events.instance.onEvent(h)}}return ns.PullAudioInputStreamImpl=l,ns}var Vi={},xl={},f2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechSynthesisOutputFormat=void 0,function(e){e[e.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",e[e.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",e[e.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",e[e.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",e[e.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",e[e.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",e[e.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",e[e.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",e[e.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",e[e.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",e[e.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",e[e.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",e[e.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",e[e.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",e[e.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",e[e.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",e[e.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",e[e.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",e[e.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",e[e.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",e[e.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",e[e.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",e[e.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",e[e.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",e[e.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",e[e.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",e[e.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",e[e.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",e[e.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",e[e.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",e[e.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",e[e.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",e[e.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",e[e.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",e[e.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",e[e.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",e[e.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm",e[e.AmrWb16000Hz=37]="AmrWb16000Hz",e[e.G72216Khz64Kbps=38]="G72216Khz64Kbps"}(t.SpeechSynthesisOutputFormat||(t.SpeechSynthesisOutputFormat={}))})(f2);Object.defineProperty(xl,"__esModule",{value:!0});xl.AudioOutputFormatImpl=void 0;const kt=f2,Rt=Sl;class yt extends Rt.AudioStreamFormatImpl{constructor(e,n,i,r,s,o,a,c,l){super(i,o,n,e),this.formatTag=e,this.avgBytesPerSec=r,this.blockAlign=s,this.priAudioFormatString=a,this.priRequestAudioFormatString=c,this.priHasHeader=l}static fromSpeechSynthesisOutputFormat(e){return e===void 0?yt.getDefaultOutputFormat():yt.fromSpeechSynthesisOutputFormatString(yt.SpeechSynthesisOutputFormatToString[e])}static fromSpeechSynthesisOutputFormatString(e){switch(e){case"raw-8khz-8bit-mono-mulaw":return new yt(Rt.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,e,!1);case"riff-16khz-16kbps-mono-siren":return new yt(Rt.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new yt(Rt.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,e,!1);case"audio-16khz-32kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,16e3,4096,2,16,e,e,!1);case"audio-16khz-128kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,16e3,16384,2,16,e,e,!1);case"audio-16khz-64kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,16e3,8192,2,16,e,e,!1);case"audio-24khz-48kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,24e3,6144,2,16,e,e,!1);case"audio-24khz-96kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,24e3,12288,2,16,e,e,!1);case"audio-24khz-160kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,24e3,20480,2,16,e,e,!1);case"raw-16khz-16bit-mono-truesilk":return new yt(Rt.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,e,e,!1);case"riff-8khz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new yt(Rt.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,16e3,32e3,2,16,e,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new yt(Rt.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,e,e,!1);case"ogg-24khz-16bit-mono-opus":return new yt(Rt.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,e,e,!1);case"raw-48khz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,48e3,12288,2,16,e,e,!1);case"audio-48khz-192kbitrate-mono-mp3":return new yt(Rt.AudioFormatTag.MP3,1,48e3,24576,2,16,e,e,!1);case"ogg-48khz-16bit-mono-opus":return new yt(Rt.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,e,e,!1);case"webm-16khz-16bit-mono-opus":return new yt(Rt.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,e,e,!1);case"webm-24khz-16bit-mono-opus":return new yt(Rt.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,e,e,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new yt(Rt.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new yt(Rt.AudioFormatTag.OPUS,1,16e3,4e3,2,16,e,e,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new yt(Rt.AudioFormatTag.OPUS,1,24e3,6e3,2,16,e,e,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new yt(Rt.AudioFormatTag.OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-24khz-16bit-mono-flac":return new yt(Rt.AudioFormatTag.FLAC,1,24e3,24e3,2,16,e,e,!1);case"audio-48khz-16bit-mono-flac":return new yt(Rt.AudioFormatTag.FLAC,1,48e3,3e4,2,16,e,e,!1);case"raw-24khz-16bit-mono-truesilk":return new yt(Rt.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,e,e,!1);case"raw-8khz-8bit-mono-alaw":return new yt(Rt.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,e,!1);case"riff-8khz-8bit-mono-alaw":return new yt(Rt.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,22050,44100,2,16,e,e,!1);case"riff-22050hz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,22050,44100,2,16,e,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,44100,88200,2,16,e,e,!1);case"riff-44100hz-16bit-mono-pcm":return new yt(Rt.AudioFormatTag.PCM,1,44100,88200,2,16,e,"raw-44100hz-16bit-mono-pcm",!0);case"amr-wb-16000h":return new yt(Rt.AudioFormatTag.AMR_WB,1,16e3,3052,2,16,e,e,!1);case"g722-16khz-64kbps":return new yt(Rt.AudioFormatTag.G722,1,16e3,8e3,2,16,e,e,!1);case"riff-16khz-16bit-mono-pcm":default:return new yt(Rt.AudioFormatTag.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return yt.fromSpeechSynthesisOutputFormatString(typeof window<"u"?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){if(this.priHasHeader){const n=new DataView(this.privHeader);n.setUint32(4,e+this.privHeader.byteLength-8,!0),n.setUint32(40,e,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(e){if(!this.hasHeader)return e;this.updateHeader(e.byteLength);const n=new Uint8Array(e.byteLength+this.header.byteLength);return n.set(new Uint8Array(this.header),0),n.set(new Uint8Array(e),this.header.byteLength),n.buffer}}xl.AudioOutputFormatImpl=yt;yt.SpeechSynthesisOutputFormatToString={[kt.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[kt.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[kt.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[kt.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[kt.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[kt.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[kt.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[kt.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[kt.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.AmrWb16000Hz]:"amr-wb-16000hz",[kt.SpeechSynthesisOutputFormat.G72216Khz64Kbps]:"g722-16khz-64kbps"};Object.defineProperty(Vi,"__esModule",{value:!0});Vi.PushAudioOutputStreamImpl=Vi.PushAudioOutputStream=Vi.PullAudioOutputStreamImpl=Vi.PullAudioOutputStream=Vi.AudioOutputStream=void 0;const dR=ht(),Nq=_t,Oq=xl;class m2{constructor(){}static createPullStream(){return g2.create()}}Vi.AudioOutputStream=m2;class g2 extends m2{static create(){return new IU}}Vi.PullAudioOutputStream=g2;class IU extends g2{constructor(){super(),this.privId=dR.createNoDashGuid(),this.privStream=new dR.Stream}set format(e){e==null&&(this.privFormat=Oq.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}async read(e){const n=new Int8Array(e);let i=0;if(this.privLastChunkView!==void 0){if(this.privLastChunkView.length>e.byteLength)return n.set(this.privLastChunkView.slice(0,e.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(e.byteLength),Promise.resolve(e.byteLength);n.set(this.privLastChunkView),i=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;i<e.byteLength&&!this.privStream.isReadEnded;){const r=await this.privStream.read();if(r!==void 0&&!r.isEnd){let s;r.buffer.byteLength>e.byteLength-i?(s=r.buffer.slice(0,e.byteLength-i),this.privLastChunkView=new Int8Array(r.buffer.slice(e.byteLength-i))):s=r.buffer,n.set(new Int8Array(s),i),i+=s.byteLength}else this.privStream.readEnded()}return i}write(e){Nq.Contracts.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}Vi.PullAudioOutputStreamImpl=IU;class MU extends m2{constructor(){super()}static create(e){return new kU(e)}}Vi.PushAudioOutputStream=MU;class kU extends MU{constructor(e){super(),this.privId=dR.createNoDashGuid(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}Vi.PushAudioOutputStreamImpl=kU;var DM;function DU(){if(DM)return ya;DM=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.AudioOutputConfigImpl=ya.AudioConfigImpl=ya.AudioConfig=void 0;const t=zi(),e=_t,n=ye(),i=A0,r=PU(),s=Vi;let o=class LU{static fromDefaultMicrophoneInput(){const u=new t.PcmRecorder(!0);return new a(new t.MicAudioSource(u))}static fromMicrophoneInput(u){const h=new t.PcmRecorder(!0);return new a(new t.MicAudioSource(h,u))}static fromWavFileInput(u,h="unnamedBuffer.wav"){return new a(new t.FileAudioSource(u,h))}static fromStreamInput(u){if(u instanceof n.PullAudioInputStreamCallback)return new a(new r.PullAudioInputStreamImpl(u));if(u instanceof n.AudioInputStream)return new a(u);if(typeof MediaStream<"u"&&u instanceof MediaStream){const h=new t.PcmRecorder(!1);return new a(new t.MicAudioSource(h,null,null,u))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new c(new n.SpeakerAudioDestination)}static fromSpeakerOutput(u){if(u===void 0)return LU.fromDefaultSpeakerOutput();if(u instanceof n.SpeakerAudioDestination)return new c(u);throw new Error("Not Supported Type")}static fromAudioFileOutput(u){return new c(new i.AudioFileWriter(u))}static fromStreamOutput(u){if(u instanceof n.PushAudioOutputStreamCallback)return new c(new s.PushAudioOutputStreamImpl(u));if(u instanceof n.PushAudioOutputStream)return new c(u);if(u instanceof n.PullAudioOutputStream)return new c(u);throw new Error("Not Supported Type")}};ya.AudioConfig=o;class a extends o{constructor(u){super(),this.privSource=u}get format(){return this.privSource.format}close(u,h){this.privSource.turnOff().then(()=>{u&&u()},d=>{h&&h(d)})}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(u){return this.privSource.attach(u)}detach(u){return this.privSource.detach(u)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(u,h){if(e.Contracts.throwIfNull(h,"value"),this.privSource.setProperty!==void 0)this.privSource.setProperty(u,h);else throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(u,h){if(this.privSource.getProperty!==void 0)return this.privSource.getProperty(u,h);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}ya.AudioConfigImpl=a;class c extends o{constructor(u){super(),this.privDestination=u}set format(u){this.privDestination.format=u}write(u){this.privDestination.write(u)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}return ya.AudioOutputConfigImpl=c,ya}var NU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationReason=void 0,function(e){e[e.Error=0]="Error",e[e.EndOfStream=1]="EndOfStream"}(t.CancellationReason||(t.CancellationReason={}))})(NU);var ox={};Object.defineProperty(ox,"__esModule",{value:!0});ox.PullAudioInputStreamCallback=void 0;class Fq{}ox.PullAudioInputStreamCallback=Fq;var ax={};Object.defineProperty(ax,"__esModule",{value:!0});ax.PushAudioOutputStreamCallback=void 0;class zq{}ax.PushAudioOutputStreamCallback=zq;var cx={};Object.defineProperty(cx,"__esModule",{value:!0});cx.KeywordRecognitionModel=void 0;const NM=_t;class Uq{constructor(){this.privDisposed=!1}static fromFile(e){throw NM.Contracts.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")}static fromStream(e){throw NM.Contracts.throwIfNull(e,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}}cx.KeywordRecognitionModel=Uq;var lx={};Object.defineProperty(lx,"__esModule",{value:!0});lx.SessionEventArgs=void 0;class Bq{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}lx.SessionEventArgs=Bq;var Jp={},OM;function $q(){if(OM)return Jp;OM=1,Object.defineProperty(Jp,"__esModule",{value:!0}),Jp.RecognitionEventArgs=void 0;const t=ye();let e=class extends t.SessionEventArgs{constructor(i,r){super(r),this.privOffset=i}get offset(){return this.privOffset}};return Jp.RecognitionEventArgs=e,Jp}var OU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.OutputFormat=void 0,function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(t.OutputFormat||(t.OutputFormat={}))})(OU);var Qp={},FM;function Hq(){if(FM)return Qp;FM=1,Object.defineProperty(Qp,"__esModule",{value:!0}),Qp.IntentRecognitionEventArgs=void 0;const t=ye();let e=class extends t.RecognitionEventArgs{constructor(i,r,s){super(r,s),this.privResult=i}get result(){return this.privResult}};return Qp.IntentRecognitionEventArgs=e,Qp}var ux={};Object.defineProperty(ux,"__esModule",{value:!0});ux.RecognitionResult=void 0;class Vq{constructor(e,n,i,r,s,o,a,c,l,u){this.privResultId=e,this.privReason=n,this.privText=i,this.privDuration=r,this.privOffset=s,this.privLanguage=o,this.privLanguageDetectionConfidence=a,this.privErrorDetails=c,this.privJson=l,this.privProperties=u}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}ux.RecognitionResult=Vq;var Zp={},zM;function jq(){if(zM)return Zp;zM=1,Object.defineProperty(Zp,"__esModule",{value:!0}),Zp.SpeechRecognitionResult=void 0;const t=ye();let e=class extends t.RecognitionResult{constructor(i,r,s,o,a,c,l,u,h,d,p){super(i,r,s,o,a,c,l,h,d,p),this.privSpeakerId=u}get speakerId(){return this.privSpeakerId}};return Zp.SpeechRecognitionResult=e,Zp}var ef={},UM;function Wq(){if(UM)return ef;UM=1,Object.defineProperty(ef,"__esModule",{value:!0}),ef.IntentRecognitionResult=void 0;const t=ye();let e=class extends t.SpeechRecognitionResult{constructor(i,r,s,o,a,c,l,u,h,d,p){super(r,s,o,a,c,l,u,void 0,h,d,p),this.privIntentId=i}get intentId(){return this.privIntentId}};return ef.IntentRecognitionResult=e,ef}var Ad={};Object.defineProperty(Ad,"__esModule",{value:!0});Ad.LanguageUnderstandingModelImpl=Ad.LanguageUnderstandingModel=void 0;const lh=_t;class FU{constructor(){}static fromEndpoint(e){lh.Contracts.throwIfNull(e,"uri"),lh.Contracts.throwIfNullOrWhitespace(e.hostname,"uri");const n=new Iy,i=e.host.indexOf(".");if(i===-1)throw new Error("Could not determine region from endpoint");n.region=e.host.substr(0,i);const r=e.pathname.lastIndexOf("/")+1;if(r===-1)throw new Error("Could not determine appId from endpoint");if(n.appId=e.pathname.substr(r),n.subscriptionKey=e.searchParams.get("subscription-key"),n.subscriptionKey===void 0)throw new Error("Could not determine subscription key from endpoint");return n}static fromAppId(e){lh.Contracts.throwIfNullOrWhitespace(e,"appId");const n=new Iy;return n.appId=e,n}static fromSubscription(e,n,i){lh.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),lh.Contracts.throwIfNullOrWhitespace(n,"appId"),lh.Contracts.throwIfNullOrWhitespace(i,"region");const r=new Iy;return r.appId=n,r.region=i,r.subscriptionKey=e,r}}Ad.LanguageUnderstandingModel=FU;class Iy extends FU{}Ad.LanguageUnderstandingModelImpl=Iy;var Sa={},BM;function Gq(){if(BM)return Sa;BM=1,Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.MeetingTranscriptionEventArgs=Sa.ConversationTranscriptionEventArgs=Sa.SpeechRecognitionEventArgs=void 0;const t=ye();let e=class extends t.RecognitionEventArgs{constructor(s,o,a){super(o,a),this.privResult=s}get result(){return this.privResult}};Sa.SpeechRecognitionEventArgs=e;class n extends t.RecognitionEventArgs{constructor(s,o,a){super(o,a),this.privResult=s}get result(){return this.privResult}}Sa.ConversationTranscriptionEventArgs=n;class i extends e{}return Sa.MeetingTranscriptionEventArgs=i,Sa}var tf={},nf={},$M;function P0(){if($M)return nf;$M=1,Object.defineProperty(nf,"__esModule",{value:!0}),nf.CancellationEventArgsBase=void 0;const t=ye();let e=class extends t.RecognitionEventArgs{constructor(i,r,s,o,a){super(o,a),this.privReason=i,this.privErrorDetails=r,this.privErrorCode=s}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return nf.CancellationEventArgsBase=e,nf}var HM;function qq(){if(HM)return tf;HM=1,Object.defineProperty(tf,"__esModule",{value:!0}),tf.SpeechRecognitionCanceledEventArgs=void 0;const t=P0();let e=class extends t.CancellationEventArgsBase{};return tf.SpeechRecognitionCanceledEventArgs=e,tf}var rf={},VM;function Xq(){if(VM)return rf;VM=1,Object.defineProperty(rf,"__esModule",{value:!0}),rf.TranslationRecognitionEventArgs=void 0;const t=ye();let e=class extends t.RecognitionEventArgs{constructor(i,r,s){super(r,s),this.privResult=i}get result(){return this.privResult}};return rf.TranslationRecognitionEventArgs=e,rf}var sf={},jM;function Kq(){if(jM)return sf;jM=1,Object.defineProperty(sf,"__esModule",{value:!0}),sf.TranslationSynthesisEventArgs=void 0;const t=ye();let e=class extends t.SessionEventArgs{constructor(i,r){super(r),this.privResult=i}get result(){return this.privResult}};return sf.TranslationSynthesisEventArgs=e,sf}var of={},WM;function UU(){if(WM)return of;WM=1,Object.defineProperty(of,"__esModule",{value:!0}),of.TranslationRecognitionResult=void 0;const t=ye();let e=class zU extends t.SpeechRecognitionResult{constructor(i,r,s,o,a,c,l,u,h,d,p){super(r,s,o,a,c,l,u,void 0,h,d,p),this.privTranslations=i}static fromSpeechRecognitionResult(i){return new zU(void 0,i.resultId,i.reason,i.text,i.duration,i.offset,i.language,i.languageDetectionConfidence,i.errorDetails,i.json,i.properties)}get translations(){return this.privTranslations}};return of.TranslationRecognitionResult=e,of}var hx={};Object.defineProperty(hx,"__esModule",{value:!0});hx.TranslationSynthesisResult=void 0;class Yq{constructor(e,n){this.privReason=e,this.privAudio=n}get audio(){return this.privAudio}get reason(){return this.privReason}}hx.TranslationSynthesisResult=Yq;var BU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ResultReason=void 0,function(e){e[e.NoMatch=0]="NoMatch",e[e.Canceled=1]="Canceled",e[e.RecognizingSpeech=2]="RecognizingSpeech",e[e.RecognizedSpeech=3]="RecognizedSpeech",e[e.RecognizedKeyword=4]="RecognizedKeyword",e[e.RecognizingIntent=5]="RecognizingIntent",e[e.RecognizedIntent=6]="RecognizedIntent",e[e.TranslatingSpeech=7]="TranslatingSpeech",e[e.TranslatedSpeech=8]="TranslatedSpeech",e[e.SynthesizingAudio=9]="SynthesizingAudio",e[e.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",e[e.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",e[e.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",e[e.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",e[e.RecognizedSpeakers=14]="RecognizedSpeakers",e[e.RecognizedSpeaker=15]="RecognizedSpeaker",e[e.ResetVoiceProfile=16]="ResetVoiceProfile",e[e.DeletedVoiceProfile=17]="DeletedVoiceProfile",e[e.VoicesListRetrieved=18]="VoicesListRetrieved",e[e.TranslatingParticipantSpeech=19]="TranslatingParticipantSpeech",e[e.TranslatedParticipantSpeech=20]="TranslatedParticipantSpeech",e[e.TranslatedInstantMessage=21]="TranslatedInstantMessage",e[e.TranslatedParticipantInstantMessage=22]="TranslatedParticipantInstantMessage"}(t.ResultReason||(t.ResultReason={}))})(BU);var Tl={},GM;function Jq(){if(GM)return Tl;GM=1,Object.defineProperty(Tl,"__esModule",{value:!0}),Tl.SpeechConfigImpl=Tl.SpeechConfig=void 0;const t=We(),e=_t,n=ye();let i=class{constructor(){}static fromSubscription(o,a){e.Contracts.throwIfNullOrWhitespace(o,"subscriptionKey"),e.Contracts.throwIfNullOrWhitespace(a,"region");const c=new r;return c.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),c.setProperty(n.PropertyId.SpeechServiceConnection_IntentRegion,a),c.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),c}static fromEndpoint(o,a){e.Contracts.throwIfNull(o,"endpoint");const c=new r;return c.setProperty(n.PropertyId.SpeechServiceConnection_Endpoint,o.href),a!==void 0&&c.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),c}static fromHost(o,a){e.Contracts.throwIfNull(o,"hostName");const c=new r;return c.setProperty(n.PropertyId.SpeechServiceConnection_Host,o.protocol+"//"+o.hostname+(o.port===""?"":":"+o.port)),a!==void 0&&c.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),c}static fromAuthorizationToken(o,a){e.Contracts.throwIfNull(o,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(a,"region");const c=new r;return c.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),c.setProperty(n.PropertyId.SpeechServiceConnection_IntentRegion,a),c.authorizationToken=o,c}close(){}};Tl.SpeechConfig=i;class r extends i{constructor(){super(),this.privProperties=new n.PropertyCollection,this.speechRecognitionLanguage="en-US",this.outputFormat=n.OutputFormat.Simple}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o)}get speechRecognitionLanguage(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,o)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,o)}get outputFormat(){return n.OutputFormat[this.privProperties.getProperty(t.OutputFormatPropertyName,void 0)]}set outputFormat(o){this.privProperties.setProperty(t.OutputFormatPropertyName,n.OutputFormat[o])}get endpointId(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_EndpointId,o)}setProperty(o,a){e.Contracts.throwIfNull(a,"value"),this.privProperties.setProperty(o,a)}getProperty(o,a){return this.privProperties.getProperty(o,a)}setProxy(o,a,c,l){this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyHostName],o),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPort],a),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyUserName],c),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPassword],l)}setServiceProperty(o,a){const c=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));c[o]=a,this.privProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(c))}setProfanity(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceResponse_ProfanityOption,n.ProfanityOption[o])}enableAudioLogging(){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privProperties.setProperty(t.ForceDictationPropertyName,"true")}clone(){const o=new r;return o.privProperties=this.privProperties.clone(),o}get speechSynthesisLanguage(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage,o)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthVoice,o)}get speechSynthesisOutputFormat(){return n.SpeechSynthesisOutputFormat[this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,n.SpeechSynthesisOutputFormat[o])}}return Tl.SpeechConfigImpl=r,Tl}var Al={},qM;function Qq(){if(qM)return Al;qM=1,Object.defineProperty(Al,"__esModule",{value:!0}),Al.SpeechTranslationConfigImpl=Al.SpeechTranslationConfig=void 0;const t=We(),e=_t,n=ye();let i=class extends n.SpeechConfig{constructor(){super()}static fromSubscription(o,a){e.Contracts.throwIfNullOrWhitespace(o,"subscriptionKey"),e.Contracts.throwIfNullOrWhitespace(a,"region");const c=new r;return c.properties.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),c.properties.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),c}static fromAuthorizationToken(o,a){e.Contracts.throwIfNullOrWhitespace(o,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(a,"region");const c=new r;return c.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o),c.properties.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),c}static fromHost(o,a){e.Contracts.throwIfNull(o,"hostName");const c=new r;return c.setProperty(n.PropertyId.SpeechServiceConnection_Host,o.protocol+"//"+o.hostname+(o.port===""?"":":"+o.port)),a!==void 0&&c.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),c}static fromEndpoint(o,a){e.Contracts.throwIfNull(o,"endpoint"),e.Contracts.throwIfNull(a,"subscriptionKey");const c=new r;return c.properties.setProperty(n.PropertyId.SpeechServiceConnection_Endpoint,o.href),c.properties.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),c}};Al.SpeechTranslationConfig=i;class r extends i{constructor(){super(),this.privSpeechProperties=new n.PropertyCollection,this.outputFormat=n.OutputFormat.Simple}set authorizationToken(o){e.Contracts.throwIfNullOrWhitespace(o,"value"),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o)}set speechRecognitionLanguage(o){e.Contracts.throwIfNullOrWhitespace(o,"value"),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,o)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return n.OutputFormat[this.privSpeechProperties.getProperty(t.OutputFormatPropertyName,void 0)]}set outputFormat(o){this.privSpeechProperties.setProperty(t.OutputFormatPropertyName,n.OutputFormat[o])}get endpointId(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_EndpointId,o)}addTargetLanguage(o){e.Contracts.throwIfNullOrWhitespace(o,"value");const a=this.targetLanguages;a.includes(o)||(a.push(o),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,a.join(",")))}get targetLanguages(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(o){e.Contracts.throwIfNullOrWhitespace(o,"value"),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_TranslationVoice,o)}get region(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_Region)}setProxy(o,a,c,l){this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyHostName],o),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPort],a),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyUserName],c),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPassword],l)}getProperty(o,a){return this.privSpeechProperties.getProperty(o,a)}setProperty(o,a){this.privSpeechProperties.setProperty(o,a)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(o,a){const c=JSON.parse(this.privSpeechProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));c[o]=a,this.privSpeechProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(c))}setProfanity(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceResponse_ProfanityOption,n.ProfanityOption[o])}enableAudioLogging(){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(t.ForceDictationPropertyName,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage,o)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthVoice,o)}get speechSynthesisOutputFormat(){return n.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,n.SpeechSynthesisOutputFormat[o])}}return Al.SpeechTranslationConfigImpl=r,Al}var af={},XM;function HU(){if(XM)return af;XM=1,Object.defineProperty(af,"__esModule",{value:!0}),af.PropertyCollection=void 0;const t=ye();let e=class $U{constructor(){this.privKeys=[],this.privValues=[]}getProperty(i,r){let s;typeof i=="string"?s=i:s=t.PropertyId[i];for(let o=0;o<this.privKeys.length;o++)if(this.privKeys[o]===s)return this.privValues[o];if(r!==void 0)return String(r)}setProperty(i,r){let s;typeof i=="string"?s=i:s=t.PropertyId[i];for(let o=0;o<this.privKeys.length;o++)if(this.privKeys[o]===s){this.privValues[o]=r;return}this.privKeys.push(s),this.privValues.push(r)}clone(){const i=new $U;for(let r=0;r<this.privKeys.length;r++)i.privKeys.push(this.privKeys[r]),i.privValues.push(this.privValues[r]);return i}mergeTo(i){this.privKeys.forEach(r=>{if(i.getProperty(r,void 0)===void 0){const s=this.getProperty(r);i.setProperty(r,s)}})}get keys(){return this.privKeys}};return af.PropertyCollection=e,af}var dx={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyId=void 0,function(e){e[e.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",e[e.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",e[e.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",e[e.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",e[e.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",e[e.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",e[e.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",e[e.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",e[e.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",e[e.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",e[e.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",e[e.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",e[e.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",e[e.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",e[e.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",e[e.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",e[e.Speech_SessionId=16]="Speech_SessionId",e[e.SpeechServiceConnection_SynthLanguage=17]="SpeechServiceConnection_SynthLanguage",e[e.SpeechServiceConnection_SynthVoice=18]="SpeechServiceConnection_SynthVoice",e[e.SpeechServiceConnection_SynthOutputFormat=19]="SpeechServiceConnection_SynthOutputFormat",e[e.SpeechServiceConnection_AutoDetectSourceLanguages=20]="SpeechServiceConnection_AutoDetectSourceLanguages",e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]="SpeechServiceResponse_RequestDetailedResultTrueFalse",e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",e[e.SpeechServiceResponse_JsonResult=23]="SpeechServiceResponse_JsonResult",e[e.SpeechServiceResponse_JsonErrorDetails=24]="SpeechServiceResponse_JsonErrorDetails",e[e.CancellationDetails_Reason=25]="CancellationDetails_Reason",e[e.CancellationDetails_ReasonText=26]="CancellationDetails_ReasonText",e[e.CancellationDetails_ReasonDetailedText=27]="CancellationDetails_ReasonDetailedText",e[e.LanguageUnderstandingServiceResponse_JsonResult=28]="LanguageUnderstandingServiceResponse_JsonResult",e[e.SpeechServiceConnection_Url=29]="SpeechServiceConnection_Url",e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=30]="SpeechServiceConnection_InitialSilenceTimeoutMs",e[e.SpeechServiceConnection_EndSilenceTimeoutMs=31]="SpeechServiceConnection_EndSilenceTimeoutMs",e[e.Speech_SegmentationSilenceTimeoutMs=32]="Speech_SegmentationSilenceTimeoutMs",e[e.SpeechServiceConnection_EnableAudioLogging=33]="SpeechServiceConnection_EnableAudioLogging",e[e.SpeechServiceConnection_LanguageIdMode=34]="SpeechServiceConnection_LanguageIdMode",e[e.SpeechServiceConnection_RecognitionEndpointVersion=35]="SpeechServiceConnection_RecognitionEndpointVersion",e[e.SpeechServiceConnection_SpeakerIdMode=36]="SpeechServiceConnection_SpeakerIdMode",e[e.SpeechServiceResponse_ProfanityOption=37]="SpeechServiceResponse_ProfanityOption",e[e.SpeechServiceResponse_PostProcessingOption=38]="SpeechServiceResponse_PostProcessingOption",e[e.SpeechServiceResponse_RequestWordLevelTimestamps=39]="SpeechServiceResponse_RequestWordLevelTimestamps",e[e.SpeechServiceResponse_StablePartialResultThreshold=40]="SpeechServiceResponse_StablePartialResultThreshold",e[e.SpeechServiceResponse_OutputFormatOption=41]="SpeechServiceResponse_OutputFormatOption",e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=42]="SpeechServiceResponse_TranslationRequestStablePartialResult",e[e.SpeechServiceResponse_RequestWordBoundary=43]="SpeechServiceResponse_RequestWordBoundary",e[e.SpeechServiceResponse_RequestPunctuationBoundary=44]="SpeechServiceResponse_RequestPunctuationBoundary",e[e.SpeechServiceResponse_RequestSentenceBoundary=45]="SpeechServiceResponse_RequestSentenceBoundary",e[e.Conversation_ApplicationId=46]="Conversation_ApplicationId",e[e.Conversation_DialogType=47]="Conversation_DialogType",e[e.Conversation_Initial_Silence_Timeout=48]="Conversation_Initial_Silence_Timeout",e[e.Conversation_From_Id=49]="Conversation_From_Id",e[e.Conversation_Conversation_Id=50]="Conversation_Conversation_Id",e[e.Conversation_Custom_Voice_Deployment_Ids=51]="Conversation_Custom_Voice_Deployment_Ids",e[e.Conversation_Speech_Activity_Template=52]="Conversation_Speech_Activity_Template",e[e.Conversation_Request_Bot_Status_Messages=53]="Conversation_Request_Bot_Status_Messages",e[e.Conversation_Agent_Connection_Id=54]="Conversation_Agent_Connection_Id",e[e.SpeechServiceConnection_Host=55]="SpeechServiceConnection_Host",e[e.ConversationTranslator_Host=56]="ConversationTranslator_Host",e[e.ConversationTranslator_Name=57]="ConversationTranslator_Name",e[e.ConversationTranslator_CorrelationId=58]="ConversationTranslator_CorrelationId",e[e.ConversationTranslator_Token=59]="ConversationTranslator_Token",e[e.PronunciationAssessment_ReferenceText=60]="PronunciationAssessment_ReferenceText",e[e.PronunciationAssessment_GradingSystem=61]="PronunciationAssessment_GradingSystem",e[e.PronunciationAssessment_Granularity=62]="PronunciationAssessment_Granularity",e[e.PronunciationAssessment_EnableMiscue=63]="PronunciationAssessment_EnableMiscue",e[e.PronunciationAssessment_Json=64]="PronunciationAssessment_Json",e[e.PronunciationAssessment_Params=65]="PronunciationAssessment_Params",e[e.SpeakerRecognition_Api_Version=66]="SpeakerRecognition_Api_Version",e[e.WebWorkerLoadType=67]="WebWorkerLoadType",e[e.TalkingAvatarService_WebRTC_SDP=68]="TalkingAvatarService_WebRTC_SDP"}(t.PropertyId||(t.PropertyId={}))})(dx);var cf={},KM;function Zq(){if(KM)return cf;KM=1,Object.defineProperty(cf,"__esModule",{value:!0}),cf.Recognizer=void 0;const t=We(),e=ht(),n=_t,i=ye();let r=class VU{constructor(o,a,c){this.audioConfig=o!==void 0?o:i.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=a.clone(),this.privConnectionFactory=c,this.implCommonRecognizerSetup()}close(o,a){n.Contracts.throwIfDisposed(this.privDisposed),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}get internalData(){return this.privReco}async dispose(o){this.privDisposed||(this.privDisposed=!0,o&&this.privReco&&(await this.privReco.audioSource.turnOff(),await this.privReco.dispose()))}static get telemetryEnabled(){return t.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(o){t.ServiceRecognizerBase.telemetryDataEnabled=o}implCommonRecognizerSetup(){let o=typeof window<"u"?"Browser":"Node",a="unknown",c="unknown";typeof navigator<"u"&&(o=o+"/"+navigator.platform,a=navigator.userAgent,c=navigator.appVersion);const l=this.createRecognizerConfig(new t.SpeechServiceConfig(new t.Context(new t.OS(o,a,c))));this.privReco=this.createServiceRecognizer(VU.getAuthFromProperties(this.privProperties),this.privConnectionFactory,this.audioConfig,l)}async recognizeOnceAsyncImpl(o){n.Contracts.throwIfDisposed(this.privDisposed);const a=new e.Deferred;await this.implRecognizerStop(),await this.privReco.recognize(o,a.resolve,a.reject);const c=await a.promise;return await this.implRecognizerStop(),c}async startContinuousRecognitionAsyncImpl(o){n.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop(),await this.privReco.recognize(o,void 0,void 0)}async stopContinuousRecognitionAsyncImpl(){n.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop()}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}static getAuthFromProperties(o){const a=o.getProperty(i.PropertyId.SpeechServiceConnection_Key,void 0);return a&&a!==""?new t.CognitiveSubscriptionKeyAuthentication(a):new t.CognitiveTokenAuthentication(()=>{const l=o.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(l)},()=>{const l=o.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(l)})}};return cf.Recognizer=r,cf}var lf={},YM;function eX(){if(YM)return lf;YM=1,Object.defineProperty(lf,"__esModule",{value:!0}),lf.SpeechRecognizer=void 0;const t=We(),e=ht(),n=_t,i=ye();let r=class jU extends i.Recognizer{constructor(o,a){const c=o;n.Contracts.throwIfNull(c,"speechConfig"),n.Contracts.throwIfNullOrWhitespace(c.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),super(a,c.properties,new t.SpeechConnectionFactory),this.privDisposedRecognizer=!1}static FromConfig(o,a,c){const l=o;return a.properties.mergeTo(l.properties),new jU(o,c)}get endpointId(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){n.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple])===i.OutputFormat[i.OutputFormat.Simple]?i.OutputFormat.Simple:i.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(o,a){e.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),o,a)}startContinuousRecognitionAsync(o,a){e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,a)}stopContinuousRecognitionAsync(o,a){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}startKeywordRecognitionAsync(o,a,c){n.Contracts.throwIfNull(o,"model"),c&&c("Not yet implemented.")}stopKeywordRecognitionAsync(o){o&&o()}close(o,a){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}async dispose(o){this.privDisposedRecognizer||(o&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(o))}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,a,c,l){const u=c;return new t.SpeechServiceRecognizer(o,a,u,l,this)}};return lf.SpeechRecognizer=r,lf}var uf={},JM;function tX(){if(JM)return uf;JM=1,Object.defineProperty(uf,"__esModule",{value:!0}),uf.IntentRecognizer=void 0;const t=We(),e=ht(),n=_t,i=ye();let r=class extends i.Recognizer{constructor(o,a){n.Contracts.throwIfNullOrUndefined(o,"speechConfig");const c=o;n.Contracts.throwIfNullOrUndefined(c,"speechConfig"),super(a,c.properties,new t.IntentConnectionFactory),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=c.properties,n.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}get properties(){return this.privProperties}recognizeOnceAsync(o,a){if(n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const c=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",c.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(c.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}e.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),o,a)}startContinuousRecognitionAsync(o,a){if(Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const c=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",c.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(c.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,a)}stopContinuousRecognitionAsync(o,a){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}startKeywordRecognitionAsync(o,a,c){n.Contracts.throwIfNull(o,"model"),c&&c("Not yet implemented.")}stopKeywordRecognitionAsync(o,a){if(o)try{o()}catch(c){a&&a(c)}}addIntent(o,a){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),n.Contracts.throwIfNullOrWhitespace(a,"intentId"),n.Contracts.throwIfNullOrWhitespace(o,"simplePhrase"),this.privAddedIntents.push([a,o])}addIntentWithLanguageModel(o,a,c){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),n.Contracts.throwIfNullOrWhitespace(o,"intentId"),n.Contracts.throwIfNull(a,"model");const l=a;n.Contracts.throwIfNullOrWhitespace(l.appId,"model.appId"),this.privAddedLmIntents[o]=new t.AddedLmIntent(l,c)}addAllIntents(o,a){n.Contracts.throwIfNull(o,"model");const c=o;n.Contracts.throwIfNullOrWhitespace(c.appId,"model.appId"),this.privUmbrellaIntent=new t.AddedLmIntent(c,a)}close(o,a){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,a,c,l){const u=c;return new t.IntentServiceRecognizer(o,a,u,l,this)}async dispose(o){this.privDisposedIntentRecognizer||o&&(this.privDisposedIntentRecognizer=!0,await super.dispose(o))}buildSpeechContext(){let o,a,c;const l=[];this.privUmbrellaIntent!==void 0&&(o=this.privUmbrellaIntent.modelImpl.appId,a=this.privUmbrellaIntent.modelImpl.region,c=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(const u of Object.keys(this.privAddedLmIntents)){const h=this.privAddedLmIntents[u];if(o===void 0)o=h.modelImpl.appId;else if(o!==h.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(a===void 0)a=h.modelImpl.region;else if(a!==h.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(c===void 0)c=h.modelImpl.subscriptionKey;else if(c!==h.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");const d="luis/"+o+"-PRODUCTION#"+u;l.push(d)}return{Intent:{id:o,key:c===void 0?this.privProperties.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_Key]):c,provider:"LUIS"},ReferenceGrammars:this.privUmbrellaIntent===void 0?l:["luis/"+o+"-PRODUCTION"]}}};return uf.IntentRecognizer=r,uf}var WU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceProfileType=void 0,function(e){e[e.TextIndependentIdentification=0]="TextIndependentIdentification",e[e.TextDependentVerification=1]="TextDependentVerification",e[e.TextIndependentVerification=2]="TextIndependentVerification"}(t.VoiceProfileType||(t.VoiceProfileType={}))})(WU);var hf={},df={},Pl={},QM;function GU(){if(QM)return Pl;QM=1,Object.defineProperty(Pl,"__esModule",{value:!0}),Pl.ConnectionMessageImpl=Pl.ConnectionMessage=void 0;const t=Fi,e=ht(),n=HU(),i=dx;let r=class{};Pl.ConnectionMessage=r;class s{constructor(a){this.privConnectionMessage=a,this.privProperties=new n.PropertyCollection,this.privConnectionMessage.headers[t.HeaderNames.ConnectionId]&&this.privProperties.setProperty(i.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[t.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach(c=>{this.privProperties.setProperty(c,this.privConnectionMessage.headers[c])})}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find(a=>a.toLowerCase()==="path".toLowerCase())]}get isTextMessage(){return this.privConnectionMessage.messageType===e.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===e.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}}return Pl.ConnectionMessageImpl=s,Pl}var ZM;function qU(){if(ZM)return df;ZM=1,Object.defineProperty(df,"__esModule",{value:!0}),df.Connection=void 0;const t=We(),e=ht(),n=GU(),i=_t,r=ye();let s=class pR{static fromRecognizer(a){const c=a.internalData,l=new pR;return l.privInternalData=c,l.setupEvents(),l}static fromSynthesizer(a){const c=a.internalData,l=new pR;return l.privInternalData=c,l.setupEvents(),l}openConnection(a,c){e.marshalPromiseToCallbacks(this.privInternalData.connect(),a,c)}closeConnection(a,c){if(this.privInternalData instanceof t.SynthesisAdapterBase)throw new Error("Disconnecting a synthesizer's connection is currently not supported");e.marshalPromiseToCallbacks(this.privInternalData.disconnect(),a,c)}setMessageProperty(a,c,l){if(i.Contracts.throwIfNullOrWhitespace(c,"propertyName"),this.privInternalData instanceof t.ServiceRecognizerBase){if(a.toLowerCase()!=="speech.context")throw new Error("Only speech.context message property sets are currently supported for recognizer");this.privInternalData.speechContext.setSection(c,l)}else if(this.privInternalData instanceof t.SynthesisAdapterBase){if(a.toLowerCase()!=="synthesis.context")throw new Error("Only synthesis.context message property sets are currently supported for synthesizer");this.privInternalData.synthesisContext.setSection(c,l)}}sendMessageAsync(a,c,l,u){e.marshalPromiseToCallbacks(this.privInternalData.sendNetworkMessage(a,c),l,u)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach(a=>{a.name==="ConnectionEstablishedEvent"?this.connected&&this.connected(new r.ConnectionEventArgs(a.connectionId)):a.name==="ConnectionClosedEvent"?this.disconnected&&this.disconnected(new r.ConnectionEventArgs(a.connectionId)):a.name==="ConnectionMessageSentEvent"?this.messageSent&&this.messageSent(new r.ConnectionMessageEventArgs(new n.ConnectionMessageImpl(a.message))):a.name==="ConnectionMessageReceivedEvent"&&this.messageReceived&&this.messageReceived(new r.ConnectionMessageEventArgs(new n.ConnectionMessageImpl(a.message)))}),this.privServiceEventListener=this.privInternalData.serviceEvents.attach(a=>{this.receivedServiceMessage&&this.receivedServiceMessage(new r.ServiceEventArgs(a.jsonString,a.name))})}};return df.Connection=s,df}var e3;function nX(){if(e3)return hf;e3=1,Object.defineProperty(hf,"__esModule",{value:!0}),hf.TranslationRecognizer=void 0;const t=We(),e=ht(),n=qU(),i=_t,r=ye();let s=class XU extends r.Recognizer{constructor(a,c,l){const u=a;i.Contracts.throwIfNull(u,"speechConfig"),super(c,u.properties,l||new t.TranslationConnectionFactory),this.privDisposedTranslationRecognizer=!1,this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&i.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice),r.PropertyId[r.PropertyId.SpeechServiceConnection_TranslationVoice]),i.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages),r.PropertyId[r.PropertyId.SpeechServiceConnection_TranslationToLanguages]),i.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage),r.PropertyId[r.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(a,c,l){const u=a;return c.properties.mergeTo(u.properties),new XU(a,l)}get speechRecognitionLanguage(){return i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(r.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(a){this.properties.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,a)}recognizeOnceAsync(a,c){i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),e.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),a,c)}startContinuousRecognitionAsync(a,c){e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),a,c)}stopContinuousRecognitionAsync(a,c){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),a,c)}removeTargetLanguage(a){if(i.Contracts.throwIfNullOrUndefined(a,"language to be removed"),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0){const c=this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),l=c.indexOf(a);l>-1&&(c.splice(l,1),this.properties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,c.join(",")),this.updateLanguages(c))}}addTargetLanguage(a){i.Contracts.throwIfNullOrUndefined(a,"language to be added");let c=[];this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?(c=this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),c.includes(a)||(c.push(a),this.properties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,c.join(",")))):(this.properties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,a),c=[a]),this.updateLanguages(c)}close(a,c){i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),a,c)}onConnection(){}async dispose(a){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,a&&(await this.implRecognizerStop(),await super.dispose(a)))}createRecognizerConfig(a){return new t.RecognizerConfig(a,this.privProperties)}createServiceRecognizer(a,c,l,u){const h=l;return new t.TranslationServiceRecognizer(a,c,h,u,this)}updateLanguages(a){const c=n.Connection.fromRecognizer(this);c&&(c.setMessageProperty("speech.context","translationcontext",{to:a}),c.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:a})))}};return hf.TranslationRecognizer=s,hf}var pf={},t3;function iX(){if(t3)return pf;t3=1,Object.defineProperty(pf,"__esModule",{value:!0}),pf.Translations=void 0;const t=ye();let e=class{constructor(){this.privMap=new t.PropertyCollection}get languages(){return this.privMap.keys}get(i,r){return this.privMap.getProperty(i,r)}set(i,r){this.privMap.setProperty(i,r)}};return pf.Translations=e,pf}var KU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.NoMatchReason=void 0,function(e){e[e.NotRecognized=0]="NotRecognized",e[e.InitialSilenceTimeout=1]="InitialSilenceTimeout",e[e.InitialBabbleTimeout=2]="InitialBabbleTimeout"}(t.NoMatchReason||(t.NoMatchReason={}))})(KU);var ff={},n3;function rX(){if(n3)return ff;n3=1,Object.defineProperty(ff,"__esModule",{value:!0}),ff.NoMatchDetails=void 0;const t=We(),e=ye();let n=class YU{constructor(r){this.privReason=r}static fromResult(r){const s=t.SimpleSpeechPhrase.fromJSON(r.json);let o=e.NoMatchReason.NotRecognized;switch(s.RecognitionStatus){case t.RecognitionStatus.BabbleTimeout:o=e.NoMatchReason.InitialBabbleTimeout;break;case t.RecognitionStatus.InitialSilenceTimeout:o=e.NoMatchReason.InitialSilenceTimeout;break;default:o=e.NoMatchReason.NotRecognized;break}return new YU(o)}get reason(){return this.privReason}};return ff.NoMatchDetails=n,ff}var px={};Object.defineProperty(px,"__esModule",{value:!0});px.TranslationRecognitionCanceledEventArgs=void 0;class sX{constructor(e,n,i,r,s){this.privCancelReason=n,this.privErrorDetails=i,this.privResult=s,this.privSessionId=e,this.privErrorCode=r}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}px.TranslationRecognitionCanceledEventArgs=sX;var mf={},i3;function oX(){if(i3)return mf;i3=1,Object.defineProperty(mf,"__esModule",{value:!0}),mf.IntentRecognitionCanceledEventArgs=void 0;const t=ye();let e=class extends t.IntentRecognitionEventArgs{constructor(i,r,s,o,a,c){super(o,a,c),this.privReason=i,this.privErrorDetails=r,this.privErrorCode=s}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return mf.IntentRecognitionCanceledEventArgs=e,mf}var I0={};Object.defineProperty(I0,"__esModule",{value:!0});I0.CancellationDetailsBase=void 0;class aX{constructor(e,n,i){this.privReason=e,this.privErrorDetails=n,this.privErrorCode=i}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}}I0.CancellationDetailsBase=aX;var gf={},r3;function cX(){if(r3)return gf;r3=1,Object.defineProperty(gf,"__esModule",{value:!0}),gf.CancellationDetails=void 0;const t=We(),e=I0,n=ye();let i=class JU extends e.CancellationDetailsBase{constructor(s,o,a){super(s,o,a)}static fromResult(s){let o=n.CancellationReason.Error,a=n.CancellationErrorCode.NoError;if(s instanceof n.RecognitionResult&&s.json){const c=t.SimpleSpeechPhrase.fromJSON(s.json);o=t.EnumTranslation.implTranslateCancelResult(c.RecognitionStatus)}return s.properties&&(a=n.CancellationErrorCode[s.properties.getProperty(t.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.NoError])]),new JU(o,s.errorDetails||t.EnumTranslation.implTranslateErrorDetails(a),a)}};return gf.CancellationDetails=i,gf}var QU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationErrorCode=void 0,function(e){e[e.NoError=0]="NoError",e[e.AuthenticationFailure=1]="AuthenticationFailure",e[e.BadRequestParameters=2]="BadRequestParameters",e[e.TooManyRequests=3]="TooManyRequests",e[e.ConnectionFailure=4]="ConnectionFailure",e[e.ServiceTimeout=5]="ServiceTimeout",e[e.ServiceError=6]="ServiceError",e[e.RuntimeError=7]="RuntimeError",e[e.Forbidden=8]="Forbidden"}(t.CancellationErrorCode||(t.CancellationErrorCode={}))})(QU);var vf={},s3;function lX(){if(s3)return vf;s3=1,Object.defineProperty(vf,"__esModule",{value:!0}),vf.ConnectionEventArgs=void 0;const t=ye();let e=class extends t.SessionEventArgs{};return vf.ConnectionEventArgs=e,vf}var yf={},o3;function uX(){if(o3)return yf;o3=1,Object.defineProperty(yf,"__esModule",{value:!0}),yf.ServiceEventArgs=void 0;const t=ye();let e=class extends t.SessionEventArgs{constructor(i,r,s){super(s),this.privJsonResult=i,this.privEventName=r}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}};return yf.ServiceEventArgs=e,yf}var fx={};Object.defineProperty(fx,"__esModule",{value:!0});fx.PhraseListGrammar=void 0;class v2{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(e){const n=e.internalData;return new v2(n)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}}fx.PhraseListGrammar=v2;var Il={},a3;function y2(){if(a3)return Il;a3=1,Object.defineProperty(Il,"__esModule",{value:!0}),Il.DialogServiceConfigImpl=Il.DialogServiceConfig=void 0;const t=_t,e=ye();let n=class{constructor(){}set applicationId(s){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}};Il.DialogServiceConfig=n;class i extends n{constructor(){super(),this.privSpeechConfig=new e.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(s){t.Contracts.throwIfNullOrWhitespace(s,"value"),this.privSpeechConfig.speechRecognitionLanguage=s}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(s){this.privSpeechConfig.outputFormat=s}setProperty(s,o){this.privSpeechConfig.setProperty(s,o)}getProperty(s,o){return this.privSpeechConfig.getProperty(s)}setProxy(s,o,a,c){this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyHostName,s),this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyPort,`${o}`),a&&this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyUserName,a),c&&this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyPassword,c)}setServiceProperty(s,o,a){this.privSpeechConfig.setServiceProperty(s,o)}close(){}}return Il.DialogServiceConfigImpl=i,Il}var Sf={},c3;function hX(){if(c3)return Sf;c3=1,Object.defineProperty(Sf,"__esModule",{value:!0}),Sf.BotFrameworkConfig=void 0;const t=_t,e=y2(),n=ye();let i=class extends e.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"subscription"),t.Contracts.throwIfNullOrWhitespace(o,"region");const c=new e.DialogServiceConfigImpl;return c.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),c.setProperty(n.PropertyId.SpeechServiceConnection_Key,s),c.setProperty(n.PropertyId.SpeechServiceConnection_Region,o),a&&c.setProperty(n.PropertyId.Conversation_ApplicationId,a),c}static fromAuthorizationToken(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(o,"region");const c=new e.DialogServiceConfigImpl;return c.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),c.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,s),c.setProperty(n.PropertyId.SpeechServiceConnection_Region,o),a&&c.setProperty(n.PropertyId.Conversation_ApplicationId,a),c}static fromHost(s,o,a){t.Contracts.throwIfNullOrUndefined(s,"host");const c=s instanceof URL?s:new URL(`wss://${s}.convai.speech.azure.us`);t.Contracts.throwIfNullOrUndefined(c,"resolvedHost");const l=new e.DialogServiceConfigImpl;return l.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),l.setProperty(n.PropertyId.SpeechServiceConnection_Host,c.toString()),o!==void 0&&l.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),l}static fromEndpoint(s,o){t.Contracts.throwIfNull(s,"endpoint");const a=new e.DialogServiceConfigImpl;return a.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),a.setProperty(n.PropertyId.SpeechServiceConnection_Endpoint,s.toString()),o!==void 0&&a.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),a}};return Sf.BotFrameworkConfig=i,Sf}var xf={},l3;function dX(){if(l3)return xf;l3=1,Object.defineProperty(xf,"__esModule",{value:!0}),xf.CustomCommandsConfig=void 0;const t=_t,e=y2(),n=ye();let i=class extends e.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"applicationId"),t.Contracts.throwIfNullOrWhitespace(o,"subscription"),t.Contracts.throwIfNullOrWhitespace(a,"region");const c=new e.DialogServiceConfigImpl;return c.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.CustomCommands),c.setProperty(n.PropertyId.Conversation_ApplicationId,s),c.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),c.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),c}static fromAuthorizationToken(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"applicationId"),t.Contracts.throwIfNullOrWhitespace(o,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(a,"region");const c=new e.DialogServiceConfigImpl;return c.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.CustomCommands),c.setProperty(n.PropertyId.Conversation_ApplicationId,s),c.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o),c.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),c}set applicationId(s){t.Contracts.throwIfNullOrWhitespace(s,"value"),this.setProperty(n.PropertyId.Conversation_ApplicationId,s)}get applicationId(){return this.getProperty(n.PropertyId.Conversation_ApplicationId)}};return xf.CustomCommandsConfig=i,xf}var Cf={},_f={},wf={},Do={};Object.defineProperty(Do,"__esModule",{value:!0});Do.QueryParameterNames=void 0;class Jn{}Do.QueryParameterNames=Jn;Jn.BotId="botid";Jn.CustomSpeechDeploymentId="cid";Jn.CustomVoiceDeploymentId="deploymentId";Jn.EnableAudioLogging="storeAudio";Jn.EnableLanguageId="lidEnabled";Jn.EnableWordLevelTimestamps="wordLevelTimestamps";Jn.EndSilenceTimeoutMs="endSilenceTimeoutMs";Jn.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs";Jn.Format="format";Jn.InitialSilenceTimeoutMs="initialSilenceTimeoutMs";Jn.Language="language";Jn.Profanity="profanity";Jn.RequestBotStatusMessages="enableBotMessageStatus";Jn.StableIntermediateThreshold="stableIntermediateThreshold";Jn.StableTranslation="stableTranslation";Jn.TestHooks="testhooks";Jn.Postprocessing="postprocessing";Jn.CtsMeetingId="meetingId";Jn.CtsDeviceId="deviceId";Jn.CtsIsParticipant="isParticipant";Jn.EnableAvatar="enableTalkingAvatar";var u3;function No(){if(u3)return wf;u3=1,Object.defineProperty(wf,"__esModule",{value:!0}),wf.ConnectionFactoryBase=void 0;const t=We(),e=ye(),n=Do;let i=class{static getHostSuffix(s){if(s){if(s.toLowerCase().startsWith("china"))return".azure.cn";if(s.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(s,o,a){new Map([[e.PropertyId.Speech_SegmentationSilenceTimeoutMs,n.QueryParameterNames.SegmentationSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_EnableAudioLogging,n.QueryParameterNames.EnableAudioLogging],[e.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,n.QueryParameterNames.EndSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,n.QueryParameterNames.InitialSilenceTimeoutMs],[e.PropertyId.SpeechServiceResponse_PostProcessingOption,n.QueryParameterNames.Postprocessing],[e.PropertyId.SpeechServiceResponse_ProfanityOption,n.QueryParameterNames.Profanity],[e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,n.QueryParameterNames.EnableWordLevelTimestamps],[e.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,n.QueryParameterNames.StableIntermediateThreshold]]).forEach((u,h)=>{this.setUrlParameter(h,u,s,o,a)});const l=JSON.parse(s.parameters.getProperty(t.ServicePropertiesPropertyName,"{}"));Object.keys(l).forEach(u=>{o[u]=l[u]})}setUrlParameter(s,o,a,c,l){const u=a.parameters.getProperty(s,void 0);u&&(!l||l.search(o)===-1)&&(c[o]=u.toLocaleLowerCase())}};return wf.ConnectionFactoryBase=i,wf}var h3;function pX(){if(h3)return _f;h3=1,Object.defineProperty(_f,"__esModule",{value:!0}),_f.DialogConnectionFactory=void 0;const t=zi(),e=We(),n=ye(),i=No(),r=We(),s=Fi,o=Do;class a extends i.ConnectionFactoryBase{create(l,u,h){const d=l.parameters.getProperty(n.PropertyId.Conversation_ApplicationId,""),p=l.parameters.getProperty(n.PropertyId.Conversation_DialogType),f=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region),v=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),g=l.parameters.getProperty(n.PropertyId.Conversation_Request_Bot_Status_Messages,"true"),m={};m[s.HeaderNames.ConnectionId]=h,m[o.QueryParameterNames.Format]=l.parameters.getProperty(e.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple]).toLowerCase(),m[o.QueryParameterNames.Language]=v,m[o.QueryParameterNames.RequestBotStatusMessages]=g,d&&(m[o.QueryParameterNames.BotId]=d,p===n.DialogServiceConfig.DialogTypes.CustomCommands&&(m[s.HeaderNames.CustomCommandsAppId]=d));const y=p===n.DialogServiceConfig.DialogTypes.CustomCommands?"commands/":"",S=p===n.DialogServiceConfig.DialogTypes.CustomCommands?"v1":p===n.DialogServiceConfig.DialogTypes.BotFramework?"v3":"v0",x={};u.token!=null&&u.token!==""&&(x[u.headerName]=u.token);let w=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,"");if(!w){const E=i.ConnectionFactoryBase.getHostSuffix(f),b=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,`wss://${f}.${a.BaseUrl}${E}`);w=`${b.endsWith("/")?b:b+"/"}${y}${a.ApiKey}/${S}`}this.setCommonUrlParams(l,m,w);const C=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(w,m,x,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(l),C,h)}}return _f.DialogConnectionFactory=a,a.ApiKey="api",a.BaseUrl="convai.speech",_f}var d3;function fX(){if(d3)return Cf;d3=1,Object.defineProperty(Cf,"__esModule",{value:!0}),Cf.DialogServiceConnector=void 0;const t=pX(),e=We(),n=ht(),i=_t,r=ye(),s=dx;let o=class extends r.Recognizer{constructor(c,l){const u=c;i.Contracts.throwIfNull(c,"dialogConfig"),super(l,u.properties,new t.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=u.properties.clone();const h=this.buildAgentConfig();this.privReco.agentConfig.set(h)}connect(c,l){n.marshalPromiseToCallbacks(this.privReco.connect(),c,l)}disconnect(c,l){n.marshalPromiseToCallbacks(this.privReco.disconnect(),c,l)}get authorizationToken(){return this.properties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(c){i.Contracts.throwIfNullOrWhitespace(c,"token"),this.properties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,c)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(s.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(c){this.properties.setProperty(s.PropertyId.Conversation_Speech_Activity_Template,c)}listenOnceAsync(c,l){if(this.isTurnComplete){i.Contracts.throwIfDisposed(this.privIsDisposed);const h=(async()=>{await this.privReco.connect(),await this.implRecognizerStop(),this.isTurnComplete=!1;const d=new n.Deferred;await this.privReco.recognize(e.RecognitionMode.Conversation,d.resolve,d.reject);const p=await d.promise;return await this.implRecognizerStop(),p})();h.catch(()=>{this.dispose(!0).catch(()=>{})}),n.marshalPromiseToCallbacks(h.finally(()=>{this.isTurnComplete=!0}),c,l)}}sendActivityAsync(c,l,u){n.marshalPromiseToCallbacks(this.privReco.sendMessage(c),l,u)}close(c,l){i.Contracts.throwIfDisposed(this.privIsDisposed),n.marshalPromiseToCallbacks(this.dispose(!0),c,l)}async dispose(c){this.privIsDisposed||c&&(this.privIsDisposed=!0,await this.implRecognizerStop(),await super.dispose(c))}createRecognizerConfig(c){return new e.RecognizerConfig(c,this.privProperties)}createServiceRecognizer(c,l,u,h){const d=u;return new e.DialogServiceAdapter(c,l,d,h,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(s.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(s.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(s.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}};return Cf.DialogServiceConnector=o,Cf}var mx={};Object.defineProperty(mx,"__esModule",{value:!0});mx.ActivityReceivedEventArgs=void 0;class mX{constructor(e,n){this.privActivity=e,this.privAudioStream=n}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}}mx.ActivityReceivedEventArgs=mX;var gx={},vx={};Object.defineProperty(vx,"__esModule",{value:!0});vx.TurnStatusResponsePayload=void 0;class S2{constructor(e){this.privMessageStatusResponse=JSON.parse(e)}static fromJSON(e){return new S2(e)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}}vx.TurnStatusResponsePayload=S2;Object.defineProperty(gx,"__esModule",{value:!0});gx.TurnStatusReceivedEventArgs=void 0;const gX=vx;class vX{constructor(e){this.privTurnStatus=gX.TurnStatusResponsePayload.fromJSON(e)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}}gx.TurnStatusReceivedEventArgs=vX;var ZU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ServicePropertyChannel=void 0,function(e){e[e.UriQueryParameter=0]="UriQueryParameter"}(t.ServicePropertyChannel||(t.ServicePropertyChannel={}))})(ZU);var eB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProfanityOption=void 0,function(e){e[e.Masked=0]="Masked",e[e.Removed=1]="Removed",e[e.Raw=2]="Raw"}(t.ProfanityOption||(t.ProfanityOption={}))})(eB);var Ef={},p3;function yX(){if(p3)return Ef;p3=1,Object.defineProperty(Ef,"__esModule",{value:!0}),Ef.BaseAudioPlayer=void 0;const t=Wi,e=ye(),n=Sl;let i=class{constructor(s){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,s===void 0&&(s=e.AudioStreamFormat.getDefaultInputFormat()),this.init(s)}playAudioSample(s,o,a){try{this.ensureInitializedContext();const c=this.formatAudioData(s),l=new Float32Array(this.samples.length+c.length);l.set(this.samples,0),l.set(c,this.samples.length),this.samples=l,o&&o()}catch(c){a&&a(c)}}stopAudio(s,o){this.audioContext!==null&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then(()=>{s&&s()},a=>{o&&o(a)}),this.audioContext=null)}init(s){this.audioFormat=s,this.samples=new Float32Array}ensureInitializedContext(){if(this.audioContext===null){this.createAudioContext();const s=200;this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},s)}}createAudioContext(){this.audioContext=n.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(s){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(s),128);case 16:return this.formatArrayBuffer(new Int16Array(s),32768);case 32:return this.formatArrayBuffer(new Int32Array(s),2147483648);default:throw new t.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(s,o){const a=new Float32Array(s.length);for(let c=0;c<s.length;c++)a[c]=s[c]/o;return a}updateAudioBuffer(){if(this.samples.length===0)return;const s=this.audioFormat.channels,o=this.audioContext.createBufferSource(),a=this.samples.length/s,c=this.audioContext.createBuffer(s,a,this.audioFormat.samplesPerSec);for(let l=0;l<s;l++){let u=l;const h=c.getChannelData(l);for(let d=0;d<this.samples.length;d++,u+=s)h[d]=this.samples[u]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),o.buffer=c,o.connect(this.gainNode),o.start(this.startTime),this.startTime+=c.duration,this.samples=new Float32Array}async playAudio(s){this.audioContext===null&&this.createAudioContext();const o=this.audioContext.createBufferSource(),a=this.audioContext.destination;await this.audioContext.decodeAudioData(s,c=>{o.buffer=c,o.connect(a),o.start(0)})}};return Ef.BaseAudioPlayer=i,Ef}var yx={};Object.defineProperty(yx,"__esModule",{value:!0});yx.ConnectionMessageEventArgs=void 0;class SX{constructor(e){this.privConnectionMessage=e}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}}yx.ConnectionMessageEventArgs=SX;var Sx={};Object.defineProperty(Sx,"__esModule",{value:!0});Sx.VoiceProfile=void 0;class xX{constructor(e,n){this.privId=e,this.privProfileType=n}get profileId(){return this.privId}get profileType(){return this.privProfileType}}Sx.VoiceProfile=xX;var Ml={},f3;function CX(){if(f3)return Ml;f3=1,Object.defineProperty(Ml,"__esModule",{value:!0}),Ml.VoiceProfileEnrollmentCancellationDetails=Ml.VoiceProfileEnrollmentResult=void 0;const t=We(),e=ye();let n=class fR{constructor(s,o,a){this.privReason=s,this.privProperties=new e.PropertyCollection,this.privReason!==e.ResultReason.Canceled?o&&(this.privDetails=JSON.parse(o),this.privDetails.enrollmentStatus.toLowerCase()==="enrolling"&&(this.privReason=e.ResultReason.EnrollingVoiceProfile)):(this.privErrorDetails=a,this.privProperties.setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[e.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get enrollmentsCount(){return this.privDetails.enrollmentsCount}get enrollmentsLength(){return this.privDetails.enrollmentsLength}get properties(){return this.privProperties}get enrollmentResultDetails(){return this.privDetails}get errorDetails(){return this.privErrorDetails}static FromIdentificationProfileList(s){const o=[];for(const a of s.value){const c=a.enrollmentStatus.toLowerCase()==="enrolling"?e.ResultReason.EnrollingVoiceProfile:a.enrollmentStatus.toLowerCase()==="enrolled"?e.ResultReason.EnrolledVoiceProfile:e.ResultReason.Canceled,l=new fR(c,null,null);l.privDetails=this.getIdentificationDetails(a),o.push(l)}return o}static FromVerificationProfileList(s){const o=[];for(const a of s.value){const c=a.enrollmentStatus.toLowerCase()==="enrolling"?e.ResultReason.EnrollingVoiceProfile:a.enrollmentStatus.toLowerCase()==="enrolled"?e.ResultReason.EnrolledVoiceProfile:e.ResultReason.Canceled,l=new fR(c,null,null);l.privDetails=this.getVerificationDetails(a),o.push(l)}return o}static getIdentificationDetails(s){return{audioLength:s.audioLength?parseFloat(s.audioLength):0,audioSpeechLength:s.audioSpeechLength?parseFloat(s.audioSpeechLength):0,enrollmentStatus:s.enrollmentStatus,enrollmentsCount:s.enrollmentsCount||0,enrollmentsLength:s.enrollmentsLength?parseFloat(s.enrollmentsLength):0,enrollmentsSpeechLength:s.enrollmentsSpeechLength?parseFloat(s.enrollmentsSpeechLength):0,profileId:s.profileId||s.identificationProfileId,remainingEnrollmentsSpeechLength:s.remainingEnrollmentsSpeechLength?parseFloat(s.remainingEnrollmentsSpeechLength):0}}static getVerificationDetails(s){return{audioLength:s.audioLength?parseFloat(s.audioLength):0,audioSpeechLength:s.audioSpeechLength?parseFloat(s.audioSpeechLength):0,enrollmentStatus:s.enrollmentStatus,enrollmentsCount:s.enrollmentsCount,enrollmentsLength:s.enrollmentsLength?parseFloat(s.enrollmentsLength):0,enrollmentsSpeechLength:s.enrollmentsSpeechLength?parseFloat(s.enrollmentsSpeechLength):0,profileId:s.profileId||s.verificationProfileId,remainingEnrollmentsCount:s.remainingEnrollments||s.remainingEnrollmentsCount,remainingEnrollmentsSpeechLength:s.remainingEnrollmentsSpeechLength?parseFloat(s.remainingEnrollmentsSpeechLength):0}}};Ml.VoiceProfileEnrollmentResult=n;class i extends e.CancellationDetailsBase{constructor(s,o,a){super(s,o,a)}static fromResult(s){const o=e.CancellationReason.Error;let a=e.CancellationErrorCode.NoError;return s.properties&&(a=e.CancellationErrorCode[s.properties.getProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[e.CancellationErrorCode.NoError])]),new i(o,s.errorDetails,a)}}return Ml.VoiceProfileEnrollmentCancellationDetails=i,Ml}var kl={},m3;function _X(){if(m3)return kl;m3=1,Object.defineProperty(kl,"__esModule",{value:!0}),kl.VoiceProfileCancellationDetails=kl.VoiceProfileResult=void 0;const t=We(),e=_t,n=ye();let i=class{constructor(o,a){this.privReason=o,this.privProperties=new n.PropertyCollection,o===n.ResultReason.Canceled&&(e.Contracts.throwIfNullOrUndefined(a,"statusText"),this.privErrorDetails=a,this.privProperties.setProperty(t.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get properties(){return this.privProperties}get errorDetails(){return this.privErrorDetails}};kl.VoiceProfileResult=i;class r extends n.CancellationDetailsBase{constructor(o,a,c){super(o,a,c)}static fromResult(o){const a=n.CancellationReason.Error;let c=n.CancellationErrorCode.NoError;return o.properties&&(c=n.CancellationErrorCode[o.properties.getProperty(t.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.NoError])]),new r(a,o.errorDetails,c)}}return kl.VoiceProfileCancellationDetails=r,kl}var Rf={},g3;function wX(){if(g3)return Rf;g3=1,Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.VoiceProfilePhraseResult=void 0;const t=_t,e=ye();let n=class extends e.VoiceProfileResult{constructor(r,s,o,a){super(r,s),this.privPhrases=[],t.Contracts.throwIfNullOrUndefined(a,"phrase array"),this.privType=o,a&&a[0]&&(this.privPhrases=a)}get phrases(){return this.privPhrases}get type(){return this.privType}};return Rf.VoiceProfilePhraseResult=n,Rf}var bf={},v3;function EX(){if(v3)return bf;v3=1,Object.defineProperty(bf,"__esModule",{value:!0}),bf.VoiceProfileClient=void 0;const t=We(),e=DU(),n=_t,i=ye();let r=class extends i.Recognizer{constructor(o){n.Contracts.throwIfNullOrUndefined(o,"speechConfig");const a=o;n.Contracts.throwIfNull(a,"speechConfig"),super(e.AudioConfig.fromStreamInput(i.AudioInputStream.createPushStream()),a.properties,new t.VoiceProfileConnectionFactory),this.privProperties=a.properties.clone(),this.privVoiceAdapter=this.privReco,this.privDisposedVoiceAdapter=!1}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){n.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}async createProfileAsync(o,a){const c=await this.privVoiceAdapter.createProfile(o,a);return new i.VoiceProfile(c[0],o)}async retrieveEnrollmentResultAsync(o){return this.privVoiceAdapter.retrieveEnrollmentResult(o)}async getAllProfilesAsync(o){return this.privVoiceAdapter.getAllProfiles(o)}async getActivationPhrasesAsync(o,a){return this.privVoiceAdapter.getActivationPhrases(o,a)}async enrollProfileAsync(o,a){const c=a;return n.Contracts.throwIfNullOrUndefined(c,"audioConfig"),this.audioConfig=a,this.privVoiceAdapter.SpeakerAudioSource=c,this.privVoiceAdapter.enrollProfile(o)}async deleteProfileAsync(o){return this.privVoiceAdapter.deleteProfile(o)}async resetProfileAsync(o){return this.privVoiceAdapter.resetProfile(o)}async close(){await this.dispose(!0)}createServiceRecognizer(o,a,c,l){const u=c;return new t.VoiceServiceRecognizer(o,a,u,l,this)}async dispose(o){this.privDisposedVoiceAdapter||(this.privDisposedVoiceAdapter=!0,o&&await super.dispose(o))}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.properties)}getResult(o,a){return new i.VoiceProfileResult(o.ok?a:i.ResultReason.Canceled,o.statusText)}};return bf.VoiceProfileClient=r,bf}var Tf={},y3;function RX(){if(y3)return Tf;y3=1,Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.SpeakerRecognizer=void 0;const t=We(),e=_t,n=ye();let i=class extends n.Recognizer{constructor(s,o){e.Contracts.throwIfNullOrUndefined(s,"speechConfig");const a=s;e.Contracts.throwIfNullOrUndefined(a,"speechConfig"),super(o,a.properties,new t.SpeakerRecognitionConnectionFactory),this.privAudioConfigImpl=o,e.Contracts.throwIfNull(this.privAudioConfigImpl,"audioConfig"),this.privDisposedSpeakerRecognizer=!1,this.privProperties=a.properties}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){e.Contracts.throwIfNullOrWhitespace(s,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,s)}get properties(){return this.privProperties}async recognizeOnceAsync(s){return e.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),this.recognizeSpeakerOnceAsyncImpl(s)}async close(){e.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.dispose(!0)}async recognizeSpeakerOnceAsyncImpl(s){e.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.implRecognizerStop();const o=await this.privReco.recognizeSpeaker(s);return await this.implRecognizerStop(),o}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}createRecognizerConfig(s){return new t.RecognizerConfig(s,this.privProperties)}createServiceRecognizer(s,o,a,c){const l=a;return new t.SpeakerServiceRecognizer(s,o,l,c,this)}async dispose(s){this.privDisposedSpeakerRecognizer||s&&(this.privDisposedSpeakerRecognizer=!0,await super.dispose(s))}};return Tf.SpeakerRecognizer=i,Tf}var Af={},S3;function bX(){if(S3)return Af;S3=1,Object.defineProperty(Af,"__esModule",{value:!0}),Af.SpeakerIdentificationModel=void 0;const t=_t,e=ye();let n=class tB{constructor(r){if(this.privVoiceProfiles=[],this.privProfileIds=[],t.Contracts.throwIfNullOrUndefined(r,"VoiceProfiles"),r.length===0)throw new Error("Empty Voice Profiles array");for(const s of r){if(s.profileType!==e.VoiceProfileType.TextIndependentIdentification)throw new Error("Identification model can only be created from Identification profile: "+s.profileId);this.privVoiceProfiles.push(s),this.privProfileIds.push(s.profileId)}}static fromProfiles(r){return new tB(r)}get voiceProfileIds(){return this.privProfileIds.join(",")}get profileIds(){return this.privProfileIds}get scenario(){return"TextIndependentIdentification"}};return Af.SpeakerIdentificationModel=n,Af}var Pf={},x3;function TX(){if(x3)return Pf;x3=1,Object.defineProperty(Pf,"__esModule",{value:!0}),Pf.SpeakerVerificationModel=void 0;const t=_t,e=ye();let n=class nB{constructor(r){if(t.Contracts.throwIfNullOrUndefined(r,"VoiceProfile"),r.profileType===e.VoiceProfileType.TextIndependentIdentification)throw new Error("Verification model cannot be created from Identification profile");this.privVoiceProfile=r}static fromProfile(r){return new nB(r)}get voiceProfile(){return this.privVoiceProfile}get profileIds(){return[this.voiceProfile.profileId]}get scenario(){return this.voiceProfile.profileType===e.VoiceProfileType.TextDependentVerification?"TextDependentVerification":"TextIndependentVerification"}};return Pf.SpeakerVerificationModel=n,Pf}var If={},x2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.LanguageIdMode=void 0,function(e){e[e.AtStart=0]="AtStart",e[e.Continuous=1]="Continuous"}(t.LanguageIdMode||(t.LanguageIdMode={}))})(x2);var C3;function AX(){if(C3)return If;C3=1,Object.defineProperty(If,"__esModule",{value:!0}),If.AutoDetectSourceLanguageConfig=void 0;const t=We(),e=_t,n=ye(),i=x2;let r=class My{constructor(){this.privProperties=new n.PropertyCollection,this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=i.LanguageIdMode.AtStart}static fromOpenRange(){const o=new My;return o.properties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,t.AutoDetectSourceLanguagesOpenRangeOptionName),o}static fromLanguages(o){e.Contracts.throwIfArrayEmptyOrWhitespace(o,"languages");const a=new My;return a.properties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,o.join()),a}static fromSourceLanguageConfigs(o){if(o.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");const a=new My,c=[];return o.forEach(l=>{if(c.push(l.language),l.endpointId!==void 0&&l.endpointId!==""){const u=l.language+n.PropertyId.SpeechServiceConnection_EndpointId.toString();a.properties.setProperty(u,l.endpointId)}}),a.properties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,c.join()),a}get properties(){return this.privProperties}set mode(o){o===i.LanguageIdMode.Continuous?(this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=o}};return If.AutoDetectSourceLanguageConfig=r,If}var xx={};Object.defineProperty(xx,"__esModule",{value:!0});xx.AutoDetectSourceLanguageResult=void 0;const _3=_t;class _1{constructor(e,n){_3.Contracts.throwIfNullOrUndefined(e,"language"),_3.Contracts.throwIfNullOrUndefined(n,"languageDetectionConfidence"),this.privLanguage=e,this.privLanguageDetectionConfidence=n}static fromResult(e){return new _1(e.language,e.languageDetectionConfidence)}static fromConversationTranscriptionResult(e){return new _1(e.language,e.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}}xx.AutoDetectSourceLanguageResult=_1;var Cx={};Object.defineProperty(Cx,"__esModule",{value:!0});Cx.SourceLanguageConfig=void 0;const PX=_t;class C2{constructor(e,n){PX.Contracts.throwIfNullOrUndefined(e,"language"),this.privLanguage=e,this.privEndpointId=n}static fromLanguage(e,n){return new C2(e,n)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}}Cx.SourceLanguageConfig=C2;var z_={},w3;function IX(){return w3||(w3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpeakerRecognitionCancellationDetails=t.SpeakerRecognitionResult=t.SpeakerRecognitionResultType=void 0;const e=We(),n=ye();var i;(function(o){o[o.Verify=0]="Verify",o[o.Identify=1]="Identify"})(i=t.SpeakerRecognitionResultType||(t.SpeakerRecognitionResultType={}));class r{constructor(a,c=n.ResultReason.RecognizedSpeaker,l=n.CancellationErrorCode.NoError,u=""){this.privProperties=new n.PropertyCollection;const h=a.scenario==="TextIndependentIdentification"?i.Identify:i.Verify;this.privReason=c,this.privReason!==n.ResultReason.Canceled?h===i.Identify?(this.privProfileId=a.identificationResult.identifiedProfile.profileId,this.privScore=a.identificationResult.identifiedProfile.score,this.privReason=n.ResultReason.RecognizedSpeakers):(this.privScore=a.verificationResult.score,a.verificationResult.recognitionResult.toLowerCase()!=="accept"&&(this.privReason=n.ResultReason.NoMatch),a.verificationResult.profileId!==void 0&&a.verificationResult.profileId!==""&&(this.privProfileId=a.verificationResult.profileId)):(this.privErrorDetails=u,this.privProperties.setProperty(e.CancellationErrorCodePropertyName,n.CancellationErrorCode[l])),this.privProperties.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,JSON.stringify(a))}get properties(){return this.privProperties}get reason(){return this.privReason}get profileId(){return this.privProfileId}get errorDetails(){return this.privErrorDetails}get score(){return this.privScore}}t.SpeakerRecognitionResult=r;class s extends n.CancellationDetailsBase{constructor(a,c,l){super(a,c,l)}static fromResult(a){const c=n.CancellationReason.Error;let l=n.CancellationErrorCode.NoError;return a.properties&&(l=n.CancellationErrorCode[a.properties.getProperty(e.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.NoError])]),new s(c,a.errorDetails,l)}}t.SpeakerRecognitionCancellationDetails=s}(z_)),z_}var U_={},Ll={},E3;function iB(){if(E3)return Ll;E3=1,Object.defineProperty(Ll,"__esModule",{value:!0}),Ll.ConversationImpl=Ll.Conversation=void 0;const t=We(),e=ht(),n=_t,i=ye();let r=class{constructor(){}static createConversationAsync(a,c,l,u){n.Contracts.throwIfNullOrUndefined(a,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrUndefined(a.region,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),!a.subscriptionKey&&!a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceAuthorization_Token])&&n.Contracts.throwIfNullOrUndefined(a.subscriptionKey,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));let h,d,p;return typeof c=="string"?(h=new s(a,c),e.marshalPromiseToCallbacks((async()=>{})(),l,u)):(h=new s(a),d=c,p=l,h.createConversationAsync(()=>{d&&d()},f=>{p&&p(f)})),h}};Ll.Conversation=r;class s extends r{constructor(a,c){if(super(),this.privErrors=t.ConversationConnectionConfig.restErrors,this.onConnected=h=>{var d;this.privIsConnected=!0;try{(d=this.privConversationTranslator)!=null&&d.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{var d;try{(d=this.privConversationTranslator)!=null&&d.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,d)=>{var p;try{(p=this.privConversationTranslator)!=null&&p.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,d)}catch{}},this.onParticipantUpdateCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.id);if(p!==void 0){switch(d.key){case t.ConversationTranslatorCommandTypes.changeNickname:p.displayName=d.value;break;case t.ConversationTranslatorCommandTypes.setUseTTS:p.isUsingTts=d.value;break;case t.ConversationTranslatorCommandTypes.setProfanityFiltering:p.profanity=d.value;break;case t.ConversationTranslatorCommandTypes.setMute:p.isMuted=d.value;break;case t.ConversationTranslatorCommandTypes.setTranslateToLanguages:p.translateToLanguages=d.value;break}this.privParticipants.addOrUpdateParticipant(p),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,[this.toParticipant(p)],d.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,d)=>{try{this.privParticipants.participants.forEach(p=>p.isMuted=p.isHost?!1:d.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,this.toParticipants(!1),d.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,d)=>{try{const p=this.privParticipants.addOrUpdateParticipant(d.participant);p!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,[this.toParticipant(p)],d.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.participant.id);p!==void 0&&(this.privParticipants.deleteParticipant(d.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.LeftConversation,[this.toParticipant(p)],d.sessionId)))}catch{}},this.onTranslationReceived=(h,d)=>{try{switch(d.command){case t.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,d)=>{var p;try{if(d.sessionToken!==void 0&&d.sessionToken!==null&&(this.privRoom.token=d.sessionToken),this.privParticipants.participants=[...d.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),d.sessionId)),this.me.isHost){const f=(p=this.privConversationTranslator)==null?void 0:p.properties.getProperty(i.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(h,d)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,d)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new i.PropertyCollection,this.privManager=new t.ConversationManager,a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])||a.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage],t.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),c)this.privConversationId=c;else{a.targetLanguages.length===0&&a.addTargetLanguage(this.privLanguage),a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceResponse_ProfanityOption])||a.setProfanity(i.ProfanityOption.Masked);let d=a.getProperty(i.PropertyId[i.PropertyId.ConversationTranslator_Name]);d==null&&(d="Host"),n.Contracts.throwIfNullOrTooLong(d,"nickname",50),n.Contracts.throwIfNullOrTooShort(d,"nickname",2),a.setProperty(i.PropertyId[i.PropertyId.ConversationTranslator_Name],d)}this.privConfig=a;const u=a;n.Contracts.throwIfNull(u,"speechConfig"),this.privProperties=u.properties.clone(),this.privIsConnected=!1,this.privParticipants=new t.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var a,c;return(a=this.privParticipants.me)!=null&&a.isHost?!1:(c=this.privParticipants.me)==null?void 0:c.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){const a=this.conversationId,c=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),l={};for(const h of t.ConversationConnectionConfig.transcriptionEventKeys){const d=this.properties.getProperty(h,"");d!==""&&(l[h]=d)}return{id:a,participants:c,conversationProperties:l}}get canSend(){var a;return this.privIsConnected&&!((a=this.privParticipants.me)!=null&&a.isMuted)}get canSendAsHost(){var a;return this.privIsConnected&&((a=this.privParticipants.me)==null?void 0:a.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"authorizationToken"),this.privToken=a}set conversationTranslator(a){this.privConversationTranslator=a}onToken(a){this.privConversationTranslator.onToken(a)}createConversationAsync(a,c){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),c),this.privManager.createOrJoin(this.privProperties,void 0,l=>{l||this.handleError(new Error(this.privErrors.permissionDeniedConnect),c),this.privRoom=l,this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}startConversationAsync(a,c){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),c),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=t.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}addParticipantAsync(a,c,l){n.Contracts.throwIfNullOrUndefined(a,"Participant"),e.marshalPromiseToCallbacks(this.addParticipantImplAsync(a),c,l)}joinConversationAsync(a,c,l,u,h){try{n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","conversationId")),n.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrWhitespace(l,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,a,d=>{n.Contracts.throwIfNullOrUndefined(d,this.privErrors.permissionDeniedConnect),this.privRoom=d,this.privConfig.authorizationToken=d.cognitiveSpeechAuthToken,u&&u(d.cognitiveSpeechAuthToken)},d=>{this.handleError(d,h)})}catch(d){this.handleError(d,h)}}deleteConversationAsync(a,c){e.marshalPromiseToCallbacks(this.deleteConversationImplAsync(),a,c)}async deleteConversationImplAsync(){n.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),n.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endConversationAsync(a,c){e.marshalPromiseToCallbacks(this.endConversationImplAsync(),a,c)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}muteAllParticipantsAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}muteParticipantAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),l),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!0),()=>{this.handleCallback(c,l)},h=>{this.handleError(h,l)})}catch(u){this.handleError(u,l)}}removeParticipantAsync(a,c,l){try{if(n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&a.hasOwnProperty("id"))e.marshalPromiseToCallbacks(this.removeParticipantImplAsync(a),c,l);else{n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),l);let u="";typeof a=="string"?u=a:a.hasOwnProperty("id")?u=a.id:a.hasOwnProperty("userId")&&(u=a.userId),n.Contracts.throwIfNullOrWhitespace(u,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(d=>d.id===u)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(u),()=>{this.handleCallback(c,l)},d=>{this.handleError(d,l)})}}catch(u){this.handleError(u,l)}}unlockConversationAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}unmuteAllParticipantsAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}unmuteParticipantAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),l),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!1),()=>{this.handleCallback(c,l)},h=>{this.handleError(h,l)})}catch(u){this.handleError(u,l)}}sendTextMessageAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","message")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),a.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(a),()=>{this.handleCallback(c,l)},u=>{this.handleError(u,l)})}catch(u){this.handleError(u,l)}}setTranslatedLanguagesAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfArrayEmptyOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","languages")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(a),()=>{this.handleCallback(c,l)},u=>{this.handleError(u,l)})}catch(u){this.handleError(u,l)}}changeNicknameAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(a),()=>{this.handleCallback(c,l)},u=>{this.handleError(u,l)})}catch(u){this.handleError(u,l)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(a){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await a.enforceAudioGating(),this.privTranscriberRecognizer=a,this.privTranscriberRecognizer.conversation=this}getKeepAlive(){const a=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:a,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(a){if(this.privParticipants.addOrUpdateParticipant(a)!==void 0&&this.privTranscriberRecognizer){const l=this.conversationInfo;return l.participants=[a],this.privTranscriberRecognizer.pushConversationEvent(l,"join")}}removeParticipantImplAsync(a){this.privParticipants.deleteParticipant(a.id);const c=this.conversationInfo;return c.participants=[a],this.privTranscriberRecognizer.pushConversationEvent(c,"leave")}async close(a){var c;try{this.privIsConnected=!1,await((c=this.privConversationRecognizer)==null?void 0:c.close()),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(l){throw l}a&&this.dispose()}handleCallback(a,c){if(a){try{a()}catch(l){c&&c(l)}a=void 0}}handleError(a,c){if(c)if(a instanceof Error){const l=a;c(l.name+": "+l.message)}else c(a)}toParticipants(a){const c=this.privParticipants.participants.map(l=>this.toParticipant(l));return a?c:c.filter(l=>l.isHost===!1)}toParticipant(a){return new i.Participant(a.id,a.avatar,a.displayName,a.isHost,a.isMuted,a.isUsingTts,a.preferredLanguage,a.voice)}getMuteAllCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMuteCommand(a,c){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMute,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:c})}getLockCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getEjectCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.ejectParticipant,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getChangeNicknameCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"nickname"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.changeNickname,nickname:a,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMessageCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),n.Contracts.throwIfNullOrWhitespace(a,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:a,type:t.ConversationTranslatorMessageTypes.instantMessage})}}return Ll.ConversationImpl=s,Ll}var _x={};Object.defineProperty(_x,"__esModule",{value:!0});_x.ConversationCommon=void 0;class MX{constructor(e){this.privAudioConfig=e}handleCallback(e,n){if(e){try{e()}catch(i){n&&n(i)}e=void 0}}handleError(e,n){if(n)if(e instanceof Error){const i=e;n(i.name+": "+i.message)}else n(e)}}_x.ConversationCommon=MX;var Mf={},R3;function kX(){if(R3)return Mf;R3=1,Object.defineProperty(Mf,"__esModule",{value:!0}),Mf.ConversationExpirationEventArgs=void 0;const t=ye();let e=class extends t.SessionEventArgs{constructor(i,r){super(r),this.privExpirationTime=i}get expirationTime(){return this.privExpirationTime}};return Mf.ConversationExpirationEventArgs=e,Mf}var kf={},b3;function LX(){if(b3)return kf;b3=1,Object.defineProperty(kf,"__esModule",{value:!0}),kf.ConversationParticipantsChangedEventArgs=void 0;const t=ye();let e=class extends t.SessionEventArgs{constructor(i,r,s){super(s),this.privReason=i,this.privParticipant=r}get reason(){return this.privReason}get participants(){return this.privParticipant}};return kf.ConversationParticipantsChangedEventArgs=e,kf}var Lf={},T3;function DX(){if(T3)return Lf;T3=1,Object.defineProperty(Lf,"__esModule",{value:!0}),Lf.ConversationTranslationCanceledEventArgs=void 0;const t=P0();let e=class extends t.CancellationEventArgsBase{};return Lf.ConversationTranslationCanceledEventArgs=e,Lf}var Df={},A3;function NX(){if(A3)return Df;A3=1,Object.defineProperty(Df,"__esModule",{value:!0}),Df.ConversationTranslationEventArgs=void 0;const t=ye();let e=class extends t.RecognitionEventArgs{constructor(i,r,s){super(r,s),this.privResult=i}get result(){return this.privResult}};return Df.ConversationTranslationEventArgs=e,Df}var Nf={},P3;function OX(){if(P3)return Nf;P3=1,Object.defineProperty(Nf,"__esModule",{value:!0}),Nf.ConversationTranslationResult=void 0;const t=UU();let e=class extends t.TranslationRecognitionResult{constructor(i,r,s,o,a,c,l,u,h,d,p){super(r,o,a,c,l,u,void 0,void 0,h,d,p),this.privId=i,this.privOrigLang=s}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}};return Nf.ConversationTranslationResult=e,Nf}var B_={},Of={},M0={};Object.defineProperty(M0,"__esModule",{value:!0});M0.StringUtils=void 0;class FX{static formatString(e,n){if(!e)return"";if(!n)return e;let i="",r="";const s=c=>{i+=c},o=c=>{r+=c};let a=s;for(let c=0;c<e.length;c++){const l=e[c],u=c+1<e.length?e[c+1]:"";switch(l){case"{":u==="{"?(a("{"),c++):a=o;break;case"}":u==="}"?(a("}"),c++):(n.hasOwnProperty(r)&&(i+=n[r]),a=s,r="");break;default:a(l);break}}return i}}M0.StringUtils=FX;var I3;function zX(){if(I3)return Of;I3=1,Object.defineProperty(Of,"__esModule",{value:!0}),Of.ConversationTranslatorConnectionFactory=void 0;const t=zi(),e=M0,n=_t,i=ye(),r=Fi,s=Do,o=No(),a=We();let c=class rB extends o.ConnectionFactoryBase{constructor(u){super(),n.Contracts.throwIfNullOrUndefined(u,"convGetter"),this.privConvGetter=u}create(u,h,d){const p=u.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase()==="TRUE",f=this.privConvGetter().room,v=f.cognitiveSpeechRegion||u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region,""),g={hostSuffix:o.ConnectionFactoryBase.getHostSuffix(v),path:rB.CTS_VIRT_MIC_PATH,region:encodeURIComponent(v)};g[s.QueryParameterNames.Language]=encodeURIComponent(u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,"")),g[s.QueryParameterNames.CtsMeetingId]=encodeURIComponent(f.roomId),g[s.QueryParameterNames.CtsDeviceId]=encodeURIComponent(f.participantId),g[s.QueryParameterNames.CtsIsParticipant]=f.isHost?"":"&"+s.QueryParameterNames.CtsIsParticipant;let m="";const y={},S={};if(p){m=u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint),m||(m="wss://"+u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"),m=e.StringUtils.formatString(m,g);const w=new URL(m);w.searchParams.forEach((E,b)=>{y[b]=E}),new a.TranscriberConnectionFactory().setQueryParams(y,u,m),y[s.QueryParameterNames.CtsMeetingId]=g[s.QueryParameterNames.CtsMeetingId],y[s.QueryParameterNames.CtsDeviceId]=g[s.QueryParameterNames.CtsDeviceId],f.isHost||(y[s.QueryParameterNames.CtsIsParticipant]=""),s.QueryParameterNames.Format in y||(y[s.QueryParameterNames.Format]="simple"),w.searchParams.forEach((E,b)=>{w.searchParams.set(b,y[b]),delete y[b]}),m=w.toString()}else{const w=new a.TranslationConnectionFactory;m=w.getEndpointUrl(u,!0),m=e.StringUtils.formatString(m,g),w.setQueryParams(y,u,m)}S[r.HeaderNames.ConnectionId]=d,S[t.RestConfigBase.configParams.token]=f.token,h.token&&(S[h.headerName]=h.token);const x=u.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase()==="TRUE";return new t.WebsocketConnection(m,y,S,new a.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(u),x,d)}};return Of.ConversationTranslatorConnectionFactory=c,c.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio",Of}var M3;function UX(){return M3||(M3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationTranslator=t.SpeechState=void 0;const e=We(),n=zX(),i=ht(),r=_t,s=ye(),o=iB(),a=_2();var c;(function(h){h[h.Inactive=0]="Inactive",h[h.Connecting=1]="Connecting",h[h.Connected=2]="Connected"})(c=t.SpeechState||(t.SpeechState={}));class l extends s.TranslationRecognizer{constructor(d,p,f,v){super(d,p,new n.ConversationTranslatorConnectionFactory(v)),this.privSpeechState=c.Inactive,f&&(this.privTranslator=f,this.sessionStarted=()=>{this.privSpeechState=c.Connected},this.sessionStopped=()=>{this.privSpeechState=c.Inactive},this.recognizing=(g,m)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,m)},this.recognized=async(g,m)=>{var y;(y=m.result)!=null&&y.errorDetails?(await this.cancelSpeech(),this.fireCancelEvent(m.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,m)},this.canceled=async()=>{if(this.privSpeechState!==c.Inactive)try{await this.cancelSpeech()}catch{this.privSpeechState=c.Inactive}})}get state(){return this.privSpeechState}set state(d){this.privSpeechState=d}set authentication(d){this.privReco.authentication=d}onConnection(){this.privSpeechState=c.Connected}async onCancelSpeech(){this.privSpeechState=c.Inactive,await this.cancelSpeech()}fireCancelEvent(d){try{if(this.privTranslator.canceled){const p=new a.ConversationTranslationCanceledEventArgs(s.CancellationReason.Error,d,s.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,p)}}catch{}}async cancelSpeech(){var d;try{this.stopContinuousRecognitionAsync(),await((d=this.privReco)==null?void 0:d.disconnect()),this.privSpeechState=c.Inactive}catch{}}}class u extends a.ConversationCommon{constructor(d){super(d),this.privErrors=e.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new s.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){var d;return(d=this.privConversation)==null?void 0:d.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===c.Connected||this.privCTRecognizer.state===c.Connecting||this.privConversation.isMutedByHost)}onToken(d){this.privCTRecognizer.authentication=d}setServiceProperty(d,p){const f=JSON.parse(this.privProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));f[d]=p,this.privProperties.setProperty(e.ServicePropertiesPropertyName,JSON.stringify(f))}joinConversationAsync(d,p,f,v,g){try{if(typeof d=="string"){r.Contracts.throwIfNullOrUndefined(d,this.privErrors.invalidArgs.replace("{arg}","conversation id")),r.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),g);let m=f;(m==null||m==="")&&(m=e.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=s.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(s.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(m),this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_RecoLanguage],m),this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.ConversationTranslator_Name],p);const y=[s.PropertyId.SpeechServiceConnection_Host,s.PropertyId.ConversationTranslator_Host,s.PropertyId.SpeechServiceConnection_Endpoint,s.PropertyId.SpeechServiceConnection_ProxyHostName,s.PropertyId.SpeechServiceConnection_ProxyPassword,s.PropertyId.SpeechServiceConnection_ProxyPort,s.PropertyId.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(const x of y){const w=this.privProperties.getProperty(x);if(w){const C=typeof x=="string"?x:s.PropertyId[x];this.privSpeechTranslationConfig.setProperty(C,w)}}const S=JSON.parse(this.privProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));for(const x of Object.keys(S))this.privSpeechTranslationConfig.setServiceProperty(x,S[x],s.ServicePropertyChannel.UriQueryParameter);this.privConversation=new o.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(d,p,m,x=>{x||this.handleError(new Error(this.privErrors.permissionDeniedConnect),g),this.privSpeechTranslationConfig.authorizationToken=x,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync(()=>{this.handleCallback(v,g)},w=>{this.handleError(w,g)})},x=>{this.handleError(x,g)})}else typeof d=="object"?(r.Contracts.throwIfNullOrUndefined(d,this.privErrors.invalidArgs.replace("{arg}","conversation id")),r.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(s.PropertyId.ConversationTranslator_Name,p),this.privConversation=d,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,r.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),r.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=d.config,this.handleCallback(f,v)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),v)}catch(m){this.handleError(m,typeof f=="string"?g:v)}}leaveConversationAsync(d,p){i.marshalPromiseToCallbacks((async()=>{await this.cancelSpeech(),await this.privConversation.endConversationImplAsync(),await this.privConversation.deleteConversationImplAsync(),this.dispose()})(),d,p)}sendTextMessageAsync(d,p,f){try{r.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),r.Contracts.throwIfNullOrWhitespace(d,this.privErrors.invalidArgs.replace("{arg}",d)),this.privConversation.sendTextMessageAsync(d,p,f)}catch(v){this.handleError(v,f)}}startTranscribingAsync(d,p){i.marshalPromiseToCallbacks((async()=>{try{r.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),r.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privCTRecognizer===void 0&&await this.connectTranslatorRecognizer(),r.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),p),await this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(f){throw this.privIsSpeaking=!1,await this.cancelSpeech(),f}})(),d,p)}stopTranscribingAsync(d,p){i.marshalPromiseToCallbacks((async()=>{try{if(!this.privIsSpeaking){await this.cancelSpeech();return}this.privIsSpeaking=!1,await new Promise((f,v)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(f,v)})}catch{await this.cancelSpeech()}})(),d,p)}isDisposed(){return this.privIsDisposed}dispose(d,p,f){i.marshalPromiseToCallbacks((async()=>{this.isDisposed&&!this.privIsSpeaking||(await this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})(),p,f)}async cancelSpeech(){var d;try{this.privIsSpeaking=!1,await((d=this.privCTRecognizer)==null?void 0:d.onCancelSpeech()),this.privCTRecognizer=void 0}catch{}}async connectTranslatorRecognizer(){try{this.privAudioConfig===void 0&&(this.privAudioConfig=s.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Key],"");const d=()=>this.privConversation;this.privCTRecognizer=new l(this.privSpeechTranslationConfig,this.privAudioConfig,this,d)}catch(d){throw await this.cancelSpeech(),d}}startContinuousRecognition(){return new Promise((d,p)=>{this.privCTRecognizer.startContinuousRecognitionAsync(d,p)})}}t.ConversationTranslator=u}(B_)),B_}var Ff={},k3;function BX(){if(k3)return Ff;k3=1,Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.ConversationTranscriber=void 0;const t=We(),e=ht(),n=_t,i=ye();let r=class sB extends i.Recognizer{constructor(o,a){const c=o;n.Contracts.throwIfNull(c,"speechConfig"),n.Contracts.throwIfNullOrWhitespace(c.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),super(a,c.properties,new t.ConversationTranscriberConnectionFactory),this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privDisposedRecognizer=!1}static FromConfig(o,a,c){const l=o;return a.properties.mergeTo(l.properties),new sB(o,c)}get endpointId(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){n.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple])===i.OutputFormat[i.OutputFormat.Simple]?i.OutputFormat.Simple:i.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(o,a){e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,a)}stopTranscribingAsync(o,a){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}close(o,a){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}async dispose(o){this.privDisposedRecognizer||(o&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(o))}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,a,c,l){const u=c;return l.isSpeakerDiarizationEnabled=!0,new t.ConversationTranscriptionServiceRecognizer(o,a,u,l,this)}};return Ff.ConversationTranscriber=r,Ff}var Dl={},L3;function $X(){if(L3)return Dl;L3=1,Object.defineProperty(Dl,"__esModule",{value:!0}),Dl.Participant=Dl.User=void 0;const t=ye();class e{constructor(r){this.privUserId=r}get userId(){return this.privUserId}}Dl.User=e;class n{constructor(r,s,o,a,c,l,u,h){this.privId=r,this.privAvatar=s,this.privDisplayName=o,this.privIsHost=a,this.privIsMuted=c,this.privIsUsingTts=l,this.privPreferredLanguage=u,this.privVoice=h,this.privProperties=new t.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(r,s,o){return new n(r,"",r,!1,!1,!1,s,o)}}return Dl.Participant=n,Dl}var oB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantChangedReason=void 0,function(e){e[e.JoinedConversation=0]="JoinedConversation",e[e.LeftConversation=1]="LeftConversation",e[e.Updated=2]="Updated"}(t.ParticipantChangedReason||(t.ParticipantChangedReason={}))})(oB);var Nl={},D3;function HX(){if(D3)return Nl;D3=1,Object.defineProperty(Nl,"__esModule",{value:!0}),Nl.MeetingImpl=Nl.Meeting=void 0;const t=We(),e=ht(),n=_t,i=ye();let r=class{constructor(){}static createMeetingAsync(a,c,l,u){if(n.Contracts.throwIfNullOrUndefined(a,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrUndefined(a.region,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),n.Contracts.throwIfNull(c,"meetingId"),c.length===0)throw new Error("meetingId cannot be empty");!a.subscriptionKey&&!a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceAuthorization_Token])&&n.Contracts.throwIfNullOrUndefined(a.subscriptionKey,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));const h=new s(a,c);return e.marshalPromiseToCallbacks((async()=>{})(),l,u),h}};Nl.Meeting=r;class s extends r{constructor(a,c){super(),this.privErrors=t.ConversationConnectionConfig.restErrors,this.onConnected=h=>{var d;this.privIsConnected=!0;try{(d=this.privConversationTranslator)!=null&&d.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{var d;try{(d=this.privConversationTranslator)!=null&&d.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,d)=>{var p;try{(p=this.privConversationTranslator)!=null&&p.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,d)}catch{}},this.onParticipantUpdateCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.id);if(p!==void 0){switch(d.key){case t.ConversationTranslatorCommandTypes.changeNickname:p.displayName=d.value;break;case t.ConversationTranslatorCommandTypes.setUseTTS:p.isUsingTts=d.value;break;case t.ConversationTranslatorCommandTypes.setProfanityFiltering:p.profanity=d.value;break;case t.ConversationTranslatorCommandTypes.setMute:p.isMuted=d.value;break;case t.ConversationTranslatorCommandTypes.setTranslateToLanguages:p.translateToLanguages=d.value;break}this.privParticipants.addOrUpdateParticipant(p),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,[this.toParticipant(p)],d.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,d)=>{try{this.privParticipants.participants.forEach(p=>p.isMuted=p.isHost?!1:d.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,this.toParticipants(!1),d.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,d)=>{try{const p=this.privParticipants.addOrUpdateParticipant(d.participant);p!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,[this.toParticipant(p)],d.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.participant.id);p!==void 0&&(this.privParticipants.deleteParticipant(d.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.LeftConversation,[this.toParticipant(p)],d.sessionId)))}catch{}},this.onTranslationReceived=(h,d)=>{try{switch(d.command){case t.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,d)=>{var p;try{if(d.sessionToken!==void 0&&d.sessionToken!==null&&(this.privRoom.token=d.sessionToken),this.privParticipants.participants=[...d.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),d.sessionId)),this.me.isHost){const f=(p=this.privConversationTranslator)==null?void 0:p.properties.getProperty(i.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(h,d)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,d)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new i.PropertyCollection,this.privManager=new t.ConversationManager,a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])||a.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage],t.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=c,this.privConfig=a;const u=a;n.Contracts.throwIfNull(u,"speechConfig"),this.privProperties=u.properties.clone(),this.privIsConnected=!1,this.privParticipants=new t.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var a,c;return(a=this.privParticipants.me)!=null&&a.isHost?!1:(c=this.privParticipants.me)==null?void 0:c.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){const a=this.meetingId,c=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),l={};for(const h of t.ConversationConnectionConfig.transcriptionEventKeys){const d=this.properties.getProperty(h,"");d!==""&&(l[h]=d)}return{id:a,participants:c,meetingProperties:l}}get canSend(){var a;return this.privIsConnected&&!((a=this.privParticipants.me)!=null&&a.isMuted)}get canSendAsHost(){var a;return this.privIsConnected&&((a=this.privParticipants.me)==null?void 0:a.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"authorizationToken"),this.privToken=a}createMeetingAsync(a,c){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),c),this.privManager.createOrJoin(this.privProperties,void 0,l=>{l||this.handleError(new Error(this.privErrors.permissionDeniedConnect),c),this.privRoom=l,this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}startMeetingAsync(a,c){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),c),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}addParticipantAsync(a,c,l){n.Contracts.throwIfNullOrUndefined(a,"Participant"),e.marshalPromiseToCallbacks(this.addParticipantImplAsync(a),c,l)}joinMeetingAsync(a,c,l,u,h){try{n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","conversationId")),n.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrWhitespace(l,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,a,d=>{n.Contracts.throwIfNullOrUndefined(d,this.privErrors.permissionDeniedConnect),this.privRoom=d,this.privConfig.authorizationToken=d.cognitiveSpeechAuthToken,u&&u(d.cognitiveSpeechAuthToken)},d=>{this.handleError(d,h)})}catch(d){this.handleError(d,h)}}deleteMeetingAsync(a,c){e.marshalPromiseToCallbacks(this.deleteMeetingImplAsync(),a,c)}async deleteMeetingImplAsync(){n.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),n.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endMeetingAsync(a,c){e.marshalPromiseToCallbacks(this.endMeetingImplAsync(),a,c)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}muteAllParticipantsAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}muteParticipantAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),l),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!0),()=>{this.handleCallback(c,l)},h=>{this.handleError(h,l)})}catch(u){this.handleError(u,l)}}removeParticipantAsync(a,c,l){try{if(n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&a.hasOwnProperty("id"))e.marshalPromiseToCallbacks(this.removeParticipantImplAsync(a),c,l);else{n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),l);let u="";typeof a=="string"?u=a:a.hasOwnProperty("id")?u=a.id:a.hasOwnProperty("userId")&&(u=a.userId),n.Contracts.throwIfNullOrWhitespace(u,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(d=>d.id===u)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(u),()=>{this.handleCallback(c,l)},d=>{this.handleError(d,l)})}}catch(u){this.handleError(u,l)}}unlockMeetingAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}unmuteAllParticipantsAsync(a,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(a,c)},l=>{this.handleError(l,c)})}catch(l){this.handleError(l,c)}}unmuteParticipantAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),l),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!1),()=>{this.handleCallback(c,l)},h=>{this.handleError(h,l)})}catch(u){this.handleError(u,l)}}sendTextMessageAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","message")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),a.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(a),()=>{this.handleCallback(c,l)},u=>{this.handleError(u,l)})}catch(u){this.handleError(u,l)}}setTranslatedLanguagesAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfArrayEmptyOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","languages")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(a),()=>{this.handleCallback(c,l)},u=>{this.handleError(u,l)})}catch(u){this.handleError(u,l)}}changeNicknameAsync(a,c,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(a),()=>{this.handleCallback(c,l)},u=>{this.handleError(u,l)})}catch(u){this.handleError(u,l)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(a){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await a.enforceAudioGating(),this.privTranscriberRecognizer=a,this.privTranscriberRecognizer.meeting=this}getKeepAlive(){const a=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:a,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(a){if(this.privParticipants.addOrUpdateParticipant(a)!==void 0&&this.privTranscriberRecognizer){const l=this.meetingInfo;return l.participants=[a],this.privTranscriberRecognizer.pushMeetingEvent(l,"join")}}removeParticipantImplAsync(a){this.privParticipants.deleteParticipant(a.id);const c=this.meetingInfo;return c.participants=[a],this.privTranscriberRecognizer.pushMeetingEvent(c,"leave")}async close(a){var c;try{this.privIsConnected=!1,await((c=this.privConversationRecognizer)==null?void 0:c.close()),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(l){throw l}a&&this.dispose()}handleCallback(a,c){if(a){try{a()}catch(l){c&&c(l)}a=void 0}}handleError(a,c){if(c)if(a instanceof Error){const l=a;c(l.name+": "+l.message)}else c(a)}toParticipants(a){const c=this.privParticipants.participants.map(l=>this.toParticipant(l));return a?c:c.filter(l=>l.isHost===!1)}toParticipant(a){return new i.Participant(a.id,a.avatar,a.displayName,a.isHost,a.isMuted,a.isUsingTts,a.preferredLanguage,a.voice)}getMuteAllCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingd"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMuteCommand(a,c){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMute,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:c})}getLockCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getEjectCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.ejectParticipant,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getChangeNicknameCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(a,"nickname"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.changeNickname,nickname:a,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMessageCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),n.Contracts.throwIfNullOrWhitespace(a,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:a,type:t.ConversationTranslatorMessageTypes.instantMessage})}}return Nl.MeetingImpl=s,Nl}var zf={},N3;function VX(){if(N3)return zf;N3=1,Object.defineProperty(zf,"__esModule",{value:!0}),zf.MeetingTranscriptionCanceledEventArgs=void 0;const t=P0();class e extends t.CancellationEventArgsBase{}return zf.MeetingTranscriptionCanceledEventArgs=e,zf}var Uf={},O3;function jX(){if(O3)return Uf;O3=1,Object.defineProperty(Uf,"__esModule",{value:!0}),Uf.MeetingTranscriber=void 0;const t=We(),e=ht(),n=_t,i=ye(),r=_2();let s=class{constructor(a){this.privAudioConfig=a,this.privProperties=new i.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return i.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,a)}joinMeetingAsync(a,c,l){const u=a;n.Contracts.throwIfNullOrUndefined(r.MeetingImpl,"Meeting"),this.privRecognizer=new t.TranscriberRecognizer(a.config,this.privAudioConfig),n.Contracts.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectMeetingCallbacks(this),e.marshalPromiseToCallbacks(u.connectTranscriberRecognizer(this.privRecognizer),c,l)}startTranscribingAsync(a,c){this.privRecognizer.startContinuousRecognitionAsync(a,c)}stopTranscribingAsync(a,c){this.privRecognizer.stopContinuousRecognitionAsync(a,c)}leaveMeetingAsync(a,c){this.privRecognizer.disconnectCallbacks(),e.marshalPromiseToCallbacks((async()=>{})(),a,c)}close(a,c){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),a,c)}async dispose(a){this.privDisposedRecognizer||(this.privRecognizer&&(await this.privRecognizer.close(),this.privRecognizer=void 0),a&&(this.privDisposedRecognizer=!0))}};return Uf.MeetingTranscriber=s,Uf}var Bf={},F3;function WX(){if(F3)return Bf;F3=1,Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.ConversationTranscriptionResult=void 0;const t=ye();let e=class extends t.RecognitionResult{constructor(i,r,s,o,a,c,l,u,h,d,p){super(i,r,s,o,a,c,l,h,d,p),this.privSpeakerId=u}get speakerId(){return this.privSpeakerId}};return Bf.ConversationTranscriptionResult=e,Bf}var z3;function _2(){return z3||(z3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=iB();Object.defineProperty(t,"Conversation",{enumerable:!0,get:function(){return e.Conversation}}),Object.defineProperty(t,"ConversationImpl",{enumerable:!0,get:function(){return e.ConversationImpl}});var n=_x;Object.defineProperty(t,"ConversationCommon",{enumerable:!0,get:function(){return n.ConversationCommon}});var i=kX();Object.defineProperty(t,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return i.ConversationExpirationEventArgs}});var r=LX();Object.defineProperty(t,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return r.ConversationParticipantsChangedEventArgs}});var s=DX();Object.defineProperty(t,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return s.ConversationTranslationCanceledEventArgs}});var o=NX();Object.defineProperty(t,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return o.ConversationTranslationEventArgs}});var a=OX();Object.defineProperty(t,"ConversationTranslationResult",{enumerable:!0,get:function(){return a.ConversationTranslationResult}});var c=UX();Object.defineProperty(t,"ConversationTranslator",{enumerable:!0,get:function(){return c.ConversationTranslator}});var l=BX();Object.defineProperty(t,"ConversationTranscriber",{enumerable:!0,get:function(){return l.ConversationTranscriber}});var u=$X();Object.defineProperty(t,"Participant",{enumerable:!0,get:function(){return u.Participant}}),Object.defineProperty(t,"User",{enumerable:!0,get:function(){return u.User}});var h=oB;Object.defineProperty(t,"ParticipantChangedReason",{enumerable:!0,get:function(){return h.ParticipantChangedReason}});var d=HX();Object.defineProperty(t,"Meeting",{enumerable:!0,get:function(){return d.Meeting}}),Object.defineProperty(t,"MeetingImpl",{enumerable:!0,get:function(){return d.MeetingImpl}});var p=VX();Object.defineProperty(t,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return p.MeetingTranscriptionCanceledEventArgs}});var f=jX();Object.defineProperty(t,"MeetingTranscriber",{enumerable:!0,get:function(){return f.MeetingTranscriber}});var v=WX();Object.defineProperty(t,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return v.ConversationTranscriptionResult}})}(U_)),U_}var Ol={},U3;function w2(){if(U3)return Ol;U3=1,Object.defineProperty(Ol,"__esModule",{value:!0}),Ol.SynthesisRequest=Ol.Synthesizer=void 0;const t=We(),e=ht(),n=_t,i=ye();let r=class aB{constructor(a){const c=a;n.Contracts.throwIfNull(c,"speechConfig"),this.privProperties=c.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new e.Queue}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,a)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===t.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(a){const c={"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-AvaMultilingualNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"};let l=this.properties.getProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage,"en-US"),u=this.properties.getProperty(i.PropertyId.SpeechServiceConnection_SynthVoice,""),h=aB.XMLEncode(a);return this.autoDetectSourceLanguage?l="en-US":u=u||c[l],u&&(h=`<voice name='${u}'>${h}</voice>`),h=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${l}'>${h}</speak>`,h}async dispose(a){this.privDisposed||(a&&this.privAdapter&&await this.privAdapter.dispose(),this.privDisposed=!0)}async adapterSpeak(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;const a=await this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(a.text,a.isSSML,a.requestId,a.cb,a.err,a.dataStream)}}createSynthesizerConfig(a){return new t.SynthesizerConfig(a,this.privProperties)}implCommonSynthesizeSetup(){let a=typeof window<"u"?"Browser":"Node",c="unknown",l="unknown";typeof navigator<"u"&&(a=a+"/"+navigator.platform,c=navigator.userAgent,l=navigator.appVersion);const u=this.createSynthesizerConfig(new t.SpeechServiceConfig(new t.Context(new t.OS(a,c,l)))),h=this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Key,void 0),d=h&&h!==""?new t.CognitiveSubscriptionKeyAuthentication(h):new t.CognitiveTokenAuthentication(()=>{const p=this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(p)},()=>{const p=this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(p)});this.privAdapter=this.createSynthesisAdapter(d,this.privConnectionFactory,u),this.privRestAdapter=this.createRestSynthesisAdapter(d,u)}static XMLEncode(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};Ol.Synthesizer=r;class s{constructor(a,c,l,u,h,d){this.requestId=a,this.text=c,this.isSSML=l,this.cb=u,this.err=h,this.dataStream=d}}return Ol.SynthesisRequest=s,Ol}var $f={},B3;function GX(){if(B3)return $f;B3=1,Object.defineProperty($f,"__esModule",{value:!0}),$f.SpeechSynthesizer=void 0;const t=We(),e=ht(),n=A0,i=xl,r=Vi,s=_t,o=ye(),a=w2();let c=class cB extends o.Synthesizer{constructor(u,h){super(u),h!==null&&(h===void 0?this.audioConfig=typeof window>"u"?void 0:o.AudioConfig.fromDefaultSpeakerOutput():this.audioConfig=h),this.privConnectionFactory=new t.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(u,h,d){const p=u;return h.properties.mergeTo(p.properties),new cB(u,d)}speakTextAsync(u,h,d,p){this.speakImpl(u,!1,h,d,p)}speakSsmlAsync(u,h,d,p){this.speakImpl(u,!0,h,d,p)}async getVoicesAsync(u=""){return this.getVoices(u)}close(u,h){s.Contracts.throwIfDisposed(this.privDisposed),e.marshalPromiseToCallbacks(this.dispose(!0),u,h)}get internalData(){return this.privAdapter}createSynthesisAdapter(u,h,d){return new t.SpeechSynthesisAdapter(u,h,d,this,this.audioConfig)}createRestSynthesisAdapter(u,h){return new t.SynthesisRestAdapter(h,u)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(o.SpeechSynthesisOutputFormat[this.properties.getProperty(o.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(u,h,d,p,f){try{s.Contracts.throwIfDisposed(this.privDisposed);const v=e.createNoDashGuid();let g;f instanceof o.PushAudioOutputStreamCallback?g=new r.PushAudioOutputStreamImpl(f):f instanceof o.PullAudioOutputStream?g=f:f!==void 0?g=new n.AudioFileWriter(f):g=void 0,this.synthesisRequestQueue.enqueue(new a.SynthesisRequest(v,u,h,m=>{if(this.privSynthesizing=!1,d)try{d(m)}catch(y){p&&p(y)}d=void 0,this.adapterSpeak().catch(()=>{})},m=>{p&&p(m)},g)),this.adapterSpeak().catch(()=>{})}catch(v){if(p)if(v instanceof Error){const g=v;p(g.name+": "+g.message)}else p(v);this.dispose(!0).catch(()=>{})}}async getVoices(u){const h=e.createNoDashGuid(),d=await this.privRestAdapter.getVoicesList(h);if(d.ok&&Array.isArray(d.json)){let p=d.json;return u&&u.length>0&&(p=p.filter(f=>!!f.Locale&&f.Locale.toLowerCase()===u.toLowerCase())),new o.SynthesisVoicesResult(h,p,void 0)}else return new o.SynthesisVoicesResult(h,void 0,`Error: ${d.status}: ${d.statusText}`)}};return $f.SpeechSynthesizer=c,$f}var wx={};Object.defineProperty(wx,"__esModule",{value:!0});wx.SynthesisResult=void 0;class qX{constructor(e,n,i,r){this.privResultId=e,this.privReason=n,this.privErrorDetails=i,this.privProperties=r}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}}wx.SynthesisResult=qX;var Hf={},$3;function XX(){if($3)return Hf;$3=1,Object.defineProperty(Hf,"__esModule",{value:!0}),Hf.SpeechSynthesisResult=void 0;const t=ye();let e=class extends t.SynthesisResult{constructor(i,r,s,o,a,c){super(i,r,o,a),this.privAudioData=s,this.privAudioDuration=c}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}};return Hf.SpeechSynthesisResult=e,Hf}var Ex={};Object.defineProperty(Ex,"__esModule",{value:!0});Ex.SpeechSynthesisEventArgs=void 0;class KX{constructor(e){this.privResult=e}get result(){return this.privResult}}Ex.SpeechSynthesisEventArgs=KX;var Rx={};Object.defineProperty(Rx,"__esModule",{value:!0});Rx.SpeechSynthesisWordBoundaryEventArgs=void 0;class YX{constructor(e,n,i,r,s,o){this.privAudioOffset=e,this.privDuration=n,this.privText=i,this.privWordLength=r,this.privTextOffset=s,this.privBoundaryType=o}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}}Rx.SpeechSynthesisWordBoundaryEventArgs=YX;var bx={};Object.defineProperty(bx,"__esModule",{value:!0});bx.SpeechSynthesisBookmarkEventArgs=void 0;class JX{constructor(e,n){this.privAudioOffset=e,this.privText=n}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}}bx.SpeechSynthesisBookmarkEventArgs=JX;var Tx={};Object.defineProperty(Tx,"__esModule",{value:!0});Tx.SpeechSynthesisVisemeEventArgs=void 0;class QX{constructor(e,n,i){this.privAudioOffset=e,this.privVisemeId=n,this.privAnimation=i}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}}Tx.SpeechSynthesisVisemeEventArgs=QX;var lB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechSynthesisBoundaryType=void 0,function(e){e.Word="WordBoundary",e.Punctuation="PunctuationBoundary",e.Sentence="SentenceBoundary"}(t.SpeechSynthesisBoundaryType||(t.SpeechSynthesisBoundaryType={}))})(lB);var Vf={},H3;function ZX(){if(H3)return Vf;H3=1,Object.defineProperty(Vf,"__esModule",{value:!0}),Vf.SynthesisVoicesResult=void 0;const t=ye();let e=class extends t.SynthesisResult{constructor(i,r,s){if(Array.isArray(r)){super(i,t.ResultReason.VoicesListRetrieved,void 0,new t.PropertyCollection),this.privVoices=[];for(const o of r)this.privVoices.push(new t.VoiceInfo(o))}else super(i,t.ResultReason.Canceled,s||"Error information unavailable",new t.PropertyCollection)}get voices(){return this.privVoices}};return Vf.SynthesisVoicesResult=e,Vf}var uB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceInfo=t.SynthesisVoiceType=t.SynthesisVoiceGender=void 0;var e;(function(s){s[s.Unknown=0]="Unknown",s[s.Female=1]="Female",s[s.Male=2]="Male",s[s.Neutral=3]="Neutral"})(e=t.SynthesisVoiceGender||(t.SynthesisVoiceGender={}));var n;(function(s){s[s.OnlineNeural=1]="OnlineNeural",s[s.OnlineStandard=2]="OnlineStandard",s[s.OfflineNeural=3]="OfflineNeural",s[s.OfflineStandard=4]="OfflineStandard"})(n=t.SynthesisVoiceType||(t.SynthesisVoiceType={}));const i={[e[e.Neutral]]:e.Neutral,[e[e.Male]]:e.Male,[e[e.Female]]:e.Female};class r{constructor(o){if(this.privStyleList=[],o){if(this.privName=o.Name,this.privLocale=o.Locale,this.privShortName=o.ShortName,this.privLocaleName=o.LocaleName,this.privDisplayName=o.DisplayName,this.privLocalName=o.LocalName,this.privVoiceType=o.VoiceType.endsWith("Standard")?n.OnlineStandard:n.OnlineNeural,this.privGender=i[o.Gender]||e.Unknown,o.StyleList&&Array.isArray(o.StyleList))for(const a of o.StyleList)this.privStyleList.push(a);this.privSampleRateHertz=o.SampleRateHertz,this.privStatus=o.Status,o.ExtendedPropertyMap&&(this.privExtendedPropertyMap=o.ExtendedPropertyMap),this.privWordsPerMinute=o.WordsPerMinute,Array.isArray(o.SecondaryLocaleList)&&(this.privSecondaryLocaleList=[...o.SecondaryLocaleList]),Array.isArray(o.RolePlayList)&&(this.privRolePlayList=[...o.RolePlayList])}}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get sampleRateHertz(){return this.privSampleRateHertz}get status(){return this.privStatus}get extendedPropertyMap(){return this.privExtendedPropertyMap}get wordsPerMinute(){return this.privWordsPerMinute}get secondaryLocaleList(){return this.privSecondaryLocaleList}get rolePlayList(){return this.privRolePlayList}}t.VoiceInfo=r})(uB);var Ax={};Object.defineProperty(Ax,"__esModule",{value:!0});Ax.SpeakerAudioDestination=void 0;const Fl=ht(),eK=Vi,Br=Sl,tK=60*30,V3={[Br.AudioFormatTag.PCM]:"audio/wav",[Br.AudioFormatTag.MuLaw]:"audio/x-wav",[Br.AudioFormatTag.MP3]:"audio/mpeg",[Br.AudioFormatTag.OGG_OPUS]:"audio/ogg",[Br.AudioFormatTag.WEBM_OPUS]:"audio/webm; codecs=opus",[Br.AudioFormatTag.ALaw]:"audio/x-wav",[Br.AudioFormatTag.FLAC]:"audio/flac",[Br.AudioFormatTag.AMR_WB]:"audio/amr-wb",[Br.AudioFormatTag.G722]:"audio/G722"};class nK{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||Fl.createNoDashGuid(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,n,i){this.privAudioBuffer!==void 0?(this.privAudioBuffer.push(e),this.updateSourceBuffer().then(()=>{n&&n()},r=>{i&&i(r)})):this.privAudioOutputStream!==void 0&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength)}close(e,n){if(this.privIsClosed=!0,this.privSourceBuffer!==void 0)this.handleSourceBufferUpdateEnd().then(()=>{e&&e()},i=>{n&&n(i)});else if(this.privAudioOutputStream!==void 0&&typeof window<"u")if((this.privFormat.formatTag===Br.AudioFormatTag.PCM||this.privFormat.formatTag===Br.AudioFormatTag.MuLaw||this.privFormat.formatTag===Br.AudioFormatTag.ALaw)&&this.privFormat.hasHeader===!1)console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else{let i=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(i).then(()=>{i=this.privFormat.addHeader(i);const r=new Blob([i],{type:V3[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(r),this.notifyPlayback().then(()=>{e&&e()},s=>{n&&n(s)})},r=>{n&&n(r)})}else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if(typeof AudioContext<"u"||typeof window<"u"&&typeof window.webkitAudioContext<"u"){this.privFormat=e;const n=V3[this.privFormat.formatTag];n===void 0?console.warn(`Unknown mimeType for format ${Br.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):typeof MediaSource<"u"&&MediaSource.isTypeSupported(n)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=tK,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(n),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(i=>{Fl.Events.instance.onEvent(new Fl.BackgroundEvent(i))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(i=>{Fl.Events.instance.onEvent(new Fl.BackgroundEvent(i))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(i=>{Fl.Events.instance.onEvent(new Fl.BackgroundEvent(i))})):(console.warn(`Format ${Br.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new eK.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){var e;return((e=this.privAudio)==null?void 0:e.volume)??-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return this.privAudio!==void 0?this.privAudio.currentTime:-1}pause(){!this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,n){this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.play().then(()=>{e&&e()},i=>{n&&n(i)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}async updateSourceBuffer(){if(this.privAudioBuffer!==void 0&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;const e=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(e)}catch{this.privAudioBuffer.unshift(e),console.log("buffer filled, pausing addition of binaries until space is made");return}await this.notifyPlayback()}else this.canEndStream()&&await this.handleSourceBufferUpdateEnd()}async handleSourceBufferUpdateEnd(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),await this.notifyPlayback())}async notifyPlayback(){!this.privPlaybackStarted&&this.privAudio!==void 0&&(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||await this.privAudio.play())}canEndStream(){return this.isClosed&&this.privSourceBuffer!==void 0&&this.privAudioBuffer.length===0&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&this.privMediaSource.readyState==="open"}sourceBufferAvailable(){return this.privSourceBuffer!==void 0&&!this.privSourceBuffer.updating}}Ax.SpeakerAudioDestination=nK;var jf={},j3;function iK(){if(j3)return jf;j3=1,Object.defineProperty(jf,"__esModule",{value:!0}),jf.ConversationTranscriptionCanceledEventArgs=void 0;const t=P0();let e=class extends t.CancellationEventArgsBase{};return jf.ConversationTranscriptionCanceledEventArgs=e,jf}var Wf={},W3;function rK(){if(W3)return Wf;W3=1,Object.defineProperty(Wf,"__esModule",{value:!0}),Wf.MeetingTranscriptionCanceledEventArgs=void 0;const t=P0();let e=class extends t.CancellationEventArgsBase{};return Wf.MeetingTranscriptionCanceledEventArgs=e,Wf}var hB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PronunciationAssessmentGradingSystem=void 0,function(e){e[e.FivePoint=1]="FivePoint",e[e.HundredMark=2]="HundredMark"}(t.PronunciationAssessmentGradingSystem||(t.PronunciationAssessmentGradingSystem={}))})(hB);var dB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PronunciationAssessmentGranularity=void 0,function(e){e[e.Phoneme=1]="Phoneme",e[e.Word=2]="Word",e[e.FullText=3]="FullText"}(t.PronunciationAssessmentGranularity||(t.PronunciationAssessmentGranularity={}))})(dB);var Gf={},G3;function sK(){if(G3)return Gf;G3=1,Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.PronunciationAssessmentConfig=void 0;const t=_t,e=ye();let n=class pB{constructor(r,s=e.PronunciationAssessmentGradingSystem.FivePoint,o=e.PronunciationAssessmentGranularity.Phoneme,a=!1){t.Contracts.throwIfNullOrUndefined(r,"referenceText"),this.privProperties=new e.PropertyCollection,this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_ReferenceText,r),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_GradingSystem,e.PronunciationAssessmentGradingSystem[s]),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_Granularity,e.PronunciationAssessmentGranularity[o]),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,String(a))}static fromJSON(r){t.Contracts.throwIfNullOrUndefined(r,"json");const s=new pB("");return s.privProperties=new e.PropertyCollection,s.properties.setProperty(e.PropertyId.PronunciationAssessment_Json,r),s}toJSON(){return this.updateJson(),this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Params)}applyTo(r){this.updateJson();const s=r.internalData;s.expectContentAssessmentResponse=!!this.privContentAssessmentTopic,s.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(e.PropertyId.PronunciationAssessment_Params),this.privContentAssessmentTopic,s.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(e.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(r){t.Contracts.throwIfNullOrWhitespace(r,"referenceText"),this.properties.setProperty(e.PropertyId.PronunciationAssessment_ReferenceText,r)}set phonemeAlphabet(r){t.Contracts.throwIfNullOrWhitespace(r,"phonemeAlphabet"),this.privPhonemeAlphabet=r}set enableMiscue(r){const s=r?"true":"false";this.properties.setProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,s)}get enableMiscue(){return this.properties.getProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,"false").toLowerCase()==="true"}set nbestPhonemeCount(r){this.privNBestPhonemeCount=r}set enableProsodyAssessment(r){this.privEnableProsodyAssessment=r}enableContentAssessmentWithTopic(r){this.privContentAssessmentTopic=r}get properties(){return this.privProperties}updateJson(){const r=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Json,"{}"),s=JSON.parse(r),o=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_ReferenceText);o&&(s.referenceText=o);const a=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_GradingSystem);a&&(s.gradingSystem=a);const c=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Granularity);c&&(s.granularity=c),this.privPhonemeAlphabet&&(s.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(s.nbestPhonemeCount=this.privNBestPhonemeCount),s.enableProsodyAssessment=this.privEnableProsodyAssessment,s.dimension="Comprehensive",this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_EnableMiscue)&&(s.enableMiscue=this.enableMiscue),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_Params,JSON.stringify(s))}};return Gf.PronunciationAssessmentConfig=n,Gf}var zl={},q3;function oK(){if(q3)return zl;q3=1,Object.defineProperty(zl,"__esModule",{value:!0}),zl.PronunciationAssessmentResult=zl.ContentAssessmentResult=void 0;const t=_t,e=ye();class n{constructor(s){this.privPronJson=s}get grammarScore(){return this.privPronJson.ContentAssessment.GrammarScore}get vocabularyScore(){return this.privPronJson.ContentAssessment.VocabularyScore}get topicScore(){return this.privPronJson.ContentAssessment.TopicScore}}zl.ContentAssessmentResult=n;let i=class fB{constructor(s){const o=JSON.parse(s);t.Contracts.throwIfNullOrUndefined(o.NBest[0],"NBest"),this.privPronJson=o.NBest[0]}static fromResult(s){t.Contracts.throwIfNullOrUndefined(s,"result");const o=s.properties.getProperty(e.PropertyId.SpeechServiceResponse_JsonResult);return t.Contracts.throwIfNullOrUndefined(o,"json"),new fB(o)}get detailResult(){return this.privPronJson}get accuracyScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.AccuracyScore}get pronunciationScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.PronScore}get completenessScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.CompletenessScore}get fluencyScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.FluencyScore}get prosodyScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.ProsodyScore}get contentAssessmentResult(){if(this.detailResult.ContentAssessment!==void 0)return new n(this.detailResult)}};return zl.PronunciationAssessmentResult=i,zl}var qf={},X3;function aK(){if(X3)return qf;X3=1,Object.defineProperty(qf,"__esModule",{value:!0}),qf.AvatarConfig=void 0;const t=_t,e=ye();let n=class{constructor(r,s,o){this.privCustomized=!1,t.Contracts.throwIfNullOrWhitespace(r,"character"),this.character=r,this.style=s,o===void 0&&(o=new e.AvatarVideoFormat),this.videoFormat=o}get customized(){return this.privCustomized}set customized(r){this.privCustomized=r}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(r){this.privBackgroundColor=r}get backgroundImage(){return this.privBackgroundImage}set backgroundImage(r){this.privBackgroundImage=r}get remoteIceServers(){return this.privRemoteIceServers}set remoteIceServers(r){this.privRemoteIceServers=r}};return qf.AvatarConfig=n,qf}var mB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AvatarEventArgs=t.AvatarEventTypes=void 0,function(n){n.SwitchedToSpeaking="SwitchedToSpeaking",n.SwitchedToIdle="SwitchedToIdle",n.SessionClosed="SessionClosed"}(t.AvatarEventTypes||(t.AvatarEventTypes={}));class e{constructor(i,r){this.privOffset=i,this.privDescription=r}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}}t.AvatarEventArgs=e})(mB);var Xf={},Kf={},K3;function gB(){if(K3)return Kf;K3=1,Object.defineProperty(Kf,"__esModule",{value:!0}),Kf.SpeechSynthesisConnectionFactory=void 0;const t=zi(),e=ye(),n=No(),i=We(),r=Fi,s=Do;let o=class{constructor(){this.synthesisUri="/cognitiveservices/websocket/v1"}create(c,l,u){let h=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,void 0),p=n.ConnectionFactoryBase.getHostSuffix(d),f=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),v=f===void 0?"tts":"voice",g=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+d+"."+v+".speech"+p),m={},y={};l.token!==void 0&&l.token!==""&&(y[l.headerName]=l.token),y[r.HeaderNames.ConnectionId]=u,f!==void 0&&f!==""&&(!h||h.search(s.QueryParameterNames.CustomVoiceDeploymentId)===-1)&&(m[s.QueryParameterNames.CustomVoiceDeploymentId]=f),c.avatarEnabled&&(!h||h.search(s.QueryParameterNames.EnableAvatar)===-1)&&(m[s.QueryParameterNames.EnableAvatar]="true"),h||(h=g+this.synthesisUri),c.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,h);const S=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(h,m,y,new i.WebsocketMessageFormatter,t.ProxyInfo.fromParameters(c.parameters),S,u)}};return Kf.SpeechSynthesisConnectionFactory=o,Kf}var Y3;function cK(){if(Y3)return Xf;Y3=1,Object.defineProperty(Xf,"__esModule",{value:!0}),Xf.AvatarSynthesizer=void 0;const t=gB(),e=We(),n=ht(),i=xl,r=ye(),s=_t,o=w2();let a=class extends r.Synthesizer{constructor(l,u){super(l),s.Contracts.throwIfNullOrUndefined(u,"avatarConfig"),this.privConnectionFactory=new t.SpeechSynthesisConnectionFactory,this.privAvatarConfig=u,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(r.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}async startAvatarAsync(l){s.Contracts.throwIfNullOrUndefined(l,"peerConnection"),this.privIceServers=l.getConfiguration().iceServers,s.Contracts.throwIfNullOrUndefined(this.privIceServers,"Ice servers must be set.");const u=new n.Deferred;l.onicegatheringstatechange=()=>{n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering state: "+l.iceGatheringState,n.EventType.Debug)),l.iceGatheringState==="complete"&&(n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering complete.",n.EventType.Info)),u.resolve())},l.onicecandidate=v=>{v.candidate?n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice candidate: "+v.candidate.candidate,n.EventType.Debug)):(n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice candidate: complete",n.EventType.Debug)),u.resolve())},setTimeout(()=>{l.iceGatheringState!=="complete"&&(n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering timeout.",n.EventType.Warning)),u.resolve())},2e3);const h=await l.createOffer();await l.setLocalDescription(h),await u.promise,n.Events.instance.onEvent(new n.PlatformEvent("peer connection: got local SDP.",n.EventType.Info)),this.privProperties.setProperty(r.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(l.localDescription));const d=await this.speak("",!1);if(d.reason!==r.ResultReason.SynthesizingAudioCompleted)return new r.SynthesisResult(d.resultId,d.reason,d.errorDetails,d.properties);const p=atob(d.properties.getProperty(r.PropertyId.TalkingAvatarService_WebRTC_SDP)),f=new RTCSessionDescription(JSON.parse(p));return await l.setRemoteDescription(f),new r.SynthesisResult(d.resultId,d.reason,void 0,d.properties)}async speakTextAsync(l){const u=await this.speak(l,!1);return new r.SynthesisResult(u.resultId,u.reason,u.errorDetails,u.properties)}async speakSsmlAsync(l){const u=await this.speak(l,!0);return new r.SynthesisResult(u.resultId,u.reason,u.errorDetails,u.properties)}async stopSpeakingAsync(){for(;this.synthesisRequestQueue.length()>0;)(await this.synthesisRequestQueue.dequeue()).err("Synthesis is canceled by user.");return this.privAdapter.stopSpeaking()}async stopAvatarAsync(){return s.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)}async close(){if(!this.privDisposed)return this.dispose(!0)}get iceServers(){return this.privIceServers}createSynthesisAdapter(l,u,h){return new e.AvatarSynthesisAdapter(l,u,h,this,this.privAvatarConfig)}createRestSynthesisAdapter(l,u){}createSynthesizerConfig(l){const u=super.createSynthesizerConfig(l);return u.avatarEnabled=!0,u}async speak(l,u){const h=n.createNoDashGuid(),d=new n.Deferred;return this.synthesisRequestQueue.enqueue(new o.SynthesisRequest(h,l,u,p=>{d.resolve(p),this.privSynthesizing=!1,this.adapterSpeak()},p=>{d.reject(p),this.privSynthesizing=!1})),this.adapterSpeak(),d.promise}};return Xf.AvatarSynthesizer=a,Xf}var Pd={};Object.defineProperty(Pd,"__esModule",{value:!0});Pd.AvatarVideoFormat=Pd.Coordinate=void 0;class lK{constructor(e,n){this.x=e,this.y=n}}Pd.Coordinate=lK;class uK{constructor(e="H264",n=2e6,i=1920,r=1080){this.codec=e,this.bitrate=n,this.width=i,this.height=r}setCropRange(e,n){this.cropRange={bottomRight:n,topLeft:e}}}Pd.AvatarVideoFormat=uK;var Yf={},J3;function hK(){if(J3)return Yf;J3=1,Object.defineProperty(Yf,"__esModule",{value:!0}),Yf.AvatarWebRTCConnectionResult=void 0;const t=ye();let e=class extends t.SynthesisResult{constructor(i,r,s,o,a){super(r,s,o,a),this.privSDPAnswer=i}get SDPAnswer(){return this.privSDPAnswer}};return Yf.AvatarWebRTCConnectionResult=e,Yf}var Jf={},Q3;function dK(){if(Q3)return Jf;Q3=1,Object.defineProperty(Jf,"__esModule",{value:!0}),Jf.Diagnostics=void 0;const t=zi(),e=ht();let n=class{static SetLoggingLevel(r){this.privListener=new t.ConsoleLoggingListener(r),e.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(r){if(typeof window>"u")this.privListener&&(this.privListener.logPath=r);else throw new Error("File system logging not available in browser.")}static set onLogOutput(r){this.privListener&&(this.privListener.logCallback=r)}};return Jf.Diagnostics=n,n.privListener=void 0,Jf}var Z3;function ye(){return Z3||(Z3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=DU();Object.defineProperty(t,"AudioConfig",{enumerable:!0,get:function(){return e.AudioConfig}});var n=Sl;Object.defineProperty(t,"AudioStreamFormat",{enumerable:!0,get:function(){return n.AudioStreamFormat}}),Object.defineProperty(t,"AudioFormatTag",{enumerable:!0,get:function(){return n.AudioFormatTag}});var i=PU();Object.defineProperty(t,"AudioInputStream",{enumerable:!0,get:function(){return i.AudioInputStream}}),Object.defineProperty(t,"PullAudioInputStream",{enumerable:!0,get:function(){return i.PullAudioInputStream}}),Object.defineProperty(t,"PushAudioInputStream",{enumerable:!0,get:function(){return i.PushAudioInputStream}});var r=Vi;Object.defineProperty(t,"AudioOutputStream",{enumerable:!0,get:function(){return r.AudioOutputStream}}),Object.defineProperty(t,"PullAudioOutputStream",{enumerable:!0,get:function(){return r.PullAudioOutputStream}}),Object.defineProperty(t,"PushAudioOutputStream",{enumerable:!0,get:function(){return r.PushAudioOutputStream}});var s=NU;Object.defineProperty(t,"CancellationReason",{enumerable:!0,get:function(){return s.CancellationReason}});var o=ox;Object.defineProperty(t,"PullAudioInputStreamCallback",{enumerable:!0,get:function(){return o.PullAudioInputStreamCallback}});var a=ax;Object.defineProperty(t,"PushAudioOutputStreamCallback",{enumerable:!0,get:function(){return a.PushAudioOutputStreamCallback}});var c=cx;Object.defineProperty(t,"KeywordRecognitionModel",{enumerable:!0,get:function(){return c.KeywordRecognitionModel}});var l=lx;Object.defineProperty(t,"SessionEventArgs",{enumerable:!0,get:function(){return l.SessionEventArgs}});var u=$q();Object.defineProperty(t,"RecognitionEventArgs",{enumerable:!0,get:function(){return u.RecognitionEventArgs}});var h=OU;Object.defineProperty(t,"OutputFormat",{enumerable:!0,get:function(){return h.OutputFormat}});var d=Hq();Object.defineProperty(t,"IntentRecognitionEventArgs",{enumerable:!0,get:function(){return d.IntentRecognitionEventArgs}});var p=ux;Object.defineProperty(t,"RecognitionResult",{enumerable:!0,get:function(){return p.RecognitionResult}});var f=jq();Object.defineProperty(t,"SpeechRecognitionResult",{enumerable:!0,get:function(){return f.SpeechRecognitionResult}});var v=Wq();Object.defineProperty(t,"IntentRecognitionResult",{enumerable:!0,get:function(){return v.IntentRecognitionResult}});var g=Ad;Object.defineProperty(t,"LanguageUnderstandingModel",{enumerable:!0,get:function(){return g.LanguageUnderstandingModel}});var m=Gq();Object.defineProperty(t,"SpeechRecognitionEventArgs",{enumerable:!0,get:function(){return m.SpeechRecognitionEventArgs}}),Object.defineProperty(t,"ConversationTranscriptionEventArgs",{enumerable:!0,get:function(){return m.ConversationTranscriptionEventArgs}}),Object.defineProperty(t,"MeetingTranscriptionEventArgs",{enumerable:!0,get:function(){return m.MeetingTranscriptionEventArgs}});var y=qq();Object.defineProperty(t,"SpeechRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return y.SpeechRecognitionCanceledEventArgs}});var S=Xq();Object.defineProperty(t,"TranslationRecognitionEventArgs",{enumerable:!0,get:function(){return S.TranslationRecognitionEventArgs}});var x=Kq();Object.defineProperty(t,"TranslationSynthesisEventArgs",{enumerable:!0,get:function(){return x.TranslationSynthesisEventArgs}});var w=UU();Object.defineProperty(t,"TranslationRecognitionResult",{enumerable:!0,get:function(){return w.TranslationRecognitionResult}});var C=hx;Object.defineProperty(t,"TranslationSynthesisResult",{enumerable:!0,get:function(){return C.TranslationSynthesisResult}});var E=BU;Object.defineProperty(t,"ResultReason",{enumerable:!0,get:function(){return E.ResultReason}});var b=Jq();Object.defineProperty(t,"SpeechConfig",{enumerable:!0,get:function(){return b.SpeechConfig}}),Object.defineProperty(t,"SpeechConfigImpl",{enumerable:!0,get:function(){return b.SpeechConfigImpl}});var M=Qq();Object.defineProperty(t,"SpeechTranslationConfig",{enumerable:!0,get:function(){return M.SpeechTranslationConfig}}),Object.defineProperty(t,"SpeechTranslationConfigImpl",{enumerable:!0,get:function(){return M.SpeechTranslationConfigImpl}});var _=HU();Object.defineProperty(t,"PropertyCollection",{enumerable:!0,get:function(){return _.PropertyCollection}});var R=dx;Object.defineProperty(t,"PropertyId",{enumerable:!0,get:function(){return R.PropertyId}});var L=Zq();Object.defineProperty(t,"Recognizer",{enumerable:!0,get:function(){return L.Recognizer}});var O=eX();Object.defineProperty(t,"SpeechRecognizer",{enumerable:!0,get:function(){return O.SpeechRecognizer}});var V=tX();Object.defineProperty(t,"IntentRecognizer",{enumerable:!0,get:function(){return V.IntentRecognizer}});var X=WU;Object.defineProperty(t,"VoiceProfileType",{enumerable:!0,get:function(){return X.VoiceProfileType}});var G=nX();Object.defineProperty(t,"TranslationRecognizer",{enumerable:!0,get:function(){return G.TranslationRecognizer}});var J=iX();Object.defineProperty(t,"Translations",{enumerable:!0,get:function(){return J.Translations}});var D=KU;Object.defineProperty(t,"NoMatchReason",{enumerable:!0,get:function(){return D.NoMatchReason}});var ne=rX();Object.defineProperty(t,"NoMatchDetails",{enumerable:!0,get:function(){return ne.NoMatchDetails}});var P=px;Object.defineProperty(t,"TranslationRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return P.TranslationRecognitionCanceledEventArgs}});var ee=oX();Object.defineProperty(t,"IntentRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return ee.IntentRecognitionCanceledEventArgs}});var ge=I0;Object.defineProperty(t,"CancellationDetailsBase",{enumerable:!0,get:function(){return ge.CancellationDetailsBase}});var I=cX();Object.defineProperty(t,"CancellationDetails",{enumerable:!0,get:function(){return I.CancellationDetails}});var $=QU;Object.defineProperty(t,"CancellationErrorCode",{enumerable:!0,get:function(){return $.CancellationErrorCode}});var K=lX();Object.defineProperty(t,"ConnectionEventArgs",{enumerable:!0,get:function(){return K.ConnectionEventArgs}});var oe=uX();Object.defineProperty(t,"ServiceEventArgs",{enumerable:!0,get:function(){return oe.ServiceEventArgs}});var he=qU();Object.defineProperty(t,"Connection",{enumerable:!0,get:function(){return he.Connection}});var ze=fx;Object.defineProperty(t,"PhraseListGrammar",{enumerable:!0,get:function(){return ze.PhraseListGrammar}});var Me=y2();Object.defineProperty(t,"DialogServiceConfig",{enumerable:!0,get:function(){return Me.DialogServiceConfig}});var dt=hX();Object.defineProperty(t,"BotFrameworkConfig",{enumerable:!0,get:function(){return dt.BotFrameworkConfig}});var it=dX();Object.defineProperty(t,"CustomCommandsConfig",{enumerable:!0,get:function(){return it.CustomCommandsConfig}});var St=fX();Object.defineProperty(t,"DialogServiceConnector",{enumerable:!0,get:function(){return St.DialogServiceConnector}});var U=mx;Object.defineProperty(t,"ActivityReceivedEventArgs",{enumerable:!0,get:function(){return U.ActivityReceivedEventArgs}});var di=gx;Object.defineProperty(t,"TurnStatusReceivedEventArgs",{enumerable:!0,get:function(){return di.TurnStatusReceivedEventArgs}});var xt=ZU;Object.defineProperty(t,"ServicePropertyChannel",{enumerable:!0,get:function(){return xt.ServicePropertyChannel}});var Mt=eB;Object.defineProperty(t,"ProfanityOption",{enumerable:!0,get:function(){return Mt.ProfanityOption}});var lt=yX();Object.defineProperty(t,"BaseAudioPlayer",{enumerable:!0,get:function(){return lt.BaseAudioPlayer}});var Zt=yx;Object.defineProperty(t,"ConnectionMessageEventArgs",{enumerable:!0,get:function(){return Zt.ConnectionMessageEventArgs}});var pt=GU();Object.defineProperty(t,"ConnectionMessage",{enumerable:!0,get:function(){return pt.ConnectionMessage}});var k=Sx;Object.defineProperty(t,"VoiceProfile",{enumerable:!0,get:function(){return k.VoiceProfile}});var T=CX();Object.defineProperty(t,"VoiceProfileEnrollmentResult",{enumerable:!0,get:function(){return T.VoiceProfileEnrollmentResult}}),Object.defineProperty(t,"VoiceProfileEnrollmentCancellationDetails",{enumerable:!0,get:function(){return T.VoiceProfileEnrollmentCancellationDetails}});var Q=_X();Object.defineProperty(t,"VoiceProfileResult",{enumerable:!0,get:function(){return Q.VoiceProfileResult}}),Object.defineProperty(t,"VoiceProfileCancellationDetails",{enumerable:!0,get:function(){return Q.VoiceProfileCancellationDetails}});var ae=wX();Object.defineProperty(t,"VoiceProfilePhraseResult",{enumerable:!0,get:function(){return ae.VoiceProfilePhraseResult}});var me=EX();Object.defineProperty(t,"VoiceProfileClient",{enumerable:!0,get:function(){return me.VoiceProfileClient}});var de=RX();Object.defineProperty(t,"SpeakerRecognizer",{enumerable:!0,get:function(){return de.SpeakerRecognizer}});var H=bX();Object.defineProperty(t,"SpeakerIdentificationModel",{enumerable:!0,get:function(){return H.SpeakerIdentificationModel}});var Y=TX();Object.defineProperty(t,"SpeakerVerificationModel",{enumerable:!0,get:function(){return Y.SpeakerVerificationModel}});var le=AX();Object.defineProperty(t,"AutoDetectSourceLanguageConfig",{enumerable:!0,get:function(){return le.AutoDetectSourceLanguageConfig}});var ke=xx;Object.defineProperty(t,"AutoDetectSourceLanguageResult",{enumerable:!0,get:function(){return ke.AutoDetectSourceLanguageResult}});var ue=Cx;Object.defineProperty(t,"SourceLanguageConfig",{enumerable:!0,get:function(){return ue.SourceLanguageConfig}});var Ce=IX();Object.defineProperty(t,"SpeakerRecognitionResult",{enumerable:!0,get:function(){return Ce.SpeakerRecognitionResult}}),Object.defineProperty(t,"SpeakerRecognitionResultType",{enumerable:!0,get:function(){return Ce.SpeakerRecognitionResultType}}),Object.defineProperty(t,"SpeakerRecognitionCancellationDetails",{enumerable:!0,get:function(){return Ce.SpeakerRecognitionCancellationDetails}});var Te=_2();Object.defineProperty(t,"Conversation",{enumerable:!0,get:function(){return Te.Conversation}}),Object.defineProperty(t,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return Te.ConversationExpirationEventArgs}}),Object.defineProperty(t,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return Te.ConversationParticipantsChangedEventArgs}}),Object.defineProperty(t,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return Te.ConversationTranslationCanceledEventArgs}}),Object.defineProperty(t,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return Te.ConversationTranslationEventArgs}}),Object.defineProperty(t,"ConversationTranslationResult",{enumerable:!0,get:function(){return Te.ConversationTranslationResult}}),Object.defineProperty(t,"ConversationTranslator",{enumerable:!0,get:function(){return Te.ConversationTranslator}}),Object.defineProperty(t,"ConversationTranscriber",{enumerable:!0,get:function(){return Te.ConversationTranscriber}}),Object.defineProperty(t,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return Te.ConversationTranscriptionResult}}),Object.defineProperty(t,"Meeting",{enumerable:!0,get:function(){return Te.Meeting}}),Object.defineProperty(t,"MeetingTranscriber",{enumerable:!0,get:function(){return Te.MeetingTranscriber}}),Object.defineProperty(t,"Participant",{enumerable:!0,get:function(){return Te.Participant}}),Object.defineProperty(t,"ParticipantChangedReason",{enumerable:!0,get:function(){return Te.ParticipantChangedReason}}),Object.defineProperty(t,"User",{enumerable:!0,get:function(){return Te.User}});var Ze=w2();Object.defineProperty(t,"Synthesizer",{enumerable:!0,get:function(){return Ze.Synthesizer}});var Pe=f2;Object.defineProperty(t,"SpeechSynthesisOutputFormat",{enumerable:!0,get:function(){return Pe.SpeechSynthesisOutputFormat}});var wt=GX();Object.defineProperty(t,"SpeechSynthesizer",{enumerable:!0,get:function(){return wt.SpeechSynthesizer}});var et=wx;Object.defineProperty(t,"SynthesisResult",{enumerable:!0,get:function(){return et.SynthesisResult}});var Dt=XX();Object.defineProperty(t,"SpeechSynthesisResult",{enumerable:!0,get:function(){return Dt.SpeechSynthesisResult}});var B=Ex;Object.defineProperty(t,"SpeechSynthesisEventArgs",{enumerable:!0,get:function(){return B.SpeechSynthesisEventArgs}});var De=Rx;Object.defineProperty(t,"SpeechSynthesisWordBoundaryEventArgs",{enumerable:!0,get:function(){return De.SpeechSynthesisWordBoundaryEventArgs}});var se=bx;Object.defineProperty(t,"SpeechSynthesisBookmarkEventArgs",{enumerable:!0,get:function(){return se.SpeechSynthesisBookmarkEventArgs}});var pe=Tx;Object.defineProperty(t,"SpeechSynthesisVisemeEventArgs",{enumerable:!0,get:function(){return pe.SpeechSynthesisVisemeEventArgs}});var Le=lB;Object.defineProperty(t,"SpeechSynthesisBoundaryType",{enumerable:!0,get:function(){return Le.SpeechSynthesisBoundaryType}});var Ne=ZX();Object.defineProperty(t,"SynthesisVoicesResult",{enumerable:!0,get:function(){return Ne.SynthesisVoicesResult}});var Ft=uB;Object.defineProperty(t,"VoiceInfo",{enumerable:!0,get:function(){return Ft.VoiceInfo}});var Tn=Ax;Object.defineProperty(t,"SpeakerAudioDestination",{enumerable:!0,get:function(){return Tn.SpeakerAudioDestination}});var Qn=iK();Object.defineProperty(t,"ConversationTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Qn.ConversationTranscriptionCanceledEventArgs}});var Nt=rK();Object.defineProperty(t,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Nt.MeetingTranscriptionCanceledEventArgs}});var bi=hB;Object.defineProperty(t,"PronunciationAssessmentGradingSystem",{enumerable:!0,get:function(){return bi.PronunciationAssessmentGradingSystem}});var es=dB;Object.defineProperty(t,"PronunciationAssessmentGranularity",{enumerable:!0,get:function(){return es.PronunciationAssessmentGranularity}});var F=sK();Object.defineProperty(t,"PronunciationAssessmentConfig",{enumerable:!0,get:function(){return F.PronunciationAssessmentConfig}});var W=oK();Object.defineProperty(t,"PronunciationAssessmentResult",{enumerable:!0,get:function(){return W.PronunciationAssessmentResult}});var ie=x2;Object.defineProperty(t,"LanguageIdMode",{enumerable:!0,get:function(){return ie.LanguageIdMode}});var fe=aK();Object.defineProperty(t,"AvatarConfig",{enumerable:!0,get:function(){return fe.AvatarConfig}});var Oe=mB;Object.defineProperty(t,"AvatarEventArgs",{enumerable:!0,get:function(){return Oe.AvatarEventArgs}});var tt=cK();Object.defineProperty(t,"AvatarSynthesizer",{enumerable:!0,get:function(){return tt.AvatarSynthesizer}});var ut=Pd;Object.defineProperty(t,"AvatarVideoFormat",{enumerable:!0,get:function(){return ut.AvatarVideoFormat}}),Object.defineProperty(t,"Coordinate",{enumerable:!0,get:function(){return ut.Coordinate}});var Be=hK();Object.defineProperty(t,"AvatarWebRTCConnectionResult",{enumerable:!0,get:function(){return Be.AvatarWebRTCConnectionResult}});var Ue=dK();Object.defineProperty(t,"Diagnostics",{enumerable:!0,get:function(){return Ue.Diagnostics}});var Fe=d2;Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return Fe.LogLevel}})}(O_)),O_}var ek;function pK(){if(ek)return Kp;ek=1,Object.defineProperty(Kp,"__esModule",{value:!0}),Kp.ProxyInfo=void 0;const t=ye();let e=class vB{constructor(i,r,s,o){this.privProxyHostName=i,this.privProxyPort=r,this.privProxyUserName=s,this.privProxyPassword=o}static fromParameters(i){return new vB(i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyPort),10),i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyUserName),i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(i){return this.fromParameters(i.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}};return Kp.ProxyInfo=e,Kp}var yB={};const fK=new Set(["json","buffer","string"]);var mK=t=>(...e)=>{const n=new Set;let i,r,s,o="";return e.forEach(a=>{if(typeof a=="string")if(a.toUpperCase()===a)if(i){const c=`Can't set method to ${a}, already set to ${i}.`;throw new Error(c)}else i=a;else if(a.startsWith("http:")||a.startsWith("https:"))o=a;else if(fK.has(a))r=a;else throw new Error(`Unknown encoding, ${a}`);else if(typeof a=="number")n.add(a);else if(typeof a=="object")if(Array.isArray(a)||a instanceof Set)a.forEach(c=>n.add(c));else{if(s)throw new Error("Cannot set headers twice.");s=a}else throw new Error(`Unknown type: ${typeof a}`)}),i||(i="GET"),n.size===0&&n.add(200),t(n,i,r,s,o)};const gK=mK;class E2 extends Error{constructor(e,...n){super(...n),Error.captureStackTrace&&Error.captureStackTrace(this,E2),this.name="StatusError",this.message=e.statusMessage,this.statusCode=e.status,this.res=e,this.json=e.json.bind(e),this.text=e.text.bind(e),this.arrayBuffer=e.arrayBuffer.bind(e);let i;Object.defineProperty(this,"responseBody",{get:()=>(i||(i=this.arrayBuffer()),i)}),this.headers={};for(const[s,o]of e.headers.entries())this.headers[s.toLowerCase()]=o}}const vK=(t,e,n,i,r)=>async(s,o,a={})=>{s=r+(s||"");let c=new URL(s);if(i||(i={}),c.username&&(i.Authorization="Basic "+btoa(c.username+":"+c.password),c=new URL(c.protocol+"//"+c.host+c.pathname+c.search)),c.protocol!=="https:"&&c.protocol!=="http:")throw new Error(`Unknown protocol, ${c.protocol}`);if(o&&!(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="string"))if(typeof o=="object")o=JSON.stringify(o),i["Content-Type"]="application/json";else throw new Error("Unknown body type.");a=new Headers({...i||{},...a});const l=await fetch(c,{method:e,headers:a,body:o});if(l.statusCode=l.status,!t.has(l.status))throw new E2(l);return n==="json"?l.json():n==="buffer"?l.arrayBuffer():n==="string"?l.text():l};var yK=gK(vK);(function(t){var e=It&&It.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0}),t.RestMessageAdapter=t.RestRequestType=void 0;const n=e(yK),i=ht();var r;(function(o){o.Get="GET",o.Post="POST",o.Delete="DELETE",o.File="file"})(r=t.RestRequestType||(t.RestRequestType={}));class s{constructor(a){if(!a)throw new i.ArgumentNullError("configParams");this.privHeaders=a.headers,this.privIgnoreCache=a.ignoreCache}static extractHeaderValue(a,c){let l="";try{const u=c.trim().split(/[\r\n]+/),h={};u.forEach(d=>{const p=d.split(": "),f=p.shift().toLowerCase(),v=p.join(": ");h[f]=v}),l=h[a.toLowerCase()]}catch{}return l}set options(a){this.privHeaders=a.headers,this.privIgnoreCache=a.ignoreCache}setHeaders(a,c){this.privHeaders[a]=c}request(a,c,l={},u=null){const h=new i.Deferred,d=a===r.File?"POST":a,p=(v,g={})=>{const m=v;return{data:JSON.stringify(g),headers:JSON.stringify(v.headers),json:g,ok:v.statusCode>=200&&v.statusCode<300,status:v.statusCode,statusText:g.error?g.error.message:m.statusText?m.statusText:m.statusMessage}},f=v=>{const g=n.default(c,d,this.privHeaders,200,201,202,204,400,401,402,403,404),m=this.queryParams(l)===""?"":`?${this.queryParams(l)}`;g(m,v).then(async y=>{if(a===r.Delete||y.statusCode===204)h.resolve(p(y));else try{const S=await y.json();h.resolve(p(y,S))}catch{h.resolve(p(y))}}).catch(y=>{h.reject(y)})};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),a===r.Post&&u&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),f(u),h.promise}queryParams(a={}){return Object.keys(a).map(c=>encodeURIComponent(c)+"="+encodeURIComponent(a[c])).join("&")}}t.RestMessageAdapter=s})(yB);var k0={};Object.defineProperty(k0,"__esModule",{value:!0});k0.RestConfigBase=void 0;class Xc{static get requestOptions(){return Xc.privDefaultRequestOptions}static get configParams(){return Xc.privDefaultParams}static get restErrors(){return Xc.privRestErrors}}k0.RestConfigBase=Xc;Xc.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4};Xc.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."};Xc.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"};var tk;function zi(){return tk||(tk=1,function(t){var e=It&&It.__createBinding||(Object.create?function(i,r,s,o){o===void 0&&(o=s),Object.defineProperty(i,o,{enumerable:!0,get:function(){return r[s]}})}:function(i,r,s,o){o===void 0&&(o=s),i[o]=r[s]}),n=It&&It.__exportStar||function(i,r){for(var s in i)s!=="default"&&!r.hasOwnProperty(s)&&e(r,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(nx,t),n(TU,t),n(mq(),t),n(gq(),t),n(ix,t),n(rx,t),n(T0,t),n(sx,t),n(pK(),t),n(yB,t),n(k0,t)}(L_)),L_}var nk;function SK(){if(nk)return Gp;nk=1,Object.defineProperty(Gp,"__esModule",{value:!0}),Gp.IntentConnectionFactory=void 0;const t=zi(),e=ye(),n=No(),i=We(),r=Fi;let s=class extends n.ConnectionFactoryBase{create(a,c,l){let u=a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint);if(!u){const f=a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_IntentRegion),v=n.ConnectionFactoryBase.getHostSuffix(f);u=a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+f+".sr.speech"+v)+"/speech/recognition/interactive/cognitiveservices/v1"}const h={format:"simple",language:a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(a,h,u);const d={};c.token!==void 0&&c.token!==""&&(d[c.headerName]=c.token),d[r.HeaderNames.ConnectionId]=l,a.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,u);const p=a.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(u,h,d,new i.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(a),p,l)}getSpeechRegionFromIntentRegion(a){switch(a){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return a}}};return Gp.IntentConnectionFactory=s,Gp}var Ul={},ik;function xK(){if(ik)return Ul;ik=1,Object.defineProperty(Ul,"__esModule",{value:!0}),Ul.VoiceProfileConnectionFactory=Ul.SpeakerRecognitionConnectionFactory=void 0;const t=zi(),e=ye(),n=No(),i=We(),r=Fi;class s extends n.ConnectionFactoryBase{create(l,u,h,d){let p=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint);if(!p){const m=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region),y=n.ConnectionFactoryBase.getHostSuffix(m),S=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,`wss://${m}.spr-frontend.speech${y}`),x=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_SpeakerIdMode,"TextIndependentIdentification");p=`${S}/speaker/ws/${this.scenarioToPath(x)}/${h}`}const f={format:"simple",language:l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(l,f,p);const v={};u.token!==void 0&&u.token!==""&&(v[u.headerName]=u.token),v[r.HeaderNames.ConnectionId]=d,v[r.HeaderNames.SpIDAuthKey]=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Key),l.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,p);const g=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(p,f,v,new i.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(l),g,d)}scenarioToPath(l){switch(l){case"TextIndependentVerification":case"2":return"verification/text-independent";case"TextDependentVerification":case"1":return"verification/text-dependent";default:return"identification/text-independent"}}}let o=class extends s{create(l,u,h){return super.create(l,u,"recognition",h)}};Ul.SpeakerRecognitionConnectionFactory=o;class a extends s{create(l,u,h){return super.create(l,u,"profile",h)}}return Ul.VoiceProfileConnectionFactory=a,Ul}var Px={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecognitionEndedEvent=t.RecognitionCompletionStatus=t.RecognitionStartedEvent=t.ConnectingToServiceEvent=t.ListeningStartedEvent=t.RecognitionTriggeredEvent=t.SpeechRecognitionEvent=void 0;const e=ht();class n extends e.PlatformEvent{constructor(u,h,d,p=e.EventType.Info){super(u,p),this.privRequestId=h,this.privSessionId=d}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}t.SpeechRecognitionEvent=n;class i extends n{constructor(u,h,d,p){super("RecognitionTriggeredEvent",u,h),this.privAudioSourceId=d,this.privAudioNodeId=p}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}t.RecognitionTriggeredEvent=i;class r extends n{constructor(u,h,d,p){super("ListeningStartedEvent",u,h),this.privAudioSourceId=d,this.privAudioNodeId=p}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}t.ListeningStartedEvent=r;class s extends n{constructor(u,h,d){super("ConnectingToServiceEvent",u,d),this.privAuthFetchEventid=h}get authFetchEventid(){return this.privAuthFetchEventid}}t.ConnectingToServiceEvent=s;class o extends n{constructor(u,h,d,p,f){super("RecognitionStartedEvent",u,f),this.privAudioSourceId=h,this.privAudioNodeId=d,this.privAuthFetchEventId=p}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}t.RecognitionStartedEvent=o;var a;(function(l){l[l.Success=0]="Success",l[l.AudioSourceError=1]="AudioSourceError",l[l.AudioSourceTimeout=2]="AudioSourceTimeout",l[l.AuthTokenFetchError=3]="AuthTokenFetchError",l[l.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",l[l.UnAuthorized=5]="UnAuthorized",l[l.ConnectTimeout=6]="ConnectTimeout",l[l.ConnectError=7]="ConnectError",l[l.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",l[l.UnknownError=9]="UnknownError"})(a=t.RecognitionCompletionStatus||(t.RecognitionCompletionStatus={}));class c extends n{constructor(u,h,d,p,f,v,g,m){super("RecognitionEndedEvent",u,f,g===a.Success?e.EventType.Info:e.EventType.Error),this.privAudioSourceId=h,this.privAudioNodeId=d,this.privAuthFetchEventId=p,this.privStatus=g,this.privError=m,this.privServiceTag=v}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}}t.RecognitionEndedEvent=c})(Px);var Qf={},tc={};Object.defineProperty(tc,"__esModule",{value:!0});tc.SpeechConnectionMessage=void 0;const $_=ht(),xa=Fi;class R2 extends $_.ConnectionMessage{constructor(e,n,i,r,s,o,a,c){if(!n)throw new $_.ArgumentNullError("path");if(!i)throw new $_.ArgumentNullError("requestId");const l={};if(l[xa.HeaderNames.Path]=n,l[xa.HeaderNames.RequestId]=i,l[xa.HeaderNames.RequestTimestamp]=new Date().toISOString(),r&&(l[xa.HeaderNames.ContentType]=r),o&&(l[xa.HeaderNames.RequestStreamId]=o),a)for(const u in a)u&&(l[u]=a[u]);c?super(e,s,l,c):super(e,s,l),this.privPath=n,this.privRequestId=i,this.privContentType=r,this.privStreamId=o,this.privAdditionalHeaders=a}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(e){let n=null,i=null,r=null,s=null;const o={};if(e.headers)for(const a in e.headers)a&&(a.toLowerCase()===xa.HeaderNames.Path.toLowerCase()?n=e.headers[a]:a.toLowerCase()===xa.HeaderNames.RequestId.toLowerCase()?i=e.headers[a]:a.toLowerCase()===xa.HeaderNames.ContentType.toLowerCase()?r=e.headers[a]:a.toLowerCase()===xa.HeaderNames.RequestStreamId.toLowerCase()?s=e.headers[a]:o[a]=e.headers[a]);return new R2(e.messageType,n,i,r,e.body,s,o,e.id)}}tc.SpeechConnectionMessage=R2;var rk;function CK(){if(rk)return Qf;rk=1,Object.defineProperty(Qf,"__esModule",{value:!0}),Qf.ServiceRecognizerBase=void 0;const t=zi(),e=ht(),n=ye(),i=We(),r=tc;let s=class Zm{constructor(a,c,l,u,h){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.privExpectContentAssessmentResponse=!1,this.recognizeOverride=void 0,this.recognizeSpeaker=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!a)throw new e.ArgumentNullError("authentication");if(!c)throw new e.ArgumentNullError("connectionFactory");if(!l)throw new e.ArgumentNullError("audioSource");if(!u)throw new e.ArgumentNullError("recognizerConfig");this.privEnableSpeakerId=u.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=a,this.privConnectionFactory=c,this.privAudioSource=l,this.privRecognizerConfig=u,this.privIsDisposed=!1,this.privRecognizer=h,this.privRequestSession=new i.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new e.EventSource,this.privServiceEvents=new e.EventSource,this.privDynamicGrammar=new i.DynamicGrammarBuilder,this.privSpeechContext=new i.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new i.AgentConfig,this.privRecognizerConfig.parameters.getProperty(n.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?this.privSetTimeout=e.Timeout.setTimeout:(typeof window<"u"&&(this.privSetTimeout=window.setTimeout.bind(window)),typeof globalThis<"u"&&(this.privSetTimeout=globalThis.setTimeout.bind(globalThis))),this.connectionEvents.attach(p=>{if(p.name==="ConnectionClosedEvent"){const f=p;(f.statusCode===1003||f.statusCode===1007||f.statusCode===1002||f.statusCode===4e3||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(n.CancellationReason.Error,f.statusCode===1007?n.CancellationErrorCode.BadRequestParameters:n.CancellationErrorCode.ConnectionFailure,`${f.reason} websocket error code: ${f.statusCode}`)}}),this.privEnableSpeakerId&&(this.privDiarizationSessionId=e.createNoDashGuid()),this.setLanguageIdJson(),this.setOutputDetailLevelJson()}setTranslationJson(){const a=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(a!==void 0){const c=a.split(","),l=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),u=l!==void 0?"Synthesize":"None";if(this.privSpeechContext.setSection("translation",{onSuccess:{action:u},output:{interimResults:{mode:"Always"}},targetLanguages:c}),l!==void 0){const h={};for(const d of c)h[d]=l;this.privSpeechContext.setSection("synthesis",{defaultVoices:h})}}}setSpeechSegmentationTimeoutJson(){const a=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0);if(a!==void 0){const c=this.recognitionMode===i.RecognitionMode.Conversation?"CONVERSATION":this.recognitionMode===i.RecognitionMode.Dictation?"DICTATION":"INTERACTIVE",l=parseInt(a,10),u=this.privSpeechContext.getSection("phraseDetection");u.mode=c,u[c]={segmentation:{mode:"Custom",segmentationSilenceTimeoutMs:l}},this.privSpeechContext.setSection("phraseDetection",u)}}setLanguageIdJson(){const a=this.privSpeechContext.getSection("phraseDetection");if(this.privRecognizerConfig.autoDetectSourceLanguages!==void 0){const l=this.privRecognizerConfig.autoDetectSourceLanguages.split(",");let u;this.privRecognizerConfig.languageIdMode==="Continuous"?u="DetectContinuous":u="DetectAtAudioStart",this.privSpeechContext.setSection("languageId",{Priority:"PrioritizeLatency",languages:l,mode:u,onSuccess:{action:"Recognize"},onUnknown:{action:"None"}}),this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"Auto"},phraseResults:{resultType:"Always"}});const h=this.privRecognizerConfig.sourceLanguageModels;h!==void 0&&(a.customModels=h,a.onInterim={action:"None"},a.onSuccess={action:"None"})}this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0&&(a.onInterim={action:"Translate"},a.onSuccess={action:"Translate"},this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"None"},phraseResults:{resultType:"None"}})),this.privSpeechContext.setSection("phraseDetection",a)}setOutputDetailLevelJson(){this.privEnableSpeakerId&&(this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true"?this.privSpeechContext.setWordLevelTimings():this.privRecognizerConfig.parameters.getProperty(i.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple]).toLowerCase()===n.OutputFormat[n.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat())}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(a){this.privRecognizerConfig.parameters.setProperty(n.PropertyId.ConversationTranslator_Token,a)}set voiceProfileType(a){this.privRecognizerConfig.parameters.setProperty(n.PropertyId.SpeechServiceConnection_SpeakerIdMode,a)}set authentication(a){this.privAuthentication=a}isDisposed(){return this.privIsDisposed}async dispose(a){if(this.privIsDisposed=!0,this.privConnectionConfigurationPromise!==void 0)try{await(await this.privConnectionConfigurationPromise).dispose(a)}catch{return}}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}async recognize(a,c,l){if(this.recognizeOverride!==void 0){await this.recognizeOverride(a,c,l);return}this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=a,this.setSpeechSegmentationTimeoutJson(),this.setTranslationJson(),this.privSuccessCallback=c,this.privErrorCallback=l,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);const u=this.connectImpl();let h;try{const f=await this.audioSource.attach(this.privRequestSession.audioNodeId),v=await this.audioSource.format,g=await this.audioSource.deviceInfo;this.privIsLiveAudio=g.type&&g.type===i.type.Microphones,h=new t.ReplayableAudioNode(f,v.avgBytesPerSec),await this.privRequestSession.onAudioSourceAttachCompleted(h,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:g}}catch(f){throw await this.privRequestSession.onStopRecognizing(),f}try{await u}catch(f){await this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,f);return}const d=new n.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,d),this.receiveMessage(),this.sendAudio(h).catch(async f=>{await this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,f)})}async stopRecognizing(){if(this.privRequestSession.isRecognizing)try{await this.audioSource.turnOff(),await this.sendFinalAudio(),await this.privRequestSession.onStopRecognizing(),await this.privRequestSession.turnCompletionPromise}finally{await this.privRequestSession.dispose()}}async connect(){return await this.connectImpl(),Promise.resolve()}connectAsync(a,c){this.connectImpl().then(()=>{try{a&&a()}catch(l){c&&c(l)}},l=>{try{c&&c(l)}catch{}})}async disconnect(){if(await this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.NoError,"Disconnecting"),this.disconnectOverride!==void 0&&await this.disconnectOverride(),this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose()}catch{}this.privConnectionPromise=void 0}sendMessage(a){}async sendNetworkMessage(a,c){const l=typeof c=="string"?e.MessageType.Text:e.MessageType.Binary,u=typeof c=="string"?"application/json":"";return(await this.fetchConnection()).send(new r.SpeechConnectionMessage(l,a,this.privRequestSession.requestId,u,c))}set activityTemplate(a){this.privActivityTemplate=a}get activityTemplate(){return this.privActivityTemplate}set expectContentAssessmentResponse(a){this.privExpectContentAssessmentResponse=a}async sendTelemetryData(){const a=this.privRequestSession.getTelemetry();if(Zm.telemetryDataEnabled!==!0||this.privIsDisposed||a===null)return;if(Zm.telemetryData)try{Zm.telemetryData(a)}catch{}await(await this.fetchConnection()).send(new r.SpeechConnectionMessage(e.MessageType.Text,"telemetry",this.privRequestSession.requestId,"application/json",a))}async cancelRecognitionLocal(a,c,l){this.privRequestSession.isRecognizing&&(await this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,a,c,l))}async receiveMessage(){try{if(this.privIsDisposed)return;let a=await this.fetchConnection();const c=await a.read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(!c)return this.receiveMessage();this.privServiceHasSentMessage=!0;const l=r.SpeechConnectionMessage.fromConnectionMessage(c);if(l.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(l.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const u=i.SpeechDetected.fromJSON(l.textBody),h=new n.RecognitionEventArgs(u.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,h);break;case"speech.enddetected":let d;l.textBody.length>0?d=l.textBody:d="{ Offset: 0 }";const p=i.SpeechDetected.fromJSON(d),f=new n.RecognitionEventArgs(p.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,f);break;case"turn.end":await this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,await this.cancelRecognitionLocal(n.CancellationReason.EndOfStream,n.CancellationErrorCode.NoError,void 0));const v=new n.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing){this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,v);return}else a=await this.fetchConnection(),await this.sendPrePayloadJSON(a);break;default:await this.processTypeSpecificMessages(l)||this.privServiceEvents&&this.serviceEvents.onEvent(new e.ServiceEvent(l.path.toLowerCase(),l.textBody))}return this.receiveMessage()}catch{return null}}updateSpeakerDiarizationAudioOffset(){const c=this.privRequestSession.recognitionBytesSent/this.privAverageBytesPerMs;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(c)}sendSpeechContext(a,c){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();const l=this.speechContext.toJSON();if(c&&this.privRequestSession.onSpeechContext(),l)return a.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speech.context",this.privRequestSession.requestId,"application/json",l))}noOp(){}async sendPrePayloadJSON(a,c=!0){if(this.sendPrePayloadJSONOverride!==void 0)return this.sendPrePayloadJSONOverride(a);await this.sendSpeechContext(a,c),await this.sendWaveHeader(a)}async sendWaveHeader(a){const c=await this.audioSource.format;return a.send(new r.SpeechConnectionMessage(e.MessageType.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",c.header))}connectImpl(){return this.privConnectionPromise!==void 0?this.privConnectionPromise.then(a=>a.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl())):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),this.postConnectImplOverride!==void 0?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(a,c,l){if(c.onSpeechContext(),Zm.telemetryDataEnabled!==!0){const h={context:{system:JSON.parse(l).context.system}};l=JSON.stringify(h)}if(this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()==="true"){const u=JSON.parse(l);u.context.DisableReferenceChannel="True",u.context.MicSpec="1_0_0",l=JSON.stringify(u)}if(l)return a.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speech.config",c.requestId,"application/json",l))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(a=>a.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async sendAudio(a){const c=await this.audioSource.format;this.privAverageBytesPerMs=c.avgBytesPerSec/1e3;let l=Date.now();const u=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),h=c.avgBytesPerSec/1e3*parseInt(u,10),d=this.privRequestSession.recogNumber,p=async()=>{if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===d){const f=await this.fetchConnection(),v=await a.read();if(this.privRequestSession.isSpeechEnded)return;let g,m;if(!v||v.isEnd?(g=null,m=0):(g=v.buffer,this.privRequestSession.onAudioSent(g.byteLength),h>=this.privRequestSession.bytesSent?m=0:m=Math.max(0,l-Date.now())),m!==0&&await this.delay(m),g!==null&&(l=Date.now()+g.byteLength*1e3/(c.avgBytesPerSec*2)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===d)if(f.send(new r.SpeechConnectionMessage(e.MessageType.Binary,"audio",this.privRequestSession.requestId,null,g)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),v!=null&&v.isEnd)this.privIsLiveAudio||this.privRequestSession.onSpeechEnded();else return p()}};return p()}async retryableConnect(){let a=!1;this.privAuthFetchEventId=e.createNoDashGuid();const c=this.privRequestSession.sessionId;this.privConnectionId=c!==void 0?c:e.createNoDashGuid(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let l=0,u="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){const d=await(a?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId));await this.privRequestSession.onAuthCompleted(!1);const p=this.privConnectionFactory.create(this.privRecognizerConfig,d,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(p.events),p.events.attach(v=>{this.connectionEvents.onEvent(v)});const f=await p.open();if(f.statusCode===200)return await this.privRequestSession.onConnectionEstablishCompleted(f.statusCode),Promise.resolve(p);f.statusCode===1006&&(a=!0),l=f.statusCode,u=f.reason,this.privRequestSession.onRetryConnection()}return await this.privRequestSession.onConnectionEstablishCompleted(l,u),Promise.reject(`Unable to contact server. StatusCode: ${l}, ${this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${u}`)}delay(a){return new Promise(c=>this.privSetTimeout(c,a))}writeBufferToConsole(a){let c="Buffer Size: ";if(a===null)c+="null";else{const l=new Uint8Array(a);c+=`${a.byteLength}\r
`;for(let u=0;u<a.byteLength;u++)c+=l[u].toString(16).padStart(2,"0")+" ",(u+1)%16===0&&(console.info(c),c="")}console.info(c)}async sendFinalAudio(){await(await this.fetchConnection()).send(new r.SpeechConnectionMessage(e.MessageType.Binary,"audio",this.privRequestSession.requestId,null,null))}async configureConnection(){const a=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(a):(await this.sendSpeechServiceConfig(a,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendPrePayloadJSON(a,!1),a)}};return Qf.ServiceRecognizerBase=s,s.telemetryDataEnabled=!0,Qf}var Zf={},sk;function _K(){if(sk)return Zf;sk=1,Object.defineProperty(Zf,"__esModule",{value:!0}),Zf.ConversationServiceRecognizer=void 0;const t=ye(),e=We();let n=class extends e.ServiceRecognizerBase{constructor(r,s,o,a,c){super(r,s,o,a,c),this.handleSpeechPhraseMessage=async l=>this.handleSpeechPhrase(l),this.handleSpeechHypothesisMessage=l=>this.handleSpeechHypothesis(l)}processTypeSpecificMessages(r){}handleRecognizedCallback(r,s,o){}handleRecognizingCallback(r,s,o){}async processSpeechMessages(r){let s=!1;switch(r.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(r.textBody),s=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&await this.handleSpeechPhraseMessage(r.textBody),s=!0;break}return s}cancelRecognition(r,s,o,a,c){}async handleSpeechPhrase(r){const s=e.SimpleSpeechPhrase.fromJSON(r),o=e.EnumTranslation.implTranslateRecognitionResult(s.RecognitionStatus);let a;const c=new t.PropertyCollection;c.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r);const l=s.Offset+this.privRequestSession.currentTurnAudioOffset;let u=l;if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+s.Offset+s.Duration),t.ResultReason.Canceled===o){const h=e.EnumTranslation.implTranslateCancelResult(s.RecognitionStatus),d=e.EnumTranslation.implTranslateCancelErrorCode(s.RecognitionStatus);await this.cancelRecognitionLocal(h,d,e.EnumTranslation.implTranslateErrorDetails(d))}else if(!(this.privRequestSession.isSpeechEnded&&o===t.ResultReason.NoMatch&&s.RecognitionStatus!==e.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(e.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])a=new t.SpeechRecognitionResult(this.privRequestSession.requestId,o,s.DisplayText,s.Duration,l,s.Language,s.LanguageDetectionConfidence,s.SpeakerId,void 0,r,c);else{const h=e.DetailedSpeechPhrase.fromJSON(r),d=h.Offset+this.privRequestSession.currentTurnAudioOffset,p=h.getJsonWithCorrectedOffsets(d);a=new t.SpeechRecognitionResult(this.privRequestSession.requestId,o,h.Text,h.Duration,d,h.Language,h.LanguageDetectionConfidence,h.SpeakerId,void 0,p,c),u=a.offset}this.handleRecognizedCallback(a,u,this.privRequestSession.sessionId)}}handleSpeechHypothesis(r){const s=e.SpeechHypothesis.fromJSON(r),o=s.Offset+this.privRequestSession.currentTurnAudioOffset,a=new t.PropertyCollection;a.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r);const c=new t.SpeechRecognitionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,s.Text,s.Duration,o,s.Language,s.LanguageDetectionConfidence,s.SpeakerId,void 0,r,a);this.privRequestSession.onHypothesis(o),this.handleRecognizingCallback(c,s.Duration,this.privRequestSession.sessionId)}};return Zf.ConversationServiceRecognizer=n,Zf}var H_={},ok;function wK(){return ok||(ok=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerConfig=t.SpeechResultFormat=t.RecognitionMode=void 0;const e=ye(),n=We();var i;(function(s){s[s.Interactive=0]="Interactive",s[s.Conversation=1]="Conversation",s[s.Dictation=2]="Dictation"})(i=t.RecognitionMode||(t.RecognitionMode={})),function(s){s[s.Simple=0]="Simple",s[s.Detailed=1]="Detailed"}(t.SpeechResultFormat||(t.SpeechResultFormat={}));class r{constructor(o,a){this.privSpeechServiceConfig=o||new n.SpeechServiceConfig(new n.Context(null)),this.privParameters=a,this.privMaxRetryCount=parseInt(a.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=a.getProperty(e.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(o){this.privRecognitionMode=o,this.privRecognitionActivityTimeout=o===i.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=i[o]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==i.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(e.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,void 0)}get sourceLanguageModels(){const o=[];let a=!1;if(this.autoDetectSourceLanguages!==void 0)for(const c of this.autoDetectSourceLanguages.split(",")){const l=c+e.PropertyId.SpeechServiceConnection_EndpointId.toString(),u=this.parameters.getProperty(l,void 0);u!==void 0?(o.push({language:c,endpoint:u}),a=!0):o.push({language:c,endpoint:""})}return a?o:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(o){this.privEnableSpeakerId=o}}t.RecognizerConfig=r}(H_)),H_}var SB={};Object.defineProperty(SB,"__esModule",{value:!0});var Ix={};Object.defineProperty(Ix,"__esModule",{value:!0});Ix.WebsocketMessageFormatter=void 0;const As=ht(),ak=`\r
`;class EK{toConnectionMessage(e){const n=new As.Deferred;try{if(e.messageType===As.MessageType.Text){const i=e.textContent;let r={},s=null;if(i){const o=i.split(`\r
\r
`);o&&o.length>0&&(r=this.parseHeaders(o[0]),o.length>1&&(s=o[1]))}n.resolve(new As.ConnectionMessage(e.messageType,s,r,e.id))}else if(e.messageType===As.MessageType.Binary){const i=e.binaryContent;let r={},s=null;if(!i||i.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const o=new DataView(i),a=o.getInt16(0);if(i.byteLength<a+2)throw new Error("Invalid binary message format. Header content missing.");let c="";for(let l=0;l<a;l++)c+=String.fromCharCode(o.getInt8(l+2));r=this.parseHeaders(c),i.byteLength>a+2&&(s=i.slice(2+a)),n.resolve(new As.ConnectionMessage(e.messageType,s,r,e.id))}}catch(i){n.reject(`Error formatting the message. Error: ${i}`)}return n.promise}fromConnectionMessage(e){const n=new As.Deferred;try{if(e.messageType===As.MessageType.Text){const i=`${this.makeHeaders(e)}${ak}${e.textBody?e.textBody:""}`;n.resolve(new As.RawWebsocketMessage(As.MessageType.Text,i,e.id))}else if(e.messageType===As.MessageType.Binary){const i=this.makeHeaders(e),r=e.binaryBody,s=this.stringToArrayBuffer(i),o=new Int8Array(s),a=o.byteLength,c=new Int8Array(2+a+(r?r.byteLength:0));if(c[0]=a>>8&255,c[1]=a&255,c.set(o,2),r){const u=new Int8Array(r);c.set(u,2+a)}const l=c.buffer;n.resolve(new As.RawWebsocketMessage(As.MessageType.Binary,l,e.id))}}catch(i){n.reject(`Error formatting the message. ${i}`)}return n.promise}makeHeaders(e){let n="";if(e.headers)for(const i in e.headers)i&&(n+=`${i}: ${e.headers[i]}${ak}`);return n}parseHeaders(e){const n={};if(e){const i=e.match(/[^\r\n]+/g);if(n){for(const r of i)if(r){const s=r.indexOf(":"),o=s>0?r.substr(0,s).trim().toLowerCase():r,a=s>0&&r.length>s+1?r.substr(s+1).trim():"";n[o]=a}}}return n}stringToArrayBuffer(e){const n=new ArrayBuffer(e.length),i=new DataView(n);for(let r=0;r<e.length;r++)i.setUint8(r,e.charCodeAt(r));return n}}Ix.WebsocketMessageFormatter=EK;var em={},ck;function RK(){if(ck)return em;ck=1,Object.defineProperty(em,"__esModule",{value:!0}),em.SpeechConnectionFactory=void 0;const t=zi(),e=We(),n=ye(),i=No(),r=We(),s=Fi,o=Do;let a=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/speech/universal/v"}create(l,u,h){let d=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0);const p=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region,void 0),f=i.ConnectionFactoryBase.getHostSuffix(p),v=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,"wss://"+p+".stt.speech"+f),g={},m=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId,void 0),y=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(m?(!d||d.search(o.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(g[o.QueryParameterNames.CustomSpeechDeploymentId]=m):y&&(!d||d.search(o.QueryParameterNames.Language)===-1)&&(g[o.QueryParameterNames.Language]=y),(!d||d.search(o.QueryParameterNames.Format)===-1)&&(g[o.QueryParameterNames.Format]=l.parameters.getProperty(e.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple]).toLowerCase()),l.autoDetectSourceLanguages!==void 0&&(g[o.QueryParameterNames.EnableLanguageId]="true"),this.setCommonUrlParams(l,g,d),!d)switch(l.recognitionMode){case r.RecognitionMode.Conversation:l.parameters.getProperty(e.ForceDictationPropertyName,"false")==="true"?d=v+this.dictationRelativeUri:l.recognitionEndpointVersion!==void 0&&parseInt(l.recognitionEndpointVersion,10)>1?d=`${v}${this.universalUri}${l.recognitionEndpointVersion}`:d=v+this.conversationRelativeUri;break;case r.RecognitionMode.Dictation:d=v+this.dictationRelativeUri;break;default:l.recognitionEndpointVersion!==void 0&&parseInt(l.recognitionEndpointVersion,10)>1?d=`${v}${this.universalUri}${l.recognitionEndpointVersion}`:d=v+this.interactiveRelativeUri;break}const S={};u.token!==void 0&&u.token!==""&&(S[u.headerName]=u.token),S[s.HeaderNames.ConnectionId]=h;const x=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",w=new t.WebsocketConnection(d,g,S,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(l),x,h),C=w.uri;return l.parameters.setProperty(n.PropertyId.SpeechServiceConnection_Url,C),w}};return em.SpeechConnectionFactory=a,em}var tm={},lk;function bK(){if(lk)return tm;lk=1,Object.defineProperty(tm,"__esModule",{value:!0}),tm.ConversationTranscriberConnectionFactory=void 0;const t=zi(),e=ye(),n=We(),i=No(),r=We(),s=Fi,o=Do;let a=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/speech/universal/v2"}create(l,u,h){let d=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const p=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,void 0),f=i.ConnectionFactoryBase.getHostSuffix(p),v=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+p+".stt.speech"+f),g={},m=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),y=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);m?(!d||d.search(o.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(g[o.QueryParameterNames.CustomSpeechDeploymentId]=m):y&&(!d||d.search(o.QueryParameterNames.Language)===-1)&&(g[o.QueryParameterNames.Language]=y),l.autoDetectSourceLanguages!==void 0&&(g[o.QueryParameterNames.EnableLanguageId]="true"),this.setV2UrlParams(l,g,d),d||(d=`${v}${this.universalUri}`);const S={};u.token!==void 0&&u.token!==""&&(S[u.headerName]=u.token),S[s.HeaderNames.ConnectionId]=h;const x=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",w=new t.WebsocketConnection(d,g,S,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(l),x,h),C=w.uri;return l.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,C),w}setV2UrlParams(l,u,h){new Map([[e.PropertyId.Speech_SegmentationSilenceTimeoutMs,o.QueryParameterNames.SegmentationSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_EnableAudioLogging,o.QueryParameterNames.EnableAudioLogging],[e.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,o.QueryParameterNames.EndSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,o.QueryParameterNames.InitialSilenceTimeoutMs],[e.PropertyId.SpeechServiceResponse_PostProcessingOption,o.QueryParameterNames.Postprocessing],[e.PropertyId.SpeechServiceResponse_ProfanityOption,o.QueryParameterNames.Profanity],[e.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,o.QueryParameterNames.StableIntermediateThreshold]]).forEach((f,v)=>{this.setUrlParameter(v,f,l,u,h)});const p=JSON.parse(l.parameters.getProperty(n.ServicePropertiesPropertyName,"{}"));Object.keys(p).forEach(f=>{u[f]=p[f]})}};return tm.ConversationTranscriberConnectionFactory=a,tm}var nm={},uk;function TK(){if(uk)return nm;uk=1,Object.defineProperty(nm,"__esModule",{value:!0}),nm.TranscriberConnectionFactory=void 0;const t=zi(),e=ye(),n=No(),i=We(),r=Fi,s=Do;let o=class extends n.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(c,l,u){let h=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,"centralus"),p=n.ConnectionFactoryBase.getHostSuffix(d),f="wss://transcribe."+d+".cts.speech"+p+this.multiaudioRelativeUri,v=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,f),g={};this.setQueryParams(g,c,h),h||(h=v);const m={};l.token!==void 0&&l.token!==""&&(m[l.headerName]=l.token),m[r.HeaderNames.ConnectionId]=u,c.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,h);const y=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(h,g,m,new i.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),y,u)}setQueryParams(c,l,u){const h=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),d=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);h&&!(s.QueryParameterNames.CustomSpeechDeploymentId in c)&&(c[s.QueryParameterNames.CustomSpeechDeploymentId]=h),d&&!(s.QueryParameterNames.Language in c)&&(c[s.QueryParameterNames.Language]=d);const p=l.parameters.getProperty(e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true",f=l.parameters.getProperty(i.OutputFormatPropertyName,e.OutputFormat[e.OutputFormat.Simple])!==e.OutputFormat[e.OutputFormat.Simple];(p||f)&&(c[s.QueryParameterNames.Format]=e.OutputFormat[e.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(l,c,u)}};return nm.TranscriberConnectionFactory=o,nm}var im={},hk;function AK(){if(hk)return im;hk=1,Object.defineProperty(im,"__esModule",{value:!0}),im.TranslationConnectionFactory=void 0;const t=zi(),e=M0,n=ye(),i=No(),r=We(),s=Fi,o=Do;let a=class extends i.ConnectionFactoryBase{create(l,u,h){const d=this.getEndpointUrl(l),p={};l.autoDetectSourceLanguages!==void 0&&(p[o.QueryParameterNames.EnableLanguageId]="true"),this.setQueryParams(p,l,d);const f={};u.token!==void 0&&u.token!==""&&(f[u.headerName]=u.token),f[s.HeaderNames.ConnectionId]=h,l.parameters.setProperty(n.PropertyId.SpeechServiceConnection_Url,d);const v=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(d,p,f,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(l),v,h)}getEndpointUrl(l,u){const h=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region),d=i.ConnectionFactoryBase.getHostSuffix(h);let p=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0);return p||(l.autoDetectSourceLanguages!==void 0?p=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+d)+"/speech/universal/v2":p=l.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+d)+"/speech/translation/cognitiveservices/v1"),u===!0?p:e.StringUtils.formatString(p,{region:h})}setQueryParams(l,u,h){l.from=u.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage),l.to=u.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages),l.scenario=u.recognitionMode===r.RecognitionMode.Interactive?"interactive":u.recognitionMode===r.RecognitionMode.Conversation?"conversation":"",this.setCommonUrlParams(u,l,h),this.setUrlParameter(n.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,o.QueryParameterNames.StableTranslation,u,l,h);const d=u.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);d!==void 0&&(l.voice=d,l.features="texttospeech")}};return im.TranslationConnectionFactory=a,im}var rm={},dk;function PK(){if(dk)return rm;dk=1,Object.defineProperty(rm,"__esModule",{value:!0}),rm.EnumTranslation=void 0;const t=ye(),e=We();let n=class{static implTranslateRecognitionResult(r,s=!1){let o=t.ResultReason.Canceled;switch(r){case e.RecognitionStatus.Success:o=t.ResultReason.RecognizedSpeech;break;case e.RecognitionStatus.EndOfDictation:o=s?t.ResultReason.RecognizedSpeech:t.ResultReason.NoMatch;break;case e.RecognitionStatus.NoMatch:case e.RecognitionStatus.InitialSilenceTimeout:case e.RecognitionStatus.BabbleTimeout:o=t.ResultReason.NoMatch;break;case e.RecognitionStatus.Error:case e.RecognitionStatus.BadRequest:case e.RecognitionStatus.Forbidden:default:o=t.ResultReason.Canceled;break}return o}static implTranslateCancelResult(r){let s=t.CancellationReason.EndOfStream;switch(r){case e.RecognitionStatus.Success:case e.RecognitionStatus.EndOfDictation:case e.RecognitionStatus.NoMatch:s=t.CancellationReason.EndOfStream;break;case e.RecognitionStatus.InitialSilenceTimeout:case e.RecognitionStatus.BabbleTimeout:case e.RecognitionStatus.Error:case e.RecognitionStatus.BadRequest:case e.RecognitionStatus.Forbidden:default:s=t.CancellationReason.Error;break}return s}static implTranslateCancelErrorCode(r){let s=t.CancellationErrorCode.NoError;switch(r){case e.RecognitionStatus.Error:s=t.CancellationErrorCode.ServiceError;break;case e.RecognitionStatus.TooManyRequests:s=t.CancellationErrorCode.TooManyRequests;break;case e.RecognitionStatus.BadRequest:s=t.CancellationErrorCode.BadRequestParameters;break;case e.RecognitionStatus.Forbidden:s=t.CancellationErrorCode.Forbidden;break;default:s=t.CancellationErrorCode.NoError;break}return s}static implTranslateErrorDetails(r){let s="The speech service encountered an internal error and could not continue.";switch(r){case t.CancellationErrorCode.Forbidden:s="The recognizer is using a free subscription that ran out of quota.";break;case t.CancellationErrorCode.BadRequestParameters:s="Invalid parameter or unsupported audio format in the request.";break;case t.CancellationErrorCode.TooManyRequests:s="The number of parallel requests exceeded the number of allowed concurrent transcriptions.";break}return s}};return rm.EnumTranslation=n,rm}var xB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecognitionStatus=t.SynthesisStatus=void 0,function(e){e[e.Success=0]="Success",e[e.SynthesisEnd=1]="SynthesisEnd",e[e.Error=2]="Error"}(t.SynthesisStatus||(t.SynthesisStatus={})),function(e){e[e.Success=0]="Success",e[e.NoMatch=1]="NoMatch",e[e.InitialSilenceTimeout=2]="InitialSilenceTimeout",e[e.BabbleTimeout=3]="BabbleTimeout",e[e.Error=4]="Error",e[e.EndOfDictation=5]="EndOfDictation",e[e.TooManyRequests=6]="TooManyRequests",e[e.BadRequest=7]="BadRequest",e[e.Forbidden=8]="Forbidden"}(t.RecognitionStatus||(t.RecognitionStatus={}))})(xB);var sm={},pk;function IK(){if(pk)return sm;pk=1,Object.defineProperty(sm,"__esModule",{value:!0}),sm.TranslationSynthesisEnd=void 0;const t=We();let e=class CB{constructor(i){this.privSynthesisEnd=JSON.parse(i),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=t.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=t.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(i){return new CB(i)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}};return sm.TranslationSynthesisEnd=e,sm}var Mx={};Object.defineProperty(Mx,"__esModule",{value:!0});Mx.TranslationHypothesis=void 0;const MK=_t,kK=ZS;class w1{constructor(e){this.privTranslationHypothesis=e,this.privTranslationHypothesis.Translation.TranslationStatus=kK.TranslationStatus[this.privTranslationHypothesis.Translation.TranslationStatus]}static fromJSON(e){return new w1(JSON.parse(e))}static fromTranslationResponse(e){MK.Contracts.throwIfNullOrUndefined(e,"translationHypothesis");const n=e.SpeechHypothesis;return e.SpeechHypothesis=void 0,n.Translation=e,new w1(n)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){var e;return(e=this.privTranslationHypothesis.PrimaryLanguage)==null?void 0:e.Language}}Mx.TranslationHypothesis=w1;var om={},fk;function LK(){if(fk)return om;fk=1,Object.defineProperty(om,"__esModule",{value:!0}),om.TranslationPhrase=void 0;const t=_t,e=We(),n=ZS;let i=class mR{constructor(s){this.privTranslationPhrase=s,this.privTranslationPhrase.RecognitionStatus=e.RecognitionStatus[this.privTranslationPhrase.RecognitionStatus],this.privTranslationPhrase.Translation!==void 0&&(this.privTranslationPhrase.Translation.TranslationStatus=n.TranslationStatus[this.privTranslationPhrase.Translation.TranslationStatus])}static fromJSON(s){return new mR(JSON.parse(s))}static fromTranslationResponse(s){t.Contracts.throwIfNullOrUndefined(s,"translationResponse");const o=s.SpeechPhrase;return s.SpeechPhrase=void 0,o.Translation=s,o.Text=o.DisplayText,new mR(o)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){var s;return(s=this.privTranslationPhrase.PrimaryLanguage)==null?void 0:s.Language}get Confidence(){var s;return(s=this.privTranslationPhrase.PrimaryLanguage)==null?void 0:s.Confidence}get Translation(){return this.privTranslationPhrase.Translation}};return om.TranslationPhrase=i,om}var am={},mk;function DK(){if(mk)return am;mk=1,Object.defineProperty(am,"__esModule",{value:!0}),am.TranslationServiceRecognizer=void 0;const t=ht(),e=ye(),n=We();let i=class extends n.ConversationServiceRecognizer{constructor(s,o,a,c,l){super(s,o,a,c,l),this.privTranslationRecognizer=l,this.connectionEvents.attach(u=>{u.name==="ConnectionEstablishedEvent"&&this.privTranslationRecognizer.onConnection()})}async processTypeSpecificMessages(s){const o=new e.PropertyCollection;let a=await this.processSpeechMessages(s);if(a)return!0;const c=async u=>{if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+u.Offset+u.Duration),u.RecognitionStatus===n.RecognitionStatus.Success){const h=this.fireEventForResult(u,o);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,h)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(h.result)}catch(d){this.privErrorCallback&&this.privErrorCallback(d)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{const h=n.EnumTranslation.implTranslateRecognitionResult(u.RecognitionStatus),d=new e.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,h,u.Text,u.Duration,this.privRequestSession.currentTurnAudioOffset+u.Offset,u.Language,u.Confidence,void 0,s.textBody,o);if(h===e.ResultReason.Canceled){const p=n.EnumTranslation.implTranslateCancelResult(u.RecognitionStatus),f=n.EnumTranslation.implTranslateCancelErrorCode(u.RecognitionStatus);await this.cancelRecognitionLocal(p,f,n.EnumTranslation.implTranslateErrorDetails(f))}else{if(!(this.privRequestSession.isSpeechEnded&&h===e.ResultReason.NoMatch&&u.RecognitionStatus!==n.RecognitionStatus.InitialSilenceTimeout)){const p=new e.TranslationRecognitionEventArgs(d,d.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,p)}catch{}}if(this.privSuccessCallback){try{this.privSuccessCallback(d)}catch(p){this.privErrorCallback&&this.privErrorCallback(p)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}a=!0}},l=(u,h)=>{const d=this.fireEventForResult(u,h);if(this.privRequestSession.onHypothesis(this.privRequestSession.currentTurnAudioOffset+d.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,d)}catch{}a=!0};switch(s.messageType===t.MessageType.Text&&o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,s.textBody),s.path.toLowerCase()){case"translation.hypothesis":l(n.TranslationHypothesis.fromJSON(s.textBody),o);break;case"translation.response":const u=JSON.parse(s.textBody);if(u.SpeechPhrase)await c(n.TranslationPhrase.fromTranslationResponse(u));else{const d=JSON.parse(s.textBody);d.SpeechHypothesis&&l(n.TranslationHypothesis.fromTranslationResponse(d),o)}break;case"translation.phrase":await c(n.TranslationPhrase.fromJSON(s.textBody));break;case"translation.synthesis":this.sendSynthesisAudio(s.binaryBody,this.privRequestSession.sessionId),a=!0;break;case"audio.end":case"translation.synthesis.end":const h=n.TranslationSynthesisEnd.fromJSON(s.textBody);switch(h.SynthesisStatus){case n.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){const d=new e.TranslationSynthesisResult(e.ResultReason.Canceled,void 0),p=new e.TranslationSynthesisEventArgs(d,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,p)}catch{}}if(this.privTranslationRecognizer.canceled){const d=new e.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,e.CancellationReason.Error,h.FailureReason,e.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,d)}catch{}}break;case n.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId);break}a=!0;break}return a}cancelRecognition(s,o,a,c,l){const u=new e.PropertyCollection;if(u.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[c]),this.privTranslationRecognizer.canceled){const h=new e.TranslationRecognitionCanceledEventArgs(s,a,l,c,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new e.TranslationRecognitionResult(void 0,o,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,l,void 0,u);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}handleRecognizingCallback(s,o,a){try{const c=new e.TranslationRecognitionEventArgs(e.TranslationRecognitionResult.fromSpeechRecognitionResult(s),o,a);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,c)}catch{}}handleRecognizedCallback(s,o,a){try{const c=new e.TranslationRecognitionEventArgs(e.TranslationRecognitionResult.fromSpeechRecognitionResult(s),o,a);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,c)}catch{}}fireEventForResult(s,o){let a;if(s.Translation.Translations!==void 0){a=new e.Translations;for(const f of s.Translation.Translations)a.set(f.Language,f.Text||f.DisplayText)}let c,l;s instanceof n.TranslationPhrase?(s.Translation&&s.Translation.TranslationStatus===t.TranslationStatus.Success?c=e.ResultReason.TranslatedSpeech:c=e.ResultReason.RecognizedSpeech,l=s.Confidence):c=e.ResultReason.TranslatingSpeech;const u=s.Language,h=s.Offset+this.privRequestSession.currentTurnAudioOffset,d=new e.TranslationRecognitionResult(a,this.privRequestSession.requestId,c,s.Text,s.Duration,h,u,l,s.Translation.FailureReason,JSON.stringify(s),o);return new e.TranslationRecognitionEventArgs(d,h,this.privRequestSession.sessionId)}sendSynthesisAudio(s,o){const a=s===void 0?e.ResultReason.SynthesizingAudioCompleted:e.ResultReason.SynthesizingAudio,c=new e.TranslationSynthesisResult(a,s),l=new e.TranslationSynthesisEventArgs(c,o);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,l)}catch{}}};return am.TranslationServiceRecognizer=i,am}var kx={};Object.defineProperty(kx,"__esModule",{value:!0});kx.SpeechDetected=void 0;class b2{constructor(e){this.privSpeechStartDetected=JSON.parse(e)}static fromJSON(e){return new b2(e)}get Offset(){return this.privSpeechStartDetected.Offset}}kx.SpeechDetected=b2;var Lx={};Object.defineProperty(Lx,"__esModule",{value:!0});Lx.SpeechHypothesis=void 0;class T2{constructor(e){this.privSpeechHypothesis=JSON.parse(e)}static fromJSON(e){return new T2(e)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}}Lx.SpeechHypothesis=T2;var Dx={};Object.defineProperty(Dx,"__esModule",{value:!0});Dx.SpeechKeyword=void 0;class A2{constructor(e){this.privSpeechKeyword=JSON.parse(e)}static fromJSON(e){return new A2(e)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}}Dx.SpeechKeyword=A2;var cm={},gk;function NK(){if(gk)return cm;gk=1,Object.defineProperty(cm,"__esModule",{value:!0}),cm.SpeechServiceRecognizer=void 0;const t=ye(),e=We();let n=class extends e.ServiceRecognizerBase{constructor(r,s,o,a,c){super(r,s,o,a,c),this.privSpeechRecognizer=c}async processTypeSpecificMessages(r){let s;const o=new t.PropertyCollection;o.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r.textBody);let a=!1;switch(r.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const c=e.SpeechHypothesis.fromJSON(r.textBody),l=c.Offset+this.privRequestSession.currentTurnAudioOffset;s=new t.SpeechRecognitionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,c.Text,c.Duration,l,c.Language,c.LanguageDetectionConfidence,void 0,void 0,r.textBody,o),this.privRequestSession.onHypothesis(l);const u=new t.SpeechRecognitionEventArgs(s,c.Duration,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,u)}catch{}a=!0;break;case"speech.phrase":const h=e.SimpleSpeechPhrase.fromJSON(r.textBody),d=e.EnumTranslation.implTranslateRecognitionResult(h.RecognitionStatus,this.privExpectContentAssessmentResponse);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+h.Offset+h.Duration),t.ResultReason.Canceled===d){const p=e.EnumTranslation.implTranslateCancelResult(h.RecognitionStatus),f=e.EnumTranslation.implTranslateCancelErrorCode(h.RecognitionStatus);await this.cancelRecognitionLocal(p,f,e.EnumTranslation.implTranslateErrorDetails(f))}else{if(!(this.privRequestSession.isSpeechEnded&&d===t.ResultReason.NoMatch&&h.RecognitionStatus!==e.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(e.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])s=new t.SpeechRecognitionResult(this.privRequestSession.requestId,d,h.DisplayText,h.Duration,h.Offset+this.privRequestSession.currentTurnAudioOffset,h.Language,h.LanguageDetectionConfidence,void 0,void 0,r.textBody,o);else{const f=e.DetailedSpeechPhrase.fromJSON(r.textBody),v=f.Offset+this.privRequestSession.currentTurnAudioOffset,g=f.getJsonWithCorrectedOffsets(v);s=new t.SpeechRecognitionResult(this.privRequestSession.requestId,d,f.RecognitionStatus===e.RecognitionStatus.Success?f.NBest[0].Display:void 0,f.Duration,v,f.Language,f.LanguageDetectionConfidence,void 0,void 0,g,o)}const p=new t.SpeechRecognitionEventArgs(s,s.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,p)}catch{}}if(this.privSuccessCallback){try{this.privSuccessCallback(s)}catch(p){this.privErrorCallback&&this.privErrorCallback(p)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}a=!0;break}return a}cancelRecognition(r,s,o,a,c){const l=new t.PropertyCollection;if(l.setProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[a]),this.privSpeechRecognizer.canceled){const u=new t.SpeechRecognitionCanceledEventArgs(o,c,a,void 0,r);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,u)}catch{}}if(this.privSuccessCallback){const u=new t.SpeechRecognitionResult(s,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,c,void 0,l);try{this.privSuccessCallback(u),this.privSuccessCallback=void 0}catch{}}}};return cm.SpeechServiceRecognizer=n,cm}var lm={},vk;function OK(){if(vk)return lm;vk=1,Object.defineProperty(lm,"__esModule",{value:!0}),lm.ConversationTranscriptionServiceRecognizer=void 0;const t=ye(),e=We();let n=class extends e.ServiceRecognizerBase{constructor(r,s,o,a,c){super(r,s,o,a,c),this.privConversationTranscriber=c,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){const r=this.privSpeechContext.getSection("phraseDetection");r.mode="Conversation";const s={};s.mode="Anonymous",s.audioSessionId=this.privDiarizationSessionId,s.audioOffsetMs=0,r.speakerDiarization=s,this.privSpeechContext.setSection("phraseDetection",r)}}async processTypeSpecificMessages(r){let s;const o=new t.PropertyCollection;o.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r.textBody);let a=!1;switch(r.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const c=e.SpeechHypothesis.fromJSON(r.textBody),l=c.Offset+this.privRequestSession.currentTurnAudioOffset;s=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,c.Text,c.Duration,l,c.Language,c.LanguageDetectionConfidence,void 0,void 0,r.textBody,o),this.privRequestSession.onHypothesis(l);const u=new t.ConversationTranscriptionEventArgs(s,c.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,u)}catch{}a=!0;break;case"speech.phrase":const h=e.SimpleSpeechPhrase.fromJSON(r.textBody),d=e.EnumTranslation.implTranslateRecognitionResult(h.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+h.Offset+h.Duration),t.ResultReason.Canceled===d){const p=e.EnumTranslation.implTranslateCancelResult(h.RecognitionStatus),f=e.EnumTranslation.implTranslateCancelErrorCode(h.RecognitionStatus);await this.cancelRecognitionLocal(p,f,e.EnumTranslation.implTranslateErrorDetails(f))}else if(!(this.privRequestSession.isSpeechEnded&&d===t.ResultReason.NoMatch&&h.RecognitionStatus!==e.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(e.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])s=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,d,h.DisplayText,h.Duration,h.Offset+this.privRequestSession.currentTurnAudioOffset,h.Language,h.LanguageDetectionConfidence,h.SpeakerId,void 0,r.textBody,o);else{const f=e.DetailedSpeechPhrase.fromJSON(r.textBody),v=f.Offset+this.privRequestSession.currentTurnAudioOffset,g=f.getJsonWithCorrectedOffsets(v);s=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,d,f.RecognitionStatus===e.RecognitionStatus.Success?f.NBest[0].Display:void 0,f.Duration,v,f.Language,f.LanguageDetectionConfidence,h.SpeakerId,void 0,g,o)}const p=new t.ConversationTranscriptionEventArgs(s,s.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,p)}catch{}}a=!0;break}return a}cancelRecognition(r,s,o,a,c){if(new t.PropertyCollection().setProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[a]),this.privConversationTranscriber.canceled){const u=new t.ConversationTranscriptionCanceledEventArgs(o,c,a,void 0,r);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,u)}catch{}}}};return lm.ConversationTranscriptionServiceRecognizer=n,lm}var um={},yk;function FK(){if(yk)return um;yk=1,Object.defineProperty(um,"__esModule",{value:!0}),um.TranscriptionServiceRecognizer=void 0;const t=ht(),e=ye(),n=We(),i=tc;let r=class extends n.ConversationServiceRecognizer{constructor(o,a,c,l,u){super(o,a,c,l,u),this.privTranscriberRecognizer=u,this.sendPrePayloadJSONOverride=h=>this.sendTranscriptionStartJSON(h),this.privRecognizerConfig.parameters.getProperty(e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)==="true"&&this.privSpeechContext.setWordLevelTimings()}async sendSpeechEventAsync(o,a){if(this.privRequestSession.isRecognizing){const c=await this.fetchConnection();await this.sendSpeechEvent(c,this.createSpeechEventPayload(o,a))}}async sendMeetingSpeechEventAsync(o,a){if(this.privRequestSession.isRecognizing){const c=await this.fetchConnection();await this.sendSpeechEvent(c,this.createMeetingSpeechEventPayload(o,a))}}processTypeSpecificMessages(o){return this.processSpeechMessages(o)}handleRecognizedCallback(o,a,c){try{const l=new e.SpeechRecognitionEventArgs(o,a,c);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,l),this.privSuccessCallback){try{this.privSuccessCallback(o)}catch(u){this.privErrorCallback&&this.privErrorCallback(u)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch{}}handleRecognizingCallback(o,a,c){try{const l=new e.SpeechRecognitionEventArgs(o,a,c);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,l)}catch{}}cancelRecognition(o,a,c,l,u){const h=new e.PropertyCollection;if(h.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[l]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){const d=new e.MeetingTranscriptionCanceledEventArgs(c,u,l,void 0,o);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,d)}catch{}}}else if(this.privTranscriberRecognizer.canceled){const d=new e.ConversationTranscriptionCanceledEventArgs(c,u,l,void 0,o);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,d)}catch{}}if(this.privSuccessCallback){const d=new e.SpeechRecognitionResult(a,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,u,void 0,h);try{this.privSuccessCallback(d),this.privSuccessCallback=void 0}catch{}}}async sendTranscriptionStartJSON(o){if(await this.sendSpeechContext(o,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){const a=this.privTranscriberRecognizer.getMeetingInfo(),c=this.createMeetingSpeechEventPayload(a,"start");await this.sendSpeechEvent(o,c)}else{const a=this.privTranscriberRecognizer.getConversationInfo(),c=this.createSpeechEventPayload(a,"start");await this.sendSpeechEvent(o,c)}await this.sendWaveHeader(o)}sendSpeechEvent(o,a){const c=JSON.stringify(a);if(c)return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"speech.event",this.privRequestSession.requestId,"application/json",c))}createSpeechEventPayload(o,a){const c={id:"meeting",name:a,meeting:o.conversationProperties};return c.meeting.id=o.id,c.meeting.attendees=o.participants,c}createMeetingSpeechEventPayload(o,a){const c={id:"meeting",name:a,meeting:o.meetingProperties};return c.meeting.id=o.id,c.meeting.attendees=o.participants,c}};return um.TranscriptionServiceRecognizer=r,um}var hm={},Sk;function zK(){if(Sk)return hm;Sk=1,Object.defineProperty(hm,"__esModule",{value:!0}),hm.DetailedSpeechPhrase=void 0;const t=We();let e=class _B{constructor(i){this.privDetailedSpeechPhrase=JSON.parse(i),this.privDetailedSpeechPhrase.RecognitionStatus=t.RecognitionStatus[this.privDetailedSpeechPhrase.RecognitionStatus]}static fromJSON(i){return new _B(i)}getJsonWithCorrectedOffsets(i){if(this.privDetailedSpeechPhrase.NBest){let r;for(const s of this.privDetailedSpeechPhrase.NBest)if(s.Words&&s.Words[0]){r=s.Words[0].Offset;break}if(r&&r<i){const s=i-r;for(const o of this.privDetailedSpeechPhrase.NBest){if(o.Words)for(const a of o.Words)a.Offset+=s;if(o.DisplayWords)for(const a of o.DisplayWords)a.Offset+=s}}}return JSON.stringify(this.privDetailedSpeechPhrase)}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}};return hm.DetailedSpeechPhrase=e,hm}var dm={},xk;function UK(){if(xk)return dm;xk=1,Object.defineProperty(dm,"__esModule",{value:!0}),dm.SimpleSpeechPhrase=void 0;const t=We();let e=class wB{constructor(i){this.privSimpleSpeechPhrase=JSON.parse(i),this.privSimpleSpeechPhrase.RecognitionStatus=t.RecognitionStatus[this.privSimpleSpeechPhrase.RecognitionStatus]}static fromJSON(i){return new wB(i)}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}};return dm.SimpleSpeechPhrase=e,dm}var Nx={};Object.defineProperty(Nx,"__esModule",{value:!0});Nx.AddedLmIntent=void 0;class BK{constructor(e,n){this.modelImpl=e,this.intentName=n}}Nx.AddedLmIntent=BK;var pm={},Ck;function $K(){if(Ck)return pm;Ck=1,Object.defineProperty(pm,"__esModule",{value:!0}),pm.IntentServiceRecognizer=void 0;const t=ht(),e=ye(),n=We();let i=class extends n.ServiceRecognizerBase{constructor(s,o,a,c,l){super(s,o,a,c,l),this.privIntentRecognizer=l,this.privIntentDataSent=!1}setIntents(s,o){this.privAddedLmIntents=s,this.privUmbrellaIntent=o,this.privIntentDataSent=!0}processTypeSpecificMessages(s){let o,a,c=!1;const l=new e.PropertyCollection;switch(s.messageType===t.MessageType.Text&&l.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,s.textBody),s.path.toLowerCase()){case"speech.hypothesis":const h=n.SpeechHypothesis.fromJSON(s.textBody);if(o=new e.IntentRecognitionResult(void 0,this.privRequestSession.requestId,e.ResultReason.RecognizingIntent,h.Text,h.Duration,h.Offset+this.privRequestSession.currentTurnAudioOffset,h.Language,h.LanguageDetectionConfidence,void 0,s.textBody,l),this.privRequestSession.onHypothesis(o.offset),a=new e.IntentRecognitionEventArgs(o,h.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,a)}catch{}c=!0;break;case"speech.phrase":const d=n.SimpleSpeechPhrase.fromJSON(s.textBody);o=new e.IntentRecognitionResult(void 0,this.privRequestSession.requestId,n.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus),d.DisplayText,d.Duration,d.Offset+this.privRequestSession.currentTurnAudioOffset,d.Language,d.LanguageDetectionConfidence,void 0,s.textBody,l),a=new e.IntentRecognitionEventArgs(o,o.offset,this.privRequestSession.sessionId);const p=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,a)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(o)}catch(v){this.privErrorCallback&&this.privErrorCallback(v)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};this.privIntentDataSent===!1||e.ResultReason.NoMatch===a.result.reason?(this.privRequestSession.onPhraseRecognized(a.offset+a.result.duration),p()):this.privPendingIntentArgs=a,c=!0;break;case"response":if(a=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,a===void 0){if(s.textBody==="")return;a=new e.IntentRecognitionEventArgs(new e.IntentRecognitionResult,0,this.privRequestSession.sessionId)}const f=n.IntentResponse.fromJSON(s.textBody);if(f!==null&&f.topScoringIntent&&f.topScoringIntent.intent){let v=this.privAddedLmIntents[f.topScoringIntent.intent];if(this.privUmbrellaIntent!==void 0&&(v=this.privUmbrellaIntent),v){const g=v===void 0||v.intentName===void 0?f.topScoringIntent.intent:v.intentName;let m=a.result.reason;g!==void 0&&(m=e.ResultReason.RecognizedIntent);const y=a.result.properties!==void 0?a.result.properties:new e.PropertyCollection;y.setProperty(e.PropertyId.LanguageUnderstandingServiceResponse_JsonResult,s.textBody),a=new e.IntentRecognitionEventArgs(new e.IntentRecognitionResult(g,a.result.resultId,m,a.result.text,a.result.duration,a.result.offset,void 0,void 0,a.result.errorDetails,a.result.json,y),a.offset,a.sessionId)}}if(this.privRequestSession.onPhraseRecognized(a.offset+a.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,a)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(a.result)}catch(v){this.privErrorCallback&&this.privErrorCallback(v)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}c=!0;break}const u=new t.Deferred;return u.resolve(c),u.promise}cancelRecognition(s,o,a,c,l){const u=new e.PropertyCollection;if(u.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[c]),this.privIntentRecognizer.canceled){const h=new e.IntentRecognitionCanceledEventArgs(a,l,c,void 0,void 0,s);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new e.IntentRecognitionResult(void 0,o,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,l,void 0,u);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}};return pm.IntentServiceRecognizer=i,pm}var Ox={};Object.defineProperty(Ox,"__esModule",{value:!0});Ox.IntentResponse=void 0;class P2{constructor(e){e===""?this.privIntentResponse={}:this.privIntentResponse=JSON.parse(e)}static fromJSON(e){return new P2(e)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}}Ox.IntentResponse=P2;var EB={};Object.defineProperty(EB,"__esModule",{value:!0});var Fx={},zx={};Object.defineProperty(zx,"__esModule",{value:!0});zx.ServiceTelemetryListener=void 0;const Ca=ht(),_k=Px;class HK{constructor(e,n,i){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=n,this.privAudioNodeId=i,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){this.privIsDisposed||(e instanceof _k.RecognitionTriggeredEvent&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof Ca.AudioStreamNodeAttachingEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof Ca.AudioStreamNodeAttachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof Ca.AudioSourceErrorEvent&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof Ca.AudioStreamNodeErrorEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof Ca.AudioStreamNodeDetachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof _k.ConnectingToServiceEvent&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof Ca.ConnectionStartEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof Ca.ConnectionEstablishedEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof Ca.ConnectionEstablishErrorEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof Ca.ConnectionMessageReceivedEvent&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array),this.privReceivedMessages[e.message.headers.path].length<50&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)))}getTelemetry(){const e=new Array;this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const n={Metrics:e,ReceivedMessages:this.privReceivedMessages},i=JSON.stringify(n);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],i}get hasTelemetry(){return Object.keys(this.privReceivedMessages).length!==0||this.privListeningTriggerMetric!==null||this.privMicMetric!==null||this.privConnectionEstablishMetric!==null||this.privPhraseLatencies.length!==0||this.privHypothesisLatencies.length!==0}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}}}zx.ServiceTelemetryListener=HK;Object.defineProperty(Fx,"__esModule",{value:!0});Fx.RequestSession=void 0;const uh=ht(),_v=Px,VK=zx;class jK{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=uh.createNoDashGuid(),this.privAudioNodeId=uh.createNoDashGuid(),this.privTurnDeferral=new uh.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new VK.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new _v.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}async onAudioSourceAttachCompleted(e,n){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,n?await this.onComplete():this.onEvent(new _v.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onPreConnectionStart(e,n){this.privAuthFetchEventId=e,this.privSessionId=n,this.onEvent(new _v.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}async onAuthCompleted(e){e&&await this.onComplete()}async onConnectionEstablishCompleted(e,n){if(e===200){this.onEvent(new _v.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0;return}else e===403&&await this.onComplete()}async onServiceTurnEndResponse(e){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(await this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}onSpeechContext(){this.privRequestId=uh.createNoDashGuid()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new uh.Deferred}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e,this.privRecognitionBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)await e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}async onStopRecognizing(){await this.onComplete()}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),uh.Events.instance.onEvent(e)}async onComplete(){this.privIsRecognizing&&(this.privIsRecognizing=!1,await this.detachAudioNode())}async detachAudioNode(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&await this.privAudioNode.detach())}}Fx.RequestSession=jK;var Ux={};Object.defineProperty(Ux,"__esModule",{value:!0});Ux.SpeechContext=void 0;class WK{constructor(e){this.privContext={},this.privDynamicGrammar=e}getSection(e){return this.privContext[e]||{}}setSection(e,n){this.privContext[e]=n}setPronunciationAssessmentParams(e,n,i=!1){this.privContext.phraseDetection===void 0&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment===void 0&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e),i&&(this.privContext.phraseDetection.mode="Conversation"),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push("PronunciationAssessment"),this.privContext.phraseOutput.detailed.options.indexOf("SNR")===-1&&this.privContext.phraseOutput.detailed.options.push("SNR"),n&&(this.privContext.phraseDetection.enrichment.contentAssessment={topic:n},this.privContext.phraseOutput.detailed.options.push("ContentAssessment"))}setDetailedOutputFormat(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed"}setWordLevelTimings(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed",this.privContext.phraseOutput.detailed.options.indexOf("WordTimings")===-1&&this.privContext.phraseOutput.detailed.options.push("WordTimings")}setSpeakerDiarizationAudioOffsetMs(e){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=e}toJSON(){const e=this.privDynamicGrammar.generateGrammarObject();return this.setSection("dgi",e),JSON.stringify(this.privContext)}}Ux.SpeechContext=WK;var Bx={};Object.defineProperty(Bx,"__esModule",{value:!0});Bx.DynamicGrammarBuilder=void 0;class GK{addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}generateGrammarObject(){if(this.privGrammars===void 0&&this.privPhrases===void 0)return;const e={};if(e.ReferenceGrammars=this.privGrammars,this.privPhrases!==void 0&&this.privPhrases.length!==0){const n=[];this.privPhrases.forEach(i=>{n.push({Text:i})}),e.Groups=[{Type:"Generic",Items:n}]}return e}}Bx.DynamicGrammarBuilder=GK;var RB={};Object.defineProperty(RB,"__esModule",{value:!0});var fm={},$x={},Hx={},I2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDataStreamType=t.ActivityPayloadResponse=void 0;class e{constructor(i){this.privActivityResponse=JSON.parse(i)}static fromJSON(i){return new e(i)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}t.ActivityPayloadResponse=e,function(n){n[n.None=0]="None",n[n.TextToSpeechAudio=1]="TextToSpeechAudio"}(t.MessageDataStreamType||(t.MessageDataStreamType={}))})(I2);Object.defineProperty(Hx,"__esModule",{value:!0});Hx.DialogServiceTurnState=void 0;const qK=xl,XK=Vi,KK=I2;class YK{constructor(e,n){this.privRequestId=n,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e,n){return e.messageDataStreamType===KK.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=XK.AudioOutputStream.createPullStream(),this.privAudioStream.format=n!==void 0?n:qK.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){this.privAudioStream!==null&&!this.privAudioStream.isClosed&&this.privAudioStream.close()}complete(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}}Hx.DialogServiceTurnState=YK;Object.defineProperty($x,"__esModule",{value:!0});$x.DialogServiceTurnStateManager=void 0;const wk=Wi,JK=Hx;class QK{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new wk.InvalidOperationError("Service error: There is already a turn with id:"+e);const n=new JK.DialogServiceTurnState(this,e);return this.privTurnMap.set(e,n),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new wk.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+e);const n=this.privTurnMap.get(e);return n.complete(),this.privTurnMap.delete(e),n}}$x.DialogServiceTurnStateManager=QK;var Ek;function ZK(){if(Ek)return fm;Ek=1,Object.defineProperty(fm,"__esModule",{value:!0}),fm.DialogServiceAdapter=void 0;const t=zi(),e=Pu,n=ht(),i=xl,r=ye(),s=$x,o=We(),a=I2,c=tc;let l=class extends o.ServiceRecognizerBase{constructor(h,d,p,f,v){super(h,d,p,f,v),this.privEvents=new n.EventSource,this.privDialogServiceConnector=v,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new s.DialogServiceTurnStateManager,this.recognizeOverride=(g,m,y)=>this.listenOnce(g,m,y),this.postConnectImplOverride=g=>this.dialogConnectImpl(g),this.configConnectionOverride=g=>this.configConnection(g),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=p,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach(g=>{g.name==="ConnectionClosedEvent"&&(this.terminateMessageLoop=!0)})}async sendMessage(h){const d=n.createGuid(),p=n.createNoDashGuid(),f={context:{interactionId:d},messagePayload:JSON.parse(h),version:.5},v=JSON.stringify(f);await(await this.fetchConnection()).send(new c.SpeechConnectionMessage(n.MessageType.Text,"agent",p,"application/json",v))}async privDisconnect(){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1}processTypeSpecificMessages(h){const d=new r.PropertyCollection;h.messageType===n.MessageType.Text&&d.setProperty(r.PropertyId.SpeechServiceResponse_JsonResult,h.textBody);let p,f;switch(h.path.toLowerCase()){case"speech.phrase":const g=o.SimpleSpeechPhrase.fromJSON(h.textBody);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+g.Offset+g.Duration),g.RecognitionStatus!==o.RecognitionStatus.TooManyRequests&&g.RecognitionStatus!==o.RecognitionStatus.Error){const C=this.fireEventForResult(g,d);if(this.privLastResult=C.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,C)}catch{}}f=!0;break;case"speech.hypothesis":const m=o.SpeechHypothesis.fromJSON(h.textBody),y=m.Offset+this.privRequestSession.currentTurnAudioOffset;p=new r.SpeechRecognitionResult(this.privRequestSession.requestId,r.ResultReason.RecognizingSpeech,m.Text,m.Duration,y,m.Language,m.LanguageDetectionConfidence,void 0,void 0,h.textBody,d),this.privRequestSession.onHypothesis(y);const S=new r.SpeechRecognitionEventArgs(p,m.Duration,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,S)}catch{}f=!0;break;case"speech.keyword":const x=o.SpeechKeyword.fromJSON(h.textBody);p=new r.SpeechRecognitionResult(this.privRequestSession.requestId,x.Status==="Accepted"?r.ResultReason.RecognizedKeyword:r.ResultReason.NoMatch,x.Text,x.Duration,x.Offset,void 0,void 0,void 0,void 0,h.textBody,d),x.Status!=="Accepted"&&(this.privLastResult=p);const w=new r.SpeechRecognitionEventArgs(p,p.duration,p.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,w)}catch{}f=!0;break;case"audio":{const C=h.requestId.toUpperCase(),E=this.privTurnStateManager.GetTurn(C);try{h.binaryBody?E.audioStream.write(h.binaryBody):E.endAudioStream()}catch{}}f=!0;break;case"response":this.handleResponseMessage(h),f=!0;break}const v=new n.Deferred;return v.resolve(f),v.promise}async cancelRecognition(h,d,p,f,v){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&await this.privRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){const g=new r.PropertyCollection;g.setProperty(o.CancellationErrorCodePropertyName,r.CancellationErrorCode[f]);const m=new r.SpeechRecognitionCanceledEventArgs(p,v,f,void 0,h);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,m)}catch{}if(this.privSuccessCallback){const y=new r.SpeechRecognitionResult(void 0,r.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,v,void 0,g);try{this.privSuccessCallback(y),this.privSuccessCallback=void 0}catch{}}}}async listenOnce(h,d,p){this.privRecognizerConfig.recognitionMode=h,this.privSuccessCallback=d,this.privErrorCallback=p,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(r.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const f=this.connectImpl(),v=this.sendPreAudioMessages(),g=await this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),m=await this.privDialogAudioSource.format,y=await this.privDialogAudioSource.deviceInfo,S=new t.ReplayableAudioNode(g,m.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(S,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:y};try{await f,await v}catch(C){return await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.ConnectionFailure,C),Promise.resolve()}const x=new r.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,x),this.sendAudio(S).then(()=>{},async C=>{await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.RuntimeError,C)})}dialogConnectImpl(h){return this.privConnectionLoop=this.startMessageLoop(),h}receiveDialogMessageOverride(){const h=new n.Deferred,d=async()=>{try{const p=this.isDisposed(),f=!this.isDisposed()&&this.terminateMessageLoop;if(p||f){h.resolve(void 0);return}const g=await(await this.fetchConnection()).read();if(!g)return d();const m=c.SpeechConnectionMessage.fromConnectionMessage(g);switch(m.path.toLowerCase()){case"turn.start":{const b=m.requestId.toUpperCase(),M=this.privRequestSession.requestId.toUpperCase();b!==M?this.privTurnStateManager.StartTurn(b):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const S=o.SpeechDetected.fromJSON(m.textBody),x=new r.RecognitionEventArgs(S.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,x);break;case"speech.enddetected":let w;m.textBody.length>0?w=m.textBody:w="{ Offset: 0 }";const C=o.SpeechDetected.fromJSON(w);this.privRequestSession.onServiceRecognized(C.Offset+this.privRequestSession.currentTurnAudioOffset);const E=new r.RecognitionEventArgs(C.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,E);break;case"turn.end":{const b=m.requestId.toUpperCase(),M=this.privRequestSession.requestId.toUpperCase();if(b!==M)this.privTurnStateManager.CompleteTurn(b);else{const _=new r.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(!1),(!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,_),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(R){this.privErrorCallback&&this.privErrorCallback(R)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{await this.processTypeSpecificMessages(m)||this.serviceEvents&&this.serviceEvents.onEvent(new n.ServiceEvent(m.path.toLowerCase(),m.textBody))}catch{}}return d()}catch{this.terminateMessageLoop=!0,h.resolve()}};return d().catch(p=>{n.Events.instance.onEvent(new n.BackgroundEvent(p))}),h.promise}async startMessageLoop(){this.terminateMessageLoop=!1;try{await this.receiveDialogMessageOverride()}catch(h){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.RuntimeError,h)}return Promise.resolve()}async configConnection(h){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(await this.sendSpeechServiceConfig(h,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendAgentConfig(h),h)}async sendPreAudioMessages(){const h=await this.fetchConnection();this.addKeywordContextData(),await this.sendSpeechContext(h,!0),await this.sendAgentContext(h),await this.sendWaveHeader(h)}sendAgentConfig(h){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(r.PropertyId.Conversation_DialogType)===r.DialogServiceConfig.DialogTypes.CustomCommands){const p=this.agentConfig.get();p.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(p)}this.onEvent(new e.SendingAgentContextMessageEvent(this.agentConfig));const d=this.agentConfig.toJsonString();return this.agentConfigSent=!0,h.send(new c.SpeechConnectionMessage(n.MessageType.Text,"agent.config",this.privRequestSession.requestId,"application/json",d))}}sendAgentContext(h){const d=n.createGuid(),p=this.privDialogServiceConnector.properties.getProperty(r.PropertyId.Conversation_Speech_Activity_Template),v=JSON.stringify({channelData:"",context:{interactionId:d},messagePayload:typeof p===void 0?void 0:p,version:.5});return h.send(new c.SpeechConnectionMessage(n.MessageType.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",v))}fireEventForResult(h,d){const p=o.EnumTranslation.implTranslateRecognitionResult(h.RecognitionStatus),f=h.Offset+this.privRequestSession.currentTurnAudioOffset,v=new r.SpeechRecognitionResult(this.privRequestSession.requestId,p,h.DisplayText,h.Duration,f,h.Language,h.LanguageDetectionConfidence,void 0,void 0,JSON.stringify(h),d);return new r.SpeechRecognitionEventArgs(v,f,this.privRequestSession.sessionId)}handleResponseMessage(h){const d=JSON.parse(h.textBody);switch(d.messageType.toLowerCase()){case"message":const p=h.requestId.toUpperCase(),f=a.ActivityPayloadResponse.fromJSON(h.textBody),v=this.privTurnStateManager.GetTurn(p);if(f.conversationId){const y=this.agentConfig.get();y.botInfo.conversationId=f.conversationId,this.agentConfig.set(y)}const g=v.processActivityPayload(f,i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(r.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),m=new r.ActivityReceivedEventArgs(f.messagePayload,g);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,m)}catch{}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new r.TurnStatusReceivedEventArgs(h.textBody))}catch{}break;default:n.Events.instance.onEvent(new n.BackgroundEvent(`Unexpected response of type ${d.messageType}. Ignoring.`));break}}onEvent(h){this.privEvents.onEvent(h),n.Events.instance.onEvent(h)}addKeywordContextData(){const h=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(h===void 0)return;const d=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),p=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),f=h.split(";"),v=d===void 0?[]:d.split(";"),g=p===void 0?[]:p.split(";"),m=[];for(let y=0;y<f.length;y++){const S={};S.text=f[y],y<v.length&&(S.offset=Number(v[y])),y<g.length&&(S.duration=Number(g[y])),m.push(S)}this.speechContext.setSection("invocationSource","VoiceActivationWithKeyword"),this.speechContext.setSection("keywordDetection",[{clientDetectedKeywords:m,onReject:{action:"EndOfTurn"},type:"startTrigger"}])}};return fm.DialogServiceAdapter=l,fm}var Vx={};Object.defineProperty(Vx,"__esModule",{value:!0});Vx.AgentConfig=void 0;class eY{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}Vx.AgentConfig=eY;var V_={},mm={},ap={};Object.defineProperty(ap,"__esModule",{value:!0});ap.ConversationConnectionConfig=void 0;const tY=k0;class ar extends tY.RestConfigBase{static get host(){return ar.privHost}static get apiVersion(){return ar.privApiVersion}static get clientAppId(){return ar.privClientAppId}static get defaultLanguageCode(){return ar.privDefaultLanguageCode}static get restPath(){return ar.privRestPath}static get webSocketPath(){return ar.privWebSocketPath}static get transcriptionEventKeys(){return ar.privTranscriptionEventKeys}}ap.ConversationConnectionConfig=ar;ar.privHost="dev.microsofttranslator.com";ar.privRestPath="/capito/room";ar.privApiVersion="2.0";ar.privDefaultLanguageCode="en-US";ar.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15";ar.privWebSocketPath="/capito/translate";ar.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"];var Rk;function nY(){if(Rk)return mm;Rk=1,Object.defineProperty(mm,"__esModule",{value:!0}),mm.ConversationManager=void 0;const t=zi(),e=_t,n=ye(),i=ap;let r=class{constructor(){this.privRequestParams=i.ConversationConnectionConfig.configParams,this.privErrors=i.ConversationConnectionConfig.restErrors,this.privHost=i.ConversationConnectionConfig.host,this.privApiVersion=i.ConversationConnectionConfig.apiVersion,this.privRestPath=i.ConversationConnectionConfig.restPath,this.privRestAdapter=new t.RestMessageAdapter({})}createOrJoin(o,a,c,l){try{e.Contracts.throwIfNullOrUndefined(o,"args");const u=o.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,i.ConversationConnectionConfig.defaultLanguageCode),h=o.getProperty(n.PropertyId.ConversationTranslator_Name,"conversation_host"),d=o.getProperty(n.PropertyId.ConversationTranslator_Host,this.privHost),p=o.getProperty(n.PropertyId.ConversationTranslator_CorrelationId),f=o.getProperty(n.PropertyId.SpeechServiceConnection_Key),v=o.getProperty(n.PropertyId.SpeechServiceConnection_Region),g=o.getProperty(n.PropertyId.SpeechServiceAuthorization_Token);e.Contracts.throwIfNullOrWhitespace(u,"languageCode"),e.Contracts.throwIfNullOrWhitespace(h,"nickname"),e.Contracts.throwIfNullOrWhitespace(d,"endpointHost");const m={};m[this.privRequestParams.apiVersion]=this.privApiVersion,m[this.privRequestParams.languageCode]=u,m[this.privRequestParams.nickname]=h;const y={};p&&(y[this.privRequestParams.correlationId]=p),y[this.privRequestParams.clientAppId]=i.ConversationConnectionConfig.clientAppId,a!==void 0?m[this.privRequestParams.roomId]=a:(e.Contracts.throwIfNullOrUndefined(v,this.privErrors.authInvalidSubscriptionRegion),y[this.privRequestParams.subscriptionRegion]=v,f?y[this.privRequestParams.subscriptionKey]=f:g?y[this.privRequestParams.authorization]=`Bearer ${g}`:e.Contracts.throwIfNullOrUndefined(f,this.privErrors.authInvalidSubscriptionKey));const S={};S.headers=y,this.privRestAdapter.options=S;const x=`https://${d}${this.privRestPath}`;this.privRestAdapter.request(t.RestRequestType.Post,x,m,null).then(w=>{const C=t.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,w.headers);if(!w.ok){if(l){let b=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",w.status.toString()),M;try{M=JSON.parse(w.data),b+=` [${M.error.code}: ${M.error.message}]`}catch{b+=` [${w.data}]`}C&&(b+=` ${C}`),l(b)}return}const E=JSON.parse(w.data);if(E&&(E.requestId=C),c){try{c(E)}catch(b){l&&l(b)}c=void 0}}).catch(()=>{})}catch(u){if(l)if(u instanceof Error){const h=u;l(h.name+": "+h.message)}else l(u)}}leave(o,a){return new Promise((c,l)=>{try{e.Contracts.throwIfNullOrUndefined(o,this.privErrors.invalidArgs.replace("{arg}","config")),e.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","token"));const u=o.getProperty(n.PropertyId.ConversationTranslator_Host,this.privHost),h=o.getProperty(n.PropertyId.ConversationTranslator_CorrelationId),d={};d[this.privRequestParams.apiVersion]=this.privApiVersion,d[this.privRequestParams.sessionToken]=a;const p={};h&&(p[this.privRequestParams.correlationId]=h);const f={};f.headers=p,this.privRestAdapter.options=f;const v=`https://${u}${this.privRestPath}`;this.privRestAdapter.request(t.RestRequestType.Delete,v,d,null).then(g=>{g.ok,c()}).catch(()=>{})}catch(u){if(u instanceof Error){const h=u;l(h.name+": "+h.message)}else l(u)}})}};return mm.ConversationManager=r,mm}var Bl={},gm={},jx={},L0={};Object.defineProperty(L0,"__esModule",{value:!0});L0.ConversationConnectionMessage=void 0;const iY=ht();class rY extends iY.ConnectionMessage{constructor(e,n,i,r){super(e,n,i,r);const s=JSON.parse(this.textBody);s.type!==void 0&&(this.privConversationMessageType=s.type)}get conversationMessageType(){return this.privConversationMessageType}}L0.ConversationConnectionMessage=rY;Object.defineProperty(jx,"__esModule",{value:!0});jx.ConversationWebsocketMessageFormatter=void 0;const $l=ht(),bk=L0;class sY{toConnectionMessage(e){const n=new $l.Deferred;try{if(e.messageType===$l.MessageType.Text){const i=new bk.ConversationConnectionMessage(e.messageType,e.textContent,{},e.id);n.resolve(i)}else e.messageType===$l.MessageType.Binary&&n.resolve(new bk.ConversationConnectionMessage(e.messageType,e.binaryContent,void 0,e.id))}catch(i){n.reject(`Error formatting the message. Error: ${i}`)}return n.promise}fromConnectionMessage(e){const n=new $l.Deferred;try{if(e.messageType===$l.MessageType.Text){const i=`${e.textBody?e.textBody:""}`;n.resolve(new $l.RawWebsocketMessage($l.MessageType.Text,i,e.id))}}catch(i){n.reject(`Error formatting the message. ${i}`)}return n.promise}}jx.ConversationWebsocketMessageFormatter=sY;var Tk;function oY(){if(Tk)return gm;Tk=1,Object.defineProperty(gm,"__esModule",{value:!0}),gm.ConversationConnectionFactory=void 0;const t=zi(),e=ht(),n=_t,i=ye(),r=No(),s=ap,o=jx;let a=class extends r.ConnectionFactoryBase{create(l,u,h){const d=l.parameters.getProperty(i.PropertyId.ConversationTranslator_Host,s.ConversationConnectionConfig.host),p=l.parameters.getProperty(i.PropertyId.ConversationTranslator_CorrelationId,e.createGuid()),f=`wss://${d}${s.ConversationConnectionConfig.webSocketPath}`,v=l.parameters.getProperty(i.PropertyId.ConversationTranslator_Token,void 0);n.Contracts.throwIfNullOrUndefined(v,"token");const g={};g[s.ConversationConnectionConfig.configParams.apiVersion]=s.ConversationConnectionConfig.apiVersion,g[s.ConversationConnectionConfig.configParams.token]=v,g[s.ConversationConnectionConfig.configParams.correlationId]=p;const m=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(f,g,{},new o.ConversationWebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(l),m,h)}};return gm.ConversationConnectionFactory=a,gm}var vm={},Wx={};Object.defineProperty(Wx,"__esModule",{value:!0});Wx.ConversationRequestSession=void 0;const j_=ht();class aY{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=e,this.privRequestId=j_.createNoDashGuid(),this.privRequestCompletionDeferral=new j_.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(e,n){this.privSessionId=n}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){e!==200&&e===403&&this.onComplete()}onServiceTurnEndResponse(e){e?this.privRequestId=j_.createNoDashGuid():this.onComplete()}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)await e.detach()}}onComplete(){}}Wx.ConversationRequestSession=aY;var yr={},Ak;function bB(){if(Ak)return yr;Ak=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.ConversationReceivedTranslationEventArgs=yr.ParticipantsListEventArgs=yr.ParticipantAttributeEventArgs=yr.ParticipantEventArgs=yr.LockRoomEventArgs=yr.MuteAllEventArgs=void 0;const t=ye();class e extends t.SessionEventArgs{constructor(c,l){super(l),this.privIsMuted=c}get isMuted(){return this.privIsMuted}}yr.MuteAllEventArgs=e;class n extends t.SessionEventArgs{constructor(c,l){super(l),this.privIsLocked=c}get isMuted(){return this.privIsLocked}}yr.LockRoomEventArgs=n;class i extends t.SessionEventArgs{constructor(c,l){super(l),this.privParticipant=c}get participant(){return this.privParticipant}}yr.ParticipantEventArgs=i;class r extends t.SessionEventArgs{constructor(c,l,u,h){super(h),this.privKey=l,this.privValue=u,this.privParticipantId=c}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}yr.ParticipantAttributeEventArgs=r;class s extends t.SessionEventArgs{constructor(c,l,u,h,d,p,f,v,g){super(g),this.privRoomId=c,this.privSessionToken=l,this.privTranslateTo=u,this.privProfanityFilter=h,this.privRoomProfanityFilter=d,this.privIsRoomLocked=p,this.privIsRoomLocked=f,this.privParticipants=v}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}yr.ParticipantsListEventArgs=s;class o{constructor(c,l,u){this.privPayload=l,this.privCommand=c,this.privSessionId=u}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}return yr.ConversationReceivedTranslationEventArgs=o,yr}var Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.ConversationTranslatorCommandTypes=Ha.ConversationTranslatorMessageTypes=Ha.InternalParticipants=void 0;class cY{constructor(e=[],n){this.participants=e,this.meId=n}addOrUpdateParticipant(e){if(e===void 0)return;const n=this.getParticipantIndex(e.id);return n>-1?this.participants.splice(n,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex(n=>n.id===e)}getParticipant(e){return this.participants.find(n=>n.id===e)}deleteParticipant(e){this.participants=this.participants.filter(n=>n.id!==e)}get host(){return this.participants.find(e=>e.isHost===!0)}get me(){return this.getParticipant(this.meId)}}Ha.InternalParticipants=cY;Ha.ConversationTranslatorMessageTypes={command:"command",final:"final",info:"info",instantMessage:"instant_message",keepAlive:"keep_alive",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"};Ha.ConversationTranslatorCommandTypes={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"};var TB={},Gx={};Object.defineProperty(Gx,"__esModule",{value:!0});Gx.CommandResponsePayload=void 0;const lY=t=>JSON.parse(t);class M2{constructor(e){this.privCommandResponse=lY(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(e){return new M2(e)}}Gx.CommandResponsePayload=M2;var Id={};Object.defineProperty(Id,"__esModule",{value:!0});Id.ParticipantPayloadResponse=Id.ParticipantsListPayloadResponse=void 0;const uY=t=>JSON.parse(t),hY=t=>JSON.parse(t);class k2{constructor(e){this.privParticipantsPayloadResponse=uY(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(e){return new k2(e)}}Id.ParticipantsListPayloadResponse=k2;class L2{constructor(e){this.privParticipantPayloadResponse=hY(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(e){return new L2(e)}}Id.ParticipantPayloadResponse=L2;var Md={};Object.defineProperty(Md,"__esModule",{value:!0});Md.TextResponsePayload=Md.SpeechResponsePayload=void 0;const dY=t=>JSON.parse(t),pY=t=>JSON.parse(t);class D2{constructor(e){this.privSpeechResponse=dY(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return this.privSpeechResponse.type==="final"}static fromJSON(e){return new D2(e)}}Md.SpeechResponsePayload=D2;class N2{constructor(e){this.privTextResponse=pY(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(e){return new N2(e)}}Md.TextResponsePayload=N2;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Gx;Object.defineProperty(t,"CommandResponsePayload",{enumerable:!0,get:function(){return e.CommandResponsePayload}});var n=Id;Object.defineProperty(t,"ParticipantsListPayloadResponse",{enumerable:!0,get:function(){return n.ParticipantsListPayloadResponse}}),Object.defineProperty(t,"ParticipantPayloadResponse",{enumerable:!0,get:function(){return n.ParticipantPayloadResponse}});var i=Md;Object.defineProperty(t,"SpeechResponsePayload",{enumerable:!0,get:function(){return i.SpeechResponsePayload}}),Object.defineProperty(t,"TextResponsePayload",{enumerable:!0,get:function(){return i.TextResponsePayload}})})(TB);var Pk;function fY(){if(Pk)return vm;Pk=1,Object.defineProperty(vm,"__esModule",{value:!0}),vm.ConversationServiceAdapter=void 0;const t=ht(),e=ye(),n=We(),i=L0,r=Wx,s=bB(),o=Ha,a=TB;let c=class extends n.ServiceRecognizerBase{constructor(u,h,d,p,f){super(u,h,d,p,f),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=f,this.privConversationAuthentication=u,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=v=>this.conversationConnectImpl(v),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new r.ConversationRequestSession(t.createNoDashGuid()),this.privConversationConnectionFactory=h,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}async dispose(u){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise!==void 0&&await(await this.privConnectionConfigPromise).dispose(u),await super.dispose(u)}async sendMessage(u){return(await this.fetchConnection()).send(new i.ConversationConnectionMessage(t.MessageType.Text,u))}async sendMessageAsync(u){await(await this.fetchConnection()).send(new i.ConversationConnectionMessage(t.MessageType.Text,u))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,e.CancellationReason.Error,e.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}async processTypeSpecificMessages(){return!0}cancelRecognition(u,h,d,p,f){this.terminateMessageLoop=!0;const v=new e.ConversationTranslationCanceledEventArgs(d,f,p,void 0,u);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,v)}catch{}}async conversationConnectImpl(u){return this.privConnectionLoop=this.startMessageLoop(),u}async receiveConversationMessageOverride(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();const u=new t.Deferred;try{const d=await(await this.fetchConnection()).read();if(this.isDisposed()||this.terminateMessageLoop)return u.resolve(),Promise.resolve();if(!d)return this.receiveConversationMessageOverride();const p=this.privConversationRequestSession.sessionId,f=d.conversationMessageType.toLowerCase();let v=!1;try{switch(f){case"info":case"participant_command":case"command":const g=a.CommandResponsePayload.fromJSON(d.textBody);switch(g.command.toLowerCase()){case"participantlist":const C=a.ParticipantsListPayloadResponse.fromJSON(d.textBody),E=C.participants.map(O=>({avatar:O.avatar,displayName:O.nickname,id:O.participantId,isHost:O.ishost,isMuted:O.ismuted,isUsingTts:O.usetts,preferredLanguage:O.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new s.ParticipantsListEventArgs(C.roomid,C.token,C.translateTo,C.profanityFilter,C.roomProfanityFilter,C.roomLocked,C.muteAll,E,p));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setTranslateToLanguages,g.value,p));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setProfanityFiltering,g.value,p));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setMute,g.value,p));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new s.MuteAllEventArgs(g.value,p));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new e.ConversationExpirationEventArgs(g.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setUseTTS,g.value,p));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new s.LockRoomEventArgs(g.value,p));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.changeNickname,g.value,p));break;case"joinsession":const b=a.ParticipantPayloadResponse.fromJSON(d.textBody),M={avatar:b.avatar,displayName:b.nickname,id:b.participantId,isHost:b.ishost,isMuted:b.ismuted,isUsingTts:b.usetts,preferredLanguage:b.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new s.ParticipantEventArgs(M,p));break;case"leavesession":const _={id:g.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new s.ParticipantEventArgs(_,p));break;case"disconnectsession":const R={id:g.participantId};break;case"token":const L=new n.CognitiveTokenAuthentication(()=>{const O=g.token;return Promise.resolve(O)},()=>{const O=g.token;return Promise.resolve(O)});this.authentication=L,this.privConversationServiceConnector.onToken(L);break;default:break}break;case"partial":case"final":const m=a.SpeechResponsePayload.fromJSON(d.textBody),y=f==="final"?e.ResultReason.TranslatedParticipantSpeech:e.ResultReason.TranslatingParticipantSpeech,S=new e.ConversationTranslationResult(m.participantId,this.getTranslations(m.translations),m.language,m.id,y,m.recognition,void 0,void 0,d.textBody,void 0);m.isFinal?((S.text!==void 0&&S.text.length>0||m.id===this.privLastPartialUtteranceId)&&(v=!0),v&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new s.ConversationReceivedTranslationEventArgs(o.ConversationTranslatorMessageTypes.final,S,p))):S.text!==void 0&&(this.privLastPartialUtteranceId=m.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new s.ConversationReceivedTranslationEventArgs(o.ConversationTranslatorMessageTypes.partial,S,p)));break;case"translated_message":const x=a.TextResponsePayload.fromJSON(d.textBody),w=new e.ConversationTranslationResult(x.participantId,this.getTranslations(x.translations),x.language,void 0,void 0,x.originalText,void 0,void 0,void 0,d.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new s.ConversationReceivedTranslationEventArgs(o.ConversationTranslatorMessageTypes.instantMessage,w,p));break;default:break}}catch{}return this.receiveConversationMessageOverride()}catch{this.terminateMessageLoop=!0}return u.promise}async startMessageLoop(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;const u=this.receiveConversationMessageOverride();try{return await u}catch(h){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",e.CancellationReason.Error,e.CancellationErrorCode.RuntimeError,h),null}}configConnection(){return this.isDisposed()?Promise.resolve(void 0):this.privConnectionConfigPromise!==void 0?this.privConnectionConfigPromise.then(u=>u.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise,()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection())):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then(u=>u),this.privConnectionConfigPromise)}getTranslations(u){let h;if(u!==void 0){h=new e.Translations;for(const d of u)h.set(d.lang,d.translation)}return h}};return vm.ConversationServiceAdapter=c,vm}var Ik;function mY(){if(Ik)return Bl;Ik=1,Object.defineProperty(Bl,"__esModule",{value:!0}),Bl.ConversationTranslatorRecognizer=Bl.ConversationRecognizerFactory=void 0;const t=We(),e=ht(),n=_t,i=ye(),r=oY(),s=fY();class o{static fromConfig(l,u,h){return new a(l,u,h)}}Bl.ConversationRecognizerFactory=o;let a=class extends i.Recognizer{constructor(l,u,h){const d=u;n.Contracts.throwIfNull(d,"speechConfig");const p=l;n.Contracts.throwIfNull(p,"conversationImpl"),super(h,d.properties,new r.ConversationConnectionFactory),this.privConversation=p,this.privIsDisposed=!1,this.privProperties=d.properties.clone(),this.privConnection=i.Connection.fromRecognizer(this),this.privProperties.getProperty(i.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?(this.privSetTimeout=e.Timeout.setTimeout,this.privClearTimeout=e.Timeout.clearTimeout):typeof window<"u"?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(l){this.privConnection.connected=l}set disconnected(l){this.privConnection.disconnected=l}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(l,u,h){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfNullOrWhitespace(l,"token"),this.privReco.conversationTranslatorToken=l,this.resetConversationTimeout(),this.privReco.connectAsync(u,h)}catch(d){if(h)if(d instanceof Error){const p=d;h(p.name+": "+p.message)}else h(d)}}disconnect(l,u){try{n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then(()=>{l&&l()},h=>{u&&u(h)})}catch(h){if(u)if(h instanceof Error){const d=h;u(d.name+": "+d.message)}else u(h);this.dispose(!0).catch(d=>{e.Events.instance.onEvent(new e.BackgroundEvent(d))})}}sendRequest(l,u,h){try{n.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(l,u,h)}catch(d){if(h)if(d instanceof Error){const p=d;h(p.name+": "+p.message)}else h(d);this.dispose(!0).catch(p=>{e.Events.instance.onEvent(new e.BackgroundEvent(p))})}}onToken(l){this.privConversation.onToken(l)}async close(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,await this.dispose(!0))}async dispose(l){this.privIsDisposed||l&&(this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),await super.dispose(l))}createRecognizerConfig(l){return new t.RecognizerConfig(l,this.privProperties)}createServiceRecognizer(l,u,h,d){const p=h;return new s.ConversationServiceAdapter(l,u,p,d,this)}sendMessage(l,u,h){const d=this.privReco;((f,v,g)=>{f!==void 0?f.then(()=>{try{v&&v()}catch(m){g&&g(`'Unhandled error on promise callback: ${m}'`)}},m=>{try{g&&g(m)}catch{}}):g&&g("Null promise")})(d.sendMessageAsync(l),u,h),this.resetConversationTimeout()}resetConversationTimeout(){this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout(()=>{this.sendRequest(this.privConversation.getKeepAlive())},6e4)}};return Bl.ConversationTranslatorRecognizer=a,Bl}var ym={},Mk;function gY(){if(Mk)return ym;Mk=1,Object.defineProperty(ym,"__esModule",{value:!0}),ym.TranscriberRecognizer=void 0;const t=ht(),e=_t,n=ye(),i=We();let r=class extends n.Recognizer{constructor(o,a){const c=o;e.Contracts.throwIfNull(c,"speechTranslationConfig");const l=a;e.Contracts.throwIfNull(l,"audioConfigImpl"),e.Contracts.throwIfNullOrWhitespace(c.speechRecognitionLanguage,n.PropertyId[n.PropertyId.SpeechServiceConnection_RecoLanguage]),super(a,c.properties,new i.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return e.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){e.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o)}set conversation(o){e.Contracts.throwIfNullOrUndefined(o,"Conversation"),this.isMeetingRecognizer=!1,this.privConversation=o}getConversationInfo(){return e.Contracts.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}set meeting(o){e.Contracts.throwIfNullOrUndefined(o,"Meeting"),this.isMeetingRecognizer=!0,this.privMeeting=o}getMeetingInfo(){return e.Contracts.throwIfNullOrUndefined(this.privMeeting,"Meeting"),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(o,a){t.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(i.RecognitionMode.Conversation),o,a)}stopContinuousRecognitionAsync(o,a){t.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}async close(){this.privDisposedRecognizer||await this.dispose(!0)}async pushConversationEvent(o,a){const c=this.privReco;e.Contracts.throwIfNullOrUndefined(c,"serviceRecognizer"),await c.sendSpeechEventAsync(o,a)}async pushMeetingEvent(o,a){const c=this.privReco;e.Contracts.throwIfNullOrUndefined(c,"serviceRecognizer"),await c.sendMeetingSpeechEventAsync(o,a)}async enforceAudioGating(){const c=(await this.audioConfig.format).channels;if(c===1){if(this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()!=="true")throw new Error("Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(c!==8)throw new Error(`Unsupported audio configuration: Detected ${c}-channel audio`)}connectMeetingCallbacks(o){this.isMeetingRecognizer=!0,this.canceled=(a,c)=>{o.canceled&&o.canceled(o,c)},this.recognizing=(a,c)=>{o.transcribing&&o.transcribing(o,c)},this.recognized=(a,c)=>{o.transcribed&&o.transcribed(o,c)},this.sessionStarted=(a,c)=>{o.sessionStarted&&o.sessionStarted(o,c)},this.sessionStopped=(a,c)=>{o.sessionStopped&&o.sessionStopped(o,c)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}async dispose(o){this.privDisposedRecognizer||(o&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(o))}createRecognizerConfig(o){return new i.RecognizerConfig(o,this.properties)}createServiceRecognizer(o,a,c,l){const u=c;return new i.TranscriptionServiceRecognizer(o,a,u,l,this)}};return ym.TranscriberRecognizer=r,ym}var kk;function vY(){return kk||(kk=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=nY();Object.defineProperty(t,"ConversationManager",{enumerable:!0,get:function(){return e.ConversationManager}});var n=ap;Object.defineProperty(t,"ConversationConnectionConfig",{enumerable:!0,get:function(){return n.ConversationConnectionConfig}});var i=mY();Object.defineProperty(t,"ConversationRecognizerFactory",{enumerable:!0,get:function(){return i.ConversationRecognizerFactory}});var r=gY();Object.defineProperty(t,"TranscriberRecognizer",{enumerable:!0,get:function(){return r.TranscriberRecognizer}});var s=bB();Object.defineProperty(t,"ConversationReceivedTranslationEventArgs",{enumerable:!0,get:function(){return s.ConversationReceivedTranslationEventArgs}}),Object.defineProperty(t,"LockRoomEventArgs",{enumerable:!0,get:function(){return s.LockRoomEventArgs}}),Object.defineProperty(t,"MuteAllEventArgs",{enumerable:!0,get:function(){return s.MuteAllEventArgs}}),Object.defineProperty(t,"ParticipantAttributeEventArgs",{enumerable:!0,get:function(){return s.ParticipantAttributeEventArgs}}),Object.defineProperty(t,"ParticipantEventArgs",{enumerable:!0,get:function(){return s.ParticipantEventArgs}}),Object.defineProperty(t,"ParticipantsListEventArgs",{enumerable:!0,get:function(){return s.ParticipantsListEventArgs}});var o=Ha;Object.defineProperty(t,"ConversationTranslatorCommandTypes",{enumerable:!0,get:function(){return o.ConversationTranslatorCommandTypes}}),Object.defineProperty(t,"ConversationTranslatorMessageTypes",{enumerable:!0,get:function(){return o.ConversationTranslatorMessageTypes}}),Object.defineProperty(t,"InternalParticipants",{enumerable:!0,get:function(){return o.InternalParticipants}})}(V_)),V_}var O2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SynthesisAudioMetadata=t.MetadataType=void 0,function(n){n.WordBoundary="WordBoundary",n.Bookmark="Bookmark",n.Viseme="Viseme",n.SentenceBoundary="SentenceBoundary",n.SessionEnd="SessionEnd",n.AvatarSignal="TalkingAvatarSignal"}(t.MetadataType||(t.MetadataType={}));class e{constructor(i){this.privSynthesisAudioMetadata=JSON.parse(i)}static fromJSON(i){return new e(i)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}t.SynthesisAudioMetadata=e})(O2);var Sm={},ta={};Object.defineProperty(ta,"__esModule",{value:!0});ta.SynthesisStartedEvent=ta.ConnectingToSynthesisServiceEvent=ta.SynthesisTriggeredEvent=ta.SpeechSynthesisEvent=void 0;const Lk=ht();class qx extends Lk.PlatformEvent{constructor(e,n,i=Lk.EventType.Info){super(e,i),this.privRequestId=n}get requestId(){return this.privRequestId}}ta.SpeechSynthesisEvent=qx;class yY extends qx{constructor(e,n,i){super("SynthesisTriggeredEvent",e),this.privSessionAudioDestinationId=n,this.privTurnAudioDestinationId=i}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}ta.SynthesisTriggeredEvent=yY;class SY extends qx{constructor(e,n){super("ConnectingToSynthesisServiceEvent",e),this.privAuthFetchEventId=n}get authFetchEventId(){return this.privAuthFetchEventId}}ta.ConnectingToSynthesisServiceEvent=SY;class xY extends qx{constructor(e,n){super("SynthesisStartedEvent",e),this.privAuthFetchEventId=n}get authFetchEventId(){return this.privAuthFetchEventId}}ta.SynthesisStartedEvent=xY;var Dk;function CY(){if(Dk)return Sm;Dk=1,Object.defineProperty(Sm,"__esModule",{value:!0}),Sm.SynthesisTurn=void 0;const t=ht(),e=Vi,n=ye(),i=O2,r=ta;let s=class gR{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=t.createNoDashGuid(),this.privTurnDeferral=new t.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(a){this.privStreamId=a}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(a){this.privAudioOutputFormat=a}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){const a=new n.PropertyCollection;return a.setProperty(n.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),a}}async getAllReceivedAudio(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(await this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}async getAllReceivedAudioWithHeader(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){const a=await this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(a),this.privReceivedAudioWithHeader}else return this.getAllReceivedAudio()}startNewSynthesis(a,c,l,u){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=a,this.privRawText=c,this.privIsSSML=l,this.privAudioOutputStream=new e.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",this.privWebRTCSDP="",u!==void 0&&(this.privTurnAudioDestination=u,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new r.SynthesisTriggeredEvent(this.requestId,void 0,u===void 0?void 0:u.id()))}onPreConnectionStart(a){this.privAuthFetchEventId=a,this.onEvent(new r.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(a){a&&this.onComplete()}onConnectionEstablishCompleted(a){if(a===200){this.onEvent(new r.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0;return}else a===403&&this.onComplete()}onServiceResponseMessage(a){const c=JSON.parse(a);this.streamId=c.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(a){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new t.Deferred;const c=JSON.parse(a);c.webrtc&&(this.privWebRTCSDP=c.webrtc.connectionString)}onAudioChunkReceived(a){this.isSynthesizing&&(this.privAudioOutputStream.write(a),this.privBytesReceived+=a.byteLength,this.privTurnAudioDestination!==void 0&&this.privTurnAudioDestination.write(a))}onTextBoundaryEvent(a){this.updateTextOffset(a.Data.text.Text,a.Type)}onVisemeMetadataReceived(a){a.Data.AnimationChunk!==void 0&&(this.privPartialVisemeAnimation+=a.Data.AnimationChunk)}onSessionEnd(a){this.privAudioDuration=a.Data.Offset}async constructSynthesisResult(){const a=await this.getAllReceivedAudioWithHeader();return new n.SpeechSynthesisResult(this.requestId,n.ResultReason.SynthesizingAudioCompleted,a,void 0,this.extraProperties,this.audioDuration)}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){const a=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",a}onEvent(a){t.Events.instance.onEvent(a)}static isXmlTag(a){return a.length>=2&&a[0]==="<"&&a[a.length-1]===">"}updateTextOffset(a,c){c===i.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(a,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+a.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!gR.isXmlTag(a)&&this.updateTextOffset(a,c))):(this.privSentenceOffset=this.privRawText.indexOf(a,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+a.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!gR.isXmlTag(a)&&this.updateTextOffset(a,c)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,this.privTurnAudioDestination!==void 0&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}async readAllAudioFromStream(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{await this.privAudioOutputStream.read(this.privReceivedAudio)}catch{this.privReceivedAudio=new ArrayBuffer(0)}}}withinXmlTag(a){return this.privRawText.indexOf("<",a+1)>this.privRawText.indexOf(">",a+1)}};return Sm.SynthesisTurn=s,Sm}var xm={},Nk;function _Y(){if(Nk)return xm;Nk=1,Object.defineProperty(xm,"__esModule",{value:!0}),xm.SynthesisAdapterBase=void 0;const t=ht(),e=ye(),n=We(),i=tc;let r=class{constructor(o,a,c,l){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!o)throw new t.ArgumentNullError("authentication");if(!a)throw new t.ArgumentNullError("connectionFactory");if(!c)throw new t.ArgumentNullError("synthesizerConfig");this.privAuthentication=o,this.privConnectionFactory=a,this.privSynthesizerConfig=c,this.privIsDisposed=!1,this.privSessionAudioDestination=l,this.privSynthesisTurn=new n.SynthesisTurn,this.privConnectionEvents=new t.EventSource,this.privServiceEvents=new t.EventSource,this.privSynthesisContext=new n.SynthesisContext,this.privAgentConfig=new n.AgentConfig,this.connectionEvents.attach(u=>{if(u.name==="ConnectionClosedEvent"){const h=u;h.statusCode!==1e3&&this.cancelSynthesisLocal(e.CancellationReason.Error,h.statusCode===1007?e.CancellationErrorCode.BadRequestParameters:e.CancellationErrorCode.ConnectionFailure,`${h.reason} websocket error code: ${h.statusCode}`)}})}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(o){this.privActivityTemplate=o}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(o){this.privAudioOutputFormat=o,this.privSynthesisTurn.audioOutputFormat=o,this.privSessionAudioDestination!==void 0&&(this.privSessionAudioDestination.format=o),this.synthesisContext!==void 0&&(this.synthesisContext.audioOutputFormat=o)}isDisposed(){return this.privIsDisposed}async dispose(o){this.privIsDisposed=!0,this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.close(),this.privConnectionConfigurationPromise!==void 0&&await(await this.privConnectionConfigurationPromise).dispose(o)}async connect(){await this.connectImpl()}async sendNetworkMessage(o,a){const c=typeof a=="string"?t.MessageType.Text:t.MessageType.Binary,l=typeof a=="string"?"application/json":"";return(await this.fetchConnection()).send(new i.SpeechConnectionMessage(c,o,this.privSynthesisTurn.requestId,l,a))}async Speak(o,a,c,l,u,h){let d;if(a?d=o:d=this.privSynthesizer.buildSsml(o),this.speakOverride!==void 0)return this.speakOverride(d,c,l,u);this.privSuccessCallback=l,this.privErrorCallback=u,this.privSynthesisTurn.startNewSynthesis(c,o,a,h);try{await this.connectImpl();const p=await this.fetchConnection();await this.sendSynthesisContext(p),await this.sendSsmlMessage(p,d,c),this.onSynthesisStarted(c),this.receiveMessage()}catch(p){return this.cancelSynthesisLocal(e.CancellationReason.Error,e.CancellationErrorCode.ConnectionFailure,p),Promise.reject(p)}}async stopSpeaking(){return await this.connectImpl(),(await this.fetchConnection()).send(new i.SpeechConnectionMessage(t.MessageType.Text,"synthesis.control",this.privSynthesisTurn.requestId,"application/json",JSON.stringify({action:"stop"})))}cancelSynthesis(o,a,c,l){const u=new e.PropertyCollection;u.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[c]);const h=new e.SpeechSynthesisResult(o,e.ResultReason.Canceled,void 0,l,u);if(this.onSynthesisCancelled(h),this.privSuccessCallback)try{this.privSuccessCallback(h)}catch{}}cancelSynthesisLocal(o,a,c){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,o,a,c))}processTypeSpecificMessages(o){return!0}async receiveMessage(){try{const a=await(await this.fetchConnection()).read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!a)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;const c=i.SpeechConnectionMessage.fromConnectionMessage(a);if(c.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(c.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse(c.textBody);break;case"response":this.privSynthesisTurn.onServiceResponseMessage(c.textBody);break;case"audio":this.privSynthesisTurn.streamId.toLowerCase()===c.streamId.toLowerCase()&&c.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(c.binaryBody),this.onSynthesizing(c.binaryBody),this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.write(c.binaryBody));break;case"audio.metadata":const l=n.SynthesisAudioMetadata.fromJSON(c.textBody).Metadata;for(const h of l)switch(h.Type){case n.MetadataType.WordBoundary:case n.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(h);const d=new e.SpeechSynthesisWordBoundaryEventArgs(h.Data.Offset,h.Data.Duration,h.Data.text.Text,h.Data.text.Length,h.Type===n.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,h.Data.text.BoundaryType);this.onWordBoundary(d);break;case n.MetadataType.Bookmark:const p=new e.SpeechSynthesisBookmarkEventArgs(h.Data.Offset,h.Data.Bookmark);this.onBookmarkReached(p);break;case n.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(h),h.Data.IsLastAnimation){const f=new e.SpeechSynthesisVisemeEventArgs(h.Data.Offset,h.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(f)}break;case n.MetadataType.AvatarSignal:this.onAvatarEvent(h);break;case n.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(h);break}break;case"turn.end":this.privSynthesisTurn.onServiceTurnEndResponse();let u;try{u=await this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(u)}catch(h){this.privErrorCallback&&this.privErrorCallback(h)}this.onSynthesisCompleted(u);break;default:this.processTypeSpecificMessages(c)||this.privServiceEvents&&this.serviceEvents.onEvent(new t.ServiceEvent(c.path.toLowerCase(),c.textBody))}return this.receiveMessage()}catch{}}sendSynthesisContext(o){this.setSynthesisContextSynthesisSection();const a=this.synthesisContext.toJSON();if(a)return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",a))}setSpeechConfigSynthesisSection(){}connectImpl(o=!1){if(this.privConnectionPromise!=null)return this.privConnectionPromise.then(c=>c.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()));this.privAuthFetchEventId=t.createNoDashGuid(),this.privConnectionId=t.createNoDashGuid(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);const a=o?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=a.then(async c=>{this.privSynthesisTurn.onAuthCompleted(!1);const l=this.privConnectionFactory.create(this.privSynthesizerConfig,c,this.privConnectionId);l.events.attach(h=>{this.connectionEvents.onEvent(h)});const u=await l.open();return u.statusCode===200?(this.privSynthesisTurn.onConnectionEstablishCompleted(u.statusCode),Promise.resolve(l)):u.statusCode===403&&!o?this.connectImpl(!0):(this.privSynthesisTurn.onConnectionEstablishCompleted(u.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${u.statusCode},
                    ${this.privSynthesizerConfig.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Url)} Reason: ${u.reason}`))},c=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(c)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise}sendSpeechServiceConfig(o,a){if(a)return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",a))}sendSsmlMessage(o,a,c){return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"ssml",c,"application/ssml+xml",a))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(o=>o.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async configureConnection(){const o=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(o):(this.setSpeechConfigSynthesisSection(),await this.sendSpeechServiceConfig(o,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),o)}onAvatarEvent(o){}onSynthesisStarted(o){}onSynthesizing(o){}onSynthesisCancelled(o){}onSynthesisCompleted(o){}onWordBoundary(o){}onVisemeReceived(o){}onBookmarkReached(o){}};return xm.SynthesisAdapterBase=r,r.telemetryDataEnabled=!0,xm}var Cm={},Ok;function wY(){if(Ok)return Cm;Ok=1,Object.defineProperty(Cm,"__esModule",{value:!0}),Cm.AvatarSynthesisAdapter=void 0;const t=ye(),e=We();let n=class extends e.SynthesisAdapterBase{constructor(r,s,o,a,c){super(r,s,o,void 0),this.privAvatarSynthesizer=a,this.privSynthesizer=a,this.privAvatarConfig=c}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){var r,s,o,a,c,l,u,h,d,p,f,v,g,m,y,S,x;this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:(r=this.privAvatarConfig.videoFormat)==null?void 0:r.bitrate,codec:(s=this.privAvatarConfig.videoFormat)==null?void 0:s.codec,crop:{bottomRight:{x:(c=(a=(o=this.privAvatarConfig.videoFormat)==null?void 0:o.cropRange)==null?void 0:a.bottomRight)==null?void 0:c.x,y:(h=(u=(l=this.privAvatarConfig.videoFormat)==null?void 0:l.cropRange)==null?void 0:u.bottomRight)==null?void 0:h.y},topLeft:{x:(f=(p=(d=this.privAvatarConfig.videoFormat)==null?void 0:d.cropRange)==null?void 0:p.topLeft)==null?void 0:f.x,y:(m=(g=(v=this.privAvatarConfig.videoFormat)==null?void 0:v.cropRange)==null?void 0:g.topLeft)==null?void 0:m.y}},resolution:{height:(y=this.privAvatarConfig.videoFormat)==null?void 0:y.height,width:(S=this.privAvatarConfig.videoFormat)==null?void 0:S.width}},protocol:{name:"WebRTC",webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(t.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarConfig.remoteIceServers??this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor,image:{url:(x=this.privAvatarConfig.backgroundImage)==null?void 0:x.toString()}},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,style:this.privAvatarConfig.style}}}onAvatarEvent(r){if(this.privAvatarSynthesizer.avatarEventReceived){const s=new t.AvatarEventArgs(r.Data.Offset,r.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,s)}catch{}}}};return Cm.AvatarSynthesisAdapter=n,Cm}var _m={},Fk;function EY(){if(Fk)return _m;Fk=1,Object.defineProperty(_m,"__esModule",{value:!0}),_m.SpeechSynthesisAdapter=void 0;const t=ye(),e=We();let n=class extends e.SynthesisAdapterBase{constructor(r,s,o,a,c){super(r,s,o,c),this.privSpeechSynthesizer=a,this.privSynthesizer=a}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(r){const s=new t.SpeechSynthesisEventArgs(new t.SpeechSynthesisResult(r,t.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,s)}onSynthesizing(r){if(this.privSpeechSynthesizer.synthesizing)try{const s=this.privSynthesisTurn.audioOutputFormat.addHeader(r),o=new t.SpeechSynthesisEventArgs(new t.SpeechSynthesisResult(this.privSynthesisTurn.requestId,t.ResultReason.SynthesizingAudio,s));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,o)}catch{}}onSynthesisCancelled(r){if(this.privSpeechSynthesizer.SynthesisCanceled){const s=new t.SpeechSynthesisEventArgs(r);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,s)}catch{}}}onSynthesisCompleted(r){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new t.SpeechSynthesisEventArgs(r))}catch{}}onWordBoundary(r){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,r)}catch{}}onVisemeReceived(r){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,r)}catch{}}onBookmarkReached(r){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,r)}catch{}}};return _m.SpeechSynthesisAdapter=n,_m}var wm={},zk;function RY(){if(zk)return wm;zk=1,Object.defineProperty(wm,"__esModule",{value:!0}),wm.SynthesisRestAdapter=void 0;const t=zi(),e=ye(),n=No(),i=Fi;let r=class{constructor(o,a){let c=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!c){const u=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,"westus"),h=n.ConnectionFactoryBase.getHostSuffix(u);c=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,`https://${u}.tts.speech${h}`)}this.privUri=`${c}/cognitiveservices/voices/list`;const l=t.RestConfigBase.requestOptions;this.privRestAdapter=new t.RestMessageAdapter(l),this.privAuthentication=a}getVoicesList(o){return this.privRestAdapter.setHeaders(i.HeaderNames.ConnectionId,o),this.privAuthentication.fetch(o).then(a=>(this.privRestAdapter.setHeaders(a.headerName,a.token),this.privRestAdapter.request(t.RestRequestType.Get,this.privUri)))}};return wm.SynthesisRestAdapter=r,wm}var W_={},Uk;function bY(){return Uk||(Uk=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SynthesizerConfig=t.SynthesisServiceType=void 0;const e=We();var n;(function(r){r[r.Standard=0]="Standard",r[r.Custom=1]="Custom"})(n=t.SynthesisServiceType||(t.SynthesisServiceType={}));class i{constructor(s,o){this.privSynthesisServiceType=n.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=s||new e.SpeechServiceConfig(new e.Context(null)),this.privParameters=o}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(s){this.privSynthesisServiceType=s}set synthesisVideoSection(s){this.privSpeechServiceConfig.Context.synthesis={video:s}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}}t.SynthesizerConfig=i}(W_)),W_}var Em={},Bk;function TY(){if(Bk)return Em;Bk=1,Object.defineProperty(Em,"__esModule",{value:!0}),Em.SynthesisContext=void 0;const t=ye();let e=class{constructor(){this.privContext={}}setSection(i,r){this.privContext[i]=r}set audioOutputFormat(i){this.privAudioOutputFormat=i}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(i){const r=this.buildSynthesisContext(i);this.setSection("synthesis",r)}buildSynthesisContext(i){return{audio:{metadataOptions:{bookmarkEnabled:!!(i!=null&&i.bookmarkReached),punctuationBoundaryEnabled:i==null?void 0:i.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!(i!=null&&i.wordBoundary)),sentenceBoundaryEnabled:i==null?void 0:i.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!(i!=null&&i.visemeReceived),wordBoundaryEnabled:i==null?void 0:i.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!(i!=null&&i.wordBoundary))},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:i==null?void 0:i.autoDetectSourceLanguage}}}};return Em.SynthesisContext=e,Em}var Rm={},$k;function AY(){if($k)return Rm;$k=1,Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.SpeakerRecognitionConfig=void 0;const t=We();let e=class{constructor(i,r){this.privContext=i||new t.Context(null),this.privParameters=r}get parameters(){return this.privParameters}get Context(){return this.privContext}};return Rm.SpeakerRecognitionConfig=e,Rm}var bm={},Hk;function PY(){if(Hk)return bm;Hk=1,Object.defineProperty(bm,"__esModule",{value:!0}),bm.SpeakerServiceRecognizer=void 0;const t=zi(),e=ht(),n=ye(),i=We(),r=tc;let s=class extends i.ServiceRecognizerBase{constructor(a,c,l,u,h){super(a,c,l,u,h),this.privSpeakerRecognizer=h,this.privSpeakerAudioSource=l,this.recognizeSpeaker=d=>this.recognizeSpeakerOnce(d),this.sendPrePayloadJSONOverride=()=>this.noOp()}processTypeSpecificMessages(a){let c=!1;const l=new n.PropertyCollection;switch(a.messageType===e.MessageType.Text&&l.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,a.textBody),a.path.toLowerCase()){case"speaker.response":const h=JSON.parse(a.textBody);let d;h.status.statusCode.toLowerCase()!=="success"?d=new n.SpeakerRecognitionResult(h,n.ResultReason.Canceled,n.CancellationErrorCode.ServiceError,h.status.reason):d=new n.SpeakerRecognitionResult(h,n.ResultReason.RecognizedSpeaker),this.privResultDeferral&&this.privResultDeferral.resolve(d),c=!0;break}const u=new e.Deferred;return u.resolve(c),u.promise}cancelRecognition(a,c,l,u,h){if(new n.PropertyCollection().setProperty(i.CancellationErrorCodePropertyName,n.CancellationErrorCode[u]),this.privResultDeferral){const p=new n.SpeakerRecognitionResult({scenario:this.privSpeakerModel.scenario,status:{statusCode:h,reason:h}},n.ResultReason.Canceled,u,h);try{this.privResultDeferral.resolve(p)}catch(f){this.privResultDeferral.reject(f)}}}async recognizeSpeakerOnce(a){this.privSpeakerModel=a,this.voiceProfileType=a.scenario,this.privResultDeferral||(this.privResultDeferral=new e.Deferred),this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(n.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const c=this.connectImpl(),l=this.sendPreAudioMessages(this.extractSpeakerContext(a)),u=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),h=await this.privSpeakerAudioSource.format,d=await this.privSpeakerAudioSource.deviceInfo,p=new t.ReplayableAudioNode(u,h.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(p,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:d};try{await c,await l}catch(g){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,g)}const f=new n.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,f),this.receiveMessage(),this.sendAudio(p).then(()=>{},g=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,g)}),this.privResultDeferral.promise}async sendPreAudioMessages(a){const c=await this.fetchConnection();await this.sendSpeakerRecognition(c,a)}async sendSpeakerRecognition(a,c){const l=JSON.stringify(c);return a.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speaker.context",this.privRequestSession.requestId,"application/json; charset=utf-8",l))}extractSpeakerContext(a){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:a.profileIds,scenario:a.scenario}}};return bm.SpeakerServiceRecognizer=s,bm}var Tm={},Vk;function IY(){if(Vk)return Tm;Vk=1,Object.defineProperty(Tm,"__esModule",{value:!0}),Tm.VoiceServiceRecognizer=void 0;const t=zi(),e=ht(),n=ye(),i=We(),r=tc;let s=class extends i.ServiceRecognizerBase{constructor(a,c,l,u,h){super(a,c,l,u,h),this.privDeferralMap=new e.DeferralMap,this.privSpeakerAudioSource=l,this.sendPrePayloadJSONOverride=()=>this.noOp()}set SpeakerAudioSource(a){this.privSpeakerAudioSource=a}processTypeSpecificMessages(a){let c=!1;const l=new n.PropertyCollection;switch(a.messageType===e.MessageType.Text&&l.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,a.textBody),a.path.toLowerCase()){case"speaker.profiles":const h=JSON.parse(a.textBody);switch(h.operation.toLowerCase()){case"create":this.handleCreateResponse(h,a.requestId);break;case"delete":case"reset":this.handleResultResponse(h,a.requestId);break;case"fetch":const v=JSON.parse(a.textBody);this.handleFetchResponse(v,a.requestId);break}c=!0;break;case"speaker.phrases":const d=JSON.parse(a.textBody);this.handlePhrasesResponse(d,a.requestId),c=!0;break;case"speaker.profile.enrollment":const p=JSON.parse(a.textBody),f=new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(p.enrollment?p.enrollment.enrollmentStatus:p.status.statusCode),p.enrollment?JSON.stringify(p.enrollment):void 0,p.status.reason);this.privDeferralMap.getId(a.requestId)&&this.privDeferralMap.complete(a.requestId,f),this.privRequestSession.onSpeechEnded(),c=!0;break}const u=new e.Deferred;return u.resolve(c),u.promise}cancelRecognition(a,c,l,u,h){new n.PropertyCollection().setProperty(i.CancellationErrorCodePropertyName,n.CancellationErrorCode[u]);const p=new n.VoiceProfileEnrollmentResult(n.ResultReason.Canceled,h,h);this.privDeferralMap.getId(c)&&this.privDeferralMap.complete(c,p)}async createProfile(a,c){this.voiceProfileType=a.toString();const l=this.connectImpl();try{const u=new e.Deferred;return await l,await this.sendCreateProfile(u,a,c),this.receiveMessage(),u.promise}catch(u){throw u}}async resetProfile(a){return this.voiceProfileType=a.profileType.toString(),this.sendCommonRequest("reset",a.profileType,a)}async deleteProfile(a){return this.voiceProfileType=a.profileType.toString(),this.sendCommonRequest("delete",a.profileType,a)}async retrieveEnrollmentResult(a){return this.voiceProfileType=a.profileType.toString(),this.privExpectedProfileId=a.profileId,this.sendCommonRequest("fetch",a.profileType,a)}async getAllProfiles(a){return this.voiceProfileType=a.toString(),this.sendCommonRequest("fetch",a)}async getActivationPhrases(a,c){this.voiceProfileType=a.toString();const l=this.connectImpl();try{const u=new e.Deferred;return await l,await this.sendPhrasesRequest(u,a,c),this.receiveMessage(),u.promise}catch(u){throw u}}async enrollProfile(a){this.voiceProfileType=a.profileType.toString();const c=new e.Deferred;this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(n.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const l=this.connectImpl(),u=this.sendPreAudioMessages(a,c),h=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),d=await this.privSpeakerAudioSource.format,p=await this.privSpeakerAudioSource.deviceInfo,f=new t.ReplayableAudioNode(h,d.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(f,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:p};try{await l,await u}catch(m){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,m)}const v=new n.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,v),this.receiveMessage(),this.sendAudio(f).then(()=>{},m=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,m)}),c.promise}async sendPreAudioMessages(a,c){const l=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,c),await this.sendBaseRequest(l,"enroll",this.scenarioFrom(a.profileType),a)}async sendPhrasesRequest(a,c,l){const u=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,a);const h=this.scenarioFrom(c),d={locale:l,scenario:h};return u.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speaker.profile.phrases",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(d)))}async sendCreateProfile(a,c,l){const u=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,a);const h=c===n.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":c===n.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification",d={locale:l,number:"1",scenario:h};return u.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speaker.profile.create",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(d)))}async sendCommonRequest(a,c,l=void 0){const u=this.connectImpl();try{const h=new e.Deferred;this.privRequestSession.onSpeechContext(),await u;const d=await this.fetchConnection();return this.privDeferralMap.add(this.privRequestSession.requestId,h),await this.sendBaseRequest(d,a,this.scenarioFrom(c),l),this.receiveMessage(),h.promise}catch(h){throw h}}async sendBaseRequest(a,c,l,u){const h={scenario:l};return u?h.profileIds=[u.profileId]:h.maxPageSize=-1,a.send(new r.SpeechConnectionMessage(e.MessageType.Text,`speaker.profile.${c}`,this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(h)))}extractSpeakerContext(a){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:a.profileIds,scenario:a.scenario}}handlePhrasesResponse(a,c){if(this.privDeferralMap.getId(c))if(a.status.statusCode.toLowerCase()!=="success"){const l=n.ResultReason.Canceled,u=new n.VoiceProfilePhraseResult(l,a.status.statusCode,a.passPhraseType,[]);this.privDeferralMap.complete(c,u)}else if(a.phrases&&a.phrases.length>0){const l=n.ResultReason.EnrollingVoiceProfile,u=new n.VoiceProfilePhraseResult(l,a.status.statusCode,a.passPhraseType,a.phrases);this.privDeferralMap.complete(c,u)}else throw new Error("Voice Profile get activation phrases failed, no phrases received");else throw new Error(`Voice Profile get activation phrases request for requestID ${c} not found`)}handleCreateResponse(a,c){if(a.profiles&&a.profiles.length>0)if(this.privDeferralMap.getId(c)){const l=a.profiles.map(u=>u.profileId);this.privDeferralMap.complete(c,l)}else throw new Error(`Voice Profile create request for requestID ${c} not found`);else throw new Error("Voice Profile create failed, no profile id received")}handleResultResponse(a,c){if(this.privDeferralMap.getId(c)){const l=a.operation.toLowerCase()==="delete"?n.ResultReason.DeletedVoiceProfile:n.ResultReason.ResetVoiceProfile,u=a.status.statusCode.toLowerCase()==="success"?l:n.ResultReason.Canceled,h=new n.VoiceProfileResult(u,`statusCode: ${a.status.statusCode}, errorDetails: ${a.status.reason}`);this.privDeferralMap.complete(c,h)}else throw new Error(`Voice Profile create request for requestID ${c} not found`)}handleFetchResponse(a,c){if(this.privDeferralMap.getId(c)&&a.profiles[0]){if(this.privExpectedProfileId&&a.profiles.length===1&&a.profiles[0].profileId===this.privExpectedProfileId){this.privExpectedProfileId=void 0;const l=a.profiles[0],u=new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(l.enrollmentStatus),JSON.stringify(l),a.status.reason);this.privDeferralMap.complete(c,u)}else if(a.profiles.length>0){const l=a.profiles,u=[];for(const h of l)u.push(new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(h.enrollmentStatus),JSON.stringify(h),a.status.reason));this.privDeferralMap.complete(c,u)}}else throw new Error(`Voice Profile fetch request for requestID ${c} not found`)}enrollmentReasonFrom(a){switch(a.toLowerCase()){case"enrolled":return n.ResultReason.EnrolledVoiceProfile;case"invalidlocale":case"invalidphrase":case"invalidaudioformat":case"invalidscenario":case"invalidprofilecount":case"invalidoperation":case"audiotooshort":case"audiotoolong":case"toomanyenrollments":case"storageconflict":case"profilenotfound":case"incompatibleprofiles":case"incompleteenrollment":return n.ResultReason.Canceled;default:return n.ResultReason.EnrollingVoiceProfile}}scenarioFrom(a){return a===n.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":a===n.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification"}};return Tm.VoiceServiceRecognizer=s,Tm}var AB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.type=t.connectivity=t.Device=t.OS=t.System=t.Context=t.SpeechServiceConfig=void 0;class e{constructor(a){this.context=a}serialize(){return JSON.stringify(this,(a,c)=>{if(c&&typeof c=="object"&&!Array.isArray(c)){const l={};for(const u in c)Object.hasOwnProperty.call(c,u)&&(l[u&&u.charAt(0).toLowerCase()+u.substring(1)]=c[u]);return l}return c})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(a){this.recognition=a.toLowerCase()}}t.SpeechServiceConfig=e;class n{constructor(a){this.system=new i,this.os=a}}t.Context=n;class i{constructor(){const a="1.40.0";this.name="SpeechSDK",this.version=a,this.build="JavaScript",this.lang="JavaScript"}}t.System=i;class r{constructor(a,c,l){this.platform=a,this.name=c,this.version=l}}t.OS=r;class s{constructor(a,c,l){this.manufacturer=a,this.model=c,this.version=l}}t.Device=s,function(o){o.Bluetooth="Bluetooth",o.Wired="Wired",o.WiFi="WiFi",o.Cellular="Cellular",o.InBuilt="InBuilt",o.Unknown="Unknown"}(t.connectivity||(t.connectivity={})),function(o){o.Phone="Phone",o.Speaker="Speaker",o.Car="Car",o.Headset="Headset",o.Thermostat="Thermostat",o.Microphones="Microphones",o.Deskphone="Deskphone",o.RemoteControl="RemoteControl",o.Unknown="Unknown",o.File="File",o.Stream="Stream"}(t.type||(t.type={}))})(AB);var jk;function We(){return jk||(jk=1,function(t){var e=It&&It.__createBinding||(Object.create?function(s,o,a,c){c===void 0&&(c=a),Object.defineProperty(s,c,{enumerable:!0,get:function(){return o[a]}})}:function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]}),n=It&&It.__exportStar||function(s,o){for(var a in s)a!=="default"&&!o.hasOwnProperty(a)&&e(o,s,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDetectSourceLanguagesOpenRangeOptionName=t.ForceDictationPropertyName=t.ServicePropertiesPropertyName=t.CancellationErrorCodePropertyName=t.OutputFormatPropertyName=void 0,n(DS,t),n(tx,t),n(op,t),n(RU,t),n(bU,t),n(SK(),t),n(xK(),t),n(Px,t),n(CK(),t),n(_K(),t),n(wK(),t),n(SB,t),n(Ix,t),n(RK(),t),n(bK(),t),n(TK(),t),n(AK(),t),n(gB(),t),n(PK(),t),n(xB,t),n(IK(),t),n(Mx,t),n(LK(),t),n(DK(),t),n(kx,t),n(Lx,t),n(Dx,t),n(NK(),t),n(OK(),t),n(FK(),t),n(zK(),t),n(UK(),t),n(Nx,t),n($K(),t),n(Ox,t),n(EB,t),n(Fx,t),n(Ux,t),n(Bx,t),n(RB,t),n(ZK(),t),n(Vx,t),n(vY(),t),n(O2,t),n(CY(),t),n(_Y(),t);var i=wY();Object.defineProperty(t,"AvatarSynthesisAdapter",{enumerable:!0,get:function(){return i.AvatarSynthesisAdapter}});var r=EY();Object.defineProperty(t,"SpeechSynthesisAdapter",{enumerable:!0,get:function(){return r.SpeechSynthesisAdapter}}),n(RY(),t),n(bY(),t),n(TY(),t),n(AY(),t),n(PY(),t),n(IY(),t),n(AB,t),t.OutputFormatPropertyName="OutputFormat",t.CancellationErrorCodePropertyName="CancellationErrorCode",t.ServicePropertiesPropertyName="ServiceProperties",t.ForceDictationPropertyName="ForceDictation",t.AutoDetectSourceLanguagesOpenRangeOptionName="OpenRange"}(R_)),R_}(function(t){var e=It&&It.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o),Object.defineProperty(r,a,{enumerable:!0,get:function(){return s[o]}})}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=It&&It.__exportStar||function(r,s){for(var o in r)o!=="default"&&!s.hasOwnProperty(o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0});const i=We();new i.AgentConfig,n(ye(),t)})(Qm);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const F2="169",cd={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Xh={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},MY=0,Wk=1,kY=2,PB=1,LY=2,Aa=3,Ka=0,br=1,Zo=2,Kc=0,ld=1,Gk=2,qk=3,Xk=4,DY=5,tu=100,NY=101,OY=102,FY=103,zY=104,UY=200,BY=201,$Y=202,HY=203,vR=204,yR=205,VY=206,jY=207,WY=208,GY=209,qY=210,XY=211,KY=212,YY=213,JY=214,SR=0,xR=1,CR=2,kd=3,_R=4,wR=5,ER=6,RR=7,Xx=0,QY=1,ZY=2,Yc=0,eJ=1,tJ=2,nJ=3,IB=4,iJ=5,rJ=6,sJ=7,Kk="attached",oJ="detached",MB=300,Ld=301,Dd=302,E1=303,bR=304,Kx=306,sl=1e3,na=1001,R1=1002,Er=1003,kB=1004,eg=1005,ds=1006,ky=1007,za=1008,Ya=1009,LB=1010,DB=1011,Kg=1012,z2=1013,Iu=1014,Ro=1015,D0=1016,U2=1017,B2=1018,Nd=1020,NB=35902,OB=1021,FB=1022,Bs=1023,zB=1024,UB=1025,ud=1026,Od=1027,$2=1028,H2=1029,BB=1030,V2=1031,j2=1033,Ly=33776,Dy=33777,Ny=33778,Oy=33779,TR=35840,AR=35841,PR=35842,IR=35843,MR=36196,kR=37492,LR=37496,DR=37808,NR=37809,OR=37810,FR=37811,zR=37812,UR=37813,BR=37814,$R=37815,HR=37816,VR=37817,jR=37818,WR=37819,GR=37820,qR=37821,Fy=36492,XR=36494,KR=36495,$B=36283,YR=36284,JR=36285,QR=36286,aJ=2200,HB=2201,cJ=2202,Yg=2300,Jg=2301,G_=2302,Kh=2400,Yh=2401,b1=2402,W2=2500,lJ=2501,uJ=0,VB=1,ZR=2,hJ=3200,dJ=3201,Yx=0,pJ=1,Pc="",on="srgb",qi="srgb-linear",G2="display-p3",Jx="display-p3-linear",T1="linear",Pn="srgb",A1="rec709",P1="p3",hh=7680,Yk=519,fJ=512,mJ=513,gJ=514,jB=515,vJ=516,yJ=517,SJ=518,xJ=519,eb=35044,Jk="300 es",Ua=2e3,I1=2001;class Cl{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const ir=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Qk=1234567;const Sg=Math.PI/180,Fd=180/Math.PI;function Ao(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ir[t&255]+ir[t>>8&255]+ir[t>>16&255]+ir[t>>24&255]+"-"+ir[e&255]+ir[e>>8&255]+"-"+ir[e>>16&15|64]+ir[e>>24&255]+"-"+ir[n&63|128]+ir[n>>8&255]+"-"+ir[n>>16&255]+ir[n>>24&255]+ir[i&255]+ir[i>>8&255]+ir[i>>16&255]+ir[i>>24&255]).toLowerCase()}function yi(t,e,n){return Math.max(e,Math.min(n,t))}function q2(t,e){return(t%e+e)%e}function CJ(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)}function _J(t,e,n){return t!==e?(n-t)/(e-t):0}function xg(t,e,n){return(1-n)*t+n*e}function wJ(t,e,n,i){return xg(t,e,1-Math.exp(-n*i))}function EJ(t,e=1){return e-Math.abs(q2(t,e*2)-e)}function RJ(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function bJ(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function TJ(t,e){return t+Math.floor(Math.random()*(e-t+1))}function AJ(t,e){return t+Math.random()*(e-t)}function PJ(t){return t*(.5-Math.random())}function IJ(t){t!==void 0&&(Qk=t);let e=Qk+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function MJ(t){return t*Sg}function kJ(t){return t*Fd}function LJ(t){return(t&t-1)===0&&t!==0}function DJ(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function NJ(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function OJ(t,e,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),l=s((e+i)/2),u=o((e+i)/2),h=s((e-i)/2),d=o((e-i)/2),p=s((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":t.set(a*u,c*h,c*d,a*l);break;case"YZY":t.set(c*d,a*u,c*h,a*l);break;case"ZXZ":t.set(c*h,c*d,a*u,a*l);break;case"XZX":t.set(a*u,c*f,c*p,a*l);break;case"YXY":t.set(c*p,a*u,c*f,a*l);break;case"ZYZ":t.set(c*f,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function _o(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function sn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const Hi={DEG2RAD:Sg,RAD2DEG:Fd,generateUUID:Ao,clamp:yi,euclideanModulo:q2,mapLinear:CJ,inverseLerp:_J,lerp:xg,damp:wJ,pingpong:EJ,smoothstep:RJ,smootherstep:bJ,randInt:TJ,randFloat:AJ,randFloatSpread:PJ,seededRandom:IJ,degToRad:MJ,radToDeg:kJ,isPowerOfTwo:LJ,ceilPowerOfTwo:DJ,floorPowerOfTwo:NJ,setQuaternionFromProperEuler:OJ,normalize:sn,denormalize:_o};class gt{constructor(e=0,n=0){gt.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,i=this.y,r=e.elements;return this.x=r[0]*n+r[3]*i+r[6],this.y=r[1]*n+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(yi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const i=Math.cos(n),r=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tt{constructor(e,n,i,r,s,o,a,c,l){Tt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,o,a,c,l)}set(e,n,i,r,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=i,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,o=i[0],a=i[3],c=i[6],l=i[1],u=i[4],h=i[7],d=i[2],p=i[5],f=i[8],v=r[0],g=r[3],m=r[6],y=r[1],S=r[4],x=r[7],w=r[2],C=r[5],E=r[8];return s[0]=o*v+a*y+c*w,s[3]=o*g+a*S+c*C,s[6]=o*m+a*x+c*E,s[1]=l*v+u*y+h*w,s[4]=l*g+u*S+h*C,s[7]=l*m+u*x+h*E,s[2]=d*v+p*y+f*w,s[5]=d*g+p*S+f*C,s[8]=d*m+p*x+f*E,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-i*s*u+i*a*c+r*s*l-r*o*c}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,p=l*s-o*c,f=n*h+i*d+r*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/f;return e[0]=h*v,e[1]=(r*l-u*i)*v,e[2]=(a*i-r*o)*v,e[3]=d*v,e[4]=(u*n-r*c)*v,e[5]=(r*s-a*n)*v,e[6]=p*v,e[7]=(i*c-l*n)*v,e[8]=(o*n-i*s)*v,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,r,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(i*c,i*l,-i*(c*o+l*a)+o+e,-r*l,r*c,-r*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(q_.makeScale(e,n)),this}rotate(e){return this.premultiply(q_.makeRotation(-e)),this}translate(e,n){return this.premultiply(q_.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<9;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const q_=new Tt;function WB(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function Qg(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function FJ(){const t=Qg("canvas");return t.style.display="block",t}const Zk={};function zy(t){t in Zk||(Zk[t]=!0,console.warn(t))}function zJ(t,e,n){return new Promise(function(i,r){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}}setTimeout(s,n)})}function UJ(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function BJ(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const eL=new Tt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),tL=new Tt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Am={[qi]:{transfer:T1,primaries:A1,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t,fromReference:t=>t},[on]:{transfer:Pn,primaries:A1,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Jx]:{transfer:T1,primaries:P1,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.applyMatrix3(tL),fromReference:t=>t.applyMatrix3(eL)},[G2]:{transfer:Pn,primaries:P1,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.convertSRGBToLinear().applyMatrix3(tL),fromReference:t=>t.applyMatrix3(eL).convertLinearToSRGB()}},$J=new Set([qi,Jx]),Pt={enabled:!0,_workingColorSpace:qi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!$J.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(this.enabled===!1||e===n||!e||!n)return t;const i=Am[e].toReference,r=Am[n].fromReference;return r(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Am[t].primaries},getTransfer:function(t){return t===Pc?T1:Am[t].transfer},getLuminanceCoefficients:function(t,e=this._workingColorSpace){return t.fromArray(Am[e].luminanceCoefficients)}};function hd(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function X_(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let dh;class HJ{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{dh===void 0&&(dh=Qg("canvas")),dh.width=e.width,dh.height=e.height;const i=dh.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=dh}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=Qg("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=hd(s[o]/255)*255;return i.putImageData(r,0,0),n}else if(e.data){const n=e.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(hd(n[i]/255)*255):n[i]=hd(n[i]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let VJ=0;class GB{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:VJ++}),this.uuid=Ao(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(K_(r[o].image)):s.push(K_(r[o]))}else s=K_(r);i.url=s}return n||(e.images[this.uuid]=i),i}}function K_(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?HJ.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let jJ=0;class wi extends Cl{constructor(e=wi.DEFAULT_IMAGE,n=wi.DEFAULT_MAPPING,i=na,r=na,s=ds,o=za,a=Bs,c=Ya,l=wi.DEFAULT_ANISOTROPY,u=Pc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:jJ++}),this.uuid=Ao(),this.name="",this.source=new GB(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new gt(0,0),this.repeat=new gt(1,1),this.center=new gt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==MB)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case sl:e.x=e.x-Math.floor(e.x);break;case na:e.x=e.x<0?0:1;break;case R1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case sl:e.y=e.y-Math.floor(e.y);break;case na:e.y=e.y<0?0:1;break;case R1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}wi.DEFAULT_IMAGE=null;wi.DEFAULT_MAPPING=MB;wi.DEFAULT_ANISOTROPY=1;class Gt{constructor(e=0,n=0,i=0,r=1){Gt.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,i,r){return this.x=e,this.y=n,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*n+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*n+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*n+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*n+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,i,r,s;const c=e.elements,l=c[0],u=c[4],h=c[8],d=c[1],p=c[5],f=c[9],v=c[2],g=c[6],m=c[10];if(Math.abs(u-d)<.01&&Math.abs(h-v)<.01&&Math.abs(f-g)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+v)<.1&&Math.abs(f+g)<.1&&Math.abs(l+p+m-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const S=(l+1)/2,x=(p+1)/2,w=(m+1)/2,C=(u+d)/4,E=(h+v)/4,b=(f+g)/4;return S>x&&S>w?S<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(S),r=C/i,s=E/i):x>w?x<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),i=C/r,s=b/r):w<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),i=E/s,r=b/s),this.set(i,r,s,n),this}let y=Math.sqrt((g-f)*(g-f)+(h-v)*(h-v)+(d-u)*(d-u));return Math.abs(y)<.001&&(y=1),this.x=(g-f)/y,this.y=(h-v)/y,this.z=(d-u)/y,this.w=Math.acos((l+p+m-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this.w=e.w+(n.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class WJ extends Cl{constructor(e=1,n=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new Gt(0,0,e,n),this.scissorTest=!1,this.viewport=new Gt(0,0,e,n);const r={width:e,height:n,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ds,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new wi(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,n,i=1){if(this.width!==e||this.height!==n||this.depth!==i){this.width=e,this.height=n,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=n,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new GB(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Mu extends WJ{constructor(e=1,n=1,i={}){super(e,n,i),this.isWebGLRenderTarget=!0}}class qB extends wi{constructor(e=null,n=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=Er,this.minFilter=Er,this.wrapR=na,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class GJ extends wi{constructor(e=null,n=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=Er,this.minFilter=Er,this.wrapR=na,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Xt{constructor(e=0,n=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}static slerpFlat(e,n,i,r,s,o,a){let c=i[r+0],l=i[r+1],u=i[r+2],h=i[r+3];const d=s[o+0],p=s[o+1],f=s[o+2],v=s[o+3];if(a===0){e[n+0]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h;return}if(a===1){e[n+0]=d,e[n+1]=p,e[n+2]=f,e[n+3]=v;return}if(h!==v||c!==d||l!==p||u!==f){let g=1-a;const m=c*d+l*p+u*f+h*v,y=m>=0?1:-1,S=1-m*m;if(S>Number.EPSILON){const w=Math.sqrt(S),C=Math.atan2(w,m*y);g=Math.sin(g*C)/w,a=Math.sin(a*C)/w}const x=a*y;if(c=c*g+d*x,l=l*g+p*x,u=u*g+f*x,h=h*g+v*x,g===1-a){const w=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=w,l*=w,u*=w,h*=w}}e[n]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h}static multiplyQuaternionsFlat(e,n,i,r,s,o){const a=i[r],c=i[r+1],l=i[r+2],u=i[r+3],h=s[o],d=s[o+1],p=s[o+2],f=s[o+3];return e[n]=a*f+u*h+c*p-l*d,e[n+1]=c*f+u*d+l*h-a*p,e[n+2]=l*f+u*p+a*d-c*h,e[n+3]=u*f-a*h-c*d-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,r){return this._x=e,this._y=n,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(i/2),u=a(r/2),h=a(s/2),d=c(i/2),p=c(r/2),f=c(s/2);switch(o){case"XYZ":this._x=d*u*h+l*p*f,this._y=l*p*h-d*u*f,this._z=l*u*f+d*p*h,this._w=l*u*h-d*p*f;break;case"YXZ":this._x=d*u*h+l*p*f,this._y=l*p*h-d*u*f,this._z=l*u*f-d*p*h,this._w=l*u*h+d*p*f;break;case"ZXY":this._x=d*u*h-l*p*f,this._y=l*p*h+d*u*f,this._z=l*u*f+d*p*h,this._w=l*u*h-d*p*f;break;case"ZYX":this._x=d*u*h-l*p*f,this._y=l*p*h+d*u*f,this._z=l*u*f-d*p*h,this._w=l*u*h+d*p*f;break;case"YZX":this._x=d*u*h+l*p*f,this._y=l*p*h+d*u*f,this._z=l*u*f-d*p*h,this._w=l*u*h-d*p*f;break;case"XZY":this._x=d*u*h-l*p*f,this._y=l*p*h-d*u*f,this._z=l*u*f+d*p*h,this._w=l*u*h+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const i=n/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,i=n[0],r=n[4],s=n[8],o=n[1],a=n[5],c=n[9],l=n[2],u=n[6],h=n[10],d=i+a+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-c)*p,this._y=(s-l)*p,this._z=(o-r)*p}else if(i>a&&i>h){const p=2*Math.sqrt(1+i-a-h);this._w=(u-c)/p,this._x=.25*p,this._y=(r+o)/p,this._z=(s+l)/p}else if(a>h){const p=2*Math.sqrt(1+a-i-h);this._w=(s-l)/p,this._x=(r+o)/p,this._y=.25*p,this._z=(c+u)/p}else{const p=2*Math.sqrt(1+h-i-a);this._w=(o-r)/p,this._x=(s+l)/p,this._y=(c+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yi(this.dot(e),-1,1)))}rotateTowards(e,n){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,n/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const i=e._x,r=e._y,s=e._z,o=e._w,a=n._x,c=n._y,l=n._z,u=n._w;return this._x=i*u+o*a+r*l-s*c,this._y=r*u+o*c+s*a-i*l,this._z=s*u+o*l+i*c-r*a,this._w=o*u-i*a-r*c-s*l,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const p=1-n;return this._w=p*o+n*this._w,this._x=p*i+n*this._x,this._y=p*r+n*this._y,this._z=p*s+n*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-n)*u)/l,d=Math.sin(n*u)/l;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,n,i){return this.copy(e).slerp(n,i)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,n=0,i=0){N.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(nL.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(nL.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[3]*i+s[6]*r,this.y=s[1]*n+s[4]*i+s[7]*r,this.z=s[2]*n+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*n+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*n+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*n+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*n+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const n=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*r-a*i),u=2*(a*n-s*r),h=2*(s*i-o*n);return this.x=n+c*l+o*h-a*u,this.y=i+c*u+a*l-s*h,this.z=r+c*h+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[4]*i+s[8]*r,this.y=s[1]*n+s[5]*i+s[9]*r,this.z=s[2]*n+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const i=e.x,r=e.y,s=e.z,o=n.x,a=n.y,c=n.z;return this.x=r*c-s*a,this.y=s*o-i*c,this.z=i*a-r*o,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Y_.copy(this).projectOnVector(e),this.sub(Y_)}reflect(e){return this.sub(Y_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(yi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return n*n+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){const r=Math.sin(n)*e;return this.x=r*Math.sin(i),this.y=Math.cos(n)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=r,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,i=Math.sqrt(1-n*n);return this.x=i*Math.cos(e),this.y=n,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Y_=new N,nL=new Xt;class ha{constructor(e=new N(1/0,1/0,1/0),n=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n+=3)this.expandByPoint(co.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,i=e.count;n<i;n++)this.expandByPoint(co.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=co.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,co):co.fromBufferAttribute(s,o),co.applyMatrix4(e.matrixWorld),this.expandByPoint(co);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),wv.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),wv.copy(i.boundingBox)),wv.applyMatrix4(e.matrixWorld),this.union(wv)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,co),co.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,i;return e.normal.x>0?(n=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),n<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Pm),Ev.subVectors(this.max,Pm),ph.subVectors(e.a,Pm),fh.subVectors(e.b,Pm),mh.subVectors(e.c,Pm),cc.subVectors(fh,ph),lc.subVectors(mh,fh),Hl.subVectors(ph,mh);let n=[0,-cc.z,cc.y,0,-lc.z,lc.y,0,-Hl.z,Hl.y,cc.z,0,-cc.x,lc.z,0,-lc.x,Hl.z,0,-Hl.x,-cc.y,cc.x,0,-lc.y,lc.x,0,-Hl.y,Hl.x,0];return!J_(n,ph,fh,mh,Ev)||(n=[1,0,0,0,1,0,0,0,1],!J_(n,ph,fh,mh,Ev))?!1:(Rv.crossVectors(cc,lc),n=[Rv.x,Rv.y,Rv.z],J_(n,ph,fh,mh,Ev))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,co).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(co).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_a),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _a=[new N,new N,new N,new N,new N,new N,new N,new N],co=new N,wv=new ha,ph=new N,fh=new N,mh=new N,cc=new N,lc=new N,Hl=new N,Pm=new N,Ev=new N,Rv=new N,Vl=new N;function J_(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){Vl.fromArray(t,s);const a=r.x*Math.abs(Vl.x)+r.y*Math.abs(Vl.y)+r.z*Math.abs(Vl.z),c=e.dot(Vl),l=n.dot(Vl),u=i.dot(Vl);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const qJ=new ha,Im=new N,Q_=new N;class da{constructor(e=new N,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const i=this.center;n!==void 0?i.copy(n):qJ.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const i=this.center.distanceToSquared(e);return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Im.subVectors(e,this.center);const n=Im.lengthSq();if(n>this.radius*this.radius){const i=Math.sqrt(n),r=(i-this.radius)*.5;this.center.addScaledVector(Im,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Q_.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Im.copy(e.center).add(Q_)),this.expandByPoint(Im.copy(e.center).sub(Q_))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const wa=new N,Z_=new N,bv=new N,uc=new N,ew=new N,Tv=new N,tw=new N;class cp{constructor(e=new N,n=new N(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,wa)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=wa.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(wa.copy(this.origin).addScaledVector(this.direction,n),wa.distanceToSquared(e))}distanceSqToSegment(e,n,i,r){Z_.copy(e).add(n).multiplyScalar(.5),bv.copy(n).sub(e).normalize(),uc.copy(this.origin).sub(Z_);const s=e.distanceTo(n)*.5,o=-this.direction.dot(bv),a=uc.dot(this.direction),c=-uc.dot(bv),l=uc.lengthSq(),u=Math.abs(1-o*o);let h,d,p,f;if(u>0)if(h=o*c-a,d=o*a-c,f=s*u,h>=0)if(d>=-f)if(d<=f){const v=1/u;h*=v,d*=v,p=h*(h+o*d+2*a)+d*(o*h+d+2*c)+l}else d=s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;else d=-s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;else d<=-f?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-c),s),p=-h*h+d*(d+2*c)+l):d<=f?(h=0,d=Math.min(Math.max(-s,-c),s),p=d*(d+2*c)+l):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-c),s),p=-h*h+d*(d+2*c)+l);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(Z_).addScaledVector(bv,d),p}intersectSphere(e,n){wa.subVectors(e.center,this.origin);const i=wa.dot(this.direction),r=wa.dot(wa)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,c=i+o;return c<0?null:a<0?this.at(c,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/n;return i>=0?i:null}intersectPlane(e,n){const i=this.distanceToPlane(e);return i===null?null:this.at(i,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let i,r,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,c=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,c=(e.min.z-d.z)*h),i>c||a>r)||((a>i||i!==i)&&(i=a),(c<r||r!==r)&&(r=c),r<0)?null:this.at(i>=0?i:r,n)}intersectsBox(e){return this.intersectBox(e,wa)!==null}intersectTriangle(e,n,i,r,s){ew.subVectors(n,e),Tv.subVectors(i,e),tw.crossVectors(ew,Tv);let o=this.direction.dot(tw),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;uc.subVectors(this.origin,e);const c=a*this.direction.dot(Tv.crossVectors(uc,Tv));if(c<0)return null;const l=a*this.direction.dot(ew.cross(uc));if(l<0||c+l>o)return null;const u=-a*uc.dot(tw);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ge{constructor(e,n,i,r,s,o,a,c,l,u,h,d,p,f,v,g){Ge.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,o,a,c,l,u,h,d,p,f,v,g)}set(e,n,i,r,s,o,a,c,l,u,h,d,p,f,v,g){const m=this.elements;return m[0]=e,m[4]=n,m[8]=i,m[12]=r,m[1]=s,m[5]=o,m[9]=a,m[13]=c,m[2]=l,m[6]=u,m[10]=h,m[14]=d,m[3]=p,m[7]=f,m[11]=v,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ge().fromArray(this.elements)}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){const n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,i=e.elements,r=1/gh.setFromMatrixColumn(e,0).length(),s=1/gh.setFromMatrixColumn(e,1).length(),o=1/gh.setFromMatrixColumn(e,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=0,n[4]=i[4]*s,n[5]=i[5]*s,n[6]=i[6]*s,n[7]=0,n[8]=i[8]*o,n[9]=i[9]*o,n[10]=i[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),c=Math.cos(r),l=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,p=o*h,f=a*u,v=a*h;n[0]=c*u,n[4]=-c*h,n[8]=l,n[1]=p+f*l,n[5]=d-v*l,n[9]=-a*c,n[2]=v-d*l,n[6]=f+p*l,n[10]=o*c}else if(e.order==="YXZ"){const d=c*u,p=c*h,f=l*u,v=l*h;n[0]=d+v*a,n[4]=f*a-p,n[8]=o*l,n[1]=o*h,n[5]=o*u,n[9]=-a,n[2]=p*a-f,n[6]=v+d*a,n[10]=o*c}else if(e.order==="ZXY"){const d=c*u,p=c*h,f=l*u,v=l*h;n[0]=d-v*a,n[4]=-o*h,n[8]=f+p*a,n[1]=p+f*a,n[5]=o*u,n[9]=v-d*a,n[2]=-o*l,n[6]=a,n[10]=o*c}else if(e.order==="ZYX"){const d=o*u,p=o*h,f=a*u,v=a*h;n[0]=c*u,n[4]=f*l-p,n[8]=d*l+v,n[1]=c*h,n[5]=v*l+d,n[9]=p*l-f,n[2]=-l,n[6]=a*c,n[10]=o*c}else if(e.order==="YZX"){const d=o*c,p=o*l,f=a*c,v=a*l;n[0]=c*u,n[4]=v-d*h,n[8]=f*h+p,n[1]=h,n[5]=o*u,n[9]=-a*u,n[2]=-l*u,n[6]=p*h+f,n[10]=d-v*h}else if(e.order==="XZY"){const d=o*c,p=o*l,f=a*c,v=a*l;n[0]=c*u,n[4]=-h,n[8]=l*u,n[1]=d*h+v,n[5]=o*u,n[9]=p*h-f,n[2]=f*h-p,n[6]=a*u,n[10]=v*h+d}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(XJ,e,KJ)}lookAt(e,n,i){const r=this.elements;return is.subVectors(e,n),is.lengthSq()===0&&(is.z=1),is.normalize(),hc.crossVectors(i,is),hc.lengthSq()===0&&(Math.abs(i.z)===1?is.x+=1e-4:is.z+=1e-4,is.normalize(),hc.crossVectors(i,is)),hc.normalize(),Av.crossVectors(is,hc),r[0]=hc.x,r[4]=Av.x,r[8]=is.x,r[1]=hc.y,r[5]=Av.y,r[9]=is.y,r[2]=hc.z,r[6]=Av.z,r[10]=is.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,o=i[0],a=i[4],c=i[8],l=i[12],u=i[1],h=i[5],d=i[9],p=i[13],f=i[2],v=i[6],g=i[10],m=i[14],y=i[3],S=i[7],x=i[11],w=i[15],C=r[0],E=r[4],b=r[8],M=r[12],_=r[1],R=r[5],L=r[9],O=r[13],V=r[2],X=r[6],G=r[10],J=r[14],D=r[3],ne=r[7],P=r[11],ee=r[15];return s[0]=o*C+a*_+c*V+l*D,s[4]=o*E+a*R+c*X+l*ne,s[8]=o*b+a*L+c*G+l*P,s[12]=o*M+a*O+c*J+l*ee,s[1]=u*C+h*_+d*V+p*D,s[5]=u*E+h*R+d*X+p*ne,s[9]=u*b+h*L+d*G+p*P,s[13]=u*M+h*O+d*J+p*ee,s[2]=f*C+v*_+g*V+m*D,s[6]=f*E+v*R+g*X+m*ne,s[10]=f*b+v*L+g*G+m*P,s[14]=f*M+v*O+g*J+m*ee,s[3]=y*C+S*_+x*V+w*D,s[7]=y*E+S*R+x*X+w*ne,s[11]=y*b+S*L+x*G+w*P,s[15]=y*M+S*O+x*J+w*ee,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],d=e[10],p=e[14],f=e[3],v=e[7],g=e[11],m=e[15];return f*(+s*c*h-r*l*h-s*a*d+i*l*d+r*a*p-i*c*p)+v*(+n*c*p-n*l*d+s*o*d-r*o*p+r*l*u-s*c*u)+g*(+n*l*h-n*a*p-s*o*h+i*o*p+s*a*u-i*l*u)+m*(-r*a*u-n*c*h+n*a*d+r*o*h-i*o*d+i*c*u)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=n,r[14]=i),this}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],v=e[13],g=e[14],m=e[15],y=h*g*l-v*d*l+v*c*p-a*g*p-h*c*m+a*d*m,S=f*d*l-u*g*l-f*c*p+o*g*p+u*c*m-o*d*m,x=u*v*l-f*h*l+f*a*p-o*v*p-u*a*m+o*h*m,w=f*h*c-u*v*c-f*a*d+o*v*d+u*a*g-o*h*g,C=n*y+i*S+r*x+s*w;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/C;return e[0]=y*E,e[1]=(v*d*s-h*g*s-v*r*p+i*g*p+h*r*m-i*d*m)*E,e[2]=(a*g*s-v*c*s+v*r*l-i*g*l-a*r*m+i*c*m)*E,e[3]=(h*c*s-a*d*s-h*r*l+i*d*l+a*r*p-i*c*p)*E,e[4]=S*E,e[5]=(u*g*s-f*d*s+f*r*p-n*g*p-u*r*m+n*d*m)*E,e[6]=(f*c*s-o*g*s-f*r*l+n*g*l+o*r*m-n*c*m)*E,e[7]=(o*d*s-u*c*s+u*r*l-n*d*l-o*r*p+n*c*p)*E,e[8]=x*E,e[9]=(f*h*s-u*v*s-f*i*p+n*v*p+u*i*m-n*h*m)*E,e[10]=(o*v*s-f*a*s+f*i*l-n*v*l-o*i*m+n*a*m)*E,e[11]=(u*a*s-o*h*s-u*i*l+n*h*l+o*i*p-n*a*p)*E,e[12]=w*E,e[13]=(u*v*r-f*h*r+f*i*d-n*v*d-u*i*g+n*h*g)*E,e[14]=(f*a*r-o*v*r-f*i*c+n*v*c+o*i*g-n*a*g)*E,e[15]=(o*h*r-u*a*r+u*i*c-n*h*c-o*i*d+n*a*d)*E,this}scale(e){const n=this.elements,i=e.x,r=e.y,s=e.z;return n[0]*=i,n[4]*=r,n[8]*=s,n[1]*=i,n[5]*=r,n[9]*=s,n[2]*=i,n[6]*=r,n[10]*=s,n[3]*=i,n[7]*=r,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,r))}makeTranslation(e,n,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const i=Math.cos(n),r=Math.sin(n),s=1-i,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+i,l*a-r*c,l*c+r*a,0,l*a+r*c,u*a+i,u*c-r*o,0,l*c-r*a,u*c+r*o,s*c*c+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,n,r,1,0,0,0,0,1),this}compose(e,n,i){const r=this.elements,s=n._x,o=n._y,a=n._z,c=n._w,l=s+s,u=o+o,h=a+a,d=s*l,p=s*u,f=s*h,v=o*u,g=o*h,m=a*h,y=c*l,S=c*u,x=c*h,w=i.x,C=i.y,E=i.z;return r[0]=(1-(v+m))*w,r[1]=(p+x)*w,r[2]=(f-S)*w,r[3]=0,r[4]=(p-x)*C,r[5]=(1-(d+m))*C,r[6]=(g+y)*C,r[7]=0,r[8]=(f+S)*E,r[9]=(g-y)*E,r[10]=(1-(d+v))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,n,i){const r=this.elements;let s=gh.set(r[0],r[1],r[2]).length();const o=gh.set(r[4],r[5],r[6]).length(),a=gh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],lo.copy(this);const l=1/s,u=1/o,h=1/a;return lo.elements[0]*=l,lo.elements[1]*=l,lo.elements[2]*=l,lo.elements[4]*=u,lo.elements[5]*=u,lo.elements[6]*=u,lo.elements[8]*=h,lo.elements[9]*=h,lo.elements[10]*=h,n.setFromRotationMatrix(lo),i.x=s,i.y=o,i.z=a,this}makePerspective(e,n,i,r,s,o,a=Ua){const c=this.elements,l=2*s/(n-e),u=2*s/(i-r),h=(n+e)/(n-e),d=(i+r)/(i-r);let p,f;if(a===Ua)p=-(o+s)/(o-s),f=-2*o*s/(o-s);else if(a===I1)p=-o/(o-s),f=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=f,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,n,i,r,s,o,a=Ua){const c=this.elements,l=1/(n-e),u=1/(i-r),h=1/(o-s),d=(n+e)*l,p=(i+r)*u;let f,v;if(a===Ua)f=(o+s)*h,v=-2*h;else if(a===I1)f=s*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=v,c[14]=-f,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<16;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}const gh=new N,lo=new Ge,XJ=new N(0,0,0),KJ=new N(1,1,1),hc=new N,Av=new N,is=new N,iL=new Ge,rL=new Xt;class fn{constructor(e=0,n=0,i=0,r=fn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,r=this._order){return this._x=e,this._y=n,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],c=r[1],l=r[5],u=r[9],h=r[2],d=r[6],p=r[10];switch(n){case"XYZ":this._y=Math.asin(yi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-yi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(yi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-yi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(yi(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-yi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return iL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(iL,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return rL.setFromEuler(this),this.setFromQuaternion(rL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}fn.DEFAULT_ORDER="XYZ";class X2{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let YJ=0;const sL=new N,vh=new Xt,Ea=new Ge,Pv=new N,Mm=new N,JJ=new N,QJ=new Xt,oL=new N(1,0,0),aL=new N(0,1,0),cL=new N(0,0,1),lL={type:"added"},ZJ={type:"removed"},yh={type:"childadded",child:null},nw={type:"childremoved",child:null};class Sn extends Cl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:YJ++}),this.uuid=Ao(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sn.DEFAULT_UP.clone();const e=new N,n=new fn,i=new Xt,r=new N(1,1,1);function s(){i.setFromEuler(n,!1)}function o(){n.setFromQuaternion(i,void 0,!1)}n._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ge},normalMatrix:{value:new Tt}}),this.matrix=new Ge,this.matrixWorld=new Ge,this.matrixAutoUpdate=Sn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Sn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new X2,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return vh.setFromAxisAngle(e,n),this.quaternion.multiply(vh),this}rotateOnWorldAxis(e,n){return vh.setFromAxisAngle(e,n),this.quaternion.premultiply(vh),this}rotateX(e){return this.rotateOnAxis(oL,e)}rotateY(e){return this.rotateOnAxis(aL,e)}rotateZ(e){return this.rotateOnAxis(cL,e)}translateOnAxis(e,n){return sL.copy(e).applyQuaternion(this.quaternion),this.position.add(sL.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(oL,e)}translateY(e){return this.translateOnAxis(aL,e)}translateZ(e){return this.translateOnAxis(cL,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ea.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?Pv.copy(e):Pv.set(e,n,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Mm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ea.lookAt(Mm,Pv,this.up):Ea.lookAt(Pv,Mm,this.up),this.quaternion.setFromRotationMatrix(Ea),r&&(Ea.extractRotation(r.matrixWorld),vh.setFromRotationMatrix(Ea),this.quaternion.premultiply(vh.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(lL),yh.child=e,this.dispatchEvent(yh),yh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(ZJ),nw.child=e,this.dispatchEvent(nw),nw.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ea.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ea.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ea),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(lL),yh.child=e,this.dispatchEvent(yh),yh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,n);if(o!==void 0)return o}}getObjectsByProperty(e,n,i=[]){this[e]===n&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,n,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Mm,e,JJ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Mm,QJ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].updateMatrixWorld(e)}updateWorldMatrix(e,n){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const h=c[l];s(e.shapes,h)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];r.animations.push(s(e.animations,c))}}if(n){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),p=o(e.animations),f=o(e.nodes);a.length>0&&(i.geometries=a),c.length>0&&(i.materials=c),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),h.length>0&&(i.shapes=h),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),f.length>0&&(i.nodes=f)}return i.object=r,i;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Sn.DEFAULT_UP=new N(0,1,0);Sn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Sn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const uo=new N,Ra=new N,iw=new N,ba=new N,Sh=new N,xh=new N,uL=new N,rw=new N,sw=new N,ow=new N,aw=new Gt,cw=new Gt,lw=new Gt;class wo{constructor(e=new N,n=new N,i=new N){this.a=e,this.b=n,this.c=i}static getNormal(e,n,i,r){r.subVectors(i,n),uo.subVectors(e,n),r.cross(uo);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,n,i,r,s){uo.subVectors(r,n),Ra.subVectors(i,n),iw.subVectors(e,n);const o=uo.dot(uo),a=uo.dot(Ra),c=uo.dot(iw),l=Ra.dot(Ra),u=Ra.dot(iw),h=o*l-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(l*c-a*u)*d,f=(o*u-a*c)*d;return s.set(1-p-f,f,p)}static containsPoint(e,n,i,r){return this.getBarycoord(e,n,i,r,ba)===null?!1:ba.x>=0&&ba.y>=0&&ba.x+ba.y<=1}static getInterpolation(e,n,i,r,s,o,a,c){return this.getBarycoord(e,n,i,r,ba)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,ba.x),c.addScaledVector(o,ba.y),c.addScaledVector(a,ba.z),c)}static getInterpolatedAttribute(e,n,i,r,s,o){return aw.setScalar(0),cw.setScalar(0),lw.setScalar(0),aw.fromBufferAttribute(e,n),cw.fromBufferAttribute(e,i),lw.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(aw,s.x),o.addScaledVector(cw,s.y),o.addScaledVector(lw,s.z),o}static isFrontFacing(e,n,i,r){return uo.subVectors(i,n),Ra.subVectors(e,n),uo.cross(Ra).dot(r)<0}set(e,n,i){return this.a.copy(e),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(e,n,i,r){return this.a.copy(e[n]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,n,i,r){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return uo.subVectors(this.c,this.b),Ra.subVectors(this.a,this.b),uo.cross(Ra).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return wo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return wo.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,i,r,s){return wo.getInterpolation(e,this.a,this.b,this.c,n,i,r,s)}containsPoint(e){return wo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return wo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const i=this.a,r=this.b,s=this.c;let o,a;Sh.subVectors(r,i),xh.subVectors(s,i),rw.subVectors(e,i);const c=Sh.dot(rw),l=xh.dot(rw);if(c<=0&&l<=0)return n.copy(i);sw.subVectors(e,r);const u=Sh.dot(sw),h=xh.dot(sw);if(u>=0&&h<=u)return n.copy(r);const d=c*h-u*l;if(d<=0&&c>=0&&u<=0)return o=c/(c-u),n.copy(i).addScaledVector(Sh,o);ow.subVectors(e,s);const p=Sh.dot(ow),f=xh.dot(ow);if(f>=0&&p<=f)return n.copy(s);const v=p*l-c*f;if(v<=0&&l>=0&&f<=0)return a=l/(l-f),n.copy(i).addScaledVector(xh,a);const g=u*f-p*h;if(g<=0&&h-u>=0&&p-f>=0)return uL.subVectors(s,r),a=(h-u)/(h-u+(p-f)),n.copy(r).addScaledVector(uL,a);const m=1/(g+v+d);return o=v*m,a=d*m,n.copy(i).addScaledVector(Sh,o).addScaledVector(xh,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const XB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},dc={h:0,s:0,l:0},Iv={h:0,s:0,l:0};function uw(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class Xe{constructor(e,n,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,i)}set(e,n,i){if(n===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,n,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=on){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Pt.toWorkingColorSpace(this,n),this}setRGB(e,n,i,r=Pt.workingColorSpace){return this.r=e,this.g=n,this.b=i,Pt.toWorkingColorSpace(this,r),this}setHSL(e,n,i,r=Pt.workingColorSpace){if(e=q2(e,1),n=yi(n,0,1),i=yi(i,0,1),n===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+n):i+n-i*n,o=2*i-s;this.r=uw(o,s,e+1/3),this.g=uw(o,s,e),this.b=uw(o,s,e-1/3)}return Pt.toWorkingColorSpace(this,r),this}setStyle(e,n=on){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=on){const i=XB[e.toLowerCase()];return i!==void 0?this.setHex(i,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=hd(e.r),this.g=hd(e.g),this.b=hd(e.b),this}copyLinearToSRGB(e){return this.r=X_(e.r),this.g=X_(e.g),this.b=X_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=on){return Pt.fromWorkingColorSpace(rr.copy(this),e),Math.round(yi(rr.r*255,0,255))*65536+Math.round(yi(rr.g*255,0,255))*256+Math.round(yi(rr.b*255,0,255))}getHexString(e=on){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Pt.workingColorSpace){Pt.fromWorkingColorSpace(rr.copy(this),n);const i=rr.r,r=rr.g,s=rr.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case i:c=(r-s)/h+(r<s?6:0);break;case r:c=(s-i)/h+2;break;case s:c=(i-r)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Pt.workingColorSpace){return Pt.fromWorkingColorSpace(rr.copy(this),n),e.r=rr.r,e.g=rr.g,e.b=rr.b,e}getStyle(e=on){Pt.fromWorkingColorSpace(rr.copy(this),e);const n=rr.r,i=rr.g,r=rr.b;return e!==on?`color(${e} ${n.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,n,i){return this.getHSL(dc),this.setHSL(dc.h+e,dc.s+n,dc.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,i){return this.r=e.r+(n.r-e.r)*i,this.g=e.g+(n.g-e.g)*i,this.b=e.b+(n.b-e.b)*i,this}lerpHSL(e,n){this.getHSL(dc),e.getHSL(Iv);const i=xg(dc.h,Iv.h,n),r=xg(dc.s,Iv.s,n),s=xg(dc.l,Iv.l,n);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*n+s[3]*i+s[6]*r,this.g=s[1]*n+s[4]*i+s[7]*r,this.b=s[2]*n+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const rr=new Xe;Xe.NAMES=XB;let eQ=0;class qs extends Cl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:eQ++}),this.uuid=Ao(),this.name="",this.type="Material",this.blending=ld,this.side=Ka,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=vR,this.blendDst=yR,this.blendEquation=tu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Xe(0,0,0),this.blendAlpha=0,this.depthFunc=kd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Yk,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hh,this.stencilZFail=hh,this.stencilZPass=hh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const i=e[n];if(i===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const r=this[n];if(r===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ld&&(i.blending=this.blending),this.side!==Ka&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==vR&&(i.blendSrc=this.blendSrc),this.blendDst!==yR&&(i.blendDst=this.blendDst),this.blendEquation!==tu&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==kd&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Yk&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hh&&(i.stencilFail=this.stencilFail),this.stencilZFail!==hh&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==hh&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(n){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let i=null;if(n!==null){const r=n.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=n[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Nc extends qs{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Xe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.combine=Xx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const oi=new N,Mv=new gt;class Tr{constructor(e,n,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=i,this.usage=eb,this.updateRanges=[],this.gpuType=Ro,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,i){e*=this.itemSize,i*=n.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=n.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)Mv.fromBufferAttribute(this,n),Mv.applyMatrix3(e),this.setXY(n,Mv.x,Mv.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.applyMatrix3(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}applyMatrix4(e){for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.applyMatrix4(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.applyNormalMatrix(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.transformDirection(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let i=this.array[e*this.itemSize+n];return this.normalized&&(i=_o(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=sn(i,this.array)),this.array[e*this.itemSize+n]=i,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=_o(n,this.array)),n}setX(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=_o(n,this.array)),n}setY(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=_o(n,this.array)),n}setZ(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=_o(n,this.array)),n}setW(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array)),this.array[e+0]=n,this.array[e+1]=i,this}setXYZ(e,n,i,r){return e*=this.itemSize,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,n,i,r,s){return e*=this.itemSize,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array),s=sn(s,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==eb&&(e.usage=this.usage),e}}class K2 extends Tr{constructor(e,n,i){super(new Uint16Array(e),n,i)}}class KB extends Tr{constructor(e,n,i){super(new Uint32Array(e),n,i)}}class wr extends Tr{constructor(e,n,i){super(new Float32Array(e),n,i)}}let tQ=0;const Ps=new Ge,hw=new Sn,Ch=new N,rs=new ha,km=new ha,Ti=new N;class ys extends Cl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:tQ++}),this.uuid=Ao(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(WB(e)?KB:K2)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,i=0){this.groups.push({start:e,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Tt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ps.makeRotationFromQuaternion(e),this.applyMatrix4(Ps),this}rotateX(e){return Ps.makeRotationX(e),this.applyMatrix4(Ps),this}rotateY(e){return Ps.makeRotationY(e),this.applyMatrix4(Ps),this}rotateZ(e){return Ps.makeRotationZ(e),this.applyMatrix4(Ps),this}translate(e,n,i){return Ps.makeTranslation(e,n,i),this.applyMatrix4(Ps),this}scale(e,n,i){return Ps.makeScale(e,n,i),this.applyMatrix4(Ps),this}lookAt(e){return hw.lookAt(e),hw.updateMatrix(),this.applyMatrix4(hw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ch).negate(),this.translate(Ch.x,Ch.y,Ch.z),this}setFromPoints(e){const n=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];n.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new wr(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ha);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let i=0,r=n.length;i<r;i++){const s=n[i];rs.setFromBufferAttribute(s),this.morphTargetsRelative?(Ti.addVectors(this.boundingBox.min,rs.min),this.boundingBox.expandByPoint(Ti),Ti.addVectors(this.boundingBox.max,rs.max),this.boundingBox.expandByPoint(Ti)):(this.boundingBox.expandByPoint(rs.min),this.boundingBox.expandByPoint(rs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new da);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new N,1/0);return}if(e){const i=this.boundingSphere.center;if(rs.setFromBufferAttribute(e),n)for(let s=0,o=n.length;s<o;s++){const a=n[s];km.setFromBufferAttribute(a),this.morphTargetsRelative?(Ti.addVectors(rs.min,km.min),rs.expandByPoint(Ti),Ti.addVectors(rs.max,km.max),rs.expandByPoint(Ti)):(rs.expandByPoint(km.min),rs.expandByPoint(km.max))}rs.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Ti.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Ti));if(n)for(let s=0,o=n.length;s<o;s++){const a=n[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ti.fromBufferAttribute(a,l),c&&(Ch.fromBufferAttribute(e,l),Ti.add(Ch)),r=Math.max(r,i.distanceToSquared(Ti))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=n.position,r=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Tr(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let b=0;b<i.count;b++)a[b]=new N,c[b]=new N;const l=new N,u=new N,h=new N,d=new gt,p=new gt,f=new gt,v=new N,g=new N;function m(b,M,_){l.fromBufferAttribute(i,b),u.fromBufferAttribute(i,M),h.fromBufferAttribute(i,_),d.fromBufferAttribute(s,b),p.fromBufferAttribute(s,M),f.fromBufferAttribute(s,_),u.sub(l),h.sub(l),p.sub(d),f.sub(d);const R=1/(p.x*f.y-f.x*p.y);isFinite(R)&&(v.copy(u).multiplyScalar(f.y).addScaledVector(h,-p.y).multiplyScalar(R),g.copy(h).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(R),a[b].add(v),a[M].add(v),a[_].add(v),c[b].add(g),c[M].add(g),c[_].add(g))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let b=0,M=y.length;b<M;++b){const _=y[b],R=_.start,L=_.count;for(let O=R,V=R+L;O<V;O+=3)m(e.getX(O+0),e.getX(O+1),e.getX(O+2))}const S=new N,x=new N,w=new N,C=new N;function E(b){w.fromBufferAttribute(r,b),C.copy(w);const M=a[b];S.copy(M),S.sub(w.multiplyScalar(w.dot(M))).normalize(),x.crossVectors(C,M);const R=x.dot(c[b])<0?-1:1;o.setXYZW(b,S.x,S.y,S.z,R)}for(let b=0,M=y.length;b<M;++b){const _=y[b],R=_.start,L=_.count;for(let O=R,V=R+L;O<V;O+=3)E(e.getX(O+0)),E(e.getX(O+1)),E(e.getX(O+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Tr(new Float32Array(n.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const r=new N,s=new N,o=new N,a=new N,c=new N,l=new N,u=new N,h=new N;if(e)for(let d=0,p=e.count;d<p;d+=3){const f=e.getX(d+0),v=e.getX(d+1),g=e.getX(d+2);r.fromBufferAttribute(n,f),s.fromBufferAttribute(n,v),o.fromBufferAttribute(n,g),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(i,f),c.fromBufferAttribute(i,v),l.fromBufferAttribute(i,g),a.add(u),c.add(u),l.add(u),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(v,c.x,c.y,c.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let d=0,p=n.count;d<p;d+=3)r.fromBufferAttribute(n,d+0),s.fromBufferAttribute(n,d+1),o.fromBufferAttribute(n,d+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),i.setXYZ(d+0,u.x,u.y,u.z),i.setXYZ(d+1,u.x,u.y,u.z),i.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,i=e.count;n<i;n++)Ti.fromBufferAttribute(e,n),Ti.normalize(),e.setXYZ(n,Ti.x,Ti.y,Ti.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,h=a.normalized,d=new l.constructor(c.length*u);let p=0,f=0;for(let v=0,g=c.length;v<g;v++){a.isInterleavedBufferAttribute?p=c[v]*a.data.stride+a.offset:p=c[v]*u;for(let m=0;m<u;m++)d[f++]=l[p++]}return new Tr(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new ys,i=this.index.array,r=this.attributes;for(const a in r){const c=r[a],l=e(c,i);n.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,h=l.length;u<h;u++){const d=l[u],p=e(d,i);c.push(p)}n.morphAttributes[a]=c}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];n.addGroup(l.start,l.count,l.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const c in i){const l=i[c];e.data.attributes[c]=l.toJSON(e.data)}const r={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,d=l.length;h<d;h++){const p=l[h];u.push(p.toJSON(e.data))}u.length>0&&(r[c]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(n));const r=e.attributes;for(const l in r){const u=r[l];this.setAttribute(l,u.clone(n))}const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(n));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const hL=new Ge,jl=new cp,kv=new da,dL=new N,Lv=new N,Dv=new N,Nv=new N,dw=new N,Ov=new N,pL=new N,Fv=new N;class gn extends Sn{constructor(e=new ys,n=new Nc){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,n){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;n.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){Ov.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],h=s[c];u!==0&&(dw.fromBufferAttribute(h,e),o?Ov.addScaledVector(dw,u):Ov.addScaledVector(dw.sub(n),u))}n.add(Ov)}return n}raycast(e,n){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),kv.copy(i.boundingSphere),kv.applyMatrix4(s),jl.copy(e.ray).recast(e.near),!(kv.containsPoint(jl.origin)===!1&&(jl.intersectSphere(kv,dL)===null||jl.origin.distanceToSquared(dL)>(e.far-e.near)**2))&&(hL.copy(s).invert(),jl.copy(e.ray).applyMatrix4(hL),!(i.boundingBox!==null&&jl.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,n,jl)))}_computeIntersections(e,n,i){let r;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(a!==null)if(Array.isArray(o))for(let f=0,v=d.length;f<v;f++){const g=d[f],m=o[g.materialIndex],y=Math.max(g.start,p.start),S=Math.min(a.count,Math.min(g.start+g.count,p.start+p.count));for(let x=y,w=S;x<w;x+=3){const C=a.getX(x),E=a.getX(x+1),b=a.getX(x+2);r=zv(this,m,e,i,l,u,h,C,E,b),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,n.push(r))}}else{const f=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let g=f,m=v;g<m;g+=3){const y=a.getX(g),S=a.getX(g+1),x=a.getX(g+2);r=zv(this,o,e,i,l,u,h,y,S,x),r&&(r.faceIndex=Math.floor(g/3),n.push(r))}}else if(c!==void 0)if(Array.isArray(o))for(let f=0,v=d.length;f<v;f++){const g=d[f],m=o[g.materialIndex],y=Math.max(g.start,p.start),S=Math.min(c.count,Math.min(g.start+g.count,p.start+p.count));for(let x=y,w=S;x<w;x+=3){const C=x,E=x+1,b=x+2;r=zv(this,m,e,i,l,u,h,C,E,b),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,n.push(r))}}else{const f=Math.max(0,p.start),v=Math.min(c.count,p.start+p.count);for(let g=f,m=v;g<m;g+=3){const y=g,S=g+1,x=g+2;r=zv(this,o,e,i,l,u,h,y,S,x),r&&(r.faceIndex=Math.floor(g/3),n.push(r))}}}}function nQ(t,e,n,i,r,s,o,a){let c;if(e.side===br?c=i.intersectTriangle(o,s,r,!0,a):c=i.intersectTriangle(r,s,o,e.side===Ka,a),c===null)return null;Fv.copy(a),Fv.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(Fv);return l<n.near||l>n.far?null:{distance:l,point:Fv.clone(),object:t}}function zv(t,e,n,i,r,s,o,a,c,l){t.getVertexPosition(a,Lv),t.getVertexPosition(c,Dv),t.getVertexPosition(l,Nv);const u=nQ(t,e,n,i,Lv,Dv,Nv,pL);if(u){const h=new N;wo.getBarycoord(pL,Lv,Dv,Nv,h),r&&(u.uv=wo.getInterpolatedAttribute(r,a,c,l,h,new gt)),s&&(u.uv1=wo.getInterpolatedAttribute(s,a,c,l,h,new gt)),o&&(u.normal=wo.getInterpolatedAttribute(o,a,c,l,h,new N),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:c,c:l,normal:new N,materialIndex:0};wo.getNormal(Lv,Dv,Nv,d.normal),u.face=d,u.barycoord=h}return u}class lp extends ys{constructor(e=1,n=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],h=[];let d=0,p=0;f("z","y","x",-1,-1,i,n,e,o,s,0),f("z","y","x",1,-1,i,n,-e,o,s,1),f("x","z","y",1,1,e,i,n,r,o,2),f("x","z","y",1,-1,e,i,-n,r,o,3),f("x","y","z",1,-1,e,n,i,r,s,4),f("x","y","z",-1,-1,e,n,-i,r,s,5),this.setIndex(c),this.setAttribute("position",new wr(l,3)),this.setAttribute("normal",new wr(u,3)),this.setAttribute("uv",new wr(h,2));function f(v,g,m,y,S,x,w,C,E,b,M){const _=x/E,R=w/b,L=x/2,O=w/2,V=C/2,X=E+1,G=b+1;let J=0,D=0;const ne=new N;for(let P=0;P<G;P++){const ee=P*R-O;for(let ge=0;ge<X;ge++){const I=ge*_-L;ne[v]=I*y,ne[g]=ee*S,ne[m]=V,l.push(ne.x,ne.y,ne.z),ne[v]=0,ne[g]=0,ne[m]=C>0?1:-1,u.push(ne.x,ne.y,ne.z),h.push(ge/E),h.push(1-P/b),J+=1}}for(let P=0;P<b;P++)for(let ee=0;ee<E;ee++){const ge=d+ee+X*P,I=d+ee+X*(P+1),$=d+(ee+1)+X*(P+1),K=d+(ee+1)+X*P;c.push(ge,I,K),c.push(I,$,K),D+=6}a.addGroup(p,D,M),p+=D,d+=J}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function zd(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function xr(t){const e={};for(let n=0;n<t.length;n++){const i=zd(t[n]);for(const r in i)e[r]=i[r]}return e}function iQ(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function YB(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Pt.workingColorSpace}const rQ={clone:zd,merge:xr};var sQ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,oQ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ol extends qs{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=sQ,this.fragmentShader=oQ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zd(e.uniforms),this.uniformsGroups=iQ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?n.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?n.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[r]={type:"m4",value:o.toArray()}:n.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}class JB extends Sn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ge,this.projectionMatrix=new Ge,this.projectionMatrixInverse=new Ge,this.coordinateSystem=Ua}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const pc=new N,fL=new gt,mL=new gt;class lr extends JB{constructor(e=50,n=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=Fd*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Sg*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Fd*2*Math.atan(Math.tan(Sg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,i){pc.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(pc.x,pc.y).multiplyScalar(-e/pc.z),pc.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(pc.x,pc.y).multiplyScalar(-e/pc.z)}getViewSize(e,n){return this.getViewBounds(e,fL,mL),n.subVectors(mL,fL)}setViewOffset(e,n,i,r,s,o){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(Sg*.5*this.fov)/this.zoom,i=2*n,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*r/c,n-=o.offsetY*i/l,r*=o.width/c,i*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,n,n-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const _h=-90,wh=1;class aQ extends Sn{constructor(e,n,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new lr(_h,wh,e,n);r.layers=this.layers,this.add(r);const s=new lr(_h,wh,e,n);s.layers=this.layers,this.add(s);const o=new lr(_h,wh,e,n);o.layers=this.layers,this.add(o);const a=new lr(_h,wh,e,n);a.layers=this.layers,this.add(a);const c=new lr(_h,wh,e,n);c.layers=this.layers,this.add(c);const l=new lr(_h,wh,e,n);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[i,r,s,o,a,c]=n;for(const l of n)this.remove(l);if(e===Ua)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===I1)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of n)this.add(l),l.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(n,s),e.setRenderTarget(i,1,r),e.render(n,o),e.setRenderTarget(i,2,r),e.render(n,a),e.setRenderTarget(i,3,r),e.render(n,c),e.setRenderTarget(i,4,r),e.render(n,l),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,r),e.render(n,u),e.setRenderTarget(h,d,p),e.xr.enabled=f,i.texture.needsPMREMUpdate=!0}}class QB extends wi{constructor(e,n,i,r,s,o,a,c,l,u){e=e!==void 0?e:[],n=n!==void 0?n:Ld,super(e,n,i,r,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class cQ extends Mu{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new QB(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:ds}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new lp(5,5,5),s=new ol({name:"CubemapFromEquirect",uniforms:zd(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:br,blending:Kc});s.uniforms.tEquirect.value=n;const o=new gn(r,s),a=n.minFilter;return n.minFilter===za&&(n.minFilter=ds),new aQ(1,10,this).update(e,o),n.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,n,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(n,i,r);e.setRenderTarget(s)}}const pw=new N,lQ=new N,uQ=new Tt;class Ec{constructor(e=new N(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,i,r){return this.normal.set(e,n,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,i){const r=pw.subVectors(i,n).cross(lQ.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const i=e.delta(pw),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:n.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return n<0&&i>0||i<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const i=n||uQ.getNormalMatrix(e),r=this.coplanarPoint(pw).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Wl=new da,Uv=new N;class Y2{constructor(e=new Ec,n=new Ec,i=new Ec,r=new Ec,s=new Ec,o=new Ec){this.planes=[e,n,i,r,s,o]}set(e,n,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,n=Ua){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],c=r[3],l=r[4],u=r[5],h=r[6],d=r[7],p=r[8],f=r[9],v=r[10],g=r[11],m=r[12],y=r[13],S=r[14],x=r[15];if(i[0].setComponents(c-s,d-l,g-p,x-m).normalize(),i[1].setComponents(c+s,d+l,g+p,x+m).normalize(),i[2].setComponents(c+o,d+u,g+f,x+y).normalize(),i[3].setComponents(c-o,d-u,g-f,x-y).normalize(),i[4].setComponents(c-a,d-h,g-v,x-S).normalize(),n===Ua)i[5].setComponents(c+a,d+h,g+v,x+S).normalize();else if(n===I1)i[5].setComponents(a,h,v,S).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Wl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Wl.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Wl)}intersectsSprite(e){return Wl.center.set(0,0,0),Wl.radius=.7071067811865476,Wl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Wl)}intersectsSphere(e){const n=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const n=this.planes;for(let i=0;i<6;i++){const r=n[i];if(Uv.x=r.normal.x>0?e.max.x:e.min.x,Uv.y=r.normal.y>0?e.max.y:e.min.y,Uv.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Uv)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ZB(){let t=null,e=!1,n=null,i=null;function r(s,o){n(s,o),i=t.requestAnimationFrame(r)}return{start:function(){e!==!0&&n!==null&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function hQ(t){const e=new WeakMap;function n(a,c){const l=a.array,u=a.usage,h=l.byteLength,d=t.createBuffer();t.bindBuffer(c,d),t.bufferData(c,l,u),a.onUploadCallback();let p;if(l instanceof Float32Array)p=t.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?p=t.HALF_FLOAT:p=t.UNSIGNED_SHORT;else if(l instanceof Int16Array)p=t.SHORT;else if(l instanceof Uint32Array)p=t.UNSIGNED_INT;else if(l instanceof Int32Array)p=t.INT;else if(l instanceof Int8Array)p=t.BYTE;else if(l instanceof Uint8Array)p=t.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)p=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:d,type:p,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:h}}function i(a,c,l){const u=c.array,h=c.updateRanges;if(t.bindBuffer(l,a),h.length===0)t.bufferSubData(l,0,u);else{h.sort((p,f)=>p.start-f.start);let d=0;for(let p=1;p<h.length;p++){const f=h[d],v=h[p];v.start<=f.start+f.count+1?f.count=Math.max(f.count,v.start+v.count-f.start):(++d,h[d]=v)}h.length=d+1;for(let p=0,f=h.length;p<f;p++){const v=h[p];t.bufferSubData(l,v.start*u.BYTES_PER_ELEMENT,u,v.start,v.count)}c.clearUpdateRanges()}c.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(t.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,n(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(l.buffer,a,c),l.version=a.version}}return{get:r,remove:s,update:o}}class Qx extends ys{constructor(e=1,n=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:i,heightSegments:r};const s=e/2,o=n/2,a=Math.floor(i),c=Math.floor(r),l=a+1,u=c+1,h=e/a,d=n/c,p=[],f=[],v=[],g=[];for(let m=0;m<u;m++){const y=m*d-o;for(let S=0;S<l;S++){const x=S*h-s;f.push(x,-y,0),v.push(0,0,1),g.push(S/a),g.push(1-m/c)}}for(let m=0;m<c;m++)for(let y=0;y<a;y++){const S=y+l*m,x=y+l*(m+1),w=y+1+l*(m+1),C=y+1+l*m;p.push(S,x,C),p.push(x,w,C)}this.setIndex(p),this.setAttribute("position",new wr(f,3)),this.setAttribute("normal",new wr(v,3)),this.setAttribute("uv",new wr(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qx(e.width,e.height,e.widthSegments,e.heightSegments)}}var dQ=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,pQ=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,fQ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,mQ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gQ=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,vQ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,yQ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,SQ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,xQ=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,CQ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,_Q=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,wQ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,EQ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,RQ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bQ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,TQ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,AQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,PQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,IQ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,MQ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,kQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,LQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,DQ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,NQ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,OQ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,FQ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,zQ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,UQ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,BQ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$Q=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,HQ="gl_FragColor = linearToOutputTexel( gl_FragColor );",VQ=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,jQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,WQ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,GQ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,qQ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,XQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,KQ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,YQ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,JQ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,QQ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ZQ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,eZ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,tZ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,nZ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,iZ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,rZ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,sZ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,oZ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,aZ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,cZ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lZ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,uZ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,hZ=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,dZ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,pZ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,fZ=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,mZ=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,gZ=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,vZ=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,yZ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,SZ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,xZ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,CZ=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_Z=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,wZ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,EZ=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,RZ=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,bZ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,TZ=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,AZ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,PZ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,IZ=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,MZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,LZ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,DZ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,NZ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,OZ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,FZ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,zZ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,UZ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,BZ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,$Z=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,HZ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,VZ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,jZ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,WZ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,GZ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,qZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,XZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,KZ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,YZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,JZ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,QZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,ZZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,eee=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,tee=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,nee=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,iee=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,ree=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,see=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,oee=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,aee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,cee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,lee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,uee=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const hee=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,dee=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pee=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fee=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mee=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,gee=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vee=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,yee=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,See=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,xee=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Cee=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,_ee=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,wee=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Eee=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ree=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,bee=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Tee=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Aee=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Pee=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Iee=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mee=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,kee=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Lee=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Dee=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Nee=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Oee=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Fee=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zee=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uee=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Bee=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$ee=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Hee=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Vee=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,jee=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,At={alphahash_fragment:dQ,alphahash_pars_fragment:pQ,alphamap_fragment:fQ,alphamap_pars_fragment:mQ,alphatest_fragment:gQ,alphatest_pars_fragment:vQ,aomap_fragment:yQ,aomap_pars_fragment:SQ,batching_pars_vertex:xQ,batching_vertex:CQ,begin_vertex:_Q,beginnormal_vertex:wQ,bsdfs:EQ,iridescence_fragment:RQ,bumpmap_pars_fragment:bQ,clipping_planes_fragment:TQ,clipping_planes_pars_fragment:AQ,clipping_planes_pars_vertex:PQ,clipping_planes_vertex:IQ,color_fragment:MQ,color_pars_fragment:kQ,color_pars_vertex:LQ,color_vertex:DQ,common:NQ,cube_uv_reflection_fragment:OQ,defaultnormal_vertex:FQ,displacementmap_pars_vertex:zQ,displacementmap_vertex:UQ,emissivemap_fragment:BQ,emissivemap_pars_fragment:$Q,colorspace_fragment:HQ,colorspace_pars_fragment:VQ,envmap_fragment:jQ,envmap_common_pars_fragment:WQ,envmap_pars_fragment:GQ,envmap_pars_vertex:qQ,envmap_physical_pars_fragment:rZ,envmap_vertex:XQ,fog_vertex:KQ,fog_pars_vertex:YQ,fog_fragment:JQ,fog_pars_fragment:QQ,gradientmap_pars_fragment:ZQ,lightmap_pars_fragment:eZ,lights_lambert_fragment:tZ,lights_lambert_pars_fragment:nZ,lights_pars_begin:iZ,lights_toon_fragment:sZ,lights_toon_pars_fragment:oZ,lights_phong_fragment:aZ,lights_phong_pars_fragment:cZ,lights_physical_fragment:lZ,lights_physical_pars_fragment:uZ,lights_fragment_begin:hZ,lights_fragment_maps:dZ,lights_fragment_end:pZ,logdepthbuf_fragment:fZ,logdepthbuf_pars_fragment:mZ,logdepthbuf_pars_vertex:gZ,logdepthbuf_vertex:vZ,map_fragment:yZ,map_pars_fragment:SZ,map_particle_fragment:xZ,map_particle_pars_fragment:CZ,metalnessmap_fragment:_Z,metalnessmap_pars_fragment:wZ,morphinstance_vertex:EZ,morphcolor_vertex:RZ,morphnormal_vertex:bZ,morphtarget_pars_vertex:TZ,morphtarget_vertex:AZ,normal_fragment_begin:PZ,normal_fragment_maps:IZ,normal_pars_fragment:MZ,normal_pars_vertex:kZ,normal_vertex:LZ,normalmap_pars_fragment:DZ,clearcoat_normal_fragment_begin:NZ,clearcoat_normal_fragment_maps:OZ,clearcoat_pars_fragment:FZ,iridescence_pars_fragment:zZ,opaque_fragment:UZ,packing:BZ,premultiplied_alpha_fragment:$Z,project_vertex:HZ,dithering_fragment:VZ,dithering_pars_fragment:jZ,roughnessmap_fragment:WZ,roughnessmap_pars_fragment:GZ,shadowmap_pars_fragment:qZ,shadowmap_pars_vertex:XZ,shadowmap_vertex:KZ,shadowmask_pars_fragment:YZ,skinbase_vertex:JZ,skinning_pars_vertex:QZ,skinning_vertex:ZZ,skinnormal_vertex:eee,specularmap_fragment:tee,specularmap_pars_fragment:nee,tonemapping_fragment:iee,tonemapping_pars_fragment:ree,transmission_fragment:see,transmission_pars_fragment:oee,uv_pars_fragment:aee,uv_pars_vertex:cee,uv_vertex:lee,worldpos_vertex:uee,background_vert:hee,background_frag:dee,backgroundCube_vert:pee,backgroundCube_frag:fee,cube_vert:mee,cube_frag:gee,depth_vert:vee,depth_frag:yee,distanceRGBA_vert:See,distanceRGBA_frag:xee,equirect_vert:Cee,equirect_frag:_ee,linedashed_vert:wee,linedashed_frag:Eee,meshbasic_vert:Ree,meshbasic_frag:bee,meshlambert_vert:Tee,meshlambert_frag:Aee,meshmatcap_vert:Pee,meshmatcap_frag:Iee,meshnormal_vert:Mee,meshnormal_frag:kee,meshphong_vert:Lee,meshphong_frag:Dee,meshphysical_vert:Nee,meshphysical_frag:Oee,meshtoon_vert:Fee,meshtoon_frag:zee,points_vert:Uee,points_frag:Bee,shadow_vert:$ee,shadow_frag:Hee,sprite_vert:Vee,sprite_frag:jee},Ae={common:{diffuse:{value:new Xe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Tt},alphaMap:{value:null},alphaMapTransform:{value:new Tt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Tt}},envmap:{envMap:{value:null},envMapRotation:{value:new Tt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Tt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Tt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Tt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Tt},normalScale:{value:new gt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Tt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Tt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Tt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Tt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Xe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Xe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Tt},alphaTest:{value:0},uvTransform:{value:new Tt}},sprite:{diffuse:{value:new Xe(16777215)},opacity:{value:1},center:{value:new gt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Tt},alphaMap:{value:null},alphaMapTransform:{value:new Tt},alphaTest:{value:0}}},Yo={basic:{uniforms:xr([Ae.common,Ae.specularmap,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.fog]),vertexShader:At.meshbasic_vert,fragmentShader:At.meshbasic_frag},lambert:{uniforms:xr([Ae.common,Ae.specularmap,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.fog,Ae.lights,{emissive:{value:new Xe(0)}}]),vertexShader:At.meshlambert_vert,fragmentShader:At.meshlambert_frag},phong:{uniforms:xr([Ae.common,Ae.specularmap,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.fog,Ae.lights,{emissive:{value:new Xe(0)},specular:{value:new Xe(1118481)},shininess:{value:30}}]),vertexShader:At.meshphong_vert,fragmentShader:At.meshphong_frag},standard:{uniforms:xr([Ae.common,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.roughnessmap,Ae.metalnessmap,Ae.fog,Ae.lights,{emissive:{value:new Xe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:At.meshphysical_vert,fragmentShader:At.meshphysical_frag},toon:{uniforms:xr([Ae.common,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.gradientmap,Ae.fog,Ae.lights,{emissive:{value:new Xe(0)}}]),vertexShader:At.meshtoon_vert,fragmentShader:At.meshtoon_frag},matcap:{uniforms:xr([Ae.common,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.fog,{matcap:{value:null}}]),vertexShader:At.meshmatcap_vert,fragmentShader:At.meshmatcap_frag},points:{uniforms:xr([Ae.points,Ae.fog]),vertexShader:At.points_vert,fragmentShader:At.points_frag},dashed:{uniforms:xr([Ae.common,Ae.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:At.linedashed_vert,fragmentShader:At.linedashed_frag},depth:{uniforms:xr([Ae.common,Ae.displacementmap]),vertexShader:At.depth_vert,fragmentShader:At.depth_frag},normal:{uniforms:xr([Ae.common,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,{opacity:{value:1}}]),vertexShader:At.meshnormal_vert,fragmentShader:At.meshnormal_frag},sprite:{uniforms:xr([Ae.sprite,Ae.fog]),vertexShader:At.sprite_vert,fragmentShader:At.sprite_frag},background:{uniforms:{uvTransform:{value:new Tt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:At.background_vert,fragmentShader:At.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Tt}},vertexShader:At.backgroundCube_vert,fragmentShader:At.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:At.cube_vert,fragmentShader:At.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:At.equirect_vert,fragmentShader:At.equirect_frag},distanceRGBA:{uniforms:xr([Ae.common,Ae.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:At.distanceRGBA_vert,fragmentShader:At.distanceRGBA_frag},shadow:{uniforms:xr([Ae.lights,Ae.fog,{color:{value:new Xe(0)},opacity:{value:1}}]),vertexShader:At.shadow_vert,fragmentShader:At.shadow_frag}};Yo.physical={uniforms:xr([Yo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Tt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Tt},clearcoatNormalScale:{value:new gt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Tt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Tt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Tt},sheen:{value:0},sheenColor:{value:new Xe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Tt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Tt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Tt},transmissionSamplerSize:{value:new gt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Tt},attenuationDistance:{value:0},attenuationColor:{value:new Xe(0)},specularColor:{value:new Xe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Tt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Tt},anisotropyVector:{value:new gt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Tt}}]),vertexShader:At.meshphysical_vert,fragmentShader:At.meshphysical_frag};const Bv={r:0,b:0,g:0},Gl=new fn,Wee=new Ge;function Gee(t,e,n,i,r,s,o){const a=new Xe(0);let c=s===!0?0:1,l,u,h=null,d=0,p=null;function f(y){let S=y.isScene===!0?y.background:null;return S&&S.isTexture&&(S=(y.backgroundBlurriness>0?n:e).get(S)),S}function v(y){let S=!1;const x=f(y);x===null?m(a,c):x&&x.isColor&&(m(x,1),S=!0);const w=t.xr.getEnvironmentBlendMode();w==="additive"?i.buffers.color.setClear(0,0,0,1,o):w==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(t.autoClear||S)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function g(y,S){const x=f(S);x&&(x.isCubeTexture||x.mapping===Kx)?(u===void 0&&(u=new gn(new lp(1,1,1),new ol({name:"BackgroundCubeMaterial",uniforms:zd(Yo.backgroundCube.uniforms),vertexShader:Yo.backgroundCube.vertexShader,fragmentShader:Yo.backgroundCube.fragmentShader,side:br,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,C,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),Gl.copy(S.backgroundRotation),Gl.x*=-1,Gl.y*=-1,Gl.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Gl.y*=-1,Gl.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=S.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Wee.makeRotationFromEuler(Gl)),u.material.toneMapped=Pt.getTransfer(x.colorSpace)!==Pn,(h!==x||d!==x.version||p!==t.toneMapping)&&(u.material.needsUpdate=!0,h=x,d=x.version,p=t.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(l===void 0&&(l=new gn(new Qx(2,2),new ol({name:"BackgroundMaterial",uniforms:zd(Yo.background.uniforms),vertexShader:Yo.background.vertexShader,fragmentShader:Yo.background.fragmentShader,side:Ka,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=x,l.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,l.material.toneMapped=Pt.getTransfer(x.colorSpace)!==Pn,x.matrixAutoUpdate===!0&&x.updateMatrix(),l.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||d!==x.version||p!==t.toneMapping)&&(l.material.needsUpdate=!0,h=x,d=x.version,p=t.toneMapping),l.layers.enableAll(),y.unshift(l,l.geometry,l.material,0,0,null))}function m(y,S){y.getRGB(Bv,YB(t)),i.buffers.color.setClear(Bv.r,Bv.g,Bv.b,S,o)}return{getClearColor:function(){return a},setClearColor:function(y,S=1){a.set(y),c=S,m(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(y){c=y,m(a,c)},render:v,addToRenderList:g}}function qee(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=d(null);let s=r,o=!1;function a(_,R,L,O,V){let X=!1;const G=h(O,L,R);s!==G&&(s=G,l(s.object)),X=p(_,O,L,V),X&&f(_,O,L,V),V!==null&&e.update(V,t.ELEMENT_ARRAY_BUFFER),(X||o)&&(o=!1,x(_,R,L,O),V!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(V).buffer))}function c(){return t.createVertexArray()}function l(_){return t.bindVertexArray(_)}function u(_){return t.deleteVertexArray(_)}function h(_,R,L){const O=L.wireframe===!0;let V=i[_.id];V===void 0&&(V={},i[_.id]=V);let X=V[R.id];X===void 0&&(X={},V[R.id]=X);let G=X[O];return G===void 0&&(G=d(c()),X[O]=G),G}function d(_){const R=[],L=[],O=[];for(let V=0;V<n;V++)R[V]=0,L[V]=0,O[V]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:L,attributeDivisors:O,object:_,attributes:{},index:null}}function p(_,R,L,O){const V=s.attributes,X=R.attributes;let G=0;const J=L.getAttributes();for(const D in J)if(J[D].location>=0){const P=V[D];let ee=X[D];if(ee===void 0&&(D==="instanceMatrix"&&_.instanceMatrix&&(ee=_.instanceMatrix),D==="instanceColor"&&_.instanceColor&&(ee=_.instanceColor)),P===void 0||P.attribute!==ee||ee&&P.data!==ee.data)return!0;G++}return s.attributesNum!==G||s.index!==O}function f(_,R,L,O){const V={},X=R.attributes;let G=0;const J=L.getAttributes();for(const D in J)if(J[D].location>=0){let P=X[D];P===void 0&&(D==="instanceMatrix"&&_.instanceMatrix&&(P=_.instanceMatrix),D==="instanceColor"&&_.instanceColor&&(P=_.instanceColor));const ee={};ee.attribute=P,P&&P.data&&(ee.data=P.data),V[D]=ee,G++}s.attributes=V,s.attributesNum=G,s.index=O}function v(){const _=s.newAttributes;for(let R=0,L=_.length;R<L;R++)_[R]=0}function g(_){m(_,0)}function m(_,R){const L=s.newAttributes,O=s.enabledAttributes,V=s.attributeDivisors;L[_]=1,O[_]===0&&(t.enableVertexAttribArray(_),O[_]=1),V[_]!==R&&(t.vertexAttribDivisor(_,R),V[_]=R)}function y(){const _=s.newAttributes,R=s.enabledAttributes;for(let L=0,O=R.length;L<O;L++)R[L]!==_[L]&&(t.disableVertexAttribArray(L),R[L]=0)}function S(_,R,L,O,V,X,G){G===!0?t.vertexAttribIPointer(_,R,L,V,X):t.vertexAttribPointer(_,R,L,O,V,X)}function x(_,R,L,O){v();const V=O.attributes,X=L.getAttributes(),G=R.defaultAttributeValues;for(const J in X){const D=X[J];if(D.location>=0){let ne=V[J];if(ne===void 0&&(J==="instanceMatrix"&&_.instanceMatrix&&(ne=_.instanceMatrix),J==="instanceColor"&&_.instanceColor&&(ne=_.instanceColor)),ne!==void 0){const P=ne.normalized,ee=ne.itemSize,ge=e.get(ne);if(ge===void 0)continue;const I=ge.buffer,$=ge.type,K=ge.bytesPerElement,oe=$===t.INT||$===t.UNSIGNED_INT||ne.gpuType===z2;if(ne.isInterleavedBufferAttribute){const he=ne.data,ze=he.stride,Me=ne.offset;if(he.isInstancedInterleavedBuffer){for(let dt=0;dt<D.locationSize;dt++)m(D.location+dt,he.meshPerAttribute);_.isInstancedMesh!==!0&&O._maxInstanceCount===void 0&&(O._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let dt=0;dt<D.locationSize;dt++)g(D.location+dt);t.bindBuffer(t.ARRAY_BUFFER,I);for(let dt=0;dt<D.locationSize;dt++)S(D.location+dt,ee/D.locationSize,$,P,ze*K,(Me+ee/D.locationSize*dt)*K,oe)}else{if(ne.isInstancedBufferAttribute){for(let he=0;he<D.locationSize;he++)m(D.location+he,ne.meshPerAttribute);_.isInstancedMesh!==!0&&O._maxInstanceCount===void 0&&(O._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let he=0;he<D.locationSize;he++)g(D.location+he);t.bindBuffer(t.ARRAY_BUFFER,I);for(let he=0;he<D.locationSize;he++)S(D.location+he,ee/D.locationSize,$,P,ee*K,ee/D.locationSize*he*K,oe)}}else if(G!==void 0){const P=G[J];if(P!==void 0)switch(P.length){case 2:t.vertexAttrib2fv(D.location,P);break;case 3:t.vertexAttrib3fv(D.location,P);break;case 4:t.vertexAttrib4fv(D.location,P);break;default:t.vertexAttrib1fv(D.location,P)}}}}y()}function w(){b();for(const _ in i){const R=i[_];for(const L in R){const O=R[L];for(const V in O)u(O[V].object),delete O[V];delete R[L]}delete i[_]}}function C(_){if(i[_.id]===void 0)return;const R=i[_.id];for(const L in R){const O=R[L];for(const V in O)u(O[V].object),delete O[V];delete R[L]}delete i[_.id]}function E(_){for(const R in i){const L=i[R];if(L[_.id]===void 0)continue;const O=L[_.id];for(const V in O)u(O[V].object),delete O[V];delete L[_.id]}}function b(){M(),o=!0,s!==r&&(s=r,l(s.object))}function M(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:b,resetDefaultState:M,dispose:w,releaseStatesOfGeometry:C,releaseStatesOfProgram:E,initAttributes:v,enableAttribute:g,disableUnusedAttributes:y}}function Xee(t,e,n){let i;function r(l){i=l}function s(l,u){t.drawArrays(i,l,u),n.update(u,i,1)}function o(l,u,h){h!==0&&(t.drawArraysInstanced(i,l,u,h),n.update(u,i,h))}function a(l,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,l,0,u,0,h);let p=0;for(let f=0;f<h;f++)p+=u[f];n.update(p,i,1)}function c(l,u,h,d){if(h===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let f=0;f<l.length;f++)o(l[f],u[f],d[f]);else{p.multiDrawArraysInstancedWEBGL(i,l,0,u,0,d,0,h);let f=0;for(let v=0;v<h;v++)f+=u[v];for(let v=0;v<d.length;v++)n.update(f,i,d[v])}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Kee(t,e,n,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const E=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(E){return!(E!==Bs&&i.convert(E)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(E){const b=E===D0&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(E!==Ya&&i.convert(E)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&E!==Ro&&!b)}function c(E){if(E==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";E="mediump"}return E==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=n.precision!==void 0?n.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const h=n.logarithmicDepthBuffer===!0,d=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(d===!0){const E=e.get("EXT_clip_control");E.clipControlEXT(E.LOWER_LEFT_EXT,E.ZERO_TO_ONE_EXT)}const p=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),f=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=t.getParameter(t.MAX_TEXTURE_SIZE),g=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),m=t.getParameter(t.MAX_VERTEX_ATTRIBS),y=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),S=t.getParameter(t.MAX_VARYING_VECTORS),x=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),w=f>0,C=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:p,maxVertexTextures:f,maxTextureSize:v,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:y,maxVaryings:S,maxFragmentUniforms:x,vertexTextures:w,maxSamples:C}}function Yee(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new Ec,a=new Tt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||i!==0||r;return r=d,i=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){n=u(h,d,0)},this.setState=function(h,d,p){const f=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,m=t.get(h);if(!r||f===null||f.length===0||s&&!g)s?u(null):l();else{const y=s?0:i,S=y*4;let x=m.clippingState||null;c.value=x,x=u(f,d,S,p);for(let w=0;w!==S;++w)x[w]=n[w];m.clippingState=x,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}};function l(){c.value!==n&&(c.value=n,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(h,d,p,f){const v=h!==null?h.length:0;let g=null;if(v!==0){if(g=c.value,f!==!0||g===null){const m=p+v*4,y=d.matrixWorldInverse;a.getNormalMatrix(y),(g===null||g.length<m)&&(g=new Float32Array(m));for(let S=0,x=p;S!==v;++S,x+=4)o.copy(h[S]).applyMatrix4(y,a),o.normal.toArray(g,x),g[x+3]=o.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,g}}function Jee(t){let e=new WeakMap;function n(o,a){return a===E1?o.mapping=Ld:a===bR&&(o.mapping=Dd),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===E1||a===bR)if(e.has(o)){const c=e.get(o).texture;return n(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new cQ(c.height);return l.fromEquirectangularTexture(t,o),e.set(o,l),o.addEventListener("dispose",r),n(l.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class J2 extends JB{constructor(e=-1,n=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+n,c=r-n;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const Jh=4,gL=[.125,.215,.35,.446,.526,.582],nu=20,fw=new J2,vL=new Xe;let mw=null,gw=0,vw=0,yw=!1;const Zl=(1+Math.sqrt(5))/2,Eh=1/Zl,yL=[new N(-Zl,Eh,0),new N(Zl,Eh,0),new N(-Eh,0,Zl),new N(Eh,0,Zl),new N(0,Zl,-Eh),new N(0,Zl,Eh),new N(-1,1,-1),new N(1,1,-1),new N(-1,1,1),new N(1,1,1)];class tb{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,i=.1,r=100){mw=this._renderer.getRenderTarget(),gw=this._renderer.getActiveCubeFace(),vw=this._renderer.getActiveMipmapLevel(),yw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),n>0&&this._blur(s,0,0,n),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=CL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=xL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(mw,gw,vw),this._renderer.xr.enabled=yw,e.scissorTest=!1,$v(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Ld||e.mapping===Dd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),mw=this._renderer.getRenderTarget(),gw=this._renderer.getActiveCubeFace(),vw=this._renderer.getActiveMipmapLevel(),yw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=n||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,i={magFilter:ds,minFilter:ds,generateMipmaps:!1,type:D0,format:Bs,colorSpace:qi,depthBuffer:!1},r=SL(e,n,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=SL(e,n,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Qee(s)),this._blurMaterial=Zee(s,e,n)}return r}_compileMaterial(e){const n=new gn(this._lodPlanes[0],e);this._renderer.compile(n,fw)}_sceneToCubeUV(e,n,i,r){const a=new lr(90,1,n,i),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(vL),u.toneMapping=Yc,u.autoClear=!1;const p=new Nc({name:"PMREM.Background",side:br,depthWrite:!1,depthTest:!1}),f=new gn(new lp,p);let v=!1;const g=e.background;g?g.isColor&&(p.color.copy(g),e.background=null,v=!0):(p.color.copy(vL),v=!0);for(let m=0;m<6;m++){const y=m%3;y===0?(a.up.set(0,c[m],0),a.lookAt(l[m],0,0)):y===1?(a.up.set(0,0,c[m]),a.lookAt(0,l[m],0)):(a.up.set(0,c[m],0),a.lookAt(0,0,l[m]));const S=this._cubeSize;$v(r,y*S,m>2?S:0,S,S),u.setRenderTarget(r),v&&u.render(f,a),u.render(e,a)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=g}_textureToCubeUV(e,n){const i=this._renderer,r=e.mapping===Ld||e.mapping===Dd;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=CL()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=xL());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new gn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;$v(n,0,0,3*c,2*c),i.setRenderTarget(n),i.render(o,fw)}_applyPMREM(e){const n=this._renderer,i=n.autoClear;n.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=yL[(r-s-1)%yL.length];this._blur(e,s-1,s,o,a)}n.autoClear=i}_blur(e,n,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,n,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,n,i,r,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new gn(this._lodPlanes[r],l),d=l.uniforms,p=this._sizeLods[i]-1,f=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*nu-1),v=s/f,g=isFinite(s)?1+Math.floor(u*v):nu;g>nu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${nu}`);const m=[];let y=0;for(let E=0;E<nu;++E){const b=E/v,M=Math.exp(-b*b/2);m.push(M),E===0?y+=M:E<g&&(y+=2*M)}for(let E=0;E<m.length;E++)m[E]=m[E]/y;d.envMap.value=e.texture,d.samples.value=g,d.weights.value=m,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:S}=this;d.dTheta.value=f,d.mipInt.value=S-i;const x=this._sizeLods[r],w=3*x*(r>S-Jh?r-S+Jh:0),C=4*(this._cubeSize-x);$v(n,w,C,3*x,2*x),c.setRenderTarget(n),c.render(h,fw)}}function Qee(t){const e=[],n=[],i=[];let r=t;const s=t-Jh+1+gL.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);n.push(a);let c=1/a;o>t-Jh?c=gL[o-t+Jh-1]:o===0&&(c=0),i.push(c);const l=1/(a-2),u=-l,h=1+l,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,v=3,g=2,m=1,y=new Float32Array(v*f*p),S=new Float32Array(g*f*p),x=new Float32Array(m*f*p);for(let C=0;C<p;C++){const E=C%3*2/3-1,b=C>2?0:-1,M=[E,b,0,E+2/3,b,0,E+2/3,b+1,0,E,b,0,E+2/3,b+1,0,E,b+1,0];y.set(M,v*f*C),S.set(d,g*f*C);const _=[C,C,C,C,C,C];x.set(_,m*f*C)}const w=new ys;w.setAttribute("position",new Tr(y,v)),w.setAttribute("uv",new Tr(S,g)),w.setAttribute("faceIndex",new Tr(x,m)),e.push(w),r>Jh&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}function SL(t,e,n){const i=new Mu(t,e,n);return i.texture.mapping=Kx,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function $v(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Zee(t,e,n){const i=new Float32Array(nu),r=new N(0,1,0);return new ol({name:"SphericalGaussianBlur",defines:{n:nu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Q2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Kc,depthTest:!1,depthWrite:!1})}function xL(){return new ol({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Q2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Kc,depthTest:!1,depthWrite:!1})}function CL(){return new ol({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Q2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Kc,depthTest:!1,depthWrite:!1})}function Q2(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ete(t){let e=new WeakMap,n=null;function i(a){if(a&&a.isTexture){const c=a.mapping,l=c===E1||c===bR,u=c===Ld||c===Dd;if(l||u){let h=e.get(a);const d=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return n===null&&(n=new tb(t)),h=l?n.fromEquirectangular(a,h):n.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const p=a.image;return l&&p&&p.height>0||u&&p&&r(p)?(n===null&&(n=new tb(t)),h=l?n.fromEquirectangular(a):n.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function r(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:i,dispose:o}}function tte(t){const e={};function n(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(i)}return e[i]=r,r}return{has:function(i){return n(i)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(i){const r=n(i);return r===null&&zy("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function nte(t,e,n,i){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const f in d.attributes)e.remove(d.attributes[f]);for(const f in d.morphAttributes){const v=d.morphAttributes[f];for(let g=0,m=v.length;g<m;g++)e.remove(v[g])}d.removeEventListener("dispose",o),delete r[d.id];const p=s.get(d);p&&(e.remove(p),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,n.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,n.memory.geometries++),d}function c(h){const d=h.attributes;for(const f in d)e.update(d[f],t.ARRAY_BUFFER);const p=h.morphAttributes;for(const f in p){const v=p[f];for(let g=0,m=v.length;g<m;g++)e.update(v[g],t.ARRAY_BUFFER)}}function l(h){const d=[],p=h.index,f=h.attributes.position;let v=0;if(p!==null){const y=p.array;v=p.version;for(let S=0,x=y.length;S<x;S+=3){const w=y[S+0],C=y[S+1],E=y[S+2];d.push(w,C,C,E,E,w)}}else if(f!==void 0){const y=f.array;v=f.version;for(let S=0,x=y.length/3-1;S<x;S+=3){const w=S+0,C=S+1,E=S+2;d.push(w,C,C,E,E,w)}}else return;const g=new(WB(d)?KB:K2)(d,1);g.version=v;const m=s.get(h);m&&e.remove(m),s.set(h,g)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&l(h)}else l(h);return s.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function ite(t,e,n){let i;function r(d){i=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function c(d,p){t.drawElements(i,p,s,d*o),n.update(p,i,1)}function l(d,p,f){f!==0&&(t.drawElementsInstanced(i,p,s,d*o,f),n.update(p,i,f))}function u(d,p,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,p,0,s,d,0,f);let g=0;for(let m=0;m<f;m++)g+=p[m];n.update(g,i,1)}function h(d,p,f,v){if(f===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let m=0;m<d.length;m++)l(d[m]/o,p[m],v[m]);else{g.multiDrawElementsInstancedWEBGL(i,p,0,s,d,0,v,0,f);let m=0;for(let y=0;y<f;y++)m+=p[y];for(let y=0;y<v.length;y++)n.update(m,i,v[y])}}this.setMode=r,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function rte(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(n.calls++,o){case t.TRIANGLES:n.triangles+=a*(s/3);break;case t.LINES:n.lines+=a*(s/2);break;case t.LINE_STRIP:n.lines+=a*(s-1);break;case t.LINE_LOOP:n.lines+=a*s;break;case t.POINTS:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:r,update:i}}function ste(t,e,n){const i=new WeakMap,r=new Gt;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let d=i.get(a);if(d===void 0||d.count!==h){let _=function(){b.dispose(),i.delete(a),a.removeEventListener("dispose",_)};var p=_;d!==void 0&&d.texture.dispose();const f=a.morphAttributes.position!==void 0,v=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,m=a.morphAttributes.position||[],y=a.morphAttributes.normal||[],S=a.morphAttributes.color||[];let x=0;f===!0&&(x=1),v===!0&&(x=2),g===!0&&(x=3);let w=a.attributes.position.count*x,C=1;w>e.maxTextureSize&&(C=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const E=new Float32Array(w*C*4*h),b=new qB(E,w,C,h);b.type=Ro,b.needsUpdate=!0;const M=x*4;for(let R=0;R<h;R++){const L=m[R],O=y[R],V=S[R],X=w*C*4*R;for(let G=0;G<L.count;G++){const J=G*M;f===!0&&(r.fromBufferAttribute(L,G),E[X+J+0]=r.x,E[X+J+1]=r.y,E[X+J+2]=r.z,E[X+J+3]=0),v===!0&&(r.fromBufferAttribute(O,G),E[X+J+4]=r.x,E[X+J+5]=r.y,E[X+J+6]=r.z,E[X+J+7]=0),g===!0&&(r.fromBufferAttribute(V,G),E[X+J+8]=r.x,E[X+J+9]=r.y,E[X+J+10]=r.z,E[X+J+11]=V.itemSize===4?r.w:1)}}d={count:h,texture:b,size:new gt(w,C)},i.set(a,d),a.addEventListener("dispose",_)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(t,"morphTexture",o.morphTexture,n);else{let f=0;for(let g=0;g<l.length;g++)f+=l[g];const v=a.morphTargetsRelative?1:1-f;c.getUniforms().setValue(t,"morphTargetBaseInfluence",v),c.getUniforms().setValue(t,"morphTargetInfluences",l)}c.getUniforms().setValue(t,"morphTargetsTexture",d.texture,n),c.getUniforms().setValue(t,"morphTargetsTextureSize",d.size)}return{update:s}}function ote(t,e,n,i){let r=new WeakMap;function s(c){const l=i.render.frame,u=c.geometry,h=e.get(c,u);if(r.get(h)!==l&&(e.update(h),r.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),r.get(c)!==l&&(n.update(c.instanceMatrix,t.ARRAY_BUFFER),c.instanceColor!==null&&n.update(c.instanceColor,t.ARRAY_BUFFER),r.set(c,l))),c.isSkinnedMesh){const d=c.skeleton;r.get(d)!==l&&(d.update(),r.set(d,l))}return h}function o(){r=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),n.remove(l.instanceMatrix),l.instanceColor!==null&&n.remove(l.instanceColor)}return{update:s,dispose:o}}class e5 extends wi{constructor(e,n,i,r,s,o,a,c,l,u=ud){if(u!==ud&&u!==Od)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===ud&&(i=Iu),i===void 0&&u===Od&&(i=Nd),super(null,r,s,o,a,c,u,i,l),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=a!==void 0?a:Er,this.minFilter=c!==void 0?c:Er,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}const t5=new wi,_L=new e5(1,1),n5=new qB,i5=new GJ,r5=new QB,wL=[],EL=[],RL=new Float32Array(16),bL=new Float32Array(9),TL=new Float32Array(4);function up(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=wL[r];if(s===void 0&&(s=new Float32Array(r),wL[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function Ei(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Ri(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Zx(t,e){let n=EL[e];n===void 0&&(n=new Int32Array(e),EL[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function ate(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function cte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ei(n,e))return;t.uniform2fv(this.addr,e),Ri(n,e)}}function lte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ei(n,e))return;t.uniform3fv(this.addr,e),Ri(n,e)}}function ute(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ei(n,e))return;t.uniform4fv(this.addr,e),Ri(n,e)}}function hte(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ei(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ri(n,e)}else{if(Ei(n,i))return;TL.set(i),t.uniformMatrix2fv(this.addr,!1,TL),Ri(n,i)}}function dte(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ei(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ri(n,e)}else{if(Ei(n,i))return;bL.set(i),t.uniformMatrix3fv(this.addr,!1,bL),Ri(n,i)}}function pte(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ei(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ri(n,e)}else{if(Ei(n,i))return;RL.set(i),t.uniformMatrix4fv(this.addr,!1,RL),Ri(n,i)}}function fte(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function mte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ei(n,e))return;t.uniform2iv(this.addr,e),Ri(n,e)}}function gte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ei(n,e))return;t.uniform3iv(this.addr,e),Ri(n,e)}}function vte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ei(n,e))return;t.uniform4iv(this.addr,e),Ri(n,e)}}function yte(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Ste(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ei(n,e))return;t.uniform2uiv(this.addr,e),Ri(n,e)}}function xte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ei(n,e))return;t.uniform3uiv(this.addr,e),Ri(n,e)}}function Cte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ei(n,e))return;t.uniform4uiv(this.addr,e),Ri(n,e)}}function _te(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);let s;this.type===t.SAMPLER_2D_SHADOW?(_L.compareFunction=jB,s=_L):s=t5,n.setTexture2D(e||s,r)}function wte(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||i5,r)}function Ete(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||r5,r)}function Rte(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||n5,r)}function bte(t){switch(t){case 5126:return ate;case 35664:return cte;case 35665:return lte;case 35666:return ute;case 35674:return hte;case 35675:return dte;case 35676:return pte;case 5124:case 35670:return fte;case 35667:case 35671:return mte;case 35668:case 35672:return gte;case 35669:case 35673:return vte;case 5125:return yte;case 36294:return Ste;case 36295:return xte;case 36296:return Cte;case 35678:case 36198:case 36298:case 36306:case 35682:return _te;case 35679:case 36299:case 36307:return wte;case 35680:case 36300:case 36308:case 36293:return Ete;case 36289:case 36303:case 36311:case 36292:return Rte}}function Tte(t,e){t.uniform1fv(this.addr,e)}function Ate(t,e){const n=up(e,this.size,2);t.uniform2fv(this.addr,n)}function Pte(t,e){const n=up(e,this.size,3);t.uniform3fv(this.addr,n)}function Ite(t,e){const n=up(e,this.size,4);t.uniform4fv(this.addr,n)}function Mte(t,e){const n=up(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function kte(t,e){const n=up(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Lte(t,e){const n=up(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Dte(t,e){t.uniform1iv(this.addr,e)}function Nte(t,e){t.uniform2iv(this.addr,e)}function Ote(t,e){t.uniform3iv(this.addr,e)}function Fte(t,e){t.uniform4iv(this.addr,e)}function zte(t,e){t.uniform1uiv(this.addr,e)}function Ute(t,e){t.uniform2uiv(this.addr,e)}function Bte(t,e){t.uniform3uiv(this.addr,e)}function $te(t,e){t.uniform4uiv(this.addr,e)}function Hte(t,e,n){const i=this.cache,r=e.length,s=Zx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTexture2D(e[o]||t5,s[o])}function Vte(t,e,n){const i=this.cache,r=e.length,s=Zx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTexture3D(e[o]||i5,s[o])}function jte(t,e,n){const i=this.cache,r=e.length,s=Zx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTextureCube(e[o]||r5,s[o])}function Wte(t,e,n){const i=this.cache,r=e.length,s=Zx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTexture2DArray(e[o]||n5,s[o])}function Gte(t){switch(t){case 5126:return Tte;case 35664:return Ate;case 35665:return Pte;case 35666:return Ite;case 35674:return Mte;case 35675:return kte;case 35676:return Lte;case 5124:case 35670:return Dte;case 35667:case 35671:return Nte;case 35668:case 35672:return Ote;case 35669:case 35673:return Fte;case 5125:return zte;case 36294:return Ute;case 36295:return Bte;case 36296:return $te;case 35678:case 36198:case 36298:case 36306:case 35682:return Hte;case 35679:case 36299:case 36307:return Vte;case 35680:case 36300:case 36308:case 36293:return jte;case 36289:case 36303:case 36311:case 36292:return Wte}}class qte{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.setValue=bte(n.type)}}class Xte{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=Gte(n.type)}}class Kte{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,n[a.id],i)}}}const Sw=/(\w+)(\])?(\[|\.)?/g;function AL(t,e){t.seq.push(e),t.map[e.id]=e}function Yte(t,e,n){const i=t.name,r=i.length;for(Sw.lastIndex=0;;){const s=Sw.exec(i),o=Sw.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===r){AL(n,l===void 0?new qte(a,t,e):new Xte(a,t,e));break}else{let h=n.map[a];h===void 0&&(h=new Kte(a),AL(n,h)),n=h}}}class Uy{constructor(e,n){this.seq=[],this.map={};const i=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(n,r),o=e.getUniformLocation(n,s.name);Yte(s,o,this)}}setValue(e,n,i,r){const s=this.map[n];s!==void 0&&s.setValue(e,i,r)}setOptional(e,n,i){const r=n[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,n,i,r){for(let s=0,o=n.length;s!==o;++s){const a=n[s],c=i[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,r)}}static seqWithValue(e,n){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in n&&i.push(o)}return i}}function PL(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}const Jte=37297;let Qte=0;function Zte(t,e){const n=t.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${n[o]}`)}return i.join(`
`)}function ene(t){const e=Pt.getPrimaries(Pt.workingColorSpace),n=Pt.getPrimaries(t);let i;switch(e===n?i="":e===P1&&n===A1?i="LinearDisplayP3ToLinearSRGB":e===A1&&n===P1&&(i="LinearSRGBToLinearDisplayP3"),t){case qi:case Jx:return[i,"LinearTransferOETF"];case on:case G2:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[i,"LinearTransferOETF"]}}function IL(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+r+`

`+Zte(t.getShaderSource(e),o)}else return r}function tne(t,e){const n=ene(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function nne(t,e){let n;switch(e){case eJ:n="Linear";break;case tJ:n="Reinhard";break;case nJ:n="Cineon";break;case IB:n="ACESFilmic";break;case rJ:n="AgX";break;case sJ:n="Neutral";break;case iJ:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Hv=new N;function ine(){Pt.getLuminanceCoefficients(Hv);const t=Hv.x.toFixed(4),e=Hv.y.toFixed(4),n=Hv.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function rne(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(tg).join(`
`)}function sne(t){const e=[];for(const n in t){const i=t[n];i!==!1&&e.push("#define "+n+" "+i)}return e.join(`
`)}function one(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=t.getActiveAttrib(e,r),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),n[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}function tg(t){return t!==""}function ML(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function kL(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ane=/^[ \t]*#include +<([\w\d./]+)>/gm;function nb(t){return t.replace(ane,lne)}const cne=new Map;function lne(t,e){let n=At[e];if(n===void 0){const i=cne.get(e);if(i!==void 0)n=At[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return nb(n)}const une=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function LL(t){return t.replace(une,hne)}function hne(t,e,n,i){let r="";for(let s=parseInt(e);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function DL(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function dne(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===PB?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===LY?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Aa&&(e="SHADOWMAP_TYPE_VSM"),e}function pne(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Ld:case Dd:e="ENVMAP_TYPE_CUBE";break;case Kx:e="ENVMAP_TYPE_CUBE_UV";break}return e}function fne(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Dd:e="ENVMAP_MODE_REFRACTION";break}return e}function mne(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Xx:e="ENVMAP_BLENDING_MULTIPLY";break;case QY:e="ENVMAP_BLENDING_MIX";break;case ZY:e="ENVMAP_BLENDING_ADD";break}return e}function gne(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:i,maxMip:n}}function vne(t,e,n,i){const r=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const c=dne(n),l=pne(n),u=fne(n),h=mne(n),d=gne(n),p=rne(n),f=sne(s),v=r.createProgram();let g,m,y=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(tg).join(`
`),g.length>0&&(g+=`
`),m=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(tg).join(`
`),m.length>0&&(m+=`
`)):(g=[DL(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(tg).join(`
`),m=[DL(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Yc?"#define TONE_MAPPING":"",n.toneMapping!==Yc?At.tonemapping_pars_fragment:"",n.toneMapping!==Yc?nne("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",At.colorspace_pars_fragment,tne("linearToOutputTexel",n.outputColorSpace),ine(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(tg).join(`
`)),o=nb(o),o=ML(o,n),o=kL(o,n),a=nb(a),a=ML(a,n),a=kL(a,n),o=LL(o),a=LL(a),n.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,m=["#define varying in",n.glslVersion===Jk?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Jk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const S=y+g+o,x=y+m+a,w=PL(r,r.VERTEX_SHADER,S),C=PL(r,r.FRAGMENT_SHADER,x);r.attachShader(v,w),r.attachShader(v,C),n.index0AttributeName!==void 0?r.bindAttribLocation(v,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v);function E(R){if(t.debug.checkShaderErrors){const L=r.getProgramInfoLog(v).trim(),O=r.getShaderInfoLog(w).trim(),V=r.getShaderInfoLog(C).trim();let X=!0,G=!0;if(r.getProgramParameter(v,r.LINK_STATUS)===!1)if(X=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(r,v,w,C);else{const J=IL(r,w,"vertex"),D=IL(r,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+L+`
`+J+`
`+D)}else L!==""?console.warn("THREE.WebGLProgram: Program Info Log:",L):(O===""||V==="")&&(G=!1);G&&(R.diagnostics={runnable:X,programLog:L,vertexShader:{log:O,prefix:g},fragmentShader:{log:V,prefix:m}})}r.deleteShader(w),r.deleteShader(C),b=new Uy(r,v),M=one(r,v)}let b;this.getUniforms=function(){return b===void 0&&E(this),b};let M;this.getAttributes=function(){return M===void 0&&E(this),M};let _=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return _===!1&&(_=r.getProgramParameter(v,Jte)),_},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Qte++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=C,this}let yne=0;class Sne{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(n),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const i of n)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let i=n.get(e);return i===void 0&&(i=new Set,n.set(e,i)),i}_getShaderStage(e){const n=this.shaderCache;let i=n.get(e);return i===void 0&&(i=new xne(e),n.set(e,i)),i}}class xne{constructor(e){this.id=yne++,this.code=e,this.usedTimes=0}}function Cne(t,e,n,i,r,s,o){const a=new X2,c=new Sne,l=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.reverseDepthBuffer,p=r.vertexTextures;let f=r.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(_){return l.add(_),_===0?"uv":`uv${_}`}function m(_,R,L,O,V){const X=O.fog,G=V.geometry,J=_.isMeshStandardMaterial?O.environment:null,D=(_.isMeshStandardMaterial?n:e).get(_.envMap||J),ne=D&&D.mapping===Kx?D.image.height:null,P=v[_.type];_.precision!==null&&(f=r.getMaxPrecision(_.precision),f!==_.precision&&console.warn("THREE.WebGLProgram.getParameters:",_.precision,"not supported, using",f,"instead."));const ee=G.morphAttributes.position||G.morphAttributes.normal||G.morphAttributes.color,ge=ee!==void 0?ee.length:0;let I=0;G.morphAttributes.position!==void 0&&(I=1),G.morphAttributes.normal!==void 0&&(I=2),G.morphAttributes.color!==void 0&&(I=3);let $,K,oe,he;if(P){const bi=Yo[P];$=bi.vertexShader,K=bi.fragmentShader}else $=_.vertexShader,K=_.fragmentShader,c.update(_),oe=c.getVertexShaderID(_),he=c.getFragmentShaderID(_);const ze=t.getRenderTarget(),Me=V.isInstancedMesh===!0,dt=V.isBatchedMesh===!0,it=!!_.map,St=!!_.matcap,U=!!D,di=!!_.aoMap,xt=!!_.lightMap,Mt=!!_.bumpMap,lt=!!_.normalMap,Zt=!!_.displacementMap,pt=!!_.emissiveMap,k=!!_.metalnessMap,T=!!_.roughnessMap,Q=_.anisotropy>0,ae=_.clearcoat>0,me=_.dispersion>0,de=_.iridescence>0,H=_.sheen>0,Y=_.transmission>0,le=Q&&!!_.anisotropyMap,ke=ae&&!!_.clearcoatMap,ue=ae&&!!_.clearcoatNormalMap,Ce=ae&&!!_.clearcoatRoughnessMap,Te=de&&!!_.iridescenceMap,Ze=de&&!!_.iridescenceThicknessMap,Pe=H&&!!_.sheenColorMap,wt=H&&!!_.sheenRoughnessMap,et=!!_.specularMap,Dt=!!_.specularColorMap,B=!!_.specularIntensityMap,De=Y&&!!_.transmissionMap,se=Y&&!!_.thicknessMap,pe=!!_.gradientMap,Le=!!_.alphaMap,Ne=_.alphaTest>0,Ft=!!_.alphaHash,Tn=!!_.extensions;let Qn=Yc;_.toneMapped&&(ze===null||ze.isXRRenderTarget===!0)&&(Qn=t.toneMapping);const Nt={shaderID:P,shaderType:_.type,shaderName:_.name,vertexShader:$,fragmentShader:K,defines:_.defines,customVertexShaderID:oe,customFragmentShaderID:he,isRawShaderMaterial:_.isRawShaderMaterial===!0,glslVersion:_.glslVersion,precision:f,batching:dt,batchingColor:dt&&V._colorsTexture!==null,instancing:Me,instancingColor:Me&&V.instanceColor!==null,instancingMorph:Me&&V.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:ze===null?t.outputColorSpace:ze.isXRRenderTarget===!0?ze.texture.colorSpace:qi,alphaToCoverage:!!_.alphaToCoverage,map:it,matcap:St,envMap:U,envMapMode:U&&D.mapping,envMapCubeUVHeight:ne,aoMap:di,lightMap:xt,bumpMap:Mt,normalMap:lt,displacementMap:p&&Zt,emissiveMap:pt,normalMapObjectSpace:lt&&_.normalMapType===pJ,normalMapTangentSpace:lt&&_.normalMapType===Yx,metalnessMap:k,roughnessMap:T,anisotropy:Q,anisotropyMap:le,clearcoat:ae,clearcoatMap:ke,clearcoatNormalMap:ue,clearcoatRoughnessMap:Ce,dispersion:me,iridescence:de,iridescenceMap:Te,iridescenceThicknessMap:Ze,sheen:H,sheenColorMap:Pe,sheenRoughnessMap:wt,specularMap:et,specularColorMap:Dt,specularIntensityMap:B,transmission:Y,transmissionMap:De,thicknessMap:se,gradientMap:pe,opaque:_.transparent===!1&&_.blending===ld&&_.alphaToCoverage===!1,alphaMap:Le,alphaTest:Ne,alphaHash:Ft,combine:_.combine,mapUv:it&&g(_.map.channel),aoMapUv:di&&g(_.aoMap.channel),lightMapUv:xt&&g(_.lightMap.channel),bumpMapUv:Mt&&g(_.bumpMap.channel),normalMapUv:lt&&g(_.normalMap.channel),displacementMapUv:Zt&&g(_.displacementMap.channel),emissiveMapUv:pt&&g(_.emissiveMap.channel),metalnessMapUv:k&&g(_.metalnessMap.channel),roughnessMapUv:T&&g(_.roughnessMap.channel),anisotropyMapUv:le&&g(_.anisotropyMap.channel),clearcoatMapUv:ke&&g(_.clearcoatMap.channel),clearcoatNormalMapUv:ue&&g(_.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ce&&g(_.clearcoatRoughnessMap.channel),iridescenceMapUv:Te&&g(_.iridescenceMap.channel),iridescenceThicknessMapUv:Ze&&g(_.iridescenceThicknessMap.channel),sheenColorMapUv:Pe&&g(_.sheenColorMap.channel),sheenRoughnessMapUv:wt&&g(_.sheenRoughnessMap.channel),specularMapUv:et&&g(_.specularMap.channel),specularColorMapUv:Dt&&g(_.specularColorMap.channel),specularIntensityMapUv:B&&g(_.specularIntensityMap.channel),transmissionMapUv:De&&g(_.transmissionMap.channel),thicknessMapUv:se&&g(_.thicknessMap.channel),alphaMapUv:Le&&g(_.alphaMap.channel),vertexTangents:!!G.attributes.tangent&&(lt||Q),vertexColors:_.vertexColors,vertexAlphas:_.vertexColors===!0&&!!G.attributes.color&&G.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!G.attributes.uv&&(it||Le),fog:!!X,useFog:_.fog===!0,fogExp2:!!X&&X.isFogExp2,flatShading:_.flatShading===!0,sizeAttenuation:_.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:d,skinning:V.isSkinnedMesh===!0,morphTargets:G.morphAttributes.position!==void 0,morphNormals:G.morphAttributes.normal!==void 0,morphColors:G.morphAttributes.color!==void 0,morphTargetsCount:ge,morphTextureStride:I,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:_.dithering,shadowMapEnabled:t.shadowMap.enabled&&L.length>0,shadowMapType:t.shadowMap.type,toneMapping:Qn,decodeVideoTexture:it&&_.map.isVideoTexture===!0&&Pt.getTransfer(_.map.colorSpace)===Pn,premultipliedAlpha:_.premultipliedAlpha,doubleSided:_.side===Zo,flipSided:_.side===br,useDepthPacking:_.depthPacking>=0,depthPacking:_.depthPacking||0,index0AttributeName:_.index0AttributeName,extensionClipCullDistance:Tn&&_.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Tn&&_.extensions.multiDraw===!0||dt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:_.customProgramCacheKey()};return Nt.vertexUv1s=l.has(1),Nt.vertexUv2s=l.has(2),Nt.vertexUv3s=l.has(3),l.clear(),Nt}function y(_){const R=[];if(_.shaderID?R.push(_.shaderID):(R.push(_.customVertexShaderID),R.push(_.customFragmentShaderID)),_.defines!==void 0)for(const L in _.defines)R.push(L),R.push(_.defines[L]);return _.isRawShaderMaterial===!1&&(S(R,_),x(R,_),R.push(t.outputColorSpace)),R.push(_.customProgramCacheKey),R.join()}function S(_,R){_.push(R.precision),_.push(R.outputColorSpace),_.push(R.envMapMode),_.push(R.envMapCubeUVHeight),_.push(R.mapUv),_.push(R.alphaMapUv),_.push(R.lightMapUv),_.push(R.aoMapUv),_.push(R.bumpMapUv),_.push(R.normalMapUv),_.push(R.displacementMapUv),_.push(R.emissiveMapUv),_.push(R.metalnessMapUv),_.push(R.roughnessMapUv),_.push(R.anisotropyMapUv),_.push(R.clearcoatMapUv),_.push(R.clearcoatNormalMapUv),_.push(R.clearcoatRoughnessMapUv),_.push(R.iridescenceMapUv),_.push(R.iridescenceThicknessMapUv),_.push(R.sheenColorMapUv),_.push(R.sheenRoughnessMapUv),_.push(R.specularMapUv),_.push(R.specularColorMapUv),_.push(R.specularIntensityMapUv),_.push(R.transmissionMapUv),_.push(R.thicknessMapUv),_.push(R.combine),_.push(R.fogExp2),_.push(R.sizeAttenuation),_.push(R.morphTargetsCount),_.push(R.morphAttributeCount),_.push(R.numDirLights),_.push(R.numPointLights),_.push(R.numSpotLights),_.push(R.numSpotLightMaps),_.push(R.numHemiLights),_.push(R.numRectAreaLights),_.push(R.numDirLightShadows),_.push(R.numPointLightShadows),_.push(R.numSpotLightShadows),_.push(R.numSpotLightShadowsWithMaps),_.push(R.numLightProbes),_.push(R.shadowMapType),_.push(R.toneMapping),_.push(R.numClippingPlanes),_.push(R.numClipIntersection),_.push(R.depthPacking)}function x(_,R){a.disableAll(),R.supportsVertexTextures&&a.enable(0),R.instancing&&a.enable(1),R.instancingColor&&a.enable(2),R.instancingMorph&&a.enable(3),R.matcap&&a.enable(4),R.envMap&&a.enable(5),R.normalMapObjectSpace&&a.enable(6),R.normalMapTangentSpace&&a.enable(7),R.clearcoat&&a.enable(8),R.iridescence&&a.enable(9),R.alphaTest&&a.enable(10),R.vertexColors&&a.enable(11),R.vertexAlphas&&a.enable(12),R.vertexUv1s&&a.enable(13),R.vertexUv2s&&a.enable(14),R.vertexUv3s&&a.enable(15),R.vertexTangents&&a.enable(16),R.anisotropy&&a.enable(17),R.alphaHash&&a.enable(18),R.batching&&a.enable(19),R.dispersion&&a.enable(20),R.batchingColor&&a.enable(21),_.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.reverseDepthBuffer&&a.enable(4),R.skinning&&a.enable(5),R.morphTargets&&a.enable(6),R.morphNormals&&a.enable(7),R.morphColors&&a.enable(8),R.premultipliedAlpha&&a.enable(9),R.shadowMapEnabled&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),R.decodeVideoTexture&&a.enable(19),R.alphaToCoverage&&a.enable(20),_.push(a.mask)}function w(_){const R=v[_.type];let L;if(R){const O=Yo[R];L=rQ.clone(O.uniforms)}else L=_.uniforms;return L}function C(_,R){let L;for(let O=0,V=u.length;O<V;O++){const X=u[O];if(X.cacheKey===R){L=X,++L.usedTimes;break}}return L===void 0&&(L=new vne(t,R,_,s),u.push(L)),L}function E(_){if(--_.usedTimes===0){const R=u.indexOf(_);u[R]=u[u.length-1],u.pop(),_.destroy()}}function b(_){c.remove(_)}function M(){c.dispose()}return{getParameters:m,getProgramCacheKey:y,getUniforms:w,acquireProgram:C,releaseProgram:E,releaseShaderCache:b,programs:u,dispose:M}}function _ne(){let t=new WeakMap;function e(o){return t.has(o)}function n(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function i(o){t.delete(o)}function r(o,a,c){t.get(o)[a]=c}function s(){t=new WeakMap}return{has:e,get:n,remove:i,update:r,dispose:s}}function wne(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function NL(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function OL(){const t=[];let e=0;const n=[],i=[],r=[];function s(){e=0,n.length=0,i.length=0,r.length=0}function o(h,d,p,f,v,g){let m=t[e];return m===void 0?(m={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:v,group:g},t[e]=m):(m.id=h.id,m.object=h,m.geometry=d,m.material=p,m.groupOrder=f,m.renderOrder=h.renderOrder,m.z=v,m.group=g),e++,m}function a(h,d,p,f,v,g){const m=o(h,d,p,f,v,g);p.transmission>0?i.push(m):p.transparent===!0?r.push(m):n.push(m)}function c(h,d,p,f,v,g){const m=o(h,d,p,f,v,g);p.transmission>0?i.unshift(m):p.transparent===!0?r.unshift(m):n.unshift(m)}function l(h,d){n.length>1&&n.sort(h||wne),i.length>1&&i.sort(d||NL),r.length>1&&r.sort(d||NL)}function u(){for(let h=e,d=t.length;h<d;h++){const p=t[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:n,transmissive:i,transparent:r,init:s,push:a,unshift:c,finish:u,sort:l}}function Ene(){let t=new WeakMap;function e(i,r){const s=t.get(i);let o;return s===void 0?(o=new OL,t.set(i,[o])):r>=s.length?(o=new OL,s.push(o)):o=s[r],o}function n(){t=new WeakMap}return{get:e,dispose:n}}function Rne(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new N,color:new Xe};break;case"SpotLight":n={position:new N,direction:new N,color:new Xe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new N,color:new Xe,distance:0,decay:0};break;case"HemisphereLight":n={direction:new N,skyColor:new Xe,groundColor:new Xe};break;case"RectAreaLight":n={color:new Xe,position:new N,halfWidth:new N,halfHeight:new N};break}return t[e.id]=n,n}}}function bne(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let Tne=0;function Ane(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Pne(t){const e=new Rne,n=bne(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)i.probe.push(new N);const r=new N,s=new Ge,o=new Ge;function a(l){let u=0,h=0,d=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let p=0,f=0,v=0,g=0,m=0,y=0,S=0,x=0,w=0,C=0,E=0;l.sort(Ane);for(let M=0,_=l.length;M<_;M++){const R=l[M],L=R.color,O=R.intensity,V=R.distance,X=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)u+=L.r*O,h+=L.g*O,d+=L.b*O;else if(R.isLightProbe){for(let G=0;G<9;G++)i.probe[G].addScaledVector(R.sh.coefficients[G],O);E++}else if(R.isDirectionalLight){const G=e.get(R);if(G.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const J=R.shadow,D=n.get(R);D.shadowIntensity=J.intensity,D.shadowBias=J.bias,D.shadowNormalBias=J.normalBias,D.shadowRadius=J.radius,D.shadowMapSize=J.mapSize,i.directionalShadow[p]=D,i.directionalShadowMap[p]=X,i.directionalShadowMatrix[p]=R.shadow.matrix,y++}i.directional[p]=G,p++}else if(R.isSpotLight){const G=e.get(R);G.position.setFromMatrixPosition(R.matrixWorld),G.color.copy(L).multiplyScalar(O),G.distance=V,G.coneCos=Math.cos(R.angle),G.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),G.decay=R.decay,i.spot[v]=G;const J=R.shadow;if(R.map&&(i.spotLightMap[w]=R.map,w++,J.updateMatrices(R),R.castShadow&&C++),i.spotLightMatrix[v]=J.matrix,R.castShadow){const D=n.get(R);D.shadowIntensity=J.intensity,D.shadowBias=J.bias,D.shadowNormalBias=J.normalBias,D.shadowRadius=J.radius,D.shadowMapSize=J.mapSize,i.spotShadow[v]=D,i.spotShadowMap[v]=X,x++}v++}else if(R.isRectAreaLight){const G=e.get(R);G.color.copy(L).multiplyScalar(O),G.halfWidth.set(R.width*.5,0,0),G.halfHeight.set(0,R.height*.5,0),i.rectArea[g]=G,g++}else if(R.isPointLight){const G=e.get(R);if(G.color.copy(R.color).multiplyScalar(R.intensity),G.distance=R.distance,G.decay=R.decay,R.castShadow){const J=R.shadow,D=n.get(R);D.shadowIntensity=J.intensity,D.shadowBias=J.bias,D.shadowNormalBias=J.normalBias,D.shadowRadius=J.radius,D.shadowMapSize=J.mapSize,D.shadowCameraNear=J.camera.near,D.shadowCameraFar=J.camera.far,i.pointShadow[f]=D,i.pointShadowMap[f]=X,i.pointShadowMatrix[f]=R.shadow.matrix,S++}i.point[f]=G,f++}else if(R.isHemisphereLight){const G=e.get(R);G.skyColor.copy(R.color).multiplyScalar(O),G.groundColor.copy(R.groundColor).multiplyScalar(O),i.hemi[m]=G,m++}}g>0&&(t.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ae.LTC_FLOAT_1,i.rectAreaLTC2=Ae.LTC_FLOAT_2):(i.rectAreaLTC1=Ae.LTC_HALF_1,i.rectAreaLTC2=Ae.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=h,i.ambient[2]=d;const b=i.hash;(b.directionalLength!==p||b.pointLength!==f||b.spotLength!==v||b.rectAreaLength!==g||b.hemiLength!==m||b.numDirectionalShadows!==y||b.numPointShadows!==S||b.numSpotShadows!==x||b.numSpotMaps!==w||b.numLightProbes!==E)&&(i.directional.length=p,i.spot.length=v,i.rectArea.length=g,i.point.length=f,i.hemi.length=m,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=S,i.pointShadowMap.length=S,i.spotShadow.length=x,i.spotShadowMap.length=x,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=S,i.spotLightMatrix.length=x+w-C,i.spotLightMap.length=w,i.numSpotLightShadowsWithMaps=C,i.numLightProbes=E,b.directionalLength=p,b.pointLength=f,b.spotLength=v,b.rectAreaLength=g,b.hemiLength=m,b.numDirectionalShadows=y,b.numPointShadows=S,b.numSpotShadows=x,b.numSpotMaps=w,b.numLightProbes=E,i.version=Tne++)}function c(l,u){let h=0,d=0,p=0,f=0,v=0;const g=u.matrixWorldInverse;for(let m=0,y=l.length;m<y;m++){const S=l[m];if(S.isDirectionalLight){const x=i.directional[h];x.direction.setFromMatrixPosition(S.matrixWorld),r.setFromMatrixPosition(S.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),h++}else if(S.isSpotLight){const x=i.spot[p];x.position.setFromMatrixPosition(S.matrixWorld),x.position.applyMatrix4(g),x.direction.setFromMatrixPosition(S.matrixWorld),r.setFromMatrixPosition(S.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),p++}else if(S.isRectAreaLight){const x=i.rectArea[f];x.position.setFromMatrixPosition(S.matrixWorld),x.position.applyMatrix4(g),o.identity(),s.copy(S.matrixWorld),s.premultiply(g),o.extractRotation(s),x.halfWidth.set(S.width*.5,0,0),x.halfHeight.set(0,S.height*.5,0),x.halfWidth.applyMatrix4(o),x.halfHeight.applyMatrix4(o),f++}else if(S.isPointLight){const x=i.point[d];x.position.setFromMatrixPosition(S.matrixWorld),x.position.applyMatrix4(g),d++}else if(S.isHemisphereLight){const x=i.hemi[v];x.direction.setFromMatrixPosition(S.matrixWorld),x.direction.transformDirection(g),v++}}}return{setup:a,setupView:c,state:i}}function FL(t){const e=new Pne(t),n=[],i=[];function r(u){l.camera=u,n.length=0,i.length=0}function s(u){n.push(u)}function o(u){i.push(u)}function a(){e.setup(n)}function c(u){e.setupView(n,u)}const l={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function Ine(t){let e=new WeakMap;function n(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new FL(t),e.set(r,[a])):s>=o.length?(a=new FL(t),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:n,dispose:i}}class Mne extends qs{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=hJ,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class kne extends qs{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Lne=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Dne=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Nne(t,e,n){let i=new Y2;const r=new gt,s=new gt,o=new Gt,a=new Mne({depthPacking:dJ}),c=new kne,l={},u=n.maxTextureSize,h={[Ka]:br,[br]:Ka,[Zo]:Zo},d=new ol({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new gt},radius:{value:4}},vertexShader:Lne,fragmentShader:Dne}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new ys;f.setAttribute("position",new Tr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new gn(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PB;let m=this.type;this.render=function(C,E,b){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||C.length===0)return;const M=t.getRenderTarget(),_=t.getActiveCubeFace(),R=t.getActiveMipmapLevel(),L=t.state;L.setBlending(Kc),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);const O=m!==Aa&&this.type===Aa,V=m===Aa&&this.type!==Aa;for(let X=0,G=C.length;X<G;X++){const J=C[X],D=J.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",J,"has no shadow.");continue}if(D.autoUpdate===!1&&D.needsUpdate===!1)continue;r.copy(D.mapSize);const ne=D.getFrameExtents();if(r.multiply(ne),s.copy(D.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/ne.x),r.x=s.x*ne.x,D.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/ne.y),r.y=s.y*ne.y,D.mapSize.y=s.y)),D.map===null||O===!0||V===!0){const ee=this.type!==Aa?{minFilter:Er,magFilter:Er}:{};D.map!==null&&D.map.dispose(),D.map=new Mu(r.x,r.y,ee),D.map.texture.name=J.name+".shadowMap",D.camera.updateProjectionMatrix()}t.setRenderTarget(D.map),t.clear();const P=D.getViewportCount();for(let ee=0;ee<P;ee++){const ge=D.getViewport(ee);o.set(s.x*ge.x,s.y*ge.y,s.x*ge.z,s.y*ge.w),L.viewport(o),D.updateMatrices(J,ee),i=D.getFrustum(),x(E,b,D.camera,J,this.type)}D.isPointLightShadow!==!0&&this.type===Aa&&y(D,b),D.needsUpdate=!1}m=this.type,g.needsUpdate=!1,t.setRenderTarget(M,_,R)};function y(C,E){const b=e.update(v);d.defines.VSM_SAMPLES!==C.blurSamples&&(d.defines.VSM_SAMPLES=C.blurSamples,p.defines.VSM_SAMPLES=C.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new Mu(r.x,r.y)),d.uniforms.shadow_pass.value=C.map.texture,d.uniforms.resolution.value=C.mapSize,d.uniforms.radius.value=C.radius,t.setRenderTarget(C.mapPass),t.clear(),t.renderBufferDirect(E,null,b,d,v,null),p.uniforms.shadow_pass.value=C.mapPass.texture,p.uniforms.resolution.value=C.mapSize,p.uniforms.radius.value=C.radius,t.setRenderTarget(C.map),t.clear(),t.renderBufferDirect(E,null,b,p,v,null)}function S(C,E,b,M){let _=null;const R=b.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(R!==void 0)_=R;else if(_=b.isPointLight===!0?c:a,t.localClippingEnabled&&E.clipShadows===!0&&Array.isArray(E.clippingPlanes)&&E.clippingPlanes.length!==0||E.displacementMap&&E.displacementScale!==0||E.alphaMap&&E.alphaTest>0||E.map&&E.alphaTest>0){const L=_.uuid,O=E.uuid;let V=l[L];V===void 0&&(V={},l[L]=V);let X=V[O];X===void 0&&(X=_.clone(),V[O]=X,E.addEventListener("dispose",w)),_=X}if(_.visible=E.visible,_.wireframe=E.wireframe,M===Aa?_.side=E.shadowSide!==null?E.shadowSide:E.side:_.side=E.shadowSide!==null?E.shadowSide:h[E.side],_.alphaMap=E.alphaMap,_.alphaTest=E.alphaTest,_.map=E.map,_.clipShadows=E.clipShadows,_.clippingPlanes=E.clippingPlanes,_.clipIntersection=E.clipIntersection,_.displacementMap=E.displacementMap,_.displacementScale=E.displacementScale,_.displacementBias=E.displacementBias,_.wireframeLinewidth=E.wireframeLinewidth,_.linewidth=E.linewidth,b.isPointLight===!0&&_.isMeshDistanceMaterial===!0){const L=t.properties.get(_);L.light=b}return _}function x(C,E,b,M,_){if(C.visible===!1)return;if(C.layers.test(E.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&_===Aa)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,C.matrixWorld);const O=e.update(C),V=C.material;if(Array.isArray(V)){const X=O.groups;for(let G=0,J=X.length;G<J;G++){const D=X[G],ne=V[D.materialIndex];if(ne&&ne.visible){const P=S(C,ne,M,_);C.onBeforeShadow(t,C,E,b,O,P,D),t.renderBufferDirect(b,null,O,P,C,D),C.onAfterShadow(t,C,E,b,O,P,D)}}}else if(V.visible){const X=S(C,V,M,_);C.onBeforeShadow(t,C,E,b,O,X,null),t.renderBufferDirect(b,null,O,X,C,null),C.onAfterShadow(t,C,E,b,O,X,null)}}const L=C.children;for(let O=0,V=L.length;O<V;O++)x(L[O],E,b,M,_)}function w(C){C.target.removeEventListener("dispose",w);for(const b in l){const M=l[b],_=C.target.uuid;_ in M&&(M[_].dispose(),delete M[_])}}}const One={[SR]:xR,[CR]:ER,[_R]:RR,[kd]:wR,[xR]:SR,[ER]:CR,[RR]:_R,[wR]:kd};function Fne(t){function e(){let B=!1;const De=new Gt;let se=null;const pe=new Gt(0,0,0,0);return{setMask:function(Le){se!==Le&&!B&&(t.colorMask(Le,Le,Le,Le),se=Le)},setLocked:function(Le){B=Le},setClear:function(Le,Ne,Ft,Tn,Qn){Qn===!0&&(Le*=Tn,Ne*=Tn,Ft*=Tn),De.set(Le,Ne,Ft,Tn),pe.equals(De)===!1&&(t.clearColor(Le,Ne,Ft,Tn),pe.copy(De))},reset:function(){B=!1,se=null,pe.set(-1,0,0,0)}}}function n(){let B=!1,De=!1,se=null,pe=null,Le=null;return{setReversed:function(Ne){De=Ne},setTest:function(Ne){Ne?oe(t.DEPTH_TEST):he(t.DEPTH_TEST)},setMask:function(Ne){se!==Ne&&!B&&(t.depthMask(Ne),se=Ne)},setFunc:function(Ne){if(De&&(Ne=One[Ne]),pe!==Ne){switch(Ne){case SR:t.depthFunc(t.NEVER);break;case xR:t.depthFunc(t.ALWAYS);break;case CR:t.depthFunc(t.LESS);break;case kd:t.depthFunc(t.LEQUAL);break;case _R:t.depthFunc(t.EQUAL);break;case wR:t.depthFunc(t.GEQUAL);break;case ER:t.depthFunc(t.GREATER);break;case RR:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}pe=Ne}},setLocked:function(Ne){B=Ne},setClear:function(Ne){Le!==Ne&&(t.clearDepth(Ne),Le=Ne)},reset:function(){B=!1,se=null,pe=null,Le=null}}}function i(){let B=!1,De=null,se=null,pe=null,Le=null,Ne=null,Ft=null,Tn=null,Qn=null;return{setTest:function(Nt){B||(Nt?oe(t.STENCIL_TEST):he(t.STENCIL_TEST))},setMask:function(Nt){De!==Nt&&!B&&(t.stencilMask(Nt),De=Nt)},setFunc:function(Nt,bi,es){(se!==Nt||pe!==bi||Le!==es)&&(t.stencilFunc(Nt,bi,es),se=Nt,pe=bi,Le=es)},setOp:function(Nt,bi,es){(Ne!==Nt||Ft!==bi||Tn!==es)&&(t.stencilOp(Nt,bi,es),Ne=Nt,Ft=bi,Tn=es)},setLocked:function(Nt){B=Nt},setClear:function(Nt){Qn!==Nt&&(t.clearStencil(Nt),Qn=Nt)},reset:function(){B=!1,De=null,se=null,pe=null,Le=null,Ne=null,Ft=null,Tn=null,Qn=null}}}const r=new e,s=new n,o=new i,a=new WeakMap,c=new WeakMap;let l={},u={},h=new WeakMap,d=[],p=null,f=!1,v=null,g=null,m=null,y=null,S=null,x=null,w=null,C=new Xe(0,0,0),E=0,b=!1,M=null,_=null,R=null,L=null,O=null;const V=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,G=0;const J=t.getParameter(t.VERSION);J.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(J)[1]),X=G>=1):J.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),X=G>=2);let D=null,ne={};const P=t.getParameter(t.SCISSOR_BOX),ee=t.getParameter(t.VIEWPORT),ge=new Gt().fromArray(P),I=new Gt().fromArray(ee);function $(B,De,se,pe){const Le=new Uint8Array(4),Ne=t.createTexture();t.bindTexture(B,Ne),t.texParameteri(B,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(B,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Ft=0;Ft<se;Ft++)B===t.TEXTURE_3D||B===t.TEXTURE_2D_ARRAY?t.texImage3D(De,0,t.RGBA,1,1,pe,0,t.RGBA,t.UNSIGNED_BYTE,Le):t.texImage2D(De+Ft,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Le);return Ne}const K={};K[t.TEXTURE_2D]=$(t.TEXTURE_2D,t.TEXTURE_2D,1),K[t.TEXTURE_CUBE_MAP]=$(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),K[t.TEXTURE_2D_ARRAY]=$(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),K[t.TEXTURE_3D]=$(t.TEXTURE_3D,t.TEXTURE_3D,1,1),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),oe(t.DEPTH_TEST),s.setFunc(kd),xt(!1),Mt(Wk),oe(t.CULL_FACE),U(Kc);function oe(B){l[B]!==!0&&(t.enable(B),l[B]=!0)}function he(B){l[B]!==!1&&(t.disable(B),l[B]=!1)}function ze(B,De){return u[B]!==De?(t.bindFramebuffer(B,De),u[B]=De,B===t.DRAW_FRAMEBUFFER&&(u[t.FRAMEBUFFER]=De),B===t.FRAMEBUFFER&&(u[t.DRAW_FRAMEBUFFER]=De),!0):!1}function Me(B,De){let se=d,pe=!1;if(B){se=h.get(De),se===void 0&&(se=[],h.set(De,se));const Le=B.textures;if(se.length!==Le.length||se[0]!==t.COLOR_ATTACHMENT0){for(let Ne=0,Ft=Le.length;Ne<Ft;Ne++)se[Ne]=t.COLOR_ATTACHMENT0+Ne;se.length=Le.length,pe=!0}}else se[0]!==t.BACK&&(se[0]=t.BACK,pe=!0);pe&&t.drawBuffers(se)}function dt(B){return p!==B?(t.useProgram(B),p=B,!0):!1}const it={[tu]:t.FUNC_ADD,[NY]:t.FUNC_SUBTRACT,[OY]:t.FUNC_REVERSE_SUBTRACT};it[FY]=t.MIN,it[zY]=t.MAX;const St={[UY]:t.ZERO,[BY]:t.ONE,[$Y]:t.SRC_COLOR,[vR]:t.SRC_ALPHA,[qY]:t.SRC_ALPHA_SATURATE,[WY]:t.DST_COLOR,[VY]:t.DST_ALPHA,[HY]:t.ONE_MINUS_SRC_COLOR,[yR]:t.ONE_MINUS_SRC_ALPHA,[GY]:t.ONE_MINUS_DST_COLOR,[jY]:t.ONE_MINUS_DST_ALPHA,[XY]:t.CONSTANT_COLOR,[KY]:t.ONE_MINUS_CONSTANT_COLOR,[YY]:t.CONSTANT_ALPHA,[JY]:t.ONE_MINUS_CONSTANT_ALPHA};function U(B,De,se,pe,Le,Ne,Ft,Tn,Qn,Nt){if(B===Kc){f===!0&&(he(t.BLEND),f=!1);return}if(f===!1&&(oe(t.BLEND),f=!0),B!==DY){if(B!==v||Nt!==b){if((g!==tu||S!==tu)&&(t.blendEquation(t.FUNC_ADD),g=tu,S=tu),Nt)switch(B){case ld:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Gk:t.blendFunc(t.ONE,t.ONE);break;case qk:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Xk:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",B);break}else switch(B){case ld:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Gk:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case qk:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Xk:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",B);break}m=null,y=null,x=null,w=null,C.set(0,0,0),E=0,v=B,b=Nt}return}Le=Le||De,Ne=Ne||se,Ft=Ft||pe,(De!==g||Le!==S)&&(t.blendEquationSeparate(it[De],it[Le]),g=De,S=Le),(se!==m||pe!==y||Ne!==x||Ft!==w)&&(t.blendFuncSeparate(St[se],St[pe],St[Ne],St[Ft]),m=se,y=pe,x=Ne,w=Ft),(Tn.equals(C)===!1||Qn!==E)&&(t.blendColor(Tn.r,Tn.g,Tn.b,Qn),C.copy(Tn),E=Qn),v=B,b=!1}function di(B,De){B.side===Zo?he(t.CULL_FACE):oe(t.CULL_FACE);let se=B.side===br;De&&(se=!se),xt(se),B.blending===ld&&B.transparent===!1?U(Kc):U(B.blending,B.blendEquation,B.blendSrc,B.blendDst,B.blendEquationAlpha,B.blendSrcAlpha,B.blendDstAlpha,B.blendColor,B.blendAlpha,B.premultipliedAlpha),s.setFunc(B.depthFunc),s.setTest(B.depthTest),s.setMask(B.depthWrite),r.setMask(B.colorWrite);const pe=B.stencilWrite;o.setTest(pe),pe&&(o.setMask(B.stencilWriteMask),o.setFunc(B.stencilFunc,B.stencilRef,B.stencilFuncMask),o.setOp(B.stencilFail,B.stencilZFail,B.stencilZPass)),Zt(B.polygonOffset,B.polygonOffsetFactor,B.polygonOffsetUnits),B.alphaToCoverage===!0?oe(t.SAMPLE_ALPHA_TO_COVERAGE):he(t.SAMPLE_ALPHA_TO_COVERAGE)}function xt(B){M!==B&&(B?t.frontFace(t.CW):t.frontFace(t.CCW),M=B)}function Mt(B){B!==MY?(oe(t.CULL_FACE),B!==_&&(B===Wk?t.cullFace(t.BACK):B===kY?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):he(t.CULL_FACE),_=B}function lt(B){B!==R&&(X&&t.lineWidth(B),R=B)}function Zt(B,De,se){B?(oe(t.POLYGON_OFFSET_FILL),(L!==De||O!==se)&&(t.polygonOffset(De,se),L=De,O=se)):he(t.POLYGON_OFFSET_FILL)}function pt(B){B?oe(t.SCISSOR_TEST):he(t.SCISSOR_TEST)}function k(B){B===void 0&&(B=t.TEXTURE0+V-1),D!==B&&(t.activeTexture(B),D=B)}function T(B,De,se){se===void 0&&(D===null?se=t.TEXTURE0+V-1:se=D);let pe=ne[se];pe===void 0&&(pe={type:void 0,texture:void 0},ne[se]=pe),(pe.type!==B||pe.texture!==De)&&(D!==se&&(t.activeTexture(se),D=se),t.bindTexture(B,De||K[B]),pe.type=B,pe.texture=De)}function Q(){const B=ne[D];B!==void 0&&B.type!==void 0&&(t.bindTexture(B.type,null),B.type=void 0,B.texture=void 0)}function ae(){try{t.compressedTexImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function me(){try{t.compressedTexImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function de(){try{t.texSubImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function H(){try{t.texSubImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Y(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function le(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function ke(){try{t.texStorage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function ue(){try{t.texStorage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Ce(){try{t.texImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Te(){try{t.texImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Ze(B){ge.equals(B)===!1&&(t.scissor(B.x,B.y,B.z,B.w),ge.copy(B))}function Pe(B){I.equals(B)===!1&&(t.viewport(B.x,B.y,B.z,B.w),I.copy(B))}function wt(B,De){let se=c.get(De);se===void 0&&(se=new WeakMap,c.set(De,se));let pe=se.get(B);pe===void 0&&(pe=t.getUniformBlockIndex(De,B.name),se.set(B,pe))}function et(B,De){const pe=c.get(De).get(B);a.get(De)!==pe&&(t.uniformBlockBinding(De,pe,B.__bindingPointIndex),a.set(De,pe))}function Dt(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),l={},D=null,ne={},u={},h=new WeakMap,d=[],p=null,f=!1,v=null,g=null,m=null,y=null,S=null,x=null,w=null,C=new Xe(0,0,0),E=0,b=!1,M=null,_=null,R=null,L=null,O=null,ge.set(0,0,t.canvas.width,t.canvas.height),I.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),o.reset()}return{buffers:{color:r,depth:s,stencil:o},enable:oe,disable:he,bindFramebuffer:ze,drawBuffers:Me,useProgram:dt,setBlending:U,setMaterial:di,setFlipSided:xt,setCullFace:Mt,setLineWidth:lt,setPolygonOffset:Zt,setScissorTest:pt,activeTexture:k,bindTexture:T,unbindTexture:Q,compressedTexImage2D:ae,compressedTexImage3D:me,texImage2D:Ce,texImage3D:Te,updateUBOMapping:wt,uniformBlockBinding:et,texStorage2D:ke,texStorage3D:ue,texSubImage2D:de,texSubImage3D:H,compressedTexSubImage2D:Y,compressedTexSubImage3D:le,scissor:Ze,viewport:Pe,reset:Dt}}function zL(t,e,n,i){const r=zne(i);switch(n){case OB:return t*e;case zB:return t*e;case UB:return t*e*2;case $2:return t*e/r.components*r.byteLength;case H2:return t*e/r.components*r.byteLength;case BB:return t*e*2/r.components*r.byteLength;case V2:return t*e*2/r.components*r.byteLength;case FB:return t*e*3/r.components*r.byteLength;case Bs:return t*e*4/r.components*r.byteLength;case j2:return t*e*4/r.components*r.byteLength;case Ly:case Dy:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Ny:case Oy:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case AR:case IR:return Math.max(t,16)*Math.max(e,8)/4;case TR:case PR:return Math.max(t,8)*Math.max(e,8)/2;case MR:case kR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case LR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case DR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case NR:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case OR:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case FR:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case zR:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case UR:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case BR:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case $R:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case HR:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case VR:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case jR:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case WR:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case GR:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case qR:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case Fy:case XR:case KR:return Math.ceil(t/4)*Math.ceil(e/4)*16;case $B:case YR:return Math.ceil(t/4)*Math.ceil(e/4)*8;case JR:case QR:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function zne(t){switch(t){case Ya:case LB:return{byteLength:1,components:1};case Kg:case DB:case D0:return{byteLength:2,components:1};case U2:case B2:return{byteLength:2,components:4};case Iu:case z2:case Ro:return{byteLength:4,components:1};case NB:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}function Une(t,e,n,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new gt,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(k,T){return p?new OffscreenCanvas(k,T):Qg("canvas")}function v(k,T,Q){let ae=1;const me=pt(k);if((me.width>Q||me.height>Q)&&(ae=Q/Math.max(me.width,me.height)),ae<1)if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap||typeof VideoFrame<"u"&&k instanceof VideoFrame){const de=Math.floor(ae*me.width),H=Math.floor(ae*me.height);h===void 0&&(h=f(de,H));const Y=T?f(de,H):h;return Y.width=de,Y.height=H,Y.getContext("2d").drawImage(k,0,0,de,H),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+me.width+"x"+me.height+") to ("+de+"x"+H+")."),Y}else return"data"in k&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+me.width+"x"+me.height+")."),k;return k}function g(k){return k.generateMipmaps&&k.minFilter!==Er&&k.minFilter!==ds}function m(k){t.generateMipmap(k)}function y(k,T,Q,ae,me=!1){if(k!==null){if(t[k]!==void 0)return t[k];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+k+"'")}let de=T;if(T===t.RED&&(Q===t.FLOAT&&(de=t.R32F),Q===t.HALF_FLOAT&&(de=t.R16F),Q===t.UNSIGNED_BYTE&&(de=t.R8)),T===t.RED_INTEGER&&(Q===t.UNSIGNED_BYTE&&(de=t.R8UI),Q===t.UNSIGNED_SHORT&&(de=t.R16UI),Q===t.UNSIGNED_INT&&(de=t.R32UI),Q===t.BYTE&&(de=t.R8I),Q===t.SHORT&&(de=t.R16I),Q===t.INT&&(de=t.R32I)),T===t.RG&&(Q===t.FLOAT&&(de=t.RG32F),Q===t.HALF_FLOAT&&(de=t.RG16F),Q===t.UNSIGNED_BYTE&&(de=t.RG8)),T===t.RG_INTEGER&&(Q===t.UNSIGNED_BYTE&&(de=t.RG8UI),Q===t.UNSIGNED_SHORT&&(de=t.RG16UI),Q===t.UNSIGNED_INT&&(de=t.RG32UI),Q===t.BYTE&&(de=t.RG8I),Q===t.SHORT&&(de=t.RG16I),Q===t.INT&&(de=t.RG32I)),T===t.RGB_INTEGER&&(Q===t.UNSIGNED_BYTE&&(de=t.RGB8UI),Q===t.UNSIGNED_SHORT&&(de=t.RGB16UI),Q===t.UNSIGNED_INT&&(de=t.RGB32UI),Q===t.BYTE&&(de=t.RGB8I),Q===t.SHORT&&(de=t.RGB16I),Q===t.INT&&(de=t.RGB32I)),T===t.RGBA_INTEGER&&(Q===t.UNSIGNED_BYTE&&(de=t.RGBA8UI),Q===t.UNSIGNED_SHORT&&(de=t.RGBA16UI),Q===t.UNSIGNED_INT&&(de=t.RGBA32UI),Q===t.BYTE&&(de=t.RGBA8I),Q===t.SHORT&&(de=t.RGBA16I),Q===t.INT&&(de=t.RGBA32I)),T===t.RGB&&Q===t.UNSIGNED_INT_5_9_9_9_REV&&(de=t.RGB9_E5),T===t.RGBA){const H=me?T1:Pt.getTransfer(ae);Q===t.FLOAT&&(de=t.RGBA32F),Q===t.HALF_FLOAT&&(de=t.RGBA16F),Q===t.UNSIGNED_BYTE&&(de=H===Pn?t.SRGB8_ALPHA8:t.RGBA8),Q===t.UNSIGNED_SHORT_4_4_4_4&&(de=t.RGBA4),Q===t.UNSIGNED_SHORT_5_5_5_1&&(de=t.RGB5_A1)}return(de===t.R16F||de===t.R32F||de===t.RG16F||de===t.RG32F||de===t.RGBA16F||de===t.RGBA32F)&&e.get("EXT_color_buffer_float"),de}function S(k,T){let Q;return k?T===null||T===Iu||T===Nd?Q=t.DEPTH24_STENCIL8:T===Ro?Q=t.DEPTH32F_STENCIL8:T===Kg&&(Q=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):T===null||T===Iu||T===Nd?Q=t.DEPTH_COMPONENT24:T===Ro?Q=t.DEPTH_COMPONENT32F:T===Kg&&(Q=t.DEPTH_COMPONENT16),Q}function x(k,T){return g(k)===!0||k.isFramebufferTexture&&k.minFilter!==Er&&k.minFilter!==ds?Math.log2(Math.max(T.width,T.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?T.mipmaps.length:1}function w(k){const T=k.target;T.removeEventListener("dispose",w),E(T),T.isVideoTexture&&u.delete(T)}function C(k){const T=k.target;T.removeEventListener("dispose",C),M(T)}function E(k){const T=i.get(k);if(T.__webglInit===void 0)return;const Q=k.source,ae=d.get(Q);if(ae){const me=ae[T.__cacheKey];me.usedTimes--,me.usedTimes===0&&b(k),Object.keys(ae).length===0&&d.delete(Q)}i.remove(k)}function b(k){const T=i.get(k);t.deleteTexture(T.__webglTexture);const Q=k.source,ae=d.get(Q);delete ae[T.__cacheKey],o.memory.textures--}function M(k){const T=i.get(k);if(k.depthTexture&&k.depthTexture.dispose(),k.isWebGLCubeRenderTarget)for(let ae=0;ae<6;ae++){if(Array.isArray(T.__webglFramebuffer[ae]))for(let me=0;me<T.__webglFramebuffer[ae].length;me++)t.deleteFramebuffer(T.__webglFramebuffer[ae][me]);else t.deleteFramebuffer(T.__webglFramebuffer[ae]);T.__webglDepthbuffer&&t.deleteRenderbuffer(T.__webglDepthbuffer[ae])}else{if(Array.isArray(T.__webglFramebuffer))for(let ae=0;ae<T.__webglFramebuffer.length;ae++)t.deleteFramebuffer(T.__webglFramebuffer[ae]);else t.deleteFramebuffer(T.__webglFramebuffer);if(T.__webglDepthbuffer&&t.deleteRenderbuffer(T.__webglDepthbuffer),T.__webglMultisampledFramebuffer&&t.deleteFramebuffer(T.__webglMultisampledFramebuffer),T.__webglColorRenderbuffer)for(let ae=0;ae<T.__webglColorRenderbuffer.length;ae++)T.__webglColorRenderbuffer[ae]&&t.deleteRenderbuffer(T.__webglColorRenderbuffer[ae]);T.__webglDepthRenderbuffer&&t.deleteRenderbuffer(T.__webglDepthRenderbuffer)}const Q=k.textures;for(let ae=0,me=Q.length;ae<me;ae++){const de=i.get(Q[ae]);de.__webglTexture&&(t.deleteTexture(de.__webglTexture),o.memory.textures--),i.remove(Q[ae])}i.remove(k)}let _=0;function R(){_=0}function L(){const k=_;return k>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+k+" texture units while this GPU supports only "+r.maxTextures),_+=1,k}function O(k){const T=[];return T.push(k.wrapS),T.push(k.wrapT),T.push(k.wrapR||0),T.push(k.magFilter),T.push(k.minFilter),T.push(k.anisotropy),T.push(k.internalFormat),T.push(k.format),T.push(k.type),T.push(k.generateMipmaps),T.push(k.premultiplyAlpha),T.push(k.flipY),T.push(k.unpackAlignment),T.push(k.colorSpace),T.join()}function V(k,T){const Q=i.get(k);if(k.isVideoTexture&&lt(k),k.isRenderTargetTexture===!1&&k.version>0&&Q.__version!==k.version){const ae=k.image;if(ae===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ae.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{I(Q,k,T);return}}n.bindTexture(t.TEXTURE_2D,Q.__webglTexture,t.TEXTURE0+T)}function X(k,T){const Q=i.get(k);if(k.version>0&&Q.__version!==k.version){I(Q,k,T);return}n.bindTexture(t.TEXTURE_2D_ARRAY,Q.__webglTexture,t.TEXTURE0+T)}function G(k,T){const Q=i.get(k);if(k.version>0&&Q.__version!==k.version){I(Q,k,T);return}n.bindTexture(t.TEXTURE_3D,Q.__webglTexture,t.TEXTURE0+T)}function J(k,T){const Q=i.get(k);if(k.version>0&&Q.__version!==k.version){$(Q,k,T);return}n.bindTexture(t.TEXTURE_CUBE_MAP,Q.__webglTexture,t.TEXTURE0+T)}const D={[sl]:t.REPEAT,[na]:t.CLAMP_TO_EDGE,[R1]:t.MIRRORED_REPEAT},ne={[Er]:t.NEAREST,[kB]:t.NEAREST_MIPMAP_NEAREST,[eg]:t.NEAREST_MIPMAP_LINEAR,[ds]:t.LINEAR,[ky]:t.LINEAR_MIPMAP_NEAREST,[za]:t.LINEAR_MIPMAP_LINEAR},P={[fJ]:t.NEVER,[xJ]:t.ALWAYS,[mJ]:t.LESS,[jB]:t.LEQUAL,[gJ]:t.EQUAL,[SJ]:t.GEQUAL,[vJ]:t.GREATER,[yJ]:t.NOTEQUAL};function ee(k,T){if(T.type===Ro&&e.has("OES_texture_float_linear")===!1&&(T.magFilter===ds||T.magFilter===ky||T.magFilter===eg||T.magFilter===za||T.minFilter===ds||T.minFilter===ky||T.minFilter===eg||T.minFilter===za)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(k,t.TEXTURE_WRAP_S,D[T.wrapS]),t.texParameteri(k,t.TEXTURE_WRAP_T,D[T.wrapT]),(k===t.TEXTURE_3D||k===t.TEXTURE_2D_ARRAY)&&t.texParameteri(k,t.TEXTURE_WRAP_R,D[T.wrapR]),t.texParameteri(k,t.TEXTURE_MAG_FILTER,ne[T.magFilter]),t.texParameteri(k,t.TEXTURE_MIN_FILTER,ne[T.minFilter]),T.compareFunction&&(t.texParameteri(k,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(k,t.TEXTURE_COMPARE_FUNC,P[T.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(T.magFilter===Er||T.minFilter!==eg&&T.minFilter!==za||T.type===Ro&&e.has("OES_texture_float_linear")===!1)return;if(T.anisotropy>1||i.get(T).__currentAnisotropy){const Q=e.get("EXT_texture_filter_anisotropic");t.texParameterf(k,Q.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(T.anisotropy,r.getMaxAnisotropy())),i.get(T).__currentAnisotropy=T.anisotropy}}}function ge(k,T){let Q=!1;k.__webglInit===void 0&&(k.__webglInit=!0,T.addEventListener("dispose",w));const ae=T.source;let me=d.get(ae);me===void 0&&(me={},d.set(ae,me));const de=O(T);if(de!==k.__cacheKey){me[de]===void 0&&(me[de]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,Q=!0),me[de].usedTimes++;const H=me[k.__cacheKey];H!==void 0&&(me[k.__cacheKey].usedTimes--,H.usedTimes===0&&b(T)),k.__cacheKey=de,k.__webglTexture=me[de].texture}return Q}function I(k,T,Q){let ae=t.TEXTURE_2D;(T.isDataArrayTexture||T.isCompressedArrayTexture)&&(ae=t.TEXTURE_2D_ARRAY),T.isData3DTexture&&(ae=t.TEXTURE_3D);const me=ge(k,T),de=T.source;n.bindTexture(ae,k.__webglTexture,t.TEXTURE0+Q);const H=i.get(de);if(de.version!==H.__version||me===!0){n.activeTexture(t.TEXTURE0+Q);const Y=Pt.getPrimaries(Pt.workingColorSpace),le=T.colorSpace===Pc?null:Pt.getPrimaries(T.colorSpace),ke=T.colorSpace===Pc||Y===le?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,T.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,T.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,ke);let ue=v(T.image,!1,r.maxTextureSize);ue=Zt(T,ue);const Ce=s.convert(T.format,T.colorSpace),Te=s.convert(T.type);let Ze=y(T.internalFormat,Ce,Te,T.colorSpace,T.isVideoTexture);ee(ae,T);let Pe;const wt=T.mipmaps,et=T.isVideoTexture!==!0,Dt=H.__version===void 0||me===!0,B=de.dataReady,De=x(T,ue);if(T.isDepthTexture)Ze=S(T.format===Od,T.type),Dt&&(et?n.texStorage2D(t.TEXTURE_2D,1,Ze,ue.width,ue.height):n.texImage2D(t.TEXTURE_2D,0,Ze,ue.width,ue.height,0,Ce,Te,null));else if(T.isDataTexture)if(wt.length>0){et&&Dt&&n.texStorage2D(t.TEXTURE_2D,De,Ze,wt[0].width,wt[0].height);for(let se=0,pe=wt.length;se<pe;se++)Pe=wt[se],et?B&&n.texSubImage2D(t.TEXTURE_2D,se,0,0,Pe.width,Pe.height,Ce,Te,Pe.data):n.texImage2D(t.TEXTURE_2D,se,Ze,Pe.width,Pe.height,0,Ce,Te,Pe.data);T.generateMipmaps=!1}else et?(Dt&&n.texStorage2D(t.TEXTURE_2D,De,Ze,ue.width,ue.height),B&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,ue.width,ue.height,Ce,Te,ue.data)):n.texImage2D(t.TEXTURE_2D,0,Ze,ue.width,ue.height,0,Ce,Te,ue.data);else if(T.isCompressedTexture)if(T.isCompressedArrayTexture){et&&Dt&&n.texStorage3D(t.TEXTURE_2D_ARRAY,De,Ze,wt[0].width,wt[0].height,ue.depth);for(let se=0,pe=wt.length;se<pe;se++)if(Pe=wt[se],T.format!==Bs)if(Ce!==null)if(et){if(B)if(T.layerUpdates.size>0){const Le=zL(Pe.width,Pe.height,T.format,T.type);for(const Ne of T.layerUpdates){const Ft=Pe.data.subarray(Ne*Le/Pe.data.BYTES_PER_ELEMENT,(Ne+1)*Le/Pe.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,se,0,0,Ne,Pe.width,Pe.height,1,Ce,Ft,0,0)}T.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,se,0,0,0,Pe.width,Pe.height,ue.depth,Ce,Pe.data,0,0)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,se,Ze,Pe.width,Pe.height,ue.depth,0,Pe.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else et?B&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,se,0,0,0,Pe.width,Pe.height,ue.depth,Ce,Te,Pe.data):n.texImage3D(t.TEXTURE_2D_ARRAY,se,Ze,Pe.width,Pe.height,ue.depth,0,Ce,Te,Pe.data)}else{et&&Dt&&n.texStorage2D(t.TEXTURE_2D,De,Ze,wt[0].width,wt[0].height);for(let se=0,pe=wt.length;se<pe;se++)Pe=wt[se],T.format!==Bs?Ce!==null?et?B&&n.compressedTexSubImage2D(t.TEXTURE_2D,se,0,0,Pe.width,Pe.height,Ce,Pe.data):n.compressedTexImage2D(t.TEXTURE_2D,se,Ze,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):et?B&&n.texSubImage2D(t.TEXTURE_2D,se,0,0,Pe.width,Pe.height,Ce,Te,Pe.data):n.texImage2D(t.TEXTURE_2D,se,Ze,Pe.width,Pe.height,0,Ce,Te,Pe.data)}else if(T.isDataArrayTexture)if(et){if(Dt&&n.texStorage3D(t.TEXTURE_2D_ARRAY,De,Ze,ue.width,ue.height,ue.depth),B)if(T.layerUpdates.size>0){const se=zL(ue.width,ue.height,T.format,T.type);for(const pe of T.layerUpdates){const Le=ue.data.subarray(pe*se/ue.data.BYTES_PER_ELEMENT,(pe+1)*se/ue.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,pe,ue.width,ue.height,1,Ce,Te,Le)}T.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,ue.width,ue.height,ue.depth,Ce,Te,ue.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Ze,ue.width,ue.height,ue.depth,0,Ce,Te,ue.data);else if(T.isData3DTexture)et?(Dt&&n.texStorage3D(t.TEXTURE_3D,De,Ze,ue.width,ue.height,ue.depth),B&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,ue.width,ue.height,ue.depth,Ce,Te,ue.data)):n.texImage3D(t.TEXTURE_3D,0,Ze,ue.width,ue.height,ue.depth,0,Ce,Te,ue.data);else if(T.isFramebufferTexture){if(Dt)if(et)n.texStorage2D(t.TEXTURE_2D,De,Ze,ue.width,ue.height);else{let se=ue.width,pe=ue.height;for(let Le=0;Le<De;Le++)n.texImage2D(t.TEXTURE_2D,Le,Ze,se,pe,0,Ce,Te,null),se>>=1,pe>>=1}}else if(wt.length>0){if(et&&Dt){const se=pt(wt[0]);n.texStorage2D(t.TEXTURE_2D,De,Ze,se.width,se.height)}for(let se=0,pe=wt.length;se<pe;se++)Pe=wt[se],et?B&&n.texSubImage2D(t.TEXTURE_2D,se,0,0,Ce,Te,Pe):n.texImage2D(t.TEXTURE_2D,se,Ze,Ce,Te,Pe);T.generateMipmaps=!1}else if(et){if(Dt){const se=pt(ue);n.texStorage2D(t.TEXTURE_2D,De,Ze,se.width,se.height)}B&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,Ce,Te,ue)}else n.texImage2D(t.TEXTURE_2D,0,Ze,Ce,Te,ue);g(T)&&m(ae),H.__version=de.version,T.onUpdate&&T.onUpdate(T)}k.__version=T.version}function $(k,T,Q){if(T.image.length!==6)return;const ae=ge(k,T),me=T.source;n.bindTexture(t.TEXTURE_CUBE_MAP,k.__webglTexture,t.TEXTURE0+Q);const de=i.get(me);if(me.version!==de.__version||ae===!0){n.activeTexture(t.TEXTURE0+Q);const H=Pt.getPrimaries(Pt.workingColorSpace),Y=T.colorSpace===Pc?null:Pt.getPrimaries(T.colorSpace),le=T.colorSpace===Pc||H===Y?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,T.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,T.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,le);const ke=T.isCompressedTexture||T.image[0].isCompressedTexture,ue=T.image[0]&&T.image[0].isDataTexture,Ce=[];for(let pe=0;pe<6;pe++)!ke&&!ue?Ce[pe]=v(T.image[pe],!0,r.maxCubemapSize):Ce[pe]=ue?T.image[pe].image:T.image[pe],Ce[pe]=Zt(T,Ce[pe]);const Te=Ce[0],Ze=s.convert(T.format,T.colorSpace),Pe=s.convert(T.type),wt=y(T.internalFormat,Ze,Pe,T.colorSpace),et=T.isVideoTexture!==!0,Dt=de.__version===void 0||ae===!0,B=me.dataReady;let De=x(T,Te);ee(t.TEXTURE_CUBE_MAP,T);let se;if(ke){et&&Dt&&n.texStorage2D(t.TEXTURE_CUBE_MAP,De,wt,Te.width,Te.height);for(let pe=0;pe<6;pe++){se=Ce[pe].mipmaps;for(let Le=0;Le<se.length;Le++){const Ne=se[Le];T.format!==Bs?Ze!==null?et?B&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le,0,0,Ne.width,Ne.height,Ze,Ne.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le,wt,Ne.width,Ne.height,0,Ne.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):et?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le,0,0,Ne.width,Ne.height,Ze,Pe,Ne.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le,wt,Ne.width,Ne.height,0,Ze,Pe,Ne.data)}}}else{if(se=T.mipmaps,et&&Dt){se.length>0&&De++;const pe=pt(Ce[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,De,wt,pe.width,pe.height)}for(let pe=0;pe<6;pe++)if(ue){et?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,0,0,Ce[pe].width,Ce[pe].height,Ze,Pe,Ce[pe].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,wt,Ce[pe].width,Ce[pe].height,0,Ze,Pe,Ce[pe].data);for(let Le=0;Le<se.length;Le++){const Ft=se[Le].image[pe].image;et?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le+1,0,0,Ft.width,Ft.height,Ze,Pe,Ft.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le+1,wt,Ft.width,Ft.height,0,Ze,Pe,Ft.data)}}else{et?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,0,0,Ze,Pe,Ce[pe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,wt,Ze,Pe,Ce[pe]);for(let Le=0;Le<se.length;Le++){const Ne=se[Le];et?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le+1,0,0,Ze,Pe,Ne.image[pe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Le+1,wt,Ze,Pe,Ne.image[pe])}}}g(T)&&m(t.TEXTURE_CUBE_MAP),de.__version=me.version,T.onUpdate&&T.onUpdate(T)}k.__version=T.version}function K(k,T,Q,ae,me,de){const H=s.convert(Q.format,Q.colorSpace),Y=s.convert(Q.type),le=y(Q.internalFormat,H,Y,Q.colorSpace);if(!i.get(T).__hasExternalTextures){const ue=Math.max(1,T.width>>de),Ce=Math.max(1,T.height>>de);me===t.TEXTURE_3D||me===t.TEXTURE_2D_ARRAY?n.texImage3D(me,de,le,ue,Ce,T.depth,0,H,Y,null):n.texImage2D(me,de,le,ue,Ce,0,H,Y,null)}n.bindFramebuffer(t.FRAMEBUFFER,k),Mt(T)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,ae,me,i.get(Q).__webglTexture,0,xt(T)):(me===t.TEXTURE_2D||me>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&me<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,ae,me,i.get(Q).__webglTexture,de),n.bindFramebuffer(t.FRAMEBUFFER,null)}function oe(k,T,Q){if(t.bindRenderbuffer(t.RENDERBUFFER,k),T.depthBuffer){const ae=T.depthTexture,me=ae&&ae.isDepthTexture?ae.type:null,de=S(T.stencilBuffer,me),H=T.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Y=xt(T);Mt(T)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Y,de,T.width,T.height):Q?t.renderbufferStorageMultisample(t.RENDERBUFFER,Y,de,T.width,T.height):t.renderbufferStorage(t.RENDERBUFFER,de,T.width,T.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,H,t.RENDERBUFFER,k)}else{const ae=T.textures;for(let me=0;me<ae.length;me++){const de=ae[me],H=s.convert(de.format,de.colorSpace),Y=s.convert(de.type),le=y(de.internalFormat,H,Y,de.colorSpace),ke=xt(T);Q&&Mt(T)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ke,le,T.width,T.height):Mt(T)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ke,le,T.width,T.height):t.renderbufferStorage(t.RENDERBUFFER,le,T.width,T.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function he(k,T){if(T&&T.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,k),!(T.depthTexture&&T.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(T.depthTexture).__webglTexture||T.depthTexture.image.width!==T.width||T.depthTexture.image.height!==T.height)&&(T.depthTexture.image.width=T.width,T.depthTexture.image.height=T.height,T.depthTexture.needsUpdate=!0),V(T.depthTexture,0);const ae=i.get(T.depthTexture).__webglTexture,me=xt(T);if(T.depthTexture.format===ud)Mt(T)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,ae,0,me):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,ae,0);else if(T.depthTexture.format===Od)Mt(T)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,ae,0,me):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,ae,0);else throw new Error("Unknown depthTexture format")}function ze(k){const T=i.get(k),Q=k.isWebGLCubeRenderTarget===!0;if(T.__boundDepthTexture!==k.depthTexture){const ae=k.depthTexture;if(T.__depthDisposeCallback&&T.__depthDisposeCallback(),ae){const me=()=>{delete T.__boundDepthTexture,delete T.__depthDisposeCallback,ae.removeEventListener("dispose",me)};ae.addEventListener("dispose",me),T.__depthDisposeCallback=me}T.__boundDepthTexture=ae}if(k.depthTexture&&!T.__autoAllocateDepthBuffer){if(Q)throw new Error("target.depthTexture not supported in Cube render targets");he(T.__webglFramebuffer,k)}else if(Q){T.__webglDepthbuffer=[];for(let ae=0;ae<6;ae++)if(n.bindFramebuffer(t.FRAMEBUFFER,T.__webglFramebuffer[ae]),T.__webglDepthbuffer[ae]===void 0)T.__webglDepthbuffer[ae]=t.createRenderbuffer(),oe(T.__webglDepthbuffer[ae],k,!1);else{const me=k.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,de=T.__webglDepthbuffer[ae];t.bindRenderbuffer(t.RENDERBUFFER,de),t.framebufferRenderbuffer(t.FRAMEBUFFER,me,t.RENDERBUFFER,de)}}else if(n.bindFramebuffer(t.FRAMEBUFFER,T.__webglFramebuffer),T.__webglDepthbuffer===void 0)T.__webglDepthbuffer=t.createRenderbuffer(),oe(T.__webglDepthbuffer,k,!1);else{const ae=k.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,me=T.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,me),t.framebufferRenderbuffer(t.FRAMEBUFFER,ae,t.RENDERBUFFER,me)}n.bindFramebuffer(t.FRAMEBUFFER,null)}function Me(k,T,Q){const ae=i.get(k);T!==void 0&&K(ae.__webglFramebuffer,k,k.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),Q!==void 0&&ze(k)}function dt(k){const T=k.texture,Q=i.get(k),ae=i.get(T);k.addEventListener("dispose",C);const me=k.textures,de=k.isWebGLCubeRenderTarget===!0,H=me.length>1;if(H||(ae.__webglTexture===void 0&&(ae.__webglTexture=t.createTexture()),ae.__version=T.version,o.memory.textures++),de){Q.__webglFramebuffer=[];for(let Y=0;Y<6;Y++)if(T.mipmaps&&T.mipmaps.length>0){Q.__webglFramebuffer[Y]=[];for(let le=0;le<T.mipmaps.length;le++)Q.__webglFramebuffer[Y][le]=t.createFramebuffer()}else Q.__webglFramebuffer[Y]=t.createFramebuffer()}else{if(T.mipmaps&&T.mipmaps.length>0){Q.__webglFramebuffer=[];for(let Y=0;Y<T.mipmaps.length;Y++)Q.__webglFramebuffer[Y]=t.createFramebuffer()}else Q.__webglFramebuffer=t.createFramebuffer();if(H)for(let Y=0,le=me.length;Y<le;Y++){const ke=i.get(me[Y]);ke.__webglTexture===void 0&&(ke.__webglTexture=t.createTexture(),o.memory.textures++)}if(k.samples>0&&Mt(k)===!1){Q.__webglMultisampledFramebuffer=t.createFramebuffer(),Q.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,Q.__webglMultisampledFramebuffer);for(let Y=0;Y<me.length;Y++){const le=me[Y];Q.__webglColorRenderbuffer[Y]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,Q.__webglColorRenderbuffer[Y]);const ke=s.convert(le.format,le.colorSpace),ue=s.convert(le.type),Ce=y(le.internalFormat,ke,ue,le.colorSpace,k.isXRRenderTarget===!0),Te=xt(k);t.renderbufferStorageMultisample(t.RENDERBUFFER,Te,Ce,k.width,k.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Y,t.RENDERBUFFER,Q.__webglColorRenderbuffer[Y])}t.bindRenderbuffer(t.RENDERBUFFER,null),k.depthBuffer&&(Q.__webglDepthRenderbuffer=t.createRenderbuffer(),oe(Q.__webglDepthRenderbuffer,k,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(de){n.bindTexture(t.TEXTURE_CUBE_MAP,ae.__webglTexture),ee(t.TEXTURE_CUBE_MAP,T);for(let Y=0;Y<6;Y++)if(T.mipmaps&&T.mipmaps.length>0)for(let le=0;le<T.mipmaps.length;le++)K(Q.__webglFramebuffer[Y][le],k,T,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Y,le);else K(Q.__webglFramebuffer[Y],k,T,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Y,0);g(T)&&m(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(H){for(let Y=0,le=me.length;Y<le;Y++){const ke=me[Y],ue=i.get(ke);n.bindTexture(t.TEXTURE_2D,ue.__webglTexture),ee(t.TEXTURE_2D,ke),K(Q.__webglFramebuffer,k,ke,t.COLOR_ATTACHMENT0+Y,t.TEXTURE_2D,0),g(ke)&&m(t.TEXTURE_2D)}n.unbindTexture()}else{let Y=t.TEXTURE_2D;if((k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(Y=k.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(Y,ae.__webglTexture),ee(Y,T),T.mipmaps&&T.mipmaps.length>0)for(let le=0;le<T.mipmaps.length;le++)K(Q.__webglFramebuffer[le],k,T,t.COLOR_ATTACHMENT0,Y,le);else K(Q.__webglFramebuffer,k,T,t.COLOR_ATTACHMENT0,Y,0);g(T)&&m(Y),n.unbindTexture()}k.depthBuffer&&ze(k)}function it(k){const T=k.textures;for(let Q=0,ae=T.length;Q<ae;Q++){const me=T[Q];if(g(me)){const de=k.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,H=i.get(me).__webglTexture;n.bindTexture(de,H),m(de),n.unbindTexture()}}}const St=[],U=[];function di(k){if(k.samples>0){if(Mt(k)===!1){const T=k.textures,Q=k.width,ae=k.height;let me=t.COLOR_BUFFER_BIT;const de=k.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,H=i.get(k),Y=T.length>1;if(Y)for(let le=0;le<T.length;le++)n.bindFramebuffer(t.FRAMEBUFFER,H.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+le,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,H.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+le,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,H.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,H.__webglFramebuffer);for(let le=0;le<T.length;le++){if(k.resolveDepthBuffer&&(k.depthBuffer&&(me|=t.DEPTH_BUFFER_BIT),k.stencilBuffer&&k.resolveStencilBuffer&&(me|=t.STENCIL_BUFFER_BIT)),Y){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,H.__webglColorRenderbuffer[le]);const ke=i.get(T[le]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,ke,0)}t.blitFramebuffer(0,0,Q,ae,0,0,Q,ae,me,t.NEAREST),c===!0&&(St.length=0,U.length=0,St.push(t.COLOR_ATTACHMENT0+le),k.depthBuffer&&k.resolveDepthBuffer===!1&&(St.push(de),U.push(de),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,U)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,St))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),Y)for(let le=0;le<T.length;le++){n.bindFramebuffer(t.FRAMEBUFFER,H.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+le,t.RENDERBUFFER,H.__webglColorRenderbuffer[le]);const ke=i.get(T[le]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,H.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+le,t.TEXTURE_2D,ke,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,H.__webglMultisampledFramebuffer)}else if(k.depthBuffer&&k.resolveDepthBuffer===!1&&c){const T=k.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[T])}}}function xt(k){return Math.min(r.maxSamples,k.samples)}function Mt(k){const T=i.get(k);return k.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&T.__useRenderToTexture!==!1}function lt(k){const T=o.render.frame;u.get(k)!==T&&(u.set(k,T),k.update())}function Zt(k,T){const Q=k.colorSpace,ae=k.format,me=k.type;return k.isCompressedTexture===!0||k.isVideoTexture===!0||Q!==qi&&Q!==Pc&&(Pt.getTransfer(Q)===Pn?(ae!==Bs||me!==Ya)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Q)),T}function pt(k){return typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(l.width=k.naturalWidth||k.width,l.height=k.naturalHeight||k.height):typeof VideoFrame<"u"&&k instanceof VideoFrame?(l.width=k.displayWidth,l.height=k.displayHeight):(l.width=k.width,l.height=k.height),l}this.allocateTextureUnit=L,this.resetTextureUnits=R,this.setTexture2D=V,this.setTexture2DArray=X,this.setTexture3D=G,this.setTextureCube=J,this.rebindTextures=Me,this.setupRenderTarget=dt,this.updateRenderTargetMipmap=it,this.updateMultisampleRenderTarget=di,this.setupDepthRenderbuffer=ze,this.setupFrameBufferTexture=K,this.useMultisampledRTT=Mt}function Bne(t,e){function n(i,r=Pc){let s;const o=Pt.getTransfer(r);if(i===Ya)return t.UNSIGNED_BYTE;if(i===U2)return t.UNSIGNED_SHORT_4_4_4_4;if(i===B2)return t.UNSIGNED_SHORT_5_5_5_1;if(i===NB)return t.UNSIGNED_INT_5_9_9_9_REV;if(i===LB)return t.BYTE;if(i===DB)return t.SHORT;if(i===Kg)return t.UNSIGNED_SHORT;if(i===z2)return t.INT;if(i===Iu)return t.UNSIGNED_INT;if(i===Ro)return t.FLOAT;if(i===D0)return t.HALF_FLOAT;if(i===OB)return t.ALPHA;if(i===FB)return t.RGB;if(i===Bs)return t.RGBA;if(i===zB)return t.LUMINANCE;if(i===UB)return t.LUMINANCE_ALPHA;if(i===ud)return t.DEPTH_COMPONENT;if(i===Od)return t.DEPTH_STENCIL;if(i===$2)return t.RED;if(i===H2)return t.RED_INTEGER;if(i===BB)return t.RG;if(i===V2)return t.RG_INTEGER;if(i===j2)return t.RGBA_INTEGER;if(i===Ly||i===Dy||i===Ny||i===Oy)if(o===Pn)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===Ly)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Dy)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Ny)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Oy)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===Ly)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Dy)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Ny)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Oy)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===TR||i===AR||i===PR||i===IR)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===TR)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===AR)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===PR)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===IR)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===MR||i===kR||i===LR)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===MR||i===kR)return o===Pn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===LR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===DR||i===NR||i===OR||i===FR||i===zR||i===UR||i===BR||i===$R||i===HR||i===VR||i===jR||i===WR||i===GR||i===qR)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===DR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===NR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===OR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===FR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===zR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===UR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===BR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===$R)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===HR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===VR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===jR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===WR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===GR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===qR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Fy||i===XR||i===KR)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Fy)return o===Pn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===XR)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===KR)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===$B||i===YR||i===JR||i===QR)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===Fy)return s.COMPRESSED_RED_RGTC1_EXT;if(i===YR)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===JR)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===QR)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Nd?t.UNSIGNED_INT_24_8:t[i]!==void 0?t[i]:null}return{convert:n}}class $ne extends lr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Ba extends Sn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Hne={type:"move"};class xw{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ba,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ba,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ba,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const i of e.hand.values())this._getHandJoint(n,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,i){let r=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const v of e.hand.values()){const g=n.getJointPose(v,i),m=this._getHandJoint(l,v);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=g!==null}const u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,f=.005;l.inputState.pinching&&d>p+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&d<=p-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,i),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(r=n.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Hne)))}return a!==null&&(a.visible=r!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const i=new Ba;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[n.jointName]=i,e.add(i)}return e.joints[n.jointName]}}const Vne=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,jne=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Wne{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,i){if(this.texture===null){const r=new wi,s=e.properties.get(r);s.__webglTexture=n.texture,(n.depthNear!=i.depthNear||n.depthFar!=i.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,i=new ol({vertexShader:Vne,fragmentShader:jne,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new gn(new Qx(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Gne extends Cl{constructor(e,n){super();const i=this;let r=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,h=null,d=null,p=null,f=null;const v=new Wne,g=n.getContextAttributes();let m=null,y=null;const S=[],x=[],w=new gt;let C=null;const E=new lr;E.layers.enable(1),E.viewport=new Gt;const b=new lr;b.layers.enable(2),b.viewport=new Gt;const M=[E,b],_=new $ne;_.layers.enable(1),_.layers.enable(2);let R=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function($){let K=S[$];return K===void 0&&(K=new xw,S[$]=K),K.getTargetRaySpace()},this.getControllerGrip=function($){let K=S[$];return K===void 0&&(K=new xw,S[$]=K),K.getGripSpace()},this.getHand=function($){let K=S[$];return K===void 0&&(K=new xw,S[$]=K),K.getHandSpace()};function O($){const K=x.indexOf($.inputSource);if(K===-1)return;const oe=S[K];oe!==void 0&&(oe.update($.inputSource,$.frame,l||o),oe.dispatchEvent({type:$.type,data:$.inputSource}))}function V(){r.removeEventListener("select",O),r.removeEventListener("selectstart",O),r.removeEventListener("selectend",O),r.removeEventListener("squeeze",O),r.removeEventListener("squeezestart",O),r.removeEventListener("squeezeend",O),r.removeEventListener("end",V),r.removeEventListener("inputsourceschange",X);for(let $=0;$<S.length;$++){const K=x[$];K!==null&&(x[$]=null,S[$].disconnect(K))}R=null,L=null,v.reset(),e.setRenderTarget(m),p=null,d=null,h=null,r=null,y=null,I.stop(),i.isPresenting=!1,e.setPixelRatio(C),e.setSize(w.width,w.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function($){s=$,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function($){a=$,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function($){l=$},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function($){if(r=$,r!==null){if(m=e.getRenderTarget(),r.addEventListener("select",O),r.addEventListener("selectstart",O),r.addEventListener("selectend",O),r.addEventListener("squeeze",O),r.addEventListener("squeezestart",O),r.addEventListener("squeezeend",O),r.addEventListener("end",V),r.addEventListener("inputsourceschange",X),g.xrCompatible!==!0&&await n.makeXRCompatible(),C=e.getPixelRatio(),e.getSize(w),r.renderState.layers===void 0){const K={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(r,n,K),r.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),y=new Mu(p.framebufferWidth,p.framebufferHeight,{format:Bs,type:Ya,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}else{let K=null,oe=null,he=null;g.depth&&(he=g.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,K=g.stencil?Od:ud,oe=g.stencil?Nd:Iu);const ze={colorFormat:n.RGBA8,depthFormat:he,scaleFactor:s};h=new XRWebGLBinding(r,n),d=h.createProjectionLayer(ze),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),y=new Mu(d.textureWidth,d.textureHeight,{format:Bs,type:Ya,depthTexture:new e5(d.textureWidth,d.textureHeight,oe,void 0,void 0,void 0,void 0,void 0,void 0,K),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await r.requestReferenceSpace(a),I.setContext(r),I.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function X($){for(let K=0;K<$.removed.length;K++){const oe=$.removed[K],he=x.indexOf(oe);he>=0&&(x[he]=null,S[he].disconnect(oe))}for(let K=0;K<$.added.length;K++){const oe=$.added[K];let he=x.indexOf(oe);if(he===-1){for(let Me=0;Me<S.length;Me++)if(Me>=x.length){x.push(oe),he=Me;break}else if(x[Me]===null){x[Me]=oe,he=Me;break}if(he===-1)break}const ze=S[he];ze&&ze.connect(oe)}}const G=new N,J=new N;function D($,K,oe){G.setFromMatrixPosition(K.matrixWorld),J.setFromMatrixPosition(oe.matrixWorld);const he=G.distanceTo(J),ze=K.projectionMatrix.elements,Me=oe.projectionMatrix.elements,dt=ze[14]/(ze[10]-1),it=ze[14]/(ze[10]+1),St=(ze[9]+1)/ze[5],U=(ze[9]-1)/ze[5],di=(ze[8]-1)/ze[0],xt=(Me[8]+1)/Me[0],Mt=dt*di,lt=dt*xt,Zt=he/(-di+xt),pt=Zt*-di;if(K.matrixWorld.decompose($.position,$.quaternion,$.scale),$.translateX(pt),$.translateZ(Zt),$.matrixWorld.compose($.position,$.quaternion,$.scale),$.matrixWorldInverse.copy($.matrixWorld).invert(),ze[10]===-1)$.projectionMatrix.copy(K.projectionMatrix),$.projectionMatrixInverse.copy(K.projectionMatrixInverse);else{const k=dt+Zt,T=it+Zt,Q=Mt-pt,ae=lt+(he-pt),me=St*it/T*k,de=U*it/T*k;$.projectionMatrix.makePerspective(Q,ae,me,de,k,T),$.projectionMatrixInverse.copy($.projectionMatrix).invert()}}function ne($,K){K===null?$.matrixWorld.copy($.matrix):$.matrixWorld.multiplyMatrices(K.matrixWorld,$.matrix),$.matrixWorldInverse.copy($.matrixWorld).invert()}this.updateCamera=function($){if(r===null)return;let K=$.near,oe=$.far;v.texture!==null&&(v.depthNear>0&&(K=v.depthNear),v.depthFar>0&&(oe=v.depthFar)),_.near=b.near=E.near=K,_.far=b.far=E.far=oe,(R!==_.near||L!==_.far)&&(r.updateRenderState({depthNear:_.near,depthFar:_.far}),R=_.near,L=_.far);const he=$.parent,ze=_.cameras;ne(_,he);for(let Me=0;Me<ze.length;Me++)ne(ze[Me],he);ze.length===2?D(_,E,b):_.projectionMatrix.copy(E.projectionMatrix),P($,_,he)};function P($,K,oe){oe===null?$.matrix.copy(K.matrixWorld):($.matrix.copy(oe.matrixWorld),$.matrix.invert(),$.matrix.multiply(K.matrixWorld)),$.matrix.decompose($.position,$.quaternion,$.scale),$.updateMatrixWorld(!0),$.projectionMatrix.copy(K.projectionMatrix),$.projectionMatrixInverse.copy(K.projectionMatrixInverse),$.isPerspectiveCamera&&($.fov=Fd*2*Math.atan(1/$.projectionMatrix.elements[5]),$.zoom=1)}this.getCamera=function(){return _},this.getFoveation=function(){if(!(d===null&&p===null))return c},this.setFoveation=function($){c=$,d!==null&&(d.fixedFoveation=$),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=$)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(_)};let ee=null;function ge($,K){if(u=K.getViewerPose(l||o),f=K,u!==null){const oe=u.views;p!==null&&(e.setRenderTargetFramebuffer(y,p.framebuffer),e.setRenderTarget(y));let he=!1;oe.length!==_.cameras.length&&(_.cameras.length=0,he=!0);for(let Me=0;Me<oe.length;Me++){const dt=oe[Me];let it=null;if(p!==null)it=p.getViewport(dt);else{const U=h.getViewSubImage(d,dt);it=U.viewport,Me===0&&(e.setRenderTargetTextures(y,U.colorTexture,d.ignoreDepthValues?void 0:U.depthStencilTexture),e.setRenderTarget(y))}let St=M[Me];St===void 0&&(St=new lr,St.layers.enable(Me),St.viewport=new Gt,M[Me]=St),St.matrix.fromArray(dt.transform.matrix),St.matrix.decompose(St.position,St.quaternion,St.scale),St.projectionMatrix.fromArray(dt.projectionMatrix),St.projectionMatrixInverse.copy(St.projectionMatrix).invert(),St.viewport.set(it.x,it.y,it.width,it.height),Me===0&&(_.matrix.copy(St.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale)),he===!0&&_.cameras.push(St)}const ze=r.enabledFeatures;if(ze&&ze.includes("depth-sensing")){const Me=h.getDepthInformation(oe[0]);Me&&Me.isValid&&Me.texture&&v.init(e,Me,r.renderState)}}for(let oe=0;oe<S.length;oe++){const he=x[oe],ze=S[oe];he!==null&&ze!==void 0&&ze.update(he,K,l||o)}ee&&ee($,K),K.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:K}),f=null}const I=new ZB;I.setAnimationLoop(ge),this.setAnimationLoop=function($){ee=$},this.dispose=function(){}}}const ql=new fn,qne=new Ge;function Xne(t,e){function n(g,m){g.matrixAutoUpdate===!0&&g.updateMatrix(),m.value.copy(g.matrix)}function i(g,m){m.color.getRGB(g.fogColor.value,YB(t)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function r(g,m,y,S,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),h(g,m)):m.isMeshPhongMaterial?(s(g,m),u(g,m)):m.isMeshStandardMaterial?(s(g,m),d(g,m),m.isMeshPhysicalMaterial&&p(g,m,x)):m.isMeshMatcapMaterial?(s(g,m),f(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),v(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(o(g,m),m.isLineDashedMaterial&&a(g,m)):m.isPointsMaterial?c(g,m,y,S):m.isSpriteMaterial?l(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,n(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,n(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,n(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,m.side===br&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,n(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),m.side===br&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,n(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,n(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,n(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const y=e.get(m),S=y.envMap,x=y.envMapRotation;S&&(g.envMap.value=S,ql.copy(x),ql.x*=-1,ql.y*=-1,ql.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(ql.y*=-1,ql.z*=-1),g.envMapRotation.value.setFromMatrix4(qne.makeRotationFromEuler(ql)),g.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap&&(g.lightMap.value=m.lightMap,g.lightMapIntensity.value=m.lightMapIntensity,n(m.lightMap,g.lightMapTransform)),m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,n(m.aoMap,g.aoMapTransform))}function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,n(m.map,g.mapTransform))}function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function c(g,m,y,S){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*y,g.scale.value=S*.5,m.map&&(g.map.value=m.map,n(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,n(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,n(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,n(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function h(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function d(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,n(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,n(m.roughnessMap,g.roughnessMapTransform)),m.envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function p(g,m,y){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,n(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,n(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,n(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,n(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,n(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===br&&g.clearcoatNormalScale.value.negate())),m.dispersion>0&&(g.dispersion.value=m.dispersion),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,n(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,n(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,n(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,n(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,n(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,n(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,n(m.specularIntensityMap,g.specularIntensityMapTransform))}function f(g,m){m.matcap&&(g.matcap.value=m.matcap)}function v(g,m){const y=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function Kne(t,e,n,i){let r={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(y,S){const x=S.program;i.uniformBlockBinding(y,x)}function l(y,S){let x=r[y.id];x===void 0&&(f(y),x=u(y),r[y.id]=x,y.addEventListener("dispose",g));const w=S.program;i.updateUBOMapping(y,w);const C=e.render.frame;s[y.id]!==C&&(d(y),s[y.id]=C)}function u(y){const S=h();y.__bindingPointIndex=S;const x=t.createBuffer(),w=y.__size,C=y.usage;return t.bindBuffer(t.UNIFORM_BUFFER,x),t.bufferData(t.UNIFORM_BUFFER,w,C),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,S,x),x}function h(){for(let y=0;y<a;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const S=r[y.id],x=y.uniforms,w=y.__cache;t.bindBuffer(t.UNIFORM_BUFFER,S);for(let C=0,E=x.length;C<E;C++){const b=Array.isArray(x[C])?x[C]:[x[C]];for(let M=0,_=b.length;M<_;M++){const R=b[M];if(p(R,C,M,w)===!0){const L=R.__offset,O=Array.isArray(R.value)?R.value:[R.value];let V=0;for(let X=0;X<O.length;X++){const G=O[X],J=v(G);typeof G=="number"||typeof G=="boolean"?(R.__data[0]=G,t.bufferSubData(t.UNIFORM_BUFFER,L+V,R.__data)):G.isMatrix3?(R.__data[0]=G.elements[0],R.__data[1]=G.elements[1],R.__data[2]=G.elements[2],R.__data[3]=0,R.__data[4]=G.elements[3],R.__data[5]=G.elements[4],R.__data[6]=G.elements[5],R.__data[7]=0,R.__data[8]=G.elements[6],R.__data[9]=G.elements[7],R.__data[10]=G.elements[8],R.__data[11]=0):(G.toArray(R.__data,V),V+=J.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,L,R.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function p(y,S,x,w){const C=y.value,E=S+"_"+x;if(w[E]===void 0)return typeof C=="number"||typeof C=="boolean"?w[E]=C:w[E]=C.clone(),!0;{const b=w[E];if(typeof C=="number"||typeof C=="boolean"){if(b!==C)return w[E]=C,!0}else if(b.equals(C)===!1)return b.copy(C),!0}return!1}function f(y){const S=y.uniforms;let x=0;const w=16;for(let E=0,b=S.length;E<b;E++){const M=Array.isArray(S[E])?S[E]:[S[E]];for(let _=0,R=M.length;_<R;_++){const L=M[_],O=Array.isArray(L.value)?L.value:[L.value];for(let V=0,X=O.length;V<X;V++){const G=O[V],J=v(G),D=x%w,ne=D%J.boundary,P=D+ne;x+=ne,P!==0&&w-P<J.storage&&(x+=w-P),L.__data=new Float32Array(J.storage/Float32Array.BYTES_PER_ELEMENT),L.__offset=x,x+=J.storage}}}const C=x%w;return C>0&&(x+=w-C),y.__size=x,y.__cache={},this}function v(y){const S={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(S.boundary=4,S.storage=4):y.isVector2?(S.boundary=8,S.storage=8):y.isVector3||y.isColor?(S.boundary=16,S.storage=12):y.isVector4?(S.boundary=16,S.storage=16):y.isMatrix3?(S.boundary=48,S.storage=48):y.isMatrix4?(S.boundary=64,S.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),S}function g(y){const S=y.target;S.removeEventListener("dispose",g);const x=o.indexOf(S.__bindingPointIndex);o.splice(x,1),t.deleteBuffer(r[S.id]),delete r[S.id],delete s[S.id]}function m(){for(const y in r)t.deleteBuffer(r[y]);o=[],r={},s={}}return{bind:c,update:l,dispose:m}}class Yne{constructor(e={}){const{canvas:n=FJ(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let d;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=i.getContextAttributes().alpha}else d=o;const p=new Uint32Array(4),f=new Int32Array(4);let v=null,g=null;const m=[],y=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=on,this.toneMapping=Yc,this.toneMappingExposure=1;const S=this;let x=!1,w=0,C=0,E=null,b=-1,M=null;const _=new Gt,R=new Gt;let L=null;const O=new Xe(0);let V=0,X=n.width,G=n.height,J=1,D=null,ne=null;const P=new Gt(0,0,X,G),ee=new Gt(0,0,X,G);let ge=!1;const I=new Y2;let $=!1,K=!1;const oe=new Ge,he=new Ge,ze=new N,Me=new Gt,dt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let it=!1;function St(){return E===null?J:1}let U=i;function di(A,z){return n.getContext(A,z)}try{const A={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${F2}`),n.addEventListener("webglcontextlost",pe,!1),n.addEventListener("webglcontextrestored",Le,!1),n.addEventListener("webglcontextcreationerror",Ne,!1),U===null){const z="webgl2";if(U=di(z,A),U===null)throw di(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(A){throw console.error("THREE.WebGLRenderer: "+A.message),A}let xt,Mt,lt,Zt,pt,k,T,Q,ae,me,de,H,Y,le,ke,ue,Ce,Te,Ze,Pe,wt,et,Dt,B;function De(){xt=new tte(U),xt.init(),et=new Bne(U,xt),Mt=new Kee(U,xt,e,et),lt=new Fne(U),Mt.reverseDepthBuffer&&lt.buffers.depth.setReversed(!0),Zt=new rte(U),pt=new _ne,k=new Une(U,xt,lt,pt,Mt,et,Zt),T=new Jee(S),Q=new ete(S),ae=new hQ(U),Dt=new qee(U,ae),me=new nte(U,ae,Zt,Dt),de=new ote(U,me,ae,Zt),Ze=new ste(U,Mt,k),ue=new Yee(pt),H=new Cne(S,T,Q,xt,Mt,Dt,ue),Y=new Xne(S,pt),le=new Ene,ke=new Ine(xt),Te=new Gee(S,T,Q,lt,de,d,c),Ce=new Nne(S,de,Mt),B=new Kne(U,Zt,Mt,lt),Pe=new Xee(U,xt,Zt),wt=new ite(U,xt,Zt),Zt.programs=H.programs,S.capabilities=Mt,S.extensions=xt,S.properties=pt,S.renderLists=le,S.shadowMap=Ce,S.state=lt,S.info=Zt}De();const se=new Gne(S,U);this.xr=se,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const A=xt.get("WEBGL_lose_context");A&&A.loseContext()},this.forceContextRestore=function(){const A=xt.get("WEBGL_lose_context");A&&A.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(A){A!==void 0&&(J=A,this.setSize(X,G,!1))},this.getSize=function(A){return A.set(X,G)},this.setSize=function(A,z,q=!0){if(se.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}X=A,G=z,n.width=Math.floor(A*J),n.height=Math.floor(z*J),q===!0&&(n.style.width=A+"px",n.style.height=z+"px"),this.setViewport(0,0,A,z)},this.getDrawingBufferSize=function(A){return A.set(X*J,G*J).floor()},this.setDrawingBufferSize=function(A,z,q){X=A,G=z,J=q,n.width=Math.floor(A*q),n.height=Math.floor(z*q),this.setViewport(0,0,A,z)},this.getCurrentViewport=function(A){return A.copy(_)},this.getViewport=function(A){return A.copy(P)},this.setViewport=function(A,z,q,te){A.isVector4?P.set(A.x,A.y,A.z,A.w):P.set(A,z,q,te),lt.viewport(_.copy(P).multiplyScalar(J).round())},this.getScissor=function(A){return A.copy(ee)},this.setScissor=function(A,z,q,te){A.isVector4?ee.set(A.x,A.y,A.z,A.w):ee.set(A,z,q,te),lt.scissor(R.copy(ee).multiplyScalar(J).round())},this.getScissorTest=function(){return ge},this.setScissorTest=function(A){lt.setScissorTest(ge=A)},this.setOpaqueSort=function(A){D=A},this.setTransparentSort=function(A){ne=A},this.getClearColor=function(A){return A.copy(Te.getClearColor())},this.setClearColor=function(){Te.setClearColor.apply(Te,arguments)},this.getClearAlpha=function(){return Te.getClearAlpha()},this.setClearAlpha=function(){Te.setClearAlpha.apply(Te,arguments)},this.clear=function(A=!0,z=!0,q=!0){let te=0;if(A){let j=!1;if(E!==null){const ve=E.texture.format;j=ve===j2||ve===V2||ve===H2}if(j){const ve=E.texture.type,we=ve===Ya||ve===Iu||ve===Kg||ve===Nd||ve===U2||ve===B2,Ve=Te.getClearColor(),je=Te.getClearAlpha(),at=Ve.r,ft=Ve.g,Je=Ve.b;we?(p[0]=at,p[1]=ft,p[2]=Je,p[3]=je,U.clearBufferuiv(U.COLOR,0,p)):(f[0]=at,f[1]=ft,f[2]=Je,f[3]=je,U.clearBufferiv(U.COLOR,0,f))}else te|=U.COLOR_BUFFER_BIT}z&&(te|=U.DEPTH_BUFFER_BIT,U.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),q&&(te|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(te)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",pe,!1),n.removeEventListener("webglcontextrestored",Le,!1),n.removeEventListener("webglcontextcreationerror",Ne,!1),le.dispose(),ke.dispose(),pt.dispose(),T.dispose(),Q.dispose(),de.dispose(),Dt.dispose(),B.dispose(),H.dispose(),se.dispose(),se.removeEventListener("sessionstart",F),se.removeEventListener("sessionend",W),ie.stop()};function pe(A){A.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Le(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const A=Zt.autoReset,z=Ce.enabled,q=Ce.autoUpdate,te=Ce.needsUpdate,j=Ce.type;De(),Zt.autoReset=A,Ce.enabled=z,Ce.autoUpdate=q,Ce.needsUpdate=te,Ce.type=j}function Ne(A){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",A.statusMessage)}function Ft(A){const z=A.target;z.removeEventListener("dispose",Ft),Tn(z)}function Tn(A){Qn(A),pt.remove(A)}function Qn(A){const z=pt.get(A).programs;z!==void 0&&(z.forEach(function(q){H.releaseProgram(q)}),A.isShaderMaterial&&H.releaseShaderCache(A))}this.renderBufferDirect=function(A,z,q,te,j,ve){z===null&&(z=dt);const we=j.isMesh&&j.matrixWorld.determinant()<0,Ve=Ot(A,z,q,te,j);lt.setMaterial(te,we);let je=q.index,at=1;if(te.wireframe===!0){if(je=me.getWireframeAttribute(q),je===void 0)return;at=2}const ft=q.drawRange,Je=q.attributes.position;let Ke=ft.start*at,vt=(ft.start+ft.count)*at;ve!==null&&(Ke=Math.max(Ke,ve.start*at),vt=Math.min(vt,(ve.start+ve.count)*at)),je!==null?(Ke=Math.max(Ke,0),vt=Math.min(vt,je.count)):Je!=null&&(Ke=Math.max(Ke,0),vt=Math.min(vt,Je.count));const rn=vt-Ke;if(rn<0||rn===1/0)return;Dt.setup(j,te,Ve,q,je);let fi,mt=Pe;if(je!==null&&(fi=ae.get(je),mt=wt,mt.setIndex(fi)),j.isMesh)te.wireframe===!0?(lt.setLineWidth(te.wireframeLinewidth*St()),mt.setMode(U.LINES)):mt.setMode(U.TRIANGLES);else if(j.isLine){let Ye=te.linewidth;Ye===void 0&&(Ye=1),lt.setLineWidth(Ye*St()),j.isLineSegments?mt.setMode(U.LINES):j.isLineLoop?mt.setMode(U.LINE_LOOP):mt.setMode(U.LINE_STRIP)}else j.isPoints?mt.setMode(U.POINTS):j.isSprite&&mt.setMode(U.TRIANGLES);if(j.isBatchedMesh)if(j._multiDrawInstances!==null)mt.renderMultiDrawInstances(j._multiDrawStarts,j._multiDrawCounts,j._multiDrawCount,j._multiDrawInstances);else if(xt.get("WEBGL_multi_draw"))mt.renderMultiDraw(j._multiDrawStarts,j._multiDrawCounts,j._multiDrawCount);else{const Ye=j._multiDrawStarts,si=j._multiDrawCounts,en=j._multiDrawCount,oo=je?ae.get(je).bytesPerElement:1,ah=pt.get(te).currentProgram.getUniforms();for(let ts=0;ts<en;ts++)ah.setValue(U,"_gl_DrawID",ts),mt.render(Ye[ts]/oo,si[ts])}else if(j.isInstancedMesh)mt.renderInstances(Ke,rn,j.count);else if(q.isInstancedBufferGeometry){const Ye=q._maxInstanceCount!==void 0?q._maxInstanceCount:1/0,si=Math.min(q.instanceCount,Ye);mt.renderInstances(Ke,rn,si)}else mt.render(Ke,rn)};function Nt(A,z,q){A.transparent===!0&&A.side===Zo&&A.forceSinglePass===!1?(A.side=br,A.needsUpdate=!0,Ue(A,z,q),A.side=Ka,A.needsUpdate=!0,Ue(A,z,q),A.side=Zo):Ue(A,z,q)}this.compile=function(A,z,q=null){q===null&&(q=A),g=ke.get(q),g.init(z),y.push(g),q.traverseVisible(function(j){j.isLight&&j.layers.test(z.layers)&&(g.pushLight(j),j.castShadow&&g.pushShadow(j))}),A!==q&&A.traverseVisible(function(j){j.isLight&&j.layers.test(z.layers)&&(g.pushLight(j),j.castShadow&&g.pushShadow(j))}),g.setupLights();const te=new Set;return A.traverse(function(j){if(!(j.isMesh||j.isPoints||j.isLine||j.isSprite))return;const ve=j.material;if(ve)if(Array.isArray(ve))for(let we=0;we<ve.length;we++){const Ve=ve[we];Nt(Ve,q,j),te.add(Ve)}else Nt(ve,q,j),te.add(ve)}),y.pop(),g=null,te},this.compileAsync=function(A,z,q=null){const te=this.compile(A,z,q);return new Promise(j=>{function ve(){if(te.forEach(function(we){pt.get(we).currentProgram.isReady()&&te.delete(we)}),te.size===0){j(A);return}setTimeout(ve,10)}xt.get("KHR_parallel_shader_compile")!==null?ve():setTimeout(ve,10)})};let bi=null;function es(A){bi&&bi(A)}function F(){ie.stop()}function W(){ie.start()}const ie=new ZB;ie.setAnimationLoop(es),typeof self<"u"&&ie.setContext(self),this.setAnimationLoop=function(A){bi=A,se.setAnimationLoop(A),A===null?ie.stop():ie.start()},se.addEventListener("sessionstart",F),se.addEventListener("sessionend",W),this.render=function(A,z){if(z!==void 0&&z.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(x===!0)return;if(A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),z.parent===null&&z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),se.enabled===!0&&se.isPresenting===!0&&(se.cameraAutoUpdate===!0&&se.updateCamera(z),z=se.getCamera()),A.isScene===!0&&A.onBeforeRender(S,A,z,E),g=ke.get(A,y.length),g.init(z),y.push(g),he.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),I.setFromProjectionMatrix(he),K=this.localClippingEnabled,$=ue.init(this.clippingPlanes,K),v=le.get(A,m.length),v.init(),m.push(v),se.enabled===!0&&se.isPresenting===!0){const ve=S.xr.getDepthSensingMesh();ve!==null&&fe(ve,z,-1/0,S.sortObjects)}fe(A,z,0,S.sortObjects),v.finish(),S.sortObjects===!0&&v.sort(D,ne),it=se.enabled===!1||se.isPresenting===!1||se.hasDepthSensing()===!1,it&&Te.addToRenderList(v,A),this.info.render.frame++,$===!0&&ue.beginShadows();const q=g.state.shadowsArray;Ce.render(q,A,z),$===!0&&ue.endShadows(),this.info.autoReset===!0&&this.info.reset();const te=v.opaque,j=v.transmissive;if(g.setupLights(),z.isArrayCamera){const ve=z.cameras;if(j.length>0)for(let we=0,Ve=ve.length;we<Ve;we++){const je=ve[we];tt(te,j,A,je)}it&&Te.render(A);for(let we=0,Ve=ve.length;we<Ve;we++){const je=ve[we];Oe(v,A,je,je.viewport)}}else j.length>0&&tt(te,j,A,z),it&&Te.render(A),Oe(v,A,z);E!==null&&(k.updateMultisampleRenderTarget(E),k.updateRenderTargetMipmap(E)),A.isScene===!0&&A.onAfterRender(S,A,z),Dt.resetDefaultState(),b=-1,M=null,y.pop(),y.length>0?(g=y[y.length-1],$===!0&&ue.setGlobalState(S.clippingPlanes,g.state.camera)):g=null,m.pop(),m.length>0?v=m[m.length-1]:v=null};function fe(A,z,q,te){if(A.visible===!1)return;if(A.layers.test(z.layers)){if(A.isGroup)q=A.renderOrder;else if(A.isLOD)A.autoUpdate===!0&&A.update(z);else if(A.isLight)g.pushLight(A),A.castShadow&&g.pushShadow(A);else if(A.isSprite){if(!A.frustumCulled||I.intersectsSprite(A)){te&&Me.setFromMatrixPosition(A.matrixWorld).applyMatrix4(he);const we=de.update(A),Ve=A.material;Ve.visible&&v.push(A,we,Ve,q,Me.z,null)}}else if((A.isMesh||A.isLine||A.isPoints)&&(!A.frustumCulled||I.intersectsObject(A))){const we=de.update(A),Ve=A.material;if(te&&(A.boundingSphere!==void 0?(A.boundingSphere===null&&A.computeBoundingSphere(),Me.copy(A.boundingSphere.center)):(we.boundingSphere===null&&we.computeBoundingSphere(),Me.copy(we.boundingSphere.center)),Me.applyMatrix4(A.matrixWorld).applyMatrix4(he)),Array.isArray(Ve)){const je=we.groups;for(let at=0,ft=je.length;at<ft;at++){const Je=je[at],Ke=Ve[Je.materialIndex];Ke&&Ke.visible&&v.push(A,we,Ke,q,Me.z,Je)}}else Ve.visible&&v.push(A,we,Ve,q,Me.z,null)}}const ve=A.children;for(let we=0,Ve=ve.length;we<Ve;we++)fe(ve[we],z,q,te)}function Oe(A,z,q,te){const j=A.opaque,ve=A.transmissive,we=A.transparent;g.setupLightsView(q),$===!0&&ue.setGlobalState(S.clippingPlanes,q),te&&lt.viewport(_.copy(te)),j.length>0&&ut(j,z,q),ve.length>0&&ut(ve,z,q),we.length>0&&ut(we,z,q),lt.buffers.depth.setTest(!0),lt.buffers.depth.setMask(!0),lt.buffers.color.setMask(!0),lt.setPolygonOffset(!1)}function tt(A,z,q,te){if((q.isScene===!0?q.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[te.id]===void 0&&(g.state.transmissionRenderTarget[te.id]=new Mu(1,1,{generateMipmaps:!0,type:xt.has("EXT_color_buffer_half_float")||xt.has("EXT_color_buffer_float")?D0:Ya,minFilter:za,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Pt.workingColorSpace}));const ve=g.state.transmissionRenderTarget[te.id],we=te.viewport||_;ve.setSize(we.z,we.w);const Ve=S.getRenderTarget();S.setRenderTarget(ve),S.getClearColor(O),V=S.getClearAlpha(),V<1&&S.setClearColor(16777215,.5),S.clear(),it&&Te.render(q);const je=S.toneMapping;S.toneMapping=Yc;const at=te.viewport;if(te.viewport!==void 0&&(te.viewport=void 0),g.setupLightsView(te),$===!0&&ue.setGlobalState(S.clippingPlanes,te),ut(A,q,te),k.updateMultisampleRenderTarget(ve),k.updateRenderTargetMipmap(ve),xt.has("WEBGL_multisampled_render_to_texture")===!1){let ft=!1;for(let Je=0,Ke=z.length;Je<Ke;Je++){const vt=z[Je],rn=vt.object,fi=vt.geometry,mt=vt.material,Ye=vt.group;if(mt.side===Zo&&rn.layers.test(te.layers)){const si=mt.side;mt.side=br,mt.needsUpdate=!0,Be(rn,q,te,fi,mt,Ye),mt.side=si,mt.needsUpdate=!0,ft=!0}}ft===!0&&(k.updateMultisampleRenderTarget(ve),k.updateRenderTargetMipmap(ve))}S.setRenderTarget(Ve),S.setClearColor(O,V),at!==void 0&&(te.viewport=at),S.toneMapping=je}function ut(A,z,q){const te=z.isScene===!0?z.overrideMaterial:null;for(let j=0,ve=A.length;j<ve;j++){const we=A[j],Ve=we.object,je=we.geometry,at=te===null?we.material:te,ft=we.group;Ve.layers.test(q.layers)&&Be(Ve,z,q,je,at,ft)}}function Be(A,z,q,te,j,ve){A.onBeforeRender(S,z,q,te,j,ve),A.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,A.matrixWorld),A.normalMatrix.getNormalMatrix(A.modelViewMatrix),j.onBeforeRender(S,z,q,te,A,ve),j.transparent===!0&&j.side===Zo&&j.forceSinglePass===!1?(j.side=br,j.needsUpdate=!0,S.renderBufferDirect(q,z,te,j,A,ve),j.side=Ka,j.needsUpdate=!0,S.renderBufferDirect(q,z,te,j,A,ve),j.side=Zo):S.renderBufferDirect(q,z,te,j,A,ve),A.onAfterRender(S,z,q,te,j,ve)}function Ue(A,z,q){z.isScene!==!0&&(z=dt);const te=pt.get(A),j=g.state.lights,ve=g.state.shadowsArray,we=j.state.version,Ve=H.getParameters(A,j.state,ve,z,q),je=H.getProgramCacheKey(Ve);let at=te.programs;te.environment=A.isMeshStandardMaterial?z.environment:null,te.fog=z.fog,te.envMap=(A.isMeshStandardMaterial?Q:T).get(A.envMap||te.environment),te.envMapRotation=te.environment!==null&&A.envMap===null?z.environmentRotation:A.envMapRotation,at===void 0&&(A.addEventListener("dispose",Ft),at=new Map,te.programs=at);let ft=at.get(je);if(ft!==void 0){if(te.currentProgram===ft&&te.lightsStateVersion===we)return rt(A,Ve),ft}else Ve.uniforms=H.getUniforms(A),A.onBeforeCompile(Ve,S),ft=H.acquireProgram(Ve,je),at.set(je,ft),te.uniforms=Ve.uniforms;const Je=te.uniforms;return(!A.isShaderMaterial&&!A.isRawShaderMaterial||A.clipping===!0)&&(Je.clippingPlanes=ue.uniform),rt(A,Ve),te.needsLights=pi(A),te.lightsStateVersion=we,te.needsLights&&(Je.ambientLightColor.value=j.state.ambient,Je.lightProbe.value=j.state.probe,Je.directionalLights.value=j.state.directional,Je.directionalLightShadows.value=j.state.directionalShadow,Je.spotLights.value=j.state.spot,Je.spotLightShadows.value=j.state.spotShadow,Je.rectAreaLights.value=j.state.rectArea,Je.ltc_1.value=j.state.rectAreaLTC1,Je.ltc_2.value=j.state.rectAreaLTC2,Je.pointLights.value=j.state.point,Je.pointLightShadows.value=j.state.pointShadow,Je.hemisphereLights.value=j.state.hemi,Je.directionalShadowMap.value=j.state.directionalShadowMap,Je.directionalShadowMatrix.value=j.state.directionalShadowMatrix,Je.spotShadowMap.value=j.state.spotShadowMap,Je.spotLightMatrix.value=j.state.spotLightMatrix,Je.spotLightMap.value=j.state.spotLightMap,Je.pointShadowMap.value=j.state.pointShadowMap,Je.pointShadowMatrix.value=j.state.pointShadowMatrix),te.currentProgram=ft,te.uniformsList=null,ft}function Fe(A){if(A.uniformsList===null){const z=A.currentProgram.getUniforms();A.uniformsList=Uy.seqWithValue(z.seq,A.uniforms)}return A.uniformsList}function rt(A,z){const q=pt.get(A);q.outputColorSpace=z.outputColorSpace,q.batching=z.batching,q.batchingColor=z.batchingColor,q.instancing=z.instancing,q.instancingColor=z.instancingColor,q.instancingMorph=z.instancingMorph,q.skinning=z.skinning,q.morphTargets=z.morphTargets,q.morphNormals=z.morphNormals,q.morphColors=z.morphColors,q.morphTargetsCount=z.morphTargetsCount,q.numClippingPlanes=z.numClippingPlanes,q.numIntersection=z.numClipIntersection,q.vertexAlphas=z.vertexAlphas,q.vertexTangents=z.vertexTangents,q.toneMapping=z.toneMapping}function Ot(A,z,q,te,j){z.isScene!==!0&&(z=dt),k.resetTextureUnits();const ve=z.fog,we=te.isMeshStandardMaterial?z.environment:null,Ve=E===null?S.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:qi,je=(te.isMeshStandardMaterial?Q:T).get(te.envMap||we),at=te.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,ft=!!q.attributes.tangent&&(!!te.normalMap||te.anisotropy>0),Je=!!q.morphAttributes.position,Ke=!!q.morphAttributes.normal,vt=!!q.morphAttributes.color;let rn=Yc;te.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(rn=S.toneMapping);const fi=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,mt=fi!==void 0?fi.length:0,Ye=pt.get(te),si=g.state.lights;if($===!0&&(K===!0||A!==M)){const Ts=A===M&&te.id===b;ue.setState(te,A,Ts)}let en=!1;te.version===Ye.__version?(Ye.needsLights&&Ye.lightsStateVersion!==si.state.version||Ye.outputColorSpace!==Ve||j.isBatchedMesh&&Ye.batching===!1||!j.isBatchedMesh&&Ye.batching===!0||j.isBatchedMesh&&Ye.batchingColor===!0&&j.colorTexture===null||j.isBatchedMesh&&Ye.batchingColor===!1&&j.colorTexture!==null||j.isInstancedMesh&&Ye.instancing===!1||!j.isInstancedMesh&&Ye.instancing===!0||j.isSkinnedMesh&&Ye.skinning===!1||!j.isSkinnedMesh&&Ye.skinning===!0||j.isInstancedMesh&&Ye.instancingColor===!0&&j.instanceColor===null||j.isInstancedMesh&&Ye.instancingColor===!1&&j.instanceColor!==null||j.isInstancedMesh&&Ye.instancingMorph===!0&&j.morphTexture===null||j.isInstancedMesh&&Ye.instancingMorph===!1&&j.morphTexture!==null||Ye.envMap!==je||te.fog===!0&&Ye.fog!==ve||Ye.numClippingPlanes!==void 0&&(Ye.numClippingPlanes!==ue.numPlanes||Ye.numIntersection!==ue.numIntersection)||Ye.vertexAlphas!==at||Ye.vertexTangents!==ft||Ye.morphTargets!==Je||Ye.morphNormals!==Ke||Ye.morphColors!==vt||Ye.toneMapping!==rn||Ye.morphTargetsCount!==mt)&&(en=!0):(en=!0,Ye.__version=te.version);let oo=Ye.currentProgram;en===!0&&(oo=Ue(te,z,j));let ah=!1,ts=!1,YC=!1;const Zn=oo.getUniforms(),oc=Ye.uniforms;if(lt.useProgram(oo.program)&&(ah=!0,ts=!0,YC=!0),te.id!==b&&(b=te.id,ts=!0),ah||M!==A){Mt.reverseDepthBuffer?(oe.copy(A.projectionMatrix),UJ(oe),BJ(oe),Zn.setValue(U,"projectionMatrix",oe)):Zn.setValue(U,"projectionMatrix",A.projectionMatrix),Zn.setValue(U,"viewMatrix",A.matrixWorldInverse);const Ts=Zn.map.cameraPosition;Ts!==void 0&&Ts.setValue(U,ze.setFromMatrixPosition(A.matrixWorld)),Mt.logarithmicDepthBuffer&&Zn.setValue(U,"logDepthBufFC",2/(Math.log(A.far+1)/Math.LN2)),(te.isMeshPhongMaterial||te.isMeshToonMaterial||te.isMeshLambertMaterial||te.isMeshBasicMaterial||te.isMeshStandardMaterial||te.isShaderMaterial)&&Zn.setValue(U,"isOrthographic",A.isOrthographicCamera===!0),M!==A&&(M=A,ts=!0,YC=!0)}if(j.isSkinnedMesh){Zn.setOptional(U,j,"bindMatrix"),Zn.setOptional(U,j,"bindMatrixInverse");const Ts=j.skeleton;Ts&&(Ts.boneTexture===null&&Ts.computeBoneTexture(),Zn.setValue(U,"boneTexture",Ts.boneTexture,k))}j.isBatchedMesh&&(Zn.setOptional(U,j,"batchingTexture"),Zn.setValue(U,"batchingTexture",j._matricesTexture,k),Zn.setOptional(U,j,"batchingIdTexture"),Zn.setValue(U,"batchingIdTexture",j._indirectTexture,k),Zn.setOptional(U,j,"batchingColorTexture"),j._colorsTexture!==null&&Zn.setValue(U,"batchingColorTexture",j._colorsTexture,k));const JC=q.morphAttributes;if((JC.position!==void 0||JC.normal!==void 0||JC.color!==void 0)&&Ze.update(j,q,oo),(ts||Ye.receiveShadow!==j.receiveShadow)&&(Ye.receiveShadow=j.receiveShadow,Zn.setValue(U,"receiveShadow",j.receiveShadow)),te.isMeshGouraudMaterial&&te.envMap!==null&&(oc.envMap.value=je,oc.flipEnvMap.value=je.isCubeTexture&&je.isRenderTargetTexture===!1?-1:1),te.isMeshStandardMaterial&&te.envMap===null&&z.environment!==null&&(oc.envMapIntensity.value=z.environmentIntensity),ts&&(Zn.setValue(U,"toneMappingExposure",S.toneMappingExposure),Ye.needsLights&&Vt(oc,YC),ve&&te.fog===!0&&Y.refreshFogUniforms(oc,ve),Y.refreshMaterialUniforms(oc,te,J,G,g.state.transmissionRenderTarget[A.id]),Uy.upload(U,Fe(Ye),oc,k)),te.isShaderMaterial&&te.uniformsNeedUpdate===!0&&(Uy.upload(U,Fe(Ye),oc,k),te.uniformsNeedUpdate=!1),te.isSpriteMaterial&&Zn.setValue(U,"center",j.center),Zn.setValue(U,"modelViewMatrix",j.modelViewMatrix),Zn.setValue(U,"normalMatrix",j.normalMatrix),Zn.setValue(U,"modelMatrix",j.matrixWorld),te.isShaderMaterial||te.isRawShaderMaterial){const Ts=te.uniformsGroups;for(let QC=0,w7=Ts.length;QC<w7;QC++){const cI=Ts[QC];B.update(cI,oo),B.bind(cI,oo)}}return oo}function Vt(A,z){A.ambientLightColor.needsUpdate=z,A.lightProbe.needsUpdate=z,A.directionalLights.needsUpdate=z,A.directionalLightShadows.needsUpdate=z,A.pointLights.needsUpdate=z,A.pointLightShadows.needsUpdate=z,A.spotLights.needsUpdate=z,A.spotLightShadows.needsUpdate=z,A.rectAreaLights.needsUpdate=z,A.hemisphereLights.needsUpdate=z}function pi(A){return A.isMeshLambertMaterial||A.isMeshToonMaterial||A.isMeshPhongMaterial||A.isMeshStandardMaterial||A.isShadowMaterial||A.isShaderMaterial&&A.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(A,z,q){pt.get(A.texture).__webglTexture=z,pt.get(A.depthTexture).__webglTexture=q;const te=pt.get(A);te.__hasExternalTextures=!0,te.__autoAllocateDepthBuffer=q===void 0,te.__autoAllocateDepthBuffer||xt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),te.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(A,z){const q=pt.get(A);q.__webglFramebuffer=z,q.__useDefaultFramebuffer=z===void 0},this.setRenderTarget=function(A,z=0,q=0){E=A,w=z,C=q;let te=!0,j=null,ve=!1,we=!1;if(A){const je=pt.get(A);if(je.__useDefaultFramebuffer!==void 0)lt.bindFramebuffer(U.FRAMEBUFFER,null),te=!1;else if(je.__webglFramebuffer===void 0)k.setupRenderTarget(A);else if(je.__hasExternalTextures)k.rebindTextures(A,pt.get(A.texture).__webglTexture,pt.get(A.depthTexture).__webglTexture);else if(A.depthBuffer){const Je=A.depthTexture;if(je.__boundDepthTexture!==Je){if(Je!==null&&pt.has(Je)&&(A.width!==Je.image.width||A.height!==Je.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");k.setupDepthRenderbuffer(A)}}const at=A.texture;(at.isData3DTexture||at.isDataArrayTexture||at.isCompressedArrayTexture)&&(we=!0);const ft=pt.get(A).__webglFramebuffer;A.isWebGLCubeRenderTarget?(Array.isArray(ft[z])?j=ft[z][q]:j=ft[z],ve=!0):A.samples>0&&k.useMultisampledRTT(A)===!1?j=pt.get(A).__webglMultisampledFramebuffer:Array.isArray(ft)?j=ft[q]:j=ft,_.copy(A.viewport),R.copy(A.scissor),L=A.scissorTest}else _.copy(P).multiplyScalar(J).floor(),R.copy(ee).multiplyScalar(J).floor(),L=ge;if(lt.bindFramebuffer(U.FRAMEBUFFER,j)&&te&&lt.drawBuffers(A,j),lt.viewport(_),lt.scissor(R),lt.setScissorTest(L),ve){const je=pt.get(A.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+z,je.__webglTexture,q)}else if(we){const je=pt.get(A.texture),at=z||0;U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,je.__webglTexture,q||0,at)}b=-1},this.readRenderTargetPixels=function(A,z,q,te,j,ve,we){if(!(A&&A.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ve=pt.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&we!==void 0&&(Ve=Ve[we]),Ve){lt.bindFramebuffer(U.FRAMEBUFFER,Ve);try{const je=A.texture,at=je.format,ft=je.type;if(!Mt.textureFormatReadable(at)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Mt.textureTypeReadable(ft)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z>=0&&z<=A.width-te&&q>=0&&q<=A.height-j&&U.readPixels(z,q,te,j,et.convert(at),et.convert(ft),ve)}finally{const je=E!==null?pt.get(E).__webglFramebuffer:null;lt.bindFramebuffer(U.FRAMEBUFFER,je)}}},this.readRenderTargetPixelsAsync=async function(A,z,q,te,j,ve,we){if(!(A&&A.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ve=pt.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&we!==void 0&&(Ve=Ve[we]),Ve){const je=A.texture,at=je.format,ft=je.type;if(!Mt.textureFormatReadable(at))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Mt.textureTypeReadable(ft))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(z>=0&&z<=A.width-te&&q>=0&&q<=A.height-j){lt.bindFramebuffer(U.FRAMEBUFFER,Ve);const Je=U.createBuffer();U.bindBuffer(U.PIXEL_PACK_BUFFER,Je),U.bufferData(U.PIXEL_PACK_BUFFER,ve.byteLength,U.STREAM_READ),U.readPixels(z,q,te,j,et.convert(at),et.convert(ft),0);const Ke=E!==null?pt.get(E).__webglFramebuffer:null;lt.bindFramebuffer(U.FRAMEBUFFER,Ke);const vt=U.fenceSync(U.SYNC_GPU_COMMANDS_COMPLETE,0);return U.flush(),await zJ(U,vt,4),U.bindBuffer(U.PIXEL_PACK_BUFFER,Je),U.getBufferSubData(U.PIXEL_PACK_BUFFER,0,ve),U.deleteBuffer(Je),U.deleteSync(vt),ve}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(A,z=null,q=0){A.isTexture!==!0&&(zy("WebGLRenderer: copyFramebufferToTexture function signature has changed."),z=arguments[0]||null,A=arguments[1]);const te=Math.pow(2,-q),j=Math.floor(A.image.width*te),ve=Math.floor(A.image.height*te),we=z!==null?z.x:0,Ve=z!==null?z.y:0;k.setTexture2D(A,0),U.copyTexSubImage2D(U.TEXTURE_2D,q,0,0,we,Ve,j,ve),lt.unbindTexture()},this.copyTextureToTexture=function(A,z,q=null,te=null,j=0){A.isTexture!==!0&&(zy("WebGLRenderer: copyTextureToTexture function signature has changed."),te=arguments[0]||null,A=arguments[1],z=arguments[2],j=arguments[3]||0,q=null);let ve,we,Ve,je,at,ft;q!==null?(ve=q.max.x-q.min.x,we=q.max.y-q.min.y,Ve=q.min.x,je=q.min.y):(ve=A.image.width,we=A.image.height,Ve=0,je=0),te!==null?(at=te.x,ft=te.y):(at=0,ft=0);const Je=et.convert(z.format),Ke=et.convert(z.type);k.setTexture2D(z,0),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,z.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,z.unpackAlignment);const vt=U.getParameter(U.UNPACK_ROW_LENGTH),rn=U.getParameter(U.UNPACK_IMAGE_HEIGHT),fi=U.getParameter(U.UNPACK_SKIP_PIXELS),mt=U.getParameter(U.UNPACK_SKIP_ROWS),Ye=U.getParameter(U.UNPACK_SKIP_IMAGES),si=A.isCompressedTexture?A.mipmaps[j]:A.image;U.pixelStorei(U.UNPACK_ROW_LENGTH,si.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,si.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,Ve),U.pixelStorei(U.UNPACK_SKIP_ROWS,je),A.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,j,at,ft,ve,we,Je,Ke,si.data):A.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,j,at,ft,si.width,si.height,Je,si.data):U.texSubImage2D(U.TEXTURE_2D,j,at,ft,ve,we,Je,Ke,si),U.pixelStorei(U.UNPACK_ROW_LENGTH,vt),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,rn),U.pixelStorei(U.UNPACK_SKIP_PIXELS,fi),U.pixelStorei(U.UNPACK_SKIP_ROWS,mt),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Ye),j===0&&z.generateMipmaps&&U.generateMipmap(U.TEXTURE_2D),lt.unbindTexture()},this.copyTextureToTexture3D=function(A,z,q=null,te=null,j=0){A.isTexture!==!0&&(zy("WebGLRenderer: copyTextureToTexture3D function signature has changed."),q=arguments[0]||null,te=arguments[1]||null,A=arguments[2],z=arguments[3],j=arguments[4]||0);let ve,we,Ve,je,at,ft,Je,Ke,vt;const rn=A.isCompressedTexture?A.mipmaps[j]:A.image;q!==null?(ve=q.max.x-q.min.x,we=q.max.y-q.min.y,Ve=q.max.z-q.min.z,je=q.min.x,at=q.min.y,ft=q.min.z):(ve=rn.width,we=rn.height,Ve=rn.depth,je=0,at=0,ft=0),te!==null?(Je=te.x,Ke=te.y,vt=te.z):(Je=0,Ke=0,vt=0);const fi=et.convert(z.format),mt=et.convert(z.type);let Ye;if(z.isData3DTexture)k.setTexture3D(z,0),Ye=U.TEXTURE_3D;else if(z.isDataArrayTexture||z.isCompressedArrayTexture)k.setTexture2DArray(z,0),Ye=U.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,z.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,z.unpackAlignment);const si=U.getParameter(U.UNPACK_ROW_LENGTH),en=U.getParameter(U.UNPACK_IMAGE_HEIGHT),oo=U.getParameter(U.UNPACK_SKIP_PIXELS),ah=U.getParameter(U.UNPACK_SKIP_ROWS),ts=U.getParameter(U.UNPACK_SKIP_IMAGES);U.pixelStorei(U.UNPACK_ROW_LENGTH,rn.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,rn.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,je),U.pixelStorei(U.UNPACK_SKIP_ROWS,at),U.pixelStorei(U.UNPACK_SKIP_IMAGES,ft),A.isDataTexture||A.isData3DTexture?U.texSubImage3D(Ye,j,Je,Ke,vt,ve,we,Ve,fi,mt,rn.data):z.isCompressedArrayTexture?U.compressedTexSubImage3D(Ye,j,Je,Ke,vt,ve,we,Ve,fi,rn.data):U.texSubImage3D(Ye,j,Je,Ke,vt,ve,we,Ve,fi,mt,rn),U.pixelStorei(U.UNPACK_ROW_LENGTH,si),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,en),U.pixelStorei(U.UNPACK_SKIP_PIXELS,oo),U.pixelStorei(U.UNPACK_SKIP_ROWS,ah),U.pixelStorei(U.UNPACK_SKIP_IMAGES,ts),j===0&&z.generateMipmaps&&U.generateMipmap(Ye),lt.unbindTexture()},this.initRenderTarget=function(A){pt.get(A).__webglFramebuffer===void 0&&k.setupRenderTarget(A)},this.initTexture=function(A){A.isCubeTexture?k.setTextureCube(A,0):A.isData3DTexture?k.setTexture3D(A,0):A.isDataArrayTexture||A.isCompressedArrayTexture?k.setTexture2DArray(A,0):k.setTexture2D(A,0),lt.unbindTexture()},this.resetState=function(){w=0,C=0,E=null,lt.reset(),Dt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ua}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=e===G2?"display-p3":"srgb",n.unpackColorSpace=Pt.workingColorSpace===Jx?"display-p3":"srgb"}}class s5 extends Sn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new fn,this.environmentIntensity=1,this.environmentRotation=new fn,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class Jne{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=eb,this.updateRanges=[],this.version=0,this.uuid=Ao()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,i){e*=this.stride,i*=n.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=n.array[i+r];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ao()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(n,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ao()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Sr=new N;class Z2{constructor(e,n,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,i=this.data.count;n<i;n++)Sr.fromBufferAttribute(this,n),Sr.applyMatrix4(e),this.setXYZ(n,Sr.x,Sr.y,Sr.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)Sr.fromBufferAttribute(this,n),Sr.applyNormalMatrix(e),this.setXYZ(n,Sr.x,Sr.y,Sr.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)Sr.fromBufferAttribute(this,n),Sr.transformDirection(e),this.setXYZ(n,Sr.x,Sr.y,Sr.z);return this}getComponent(e,n){let i=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(i=_o(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=sn(i,this.array)),this.data.array[e*this.data.stride+this.offset+n]=i,this}setX(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=_o(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=_o(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=_o(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=_o(n,this.array)),n}setXY(e,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this}setXYZ(e,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,n,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array),s=sn(s,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[r+s])}return new Tr(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Z2(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const UL=new N,BL=new Gt,$L=new Gt,Qne=new N,HL=new Ge,Vv=new N,Cw=new da,VL=new Ge,_w=new cp;class eA extends gn{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Kk,this.bindMatrix=new Ge,this.bindMatrixInverse=new Ge,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ha),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)this.getVertexPosition(i,Vv),this.boundingBox.expandByPoint(Vv)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new da),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)this.getVertexPosition(i,Vv),this.boundingSphere.expandByPoint(Vv)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Cw.copy(this.boundingSphere),Cw.applyMatrix4(r),e.ray.intersectsSphere(Cw)!==!1&&(VL.copy(r).invert(),_w.copy(e.ray).applyMatrix4(VL),!(this.boundingBox!==null&&_w.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,_w)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Gt,n=this.geometry.attributes.skinWeight;for(let i=0,r=n.count;i<r;i++){e.fromBufferAttribute(n,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),n.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Kk?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===oJ?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const i=this.skeleton,r=this.geometry;BL.fromBufferAttribute(r.attributes.skinIndex,e),$L.fromBufferAttribute(r.attributes.skinWeight,e),UL.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let s=0;s<4;s++){const o=$L.getComponent(s);if(o!==0){const a=BL.getComponent(s);HL.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),n.addScaledVector(Qne.copy(UL).applyMatrix4(HL),o)}}return n.applyMatrix4(this.bindMatrixInverse)}}class Zg extends Sn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class o5 extends wi{constructor(e=null,n=1,i=1,r,s,o,a,c,l=Er,u=Er,h,d){super(null,o,a,c,l,u,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:n,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const jL=new Ge,Zne=new Ge;class N0{constructor(e=[],n=[]){this.uuid=Ao(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Ge)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const i=new Ge;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,n=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:Zne;jL.multiplyMatrices(a,n[s]),jL.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new N0(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const i=new o5(n,e,e,Bs,Ro);return i.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=i,this}getBoneByName(e){for(let n=0,i=this.bones.length;n<i;n++){const r=this.bones[n];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=n[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new Zg),this.bones.push(o),this.boneInverses.push(new Ge().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,i=this.boneInverses;for(let r=0,s=n.length;r<s;r++){const o=n[r];e.bones.push(o.uuid);const a=i[r];e.boneInverses.push(a.toArray())}return e}}class ib extends Tr{constructor(e,n,i,r=1){super(e,n,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Rh=new Ge,WL=new Ge,jv=[],GL=new ha,eie=new Ge,Lm=new gn,Dm=new da;class tie extends gn{constructor(e,n,i){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new ib(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,eie)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new ha),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,Rh),GL.copy(e.boundingBox).applyMatrix4(Rh),this.boundingBox.union(GL)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new da),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,Rh),Dm.copy(e.boundingSphere).applyMatrix4(Rh),this.boundingSphere.union(Dm)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const i=n.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,o=e*s+1;for(let a=0;a<i.length;a++)i[a]=r[o+a]}raycast(e,n){const i=this.matrixWorld,r=this.count;if(Lm.geometry=this.geometry,Lm.material=this.material,Lm.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Dm.copy(this.boundingSphere),Dm.applyMatrix4(i),e.ray.intersectsSphere(Dm)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Rh),WL.multiplyMatrices(i,Rh),Lm.matrixWorld=WL,Lm.raycast(e,jv);for(let o=0,a=jv.length;o<a;o++){const c=jv[o];c.instanceId=s,c.object=this,n.push(c)}jv.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new ib(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const i=n.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new o5(new Float32Array(r*this.count),r,this.count,$2,Ro));const s=this.morphTexture.source.data.data;let o=0;for(let l=0;l<i.length;l++)o+=i[l];const a=this.geometry.morphTargetsRelative?1:1-o,c=r*e;s[c]=a,s.set(i,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class tA extends qs{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Xe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const M1=new N,k1=new N,qL=new Ge,Nm=new cp,Wv=new da,ww=new N,XL=new N;class eC extends Sn{constructor(e=new ys,n=new tA){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[0];for(let r=1,s=n.count;r<s;r++)M1.fromBufferAttribute(n,r-1),k1.fromBufferAttribute(n,r),i[r]=i[r-1],i[r]+=M1.distanceTo(k1);e.setAttribute("lineDistance",new wr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Wv.copy(i.boundingSphere),Wv.applyMatrix4(r),Wv.radius+=s,e.ray.intersectsSphere(Wv)===!1)return;qL.copy(r).invert(),Nm.copy(e.ray).applyMatrix4(qL);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=this.isLineSegments?2:1,u=i.index,d=i.attributes.position;if(u!==null){const p=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let v=p,g=f-1;v<g;v+=l){const m=u.getX(v),y=u.getX(v+1),S=Gv(this,e,Nm,c,m,y);S&&n.push(S)}if(this.isLineLoop){const v=u.getX(f-1),g=u.getX(p),m=Gv(this,e,Nm,c,v,g);m&&n.push(m)}}else{const p=Math.max(0,o.start),f=Math.min(d.count,o.start+o.count);for(let v=p,g=f-1;v<g;v+=l){const m=Gv(this,e,Nm,c,v,v+1);m&&n.push(m)}if(this.isLineLoop){const v=Gv(this,e,Nm,c,f-1,p);v&&n.push(v)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Gv(t,e,n,i,r,s){const o=t.geometry.attributes.position;if(M1.fromBufferAttribute(o,r),k1.fromBufferAttribute(o,s),n.distanceSqToSegment(M1,k1,ww,XL)>i)return;ww.applyMatrix4(t.matrixWorld);const c=e.ray.origin.distanceTo(ww);if(!(c<e.near||c>e.far))return{distance:c,point:XL.clone().applyMatrix4(t.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:t}}const KL=new N,YL=new N;class nie extends eC{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[];for(let r=0,s=n.count;r<s;r+=2)KL.fromBufferAttribute(n,r),YL.fromBufferAttribute(n,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+KL.distanceTo(YL);e.setAttribute("lineDistance",new wr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class iie extends eC{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class a5 extends qs{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Xe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const JL=new Ge,rb=new cp,qv=new da,Xv=new N;class rie extends Sn{constructor(e=new ys,n=new a5){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),qv.copy(i.boundingSphere),qv.applyMatrix4(r),qv.radius+=s,e.ray.intersectsSphere(qv)===!1)return;JL.copy(r).invert(),rb.copy(e.ray).applyMatrix4(JL);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=i.index,h=i.attributes.position;if(l!==null){const d=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);for(let f=d,v=p;f<v;f++){const g=l.getX(f);Xv.fromBufferAttribute(h,g),QL(Xv,g,c,r,e,n,this)}}else{const d=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let f=d,v=p;f<v;f++)Xv.fromBufferAttribute(h,f),QL(Xv,f,c,r,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function QL(t,e,n,i,r,s,o){const a=rb.distanceSqToPoint(t);if(a<n){const c=new N;rb.closestPointToPoint(t,c),c.applyMatrix4(i);const l=r.ray.origin.distanceTo(c);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class sie{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){const i=this.getUtoTmapping(e);return this.getPoint(i,n)}getPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return n}getSpacedPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPointAt(i/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let i,r=this.getPoint(0),s=0;n.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),n.push(s),r=i;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){const i=this.getLengths();let r=0;const s=i.length;let o;n?o=n:o=e*i[s-1];let a=0,c=s-1,l;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),l=i[r]-o,l<0)a=r+1;else if(l>0)c=r-1;else{c=r;break}if(r=c,i[r]===o)return r/(s-1);const u=i[r],d=i[r+1]-u,p=(o-u)/d;return(r+p)/(s-1)}getTangent(e,n){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),c=n||(o.isVector2?new gt:new N);return c.copy(a).sub(o).normalize(),c}getTangentAt(e,n){const i=this.getUtoTmapping(e);return this.getTangent(i,n)}computeFrenetFrames(e,n){const i=new N,r=[],s=[],o=[],a=new N,c=new Ge;for(let p=0;p<=e;p++){const f=p/e;r[p]=this.getTangentAt(f,new N)}s[0]=new N,o[0]=new N;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=l&&(l=u,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),d<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let p=1;p<=e;p++){if(s[p]=s[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(r[p-1],r[p]),a.length()>Number.EPSILON){a.normalize();const f=Math.acos(yi(r[p-1].dot(r[p]),-1,1));s[p].applyMatrix4(c.makeRotationAxis(a,f))}o[p].crossVectors(r[p],s[p])}if(n===!0){let p=Math.acos(yi(s[0].dot(s[e]),-1,1));p/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(p=-p);for(let f=1;f<=e;f++)s[f].applyMatrix4(c.makeRotationAxis(r[f],p*f)),o[f].crossVectors(r[f],s[f])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}const oie={triangulate:function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=c5(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,l,u,h,d,p;if(i&&(s=hie(t,e,s,n)),t.length>80*n){a=l=t[0],c=u=t[1];for(let f=n;f<r;f+=n)h=t[f],d=t[f+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=p!==0?32767/p:0}return e0(s,o,n,a,c,p,0),o}};function c5(t,e,n,i,r){let s,o;if(r===_ie(t,e,n,i)>0)for(s=e;s<n;s+=i)o=ZL(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=ZL(s,t[s],t[s+1],o);return o&&tC(o,o.next)&&(n0(o),o=o.next),o}function ku(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(tC(n,n.next)||$n(n.prev,n,n.next)===0)){if(n0(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function e0(t,e,n,i,r,s,o){if(!t)return;!o&&s&&gie(t,i,r,s);let a=t,c,l;for(;t.prev!==t.next;){if(c=t.prev,l=t.next,s?cie(t,i,r,s):aie(t)){e.push(c.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),n0(t),t=l.next,a=l.next;continue}if(t=l,t===a){o?o===1?(t=lie(ku(t),e,n),e0(t,e,n,i,r,s,2)):o===2&&uie(t,e,n,i,r,s):e0(ku(t),e,n,i,r,s,1);break}}}function aie(t){const e=t.prev,n=t,i=t.next;if($n(e,n,i)>=0)return!1;const r=e.x,s=n.x,o=i.x,a=e.y,c=n.y,l=i.y,u=r<s?r<o?r:o:s<o?s:o,h=a<c?a<l?a:l:c<l?c:l,d=r>s?r>o?r:o:s>o?s:o,p=a>c?a>l?a:l:c>l?c:l;let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Qh(r,a,s,c,o,l,f.x,f.y)&&$n(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function cie(t,e,n,i){const r=t.prev,s=t,o=t.next;if($n(r,s,o)>=0)return!1;const a=r.x,c=s.x,l=o.x,u=r.y,h=s.y,d=o.y,p=a<c?a<l?a:l:c<l?c:l,f=u<h?u<d?u:d:h<d?h:d,v=a>c?a>l?a:l:c>l?c:l,g=u>h?u>d?u:d:h>d?h:d,m=sb(p,f,e,n,i),y=sb(v,g,e,n,i);let S=t.prevZ,x=t.nextZ;for(;S&&S.z>=m&&x&&x.z<=y;){if(S.x>=p&&S.x<=v&&S.y>=f&&S.y<=g&&S!==r&&S!==o&&Qh(a,u,c,h,l,d,S.x,S.y)&&$n(S.prev,S,S.next)>=0||(S=S.prevZ,x.x>=p&&x.x<=v&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Qh(a,u,c,h,l,d,x.x,x.y)&&$n(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;S&&S.z>=m;){if(S.x>=p&&S.x<=v&&S.y>=f&&S.y<=g&&S!==r&&S!==o&&Qh(a,u,c,h,l,d,S.x,S.y)&&$n(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=v&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Qh(a,u,c,h,l,d,x.x,x.y)&&$n(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function lie(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!tC(r,s)&&l5(r,i,i.next,s)&&t0(r,s)&&t0(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),n0(i),n0(i.next),i=t=s),i=i.next}while(i!==t);return ku(i)}function uie(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Sie(o,a)){let c=u5(o,a);o=ku(o,o.next),c=ku(c,c.next),e0(o,e,n,i,r,s,0),e0(c,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function hie(t,e,n,i){const r=[];let s,o,a,c,l;for(s=0,o=e.length;s<o;s++)a=e[s]*i,c=s<o-1?e[s+1]*i:t.length,l=c5(t,a,c,i,!1),l===l.next&&(l.steiner=!0),r.push(yie(l));for(r.sort(die),s=0;s<r.length;s++)n=pie(r[s],n);return n}function die(t,e){return t.x-e.x}function pie(t,e){const n=fie(t,e);if(!n)return e;const i=u5(n,t);return ku(i,i.next),ku(n,n.next)}function fie(t,e){let n=e,i=-1/0,r;const s=t.x,o=t.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const d=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(d<=s&&d>i&&(i=d,r=n.x<n.next.x?n:n.next,d===s))return r}n=n.next}while(n!==e);if(!r)return null;const a=r,c=r.x,l=r.y;let u=1/0,h;n=r;do s>=n.x&&n.x>=c&&s!==n.x&&Qh(o<l?s:i,o,c,l,o<l?i:s,o,n.x,n.y)&&(h=Math.abs(o-n.y)/(s-n.x),t0(n,t)&&(h<u||h===u&&(n.x>r.x||n.x===r.x&&mie(r,n)))&&(r=n,u=h)),n=n.next;while(n!==a);return r}function mie(t,e){return $n(t.prev,t,e.prev)<0&&$n(e.next,t,t.next)<0}function gie(t,e,n,i){let r=t;do r.z===0&&(r.z=sb(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,vie(r)}function vie(t){let e,n,i,r,s,o,a,c,l=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<l&&(a++,i=i.nextZ,!!i);e++);for(c=l;a>0||c>0&&i;)a!==0&&(c===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,c--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,l*=2}while(o>1);return t}function sb(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function yie(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Qh(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function Sie(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!xie(t,e)&&(t0(t,e)&&t0(e,t)&&Cie(t,e)&&($n(t.prev,t,e.prev)||$n(t,e.prev,e))||tC(t,e)&&$n(t.prev,t,t.next)>0&&$n(e.prev,e,e.next)>0)}function $n(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function tC(t,e){return t.x===e.x&&t.y===e.y}function l5(t,e,n,i){const r=Yv($n(t,e,n)),s=Yv($n(t,e,i)),o=Yv($n(n,i,t)),a=Yv($n(n,i,e));return!!(r!==s&&o!==a||r===0&&Kv(t,n,e)||s===0&&Kv(t,i,e)||o===0&&Kv(n,t,i)||a===0&&Kv(n,e,i))}function Kv(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Yv(t){return t>0?1:t<0?-1:0}function xie(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&l5(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function t0(t,e){return $n(t.prev,t,t.next)<0?$n(t,e,t.next)>=0&&$n(t,t.prev,e)>=0:$n(t,e,t.prev)<0||$n(t,t.next,e)<0}function Cie(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function u5(t,e){const n=new ob(t.i,t.x,t.y),i=new ob(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function ZL(t,e,n,i){const r=new ob(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function n0(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ob(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _ie(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}class nA{static area(e){const n=e.length;let i=0;for(let r=n-1,s=0;s<n;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return nA.area(e)<0}static triangulateShape(e,n){const i=[],r=[],s=[];eD(e),tD(i,e);let o=e.length;n.forEach(eD);for(let c=0;c<n.length;c++)r.push(o),o+=n[c].length,tD(i,n[c]);const a=oie.triangulate(i,r);for(let c=0;c<a.length;c+=3)s.push(a.slice(c,c+3));return s}}function eD(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function tD(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class i0 extends qs{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Xe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yx,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pa extends i0{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new gt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Xe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Xe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Xe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Ew extends qs{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Xe(16777215),this.specular=new Xe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yx,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.combine=Xx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class wie extends qs{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Xe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yx,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.combine=Xx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function Jv(t,e,n){return!t||!n&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function Eie(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Rie(t){function e(r,s){return t[r]-t[s]}const n=t.length,i=new Array(n);for(let r=0;r!==n;++r)i[r]=r;return i.sort(e),i}function nD(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const a=n[s]*e;for(let c=0;c!==e;++c)r[o++]=t[a+c]}return r}function h5(t,e,n,i){let r=1,s=t[0];for(;s!==void 0&&s[i]===void 0;)s=t[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),n.push.apply(n,o)),s=t[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),n.push(o)),s=t[r++];while(s!==void 0)}class O0{constructor(e,n,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let i=this._cachedIndex,r=n[i],s=n[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break i;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=n[++i],e<r)break t}o=n.length;break n}if(!(e>=s)){const a=n[1];e<a&&(i=2,s=a);for(let c=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===c)break;if(r=s,s=n[--i-1],e>=s)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<n[a]?o=a:i=a+1}if(r=n[i],s=n[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)n[o]=i[s+o];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class bie extends O0{constructor(e,n,i,r){super(e,n,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Kh,endingEnd:Kh}}intervalChanged_(e,n,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],c=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Yh:s=e,a=2*n-i;break;case b1:s=r.length-2,a=n+r[s]-r[s+1];break;default:s=e,a=i}if(c===void 0)switch(this.getSettings_().endingEnd){case Yh:o=e,c=2*i-n;break;case b1:o=1,c=i+r[1]-r[0];break;default:o=e-1,c=n}const l=(i-n)*.5,u=this.valueSize;this._weightPrev=l/(n-a),this._weightNext=l/(c-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(i-n)/(r-n),v=f*f,g=v*f,m=-d*g+2*d*v-d*f,y=(1+d)*g+(-1.5-2*d)*v+(-.5+d)*f+1,S=(-1-p)*g+(1.5+p)*v+.5*f,x=p*g-p*v;for(let w=0;w!==a;++w)s[w]=m*o[u+w]+y*o[l+w]+S*o[c+w]+x*o[h+w];return s}}class d5 extends O0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=(i-n)/(r-n),h=1-u;for(let d=0;d!==a;++d)s[d]=o[l+d]*h+o[c+d]*u;return s}}class Tie extends O0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class fa{constructor(e,n,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Jv(n,this.TimeBufferType),this.values=Jv(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let i;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:Jv(e.times,Array),values:Jv(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Tie(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new d5(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new bie(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case Yg:n=this.InterpolantFactoryMethodDiscrete;break;case Jg:n=this.InterpolantFactoryMethodLinear;break;case G_:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Yg;case this.InterpolantFactoryMethodLinear:return Jg;case this.InterpolantFactoryMethodSmooth:return G_}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]*=e}return this}trim(e,n){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;o!==-1&&i[o]>n;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const c=i[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(o!==null&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(r!==void 0&&Eie(r))for(let a=0,c=r.length;a!==c;++a){const l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===G_,s=e.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const l=e[a],u=e[a+1];if(l!==u&&(a!==1||l!==e[0]))if(r)c=!0;else{const h=a*i,d=h-i,p=h+i;for(let f=0;f!==i;++f){const v=n[h+f];if(v!==n[d+f]||v!==n[p+f]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const h=a*i,d=o*i;for(let p=0;p!==i;++p)n[d+p]=n[h+p]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,c=o*i,l=0;l!==i;++l)n[c+l]=n[a+l];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=n.slice(0,o*i)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),i=this.constructor,r=new i(this.name,e,n);return r.createInterpolant=this.createInterpolant,r}}fa.prototype.TimeBufferType=Float32Array;fa.prototype.ValueBufferType=Float32Array;fa.prototype.DefaultInterpolation=Jg;class hp extends fa{constructor(e,n,i){super(e,n,i)}}hp.prototype.ValueTypeName="bool";hp.prototype.ValueBufferType=Array;hp.prototype.DefaultInterpolation=Yg;hp.prototype.InterpolantFactoryMethodLinear=void 0;hp.prototype.InterpolantFactoryMethodSmooth=void 0;class p5 extends fa{}p5.prototype.ValueTypeName="color";class Lu extends fa{}Lu.prototype.ValueTypeName="number";class Aie extends O0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(i-n)/(r-n);let l=e*a;for(let u=l+a;l!==u;l+=4)Xt.slerpFlat(s,0,o,l-a,o,l,c);return s}}class al extends fa{InterpolantFactoryMethodLinear(e){return new Aie(this.times,this.values,this.getValueSize(),e)}}al.prototype.ValueTypeName="quaternion";al.prototype.InterpolantFactoryMethodSmooth=void 0;class dp extends fa{constructor(e,n,i){super(e,n,i)}}dp.prototype.ValueTypeName="string";dp.prototype.ValueBufferType=Array;dp.prototype.DefaultInterpolation=Yg;dp.prototype.InterpolantFactoryMethodLinear=void 0;dp.prototype.InterpolantFactoryMethodSmooth=void 0;class Du extends fa{}Du.prototype.ValueTypeName="vector";class L1{constructor(e="",n=-1,i=[],r=W2){this.name=e,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=Ao(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)n.push(Iie(i[o]).scale(r));const s=new this(e.name,e.duration,n,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const n=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)n.push(fa.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,n,i,r){const s=n.length,o=[];for(let a=0;a<s;a++){let c=[],l=[];c.push((a+s-1)%s,a,(a+1)%s),l.push(0,1,0);const u=Rie(c);c=nD(c,1,u),l=nD(l,1,u),!r&&c[0]===0&&(c.push(s),l.push(l[0])),o.push(new Lu(".morphTargetInfluences["+n[a].name+"]",c,l).scale(1/i))}return new this(e,-1,o)}static findByName(e,n){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===n)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,n,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,c=e.length;a<c;a++){const l=e[a],u=l.name.match(s);if(u&&u.length>1){const h=u[1];let d=r[h];d||(r[h]=d=[]),d.push(l)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],n,i));return o}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,d,p,f,v){if(p.length!==0){const g=[],m=[];h5(p,g,m,f),g.length!==0&&v.push(new h(d,g,m))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let c=e.length||-1;const l=e.hierarchy||[];for(let h=0;h<l.length;h++){const d=l[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let v=0;v<d[f].morphTargets.length;v++)p[d[f].morphTargets[v]]=-1;for(const v in p){const g=[],m=[];for(let y=0;y!==d[f].morphTargets.length;++y){const S=d[f];g.push(S.time),m.push(S.morphTarget===v?1:0)}r.push(new Lu(".morphTargetInfluence["+v+"]",g,m))}c=p.length*o}else{const p=".bones["+n[h].name+"]";i(Du,p+".position",d,"pos",r),i(al,p+".quaternion",d,"rot",r),i(Du,p+".scale",d,"scl",r)}}return r.length===0?null:new this(s,c,r,a)}resetDuration(){const e=this.tracks;let n=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];n=Math.max(n,s.times[s.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Pie(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Lu;case"vector":case"vector2":case"vector3":case"vector4":return Du;case"color":return p5;case"quaternion":return al;case"bool":case"boolean":return hp;case"string":return dp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function Iie(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Pie(t.type);if(t.times===void 0){const n=[],i=[];h5(t.keys,n,i,"value"),t.times=n,t.values=i}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Oc={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Mie{constructor(e,n,i){const r=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=i,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=l.length;h<d;h+=2){const p=l[h],f=l[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return f}return null}}}const kie=new Mie;class Ja{constructor(e){this.manager=e!==void 0?e:kie,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const i=this;return new Promise(function(r,s){i.load(e,r,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ja.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ta={};class Lie extends Error{constructor(e,n){super(e),this.response=n}}class iA extends Ja{constructor(e){super(e)}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Oc.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(s),this.manager.itemEnd(e)},0),s;if(Ta[e]!==void 0){Ta[e].push({onLoad:n,onProgress:i,onError:r});return}Ta[e]=[],Ta[e].push({onLoad:n,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const u=Ta[e],h=l.body.getReader(),d=l.headers.get("X-File-Size")||l.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let v=0;const g=new ReadableStream({start(m){y();function y(){h.read().then(({done:S,value:x})=>{if(S)m.close();else{v+=x.byteLength;const w=new ProgressEvent("progress",{lengthComputable:f,loaded:v,total:p});for(let C=0,E=u.length;C<E;C++){const b=u[C];b.onProgress&&b.onProgress(w)}m.enqueue(x),y()}},S=>{m.error(S)})}}});return new Response(g)}else throw new Lie(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return l.json();default:if(a===void 0)return l.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return l.arrayBuffer().then(f=>p.decode(f))}}}).then(l=>{Oc.add(e,l);const u=Ta[e];delete Ta[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(l)}}).catch(l=>{const u=Ta[e];if(u===void 0)throw this.manager.itemError(e),l;delete Ta[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Die extends Ja{constructor(e){super(e)}load(e,n,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Oc.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a=Qg("img");function c(){u(),Oc.add(e,this),n&&n(this),s.manager.itemEnd(e)}function l(h){u(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class f5 extends Ja{constructor(e){super(e)}load(e,n,i,r){const s=new wi,o=new Die(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,n!==void 0&&n(s)},i,r),s}}class nC extends Sn{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new Xe(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(n.object.target=this.target.uuid),n}}const Rw=new Ge,iD=new N,rD=new N;class rA{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new gt(512,512),this.map=null,this.mapPass=null,this.matrix=new Ge,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Y2,this._frameExtents=new gt(1,1),this._viewportCount=1,this._viewports=[new Gt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,i=this.matrix;iD.setFromMatrixPosition(e.matrixWorld),n.position.copy(iD),rD.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(rD),n.updateMatrixWorld(),Rw.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Rw),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Rw)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Nie extends rA{constructor(){super(new lr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,i=Fd*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||n.far;(i!==n.fov||r!==n.aspect||s!==n.far)&&(n.fov=i,n.aspect=r,n.far=s,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class sA extends nC{constructor(e,n,i=0,r=Math.PI/3,s=0,o=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Sn.DEFAULT_UP),this.updateMatrix(),this.target=new Sn,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new Nie}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const sD=new Ge,Om=new N,bw=new N;class Oie extends rA{constructor(){super(new lr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new gt(4,2),this._viewportCount=6,this._viewports=[new Gt(2,1,1,1),new Gt(0,1,1,1),new Gt(3,1,1,1),new Gt(1,1,1,1),new Gt(3,0,1,1),new Gt(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,n=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Om.setFromMatrixPosition(e.matrixWorld),i.position.copy(Om),bw.copy(i.position),bw.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(bw),i.updateMatrixWorld(),r.makeTranslation(-Om.x,-Om.y,-Om.z),sD.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sD)}}class D1 extends nC{constructor(e,n,i=0,r=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Oie}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Fie extends rA{constructor(){super(new J2(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class oA extends nC{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Sn.DEFAULT_UP),this.updateMatrix(),this.target=new Sn,this.shadow=new Fie}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class m5 extends nC{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class dd{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let i=0,r=e.length;i<r;i++)n+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class zie extends Ja{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Oc.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(l=>{n&&n(l),s.manager.itemEnd(e)}).catch(l=>{r&&r(l)});return}return setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const c=fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){return Oc.add(e,l),n&&n(l),s.manager.itemEnd(e),l}).catch(function(l){r&&r(l),Oc.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Oc.add(e,c),s.manager.itemStart(e)}}class Uie{constructor(e,n,i){this.binding=e,this.valueSize=i;let r,s,o;switch(n){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const i=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)i[s+a]=i[a];o=n}else{o+=n;const a=n/o;this._mixBufferRegion(i,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const n=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,i=this.buffer,r=e*n+n,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const c=n*this._origIndex;this._mixBufferRegion(i,r,c,1-s,n)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*n,1,n);for(let c=n,l=n+n;c!==l;++c)if(i[c]!==i[c+n]){a.setValue(i,r);break}}saveOriginalState(){const e=this.binding,n=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(n,r);for(let s=i,o=r;s!==o;++s)n[s]=n[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let i=e;i<n;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[n+i]=this.buffer[e+i]}_select(e,n,i,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[n+o]=e[i+o]}_slerp(e,n,i,r){Xt.slerpFlat(e,n,e,n,e,i,r)}_slerpAdditive(e,n,i,r,s){const o=this._workIndex*s;Xt.multiplyQuaternionsFlat(e,o,e,n,e,i),Xt.slerpFlat(e,n,e,n,e,o,r)}_lerp(e,n,i,r,s){const o=1-r;for(let a=0;a!==s;++a){const c=n+a;e[c]=e[c]*o+e[i+a]*r}}_lerpAdditive(e,n,i,r,s){for(let o=0;o!==s;++o){const a=n+o;e[a]=e[a]+e[i+o]*r}}}const aA="\\[\\]\\.:\\/",Bie=new RegExp("["+aA+"]","g"),cA="[^"+aA+"]",$ie="[^"+aA.replace("\\.","")+"]",Hie=/((?:WC+[\/:])*)/.source.replace("WC",cA),Vie=/(WCOD+)?/.source.replace("WCOD",$ie),jie=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",cA),Wie=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",cA),Gie=new RegExp("^"+Hie+Vie+jie+Wie+"$"),qie=["material","materials","bones","map"];class Xie{constructor(e,n,i){const r=i||Kt.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,r)}getValue(e,n){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,n)}setValue(e,n){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].unbind()}}class Kt{constructor(e,n,i){this.path=n,this.parsedPath=i||Kt.parseTrackName(n),this.node=Kt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,i){return e&&e.isAnimationObjectGroup?new Kt.Composite(e,n,i):new Kt(e,n,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Bie,"")}static parseTrackName(e){const n=Gie.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);qie.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(n);if(i!==void 0)return i}if(e.children){const i=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===n||a.uuid===n)return a;const c=i(a.children);if(c)return c}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[n++]=i[r]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,i=n.objectName,r=n.propertyName;let s=n.propertyIndex;if(e||(e=Kt.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let l=n.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===l){l=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}const o=e[r];if(o===void 0){const l=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Kt.Composite=Xie;Kt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Kt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Kt.prototype.GetterByBindingType=[Kt.prototype._getValue_direct,Kt.prototype._getValue_array,Kt.prototype._getValue_arrayElement,Kt.prototype._getValue_toArray];Kt.prototype.SetterByBindingTypeAndVersioning=[[Kt.prototype._setValue_direct,Kt.prototype._setValue_direct_setNeedsUpdate,Kt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_array,Kt.prototype._setValue_array_setNeedsUpdate,Kt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_arrayElement,Kt.prototype._setValue_arrayElement_setNeedsUpdate,Kt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_fromArray,Kt.prototype._setValue_fromArray_setNeedsUpdate,Kt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Kie{constructor(e,n,i=null,r=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=i,this.blendMode=r;const s=n.tracks,o=s.length,a=new Array(o),c={endingStart:Kh,endingEnd:Kh};for(let l=0;l!==o;++l){const u=s[l].createInterpolant(null);a[l]=u,u.settings=c}this._interpolantSettings=c,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=HB,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,i){if(e.fadeOut(n),this.fadeIn(n),i){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,n),this.warp(a,1,n)}return this}crossFadeTo(e,n,i){return e.crossFadeFrom(this,n,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,i){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const c=a.parameterPositions,l=a.sampleValues;return c[0]=s,c[1]=s+i,l[0]=e/o,l[1]=n/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const c=(e-s)*i;c<0||i===0?n=0:(this._startTime=null,n=i*c)}n*=this._updateTimeScale(e);const o=this._updateTime(n),a=this._updateWeight(e);if(a>0){const c=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case lJ:for(let u=0,h=c.length;u!==h;++u)c[u].evaluate(o),l[u].accumulateAdditive(a);break;case W2:default:for(let u=0,h=c.length;u!==h;++u)c[u].evaluate(o),l[u].accumulate(r,a)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===cJ;if(e===0)return s===-1?r:o&&(s&1)===1?n-r:r;if(i===aJ){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=n)r=n;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=n||r<0){const a=Math.floor(r/n);r-=n*a,s+=Math.abs(a);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?n:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return n-r}return r}_setEndings(e,n,i){const r=this._interpolantSettings;i?(r.endingStart=Yh,r.endingEnd=Yh):(e?r.endingStart=this.zeroSlopeAtStart?Yh:Kh:r.endingStart=b1,n?r.endingEnd=this.zeroSlopeAtEnd?Yh:Kh:r.endingEnd=b1)}_scheduleFading(e,n,i){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=s,c[0]=n,a[1]=s+e,c[1]=i,this}}const Yie=new Float32Array(1);class Jie extends Cl{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,c=i.uuid,l=this._bindingsByRootAndName;let u=l[c];u===void 0&&(u={},l[c]=u);for(let h=0;h!==s;++h){const d=r[h],p=d.name;let f=u[p];if(f!==void 0)++f.referenceCount,o[h]=f;else{if(f=o[h],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,c,p));continue}const v=n&&n._propertyBindings[h].binding.parsedPath;f=new Uie(Kt.create(i,p,v),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,c,p),o[h]=f}a[h].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,i){const r=this._actions,s=this._actionsByClip;let o=s[n];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[n]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const n=this._actions,i=n[n.length-1],r=e._cacheIndex;i._cacheIndex=r,n[r]=i,n.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],c=a.knownActions,l=c[c.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,c[u]=l,c.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],c.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const n=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_takeBackAction(e){const n=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_addInactiveBinding(e,n,i){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[n];o===void 0&&(o={},r[n]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const n=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,a=o[r],c=n[n.length-1],l=e._cacheIndex;c._cacheIndex=l,n[l]=c,n.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const n=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_takeBackBinding(e){const n=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let i=e[n];return i===void 0&&(i=new d5(new Float32Array(2),new Float32Array(2),1,Yie),i.__cacheIndex=n,e[n]=i),i}_takeBackControlInterpolant(e){const n=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=n[r];e.__cacheIndex=r,n[r]=e,s.__cacheIndex=i,n[i]=s}clipAction(e,n,i){const r=n||this._root,s=r.uuid;let o=typeof e=="string"?L1.findByName(r,e):e;const a=o!==null?o.uuid:e,c=this._actionsByClip[a];let l=null;if(i===void 0&&(o!==null?i=o.blendMode:i=W2),c!==void 0){const h=c.actionByRoot[s];if(h!==void 0&&h.blendMode===i)return h;l=c.knownActions[0],o===null&&(o=l._clip)}if(o===null)return null;const u=new Kie(this,o,n,i);return this._bindAction(u,l),this._addInactiveAction(u,a,s),u}existingAction(e,n){const i=n||this._root,r=i.uuid,s=typeof e=="string"?L1.findByName(i,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let i=n-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const n=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==i;++l)n[l]._update(r,e,s,o);const a=this._bindings,c=this._nActiveBindings;for(let l=0;l!==c;++l)a[l].apply(o);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const o=s.knownActions;for(let a=0,c=o.length;a!==c;++a){const l=o[a];this._deactivateAction(l);const u=l._cacheIndex,h=n[n.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=u,n[u]=h,n.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){const n=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,c=a[n];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const r=this._bindingsByRootAndName,s=r[n];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,n){const i=this.existingAction(e,n);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}const oD=new Ge;class Qie{constructor(e,n,i=0,r=1/0){this.ray=new cp(e,n),this.near=i,this.far=r,this.camera=null,this.layers=new X2,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return oD.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(oD),this}intersectObject(e,n=!0,i=[]){return ab(e,this,i,n),i.sort(aD),i}intersectObjects(e,n=!0,i=[]){for(let r=0,s=e.length;r<s;r++)ab(e[r],this,i,n);return i.sort(aD),i}}function aD(t,e){return t.distance-e.distance}function ab(t,e,n,i){let r=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(r=!1),r===!0&&i===!0){const s=t.children;for(let o=0,a=s.length;o<a;o++)ab(s[o],e,n,!0)}}class N1{constructor(e=1,n=0,i=0){return this.radius=e,this.phi=n,this.theta=i,this}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+n*n+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(yi(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Zie extends Cl{constructor(e,n=null){super(),this.object=e,this.domElement=n,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:F2}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=F2);const cD={type:"change"},lA={type:"start"},g5={type:"end"},Qv=new cp,lD=new Ec,ere=Math.cos(70*Hi.DEG2RAD),mi=new N,Dr=2*Math.PI,mn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Tw=1e-6;class tre extends Zie{constructor(e,n=null){super(e,n),this.state=mn.NONE,this.enabled=!0,this.target=new N,this.cursor=new N,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:cd.ROTATE,MIDDLE:cd.DOLLY,RIGHT:cd.PAN},this.touches={ONE:Xh.ROTATE,TWO:Xh.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new N,this._lastQuaternion=new Xt,this._lastTargetPosition=new N,this._quat=new Xt().setFromUnitVectors(e.up,new N(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new N1,this._sphericalDelta=new N1,this._scale=1,this._panOffset=new N,this._rotateStart=new gt,this._rotateEnd=new gt,this._rotateDelta=new gt,this._panStart=new gt,this._panEnd=new gt,this._panDelta=new gt,this._dollyStart=new gt,this._dollyEnd=new gt,this._dollyDelta=new gt,this._dollyDirection=new N,this._mouse=new gt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=ire.bind(this),this._onPointerDown=nre.bind(this),this._onPointerUp=rre.bind(this),this._onContextMenu=hre.bind(this),this._onMouseWheel=are.bind(this),this._onKeyDown=cre.bind(this),this._onTouchStart=lre.bind(this),this._onTouchMove=ure.bind(this),this._onMouseDown=sre.bind(this),this._onMouseMove=ore.bind(this),this._interceptControlDown=dre.bind(this),this._interceptControlUp=pre.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(cD),this.update(),this.state=mn.NONE}update(e=null){const n=this.object.position;mi.copy(n).sub(this.target),mi.applyQuaternion(this._quat),this._spherical.setFromVector3(mi),this.autoRotate&&this.state===mn.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Dr:i>Math.PI&&(i-=Dr),r<-Math.PI?r+=Dr:r>Math.PI&&(r-=Dr),i<=r?this._spherical.theta=Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(mi.setFromSpherical(this._spherical),mi.applyQuaternion(this._quatInverse),n.copy(this.target).add(mi),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=mi.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new N(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const l=new N(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(a),this.object.updateMatrixWorld(),o=mi.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Qv.origin.copy(this.object.position),Qv.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Qv.direction))<ere?this.object.lookAt(this.target):(lD.setFromNormalAndCoplanarPoint(this.object.up,this.target),Qv.intersectPlane(lD,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>Tw||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Tw||this._lastTargetPosition.distanceToSquared(this.target)>Tw?(this.dispatchEvent(cD),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Dr/60*this.autoRotateSpeed*e:Dr/60/60*this.autoRotateSpeed}_getZoomScale(e){const n=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,n){mi.setFromMatrixColumn(n,0),mi.multiplyScalar(-e),this._panOffset.add(mi)}_panUp(e,n){this.screenSpacePanning===!0?mi.setFromMatrixColumn(n,1):(mi.setFromMatrixColumn(n,0),mi.crossVectors(this.object.up,mi)),mi.multiplyScalar(e),this._panOffset.add(mi)}_pan(e,n){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;mi.copy(r).sub(this.target);let s=mi.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*n*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=e-i.left,s=n-i.top,o=i.width,a=i.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(Dr*this._rotateDelta.x/n.clientHeight),this._rotateUp(Dr*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let n=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._panStart.set(i,r)}}_handleTouchStartDolly(e){const n=this._getSecondPointerPosition(e),i=e.pageX-n.x,r=e.pageY-n.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(Dr*this._rotateDelta.x/n.clientHeight),this._rotateUp(Dr*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const n=this._getSecondPointerPosition(e),i=e.pageX-n.x,r=e.pageY-n.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+n.x)*.5,a=(e.pageY+n.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(e){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId)return!0;return!1}_trackPointer(e){let n=this._pointerPositions[e.pointerId];n===void 0&&(n=new gt,this._pointerPositions[e.pointerId]=n),n.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const n=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(e){const n=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(n){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function nre(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function ire(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function rre(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(g5),this.state=mn.NONE;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y});break}}function sre(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case cd.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=mn.DOLLY;break;case cd.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=mn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=mn.ROTATE}break;case cd.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=mn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=mn.PAN}break;default:this.state=mn.NONE}this.state!==mn.NONE&&this.dispatchEvent(lA)}function ore(t){switch(this.state){case mn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case mn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case mn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function are(t){this.enabled===!1||this.enableZoom===!1||this.state!==mn.NONE||(t.preventDefault(),this.dispatchEvent(lA),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(g5))}function cre(t){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(t)}function lre(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Xh.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=mn.TOUCH_ROTATE;break;case Xh.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=mn.TOUCH_PAN;break;default:this.state=mn.NONE}break;case 2:switch(this.touches.TWO){case Xh.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=mn.TOUCH_DOLLY_PAN;break;case Xh.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=mn.TOUCH_DOLLY_ROTATE;break;default:this.state=mn.NONE}break;default:this.state=mn.NONE}this.state!==mn.NONE&&this.dispatchEvent(lA)}function ure(t){switch(this._trackPointer(t),this.state){case mn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case mn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case mn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case mn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=mn.NONE}}function hre(t){this.enabled!==!1&&t.preventDefault()}function dre(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function pre(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function uD(t,e){if(e===uJ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===ZR||e===VB){let n=t.getIndex();if(n===null){const o=[],a=t.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);t.setIndex(o),n=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const i=n.count-2,r=[];if(e===ZR)for(let o=1;o<=i;o++)r.push(n.getX(0)),r.push(n.getX(o)),r.push(n.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(r.push(n.getX(o)),r.push(n.getX(o+1)),r.push(n.getX(o+2))):(r.push(n.getX(o+2)),r.push(n.getX(o+1)),r.push(n.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class fre extends Ja{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Sre(n)}),this.register(function(n){return new xre(n)}),this.register(function(n){return new Pre(n)}),this.register(function(n){return new Ire(n)}),this.register(function(n){return new Mre(n)}),this.register(function(n){return new _re(n)}),this.register(function(n){return new wre(n)}),this.register(function(n){return new Ere(n)}),this.register(function(n){return new Rre(n)}),this.register(function(n){return new yre(n)}),this.register(function(n){return new bre(n)}),this.register(function(n){return new Cre(n)}),this.register(function(n){return new Are(n)}),this.register(function(n){return new Tre(n)}),this.register(function(n){return new gre(n)}),this.register(function(n){return new kre(n)}),this.register(function(n){return new Lre(n)})}load(e,n,i,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const l=dd.extractUrlBase(e);o=dd.resolveURL(l,this.path)}else o=dd.extractUrlBase(e);this.manager.itemStart(e);const a=function(l){r?r(l):console.error(l),s.manager.itemError(e),s.manager.itemEnd(e)},c=new iA(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{s.parse(l,o,function(u){n(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,i,r){let s;const o={},a={},c=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===v5){try{o[zt.KHR_BINARY_GLTF]=new Dre(e)}catch(h){r&&r(h);return}s=JSON.parse(o[zt.KHR_BINARY_GLTF].content)}else s=JSON.parse(c.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new qre(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const h=this.pluginCallbacks[u](l);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[h.name]=h,o[h.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const h=s.extensionsUsed[u],d=s.extensionsRequired||[];switch(h){case zt.KHR_MATERIALS_UNLIT:o[h]=new vre;break;case zt.KHR_DRACO_MESH_COMPRESSION:o[h]=new Nre(s,this.dracoLoader);break;case zt.KHR_TEXTURE_TRANSFORM:o[h]=new Ore;break;case zt.KHR_MESH_QUANTIZATION:o[h]=new Fre;break;default:d.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(i,r)}parseAsync(e,n){const i=this;return new Promise(function(r,s){i.parse(e,n,r,s)})}}function mre(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const zt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class gre{constructor(e){this.parser=e,this.name=zt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let i=0,r=n.length;i<r;i++){const s=n[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const n=this.parser,i="light:"+e;let r=n.cache.get(i);if(r)return r;const s=n.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let l;const u=new Xe(16777215);c.color!==void 0&&u.setRGB(c.color[0],c.color[1],c.color[2],qi);const h=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new oA(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new D1(u),l.distance=h;break;case"spot":l=new sA(u),l.distance=h,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,Ia(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=n.createUniqueName(c.name||"light_"+e),r=Promise.resolve(l),n.cache.add(i,r),r}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return i._getNodeRef(n.cache,a,c)})}}class vre{constructor(){this.name=zt.KHR_MATERIALS_UNLIT}getMaterialType(){return Nc}extendParams(e,n,i){const r=[];e.color=new Xe(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],qi),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,on))}return Promise.all(r)}}class yre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(n.emissiveIntensity=s),Promise.resolve()}}class Sre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(n.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new gt(a,a)}return Promise.all(s)}}class xre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Cre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(n.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(n,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(n.iridescenceIOR=o.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(n,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class _re{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new Xe(0,0,0),n.sheenRoughness=0,n.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;n.sheenColor.setRGB(a[0],a[1],a[2],qi)}return o.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(n,"sheenColorMap",o.sheenColorTexture,on)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(n,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class wre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(n.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(n,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class Ere{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];n.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(n,"thicknessMap",o.thicknessTexture)),n.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return n.attenuationColor=new Xe().setRGB(a[0],a[1],a[2],qi),Promise.all(s)}}class Rre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class bre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];n.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(n,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return n.specularColor=new Xe().setRGB(a[0],a[1],a[2],qi),o.specularColorTexture!==void 0&&s.push(i.assignTexture(n,"specularColorMap",o.specularColorTexture,on)),Promise.all(s)}}class Tre{constructor(e){this.parser=e,this.name=zt.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return n.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(i.assignTexture(n,"bumpMap",o.bumpTexture)),Promise.all(s)}}class Are{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(n.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(n.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(n,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class Pre{constructor(e){this.parser=e,this.name=zt.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=n.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,s.source,o)}}class Ire{constructor(e){this.parser=e,this.name=zt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=r.images[o.source];let c=i.textureLoader;if(a.uri){const l=i.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,o.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Mre{constructor(e){this.parser=e,this.name=zt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=r.images[o.source];let c=i.textureLoader;if(a.uri){const l=i.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,o.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class kre{constructor(e){this.name=zt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,i=n.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const c=r.byteOffset||0,l=r.byteLength||0,u=r.count,h=r.byteStride,d=new Uint8Array(a,c,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,d,r.mode,r.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(p),u,h,d,r.mode,r.filter),p})})}else return null}}class Lre{constructor(e){this.name=zt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,i=n.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=n.meshes[i.mesh];for(const l of r.primitives)if(l.mode!==Ls.TRIANGLES&&l.mode!==Ls.TRIANGLE_STRIP&&l.mode!==Ls.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const u=l.pop(),h=u.isGroup?u.children:[u],d=l[0].count,p=[];for(const f of h){const v=new Ge,g=new N,m=new Xt,y=new N(1,1,1),S=new tie(f.geometry,f.material,d);for(let x=0;x<d;x++)c.TRANSLATION&&g.fromBufferAttribute(c.TRANSLATION,x),c.ROTATION&&m.fromBufferAttribute(c.ROTATION,x),c.SCALE&&y.fromBufferAttribute(c.SCALE,x),S.setMatrixAt(x,v.compose(g,m,y));for(const x in c)if(x==="_COLOR_0"){const w=c[x];S.instanceColor=new ib(w.array,w.itemSize,w.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&f.geometry.setAttribute(x,c[x]);Sn.prototype.copy.call(S,f),this.parser.assignFinalMaterial(S),p.push(S)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const v5="glTF",Fm=12,hD={JSON:1313821514,BIN:5130562};class Dre{constructor(e){this.name=zt.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Fm),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==v5)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Fm,s=new DataView(e,Fm);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const c=s.getUint32(o,!0);if(o+=4,c===hD.JSON){const l=new Uint8Array(e,Fm+o,a);this.content=i.decode(l)}else if(c===hD.BIN){const l=Fm+o;this.body=e.slice(l,l+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Nre{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=zt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const u in o){const h=cb[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=cb[u]||u.toLowerCase();if(o[u]!==void 0){const d=i.accessors[e.attributes[u]],p=pd[d.componentType];l[h]=p.name,c[h]=d.normalized===!0}}return n.getDependency("bufferView",s).then(function(u){return new Promise(function(h,d){r.decodeDracoFile(u,function(p){for(const f in p.attributes){const v=p.attributes[f],g=c[f];g!==void 0&&(v.normalized=g)}h(p)},a,l,qi,d)})})}}class Ore{constructor(){this.name=zt.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class Fre{constructor(){this.name=zt.KHR_MESH_QUANTIZATION}}class y5 extends O0{constructor(e,n,i,r){super(e,n,i,r)}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)n[o]=i[s+o];return n}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,u=r-n,h=(i-n)/u,d=h*h,p=d*h,f=e*l,v=f-l,g=-2*p+3*d,m=p-d,y=1-g,S=m-d+h;for(let x=0;x!==a;x++){const w=o[v+x+a],C=o[v+x+c]*u,E=o[f+x+a],b=o[f+x]*u;s[x]=y*w+S*C+g*E+m*b}return s}}const zre=new Xt;class Ure extends y5{interpolate_(e,n,i,r){const s=super.interpolate_(e,n,i,r);return zre.fromArray(s).normalize().toArray(s),s}}const Ls={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},pd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},dD={9728:Er,9729:ds,9984:kB,9985:ky,9986:eg,9987:za},pD={33071:na,33648:R1,10497:sl},Aw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cb={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Bre={CUBICSPLINE:void 0,LINEAR:Jg,STEP:Yg},Pw={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function $re(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new i0({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ka})),t.DefaultMaterial}function Xl(t,e,n){for(const i in n.extensions)t[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function Ia(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Hre(t,e,n){let i=!1,r=!1,s=!1;for(let l=0,u=e.length;l<u;l++){const h=e[l];if(h.POSITION!==void 0&&(i=!0),h.NORMAL!==void 0&&(r=!0),h.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const o=[],a=[],c=[];for(let l=0,u=e.length;l<u;l++){const h=e[l];if(i){const d=h.POSITION!==void 0?n.getDependency("accessor",h.POSITION):t.attributes.position;o.push(d)}if(r){const d=h.NORMAL!==void 0?n.getDependency("accessor",h.NORMAL):t.attributes.normal;a.push(d)}if(s){const d=h.COLOR_0!==void 0?n.getDependency("accessor",h.COLOR_0):t.attributes.color;c.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[0],h=l[1],d=l[2];return i&&(t.morphAttributes.position=u),r&&(t.morphAttributes.normal=h),s&&(t.morphAttributes.color=d),t.morphTargetsRelative=!0,t})}function Vre(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let i=0,r=n.length;i<r;i++)t.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function jre(t){let e;const n=t.extensions&&t.extensions[zt.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+Iw(n.attributes):e=t.indices+":"+Iw(t.attributes)+":"+t.mode,t.targets!==void 0)for(let i=0,r=t.targets.length;i<r;i++)e+=":"+Iw(t.targets[i]);return e}function Iw(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function lb(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Wre(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Gre=new Ge;class qre{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new mre,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=-1,s=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);r=i&&c?parseInt(c[1],10):-1,s=a.indexOf("Firefox")>-1,o=s?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&r<17||s&&o<98?this.textureLoader=new f5(this.options.manager):this.textureLoader=new zie(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new iA(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};return Xl(s,a,r),Ia(a,r),Promise.all(i._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();e(a)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=n.length;r<s;r++){const o=n[r].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,i){if(e.refs[n]<=1)return i;const r=i.clone(),s=(o,a)=>{const c=this.associations.get(o);c!=null&&this.associations.set(a,c);for(const[l,u]of o.children.entries())s(u,a.children[l])};return s(i,r),r.name+="_instance_"+e.uses[n]++,r}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let i=0;i<n.length;i++){const r=e(n[i]);if(r)return r}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const i=[];for(let r=0;r<n.length;r++){const s=e(n[r]);s&&i.push(s)}return i}getDependency(e,n){const i=e+":"+n;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(n);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":r=this.loadAccessor(n);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":r=this.loadBuffer(n);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":r=this.loadSkin(n);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":r=this.loadCamera(n);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,n)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(i,r)}return r}getDependencies(e){let n=this.cache.get(e);if(!n){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(r.map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],i=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[zt.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(dd.resolveURL(n.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(i){const r=n.byteLength||0,s=n.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const n=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=Aw[r.type],a=pd[r.componentType],c=r.normalized===!0,l=new a(r.count*o);return Promise.resolve(new Tr(l,o,c))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],c=Aw[r.type],l=pd[r.componentType],u=l.BYTES_PER_ELEMENT,h=u*c,d=r.byteOffset||0,p=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,f=r.normalized===!0;let v,g;if(p&&p!==h){const m=Math.floor(d/p),y="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count;let S=n.cache.get(y);S||(v=new l(a,m*p,r.count*p/u),S=new Jne(v,p/u),n.cache.add(y,S)),g=new Z2(S,c,d%p/u,f)}else a===null?v=new l(r.count*c):v=new l(a,d,r.count*c),g=new Tr(v,c,f);if(r.sparse!==void 0){const m=Aw.SCALAR,y=pd[r.sparse.indices.componentType],S=r.sparse.indices.byteOffset||0,x=r.sparse.values.byteOffset||0,w=new y(o[1],S,r.sparse.count*m),C=new l(o[2],x,r.sparse.count*c);a!==null&&(g=new Tr(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let E=0,b=w.length;E<b;E++){const M=w[E];if(g.setX(M,C[E*c]),c>=2&&g.setY(M,C[E*c+1]),c>=3&&g.setZ(M,C[E*c+2]),c>=4&&g.setW(M,C[E*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=f}return g})}loadTexture(e){const n=this.json,i=this.options,s=n.textures[e].source,o=n.images[s];let a=this.textureLoader;if(o.uri){const c=i.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,n,i){const r=this,s=this.json,o=s.textures[e],a=s.images[n],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(n,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const d=(s.samplers||{})[o.sampler]||{};return u.magFilter=dD[d.magFilter]||ds,u.minFilter=dD[d.minFilter]||za,u.wrapS=pD[d.wrapS]||sl,u.wrapT=pD[d.wrapT]||sl,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,n){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=r.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(o.bufferView!==void 0)c=i.getDependency("bufferView",o.bufferView).then(function(h){l=!0;const d=new Blob([h],{type:o.mimeType});return c=a.createObjectURL(d),c});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(h){return new Promise(function(d,p){let f=d;n.isImageBitmapLoader===!0&&(f=function(v){const g=new wi(v);g.needsUpdate=!0,d(g)}),n.load(dd.resolveURL(h,s.path),f,void 0,p)})}).then(function(h){return l===!0&&a.revokeObjectURL(c),Ia(h,o),h.userData.mimeType=o.mimeType||Wre(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),h});return this.sourceCache[e]=u,u}assignTexture(e,n,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),s.extensions[zt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[zt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(o);o=s.extensions[zt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,c)}}return r!==void 0&&(o.colorSpace=r),e[n]=o,o})}assignFinalMaterial(e){const n=e.geometry;let i=e.material;const r=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,o=n.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new a5,qs.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(a,c)),i=c}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new tA,qs.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,this.cache.add(a,c)),i=c}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=i.clone(),s&&(c.vertexColors=!0),o&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(i))),i=c}e.material=i}getMaterialType(){return i0}loadMaterial(e){const n=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const a={},c=s.extensions||{},l=[];if(c[zt.KHR_MATERIALS_UNLIT]){const h=r[zt.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),l.push(h.extendParams(a,s,n))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new Xe(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],qi),a.opacity=d[3]}h.baseColorTexture!==void 0&&l.push(n.assignTexture(a,"map",h.baseColorTexture,on)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(l.push(n.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),l.push(n.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Zo);const u=s.alphaMode||Pw.OPAQUE;if(u===Pw.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Pw.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==Nc&&(l.push(n.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new gt(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&o!==Nc&&(l.push(n.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==Nc){const h=s.emissiveFactor;a.emissive=new Xe().setRGB(h[0],h[1],h[2],qi)}return s.emissiveTexture!==void 0&&o!==Nc&&l.push(n.assignTexture(a,"emissiveMap",s.emissiveTexture,on)),Promise.all(l).then(function(){const h=new o(a);return s.name&&(h.name=s.name),Ia(h,s),n.associations.set(h,{materials:e}),s.extensions&&Xl(r,h,s),h})}createUniqueName(e){const n=Kt.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[zt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(c){return fD(c,a,n)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],u=jre(l),h=r[u];if(h)o.push(h.promise);else{let d;l.extensions&&l.extensions[zt.KHR_DRACO_MESH_COMPRESSION]?d=s(l):d=fD(new ys,l,n),r[u]={primitive:l,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const n=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const u=o[c].material===void 0?$re(this.cache):this.getDependency("material",o[c].material);a.push(u)}return a.push(n.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],h=[];for(let p=0,f=u.length;p<f;p++){const v=u[p],g=o[p];let m;const y=l[p];if(g.mode===Ls.TRIANGLES||g.mode===Ls.TRIANGLE_STRIP||g.mode===Ls.TRIANGLE_FAN||g.mode===void 0)m=s.isSkinnedMesh===!0?new eA(v,y):new gn(v,y),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),g.mode===Ls.TRIANGLE_STRIP?m.geometry=uD(m.geometry,VB):g.mode===Ls.TRIANGLE_FAN&&(m.geometry=uD(m.geometry,ZR));else if(g.mode===Ls.LINES)m=new nie(v,y);else if(g.mode===Ls.LINE_STRIP)m=new eC(v,y);else if(g.mode===Ls.LINE_LOOP)m=new iie(v,y);else if(g.mode===Ls.POINTS)m=new rie(v,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(m.geometry.morphAttributes).length>0&&Vre(m,s),m.name=n.createUniqueName(s.name||"mesh_"+e),Ia(m,s),g.extensions&&Xl(r,m,g),n.assignFinalMaterial(m),h.push(m)}for(let p=0,f=h.length;p<f;p++)n.associations.set(h[p],{meshes:e,primitives:p});if(h.length===1)return s.extensions&&Xl(r,h[0],s),h[0];const d=new Ba;s.extensions&&Xl(r,d,s),n.associations.set(d,{meshes:e});for(let p=0,f=h.length;p<f;p++)d.add(h[p]);return d})}loadCamera(e){let n;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?n=new lr(Hi.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(n=new J2(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(n.name=this.createUniqueName(i.name)),Ia(n,i),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],i=[];for(let r=0,s=n.joints.length;r<s;r++)i.push(this._loadNodeShallow(n.joints[r]));return n.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",n.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],c=[];for(let l=0,u=o.length;l<u;l++){const h=o[l];if(h){a.push(h);const d=new Ge;s!==null&&d.fromArray(s.array,l*16),c.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[l])}return new N0(a,c)})}loadAnimation(e){const n=this.json,i=this,r=n.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],c=[],l=[],u=[];for(let h=0,d=r.channels.length;h<d;h++){const p=r.channels[h],f=r.samplers[p.sampler],v=p.target,g=v.node,m=r.parameters!==void 0?r.parameters[f.input]:f.input,y=r.parameters!==void 0?r.parameters[f.output]:f.output;v.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",m)),c.push(this.getDependency("accessor",y)),l.push(f),u.push(v))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(h){const d=h[0],p=h[1],f=h[2],v=h[3],g=h[4],m=[];for(let y=0,S=d.length;y<S;y++){const x=d[y],w=p[y],C=f[y],E=v[y],b=g[y];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const M=i._createAnimationTracks(x,w,C,E,b);if(M)for(let _=0;_<M.length;_++)m.push(M[_])}return new L1(s,void 0,m)})}createNodeMesh(e){const n=this.json,i=this,r=n.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=r.weights.length;c<l;c++)a.morphTargetInfluences[c]=r.weights[c]}),o})}loadNode(e){const n=this.json,i=this,r=n.nodes[e],s=i._loadNodeShallow(e),o=[],a=r.children||[];for(let l=0,u=a.length;l<u;l++)o.push(i.getDependency("node",a[l]));const c=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),c]).then(function(l){const u=l[0],h=l[1],d=l[2];d!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(d,Gre)});for(let p=0,f=h.length;p<f;p++)u.add(h[p]);return u})}_loadNodeShallow(e){const n=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=n.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],c=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(l){return r._getNodeRef(r.cameraCache,s.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let u;if(s.isBone===!0?u=new Zg:l.length>1?u=new Ba:l.length===1?u=l[0]:u=new Sn,u!==l[0])for(let h=0,d=l.length;h<d;h++)u.add(l[h]);if(s.name&&(u.userData.name=s.name,u.name=o),Ia(u,s),s.extensions&&Xl(i,u,s),s.matrix!==void 0){const h=new Ge;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const n=this.extensions,i=this.json.scenes[e],r=this,s=new Ba;i.name&&(s.name=r.createUniqueName(i.name)),Ia(s,i),i.extensions&&Xl(n,s,i);const o=i.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(r.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let u=0,h=c.length;u<h;u++)s.add(c[u]);const l=u=>{const h=new Map;for(const[d,p]of r.associations)(d instanceof qs||d instanceof wi)&&h.set(d,p);return u.traverse(d=>{const p=r.associations.get(d);p!=null&&h.set(d,p)}),h};return r.associations=l(s),s})}_createAnimationTracks(e,n,i,r,s){const o=[],a=e.name?e.name:e.uuid,c=[];fc[s.path]===fc.weights?e.traverse(function(d){d.morphTargetInfluences&&c.push(d.name?d.name:d.uuid)}):c.push(a);let l;switch(fc[s.path]){case fc.weights:l=Lu;break;case fc.rotation:l=al;break;case fc.position:case fc.scale:l=Du;break;default:switch(i.itemSize){case 1:l=Lu;break;case 2:case 3:default:l=Du;break}break}const u=r.interpolation!==void 0?Bre[r.interpolation]:Jg,h=this._getArrayFromAccessor(i);for(let d=0,p=c.length;d<p;d++){const f=new l(c[d]+"."+fc[s.path],n.array,h,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),o.push(f)}return o}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const i=lb(n.constructor),r=new Float32Array(n.length);for(let s=0,o=n.length;s<o;s++)r[s]=n[s]*i;n=r}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const r=this instanceof al?Ure:y5;return new r(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Xre(t,e,n){const i=e.attributes,r=new ha;if(i.POSITION!==void 0){const a=n.json.accessors[i.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(r.set(new N(c[0],c[1],c[2]),new N(l[0],l[1],l[2])),a.normalized){const u=lb(pd[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new N,c=new N;for(let l=0,u=s.length;l<u;l++){const h=s[l];if(h.POSITION!==void 0){const d=n.json.accessors[h.POSITION],p=d.min,f=d.max;if(p!==void 0&&f!==void 0){if(c.setX(Math.max(Math.abs(p[0]),Math.abs(f[0]))),c.setY(Math.max(Math.abs(p[1]),Math.abs(f[1]))),c.setZ(Math.max(Math.abs(p[2]),Math.abs(f[2]))),d.normalized){const v=lb(pd[d.componentType]);c.multiplyScalar(v)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}t.boundingBox=r;const o=new da;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=o}function fD(t,e,n){const i=e.attributes,r=[];function s(o,a){return n.getDependency("accessor",o).then(function(c){t.setAttribute(a,c)})}for(const o in i){const a=cb[o]||o.toLowerCase();a in t.attributes||r.push(s(i[o],a))}if(e.indices!==void 0&&!t.index){const o=n.getDependency("accessor",e.indices).then(function(a){t.setIndex(a)});r.push(o)}return Pt.workingColorSpace!==qi&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Pt.workingColorSpace}" not supported.`),Ia(t,e),Xre(t,e,n),Promise.all(r).then(function(){return e.targets!==void 0?Hre(t,e.targets,n):t})}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var zs=Uint8Array,Zh=Uint16Array,Kre=Int32Array,S5=new zs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),x5=new zs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Yre=new zs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C5=function(t,e){for(var n=new Zh(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];for(var r=new Kre(n[30]),i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return{b:n,r}},_5=C5(S5,2),w5=_5.b,Jre=_5.r;w5[28]=258,Jre[258]=28;var Qre=C5(x5,0),Zre=Qre.b,ub=new Zh(32768);for(var In=0;In<32768;++In){var mc=(In&43690)>>1|(In&21845)<<1;mc=(mc&52428)>>2|(mc&13107)<<2,mc=(mc&61680)>>4|(mc&3855)<<4,ub[In]=((mc&65280)>>8|(mc&255)<<8)>>1}var Cg=function(t,e,n){for(var i=t.length,r=0,s=new Zh(e);r<i;++r)t[r]&&++s[t[r]-1];var o=new Zh(e);for(r=1;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;if(n){a=new Zh(1<<e);var c=15-e;for(r=0;r<i;++r)if(t[r])for(var l=r<<4|t[r],u=e-t[r],h=o[t[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)a[ub[h]>>c]=l}else for(a=new Zh(i),r=0;r<i;++r)t[r]&&(a[r]=ub[o[t[r]-1]++]>>15-t[r]);return a},F0=new zs(288);for(var In=0;In<144;++In)F0[In]=8;for(var In=144;In<256;++In)F0[In]=9;for(var In=256;In<280;++In)F0[In]=7;for(var In=280;In<288;++In)F0[In]=8;var E5=new zs(32);for(var In=0;In<32;++In)E5[In]=5;var ese=Cg(F0,9,1),tse=Cg(E5,5,1),Mw=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ho=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&n},kw=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},nse=function(t){return(t+7)/8|0},ise=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new zs(t.subarray(e,n))},rse=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],fo=function(t,e,n){var i=new Error(e||rse[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,fo),!n)throw i;return i},sse=function(t,e,n,i){var r=t.length,s=0;if(!r||e.f&&!e.l)return n||new zs(0);var o=!n,a=o||e.i!=2,c=e.i;o&&(n=new zs(r*3));var l=function(it){var St=n.length;if(it>St){var U=new zs(Math.max(St*2,it));U.set(n),n=U}},u=e.f||0,h=e.p||0,d=e.b||0,p=e.l,f=e.d,v=e.m,g=e.n,m=r*8;do{if(!p){u=ho(t,h,1);var y=ho(t,h+1,3);if(h+=3,y)if(y==1)p=ese,f=tse,v=9,g=5;else if(y==2){var C=ho(t,h,31)+257,E=ho(t,h+10,15)+4,b=C+ho(t,h+5,31)+1;h+=14;for(var M=new zs(b),_=new zs(19),R=0;R<E;++R)_[Yre[R]]=ho(t,h+R*3,7);h+=E*3;for(var L=Mw(_),O=(1<<L)-1,V=Cg(_,L,1),R=0;R<b;){var X=V[ho(t,h,O)];h+=X&15;var S=X>>4;if(S<16)M[R++]=S;else{var G=0,J=0;for(S==16?(J=3+ho(t,h,3),h+=2,G=M[R-1]):S==17?(J=3+ho(t,h,7),h+=3):S==18&&(J=11+ho(t,h,127),h+=7);J--;)M[R++]=G}}var D=M.subarray(0,C),ne=M.subarray(C);v=Mw(D),g=Mw(ne),p=Cg(D,v,1),f=Cg(ne,g,1)}else fo(1);else{var S=nse(h)+4,x=t[S-4]|t[S-3]<<8,w=S+x;if(w>r){c&&fo(0);break}a&&l(d+x),n.set(t.subarray(S,w),d),e.b=d+=x,e.p=h=w*8,e.f=u;continue}if(h>m){c&&fo(0);break}}a&&l(d+131072);for(var P=(1<<v)-1,ee=(1<<g)-1,ge=h;;ge=h){var G=p[kw(t,h)&P],I=G>>4;if(h+=G&15,h>m){c&&fo(0);break}if(G||fo(2),I<256)n[d++]=I;else if(I==256){ge=h,p=null;break}else{var $=I-254;if(I>264){var R=I-257,K=S5[R];$=ho(t,h,(1<<K)-1)+w5[R],h+=K}var oe=f[kw(t,h)&ee],he=oe>>4;oe||fo(3),h+=oe&15;var ne=Zre[he];if(he>3){var K=x5[he];ne+=kw(t,h)&(1<<K)-1,h+=K}if(h>m){c&&fo(0);break}a&&l(d+131072);var ze=d+$;if(d<ne){var Me=s-ne,dt=Math.min(ne,ze);for(Me+d<0&&fo(3);d<dt;++d)n[d]=i[Me+d]}for(;d<ze;++d)n[d]=n[d-ne]}}e.l=p,e.p=ge,e.b=d,e.f=u,p&&(u=1,e.m=v,e.d=f,e.n=g)}while(!u);return d!=n.length&&o?ise(n,0,d):n.subarray(0,d)},ose=new zs(0),ase=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&fo(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&fo(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function cse(t,e){return sse(t.subarray(ase(t,e),-4),{i:2},e,e)}var lse=typeof TextDecoder<"u"&&new TextDecoder,use=0;try{lse.decode(ose,{stream:!0}),use=1}catch{}function R5(t,e,n){const i=n.length-t-1;if(e>=n[i])return i-1;if(e<=n[t])return t;let r=t,s=i,o=Math.floor((r+s)/2);for(;e<n[o]||e>=n[o+1];)e<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function hse(t,e,n,i){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=e-i[t+1-a],o[a]=i[t+a]-e;let c=0;for(let l=0;l<a;++l){const u=o[l+1],h=s[a-l],d=r[l]/(u+h);r[l]=c+u*d,c=h*d}r[a]=c}return r}function dse(t,e,n,i){const r=R5(t,i,e),s=hse(r,i,t,e),o=new Gt(0,0,0,0);for(let a=0;a<=t;++a){const c=n[r-t+a],l=s[a],u=c.w*l;o.x+=c.x*u,o.y+=c.y*u,o.z+=c.z*u,o.w+=c.w*l}return o}function pse(t,e,n,i,r){const s=[];for(let h=0;h<=n;++h)s[h]=0;const o=[];for(let h=0;h<=i;++h)o[h]=s.slice(0);const a=[];for(let h=0;h<=n;++h)a[h]=s.slice(0);a[0][0]=1;const c=s.slice(0),l=s.slice(0);for(let h=1;h<=n;++h){c[h]=e-r[t+1-h],l[h]=r[t+h]-e;let d=0;for(let p=0;p<h;++p){const f=l[p+1],v=c[h-p];a[h][p]=f+v;const g=a[p][h-1]/a[h][p];a[p][h]=d+f*g,d=v*g}a[h][h]=d}for(let h=0;h<=n;++h)o[0][h]=a[h][n];for(let h=0;h<=n;++h){let d=0,p=1;const f=[];for(let v=0;v<=n;++v)f[v]=s.slice(0);f[0][0]=1;for(let v=1;v<=i;++v){let g=0;const m=h-v,y=n-v;h>=v&&(f[p][0]=f[d][0]/a[y+1][m],g=f[p][0]*a[m][y]);const S=m>=-1?1:-m,x=h-1<=y?v-1:n-h;for(let C=S;C<=x;++C)f[p][C]=(f[d][C]-f[d][C-1])/a[y+1][m+C],g+=f[p][C]*a[m+C][y];h<=y&&(f[p][v]=-f[d][v-1]/a[y+1][h],g+=f[p][v]*a[h][y]),o[v][h]=g;const w=d;d=p,p=w}}let u=n;for(let h=1;h<=i;++h){for(let d=0;d<=n;++d)o[h][d]*=u;u*=n-h}return o}function fse(t,e,n,i,r){const s=r<t?r:t,o=[],a=R5(t,i,e),c=pse(a,i,t,s,e),l=[];for(let u=0;u<n.length;++u){const h=n[u].clone(),d=h.w;h.x*=d,h.y*=d,h.z*=d,l[u]=h}for(let u=0;u<=s;++u){const h=l[a-t].clone().multiplyScalar(c[u][0]);for(let d=1;d<=t;++d)h.add(l[a-t+d].clone().multiplyScalar(c[u][d]));o[u]=h}for(let u=s+1;u<=r+1;++u)o[u]=new Gt(0,0,0);return o}function mse(t,e){let n=1;for(let r=2;r<=t;++r)n*=r;let i=1;for(let r=2;r<=e;++r)i*=r;for(let r=2;r<=t-e;++r)i*=r;return n/i}function gse(t){const e=t.length,n=[],i=[];for(let s=0;s<e;++s){const o=t[s];n[s]=new N(o.x,o.y,o.z),i[s]=o.w}const r=[];for(let s=0;s<e;++s){const o=n[s].clone();for(let a=1;a<=s;++a)o.sub(r[s-a].clone().multiplyScalar(mse(s,a)*i[a]));r[s]=o.divideScalar(i[0])}return r}function vse(t,e,n,i,r){const s=fse(t,e,n,i,r);return gse(s)}class yse extends sie{constructor(e,n,i,r,s){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Gt(a.x,a.y,a.z,a.w)}}getPoint(e,n=new N){const i=n,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=dse(this.degree,this.knots,this.controlPoints,r);return s.w!==1&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,n=new N){const i=n,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=vse(this.degree,this.knots,this.controlPoints,r,1);return i.copy(s[1]).normalize(),i}}let Lt,ei,Cr;class mD extends Ja{constructor(e){super(e)}load(e,n,i,r){const s=this,o=s.path===""?dd.extractUrlBase(e):s.path,a=new iA(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(c){try{n(s.parse(c,o))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},i,r)}parse(e,n){if(Ese(e))Lt=new wse().parse(e);else{const r=A5(e);if(!Rse(r))throw new Error("THREE.FBXLoader: Unknown format.");if(vD(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+vD(r));Lt=new _se().parse(r)}const i=new f5(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new Sse(i,this.manager).parse(Lt)}}class Sse{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){ei=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),i=this.parseMaterials(n),r=this.parseDeformers(),s=new xse().parse(r);return this.parseScene(r,s,i),Cr}parseConnections(){const e=new Map;return"Connections"in Lt&&Lt.Connections.connections.forEach(function(i){const r=i[0],s=i[1],o=i[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:r,relationship:o};e.get(s).children.push(c)}),e}parseImages(){const e={},n={};if("Video"in Lt.Objects){const i=Lt.Objects.Video;for(const r in i){const s=i[r],o=parseInt(r);if(e[o]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(a||c){const l=this.parseImage(i[r]);n[s.RelativeFilename||s.Filename]=l}}}}for(const i in e){const r=e[i];n[r]!==void 0?e[i]=n[r]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const n=e.Content,i=e.RelativeFilename||e.Filename,r=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof n=="string")return"data:"+s+";base64,"+n;{const o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const n=new Map;if("Texture"in Lt.Objects){const i=Lt.Objects.Texture;for(const r in i){const s=this.parseTexture(i[r],e);n.set(parseInt(r),s)}}return n}parseTexture(e,n){const i=this.loadTexture(e,n);i.ID=e.id,i.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(i.wrapS=o===0?sl:na,i.wrapT=a===0?sl:na,"Scaling"in e){const c=e.Scaling.value;i.repeat.x=c[0],i.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;i.offset.x=c[0],i.offset.y=c[1]}return i}loadTexture(e,n){const i=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),r=e.FileName.split(".").pop().toLowerCase(),s=i.has(r)?this.manager.getHandler(`.${r}`):this.textureLoader;if(!s)return console.warn(`FBXLoader: ${r.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new wi;const o=s.path;o||s.setPath(this.textureLoader.path);const a=ei.get(e.id).children;let c;a!==void 0&&a.length>0&&n[a[0].ID]!==void 0&&(c=n[a[0].ID],(c.indexOf("blob:")===0||c.indexOf("data:")===0)&&s.setPath(void 0));const l=s.load(c);return s.setPath(o),l}parseMaterials(e){const n=new Map;if("Material"in Lt.Objects){const i=Lt.Objects.Material;for(const r in i){const s=this.parseMaterial(i[r],e);s!==null&&n.set(parseInt(r),s)}}return n}parseMaterial(e,n){const i=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!ei.has(i))return null;const o=this.parseParameters(e,n,i);let a;switch(s.toLowerCase()){case"phong":a=new Ew;break;case"lambert":a=new wie;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new Ew;break}return a.setValues(o),a.name=r,a}parseParameters(e,n,i){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=Pt.toWorkingColorSpace(new Xe().fromArray(e.Diffuse.value),on):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=Pt.toWorkingColorSpace(new Xe().fromArray(e.DiffuseColor.value),on)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=Pt.toWorkingColorSpace(new Xe().fromArray(e.Emissive.value),on):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=Pt.toWorkingColorSpace(new Xe().fromArray(e.EmissiveColor.value),on)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=Pt.toWorkingColorSpace(new Xe().fromArray(e.Specular.value),on):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=Pt.toWorkingColorSpace(new Xe().fromArray(e.SpecularColor.value),on));const s=this;return ei.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(n,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(n,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(n,o.ID),r.map!==void 0&&(r.map.colorSpace=on);break;case"DisplacementColor":r.displacementMap=s.getTexture(n,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(n,o.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=on);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(n,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(n,o.ID),r.envMap!==void 0&&(r.envMap.mapping=E1,r.envMap.colorSpace=on);break;case"SpecularColor":r.specularMap=s.getTexture(n,o.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=on);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(n,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,n){return"LayeredTexture"in Lt.Objects&&n in Lt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=ei.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in Lt.Objects){const i=Lt.Objects.Deformer;for(const r in i){const s=i[r],o=ei.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(o,i),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[r]=a}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const i=[];return e.children.forEach(function(r){const s=n[r.ID];if(s.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new Ge().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,n){const i=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=n[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=ei.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,n,i){Cr=new Ba;const r=this.parseModels(e.skeletons,n,i),s=Lt.Objects.Model,o=this;r.forEach(function(c){const l=s[c.ID];o.setLookAtProperties(c,l),ei.get(c.ID).parents.forEach(function(h){const d=r.get(h.ID);d!==void 0&&d.add(c)}),c.parent===null&&Cr.add(c)}),this.bindSkeleton(e.skeletons,n,r),this.addGlobalSceneSettings(),Cr.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=T5(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const a=new Cse().parse();Cr.children.length===1&&Cr.children[0].isGroup&&(Cr.children[0].animations=a,Cr=Cr.children[0]),Cr.animations=a}parseModels(e,n,i){const r=new Map,s=Lt.Objects.Model;for(const o in s){const a=parseInt(o),c=s[o],l=ei.get(a);let u=this.buildSkeleton(l,e,a,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,n,i);break;case"NurbsCurve":u=this.createCurve(l,n);break;case"LimbNode":case"Root":u=new Zg;break;case"Null":default:u=new Ba;break}u.name=c.attrName?Kt.sanitizeNodeName(c.attrName):"",u.userData.originalName=c.attrName,u.ID=a}this.getTransformData(u,c),r.set(a,u)}return r}buildSkeleton(e,n,i,r){let s=null;return e.parents.forEach(function(o){for(const a in n){const c=n[a];c.rawBones.forEach(function(l,u){if(l.ID===o.ID){const h=s;s=new Zg,s.matrixWorld.copy(l.transformLink),s.name=r?Kt.sanitizeNodeName(r):"",s.userData.originalName=r,s.ID=i,c.bones[u]=s,h!==null&&s.add(h)}})}}),s}createCamera(e){let n,i;if(e.children.forEach(function(r){const s=Lt.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)n=new Sn;else{let r=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(r=1);let s=1;i.NearPlane!==void 0&&(s=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,c=i.AspectHeight.value);const l=a/c;let u=45;i.FieldOfView!==void 0&&(u=i.FieldOfView.value);const h=i.FocalLength?i.FocalLength.value:null;switch(r){case 0:n=new lr(u,l,s,o),h!==null&&n.setFocalLength(h);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),n=new Sn;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),n=new Sn;break}}return n}createLight(e){let n,i;if(e.children.forEach(function(r){const s=Lt.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)n=new Sn;else{let r;i.LightType===void 0?r=0:r=i.LightType.value;let s=16777215;i.Color!==void 0&&(s=Pt.toWorkingColorSpace(new Xe().fromArray(i.Color.value),on));let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const c=1;switch(r){case 0:n=new D1(s,o,a,c);break;case 1:n=new oA(s,o);break;case 2:let l=Math.PI/3;i.InnerAngle!==void 0&&(l=Hi.degToRad(i.InnerAngle.value));let u=0;i.OuterAngle!==void 0&&(u=Hi.degToRad(i.OuterAngle.value),u=Math.max(u,1)),n=new sA(s,o,a,l,u,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),n=new D1(s,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(n.castShadow=!0)}return n}createMesh(e,n,i){let r,s=null,o=null;const a=[];return e.children.forEach(function(c){n.has(c.ID)&&(s=n.get(c.ID)),i.has(c.ID)&&a.push(i.get(c.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Ew({name:Ja.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(r=new eA(s,o),r.normalizeSkinWeights()):r=new gn(s,o),r}createCurve(e,n){const i=e.children.reduce(function(s,o){return n.has(o.ID)&&(s=n.get(o.ID)),s},null),r=new tA({name:Ja.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new eC(i,r)}getTransformData(e,n){const i={};"InheritType"in n&&(i.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?i.eulerOrder=r0(n.RotationOrder.value):i.eulerOrder=r0(0),"Lcl_Translation"in n&&(i.translation=n.Lcl_Translation.value),"PreRotation"in n&&(i.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(i.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(i.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(i.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(i.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(i.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(i.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(i.rotationPivot=n.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,n){"LookAtProperty"in n&&ei.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=Lt.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Cr.add(e.target)):e.lookAt(new N().fromArray(o))}}})}bindSkeleton(e,n,i){const r=this.parsePoseNodes();for(const s in e){const o=e[s];ei.get(parseInt(o.ID)).parents.forEach(function(c){if(n.has(c.ID)){const l=c.ID;ei.get(l).parents.forEach(function(h){i.has(h.ID)&&i.get(h.ID).bind(new N0(o.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Lt.Objects){const n=Lt.Objects.Pose;for(const i in n)if(n[i].attrType==="BindPose"&&n[i].NbPoseNodes>0){const r=n[i].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new Ge().fromArray(s.Matrix.a)}):e[r.Node]=new Ge().fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Lt){if("AmbientColor"in Lt.GlobalSettings){const e=Lt.GlobalSettings.AmbientColor.value,n=e[0],i=e[1],r=e[2];if(n!==0||i!==0||r!==0){const s=new Xe().setRGB(n,i,r,on);Cr.add(new m5(s,1))}}"UnitScaleFactor"in Lt.GlobalSettings&&(Cr.userData.unitScaleFactor=Lt.GlobalSettings.UnitScaleFactor.value)}}}class xse{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in Lt.Objects){const i=Lt.Objects.Geometry;for(const r in i){const s=ei.get(parseInt(r)),o=this.parseGeometry(s,i[r],e);n.set(parseInt(r),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,i){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,i);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,i){const r=i.skeletons,s=[],o=e.parents.map(function(h){return Lt.Objects.Model[h.ID]});if(o.length===0)return;const a=e.children.reduce(function(h,d){return r[d.ID]!==void 0&&(h=r[d.ID]),h},null);e.children.forEach(function(h){i.morphTargets[h.ID]!==void 0&&s.push(i.morphTargets[h.ID])});const c=o[0],l={};"RotationOrder"in c&&(l.eulerOrder=r0(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const u=T5(l);return this.genGeometry(n,a,s,u)}genGeometry(e,n,i,r){const s=new ys;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,n),a=this.genBuffers(o),c=new wr(a.vertex,3);if(c.applyMatrix4(r),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new wr(a.colors,3)),n&&(s.setAttribute("skinIndex",new K2(a.weightsIndices,4)),s.setAttribute("skinWeight",new wr(a.vertexWeights,4)),s.FBX_Deformer=n),a.normal.length>0){const l=new Tt().getNormalMatrix(r),u=new wr(a.normal,3);u.applyNormalMatrix(l),s.setAttribute("normal",u)}if(a.uvs.forEach(function(l,u){const h=u===0?"uv":`uv${u}`;s.setAttribute(h,new wr(a.uvs[u],2))}),o.material&&o.material.mappingType!=="AllSame"){let l=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(h,d){h!==l&&(s.addGroup(u,d-u,l),l=h,u=d)}),s.groups.length>0){const h=s.groups[s.groups.length-1],d=h.start+h.count;d!==a.materialIndex.length&&s.addGroup(d,a.materialIndex.length-d,l)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,i,r),s}parseGeoNode(e,n){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return i.weightTable={},n!==null&&(i.skeleton=n,n.rawBones.forEach(function(r,s){r.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:s,weight:r.weights[a]})})})),i}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,r=0,s=!1,o=[],a=[],c=[],l=[],u=[],h=[];const d=this;return e.vertexIndices.forEach(function(p,f){let v,g=!1;p<0&&(p=p^-1,g=!0);let m=[],y=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const S=Zv(f,i,p,e.color);c.push(S[0],S[1],S[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(S){y.push(S.weight),m.push(S.id)}),y.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const S=[0,0,0,0],x=[0,0,0,0];y.forEach(function(w,C){let E=w,b=m[C];x.forEach(function(M,_,R){if(E>M){R[_]=E,E=M;const L=S[_];S[_]=b,b=L}})}),m=S,y=x}for(;y.length<4;)y.push(0),m.push(0);for(let S=0;S<4;++S)u.push(y[S]),h.push(m[S])}if(e.normal){const S=Zv(f,i,p,e.normal);a.push(S[0],S[1],S[2])}e.material&&e.material.mappingType!=="AllSame"&&(v=Zv(f,i,p,e.material)[0],v<0&&(d.negativeMaterialIndices=!0,v=0)),e.uv&&e.uv.forEach(function(S,x){const w=Zv(f,i,p,S);l[x]===void 0&&(l[x]=[]),l[x].push(w[0]),l[x].push(w[1])}),r++,g&&(d.genFace(n,e,o,v,a,c,l,u,h,r),i++,r=0,o=[],a=[],c=[],l=[],u=[],h=[])}),n}getNormalNewell(e){const n=new N(0,0,0);for(let i=0;i<e.length;i++){const r=e[i],s=e[(i+1)%e.length];n.x+=(r.y-s.y)*(r.z+s.z),n.y+=(r.z-s.z)*(r.x+s.x),n.z+=(r.x-s.x)*(r.y+s.y)}return n.normalize(),n}getNormalTangentAndBitangent(e){const n=this.getNormalNewell(e),r=(Math.abs(n.z)>.5?new N(0,1,0):new N(0,0,1)).cross(n).normalize(),s=n.clone().cross(r).normalize();return{normal:n,tangent:r,bitangent:s}}flattenVertex(e,n,i){return new gt(e.dot(n),e.dot(i))}genFace(e,n,i,r,s,o,a,c,l,u){let h;if(u>3){const d=[],p=n.baseVertexPositions||n.vertexPositions;for(let m=0;m<i.length;m+=3)d.push(new N(p[i[m]],p[i[m+1]],p[i[m+2]]));const{tangent:f,bitangent:v}=this.getNormalTangentAndBitangent(d),g=[];for(const m of d)g.push(this.flattenVertex(m,f,v));h=nA.triangulateShape(g,[])}else h=[[0,1,2]];for(const[d,p,f]of h)e.vertex.push(n.vertexPositions[i[d*3]]),e.vertex.push(n.vertexPositions[i[d*3+1]]),e.vertex.push(n.vertexPositions[i[d*3+2]]),e.vertex.push(n.vertexPositions[i[p*3]]),e.vertex.push(n.vertexPositions[i[p*3+1]]),e.vertex.push(n.vertexPositions[i[p*3+2]]),e.vertex.push(n.vertexPositions[i[f*3]]),e.vertex.push(n.vertexPositions[i[f*3+1]]),e.vertex.push(n.vertexPositions[i[f*3+2]]),n.skeleton&&(e.vertexWeights.push(c[d*4]),e.vertexWeights.push(c[d*4+1]),e.vertexWeights.push(c[d*4+2]),e.vertexWeights.push(c[d*4+3]),e.vertexWeights.push(c[p*4]),e.vertexWeights.push(c[p*4+1]),e.vertexWeights.push(c[p*4+2]),e.vertexWeights.push(c[p*4+3]),e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.weightsIndices.push(l[d*4]),e.weightsIndices.push(l[d*4+1]),e.weightsIndices.push(l[d*4+2]),e.weightsIndices.push(l[d*4+3]),e.weightsIndices.push(l[p*4]),e.weightsIndices.push(l[p*4+1]),e.weightsIndices.push(l[p*4+2]),e.weightsIndices.push(l[p*4+3]),e.weightsIndices.push(l[f*4]),e.weightsIndices.push(l[f*4+1]),e.weightsIndices.push(l[f*4+2]),e.weightsIndices.push(l[f*4+3])),n.color&&(e.colors.push(o[d*3]),e.colors.push(o[d*3+1]),e.colors.push(o[d*3+2]),e.colors.push(o[p*3]),e.colors.push(o[p*3+1]),e.colors.push(o[p*3+2]),e.colors.push(o[f*3]),e.colors.push(o[f*3+1]),e.colors.push(o[f*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),n.normal&&(e.normal.push(s[d*3]),e.normal.push(s[d*3+1]),e.normal.push(s[d*3+2]),e.normal.push(s[p*3]),e.normal.push(s[p*3+1]),e.normal.push(s[p*3+2]),e.normal.push(s[f*3]),e.normal.push(s[f*3+1]),e.normal.push(s[f*3+2])),n.uv&&n.uv.forEach(function(v,g){e.uvs[g]===void 0&&(e.uvs[g]=[]),e.uvs[g].push(a[g][d*2]),e.uvs[g].push(a[g][d*2+1]),e.uvs[g].push(a[g][p*2]),e.uvs[g].push(a[g][p*2+1]),e.uvs[g].push(a[g][f*2]),e.uvs[g].push(a[g][f*2+1])})}addMorphTargets(e,n,i,r){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const c=Lt.Objects.Geometry[a.geoID];c!==void 0&&s.genMorphGeometry(e,n,c,r,a.name)})})}genMorphGeometry(e,n,i,r,s){const o=n.Vertices!==void 0?n.Vertices.a:[],a=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],c=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],u=e.attributes.position.count*3,h=new Float32Array(u);for(let v=0;v<l.length;v++){const g=l[v]*3;h[g]=c[v*3],h[g+1]=c[v*3+1],h[g+2]=c[v*3+2]}const d={vertexIndices:a,vertexPositions:h,baseVertexPositions:o},p=this.genBuffers(d),f=new wr(p.vertex,3);f.name=s||i.attrName,f.applyMatrix4(r),e.morphAttributes.position.push(f)}parseNormals(e){const n=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Normals.a;let s=[];return i==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:n,referenceType:i}}parseUVs(e){const n=e.MappingInformationType,i=e.ReferenceInformationType,r=e.UV.a;let s=[];return i==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:n,referenceType:i}}parseVertexColors(e){const n=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Colors.a;let s=[];i==="IndexToDirect"&&(s=e.ColorIndex.a);for(let o=0,a=new Xe;o<r.length;o+=4)a.fromArray(r,o),Pt.toWorkingColorSpace(a,on),a.toArray(r,o);return{dataSize:4,buffer:r,indices:s,mappingType:n,referenceType:i}}parseMaterialIndices(e){const n=e.MappingInformationType,i=e.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:n,referenceType:i}}parseNurbsGeometry(e){const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ys;const i=n-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let h=0,d=o.length;h<d;h+=4)s.push(new Gt().fromArray(o,h));let a,c;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=i,c=r.length-1-a;for(let h=0;h<i;++h)s.push(s[h])}const u=new yse(i,r,s,a,c).getPoints(s.length*12);return new ys().setFromPoints(u)}}class Cse{parse(){const e=[],n=this.parseClips();if(n!==void 0)for(const i in n){const r=n[i],s=this.addClip(r);e.push(s)}return e}parseClips(){if(Lt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=Lt.Objects.AnimationCurveNode,n=new Map;for(const i in e){const r=e[i];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};n.set(s.id,s)}}return n}parseAnimationCurves(e){const n=Lt.Objects.AnimationCurve;for(const i in n){const r={id:n[i].id,times:n[i].KeyTime.a.map(bse),values:n[i].KeyValueFloat.a},s=ei.get(r.id);if(s!==void 0){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const n=Lt.Objects.AnimationLayer,i=new Map;for(const r in n){const s=[],o=ei.get(parseInt(r));o!==void 0&&(o.children.forEach(function(c,l){if(e.has(c.ID)){const u=e.get(c.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(s[l]===void 0){const h=ei.get(c.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(h!==void 0){const d=Lt.Objects.Model[h.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const p={modelName:d.attrName?Kt.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Cr.traverse(function(f){f.ID===d.id&&(p.transform=f.matrix,f.userData.transformData&&(p.eulerOrder=f.userData.transformData.eulerOrder))}),p.transform||(p.transform=new Ge),"PreRotation"in d&&(p.preRotation=d.PreRotation.value),"PostRotation"in d&&(p.postRotation=d.PostRotation.value),s[l]=p}}s[l]&&(s[l][u.attr]=u)}else if(u.curves.morph!==void 0){if(s[l]===void 0){const h=ei.get(c.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,d=ei.get(h).parents[0].ID,p=ei.get(d).parents[0].ID,f=ei.get(p).parents[0].ID,v=Lt.Objects.Model[f],g={modelName:v.attrName?Kt.sanitizeNodeName(v.attrName):"",morphName:Lt.Objects.Deformer[h].attrName};s[l]=g}s[l][u.attr]=u}}}),i.set(parseInt(r),s))}return i}parseAnimStacks(e){const n=Lt.Objects.AnimationStack,i={};for(const r in n){const s=ei.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);i[r]={name:n[r].attrName,layer:o}}return i}addClip(e){let n=[];const i=this;return e.layer.forEach(function(r){n=n.concat(i.generateTracks(r))}),new L1(e.name,-1,n)}generateTracks(e){const n=[];let i=new N,r=new N;if(e.transform&&e.transform.decompose(i,new Xt,r),i=i.toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");s!==void 0&&n.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&n.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");s!==void 0&&n.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&n.push(s)}return n}generateVectorTrack(e,n,i,r){const s=this.getTimesForAllAxes(n),o=this.getKeyframeTrackValues(s,n,i);return new Du(e+"."+r,s,o)}generateRotationTrack(e,n,i,r,s){let o,a;if(n.x!==void 0&&n.y!==void 0&&n.z!==void 0){const d=this.interpolateRotations(n.x,n.y,n.z,s);o=d[0],a=d[1]}const c=r0(0);i!==void 0&&(i=i.map(Hi.degToRad),i.push(c),i=new fn().fromArray(i),i=new Xt().setFromEuler(i)),r!==void 0&&(r=r.map(Hi.degToRad),r.push(c),r=new fn().fromArray(r),r=new Xt().setFromEuler(r).invert());const l=new Xt,u=new fn,h=[];if(!a||!o)return new al(e+".quaternion",[0],[0]);for(let d=0;d<a.length;d+=3)u.set(a[d],a[d+1],a[d+2],s),l.setFromEuler(u),i!==void 0&&l.premultiply(i),r!==void 0&&l.multiply(r),d>2&&new Xt().fromArray(h,(d-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(h,d/3*4);return new al(e+".quaternion",o,h)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,i=n.values.map(function(s){return s/100}),r=Cr.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Lu(e.modelName+".morphTargetInfluences["+r+"]",n.times,i)}getTimesForAllAxes(e){let n=[];if(e.x!==void 0&&(n=n.concat(e.x.times)),e.y!==void 0&&(n=n.concat(e.y.times)),e.z!==void 0&&(n=n.concat(e.z.times)),n=n.sort(function(i,r){return i-r}),n.length>1){let i=1,r=n[0];for(let s=1;s<n.length;s++){const o=n[s];o!==r&&(n[i]=o,r=o,i++)}n=n.slice(0,i)}return n}getKeyframeTrackValues(e,n,i){const r=i,s=[];let o=-1,a=-1,c=-1;return e.forEach(function(l){if(n.x&&(o=n.x.times.indexOf(l)),n.y&&(a=n.y.times.indexOf(l)),n.z&&(c=n.z.times.indexOf(l)),o!==-1){const u=n.x.values[o];s.push(u),r[0]=u}else s.push(r[0]);if(a!==-1){const u=n.y.values[a];s.push(u),r[1]=u}else s.push(r[1]);if(c!==-1){const u=n.z.values[c];s.push(u),r[2]=u}else s.push(r[2])}),s}interpolateRotations(e,n,i,r){const s=[],o=[];s.push(e.times[0]),o.push(Hi.degToRad(e.values[0])),o.push(Hi.degToRad(n.values[0])),o.push(Hi.degToRad(i.values[0]));for(let a=1;a<e.values.length;a++){const c=[e.values[a-1],n.values[a-1],i.values[a-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const l=c.map(Hi.degToRad),u=[e.values[a],n.values[a],i.values[a]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const h=u.map(Hi.degToRad),d=[u[0]-c[0],u[1]-c[1],u[2]-c[2]],p=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const v=Math.max(...p)/180,g=new fn(...l,r),m=new fn(...h,r),y=new Xt().setFromEuler(g),S=new Xt().setFromEuler(m);y.dot(S)&&S.set(-S.x,-S.y,-S.z,-S.w);const x=e.times[a-1],w=e.times[a]-x,C=new Xt,E=new fn;for(let b=0;b<1;b+=1/v)C.copy(y.clone().slerp(S.clone(),b)),s.push(x+b*w),E.setFromQuaternion(C,r),o.push(E.x),o.push(E.y),o.push(E.z)}else s.push(e.times[a]),o.push(Hi.degToRad(e.values[a])),o.push(Hi.degToRad(n.values[a])),o.push(Hi.degToRad(i.values[a]))}return[s,o]}}class _se{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new b5,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,i=e.split(/[\r\n]+/);return i.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const c=r.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),l=r.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=r.match("^\\t{"+(n.currentIndent-1)+"}}");c?n.parseNodeBegin(r,c):l?n.parseNodeProperty(r,l,i[++s]):u?n.popStack():r.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,n){const i=n[1].trim().replace(/^"/,"").replace(/"$/,""),r=n[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:i},o=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,s):i in a?(i==="PoseNode"?a.PoseNode.push(s):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=s)):typeof o.id=="number"?(a[i]={},a[i][o.id]=s):i!=="Properties70"&&(i==="PoseNode"?a[i]=[s]:a[i]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let n=e[0];e[0]!==""&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let i="",r="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:n,name:i,type:r}}parseNodeProperty(e,n,i){let r=n[1].replace(/^"/,"").replace(/"$/,"").trim(),s=n[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const c=s.split(",").slice(1),l=parseInt(c[0]),u=parseInt(c[1]);let h=s.split(",").slice(3);h=h.map(function(d){return d.trim().replace(/^"/,"")}),r="connections",s=[l,u],Ase(s,h),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):r!=="a"?o[r]=s:o.a=s,this.setCurrentProp(o,r),r==="a"&&s.slice(-1)!==","&&(o.a=Dw(s))}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,e.slice(-1)!==","&&(n.a=Dw(n.a))}parseNodeSpecialProperty(e,n,i){const r=i.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],a=r[2],c=r[3];let l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Dw(l);break}this.getPrevNode()[s]={type:o,type2:a,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),s)}}class wse{parse(e){const n=new gD(e);n.skip(23);const i=n.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const r=new b5;for(;!this.endOfContent(n);){const s=this.parseNode(n,i);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const i={},r=n>=7500?e.getUint64():e.getUint32(),s=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(r===0)return null;const c=[];for(let d=0;d<s;d++)c.push(this.parseProperty(e));const l=c.length>0?c[0]:"",u=c.length>1?c[1]:"",h=c.length>2?c[2]:"";for(i.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const d=this.parseNode(e,n);d!==null&&this.parseSubNode(a,i,d)}return i.propertyList=c,typeof l=="number"&&(i.id=l),u!==""&&(i.attrName=u),h!==""&&(i.attrType=h),a!==""&&(i.name=a),i}parseSubNode(e,n,i){if(i.singleProperty===!0){const r=i.propertyList[0];Array.isArray(r)?(n[i.name]=i,i.a=r):n[i.name]=r}else if(e==="Connections"&&i.name==="C"){const r=[];i.propertyList.forEach(function(s,o){o!==0&&r.push(s)}),n.connections===void 0&&(n.connections=[]),n.connections.push(r)}else if(i.name==="Properties70")Object.keys(i).forEach(function(s){n[s]=i[s]});else if(e==="Properties70"&&i.name==="P"){let r=i.propertyList[0],s=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:c=i.propertyList[4],n[r]={type:s,type2:o,flag:a,value:c}}else n[i.name]===void 0?typeof i.id=="number"?(n[i.name]={},n[i.name][i.id]=i):n[i.name]=i:i.name==="PoseNode"?(Array.isArray(n[i.name])||(n[i.name]=[n[i.name]]),n[i.name].push(i)):n[i.name][i.id]===void 0&&(n[i.name][i.id]=i)}parseProperty(e){const n=e.getString(1);let i;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(n){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=cse(new Uint8Array(e.getArrayBuffer(o))),c=new gD(a.buffer);switch(n){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class gD{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=n!==void 0?n:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const n=[];for(let i=0;i<e;i++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n&2147483648?(n=~n&4294967295,e=~e&4294967295,e===4294967295&&(n=n+1&4294967295),e=e+1&4294967295,-(n*4294967296+e)):n*4294967296+e}getInt64Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){const n=this.offset;let i=new Uint8Array(this.dv.buffer,n,e);this.skip(e);const r=i.indexOf(0);return r>=0&&(i=new Uint8Array(this.dv.buffer,n,r)),this._textDecoder.decode(i)}}class b5{add(e,n){this[e]=n}}function Ese(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===A5(t,0,e.length)}function Rse(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(r){const s=t[r-1];return t=t.slice(n+r),n++,s}for(let r=0;r<e.length;++r)if(i(1)===e[r])return!1;return!0}function vD(t){const e=/FBXVersion: (\d+)/,n=t.match(e);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function bse(t){return t/46186158e3}const Tse=[];function Zv(t,e,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=t;break;case"ByPolygon":r=e;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return Pse(Tse,i.buffer,s,o)}const Lw=new fn,bh=new N;function T5(t){const e=new Ge,n=new Ge,i=new Ge,r=new Ge,s=new Ge,o=new Ge,a=new Ge,c=new Ge,l=new Ge,u=new Ge,h=new Ge,d=new Ge,p=t.inheritType?t.inheritType:0;t.translation&&e.setPosition(bh.fromArray(t.translation));const f=r0(0);if(t.preRotation){const R=t.preRotation.map(Hi.degToRad);R.push(f),n.makeRotationFromEuler(Lw.fromArray(R))}if(t.rotation){const R=t.rotation.map(Hi.degToRad);R.push(t.eulerOrder||f),i.makeRotationFromEuler(Lw.fromArray(R))}if(t.postRotation){const R=t.postRotation.map(Hi.degToRad);R.push(f),r.makeRotationFromEuler(Lw.fromArray(R)),r.invert()}t.scale&&s.scale(bh.fromArray(t.scale)),t.scalingOffset&&a.setPosition(bh.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(bh.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(bh.fromArray(t.rotationOffset)),t.rotationPivot&&l.setPosition(bh.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h.copy(t.parentMatrix),u.copy(t.parentMatrixWorld));const v=n.clone().multiply(i).multiply(r),g=new Ge;g.extractRotation(u);const m=new Ge;m.copyPosition(u);const y=m.clone().invert().multiply(u),S=g.clone().invert().multiply(y),x=s,w=new Ge;if(p===0)w.copy(g).multiply(v).multiply(S).multiply(x);else if(p===1)w.copy(g).multiply(S).multiply(v).multiply(x);else{const L=new Ge().scale(new N().setFromMatrixScale(h)).clone().invert(),O=S.clone().multiply(L);w.copy(g).multiply(v).multiply(O).multiply(x)}const C=l.clone().invert(),E=o.clone().invert();let b=e.clone().multiply(c).multiply(l).multiply(n).multiply(i).multiply(r).multiply(C).multiply(a).multiply(o).multiply(s).multiply(E);const M=new Ge().copyPosition(b),_=u.clone().multiply(M);return d.copyPosition(_),b=d.clone().multiply(w),b.premultiply(u.invert()),b}function r0(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return t===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function Dw(t){return t.split(",").map(function(n){return parseFloat(n)})}function A5(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=t.byteLength),new TextDecoder().decode(new Uint8Array(t,e,n))}function Ase(t,e){for(let n=0,i=t.length,r=e.length;n<r;n++,i++)t[i]=e[n]}function Pse(t,e,n,i){for(let r=n,s=0;r<i;r++,s++)t[s]=e[r];return t}class Ise extends s5{constructor(){super();const e=new lp;e.deleteAttribute("uv");const n=new i0({side:br}),i=new i0,r=new D1(16777215,900,28,2);r.position.set(.418,16.199,.3),this.add(r);const s=new gn(e,n);s.position.set(-.757,13.219,.717),s.scale.set(31.713,28.305,28.591),this.add(s);const o=new gn(e,i);o.position.set(-10.906,2.009,1.846),o.rotation.set(0,-.195,0),o.scale.set(2.328,7.905,4.651),this.add(o);const a=new gn(e,i);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);const c=new gn(e,i);c.position.set(6.167,.857,7.803),c.rotation.set(0,.561,0),c.scale.set(3.927,6.285,3.687),this.add(c);const l=new gn(e,i);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);const u=new gn(e,i);u.position.set(2.291,-.756,-2.621),u.rotation.set(0,-.286,0),u.scale.set(1.546,1.552,1.496),this.add(u);const h=new gn(e,i);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const d=new gn(e,Th(50));d.position.set(-16.116,14.37,8.208),d.scale.set(.1,2.428,2.739),this.add(d);const p=new gn(e,Th(50));p.position.set(-16.109,18.021,-8.207),p.scale.set(.1,2.425,2.751),this.add(p);const f=new gn(e,Th(17));f.position.set(14.904,12.198,-1.832),f.scale.set(.15,4.265,6.331),this.add(f);const v=new gn(e,Th(43));v.position.set(-.462,8.89,14.52),v.scale.set(4.38,5.441,.088),this.add(v);const g=new gn(e,Th(20));g.position.set(3.235,11.486,-12.541),g.scale.set(2.5,2,.1),this.add(g);const m=new gn(e,Th(100));m.position.set(0,20,0),m.scale.set(1,.1,1),this.add(m)}dispose(){const e=new Set;this.traverse(n=>{n.isMesh&&(e.add(n.geometry),e.add(n.material))});for(const n of e)n.dispose()}}function Th(t){const e=new Nc;return e.color.setScalar(t),e}var _g=function(){var t=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),i(++t%e.children.length)},!1);function n(u){return e.appendChild(u.dom),u}function i(u){for(var h=0;h<e.children.length;h++)e.children[h].style.display=h===u?"block":"none";t=u}var r=(performance||Date).now(),s=r,o=0,a=n(new _g.Panel("FPS","#0ff","#002")),c=n(new _g.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new _g.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:n,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){o++;var u=(performance||Date).now();if(c.update(u-r,200),u>=s+1e3&&(a.update(o*1e3/(u-s),100),s=u,o=0,l)){var h=performance.memory;l.update(h.usedJSHeapSize/1048576,h.jsHeapSizeLimit/1048576)}return u},update:function(){r=this.end()},domElement:e,setMode:i}};_g.Panel=function(t,e,n){var i=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,c=48*o,l=3*o,u=2*o,h=3*o,d=15*o,p=74*o,f=30*o,v=document.createElement("canvas");v.width=a,v.height=c,v.style.cssText="width:80px;height:48px";var g=v.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,c),g.fillStyle=e,g.fillText(t,l,u),g.fillRect(h,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,p,f),{dom:v,update:function(m,y){i=Math.min(i,m),r=Math.max(r,m),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=e,g.fillText(s(m)+" "+t+" ("+s(i)+"-"+s(r)+")",l,u),g.drawImage(v,h+o,d,p-o,f,h,d,p-o,f),g.fillRect(h+p-o,d,o,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+p-o,d,o,s((1-m/y)*f))}}};class Mse{constructor(e,n=null){this.nodeAvatar=e,this.opt={jwtGet:null,ttsEndpoint:null,ttsApikey:null,ttsTrimStart:0,ttsTrimEnd:400,ttsLang:"fi-FI",ttsVoice:"fi-FI-Standard-A",ttsRate:.95,ttsPitch:0,ttsVolume:0,lipsyncLang:"fi",lipsyncModules:["fi","en","lt"],pcmSampleRate:22050,modelRoot:"Armature",modelPixelRatio:1,modelFPS:30,modelMovementFactor:1,cameraView:"full",cameraDistance:0,cameraX:0,cameraY:0,cameraRotateX:0,cameraRotateY:0,cameraRotateEnable:!0,cameraPanEnable:!1,cameraZoomEnable:!1,lightAmbientColor:16777215,lightAmbientIntensity:2,lightDirectColor:8947882,lightDirectIntensity:30,lightDirectPhi:1,lightDirectTheta:2,lightSpotIntensity:0,lightSpotColor:3377407,lightSpotPhi:.1,lightSpotTheta:4,lightSpotDispersion:1,avatarMood:"neutral",avatarMute:!1,markedOptions:{mangle:!1,headerIds:!1,breaks:!0},statsNode:null,statsStyle:null},Object.assign(this.opt,n||{}),this.opt.statsNode&&(this.stats=new _g,this.opt.statsStyle&&(this.stats.dom.style.cssText=this.opt.statsStyle),this.opt.statsNode.appendChild(this.stats.dom)),this.poseTemplates={side:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.003,y:-.017,z:.1},"Spine.rotation":{x:-.103,y:-.002,z:-.063},"Spine1.rotation":{x:.042,y:-.02,z:-.069},"Spine2.rotation":{x:.131,y:-.012,z:-.065},"Neck.rotation":{x:.027,y:.006,z:0},"Head.rotation":{x:.077,y:-.065,z:0},"LeftShoulder.rotation":{x:1.599,y:.084,z:-1.77},"LeftArm.rotation":{x:1.364,y:.052,z:-.044},"LeftForeArm.rotation":{x:.002,y:-.007,z:.331},"LeftHand.rotation":{x:.104,y:-.067,z:-.174},"LeftHandThumb1.rotation":{x:.231,y:.258,z:.355},"LeftHandThumb2.rotation":{x:-.106,y:-.339,z:-.454},"LeftHandThumb3.rotation":{x:-.02,y:-.142,z:-.004},"LeftHandIndex1.rotation":{x:.148,y:.032,z:-.069},"LeftHandIndex2.rotation":{x:.326,y:-.049,z:-.029},"LeftHandIndex3.rotation":{x:.247,y:-.053,z:-.073},"LeftHandMiddle1.rotation":{x:.238,y:-.057,z:-.089},"LeftHandMiddle2.rotation":{x:.469,y:-.036,z:-.081},"LeftHandMiddle3.rotation":{x:.206,y:-.015,z:-.017},"LeftHandRing1.rotation":{x:.187,y:-.118,z:-.157},"LeftHandRing2.rotation":{x:.579,y:.02,z:-.097},"LeftHandRing3.rotation":{x:.272,y:.021,z:-.063},"LeftHandPinky1.rotation":{x:.405,y:-.182,z:-.138},"LeftHandPinky2.rotation":{x:.613,y:.128,z:-.144},"LeftHandPinky3.rotation":{x:.268,y:.094,z:-.081},"RightShoulder.rotation":{x:1.541,y:.192,z:1.775},"RightArm.rotation":{x:1.273,y:-.352,z:-.067},"RightForeArm.rotation":{x:-.011,y:-.031,z:-.357},"RightHand.rotation":{x:-.008,y:.312,z:-.028},"RightHandThumb1.rotation":{x:.23,y:-.258,z:-.355},"RightHandThumb2.rotation":{x:-.107,y:.339,z:.454},"RightHandThumb3.rotation":{x:-.02,y:.142,z:.004},"RightHandIndex1.rotation":{x:.148,y:-.031,z:.069},"RightHandIndex2.rotation":{x:.326,y:.049,z:.029},"RightHandIndex3.rotation":{x:.247,y:.053,z:.073},"RightHandMiddle1.rotation":{x:.237,y:.057,z:.089},"RightHandMiddle2.rotation":{x:.469,y:.036,z:.081},"RightHandMiddle3.rotation":{x:.206,y:.015,z:.017},"RightHandRing1.rotation":{x:.204,y:.086,z:.135},"RightHandRing2.rotation":{x:.579,y:-.02,z:.098},"RightHandRing3.rotation":{x:.272,y:-.021,z:.063},"RightHandPinky1.rotation":{x:.404,y:.182,z:.137},"RightHandPinky2.rotation":{x:.613,y:-.128,z:.144},"RightHandPinky3.rotation":{x:.268,y:-.094,z:.081},"LeftUpLeg.rotation":{x:.096,y:.209,z:2.983},"LeftLeg.rotation":{x:-.053,y:.042,z:-.017},"LeftFoot.rotation":{x:1.091,y:.15,z:.026},"LeftToeBase.rotation":{x:.469,y:-.07,z:-.015},"RightUpLeg.rotation":{x:-.307,y:-.219,z:2.912},"RightLeg.rotation":{x:-.359,y:.164,z:.015},"RightFoot.rotation":{x:1.035,y:.11,z:.005},"RightToeBase.rotation":{x:.467,y:.07,z:.015}}},hip:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.036,y:.09,z:.135},"Spine.rotation":{x:.076,y:-.035,z:.01},"Spine1.rotation":{x:-.096,y:.013,z:-.094},"Spine2.rotation":{x:-.014,y:.002,z:-.097},"Neck.rotation":{x:.034,y:-.051,z:-.075},"Head.rotation":{x:.298,y:-.1,z:.154},"LeftShoulder.rotation":{x:1.694,y:.011,z:-1.68},"LeftArm.rotation":{x:1.343,y:.177,z:-.153},"LeftForeArm.rotation":{x:-.049,y:.134,z:.351},"LeftHand.rotation":{x:.057,y:-.189,z:-.026},"LeftHandThumb1.rotation":{x:.368,y:-.066,z:.438},"LeftHandThumb2.rotation":{x:-.156,y:.029,z:-.369},"LeftHandThumb3.rotation":{x:.034,y:-.009,z:.016},"LeftHandIndex1.rotation":{x:.157,y:-.002,z:-.171},"LeftHandIndex2.rotation":{x:.099,y:0,z:0},"LeftHandIndex3.rotation":{x:.1,y:0,z:0},"LeftHandMiddle1.rotation":{x:.222,y:-.019,z:-.16},"LeftHandMiddle2.rotation":{x:.142,y:0,z:0},"LeftHandMiddle3.rotation":{x:.141,y:0,z:0},"LeftHandRing1.rotation":{x:.333,y:-.039,z:-.174},"LeftHandRing2.rotation":{x:.214,y:0,z:0},"LeftHandRing3.rotation":{x:.213,y:0,z:0},"LeftHandPinky1.rotation":{x:.483,y:-.069,z:-.189},"LeftHandPinky2.rotation":{x:.312,y:0,z:0},"LeftHandPinky3.rotation":{x:.309,y:0,z:0},"RightShoulder.rotation":{x:1.597,y:.012,z:1.816},"RightArm.rotation":{x:.618,y:-1.274,z:-.266},"RightForeArm.rotation":{x:-.395,y:-.097,z:-1.342},"RightHand.rotation":{x:-.816,y:-.057,z:-.976},"RightHandThumb1.rotation":{x:.42,y:.23,z:-1.172},"RightHandThumb2.rotation":{x:-.027,y:.361,z:.122},"RightHandThumb3.rotation":{x:.076,y:.125,z:-.371},"RightHandIndex1.rotation":{x:-.158,y:-.045,z:.033},"RightHandIndex2.rotation":{x:.391,y:.051,z:.025},"RightHandIndex3.rotation":{x:.317,y:.058,z:.07},"RightHandMiddle1.rotation":{x:.486,y:.066,z:.014},"RightHandMiddle2.rotation":{x:.718,y:.055,z:.07},"RightHandMiddle3.rotation":{x:.453,y:.019,z:.013},"RightHandRing1.rotation":{x:.591,y:.241,z:.11},"RightHandRing2.rotation":{x:1.014,y:.023,z:.097},"RightHandRing3.rotation":{x:.708,y:.008,z:.066},"RightHandPinky1.rotation":{x:1.02,y:.305,z:.051},"RightHandPinky2.rotation":{x:1.187,y:-.028,z:.191},"RightHandPinky3.rotation":{x:.872,y:-.031,z:.121},"LeftUpLeg.rotation":{x:-.095,y:-.058,z:-3.338},"LeftLeg.rotation":{x:-.366,y:.287,z:-.021},"LeftFoot.rotation":{x:1.131,y:.21,z:.176},"LeftToeBase.rotation":{x:.739,y:-.068,z:-.001},"RightUpLeg.rotation":{x:-.502,y:.362,z:3.153},"RightLeg.rotation":{x:-1.002,y:.109,z:.008},"RightFoot.rotation":{x:.626,y:-.097,z:-.194},"RightToeBase.rotation":{x:1.33,y:.288,z:-.078}}},turn:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.07,y:-.604,z:-.004},"Spine.rotation":{x:-.007,y:.003,z:.071},"Spine1.rotation":{x:-.053,y:.024,z:-.06},"Spine2.rotation":{x:.074,y:.013,z:-.068},"Neck.rotation":{x:.03,y:.186,z:-.077},"Head.rotation":{x:.045,y:.243,z:-.086},"LeftShoulder.rotation":{x:1.717,y:-.085,z:-1.761},"LeftArm.rotation":{x:1.314,y:.07,z:-.057},"LeftForeArm.rotation":{x:-.151,y:.714,z:.302},"LeftHand.rotation":{x:-.069,y:.003,z:-.118},"LeftHandThumb1.rotation":{x:.23,y:.258,z:.354},"LeftHandThumb2.rotation":{x:-.107,y:-.338,z:-.455},"LeftHandThumb3.rotation":{x:-.015,y:-.142,z:.002},"LeftHandIndex1.rotation":{x:.145,y:.032,z:-.069},"LeftHandIndex2.rotation":{x:.323,y:-.049,z:-.028},"LeftHandIndex3.rotation":{x:.249,y:-.053,z:-.074},"LeftHandMiddle1.rotation":{x:.235,y:-.057,z:-.088},"LeftHandMiddle2.rotation":{x:.468,y:-.036,z:-.081},"LeftHandMiddle3.rotation":{x:.203,y:-.015,z:-.017},"LeftHandRing1.rotation":{x:.185,y:-.118,z:-.157},"LeftHandRing2.rotation":{x:.578,y:.02,z:-.097},"LeftHandRing3.rotation":{x:.27,y:.021,z:-.063},"LeftHandPinky1.rotation":{x:.404,y:-.182,z:-.138},"LeftHandPinky2.rotation":{x:.612,y:.128,z:-.144},"LeftHandPinky3.rotation":{x:.267,y:.094,z:-.081},"RightShoulder.rotation":{x:1.605,y:.17,z:1.625},"RightArm.rotation":{x:1.574,y:-.655,z:.388},"RightForeArm.rotation":{x:-.36,y:-.849,z:-.465},"RightHand.rotation":{x:.114,y:.416,z:-.069},"RightHandThumb1.rotation":{x:.486,y:.009,z:-.492},"RightHandThumb2.rotation":{x:-.073,y:-.01,z:.284},"RightHandThumb3.rotation":{x:-.054,y:-.006,z:.209},"RightHandIndex1.rotation":{x:.245,y:-.014,z:.052},"RightHandIndex2.rotation":{x:.155,y:0,z:0},"RightHandIndex3.rotation":{x:.153,y:0,z:0},"RightHandMiddle1.rotation":{x:.238,y:.004,z:.028},"RightHandMiddle2.rotation":{x:.15,y:0,z:0},"RightHandMiddle3.rotation":{x:.149,y:0,z:0},"RightHandRing1.rotation":{x:.267,y:.012,z:.007},"RightHandRing2.rotation":{x:.169,y:0,z:0},"RightHandRing3.rotation":{x:.167,y:0,z:0},"RightHandPinky1.rotation":{x:.304,y:.018,z:-.021},"RightHandPinky2.rotation":{x:.192,y:0,z:0},"RightHandPinky3.rotation":{x:.19,y:0,z:0},"LeftUpLeg.rotation":{x:-.001,y:-.058,z:-3.238},"LeftLeg.rotation":{x:-.29,y:.058,z:-.021},"LeftFoot.rotation":{x:1.288,y:.168,z:.183},"LeftToeBase.rotation":{x:.363,y:-.09,z:-.01},"RightUpLeg.rotation":{x:-.1,y:.36,z:3.062},"RightLeg.rotation":{x:-.67,y:-.304,z:.043},"RightFoot.rotation":{x:1.195,y:-.159,z:-.294},"RightToeBase.rotation":{x:.737,y:.164,z:-.002}}},bend:{bend:!0,standing:!0,props:{"Hips.position":{x:-.007,y:.943,z:-.001},"Hips.rotation":{x:1.488,y:-.633,z:1.435},"Spine.rotation":{x:-.126,y:.007,z:-.057},"Spine1.rotation":{x:-.134,y:.009,z:.01},"Spine2.rotation":{x:-.019,y:0,z:-.002},"Neck.rotation":{x:-.159,y:.572,z:-.108},"Head.rotation":{x:-.064,y:.716,z:-.257},"RightShoulder.rotation":{x:1.625,y:-.043,z:1.382},"RightArm.rotation":{x:.746,y:-.96,z:-1.009},"RightForeArm.rotation":{x:-.199,y:-.528,z:-.38},"RightHand.rotation":{x:-.261,y:-.043,z:-.027},"RightHandThumb1.rotation":{x:.172,y:-.138,z:-.445},"RightHandThumb2.rotation":{x:-.158,y:.327,z:.545},"RightHandThumb3.rotation":{x:-.062,y:.138,z:.152},"RightHandIndex1.rotation":{x:.328,y:-.005,z:.132},"RightHandIndex2.rotation":{x:.303,y:.049,z:.028},"RightHandIndex3.rotation":{x:.241,y:.046,z:.077},"RightHandMiddle1.rotation":{x:.309,y:.074,z:.089},"RightHandMiddle2.rotation":{x:.392,y:.036,z:.081},"RightHandMiddle3.rotation":{x:.199,y:.014,z:.019},"RightHandRing1.rotation":{x:.239,y:.143,z:.091},"RightHandRing2.rotation":{x:.275,y:-.02,z:.097},"RightHandRing3.rotation":{x:.248,y:-.023,z:.061},"RightHandPinky1.rotation":{x:.211,y:.154,z:.029},"RightHandPinky2.rotation":{x:.348,y:-.128,z:.144},"RightHandPinky3.rotation":{x:.21,y:-.091,z:.065},"LeftShoulder.rotation":{x:1.626,y:-.027,z:-1.367},"LeftArm.rotation":{x:1.048,y:.737,z:.712},"LeftForeArm.rotation":{x:-.508,y:.879,z:.625},"LeftHand.rotation":{x:.06,y:-.243,z:-.079},"LeftHandThumb1.rotation":{x:.187,y:-.072,z:.346},"LeftHandThumb2.rotation":{x:-.066,y:.008,z:-.256},"LeftHandThumb3.rotation":{x:-.085,y:.014,z:-.334},"LeftHandIndex1.rotation":{x:-.1,y:.016,z:-.058},"LeftHandIndex2.rotation":{x:.334,y:0,z:0},"LeftHandIndex3.rotation":{x:.281,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.056,y:0,z:0},"LeftHandMiddle2.rotation":{x:.258,y:0,z:0},"LeftHandMiddle3.rotation":{x:.26,y:0,z:0},"LeftHandRing1.rotation":{x:-.067,y:-.002,z:.008},"LeftHandRing2.rotation":{x:.259,y:0,z:0},"LeftHandRing3.rotation":{x:.276,y:0,z:0},"LeftHandPinky1.rotation":{x:-.128,y:-.007,z:.042},"LeftHandPinky2.rotation":{x:.227,y:0,z:0},"LeftHandPinky3.rotation":{x:.145,y:0,z:0},"RightUpLeg.rotation":{x:-1.507,y:.2,z:-3.043},"RightLeg.rotation":{x:-.689,y:-.124,z:.017},"RightFoot.rotation":{x:.909,y:.008,z:-.093},"RightToeBase.rotation":{x:.842,y:.075,z:-.008},"LeftUpLeg.rotation":{x:-1.449,y:-.2,z:3.018},"LeftLeg.rotation":{x:-.74,y:-.115,z:-.008},"LeftFoot.rotation":{x:1.048,y:-.058,z:.117},"LeftToeBase.rotation":{x:.807,y:-.067,z:.003}}},back:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.732,y:-1.463,z:-.637},"Spine.rotation":{x:-.171,y:.106,z:.157},"Spine1.rotation":{x:-.044,y:.138,z:-.059},"Spine2.rotation":{x:.082,y:.133,z:-.074},"Neck.rotation":{x:.39,y:.591,z:-.248},"Head.rotation":{x:-.001,y:.596,z:-.057},"LeftShoulder.rotation":{x:1.676,y:.007,z:-1.892},"LeftArm.rotation":{x:-5.566,y:1.188,z:-.173},"LeftForeArm.rotation":{x:-.673,y:-.105,z:1.702},"LeftHand.rotation":{x:-.469,y:-.739,z:.003},"LeftHandThumb1.rotation":{x:.876,y:.274,z:.793},"LeftHandThumb2.rotation":{x:.161,y:-.23,z:-.172},"LeftHandThumb3.rotation":{x:.078,y:.027,z:.156},"LeftHandIndex1.rotation":{x:-.085,y:-.002,z:.009},"LeftHandIndex2.rotation":{x:.176,y:0,z:-.002},"LeftHandIndex3.rotation":{x:-.036,y:.001,z:-.035},"LeftHandMiddle1.rotation":{x:.015,y:.144,z:-.076},"LeftHandMiddle2.rotation":{x:.378,y:-.007,z:-.077},"LeftHandMiddle3.rotation":{x:-.141,y:-.001,z:.031},"LeftHandRing1.rotation":{x:.039,y:.02,z:-.2},"LeftHandRing2.rotation":{x:.25,y:-.002,z:-.073},"LeftHandRing3.rotation":{x:.236,y:.006,z:-.075},"LeftHandPinky1.rotation":{x:.172,y:-.033,z:-.275},"LeftHandPinky2.rotation":{x:.216,y:.043,z:-.054},"LeftHandPinky3.rotation":{x:.325,y:.078,z:-.13},"RightShoulder.rotation":{x:2.015,y:-.168,z:1.706},"RightArm.rotation":{x:.203,y:-1.258,z:-.782},"RightForeArm.rotation":{x:-.658,y:-.133,z:-1.401},"RightHand.rotation":{x:-1.504,y:.375,z:-.005},"RightHandThumb1.rotation":{x:.413,y:-.158,z:-1.121},"RightHandThumb2.rotation":{x:-.142,y:-.008,z:.209},"RightHandThumb3.rotation":{x:-.091,y:.021,z:.142},"RightHandIndex1.rotation":{x:-.167,y:.014,z:-.072},"RightHandIndex2.rotation":{x:.474,y:.009,z:.051},"RightHandIndex3.rotation":{x:.115,y:.006,z:.047},"RightHandMiddle1.rotation":{x:.385,y:.019,z:.144},"RightHandMiddle2.rotation":{x:.559,y:.035,z:.101},"RightHandMiddle3.rotation":{x:.229,y:0,z:.027},"RightHandRing1.rotation":{x:.48,y:.026,z:.23},"RightHandRing2.rotation":{x:.772,y:.038,z:.109},"RightHandRing3.rotation":{x:.622,y:.039,z:.106},"RightHandPinky1.rotation":{x:.767,y:.288,z:.353},"RightHandPinky2.rotation":{x:.886,y:.049,z:.122},"RightHandPinky3.rotation":{x:.662,y:.044,z:.113},"LeftUpLeg.rotation":{x:-.206,y:-.268,z:-3.343},"LeftLeg.rotation":{x:-.333,y:.757,z:-.043},"LeftFoot.rotation":{x:1.049,y:.167,z:.287},"LeftToeBase.rotation":{x:.672,y:-.069,z:-.004},"RightUpLeg.rotation":{x:.055,y:-.226,z:3.037},"RightLeg.rotation":{x:-.559,y:.39,z:-.001},"RightFoot.rotation":{x:1.2,y:.133,z:.085},"RightToeBase.rotation":{x:.92,y:.093,z:-.013}}},straight:{standing:!0,props:{"Hips.position":{x:0,y:.989,z:.001},"Hips.rotation":{x:.047,y:.007,z:-.007},"Spine.rotation":{x:-.143,y:-.007,z:.005},"Spine1.rotation":{x:-.043,y:-.014,z:.012},"Spine2.rotation":{x:.072,y:-.013,z:.013},"Neck.rotation":{x:.048,y:-.003,z:.012},"Head.rotation":{x:.05,y:-.02,z:-.017},"LeftShoulder.rotation":{x:1.62,y:-.166,z:-1.605},"LeftArm.rotation":{x:1.275,y:.544,z:-.092},"LeftForeArm.rotation":{x:0,y:0,z:.302},"LeftHand.rotation":{x:-.225,y:-.154,z:.11},"LeftHandThumb1.rotation":{x:.435,y:-.044,z:.457},"LeftHandThumb2.rotation":{x:-.028,y:.002,z:-.246},"LeftHandThumb3.rotation":{x:-.236,y:-.025,z:.113},"LeftHandIndex1.rotation":{x:.218,y:.008,z:-.081},"LeftHandIndex2.rotation":{x:.165,y:-.001,z:-.017},"LeftHandIndex3.rotation":{x:.165,y:-.001,z:-.017},"LeftHandMiddle1.rotation":{x:.235,y:-.011,z:-.065},"LeftHandMiddle2.rotation":{x:.182,y:-.002,z:-.019},"LeftHandMiddle3.rotation":{x:.182,y:-.002,z:-.019},"LeftHandRing1.rotation":{x:.316,y:-.017,z:.008},"LeftHandRing2.rotation":{x:.253,y:-.003,z:-.026},"LeftHandRing3.rotation":{x:.255,y:-.003,z:-.026},"LeftHandPinky1.rotation":{x:.336,y:-.062,z:.088},"LeftHandPinky2.rotation":{x:.276,y:-.004,z:-.028},"LeftHandPinky3.rotation":{x:.276,y:-.004,z:-.028},"RightShoulder.rotation":{x:1.615,y:.064,z:1.53},"RightArm.rotation":{x:1.313,y:-.424,z:.131},"RightForeArm.rotation":{x:0,y:0,z:-.317},"RightHand.rotation":{x:-.158,y:-.639,z:-.196},"RightHandThumb1.rotation":{x:.44,y:.048,z:-.549},"RightHandThumb2.rotation":{x:-.056,y:-.008,z:.274},"RightHandThumb3.rotation":{x:-.258,y:.031,z:-.095},"RightHandIndex1.rotation":{x:.169,y:-.011,z:.105},"RightHandIndex2.rotation":{x:.134,y:.001,z:.011},"RightHandIndex3.rotation":{x:.134,y:.001,z:.011},"RightHandMiddle1.rotation":{x:.288,y:.014,z:.092},"RightHandMiddle2.rotation":{x:.248,y:.003,z:.02},"RightHandMiddle3.rotation":{x:.249,y:.003,z:.02},"RightHandRing1.rotation":{x:.369,y:.019,z:.006},"RightHandRing2.rotation":{x:.321,y:.004,z:.026},"RightHandRing3.rotation":{x:.323,y:.004,z:.026},"RightHandPinky1.rotation":{x:.468,y:.085,z:-.03},"RightHandPinky2.rotation":{x:.427,y:.007,z:.034},"RightHandPinky3.rotation":{x:.142,y:.001,z:.012},"LeftUpLeg.rotation":{x:-.077,y:-.058,z:3.126},"LeftLeg.rotation":{x:-.252,y:.001,z:-.018},"LeftFoot.rotation":{x:1.315,y:-.064,z:.315},"LeftToeBase.rotation":{x:.577,y:-.07,z:-.009},"RightUpLeg.rotation":{x:-.083,y:-.032,z:3.124},"RightLeg.rotation":{x:-.272,y:-.003,z:.021},"RightFoot.rotation":{x:1.342,y:.076,z:-.222},"RightToeBase.rotation":{x:.44,y:.069,z:.016}}},wide:{standing:!0,props:{"Hips.position":{x:0,y:1.017,z:.016},"Hips.rotation":{x:.064,y:-.048,z:.059},"Spine.rotation":{x:-.123,y:0,z:-.018},"Spine1.rotation":{x:.014,y:.003,z:-.006},"Spine2.rotation":{x:.04,y:.003,z:-.007},"Neck.rotation":{x:.101,y:.007,z:-.035},"Head.rotation":{x:-.091,y:-.049,z:.105},"RightShoulder.rotation":{x:1.831,y:.017,z:1.731},"RightArm.rotation":{x:-1.673,y:-1.102,z:-3.132},"RightForeArm.rotation":{x:.265,y:.23,z:-.824},"RightHand.rotation":{x:-.52,y:.345,z:-.061},"RightHandThumb1.rotation":{x:.291,y:.056,z:-.428},"RightHandThumb2.rotation":{x:.025,y:.005,z:.166},"RightHandThumb3.rotation":{x:-.089,y:.009,z:.068},"RightHandIndex1.rotation":{x:.392,y:-.015,z:.11},"RightHandIndex2.rotation":{x:.391,y:.001,z:.004},"RightHandIndex3.rotation":{x:.326,y:0,z:.003},"RightHandMiddle1.rotation":{x:.285,y:.068,z:.081},"RightHandMiddle2.rotation":{x:.519,y:.004,z:.011},"RightHandMiddle3.rotation":{x:.252,y:0,z:.001},"RightHandRing1.rotation":{x:.207,y:.133,z:.146},"RightHandRing2.rotation":{x:.597,y:.004,z:.004},"RightHandRing3.rotation":{x:.292,y:.002,z:.012},"RightHandPinky1.rotation":{x:.338,y:.182,z:.136},"RightHandPinky2.rotation":{x:.533,y:.002,z:.004},"RightHandPinky3.rotation":{x:.194,y:0,z:.002},"LeftShoulder.rotation":{x:1.83,y:-.063,z:-1.808},"LeftArm.rotation":{x:-1.907,y:1.228,z:-2.959},"LeftForeArm.rotation":{x:-.159,y:.268,z:.572},"LeftHand.rotation":{x:.069,y:-.498,z:-.025},"LeftHandThumb1.rotation":{x:.738,y:.123,z:.178},"LeftHandThumb2.rotation":{x:-.26,y:.028,z:-.477},"LeftHandThumb3.rotation":{x:-.448,y:.093,z:-.661},"LeftHandIndex1.rotation":{x:1.064,y:.005,z:-.13},"LeftHandIndex2.rotation":{x:1.55,y:-.143,z:-.136},"LeftHandIndex3.rotation":{x:.722,y:-.076,z:-.127},"LeftHandMiddle1.rotation":{x:1.095,y:-.091,z:.006},"LeftHandMiddle2.rotation":{x:1.493,y:-.174,z:-.151},"LeftHandMiddle3.rotation":{x:.651,y:-.031,z:-.087},"LeftHandRing1.rotation":{x:1.083,y:-.224,z:.072},"LeftHandRing2.rotation":{x:1.145,y:-.107,z:-.195},"LeftHandRing3.rotation":{x:1.208,y:-.134,z:-.158},"LeftHandPinky1.rotation":{x:.964,y:-.383,z:.128},"LeftHandPinky2.rotation":{x:1.457,y:-.146,z:-.159},"LeftHandPinky3.rotation":{x:1.019,y:-.102,z:-.141},"RightUpLeg.rotation":{x:-.221,y:-.233,z:2.87},"RightLeg.rotation":{x:-.339,y:-.043,z:-.041},"RightFoot.rotation":{x:1.081,y:.177,z:.114},"RightToeBase.rotation":{x:.775,y:0,z:0},"LeftUpLeg.rotation":{x:-.185,y:.184,z:3.131},"LeftLeg.rotation":{x:-.408,y:.129,z:.02},"LeftFoot.rotation":{x:1.167,y:-.002,z:-.007},"LeftToeBase.rotation":{x:.723,y:0,z:0}}},oneknee:{kneeling:!0,props:{"Hips.position":{x:-.005,y:.415,z:-.017},"Hips.rotation":{x:-.25,y:.04,z:-.238},"Spine.rotation":{x:.037,y:.043,z:.047},"Spine1.rotation":{x:.317,y:.103,z:.066},"Spine2.rotation":{x:.433,y:.109,z:.054},"Neck.rotation":{x:-.156,y:-.092,z:.059},"Head.rotation":{x:-.398,y:-.032,z:.018},"RightShoulder.rotation":{x:1.546,y:.119,z:1.528},"RightArm.rotation":{x:.896,y:-.247,z:-.512},"RightForeArm.rotation":{x:.007,y:0,z:-1.622},"RightHand.rotation":{x:1.139,y:-.853,z:.874},"RightHandThumb1.rotation":{x:.176,y:.107,z:-.311},"RightHandThumb2.rotation":{x:-.047,y:-.003,z:.12},"RightHandThumb3.rotation":{x:0,y:0,z:0},"RightHandIndex1.rotation":{x:.186,y:.005,z:.125},"RightHandIndex2.rotation":{x:.454,y:.005,z:.015},"RightHandIndex3.rotation":{x:0,y:0,z:0},"RightHandMiddle1.rotation":{x:.444,y:.035,z:.127},"RightHandMiddle2.rotation":{x:.403,y:-.006,z:-.04},"RightHandMiddle3.rotation":{x:0,y:0,z:0},"RightHandRing1.rotation":{x:.543,y:.074,z:.121},"RightHandRing2.rotation":{x:.48,y:-.018,z:-.063},"RightHandRing3.rotation":{x:0,y:0,z:0},"RightHandPinky1.rotation":{x:.464,y:.086,z:.113},"RightHandPinky2.rotation":{x:.667,y:-.06,z:-.128},"RightHandPinky3.rotation":{x:0,y:0,z:0},"LeftShoulder.rotation":{x:1.545,y:-.116,z:-1.529},"LeftArm.rotation":{x:.799,y:.631,z:.556},"LeftForeArm.rotation":{x:-.002,y:.007,z:.926},"LeftHand.rotation":{x:-.508,y:.439,z:.502},"LeftHandThumb1.rotation":{x:.651,y:-.035,z:.308},"LeftHandThumb2.rotation":{x:-.053,y:.008,z:-.11},"LeftHandThumb3.rotation":{x:0,y:0,z:0},"LeftHandIndex1.rotation":{x:.662,y:-.053,z:-.116},"LeftHandIndex2.rotation":{x:.309,y:-.004,z:-.02},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:.501,y:-.062,z:-.12},"LeftHandMiddle2.rotation":{x:.144,y:-.002,z:.016},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.397,y:-.029,z:-.143},"LeftHandRing2.rotation":{x:.328,y:.01,z:.059},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.194,y:.008,z:-.164},"LeftHandPinky2.rotation":{x:.38,y:.031,z:.128},"LeftHandPinky3.rotation":{x:0,y:0,z:0},"RightUpLeg.rotation":{x:-1.594,y:-.251,z:2.792},"RightLeg.rotation":{x:-2.301,y:-.073,z:.055},"RightFoot.rotation":{x:1.553,y:-.207,z:-.094},"RightToeBase.rotation":{x:.459,y:.069,z:.016},"LeftUpLeg.rotation":{x:-.788,y:-.236,z:-2.881},"LeftLeg.rotation":{x:-2.703,y:.012,z:-.047},"LeftFoot.rotation":{x:2.191,y:-.102,z:.019},"LeftToeBase.rotation":{x:1.215,y:-.027,z:.01}}},kneel:{kneeling:!0,lying:!0,props:{"Hips.position":{x:0,y:.532,z:-.002},"Hips.rotation":{x:.018,y:-.008,z:-.017},"Spine.rotation":{x:-.139,y:-.01,z:.002},"Spine1.rotation":{x:.002,y:-.002,z:.001},"Spine2.rotation":{x:.028,y:-.002,z:.001},"Neck.rotation":{x:-.007,y:0,z:-.002},"Head.rotation":{x:-.02,y:-.008,z:-.004},"LeftShoulder.rotation":{x:1.77,y:-.428,z:-1.588},"LeftArm.rotation":{x:.911,y:.343,z:.083},"LeftForeArm.rotation":{x:0,y:0,z:.347},"LeftHand.rotation":{x:.033,y:-.052,z:-.105},"LeftHandThumb1.rotation":{x:.508,y:-.22,z:.708},"LeftHandThumb2.rotation":{x:-.323,y:-.139,z:-.56},"LeftHandThumb3.rotation":{x:-.328,y:.16,z:-.301},"LeftHandIndex1.rotation":{x:.178,y:.248,z:.045},"LeftHandIndex2.rotation":{x:.236,y:-.002,z:-.019},"LeftHandIndex3.rotation":{x:-.062,y:0,z:.005},"LeftHandMiddle1.rotation":{x:.123,y:-.005,z:-.019},"LeftHandMiddle2.rotation":{x:.589,y:-.014,z:-.045},"LeftHandMiddle3.rotation":{x:.231,y:-.002,z:-.019},"LeftHandRing1.rotation":{x:.196,y:-.008,z:-.091},"LeftHandRing2.rotation":{x:.483,y:-.009,z:-.038},"LeftHandRing3.rotation":{x:.367,y:-.005,z:-.029},"LeftHandPinky1.rotation":{x:.191,y:-.269,z:-.246},"LeftHandPinky2.rotation":{x:.37,y:-.006,z:-.029},"LeftHandPinky3.rotation":{x:.368,y:-.005,z:-.029},"RightShoulder.rotation":{x:1.73,y:.434,z:1.715},"RightArm.rotation":{x:.841,y:-.508,z:-.155},"RightForeArm.rotation":{x:0,y:0,z:-.355},"RightHand.rotation":{x:.091,y:.137,z:.197},"RightHandThumb1.rotation":{x:.33,y:.051,z:-.753},"RightHandThumb2.rotation":{x:-.113,y:.075,z:.612},"RightHandThumb3.rotation":{x:-.271,y:-.166,z:.164},"RightHandIndex1.rotation":{x:.073,y:.001,z:-.093},"RightHandIndex2.rotation":{x:.338,y:.006,z:.034},"RightHandIndex3.rotation":{x:.131,y:.001,z:.013},"RightHandMiddle1.rotation":{x:.13,y:.005,z:-.017},"RightHandMiddle2.rotation":{x:.602,y:.018,z:.058},"RightHandMiddle3.rotation":{x:-.031,y:0,z:-.003},"RightHandRing1.rotation":{x:.351,y:.019,z:.045},"RightHandRing2.rotation":{x:.19,y:.002,z:.019},"RightHandRing3.rotation":{x:.21,y:.002,z:.021},"RightHandPinky1.rotation":{x:.256,y:.17,z:.118},"RightHandPinky2.rotation":{x:.451,y:.01,z:.045},"RightHandPinky3.rotation":{x:.346,y:.006,z:.035},"LeftUpLeg.rotation":{x:-.06,y:.1,z:-2.918},"LeftLeg.rotation":{x:-1.933,y:-.01,z:.011},"LeftFoot.rotation":{x:.774,y:-.162,z:-.144},"LeftToeBase.rotation":{x:1.188,y:0,z:0},"RightUpLeg.rotation":{x:-.099,y:-.057,z:2.922},"RightLeg.rotation":{x:-1.93,y:.172,z:-.02},"RightFoot.rotation":{x:.644,y:.251,z:.212},"RightToeBase.rotation":{x:.638,y:-.034,z:-.001}}},sitting:{sitting:!0,lying:!0,props:{"Hips.position":{x:0,y:.117,z:.005},"Hips.rotation":{x:-.411,y:-.049,z:.056},"Spine.rotation":{x:.45,y:-.039,z:-.116},"Spine1.rotation":{x:.092,y:-.076,z:.08},"Spine2.rotation":{x:.073,y:.035,z:.066},"Neck.rotation":{x:.051,y:.053,z:-.079},"Head.rotation":{x:-.169,y:.009,z:.034},"LeftShoulder.rotation":{x:1.756,y:-.037,z:-1.301},"LeftArm.rotation":{x:-.098,y:.016,z:1.006},"LeftForeArm.rotation":{x:-.089,y:.08,z:.837},"LeftHand.rotation":{x:.262,y:-.399,z:.3},"LeftHandThumb1.rotation":{x:.149,y:-.043,z:.452},"LeftHandThumb2.rotation":{x:.032,y:.006,z:-.162},"LeftHandThumb3.rotation":{x:-.086,y:-.005,z:-.069},"LeftHandIndex1.rotation":{x:.145,y:.032,z:-.069},"LeftHandIndex2.rotation":{x:.325,y:-.001,z:-.004},"LeftHandIndex3.rotation":{x:.253,y:0,z:-.003},"LeftHandMiddle1.rotation":{x:.186,y:-.051,z:-.091},"LeftHandMiddle2.rotation":{x:.42,y:-.003,z:-.011},"LeftHandMiddle3.rotation":{x:.153,y:.001,z:-.001},"LeftHandRing1.rotation":{x:.087,y:-.19,z:-.078},"LeftHandRing2.rotation":{x:.488,y:-.004,z:-.005},"LeftHandRing3.rotation":{x:.183,y:-.001,z:-.012},"LeftHandPinky1.rotation":{x:.205,y:-.262,z:.051},"LeftHandPinky2.rotation":{x:.407,y:-.002,z:-.004},"LeftHandPinky3.rotation":{x:.068,y:0,z:-.002},"RightShoulder.rotation":{x:1.619,y:-.139,z:1.179},"RightArm.rotation":{x:.17,y:-.037,z:-1.07},"RightForeArm.rotation":{x:-.044,y:-.056,z:-.665},"RightHand.rotation":{x:.278,y:.454,z:-.253},"RightHandThumb1.rotation":{x:.173,y:.089,z:-.584},"RightHandThumb2.rotation":{x:-.003,y:-.004,z:.299},"RightHandThumb3.rotation":{x:-.133,y:-.002,z:.235},"RightHandIndex1.rotation":{x:.393,y:-.023,z:.108},"RightHandIndex2.rotation":{x:.391,y:.001,z:.004},"RightHandIndex3.rotation":{x:.326,y:0,z:.003},"RightHandMiddle1.rotation":{x:.285,y:.062,z:.086},"RightHandMiddle2.rotation":{x:.519,y:.003,z:.011},"RightHandMiddle3.rotation":{x:.252,y:-.001,z:.001},"RightHandRing1.rotation":{x:.207,y:.122,z:.155},"RightHandRing2.rotation":{x:.597,y:.004,z:.005},"RightHandRing3.rotation":{x:.292,y:.001,z:.012},"RightHandPinky1.rotation":{x:.338,y:.171,z:.149},"RightHandPinky2.rotation":{x:.533,y:.002,z:.004},"RightHandPinky3.rotation":{x:.194,y:0,z:.002},"LeftUpLeg.rotation":{x:-1.957,y:.083,z:-2.886},"LeftLeg.rotation":{x:-1.46,y:.123,z:.005},"LeftFoot.rotation":{x:-.013,y:.016,z:.09},"LeftToeBase.rotation":{x:.744,y:0,z:0},"RightUpLeg.rotation":{x:-1.994,y:.125,z:2.905},"RightLeg.rotation":{x:-1.5,y:-.202,z:-.006},"RightFoot.rotation":{x:-.012,y:-.065,z:.081},"RightToeBase.rotation":{x:.758,y:0,z:0}}}},this.gestureTemplates={handup:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.815,y:[-.4,0,1,2],z:1.575},"LeftHand.rotation":{x:-.529,y:-.2,z:.022},"LeftHandThumb1.rotation":{x:.745,y:-.526,z:.604},"LeftHandThumb2.rotation":{x:-.107,y:-.01,z:-.142},"LeftHandThumb3.rotation":{x:0,y:.001,z:0},"LeftHandIndex1.rotation":{x:-.126,y:-.035,z:-.087},"LeftHandIndex2.rotation":{x:.255,y:.007,z:-.085},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.019,y:-.128,z:-.082},"LeftHandMiddle2.rotation":{x:.233,y:.019,z:-.074},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.005,y:-.241,z:-.122},"LeftHandRing2.rotation":{x:.261,y:.021,z:-.076},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.059,y:-.336,z:-.2},"LeftHandPinky2.rotation":{x:.153,y:.019,z:.001},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},index:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.815,y:[-.4,0,1,2],z:1.575},"LeftHand.rotation":{x:-.276,y:-.506,z:-.208},"LeftHandThumb1.rotation":{x:.579,y:.228,z:.363},"LeftHandThumb2.rotation":{x:-.027,y:-.04,z:-.662},"LeftHandThumb3.rotation":{x:0,y:.001,z:0},"LeftHandIndex1.rotation":{x:0,y:-.105,z:.225},"LeftHandIndex2.rotation":{x:.256,y:-.103,z:-.213},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:1.453,y:.07,z:.021},"LeftHandMiddle2.rotation":{x:1.599,y:.062,z:.07},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:1.528,y:-.073,z:.052},"LeftHandRing2.rotation":{x:1.386,y:.044,z:.053},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:1.65,y:-.204,z:.031},"LeftHandPinky2.rotation":{x:1.302,y:.071,z:.085},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},ok:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,1],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.415,y:[-.4,0,1,2],z:1.575},"LeftHand.rotation":{x:-.476,y:-.506,z:-.208},"LeftHandThumb1.rotation":{x:.703,y:.445,z:.899},"LeftHandThumb2.rotation":{x:-.312,y:-.04,z:-.938},"LeftHandThumb3.rotation":{x:-.37,y:.024,z:-.393},"LeftHandIndex1.rotation":{x:.8,y:-.086,z:-.091},"LeftHandIndex2.rotation":{x:1.123,y:-.046,z:-.074},"LeftHandIndex3.rotation":{x:.562,y:-.013,z:-.043},"LeftHandMiddle1.rotation":{x:-.019,y:-.128,z:-.082},"LeftHandMiddle2.rotation":{x:.233,y:.019,z:-.074},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.005,y:-.241,z:-.122},"LeftHandRing2.rotation":{x:.261,y:.021,z:-.076},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.059,y:-.336,z:-.2},"LeftHandPinky2.rotation":{x:.153,y:.019,z:.001},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},thumbup:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.415,y:.206,z:1.575},"LeftHand.rotation":{x:-.276,y:-.506,z:-.208},"LeftHandThumb1.rotation":{x:.208,y:-.189,z:.685},"LeftHandThumb2.rotation":{x:.129,y:-.285,z:-.163},"LeftHandThumb3.rotation":{x:-.047,y:.068,z:.401},"LeftHandIndex1.rotation":{x:1.412,y:-.102,z:-.152},"LeftHandIndex2.rotation":{x:1.903,y:-.16,z:-.114},"LeftHandIndex3.rotation":{x:.535,y:-.017,z:-.062},"LeftHandMiddle1.rotation":{x:1.424,y:-.103,z:-.12},"LeftHandMiddle2.rotation":{x:1.919,y:-.162,z:-.114},"LeftHandMiddle3.rotation":{x:.44,y:-.012,z:-.051},"LeftHandRing1.rotation":{x:1.619,y:-.127,z:-.053},"LeftHandRing2.rotation":{x:1.898,y:-.16,z:-.115},"LeftHandRing3.rotation":{x:.262,y:-.004,z:-.031},"LeftHandPinky1.rotation":{x:1.661,y:-.131,z:-.016},"LeftHandPinky2.rotation":{x:1.715,y:-.067,z:-.13},"LeftHandPinky3.rotation":{x:.627,y:-.023,z:-.071}},thumbdown:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-2.015,y:.406,z:1.575},"LeftHand.rotation":{x:-.176,y:-.206,z:-.208},"LeftHandThumb1.rotation":{x:.208,y:-.189,z:.685},"LeftHandThumb2.rotation":{x:.129,y:-.285,z:-.163},"LeftHandThumb3.rotation":{x:-.047,y:.068,z:.401},"LeftHandIndex1.rotation":{x:1.412,y:-.102,z:-.152},"LeftHandIndex2.rotation":{x:1.903,y:-.16,z:-.114},"LeftHandIndex3.rotation":{x:.535,y:-.017,z:-.062},"LeftHandMiddle1.rotation":{x:1.424,y:-.103,z:-.12},"LeftHandMiddle2.rotation":{x:1.919,y:-.162,z:-.114},"LeftHandMiddle3.rotation":{x:.44,y:-.012,z:-.051},"LeftHandRing1.rotation":{x:1.619,y:-.127,z:-.053},"LeftHandRing2.rotation":{x:1.898,y:-.16,z:-.115},"LeftHandRing3.rotation":{x:.262,y:-.004,z:-.031},"LeftHandPinky1.rotation":{x:1.661,y:-.131,z:-.016},"LeftHandPinky2.rotation":{x:1.715,y:-.067,z:-.13},"LeftHandPinky3.rotation":{x:.627,y:-.023,z:-.071}},side:{"LeftShoulder.rotation":{x:1.755,y:-.035,z:-1.63},"LeftArm.rotation":{x:1.263,y:-.955,z:1.024},"LeftForeArm.rotation":{x:0,y:0,z:.8},"LeftHand.rotation":{x:-.36,y:-1.353,z:-.184},"LeftHandThumb1.rotation":{x:.137,y:-.049,z:.863},"LeftHandThumb2.rotation":{x:-.293,y:.153,z:-.193},"LeftHandThumb3.rotation":{x:-.271,y:-.17,z:.18},"LeftHandIndex1.rotation":{x:-.018,y:.007,z:.28},"LeftHandIndex2.rotation":{x:.247,y:-.003,z:-.025},"LeftHandIndex3.rotation":{x:.13,y:-.001,z:-.013},"LeftHandMiddle1.rotation":{x:.333,y:-.015,z:.182},"LeftHandMiddle2.rotation":{x:.313,y:-.005,z:-.032},"LeftHandMiddle3.rotation":{x:.294,y:-.004,z:-.03},"LeftHandRing1.rotation":{x:.456,y:-.028,z:-.092},"LeftHandRing2.rotation":{x:.53,y:-.014,z:-.052},"LeftHandRing3.rotation":{x:.478,y:-.012,z:-.047},"LeftHandPinky1.rotation":{x:.647,y:-.049,z:-.184},"LeftHandPinky2.rotation":{x:.29,y:-.004,z:-.029},"LeftHandPinky3.rotation":{x:.501,y:-.013,z:-.049}},shrug:{"Neck.rotation":{x:[-.3,.3,1,2],y:[-.3,.3,1,2],z:[-.1,.1]},"Head.rotation":{x:[-.3,.3],y:[-.3,.3],z:[-.1,.1]},"RightShoulder.rotation":{x:1.732,y:-.058,z:1.407},"RightArm.rotation":{x:1.305,y:.46,z:.118},"RightForeArm.rotation":{x:[0,2],y:[-1,.2],z:-1.637},"RightHand.rotation":{x:-.048,y:.165,z:-.39},"RightHandThumb1.rotation":{x:1.467,y:.599,z:-1.315},"RightHandThumb2.rotation":{x:-.255,y:-.123,z:.119},"RightHandThumb3.rotation":{x:0,y:-.002,z:0},"RightHandIndex1.rotation":{x:-.293,y:-.066,z:-.112},"RightHandIndex2.rotation":{x:.181,y:.007,z:.069},"RightHandIndex3.rotation":{x:0,y:0,z:0},"RightHandMiddle1.rotation":{x:-.063,y:-.041,z:.032},"RightHandMiddle2.rotation":{x:.149,y:.005,z:.05},"RightHandMiddle3.rotation":{x:0,y:0,z:0},"RightHandRing1.rotation":{x:.152,y:-.03,z:.132},"RightHandRing2.rotation":{x:.194,y:.007,z:.058},"RightHandRing3.rotation":{x:0,y:0,z:0},"RightHandPinky1.rotation":{x:.306,y:-.015,z:.257},"RightHandPinky2.rotation":{x:.15,y:-.003,z:-.003},"RightHandPinky3.rotation":{x:0,y:0,z:0},"LeftShoulder.rotation":{x:1.713,y:.141,z:-1.433},"LeftArm.rotation":{x:1.136,y:-.422,z:-.416},"LeftForeArm.rotation":{x:1.42,y:.123,z:1.506},"LeftHand.rotation":{x:.073,y:-.138,z:.064},"LeftHandThumb1.rotation":{x:1.467,y:-.599,z:1.314},"LeftHandThumb2.rotation":{x:-.255,y:.123,z:-.119},"LeftHandThumb3.rotation":{x:0,y:.001,z:0},"LeftHandIndex1.rotation":{x:-.293,y:.066,z:.112},"LeftHandIndex2.rotation":{x:.181,y:-.007,z:-.069},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.062,y:.041,z:-.032},"LeftHandMiddle2.rotation":{x:.149,y:-.005,z:-.05},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.152,y:.03,z:-.132},"LeftHandRing2.rotation":{x:.194,y:-.007,z:-.058},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.306,y:.015,z:-.257},"LeftHandPinky2.rotation":{x:.15,y:.003,z:.003},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},namaste:{"RightShoulder.rotation":{x:1.758,y:.099,z:1.604},"RightArm.rotation":{x:.862,y:-.292,z:-.932},"RightForeArm.rotation":{x:.083,y:.066,z:-1.791},"RightHand.rotation":{x:-.52,y:-.001,z:-.176},"RightHandThumb1.rotation":{x:.227,y:.418,z:-.776},"RightHandThumb2.rotation":{x:-.011,y:-.003,z:.171},"RightHandThumb3.rotation":{x:-.041,y:-.001,z:-.013},"RightHandIndex1.rotation":{x:-.236,y:.003,z:-.028},"RightHandIndex2.rotation":{x:.004,y:0,z:.001},"RightHandIndex3.rotation":{x:.002,y:0,z:0},"RightHandMiddle1.rotation":{x:-.236,y:.003,z:-.028},"RightHandMiddle2.rotation":{x:.004,y:0,z:.001},"RightHandMiddle3.rotation":{x:.002,y:0,z:0},"RightHandRing1.rotation":{x:-.236,y:.003,z:-.028},"RightHandRing2.rotation":{x:.004,y:0,z:.001},"RightHandRing3.rotation":{x:.002,y:0,z:0},"RightHandPinky1.rotation":{x:-.236,y:.003,z:-.028},"RightHandPinky2.rotation":{x:.004,y:0,z:.001},"RightHandPinky3.rotation":{x:.002,y:0,z:0},"LeftShoulder.rotation":{x:1.711,y:-.002,z:-1.625},"LeftArm.rotation":{x:.683,y:.334,z:.977},"LeftForeArm.rotation":{x:.086,y:-.066,z:1.843},"LeftHand.rotation":{x:-.595,y:-.229,z:.096},"LeftHandThumb1.rotation":{x:.404,y:-.05,z:.537},"LeftHandThumb2.rotation":{x:-.02,y:.004,z:-.154},"LeftHandThumb3.rotation":{x:-.049,y:.002,z:-.019},"LeftHandIndex1.rotation":{x:-.113,y:-.001,z:.014},"LeftHandIndex2.rotation":{x:.003,y:0,z:0},"LeftHandIndex3.rotation":{x:.002,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.113,y:-.001,z:.014},"LeftHandMiddle2.rotation":{x:.004,y:0,z:0},"LeftHandMiddle3.rotation":{x:.002,y:0,z:0},"LeftHandRing1.rotation":{x:-.113,y:-.001,z:.014},"LeftHandRing2.rotation":{x:.003,y:0,z:0},"LeftHandRing3.rotation":{x:.002,y:0,z:0},"LeftHandPinky1.rotation":{x:-.122,y:-.001,z:-.057},"LeftHandPinky2.rotation":{x:.012,y:.001,z:.07},"LeftHandPinky3.rotation":{x:.002,y:0,z:0}}},this.poseDelta={props:{"Hips.quaternion":{x:0,y:0,z:0},"Spine.quaternion":{x:0,y:0,z:0},"Spine1.quaternion":{x:0,y:0,z:0},"Neck.quaternion":{x:0,y:0,z:0},"Head.quaternion":{x:0,y:0,z:0},"Spine1.scale":{x:0,y:0,z:0},"Neck.scale":{x:0,y:0,z:0},"LeftArm.scale":{x:0,y:0,z:0},"RightArm.scale":{x:0,y:0,z:0}}},["Left","Right"].forEach(c=>{["Leg","UpLeg","Arm","ForeArm","Hand"].forEach(l=>{this.poseDelta.props[c+l+".quaternion"]={x:0,y:0,z:0}}),["HandThumb","HandIndex","HandMiddle","HandRing","HandPinky"].forEach(l=>{this.poseDelta.props[c+l+"1.quaternion"]={x:0,y:0,z:0},this.poseDelta.props[c+l+"2.quaternion"]={x:0,y:0,z:0},this.poseDelta.props[c+l+"3.quaternion"]={x:0,y:0,z:0}})});const i=new Set;Object.values(this.poseTemplates).forEach(c=>{Object.keys(this.propsToThreeObjects(c.props)).forEach(l=>i.add(l))}),Object.keys(this.poseDelta.props).forEach(c=>{i.add(c)}),this.posePropNames=[...i],this.poseName="side",this.poseWeightOnLeft=!0,this.gesture=null,this.poseCurrentTemplate=this.poseTemplates[this.poseName],this.poseBase=this.poseFactory(this.poseCurrentTemplate),this.poseTarget=this.poseFactory(this.poseCurrentTemplate),this.poseStraight=this.propsToThreeObjects(this.poseTemplates.straight.props),this.poseAvatar=null,this.avatarHeight=1.7,this.animMoods={neutral:{baseline:{eyesLookDown:.1},speech:{deltaRate:0,deltaPitch:0,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1200,500,1e3],vs:{chestInhale:[.5,.5,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["wide"]}}},{delay:[5e3,2e4],vs:{pose:["straight"]}}]},{name:"head",idle:{delay:[0,1e3],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.3,.3]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[200,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},happy:{baseline:{mouthSmile:.2,eyesLookDown:.1},speech:{deltaRate:0,deltaPitch:.1,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1200,500,1e3],vs:{chestInhale:[.5,.5,0]}},{name:"pose",idle:{alt:[{p:.6,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["side"]}}},{p:.1,delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,1e4],vs:{pose:["wide"]}},{delay:[1e3,3e3],vs:{pose:["turn"]}}]},talking:{alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["wide"]}}}]}},{name:"head",idle:{dt:[[1e3,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.3,.3]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthLeft:[[0,.3,2]],mouthSmile:[[0,.2,3]],mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},angry:{baseline:{eyesLookDown:.1,browDownLeft:.6,browDownRight:.6,jawForward:.3,mouthFrownLeft:.7,mouthFrownRight:.7,mouthRollLower:.2,mouthShrugLower:.3,handFistLeft:1,handFistRight:1},speech:{deltaRate:-.2,deltaPitch:.2,deltaVolume:0},anims:[{name:"breathing",delay:500,dt:[1e3,500,1e3],vs:{chestInhale:[.7,.7,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["straight"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["wide"]}}}]},{name:"head",idle:{delay:[100,500],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.2,.2]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},sad:{baseline:{eyesLookDown:.2,browDownRight:.1,browInnerUp:.6,browOuterUpRight:.2,eyeSquintLeft:.7,eyeSquintRight:.7,mouthFrownLeft:.8,mouthFrownRight:.8,mouthLeft:.2,mouthPucker:.5,mouthRollLower:.2,mouthRollUpper:.2,mouthShrugLower:.2,mouthShrugUpper:.2,mouthStretchLeft:.4},speech:{deltaRate:-.2,deltaPitch:-.2,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1e3,500,1e3],vs:{chestInhale:[.3,.3,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,1e4],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["oneknee"]}}}]},{name:"head",idle:{delay:[100,500],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.2,.2]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},fear:{baseline:{browInnerUp:.7,eyeSquintLeft:.5,eyeSquintRight:.5,eyeWideLeft:.6,eyeWideRight:.6,mouthClose:.1,mouthFunnel:.3,mouthShrugLower:.5,mouthShrugUpper:.5},speech:{deltaRate:-.2,deltaPitch:0,deltaVolume:0},anims:[{name:"breathing",delay:500,dt:[1e3,500,1e3],vs:{chestInhale:[.7,.7,0]}},{name:"pose",alt:[{p:.8,delay:[5e3,2e4],vs:{pose:["side"]}},{delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,1e4],vs:{pose:["wide"]}},{delay:[5e3,1e4],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["oneknee"]}}}]},{name:"head",idle:{delay:[100,500],dt:[[200,3e3]],vs:{headRotateX:[[-.06,.12]],headRotateY:[[-.7,.7]],headRotateZ:[[-.1,.1]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,2e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-1,1]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[2e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},disgust:{baseline:{browDownLeft:.7,browDownRight:.1,browInnerUp:.3,eyeSquintLeft:1,eyeSquintRight:1,eyeWideLeft:.5,eyeWideRight:.5,eyesRotateX:.05,mouthLeft:.4,mouthPressLeft:.3,mouthRollLower:.3,mouthShrugLower:.3,mouthShrugUpper:.8,mouthUpperUpLeft:.3,noseSneerLeft:1,noseSneerRight:.7},speech:{deltaRate:-.2,deltaPitch:0,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1e3,500,1e3],vs:{chestInhale:[.5,.5,0]}},{name:"pose",alt:[{delay:[5e3,1e4],vs:{pose:["side"]}}]},{name:"head",idle:{delay:[100,500],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.2,.2]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[2e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},love:{baseline:{browInnerUp:.4,browOuterUpLeft:.2,browOuterUpRight:.2,mouthSmile:.2,eyeBlinkLeft:.6,eyeBlinkRight:.6,eyeWideLeft:.7,eyeWideRight:.7,headRotateX:.1,mouthDimpleLeft:.1,mouthDimpleRight:.1,mouthPressLeft:.2,mouthShrugUpper:.2,mouthUpperUpLeft:.1,mouthUpperUpRight:.1},speech:{deltaRate:-.1,deltaPitch:-.7,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1500,500,1500],vs:{chestInhale:[.8,.8,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["straight"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["side"]}}},{delay:[5e3,1e4],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["kneel"]}}},{delay:[1e3,3e3],vs:{pose:["turn"]},M:{delay:[1e3,3e3],vs:{pose:["wide"]}}},{delay:[1e3,3e3],vs:{pose:["back"]},M:{delay:[1e3,3e3],vs:{pose:["wide"]}}},{delay:[5e3,2e4],vs:{pose:["side"]},M:{delay:[5e3,2e4],vs:{pose:["side"]}},full:{delay:[5e3,2e4],vs:{pose:["bend"]}}},{delay:[1e3,3e3],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["oneknee"]}}}]},{name:"head",idle:{dt:[[1e3,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.3,.3]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[300,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[2e3,8e3,1,2],dt:[50,[200,300],100],vs:{eyeBlinkLeft:[.6,.6,0],eyeBlinkRight:[.6,.6,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthLeft:[[0,.3,2]],mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[500,1e3],[1e3,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[.3,.6]],browOuterUpLeft:[[.1,.3]],browOuterUpRight:[[.1,.3]]}}]},sleep:{baseline:{eyeBlinkLeft:1,eyeBlinkRight:1,eyesClosed:.6},speech:{deltaRate:0,deltaPitch:-.2,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1e3,500,1e3],vs:{chestInhale:[.6,.6,0]}},{name:"pose",alt:[{delay:[5e3,2e4],vs:{pose:["side"]}}]},{name:"head",delay:[1e3,5e3],dt:[[2e3,1e4]],vs:{headRotateX:[[0,.4]],headRotateY:[[-.1,.1]],headRotateZ:[[-.04,.04]]}},{name:"eyes",delay:10010,dt:[],vs:{}},{name:"blink",delay:10020,dt:[],vs:{}},{name:"mouth",delay:10030,dt:[],vs:{}},{name:"misc",delay:10040,dt:[],vs:{}}]}},this.moodName=this.opt.avatarMood||"neutral",this.mood=this.animMoods[this.moodName],this.mood||(this.moodName="neutral",this.mood=this.animMoods.neutral),this.randomized=["mouthDippleLeft","mouthDippleRight","mouthLeft","mouthPress","mouthStretchLeft","mouthStretchRight","mouthShrugLower","mouthShrugUpper","noseSneerLeft","noseSneerRight","mouthRollLower","mouthRollUpper","browDownLeft","browDownRight","browOuterUpLeft","browOuterUpRight","cheekPuff","cheekSquintLeft","cheekSquintRight"],this.animEmojis={"":{dt:[300,2e3],vs:{pose:["straight"],browInnerUp:[.4],eyeWideLeft:[.7],eyeWideRight:[.7],mouthPressLeft:[.6],mouthPressRight:[.6],mouthRollLower:[.3],mouthStretchLeft:[1],mouthStretchRight:[1]}},"":{link:""},"":{dt:[300,2e3],vs:{browDownRight:[.1],browInnerUp:[.7],browOuterUpRight:[.2],eyeLookInRight:[.7],eyeLookOutLeft:[.7],eyeSquintLeft:[1],eyeSquintRight:[.8],eyesRotateY:[.7],mouthLeft:[.4],mouthPucker:[.4],mouthShrugLower:[.3],mouthShrugUpper:[.2],mouthSmile:[.2],mouthSmileLeft:[.4],mouthSmileRight:[.2],mouthStretchLeft:[.5],mouthUpperUpLeft:[.6],noseSneerLeft:[.7]}},"":{dt:[300,2e3],vs:{mouthSmile:[.5]}},"":{link:""},"":{dt:[300,1e3,1e3],vs:{browInnerUp:[.6],eyeSquintLeft:[1],eyeSquintRight:[1],mouthSmile:[.7],noseSneerLeft:[.7],noseSneerRight:[.7]}},"":{link:""},"":{dt:[300,2e3],vs:{browInnerUp:[.6],jawOpen:[.1],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"":{dt:[300,2e3],vs:{browInnerUp:[.6],eyeWideLeft:[.7],eyeWideRight:[.7],jawOpen:[.1],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],jawOpen:[.2],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],jawOpen:[.3],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthPressLeft:[.5],mouthPressRight:[.5],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.6],jawOpen:[.3],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthPressLeft:[.5],mouthPressRight:[.5],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"":{dt:[300,100,1500,500,500],vs:{browInnerUp:[.8],eyesClosed:[1],jawOpen:[.7],mouthFunnel:[.5],mouthSmile:[1],tongueOut:[0,1,1,0]}},"":{link:""},"":{link:""},"":{link:""},"":{link:""},"":{link:""},"":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.6],jawOpen:[.3],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthPressLeft:[.5],mouthPressRight:[.5],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"":{link:""},"":{link:""},"":{dt:[500,200,500,500],vs:{mouthSmile:[.5],mouthOpen:[.2],mouthSmileLeft:[0,.5,0],eyeBlinkLeft:[0,.7,0],eyeBlinkRight:[0,0,0],headRotateX:[.05,.05,.05,0],headRotateZ:[-.05,-.05,-.05,0],browDownLeft:[0,.7,0],cheekSquintLeft:[0,.7,0],eyeSquintLeft:[0,1,0],eyesClosed:[0]}},"":{dt:[1e3,1e3],vs:{browInnerUp:[1],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.1],jawOpen:[0],mouthFrownLeft:[1],mouthFrownRight:[1],mouthOpen:[.5],mouthPucker:[.5],mouthUpperUpLeft:[.6],mouthUpperUpRight:[.6]}},"":{dt:[1e3,1e3],vs:{browDownLeft:[.2],browDownRight:[.2],browInnerUp:[1],eyeWideLeft:[.9],eyeWideRight:[.9],eyesClosed:[.1],mouthClose:[.2],mouthFrownLeft:[1],mouthFrownRight:[1],mouthPressLeft:[.4],mouthPressRight:[.4],mouthPucker:[1],mouthRollLower:[.6],mouthRollUpper:[.2],mouthUpperUpLeft:[.8],mouthUpperUpRight:[.8]}},"":{dt:[1e3,1e3],vs:{browInnerUp:[.7],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.5],headRotateX:[.3],mouthClose:[.2],mouthFrownLeft:[1],mouthFrownRight:[1],mouthPucker:[1],mouthRollLower:[1],mouthShrugLower:[.2],mouthUpperUpLeft:[.8],mouthUpperUpRight:[.8]}},"":{dt:[1e3,1e3],vs:{browInnerUp:[1],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.5],headRotateX:[.3],mouthClose:[.2],mouthFrownLeft:[1],mouthFrownRight:[1],mouthPressLeft:[.4],mouthPressRight:[.4],mouthPucker:[1],mouthRollLower:[.6],mouthRollUpper:[.2],mouthUpperUpLeft:[.8],mouthUpperUpRight:[.8]}},"":{dt:[1e3,1e3],vs:{browInnerUp:[1],eyeWideLeft:[.5],eyeWideRight:[.5],eyesRotateY:[.05],eyesRotateX:[.05],mouthClose:[.2],mouthFunnel:[.5],mouthPucker:[.4],mouthRollLower:[.4],mouthRollUpper:[.4]}},"":{dt:[500,1500],vs:{mouthFrownLeft:[1],mouthFrownRight:[1],mouthPucker:[.1],mouthRollLower:[.8]}},"":{dt:[500,1e3,1e3],vs:{browInnerUp:[.6],eyeBlinkLeft:[1],eyeBlinkRight:[1],eyeSquintLeft:[1],eyeSquintRight:[1],mouthPucker:[0,.5],noseSneerLeft:[0,.7],noseSneerRight:[0,.7],viseme_U:[0,1]}},"":{dt:[500,500,200,500],vs:{browInnerUp:[.6],eyeBlinkLeft:[0,0,1,0],eyeBlinkRight:[0],eyesRotateY:[0],headRotateY:[0],headRotateX:[0,.05,.05,0],headRotateZ:[0,-.05,-.05,0],eyeSquintLeft:[1],eyeSquintRight:[1],mouthPucker:[0,.5,0],noseSneerLeft:[0,.7],noseSneerRight:[.7],viseme_U:[0,1]}},"":{dt:[1e3,1e3],vs:{browInnerUp:[.6],eyeSquintLeft:[1],eyeSquintRight:[1],mouthSmile:[.7],noseSneerLeft:[.7],noseSneerRight:[.7]}},"":{dt:[1e3,1e3],vs:{browInnerUp:[.6],jawOpen:[.1],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"":{link:""},"":{dt:[1e3,1500],vs:{browDownLeft:[1],browDownRight:[1],eyesLookUp:[.2],jawForward:[.3],mouthFrownLeft:[1],mouthFrownRight:[1],headRotateX:[.15]}},"":{dt:[1e3,1500],vs:{browDownLeft:[1],browDownRight:[1],eyesLookUp:[.2],jawForward:[.3],mouthFrownLeft:[1],mouthFrownRight:[1],headRotateX:[.15]}},"":{link:""},"":{dt:[1e3,1e3],vs:{browDownRight:[.1],browInnerUp:[.7],browOuterUpRight:[.2],eyeLookInRight:[.7],eyeLookOutLeft:[.7],eyeSquintLeft:[1],eyeSquintRight:[.8],eyesRotateY:[.7],mouthFrownLeft:[1],mouthFrownRight:[1],mouthLeft:[.2],mouthPucker:[.5],mouthRollLower:[.2],mouthRollUpper:[.2],mouthShrugLower:[.2],mouthShrugUpper:[.2],mouthStretchLeft:[.5]}},"":{dt:[500,1500],vs:{browInnerUp:[.8],eyeWideLeft:[.5],eyeWideRight:[.5],jawOpen:[.7],mouthFunnel:[.5]}},"":{dt:[500,1500],vs:{browDownLeft:[1],browDownRight:[1],browInnerUp:[1],mouthDimpleLeft:[.5],mouthDimpleRight:[.5],mouthLowerDownLeft:[1],mouthLowerDownRight:[1],mouthPressLeft:[.4],mouthPressRight:[.4],mouthPucker:[.5],mouthSmile:[.1],mouthSmileLeft:[.2],mouthSmileRight:[.2],mouthStretchLeft:[1],mouthStretchRight:[1],mouthUpperUpLeft:[1],mouthUpperUpRight:[1]}},"":{dt:[500,1500],vs:{browInnerUp:[.8],eyeWideLeft:[1],eyeWideRight:[1],eyesRotateX:[-.8],headRotateX:[.15],mouthPucker:[.5],mouthRollLower:[.6],mouthRollUpper:[.5],mouthShrugLower:[0],mouthSmile:[0]}},"":{dt:[500,1500],vs:{browDownLeft:[1],browOuterUpRight:[1],eyeSquintLeft:[.6],mouthFrownLeft:[.7],mouthFrownRight:[.7],mouthLowerDownLeft:[.3],mouthPressRight:[.4],mouthPucker:[.1],mouthRight:[.5],mouthRollLower:[.5],mouthRollUpper:[.2],handRight:[{x:.1,y:.1,z:.1,d:1e3},{d:1e3}],handFistRight:[.1]}},"":{dt:[500,1500],vs:{eyesRotateY:[-.8]}},"":{dt:[5e3,5e3],vs:{eyeBlinkLeft:[1],eyeBlinkRight:[1],headRotateX:[.2],headRotateZ:[.1]}},"":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["handup",2,!0],null]}},"":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["handup",2],null]}},"":{link:""},"":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["thumbup",2],null]}},"":{dt:[300,2e3],vs:{browDownLeft:[1],browDownRight:[1],eyesLookUp:[.2],jawForward:[.3],mouthFrownLeft:[1],mouthFrownRight:[1],headRotateX:[.15],gesture:[["thumbdown",2],null]}},"":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["ok",2],null]}},"":{dt:[1e3,1500],vs:{gesture:[["shrug",2],null]}},"":{link:""},"":{link:""},"":{dt:[1500,300,1e3],vs:{eyeBlinkLeft:[0,1],eyeBlinkRight:[0,1],headRotateX:[0],headRotateZ:[.1],gesture:[["namaste",2],null]}},yes:{dt:[[200,500],[200,500],[200,500],[200,500]],vs:{headRotateX:[[.1,.2],.1,[.1,.2],0],headRotateZ:[[-.2,.2]]}},no:{dt:[[200,500],[200,500],[200,500],[200,500],[200,500]],vs:{headRotateY:[[-.1,-.05],[.05,.1],[-.1,-.05],[.05,.1],0],headRotateZ:[[-.2,.2]]}}},this.animBaseline={},this.animFixed={},this.animQueue=[],this.animClips=[],this.animPoses=[],this.animFrameDur=1e3/this.opt.modelFPS,this.animClock=0,this.animSlowdownRate=1,this.animTimeLast=0,this.easing=this.sigmoidFactory(5),this.lipsync={},this.opt.lipsyncModules.forEach(c=>this.lipsyncGetProcessor(c)),this.visemeNames=["aa","E","I","O","U","PP","SS","TH","DD","FF","kk","nn","RR","CH","sil"],this.audioCtx=new AudioContext,this.audioSpeechSource=this.audioCtx.createBufferSource(),this.audioBackgroundSource=this.audioCtx.createBufferSource(),this.audioBackgroundGainNode=this.audioCtx.createGain(),this.audioSpeechGainNode=this.audioCtx.createGain(),this.audioReverbNode=this.audioCtx.createConvolver(),this.setReverb(null),this.audioBackgroundGainNode.connect(this.audioReverbNode),this.audioSpeechGainNode.connect(this.audioReverbNode),this.audioReverbNode.connect(this.audioCtx.destination),this.audioPlaylist=[];const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";this.b64Lookup=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let c=0;c<r.length;c++)this.b64Lookup[r.charCodeAt(c)]=c;if(this.stateName="idle",this.speechQueue=[],this.isSpeaking=!1,this.opt.ttsEndpoint){let c=new Audio;if(c.canPlayType("audio/ogg"))this.ttsAudioEncoding="OGG-OPUS";else if(c.canPlayType("audio/mp3"))this.ttsAudioEncoding="MP3";else throw new Error("There was no support for either OGG or MP3 audio.")}else throw new Error("You must provide some Google-compliant Text-To-Speech Endpoint.");this.renderer=new Yne({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this.opt.modelPixelRatio*window.devicePixelRatio),this.renderer.setSize(this.nodeAvatar.clientWidth,this.nodeAvatar.clientHeight),this.renderer.outputColorSpace=on,this.renderer.toneMapping=IB,this.renderer.shadowMap.enabled=!1,this.nodeAvatar.appendChild(this.renderer.domElement),this.camera=new lr(10,this.nodeAvatar.clientWidth/this.nodeAvatar.clientHeight,.1,2e3),this.scene=new s5,this.lightAmbient=new m5(new Xe(this.opt.lightAmbientColor),this.opt.lightAmbientIntensity),this.lightDirect=new oA(new Xe(this.opt.lightDirectColor),this.opt.lightDirectIntensity),this.lightSpot=new sA(new Xe(this.opt.lightSpotColor),this.opt.lightSpotIntensity,0,this.opt.lightSpotDispersion),this.setLighting(this.opt);const s=new tb(this.renderer);s.compileEquirectangularShader(),this.scene.environment=s.fromScene(new Ise).texture,this.resizeobserver=new ResizeObserver(this.onResize.bind(this)),this.resizeobserver.observe(this.nodeAvatar),this.controls=new tre(this.camera,this.renderer.domElement),this.controls.enableZoom=this.opt.cameraZoomEnable,this.controls.enableRotate=this.opt.cameraRotateEnable,this.controls.enablePan=this.opt.cameraPanEnable,this.controls.minDistance=2,this.controls.maxDistance=2e3,this.controls.autoRotateSpeed=0,this.controls.autoRotate=!1,this.controls.update(),this.cameraClock=null,this.ikMesh=new eA;const o={LeftShoulder:null,LeftArm:"LeftShoulder",LeftForeArm:"LeftArm",LeftHand:"LeftForeArm",LeftHandMiddle1:"LeftHand",RightShoulder:null,RightArm:"RightShoulder",RightForeArm:"RightArm",RightHand:"RightForeArm",RightHandMiddle1:"RightHand"},a=[];Object.entries(o).forEach((c,l)=>{const u=new Zg;u.name=c[0],c[1]?this.ikMesh.getObjectByName(c[1]).add(u):this.ikMesh.add(u),a.push(u)}),this.ikMesh.bind(new N0(a))}b64ToArrayBuffer(e){let n=3*e.length/4;e[e.length-1]==="="&&(n--,e[e.length-2]==="="&&n--);const i=new ArrayBuffer(n),r=new Uint8Array(i);let s,o=0,a,c,l,u;for(s=0;s<e.length;s+=4)a=this.b64Lookup[e.charCodeAt(s)],c=this.b64Lookup[e.charCodeAt(s+1)],l=this.b64Lookup[e.charCodeAt(s+2)],u=this.b64Lookup[e.charCodeAt(s+3)],r[o++]=a<<2|c>>4,r[o++]=(c&15)<<4|l>>2,r[o++]=(l&3)<<6|u&63;return i}concatArrayBuffers(e){let n=0;for(let o=0;o<e.length;o++)n+=e[o].byteLength;let i=new ArrayBuffer(n),r=new Uint8Array(i),s=0;for(let o=0;o<e.length;o++)r.set(new Uint8Array(e[o]),s),s+=e[o].byteLength;return i}pcmToAudioBuffer(e){const n=new Int16Array(e),i=new Float32Array(n.length);for(let s=0;s<n.length;s++)i[s]=n[s]>=32768?-(65536-n[s])/32768:n[s]/32767;const r=this.audioCtx.createBuffer(1,i.length,this.opt.pcmSampleRate);return r.copyToChannel(i,0,0),r}propsToThreeObjects(e){const n={};for(let[i,r]of Object.entries(e)){const s=i.split(".");let o,a=Array.isArray(r.x)?this.gaussianRandom(...r.x):r.x,c=Array.isArray(r.y)?this.gaussianRandom(...r.y):r.y,l=Array.isArray(r.z)?this.gaussianRandom(...r.z):r.z;s[1]==="position"||s[1]==="scale"?o=new N(a,c,l):s[1]==="rotation"?(i=s[0]+".quaternion",o=new Xt().setFromEuler(new fn(a,c,l,"XYZ")).normalize()):s[1]==="quaternion"&&(o=new Xt(a,c,l,r.w).normalize()),o&&(n[i]=o)}return n}clearThree(e){for(;e.children.length;)this.clearThree(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach(n=>{e.material[n]&&e.material[n]!==null&&typeof e.material[n].dispose=="function"&&e.material[n].dispose()}),e.material.dispose())}async showAvatar(e,n=null){if(!e||!e.hasOwnProperty("url"))throw new Error("Invalid parameter. The avatar must have at least 'url' specified.");let r=await new fre().loadAsync(e.url,n);const s=[this.opt.modelRoot];if(this.posePropNames.forEach(a=>s.push(a.split(".")[0])),s.forEach(a=>{if(!r.scene.getObjectByName(a))throw new Error("Avatar object "+a+" not found")}),this.stop(),this.avatar=e,this.mixer=null,this.armature&&this.clearThree(this.scene),this.armature=r.scene.getObjectByName(this.opt.modelRoot),this.armature.scale.setScalar(1),this.morphs=[],this.armature.traverse(a=>{a.morphTargetInfluences&&a.morphTargetInfluences.length&&a.morphTargetDictionary&&this.morphs.push(a),a.frustumCulled=!1}),this.morphs.length===0)throw new Error("Blend shapes not found");this.poseAvatar={props:{}},this.posePropNames.forEach(a=>{const c=a.split("."),l=this.armature.getObjectByName(c[0]);this.poseAvatar.props[a]=l[c[1]],this.poseBase.props.hasOwnProperty(a)?this.poseAvatar.props[a].copy(this.poseBase.props[a]):this.poseBase.props[a]=this.poseAvatar.props[a].clone(),this.poseDelta.props.hasOwnProperty(a)&&!this.poseTarget.props.hasOwnProperty(a)&&(this.poseTarget.props[a]=this.poseAvatar.props[a].clone()),this.poseTarget.props[a].t=this.animClock,this.poseTarget.props[a].d=2e3}),this.ikMesh.traverse(a=>{a.isBone&&a.position.copy(this.armature.getObjectByName(a.name).position)}),this.scene.add(r.scene),this.scene.add(this.lightAmbient),this.scene.add(this.lightDirect),this.scene.add(this.lightSpot),this.lightSpot.target=this.armature.getObjectByName("Head");const o=new N;this.armature.getObjectByName("LeftEye").getWorldPosition(o),this.avatarHeight=o.y+.2,this.viewName||this.setView(this.opt.cameraView),this.setMood(this.avatar.avatarMood||this.moodName||this.opt.avatarMood),this.start()}getViewNames(){return["full","mid","upper","head"]}getView(){return this.viewName}setView(e,n=null){if(e!=="full"&&e!=="upper"&&e!=="head"&&e!=="mid")return;if(!this.armature){this.opt.cameraView=e;return}this.viewName=e||this.viewName,n=n||{};const i=this.camera.fov*(Math.PI/180);let r=-(n.cameraX||this.opt.cameraX)*Math.tan(i/2),s=(1-(n.cameraY||this.opt.cameraY))*Math.tan(i/2),o=n.cameraDistance||this.opt.cameraDistance;this.viewName==="head"?(o+=2,s=s*o+4*this.avatarHeight/5):this.viewName==="upper"?(o+=4.5,s=s*o+2*this.avatarHeight/3):this.viewName==="mid"?(o+=8,s=s*o+this.avatarHeight/3):(o+=12,s=s*o),r=r*o,this.controlsEnd=new N(r,s,0),this.cameraEnd=new N(r,s,o).applyEuler(new fn(n.cameraRotateX||n.cameraRotateX,n.cameraRotateY||this.opt.cameraRotateY,0)),this.cameraClock===null&&(this.controls.target.copy(this.controlsEnd),this.camera.position.copy(this.cameraEnd)),this.controlsStart=this.controls.target.clone(),this.cameraStart=this.camera.position.clone(),this.cameraClock=0}setLighting(e){e=e||{},e.hasOwnProperty("lightAmbientColor")&&this.lightAmbient.color.set(new Xe(e.lightAmbientColor)),e.hasOwnProperty("lightAmbientIntensity")&&(this.lightAmbient.intensity=e.lightAmbientIntensity,this.lightAmbient.visible=e.lightAmbientIntensity!==0),e.hasOwnProperty("lightDirectColor")&&this.lightDirect.color.set(new Xe(e.lightDirectColor)),e.hasOwnProperty("lightDirectIntensity")&&(this.lightDirect.intensity=e.lightDirectIntensity,this.lightDirect.visible=e.lightDirectIntensity!==0),e.hasOwnProperty("lightDirectPhi")&&e.hasOwnProperty("lightDirectTheta")&&this.lightDirect.position.setFromSphericalCoords(2,e.lightDirectPhi,e.lightDirectTheta),e.hasOwnProperty("lightSpotColor")&&this.lightSpot.color.set(new Xe(e.lightSpotColor)),e.hasOwnProperty("lightSpotIntensity")&&(this.lightSpot.intensity=e.lightSpotIntensity,this.lightSpot.visible=e.lightSpotIntensity!==0),e.hasOwnProperty("lightSpotPhi")&&e.hasOwnProperty("lightSpotTheta")&&(this.lightSpot.position.setFromSphericalCoords(2,e.lightSpotPhi,e.lightSpotTheta),this.lightSpot.position.add(new N(0,1.5,0))),e.hasOwnProperty("lightSpotDispersion")&&(this.lightSpot.angle=e.lightSpotDispersion)}render(){if(this.isRunning){const e=this.getValue("eyeBlinkLeft"),n=this.getValue("eyeBlinkRight"),i=this.getValue("eyesLookDown")/2,r=i+this.getValue("browDownLeft")/2,s=i+this.getValue("browDownRight")/2;this.setValue("eyeBlinkLeft",Math.max(e,r)),this.setValue("eyeBlinkRight",Math.max(n,s)),this.renderer.render(this.scene,this.camera),this.setValue("eyeBlinkLeft",e),this.setValue("eyeBlinkRight",n)}}onResize(){this.camera.aspect=this.nodeAvatar.clientWidth/this.nodeAvatar.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.nodeAvatar.clientWidth,this.nodeAvatar.clientHeight),this.controls.update(),this.renderer.render(this.scene,this.camera)}updatePoseBase(e){for(const[n,i]of Object.entries(this.poseTarget.props)){const r=this.poseAvatar.props[n];if(r){const s=(e-i.t)/i.d;s>1||!this.poseBase.props.hasOwnProperty(n)?r.copy(i):r.isQuaternion?r.copy(this.poseBase.props[n].slerp(i,this.easing(s))):r.isVector3&&r.copy(this.poseBase.props[n].lerp(i,this.easing(s)))}}}updatePoseDelta(){for(const[e,n]of Object.entries(this.poseDelta.props)){const i=new fn(n.x,n.y,n.z),r=this.poseAvatar.props[e];if(r.isQuaternion){const s=new Xt().setFromEuler(i).normalize();r.multiply(s)}else r.isVector3&&r.add(i)}}getPoseString(e,n=1e3){let i="{";return Object.entries(e).forEach((r,s)=>{const o=r[0].split(".");if(o[1]==="position"||o[1]==="rotation"||o[1]==="quaternion"){const a=o[1]==="quaternion"?o[0]+".rotation":r[0],c=r[1].isQuaternion?new fn().setFromQuaternion(r[1]):r[1];i+=(s?", ":"")+"'"+a+"':{",i+="x:"+Math.round(c.x*n)/n,i+=", y:"+Math.round(c.y*n)/n,i+=", z:"+Math.round(c.z*n)/n,i+="}"}}),i+="}",i}getPoseTemplateProp(e){const n=e.split(".");let i=n[0]+"."+(n[1]==="rotation"?"quaternion":n[1]);if(this.gesture&&this.gesture.hasOwnProperty(i))return this.gesture[i].clone();{let r=n[0]+"."+(n[1]==="quaternion"?"rotation":n[1]);this.poseWeightOnLeft||(r.startsWith("Left")?(r="Right"+r.substring(4),i="Right"+i.substring(4)):r.startsWith("Right")&&(r="Left"+r.substring(5),i="Left"+i.substring(5)));let s;if(this.poseTarget.template.props.hasOwnProperty(i)){const o={};o[i]=this.poseTarget.template.props[i],s=this.propsToThreeObjects(o)[i]}else if(this.poseTarget.template.props.hasOwnProperty(r)){const o={};o[r]=this.poseTarget.template.props[r],s=this.propsToThreeObjects(o)[i]}return s&&!this.poseWeightOnLeft&&s.isQuaternion&&(s.x*=-1,s.w*=-1),s}}mirrorPose(e){const n={};for(let[i,r]of Object.entries(e))r.isQuaternion&&(i.startsWith("Left")?i="Right"+i.substring(4):i.startsWith("Right")&&(i="Left"+i.substring(5)),r.x*=-1,r.w*=-1),n[i]=r.clone(),n[i].t=r.t,n[i].d=r.d;return n}poseFactory(e,n=2e3){const i={template:e,props:this.propsToThreeObjects(e.props)};for(const[r,s]of Object.entries(i.props)){if(this.opt.modelMovementFactor<1&&e.standing&&(r==="Hips.quaternion"||r==="Spine.quaternion"||r==="Spine1.quaternion"||r==="Spine2.quaternion"||r==="Neck.quaternion"||r==="LeftUpLeg.quaternion"||r==="LeftLeg.quaternion"||r==="RightUpLeg.quaternion"||r==="RightLeg.quaternion")){const o=this.poseStraight[r],a=s.angleTo(o);s.rotateTowards(o,(1-this.opt.modelMovementFactor)*a)}s.t=this.animClock,s.d=n}return i}setPoseFromTemplate(e,n=2e3){const i=e&&this.poseTarget&&this.poseTarget.template&&(this.poseTarget.template.standing&&e.lying||this.poseTarget.template.lying&&e.standing),r=e&&e===this.poseCurrentTemplate,s=this.poseWeightOnLeft;let o=i?1e3:n;if(i?(this.poseCurrentTemplate=this.poseTemplates.oneknee,setTimeout(()=>{this.setPoseFromTemplate(e,n)},o)):this.poseCurrentTemplate=e||this.poseCurrentTemplate,this.poseTarget=this.poseFactory(this.poseCurrentTemplate,o),this.poseWeightOnLeft=!0,(!r&&!s||r&&s)&&(this.poseTarget.props=this.mirrorPose(this.poseTarget.props),this.poseWeightOnLeft=!this.poseWeightOnLeft),this.gesture)for(let[a,c]of Object.entries(this.gesture))this.poseTarget.props.hasOwnProperty(a)&&(this.poseTarget.props[a].copy(c),this.poseTarget.props[a].t=c.t,this.poseTarget.props[a].d=c.d);Object.keys(this.poseDelta.props).forEach(a=>{this.poseTarget.props.hasOwnProperty(a)||(this.poseTarget.props[a]=this.poseBase.props[a].clone(),this.poseTarget.props[a].t=this.animClock,this.poseTarget.props[a].d=o)})}getValue(e){if(e==="headRotateX")return this.poseDelta.props["Head.quaternion"].x;if(e==="headRotateY")return this.poseDelta.props["Head.quaternion"].y;if(e==="headRotateZ")return this.poseDelta.props["Head.quaternion"].z;if(e.startsWith("handFist")){const n=e.substring(8);return this.poseDelta.props[n+"HandMiddle1.quaternion"].x}else{if(e==="chestInhale")return this.poseDelta.props["Spine1.scale"].x*20;{const n=this.morphs[0].morphTargetDictionary[e];return n!==void 0?this.morphs[0].morphTargetInfluences[n]:0}}}setValue(e,n){if(e==="headRotateX")this.poseDelta.props["Head.quaternion"].x=n,this.poseDelta.props["Spine1.quaternion"].x=n/2,this.poseDelta.props["Spine.quaternion"].x=n/8,this.poseDelta.props["Hips.quaternion"].x=n/24;else if(e==="headRotateY")this.poseDelta.props["Head.quaternion"].y=n,this.poseDelta.props["Spine1.quaternion"].y=n/2,this.poseDelta.props["Spine.quaternion"].y=n/2,this.poseDelta.props["Hips.quaternion"].y=n/4,this.poseDelta.props["LeftUpLeg.quaternion"].y=n/2,this.poseDelta.props["RightUpLeg.quaternion"].y=n/2,this.poseDelta.props["LeftLeg.quaternion"].y=n/4,this.poseDelta.props["RightLeg.quaternion"].y=n/4;else if(e==="headRotateZ")this.poseDelta.props["Head.quaternion"].z=n,this.poseDelta.props["Spine1.quaternion"].z=n/12,this.poseDelta.props["Spine.quaternion"].z=n/12,this.poseDelta.props["Hips.quaternion"].z=n/24;else if(e.startsWith("handFist")){const i=e.substring(8);["HandThumb","HandIndex","HandMiddle","HandRing","HandPinky"].forEach((r,s)=>{s===0?(this.poseDelta.props[i+r+"1.quaternion"].x=0,this.poseDelta.props[i+r+"2.quaternion"].z=(i==="Left"?-1:1)*n,this.poseDelta.props[i+r+"3.quaternion"].z=(i==="Left"?-1:1)*n):(this.poseDelta.props[i+r+"1.quaternion"].x=n,this.poseDelta.props[i+r+"2.quaternion"].x=1.5*n,this.poseDelta.props[i+r+"3.quaternion"].x=1.5*n)})}else if(e==="chestInhale"){const i=n/20,r={x:i,y:i/2,z:3*i},s={x:1/(1+i)-1,y:1/(1+i/2)-1,z:1/(1+3*i)-1};this.poseDelta.props["Spine1.scale"]=r,this.poseDelta.props["Neck.scale"]=s,this.poseDelta.props["LeftArm.scale"]=s,this.poseDelta.props["RightArm.scale"]=s}else this.morphs.forEach(i=>{const r=i.morphTargetDictionary[e];r!==void 0&&(i.morphTargetInfluences[r]=n)})}getMoodNames(){return Object.keys(this.animMoods)}getMood(){return this.opt.avatarMood}setMood(e){if(e=(e||"").trim().toLowerCase(),!this.animMoods.hasOwnProperty(e))throw new Error("Unknown mood.");this.moodName=e,this.mood=this.animMoods[this.moodName];for(let n of["handFistLeft","handFistRight",...Object.keys(this.morphs[0].morphTargetDictionary)])this.setBaselineValue(n,this.mood.baseline.hasOwnProperty(n)?this.mood.baseline[n]:0);this.mood.anims.forEach(n=>{let i=this.animQueue.findIndex(r=>r.template.name===n.name);i!==-1&&this.animQueue.splice(i,1),this.animQueue.push(this.animFactory(n,-1))})}getMorphTargetNames(){return["headRotateX","headRotateY","headRotateZ","eyesRotateX","eyesRotateY","chestInhale","handFistLeft","handFistRight",...Object.keys(this.morphs[0].morphTargetDictionary)].sort()}getBaselineValue(e){if(e==="eyesRotateY"){const n=this.getBaselineValue("eyeLookOutLeft");if(n===void 0)return;const i=this.getBaselineValue("eyeLookInLeft");return i===void 0||this.getBaselineValue("eyeLookOurRight")===void 0||this.getBaselineValue("eyeLookInRight")===void 0?void 0:n-i}else if(e==="eyesRotateX"){const n=this.getBaselineValue("eyesLookDown");if(n===void 0)return;const i=this.getBaselineValue("eyeLookUp");return i===void 0?void 0:n-i}else return this.animBaseline.hasOwnProperty(e)?this.animBaseline[e].target:void 0}setBaselineValue(e,n){e==="eyesRotateY"?(this.setBaselineValue("eyeLookOutLeft",n===null?null:n>0?n:0),this.setBaselineValue("eyeLookInLeft",n===null?null:n>0?0:-n),this.setBaselineValue("eyeLookOutRight",n===null?null:n>0?0:-n),this.setBaselineValue("eyeLookInRight",n===null?null:n>0?n:0)):e==="eyesRotateX"?(this.setBaselineValue("eyesLookDown",n===null?null:n>0?n:0),this.setBaselineValue("eyesLookUp",n===null?null:n>0?0:-n)):e==="eyeLookOutLeft"||e==="eyeLookInLeft"||e==="eyeLookOutRight"||e==="eyeLookInRight"||e==="eyesLookDown"||e==="eyesLookUp"||(n===null?this.animBaseline.hasOwnProperty(e)&&delete this.animBaseline[e]:this.animBaseline[e]={target:n})}getFixedValue(e){if(e==="eyesRotateY"){const n=this.getFixedValue("eyeLookOutLeft");if(n===void 0)return;const i=this.getFixedValue("eyeLookInLeft");return i===void 0||this.getFixedValue("eyeLookOutRight")===void 0||this.getFixedValue("eyeLookInRight")===void 0?void 0:n-i}else if(e==="eyesRotateX"){const n=this.getFixedValue("eyesLookDown");if(n===void 0)return;const i=this.getFixedValue("eyeLookUp");return i===void 0?void 0:n-i}else return this.animFixed.hasOwnProperty(e)?this.animFixed[e].target:void 0}setFixedValue(e,n){e==="eyesRotateY"?(this.setFixedValue("eyeLookOutLeft",n===null?null:n>0?n:0),this.setFixedValue("eyeLookInLeft",n===null?null:n>0?0:-n),this.setFixedValue("eyeLookOutRight",n===null?null:n>0?0:-n),this.setFixedValue("eyeLookInRight",n===null?null:n>0?n:0)):e==="eyesRotateX"?(this.setFixedValue("eyesLookDown",n===null?null:n>0?n:0),this.setFixedValue("eyesLookUp",n===null?null:n>0?0:-n)):n===null?this.animFixed.hasOwnProperty(e)&&delete this.animFixed[e]:this.animFixed[e]={target:n}}animFactory(e,n=!1,i=1,r=1){const s={template:e,ts:[0],vs:{}};let o=e;for(;;)if(o.hasOwnProperty(this.stateName))o=o[this.stateName];else if(o.hasOwnProperty(this.moodName))o=o[this.moodName];else if(o.hasOwnProperty(this.poseName))o=o[this.poseName];else if(o.hasOwnProperty(this.viewName))o=o[this.viewName];else if(this.avatar.body&&o.hasOwnProperty(this.avatar.body))o=o[this.avatar.body];else if(o.hasOwnProperty("alt")){let c=o.alt[0];if(o.alt.length>1){const l=Math.random();let u=0;for(let h=0;h<o.alt.length;h++)if(u+=o.alt[h].p||(1-u)/(o.alt.length-h),l<u){c=o.alt[h];break}}o=c}else break;const a=o.delay?Array.isArray(o.delay)?this.gaussianRandom(...o.delay):o.delay:0;o.hasOwnProperty("dt")&&o.dt.forEach((c,l)=>{s.ts[l+1]=s.ts[l]+(Array.isArray(c)?this.gaussianRandom(...c):c)}),s.ts=s.ts.map(c=>this.animClock+a+c*i);for(let[c,l]of Object.entries(o.vs)){const u=this.getBaselineValue(c),h=l.map(d=>d===null?null:typeof d=="function"?d:typeof d=="string"||d instanceof String?d.slice():Array.isArray(d)?c==="gesture"?d.slice():(u===void 0?0:u)+r*this.gaussianRandom(...d):d instanceof Object&&d.constructor===Object?Object.assign({},d):(u===void 0?0:u)+r*d);c==="eyesRotateY"?(s.vs.eyeLookOutLeft=[null,...h.map(d=>d>0?d:0)],s.vs.eyeLookInLeft=[null,...h.map(d=>d>0?0:-d)],s.vs.eyeLookOutRight=[null,...h.map(d=>d>0?0:-d)],s.vs.eyeLookInRight=[null,...h.map(d=>d>0?d:0)]):c==="eyesRotateX"?(s.vs.eyesLookDown=[null,...h.map(d=>d>0?d:0)],s.vs.eyesLookUp=[null,...h.map(d=>d>0?0:-d)]):s.vs[c]=[null,...h]}for(let c of Object.keys(s.vs))for(;s.vs[c].length-1<s.ts.length;)s.vs[c].push(s.vs[c][s.vs[c].length-1]);return e.hasOwnProperty("mood")&&(s.mood=e.mood.slice()),n&&(s.loop=n),s}valueAnimationSeq(e,n,i,r=null){let s=0,o=e.length-1;if(i<=e[s])return typeof n[s]=="function"?n[s]():n[s];if(i>=e[o])return typeof n[o]=="function"?n[o]():n[o];for(;i>e[s+1];)s++;o=s+1;let a=((typeof n[o]=="function"?n[o]():n[o])-(typeof n[s]=="function"?n[s]():n[s]))/(e[o]-e[s]);r&&(a=r((i-e[s])/(e[o]-e[s]))*a);const c=(typeof n[s]=="function"?n[s]():n[s])-a*e[s];return a*i+c}gaussianRandom(e,n,i=1,r=5){let s=0;for(let o=0;o<r;o++)s+=Math.random();return e+Math.pow(s/r,i)*(n-e)}sigmoidFactory(e){function n(r){return 1/(1+Math.exp(-e*r))-.5}var i=.5/n(1);return function(r){return i*n(2*Math.max(Math.min(r,1),0)-1)+.5}}convertRange(e,n,i){return(e-n[0])*(i[1]-i[0])/(n[1]-n[0])+i[0]}animate(e){if(this.isRunning)requestAnimationFrame(this.animate.bind(this));else return;let n=e-this.animTimeLast;if(n<this.animFrameDur)return;if(n=n/this.animSlowdownRate,this.animClock+=n,this.animTimeLast=e,this.stats&&this.stats.begin(),this.viewName!=="full"){const c=this.randomized[Math.floor(Math.random()*this.randomized.length)],l=this.getValue(c),u=this.getBaselineValue(c);if(l===u){const h=(this.mood.baseline[c]||0)+Math.random()/5;this.setBaselineValue(c,h)}}const i={};for(let[c,l]of Object.entries(this.animBaseline)){const u=this.getValue(c),h=this.isSpeaking&&c.startsWith("mouth")?3:1,d=l.target/h;if(u!==d){l.t0===void 0&&(l.t0=this.animClock,l.v0=u);let p=1e3;i[c]=this.valueAnimationSeq([l.t0,l.t0+p],[l.v0,d],this.animClock,this.easing)}else l.t0=void 0}for(let c=0;c<this.animQueue.length;c++){const l=this.animQueue[c];if(this.animClock>=l.ts[0]){for(let[u,h]of Object.entries(l.vs))if(u==="subtitles")i[u]=i.hasOwnProperty(u)?i[u]+h:""+h,delete l.vs[u];else if(u==="function")h.forEach(d=>{d&&typeof d=="function"&&d()}),delete l.vs[u];else if(u==="speak")i[u]=i.hasOwnProperty(u)?i[u]+" "+h:""+h,delete l.vs[u];else if(u==="pose")i[u]=""+h[1],delete l.vs[u];else if(u==="gesture")for(let d=0;d<l.ts.length;d++)h[d]&&this.animClock>=l.ts[d]&&(i[u]=h[d],h[d]=null);else if(u==="moveto"||u==="handLeft"||u==="handRight")for(let d=0;d<l.ts.length;d++)h[d]&&this.animClock>=l.ts[d]&&(i[u]=Object.assign(i[u]||{},h[d]),h[d]=null);else{h[0]===null&&(h[0]=this.getValue(u)),i[u]=this.valueAnimationSeq(l.ts,h,this.animClock,this.easing),this.animBaseline.hasOwnProperty(u)&&(this.animBaseline[u].t0=void 0);for(let d=0;d<c;d++)this.animQueue[d].vs.hasOwnProperty(u)&&delete this.animQueue[d].vs[u]}if(this.animClock>=l.ts[l.ts.length-1])if(l.hasOwnProperty("mood")&&this.setMood(l.mood),l.loop){let u=this.isSpeaking&&(l.template.name==="head"||l.template.name==="eyes")?4:1;this.animQueue[c]=this.animFactory(l.template,l.loop>0?l.loop-1:l.loop,1,1/u)}else this.animQueue.splice(c--,1)}}for(let[c,l]of Object.entries(this.animFixed)){const u=this.getValue(c);if(u!==l.target){l.t0===void 0&&(l.t0=this.animClock,l.v0=u);let h=1e3;i[c]=this.valueAnimationSeq([l.t0,l.t0+h],[l.v0,l.target],this.animClock,this.easing)}else i.hasOwnProperty(c)&&delete i[c],l.t0=void 0;this.animBaseline.hasOwnProperty(c)&&(this.animBaseline[c].t0=void 0)}for(let[c,l]of Object.entries(i))c==="subtitles"?this.onSubtitles&&typeof this.onSubtitles=="function"&&this.onSubtitles(""+l):c==="speak"?this.speakText(""+l):c==="pose"?(this.poseName=""+l,this.setPoseFromTemplate(this.poseTemplates[this.poseName])):c==="gesture"?this.playGesture(...l):c==="moveto"?Object.entries(l.props).forEach(u=>{u[1]?this.poseTarget.props[u[0]].copy(u[1]):this.poseTarget.props[u[0]].copy(this.getPoseTemplateProp(u[0])),this.poseTarget.props[u[0]].t=this.animClock,this.poseTarget.props[u[0]].d=u[1]&&u[1].d?u[1].d:l.duration||2e3}):c==="handLeft"?this.ikSolve({iterations:20,root:"LeftShoulder",effector:"LeftHandMiddle1",links:[{link:"LeftHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5},{link:"LeftForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-.5,maxz:3},{link:"LeftArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},l.x?new N(l.x,l.y,l.z):null,!0,l.d):c==="handRight"?this.ikSolve({iterations:20,root:"RightShoulder",effector:"RightHandMiddle1",links:[{link:"RightHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5,maxAngle:.1},{link:"RightForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-3,maxz:.5,maxAngle:.2},{link:"RightArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},l.x?new N(l.x,l.y,l.z):null,!0,l.d):this.setValue(c,l);this.updatePoseBase(this.animClock),this.mixer&&this.mixer.update(n/1e3*this.mixer.timeScale),this.updatePoseDelta();const r=new ha;r.setFromObject(this.armature);const s=new N,o=new N;this.armature.getObjectByName("LeftToeBase").getWorldPosition(s),this.armature.getObjectByName("RightToeBase").getWorldPosition(o);const a=this.armature.getObjectByName("Hips");if(a.position.y-=r.min.y/2,a.position.x-=(s.x+o.x)/4,a.position.z-=(s.z+o.z)/2,this.cameraClock!==null&&this.cameraClock<1e3){this.cameraClock+=n,this.cameraClock>1e3&&(this.cameraClock=1e3);let c=new N1().setFromVector3(this.cameraStart),l=new N1().setFromVector3(this.cameraEnd);c.phi+=this.easing(this.cameraClock/1e3)*(l.phi-c.phi),c.theta+=this.easing(this.cameraClock/1e3)*(l.theta-c.theta),c.radius+=this.easing(this.cameraClock/1e3)*(l.radius-c.radius),c.makeSafe(),this.camera.position.setFromSpherical(c),this.controlsStart.x!==this.controlsEnd.x?this.controls.target.copy(this.controlsStart.lerp(this.controlsEnd,this.easing(this.cameraClock/1e3))):(c.setFromVector3(this.controlsStart),l.setFromVector3(this.controlsEnd),c.phi+=this.easing(this.cameraClock/1e3)*(l.phi-c.phi),c.theta+=this.easing(this.cameraClock/1e3)*(l.theta-c.theta),c.radius+=this.easing(this.cameraClock/1e3)*(l.radius-c.radius),c.makeSafe(),this.controls.target.setFromSpherical(c)),this.controls.update()}this.controls.autoRotate&&this.controls.update(),this.stats&&this.stats.end(),this.render()}resetLips(){this.visemeNames.forEach(e=>{this.morphs.forEach(n=>{const i=n.morphTargetDictionary["viseme_"+e];i!==void 0&&(n.morphTargetInfluences[i]=0)})})}lipsyncGetProcessor(e,n="./"){if(!this.lipsync.hasOwnProperty(e)){const i=n+"lipsync-"+e.toLowerCase()+".mjs",r="Lipsync"+e.charAt(0).toUpperCase()+e.slice(1);import(i).then(s=>{this.lipsync[e]=new s[r]})}}lipsyncPreProcessText(e,n){return(this.lipsync[n]||Object.values(this.lipsync)[0]).preProcessText(e)}lipsyncWordsToVisemes(e,n){return(this.lipsync[n]||Object.values(this.lipsync)[0]).wordsToVisemes(e)}speakText(e,n=null,i=null,r=null){n=n||{};const s=/[!\.\?\n\p{Extended_Pictographic}]/ug,o=/[ ]/ug,a=/[\p{L}\p{N},\.'!\$\+\p{Dash_Punctuation}%&\?]/ug,c=/[\p{Extended_Pictographic}]/ug,l=n.lipsyncLang||this.avatar.lipsyncLang||this.opt.lipsyncLang;let u="",h="",d=0,p=[],f=[];const v=[...e];for(let g=0;g<v.length;g++){const m=g===v.length-1,y=v[g].match(a),S=v[g].match(s),x=v[g].match(o);if(i&&(u+=v[g]),y&&(!r||r.every(w=>g<w[0]||g>w[1]))&&(h+=v[g]),(x||S||m)&&(h.length&&(h=this.lipsyncPreProcessText(h,l),h.length&&p.push({mark:d,word:h})),u.length&&(f.push({mark:d,template:{name:"subtitles"},ts:[0],vs:{subtitles:u}}),u=""),h.length)){const w=this.lipsyncWordsToVisemes(h,l);if(w&&w.visemes&&w.visemes.length){const C=w.times[w.visemes.length-1]+w.durations[w.visemes.length-1];for(let E=0;E<w.visemes.length;E++)f.push({mark:d,template:{name:"viseme"},ts:[(w.times[E]-.6)/C,(w.times[E]+.5)/C,(w.times[E]+w.durations[E]+.5)/C],vs:{["viseme_"+w.visemes[E]]:[null,w.visemes[E]==="PP"||w.visemes[E]==="FF"?.9:.6,0]}})}h="",d++}if(S||m){if(p.length||m&&f.length){const w={anim:f};i&&(w.onSubtitles=i),p.length&&!n.avatarMute&&(w.text=p,n.avatarMood&&(w.mood=n.avatarMood),n.ttsLang&&(w.lang=n.ttsLang),n.ttsVoice&&(w.voice=n.ttsVoice),n.ttsRate&&(w.rate=n.ttsRate),n.ttsVoice&&(w.pitch=n.ttsPitch),n.ttsVolume&&(w.volume=n.ttsVolume)),this.speechQueue.push(w),p=[],h="",d=0,f=[]}if(v[g].match(c)){let w=this.animEmojis[v[g]];w&&w.link&&(w=this.animEmojis[w.link]),w&&this.speechQueue.push({emoji:w})}this.speechQueue.push({break:100})}}this.speechQueue.push({break:1e3}),this.startSpeaking()}async speakEmoji(e){let n=this.animEmojis[e];n&&n.link&&(n=this.animEmojis[n.link]),n&&this.speechQueue.push({emoji:n}),this.startSpeaking()}async speakBreak(e){this.speechQueue.push({break:e}),this.startSpeaking()}async speakMarker(e){this.speechQueue.push({marker:e}),this.startSpeaking()}async playBackgroundAudio(e){let i=await(await fetch(e)).arrayBuffer();this.stopBackgroundAudio(),this.audioBackgroundSource=this.audioCtx.createBufferSource(),this.audioBackgroundSource.loop=!0,this.audioBackgroundSource.buffer=await this.audioCtx.decodeAudioData(i),this.audioBackgroundSource.playbackRate.value=1/this.animSlowdownRate,this.audioBackgroundSource.connect(this.audioBackgroundGainNode),this.audioBackgroundSource.start(0)}stopBackgroundAudio(){try{this.audioBackgroundSource.stop()}catch{}this.audioBackgroundSource.disconnect()}async setReverb(e=null){if(e){let i=await(await fetch(e)).arrayBuffer();this.audioReverbNode.buffer=await this.audioCtx.decodeAudioData(i)}else{const n=this.audioCtx.sampleRate,i=this.audioCtx.createBuffer(2,n,n);i.getChannelData(0)[0]=1,i.getChannelData(1)[0]=1,this.audioReverbNode.buffer=i}}setMixerGain(e,n){e!==null&&(this.audioSpeechGainNode.gain.value=e),n!==null&&(this.audioBackgroundGainNode.gain.value=n)}speakAudio(e,n=null,i=null){n=n||{};const r=n.lipsyncLang||this.avatar.lipsyncLang||this.opt.lipsyncLang,s={};if(e.words){let o=[];for(let a=0;a<e.words.length;a++){const c=e.words[a],l=e.wtimes[a];let u=e.wdurations[a];if(c.length&&(i&&o.push({template:{name:"subtitles"},ts:[l],vs:{subtitles:" "+c}}),!e.visemes)){const h=this.lipsyncPreProcessText(c,r),d=this.lipsyncWordsToVisemes(h,r);if(d&&d.visemes&&d.visemes.length){const p=d.times[d.visemes.length-1]+d.durations[d.visemes.length-1],f=Math.min(u,Math.max(0,u-d.visemes.length*150));let v=.6+this.convertRange(f,[0,u],[0,.4]);if(u=Math.min(u,d.visemes.length*200),p>0)for(let g=0;g<d.visemes.length;g++){const m=l+d.times[g]/p*u,y=d.durations[g]/p*u;o.push({template:{name:"viseme"},ts:[m-Math.min(60,2*y/3),m+Math.min(25,y/2),m+y+Math.min(60,y/2)],vs:{["viseme_"+d.visemes[g]]:[null,d.visemes[g]==="PP"||d.visemes[g]==="FF"?.9:v,0]}})}}}}if(e.visemes)for(let a=0;a<e.visemes.length;a++){const c=e.visemes[a],l=e.vtimes[a],u=e.vdurations[a];o.push({template:{name:"viseme"},ts:[l-2*u/3,l+u/2,l+u+u/2],vs:{["viseme_"+c]:[null,c==="PP"||c==="FF"?.9:.6,0]}})}if(e.markers)for(let a=0;a<e.markers.length;a++){const c=e.markers[a],l=e.mtimes[a];o.push({template:{name:"markers"},ts:[l],vs:{function:[c]}})}o.length&&(s.anim=o)}e.audio&&(s.audio=e.audio),i&&(s.onSubtitles=i),Object.keys(s).length&&(this.speechQueue.push(s),this.speechQueue.push({break:300}),this.startSpeaking())}async playAudio(e=!1){if(!(!this.armature||this.isAudioPlaying&&!e))if(this.isAudioPlaying=!0,this.audioPlaylist.length){const n=this.audioPlaylist.shift();if(this.audioCtx.state==="suspended"){const s=this.audioCtx.resume(),o=new Promise((a,c)=>setTimeout(()=>c("p2"),1e3));try{await Promise.race([s,o])}catch{console.log("Can't play audio. Web Audio API suspended. This is often due to calling some speak method before the first user action, which is typically prevented by the browser."),this.playAudio(!0);return}}let i;if(Array.isArray(n.audio)){let s=this.concatArrayBuffers(n.audio);i=this.pcmToAudioBuffer(s)}else i=n.audio;this.audioSpeechSource=this.audioCtx.createBufferSource(),this.audioSpeechSource.buffer=i,this.audioSpeechSource.playbackRate.value=1/this.animSlowdownRate,this.audioSpeechSource.connect(this.audioSpeechGainNode),this.audioSpeechSource.addEventListener("ended",()=>{this.audioSpeechSource.disconnect(),this.playAudio(!0)},{once:!0});const r=100;n.anim&&n.anim.forEach(s=>{for(let o=0;o<s.ts.length;o++)s.ts[o]=this.animClock+s.ts[o]+r;this.animQueue.push(s)}),this.audioSpeechSource.start(r/1e3)}else this.isAudioPlaying=!1,this.startSpeaking(!0)}async startSpeaking(e=!1){if(!(!this.armature||this.isSpeaking&&!e))if(this.stateName="talking",this.isSpeaking=!0,this.speechQueue.length){let n=this.speechQueue.shift();if(n.emoji){this.lookAtCamera(500);let i=n.emoji.dt.reduce((r,s)=>r+s,0);this.animQueue.push(this.animFactory(n.emoji)),setTimeout(this.startSpeaking.bind(this),i,!0)}else if(n.break)setTimeout(this.startSpeaking.bind(this),n.break,!0);else if(n.audio)this.lookAtCamera(500),this.speakWithHands(),this.audioPlaylist.push({anim:n.anim,audio:n.audio}),this.onSubtitles=n.onSubtitles||null,this.resetLips(),n.mood&&this.setMood(n.mood),this.playAudio();else if(n.text){this.lookAtCamera(500);try{let i="<speak>";n.text.forEach((a,c)=>{c>0&&(i+=" <mark name='"+a.mark+"'/>"),i+=a.word.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&apos;").replace(new RegExp("^\\p{Dash_Punctuation}$","ug"),'<break time="750ms"/>')}),i+="</speak>";const r={method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({input:{ssml:i},voice:{languageCode:n.lang||this.avatar.ttsLang||this.opt.ttsLang,name:n.voice||this.avatar.ttsVoice||this.opt.ttsVoice},audioConfig:{audioEncoding:this.ttsAudioEncoding,speakingRate:(n.rate||this.avatar.ttsRate||this.opt.ttsRate)+this.mood.speech.deltaRate,pitch:(n.pitch||this.avatar.ttsPitch||this.opt.ttsPitch)+this.mood.speech.deltaPitch,volumeGainDb:(n.volume||this.avatar.ttsVolume||this.opt.ttsVolume)+this.mood.speech.deltaVolume},enableTimePointing:[1]})};this.opt.jwtGet&&typeof this.opt.jwtGet=="function"&&(r.headers.Authorization="Bearer "+await this.opt.jwtGet());const s=await fetch(this.opt.ttsEndpoint+(this.opt.ttsApikey?"?key="+this.opt.ttsApikey:""),r),o=await s.json();if(s.status===200&&o&&o.audioContent){const a=this.b64ToArrayBuffer(o.audioContent),c=await this.audioCtx.decodeAudioData(a);this.speakWithHands();const l=[0];let u=0;n.text.forEach((p,f)=>{if(f>0){let v=l[l.length-1];o.timepoints[u]&&(v=o.timepoints[u].timeSeconds*1e3,o.timepoints[u].markName===""+p.mark&&u++),l.push(v)}});const h=[{mark:0,time:0}];l.forEach((p,f)=>{if(f>0){let v=p-l[f-1];v>150&&v-150,h[f-1].duration=v,h.push({mark:f,time:p})}});let d=1e3*c.duration;d>this.opt.ttsTrimEnd&&(d=d-this.opt.ttsTrimEnd),h[h.length-1].duration=d-h[h.length-1].time,n.anim.forEach(p=>{const f=h[p.mark];if(f)for(let v=0;v<p.ts.length;v++)p.ts[v]=f.time+p.ts[v]*f.duration+this.opt.ttsTrimStart}),this.audioPlaylist.push({anim:n.anim,audio:c}),this.onSubtitles=n.onSubtitles||null,this.resetLips(),n.mood&&this.setMood(n.mood),this.playAudio()}else this.startSpeaking(!0)}catch(i){console.error("Error:",i),this.startSpeaking(!0)}}else n.anim?(this.onSubtitles=n.onSubtitles||null,this.resetLips(),n.mood&&this.setMood(n.mood),n.anim.forEach((i,r)=>{for(let s=0;s<i.ts.length;s++)i.ts[s]=this.animClock+10*r;this.animQueue.push(i)}),setTimeout(this.startSpeaking.bind(this),10*n.anim.length,!0)):n.marker?(typeof n.marker=="function"&&n.marker(),this.startSpeaking(!0)):this.startSpeaking(!0)}else this.stateName="idle",this.isSpeaking=!1}pauseSpeaking(){try{this.audioSpeechSource.stop()}catch{}this.audioPlaylist.length=0,this.stateName="idle",this.isSpeaking=!1,this.isAudioPlaying=!1,this.animQueue=this.animQueue.filter(e=>e.template.name!=="viseme"),this.armature&&(this.resetLips(),this.render())}stopSpeaking(){try{this.audioSpeechSource.stop()}catch{}this.audioPlaylist.length=0,this.speechQueue.length=0,this.animQueue=this.animQueue.filter(e=>e.template.name!=="viseme"),this.stateName="idle",this.isSpeaking=!1,this.isAudioPlaying=!1,this.armature&&(this.resetLips(),this.render())}lookAtCamera(e){this.lookAt(null,null,e)}lookAt(e,n,i){const r=this.nodeAvatar.getBoundingClientRect(),s=this.armature.getObjectByName("LeftEye"),o=this.armature.getObjectByName("RightEye");s.updateMatrixWorld(!0),o.updateMatrixWorld(!0);const a=new N().setFromMatrixPosition(s.matrixWorld),c=new N().setFromMatrixPosition(o.matrixWorld),l=new N().addVectors(a,c).divideScalar(2);l.project(this.camera);let u=(l.x+1)/2*r.width+r.left,h=-(l.y-1)/2*r.height+r.top;e===null&&(e=u),n===null&&(n=h);let d=this.poseTarget.props["Hips.quaternion"].clone();d.multiply(this.poseTarget.props["Spine.quaternion"]),d.multiply(this.poseTarget.props["Spine1.quaternion"]),d.multiply(this.poseTarget.props["Spine2.quaternion"]),d.multiply(this.poseTarget.props["Neck.quaternion"]),d.multiply(this.poseTarget.props["Head.quaternion"]);let p=new fn().setFromQuaternion(d),f=p.x/(40/24),v=p.y/(9/4),g=Math.min(.4,Math.max(-.4,this.camera.rotation.x)),m=Math.min(.4,Math.max(-.4,this.camera.rotation.y)),y=Math.max(window.innerWidth-u,u),S=Math.max(window.innerHeight-h,h),x=this.convertRange(n,[h-S,h+S],[-.3,.6])-f+g,w=this.convertRange(e,[u-y,u+y],[-.8,.8])-v+m;x=Math.min(.6,Math.max(-.3,x)),w=Math.min(.8,Math.max(-.8,w));let C=(Math.random()-.5)/4,E=(Math.random()-.5)/4;if(i){let b=this.animQueue.findIndex(_=>_.template.name==="lookat");b!==-1&&this.animQueue.splice(b,1);const M={name:"lookat",dt:[750,i],vs:{headRotateX:[x+C],headRotateY:[w+E],eyesRotateX:[-3*C+.1],eyesRotateY:[-5*E],browInnerUp:[[0,.7]],mouthLeft:[[0,.7]],mouthRight:[[0,.7]]}};this.animQueue.push(this.animFactory(M))}}touchAt(e,n){const i=this.nodeAvatar.getBoundingClientRect(),r=new gt((e-i.left)/i.width*2-1,-((n-i.top)/i.height)*2+1),s=new Qie;s.setFromCamera(r,this.camera);const o=s.intersectObject(this.armature);if(o.length>0){const a=o[0].point,c=new N,l=new N;this.armature.getObjectByName("LeftArm").getWorldPosition(c),this.armature.getObjectByName("RightArm").getWorldPosition(l);const u=c.distanceToSquared(a),h=l.distanceToSquared(a);u<h?(this.ikSolve({iterations:20,root:"LeftShoulder",effector:"LeftHandMiddle1",links:[{link:"LeftHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5,maxAngle:.1},{link:"LeftForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-.5,maxz:3,maxAngle:.2},{link:"LeftArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},a,!1,1e3),this.setValue("handFistLeft",0)):(this.ikSolve({iterations:20,root:"RightShoulder",effector:"RightHandMiddle1",links:[{link:"RightHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5,maxAngle:.1},{link:"RightForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-3,maxz:.5,maxAngle:.2},{link:"RightArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},a,!1,1e3),this.setValue("handFistRight",0))}else["LeftArm","LeftForeArm","LeftHand","RightArm","RightForeArm","RightHand"].forEach(a=>{let c=a+".quaternion";this.poseTarget.props[c].copy(this.getPoseTemplateProp(c)),this.poseTarget.props[c].t=this.animClock,this.poseTarget.props[c].d=1e3});return o.length>0}speakWithHands(e=0,n=.5){if(this.mixer||this.gesture||!this.poseTarget.template.standing||this.poseTarget.template.bend||Math.random()>n)return;this.ikSolve({root:"LeftShoulder",effector:"LeftHandMiddle1",links:[{link:"LeftHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5},{link:"LeftForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-.5,maxz:3},{link:"LeftArm",minx:-1.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-1,maxz:3}]},new N(this.gaussianRandom(0,.5),this.gaussianRandom(-.8,-.2),this.gaussianRandom(0,.5)),!0),this.ikSolve({root:"RightShoulder",effector:"RightHandMiddle1",links:[{link:"RightHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5},{link:"RightForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-3,maxz:.5},{link:"RightArm"}]},new N(this.gaussianRandom(-.5,0),this.gaussianRandom(-.8,-.2),this.gaussianRandom(0,.5)),!0);const i=[],r=[];i.push(100+Math.round(Math.random()*500)),r.push({duration:1e3,props:{"LeftHand.quaternion":new Xt().setFromEuler(new fn(0,-1-Math.random(),0)),"RightHand.quaternion":new Xt().setFromEuler(new fn(0,1+Math.random(),0))}}),["LeftArm","LeftForeArm","RightArm","RightForeArm"].forEach(o=>{r[0].props[o+".quaternion"]=this.ikMesh.getObjectByName(o).quaternion.clone()}),i.push(1e3+Math.round(Math.random()*500)),r.push({duration:2e3,props:{}}),["LeftArm","LeftForeArm","RightArm","RightForeArm","LeftHand","RightHand"].forEach(o=>{r[1].props[o+".quaternion"]=null});const s=this.animFactory({name:"talkinghands",delay:e,dt:i,vs:{moveto:r}});this.animQueue.push(s)}getSlowdownRate(e){return this.animSlowdownRate}setSlowdownRate(e){this.animSlowdownRate=e,this.audioSpeechSource.playbackRate.value=1/this.animSlowdownRate,this.audioBackgroundSource.playbackRate.value=1/this.animSlowdownRate}getAutoRotateSpeed(e){return this.controls.autoRotateSpeed}setAutoRotateSpeed(e){this.controls.autoRotateSpeed=e,this.controls.autoRotate=e>0}start(){this.armature&&this.isRunning===!1&&(this.audioCtx.resume(),this.animTimeLast=performance.now(),this.isRunning=!0,requestAnimationFrame(this.animate.bind(this)))}stop(){this.isRunning=!1,this.audioCtx.suspend()}async playAnimation(e,n=null,i=10,r=0,s=.01){if(!this.armature)return;let o=this.animClips.find(a=>a.url===e+"-"+r);if(o){let a=this.animQueue.find(u=>u.template.name==="pose");a&&(a.ts[0]=1/0),Object.entries(o.pose.props).forEach(u=>{this.poseBase.props[u[0]]=u[1].clone(),this.poseTarget.props[u[0]]=u[1].clone(),this.poseTarget.props[u[0]].t=0,this.poseTarget.props[u[0]].d=1e3}),this.mixer=new Jie(this.armature),this.mixer.addEventListener("finished",this.stopAnimation.bind(this),{once:!0});const c=Math.ceil(i/o.clip.duration),l=this.mixer.clipAction(o.clip);l.setLoop(HB,c),l.clampWhenFinished=!0,l.fadeIn(.5).play()}else{let c=await new mD().loadAsync(e,n);if(c&&c.animations&&c.animations[r]){let l=c.animations[r];const u={};l.tracks.forEach(d=>{d.name=d.name.replaceAll("mixamorig","");const p=d.name.split(".");if(p[1]==="position"){for(let f=0;f<d.values.length;f++)d.values[f]=d.values[f]*s;u[d.name]=new N(d.values[0],d.values[1],d.values[2])}else p[1]==="quaternion"?u[d.name]=new Xt(d.values[0],d.values[1],d.values[2],d.values[3]):p[1]==="rotation"&&(u[p[0]+".quaternion"]=new Xt().setFromEuler(new fn(d.values[0],d.values[1],d.values[2],"XYZ")).normalize())});const h={props:u};u["Hips.position"]&&(u["Hips.position"].y<.5?h.lying=!0:h.standing=!0),this.animClips.push({url:e+"-"+r,clip:l,pose:h}),this.playAnimation(e,n,i,r,s)}else{const l="Animation "+e+" (ndx="+r+") not found";console.error(l)}}}stopAnimation(){if(this.mixer=null,this.gesture)for(let[n,i]of Object.entries(this.gesture))i.t=this.animClock,i.d=1e3,this.poseTarget.props.hasOwnProperty(n)&&(this.poseTarget.props[n].copy(i),this.poseTarget.props[n].t=this.animClock,this.poseTarget.props[n].d=1e3);let e=this.animQueue.find(n=>n.template.name==="pose");e&&(e.ts[0]=this.animClock),this.setPoseFromTemplate(null)}async playPose(e,n=null,i=5,r=0,s=.01){if(!this.armature)return;let o=this.poseTemplates[e];if(!o){const a=this.animPoses.find(c=>c.url===e+"-"+r);a&&(o=a.pose)}if(o){this.poseName=e,this.mixer=null;let a=this.animQueue.find(c=>c.template.name==="pose");a&&(a.ts[0]=this.animClock+i*1e3+2e3),this.setPoseFromTemplate(o)}else{let c=await new mD().loadAsync(e,n);if(c&&c.animations&&c.animations[r]){let l=c.animations[r];const u={};l.tracks.forEach(d=>{d.name=d.name.replaceAll("mixamorig","");const p=d.name.split(".");p[1]==="position"?u[d.name]=new N(d.values[0]*s,d.values[1]*s,d.values[2]*s):p[1]==="quaternion"?u[d.name]=new Xt(d.values[0],d.values[1],d.values[2],d.values[3]):p[1]==="rotation"&&(u[p[0]+".quaternion"]=new Xt().setFromEuler(new fn(d.values[0],d.values[1],d.values[2],"XYZ")).normalize())});const h={props:u};u["Hips.position"]&&(u["Hips.position"].y<.5?h.lying=!0:h.standing=!0),this.animPoses.push({url:e+"-"+r,pose:h}),this.playPose(e,n,i,r,s)}else{const l="Pose "+e+" (ndx="+r+") not found";console.error(l)}}}stopPose(){this.stopAnimation()}playGesture(e,n=3,i=!1,r=1e3){if(!this.armature)return;let s=this.gestureTemplates[e];if(s){this.gestureTimeout&&(clearTimeout(this.gestureTimeout),this.gestureTimeout=null);let a=this.animQueue.findIndex(c=>c.template.name==="talkinghands");a!==-1&&(this.animQueue[a].ts=this.animQueue[a].ts.map(c=>0)),this.gesture=this.propsToThreeObjects(s),i&&(this.gesture=this.mirrorPose(this.gesture)),e==="namaste"&&this.avatar.body==="M"&&(this.gesture["RightArm.quaternion"].rotateTowards(new Xt(0,1,0,0),-.25),this.gesture["LeftArm.quaternion"].rotateTowards(new Xt(0,1,0,0),-.25));for(let[c,l]of Object.entries(this.gesture))l.t=this.animClock,l.d=r,this.poseTarget.props.hasOwnProperty(c)&&(this.poseTarget.props[c].copy(l),this.poseTarget.props[c].t=this.animClock,this.poseTarget.props[c].d=r);n&&Number.isFinite(n)&&(this.gestureTimeout=setTimeout(this.stopGesture.bind(this,r),1e3*n))}let o=this.animEmojis[e];if(o&&(o&&o.link&&(o=this.animEmojis[o.link]),o)){this.lookAtCamera(500);const a=this.animFactory(o);if(a.gesture=!0,n&&Number.isFinite(n)){const c=a.ts[0],l=a.ts[a.ts.length-1],u=1e3*n/(l-c);a.ts=a.ts.map(h=>c+u*(h-c))}this.animQueue.push(a)}}stopGesture(e=1e3){if(this.gestureTimeout&&(clearTimeout(this.gestureTimeout),this.gestureTimeout=null),this.gesture){const i=Object.entries(this.gesture);this.gesture=null;for(const[r,s]of i)this.poseTarget.props.hasOwnProperty(r)&&(this.poseTarget.props[r].copy(this.getPoseTemplateProp(r)),this.poseTarget.props[r].t=this.animClock,this.poseTarget.props[r].d=e)}let n=this.animQueue.findIndex(i=>i.gesture);n!==-1&&this.animQueue.splice(n,1)}ikSolve(e,n=null,i=!1,r=null){const s=new Xt,o=new N,a=new N,c=new N,l=new N,u=new Xt,h=new N,d=new N,p=new N,f=this.ikMesh.getObjectByName(e.root);f.position.setFromMatrixPosition(this.armature.getObjectByName(e.root).matrixWorld),f.quaternion.setFromRotationMatrix(this.armature.getObjectByName(e.root).matrixWorld),n&&i&&n.add(f.position);const v=this.ikMesh.getObjectByName(e.effector),g=e.links;g.forEach(y=>{y.bone=this.ikMesh.getObjectByName(y.link),y.bone.quaternion.copy(this.getPoseTemplateProp(y.link+".quaternion"))}),f.updateMatrixWorld(!0);const m=e.iterations||10;if(n)for(let y=0;y<m;y++){let S=!1;for(let x=0,w=g.length;x<w;x++){const C=g[x].bone;C.matrixWorld.decompose(l,u,h),u.invert(),a.setFromMatrixPosition(v.matrixWorld),c.subVectors(a,l),c.applyQuaternion(u),c.normalize(),o.subVectors(n,l),o.applyQuaternion(u),o.normalize();let E=o.dot(c);E>1?E=1:E<-1&&(E=-1),E=Math.acos(E),!(E<1e-5)&&(g[x].minAngle!==void 0&&E<g[x].minAngle&&(E=g[x].minAngle),g[x].maxAngle!==void 0&&E>g[x].maxAngle&&(E=g[x].maxAngle),d.crossVectors(c,o),d.normalize(),s.setFromAxisAngle(d,E),C.quaternion.multiply(s),C.rotation.setFromVector3(p.setFromEuler(C.rotation).clamp(new N(g[x].minx!==void 0?g[x].minx:-1/0,g[x].miny!==void 0?g[x].miny:-1/0,g[x].minz!==void 0?g[x].minz:-1/0),new N(g[x].maxx!==void 0?g[x].maxx:1/0,g[x].maxy!==void 0?g[x].maxy:1/0,g[x].maxz!==void 0?g[x].maxz:1/0))),C.updateMatrixWorld(!0),S=!0)}if(!S)break}r&&g.forEach(y=>{this.poseTarget.props[y.link+".quaternion"].copy(y.bone.quaternion),this.poseTarget.props[y.link+".quaternion"].t=this.animClock,this.poseTarget.props[y.link+".quaternion"].d=r})}}const kse="0f4404a5f9f56",Lse=re.forwardRef((t,e)=>{const n=re.useRef(null),i=re.useRef(null),r=re.useRef(null),s=re.useRef(null),o=re.useRef([]);re.useEffect(()=>!n.current||!i.current||r.current?void 0:(r.current=new Mse(n.current,{ttsEndpoint:"https://eu-texttospeech.googleapis.com/v1beta1/text:synthesize",lipsyncModules:[],cameraView:"full",avatarMood:"neutral",statsNode:n.current,statsStyle:"position: absolute; bottom: 0px; left: 0px; cursor: pointer; opacity: 0.9; z-index: 10000;"}),(async h=>{try{h.textContent="Loading...",await r.current.showAvatar({url:"https://models.readyplayer.me/670a24c892f67441779a5bad.glb?morphTargets=ARKit,Oculus+Visemes,mouthOpen,mouthSmile,eyesClosed,eyesLookUp,eyesLookDown&textureSizeLimit=1024&textureFormat=png",body:"F",avatarMood:"neutral"},d=>{if(d.lengthComputable){let p=Math.min(100,Math.round(d.loaded/d.total*100));h.textContent="Loading "+p+"%"}}),h.style.display="none"}catch(d){console.error("Error loading avatar:",d),d instanceof Error?h.textContent=d.message:h.textContent="An unknown error occurred"}})(i.current),()=>{n.current}),[]);const a=u=>u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");async function c(u,h=null,d=null){if(!r.current)return;const p=o.current;if(u===null)p.push(null);else{const g="<speak version='1.0' xmlns:mstts='http://www.w3.org/2001/mstts' xml:lang='"+"zh-CN"+"'><voice name='"+"zh-CN-XiaoyuMultilingualNeural"+"'><mstts:viseme type='redlips_front'/>"+a(u)+"</voice></speak>";p.push({ssml:g,node:h,onprocessed:d,speak:{audio:[],words:[],wtimes:[],wdurations:[],visemes:[],vtimes:[],vdurations:[]}})}p.length===1&&l()}async function l(){const u=o.current;let h=s.current;if(u.length){const d=u[0];if(d===null)u.shift(),u.length===0&&h&&(h.close(),s.current=null);else{if(!h){const p=`https://api.zzcreation.com/web/ws?x-api-key=${kse}`,f=Qm.SpeechConfig.fromEndpoint(new URL(p));f.setProperty("SpeechServiceConnection_Endpoint",p),f.speechSynthesisOutputFormat=Qm.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm,h=new Qm.SpeechSynthesizer(f);const v=["sil","aa","aa","O","E","E","I","U","O","aa","O","I","kk","RR","nn","SS","SS","TH","FF","DD","kk","PP"];h.visemeReceived=function(g,m){if(u[0]&&u[0].speak){const y=u[0].speak,S=v[m.visemeId],x=m.audioOffset/1e4;y.vdurations.length&&(y.visemes[y.visemes.length-1]===0?(y.visemes.pop(),y.vtimes.pop(),y.vdurations.pop()):y.vdurations[y.vdurations.length-1]=x-y.vtimes[y.vdurations.length-1]),y.visemes.push(S),y.vtimes.push(x),y.vdurations.push(75)}},h.wordBoundary=function(g,m){if(u[0]&&u[0].speak){const y=u[0].speak,S=m.text,x=m.audioOffset/1e4,w=m.duration/1e4;m.boundaryType==="PunctuationBoundary"&&y.words.length?y.words[y.words.length-1]+=S:(m.boundaryType==="WordBoundary"||m.boundaryType==="PunctuationBoundary")&&(y.words.push(S),y.wtimes.push(x),y.wdurations.push(w))}}}h.speakSsmlAsync(d.ssml,function(p){if(u[0]&&u[0].speak){if(p.reason===Qm.ResultReason.SynthesizingAudioCompleted){const f=u[0];f.speak.audio.push(p.audioData),r.current.speakAudio(f.speak,{},null),f.onprocessed&&f.onprocessed()}u.shift(),l()}},function(p){d.onprocessed&&d.onprocessed(),console.log(p),u.shift(),l()})}}}return re.useImperativeHandle(e,()=>({speak:async u=>{u&&await c(u,null)}})),ce.jsxs(ce.Fragment,{children:[ce.jsx("div",{ref:n,style:{display:"block",width:"100%",height:"100%",position:"relative"}}),ce.jsx("div",{ref:i})]})});function Dse(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const Nse=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Ose=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Fse={};function yD(t,e){return(Fse.jsx?Ose:Nse).test(t)}const zse=/[ \t\n\f\r]/g;function Use(t){return typeof t=="object"?t.type==="text"?SD(t.value):!1:SD(t)}function SD(t){return t.replace(zse,"")===""}class z0{constructor(e,n,i){this.property=e,this.normal=n,i&&(this.space=i)}}z0.prototype.property={};z0.prototype.normal={};z0.prototype.space=null;function P5(t,e){const n={},i={};let r=-1;for(;++r<t.length;)Object.assign(n,t[r].property),Object.assign(i,t[r].normal);return new z0(n,i,e)}function hb(t){return t.toLowerCase()}class Zs{constructor(e,n){this.property=e,this.attribute=n}}Zs.prototype.space=null;Zs.prototype.boolean=!1;Zs.prototype.booleanish=!1;Zs.prototype.overloadedBoolean=!1;Zs.prototype.number=!1;Zs.prototype.commaSeparated=!1;Zs.prototype.spaceSeparated=!1;Zs.prototype.commaOrSpaceSeparated=!1;Zs.prototype.mustUseProperty=!1;Zs.prototype.defined=!1;let Bse=0;const bt=Ku(),ai=Ku(),I5=Ku(),xe=Ku(),xn=Ku(),fd=Ku(),ls=Ku();function Ku(){return 2**++Bse}const db=Object.freeze(Object.defineProperty({__proto__:null,boolean:bt,booleanish:ai,commaOrSpaceSeparated:ls,commaSeparated:fd,number:xe,overloadedBoolean:I5,spaceSeparated:xn},Symbol.toStringTag,{value:"Module"})),Nw=Object.keys(db);class uA extends Zs{constructor(e,n,i,r){let s=-1;if(super(e,n),xD(this,"space",r),typeof i=="number")for(;++s<Nw.length;){const o=Nw[s];xD(this,Nw[s],(i&db[o])===db[o])}}}uA.prototype.defined=!0;function xD(t,e,n){n&&(t[e]=n)}const $se={}.hasOwnProperty;function pp(t){const e={},n={};let i;for(i in t.properties)if($se.call(t.properties,i)){const r=t.properties[i],s=new uA(i,t.transform(t.attributes||{},i),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,n[hb(i)]=i,n[hb(s.attribute)]=i}return new z0(e,n,t.space)}const M5=pp({space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),k5=pp({space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function L5(t,e){return e in t?t[e]:e}function D5(t,e){return L5(t,e.toLowerCase())}const N5=pp({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:D5,properties:{xmlns:null,xmlnsXLink:null}}),O5=pp({transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:ai,ariaAutoComplete:null,ariaBusy:ai,ariaChecked:ai,ariaColCount:xe,ariaColIndex:xe,ariaColSpan:xe,ariaControls:xn,ariaCurrent:null,ariaDescribedBy:xn,ariaDetails:null,ariaDisabled:ai,ariaDropEffect:xn,ariaErrorMessage:null,ariaExpanded:ai,ariaFlowTo:xn,ariaGrabbed:ai,ariaHasPopup:null,ariaHidden:ai,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:xn,ariaLevel:xe,ariaLive:null,ariaModal:ai,ariaMultiLine:ai,ariaMultiSelectable:ai,ariaOrientation:null,ariaOwns:xn,ariaPlaceholder:null,ariaPosInSet:xe,ariaPressed:ai,ariaReadOnly:ai,ariaRelevant:null,ariaRequired:ai,ariaRoleDescription:xn,ariaRowCount:xe,ariaRowIndex:xe,ariaRowSpan:xe,ariaSelected:ai,ariaSetSize:xe,ariaSort:null,ariaValueMax:xe,ariaValueMin:xe,ariaValueNow:xe,ariaValueText:null,role:null}}),Hse=pp({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:D5,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:fd,acceptCharset:xn,accessKey:xn,action:null,allow:null,allowFullScreen:bt,allowPaymentRequest:bt,allowUserMedia:bt,alt:null,as:null,async:bt,autoCapitalize:null,autoComplete:xn,autoFocus:bt,autoPlay:bt,blocking:xn,capture:null,charSet:null,checked:bt,cite:null,className:xn,cols:xe,colSpan:null,content:null,contentEditable:ai,controls:bt,controlsList:xn,coords:xe|fd,crossOrigin:null,data:null,dateTime:null,decoding:null,default:bt,defer:bt,dir:null,dirName:null,disabled:bt,download:I5,draggable:ai,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:bt,formTarget:null,headers:xn,height:xe,hidden:bt,high:xe,href:null,hrefLang:null,htmlFor:xn,httpEquiv:xn,id:null,imageSizes:null,imageSrcSet:null,inert:bt,inputMode:null,integrity:null,is:null,isMap:bt,itemId:null,itemProp:xn,itemRef:xn,itemScope:bt,itemType:xn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:bt,low:xe,manifest:null,max:null,maxLength:xe,media:null,method:null,min:null,minLength:xe,multiple:bt,muted:bt,name:null,nonce:null,noModule:bt,noValidate:bt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:bt,optimum:xe,pattern:null,ping:xn,placeholder:null,playsInline:bt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:bt,referrerPolicy:null,rel:xn,required:bt,reversed:bt,rows:xe,rowSpan:xe,sandbox:xn,scope:null,scoped:bt,seamless:bt,selected:bt,shadowRootClonable:bt,shadowRootDelegatesFocus:bt,shadowRootMode:null,shape:null,size:xe,sizes:null,slot:null,span:xe,spellCheck:ai,src:null,srcDoc:null,srcLang:null,srcSet:null,start:xe,step:null,style:null,tabIndex:xe,target:null,title:null,translate:null,type:null,typeMustMatch:bt,useMap:null,value:ai,width:xe,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:xn,axis:null,background:null,bgColor:null,border:xe,borderColor:null,bottomMargin:xe,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:bt,declare:bt,event:null,face:null,frame:null,frameBorder:null,hSpace:xe,leftMargin:xe,link:null,longDesc:null,lowSrc:null,marginHeight:xe,marginWidth:xe,noResize:bt,noHref:bt,noShade:bt,noWrap:bt,object:null,profile:null,prompt:null,rev:null,rightMargin:xe,rules:null,scheme:null,scrolling:ai,standby:null,summary:null,text:null,topMargin:xe,valueType:null,version:null,vAlign:null,vLink:null,vSpace:xe,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:bt,disableRemotePlayback:bt,prefix:null,property:null,results:xe,security:null,unselectable:null}}),Vse=pp({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:L5,properties:{about:ls,accentHeight:xe,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:xe,amplitude:xe,arabicForm:null,ascent:xe,attributeName:null,attributeType:null,azimuth:xe,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:xe,by:null,calcMode:null,capHeight:xe,className:xn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:xe,diffuseConstant:xe,direction:null,display:null,dur:null,divisor:xe,dominantBaseline:null,download:bt,dx:null,dy:null,edgeMode:null,editable:null,elevation:xe,enableBackground:null,end:null,event:null,exponent:xe,externalResourcesRequired:null,fill:null,fillOpacity:xe,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:fd,g2:fd,glyphName:fd,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:xe,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:xe,horizOriginX:xe,horizOriginY:xe,id:null,ideographic:xe,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:xe,k:xe,k1:xe,k2:xe,k3:xe,k4:xe,kernelMatrix:ls,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:xe,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:xe,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:xe,overlineThickness:xe,paintOrder:null,panose1:null,path:null,pathLength:xe,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:xn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:xe,pointsAtY:xe,pointsAtZ:xe,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:ls,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:ls,rev:ls,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:ls,requiredFeatures:ls,requiredFonts:ls,requiredFormats:ls,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:xe,specularExponent:xe,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:xe,strikethroughThickness:xe,string:null,stroke:null,strokeDashArray:ls,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:xe,strokeOpacity:xe,strokeWidth:null,style:null,surfaceScale:xe,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:ls,tabIndex:xe,tableValues:null,target:null,targetX:xe,targetY:xe,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:ls,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:xe,underlineThickness:xe,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:xe,values:null,vAlphabetic:xe,vMathematical:xe,vectorEffect:null,vHanging:xe,vIdeographic:xe,version:null,vertAdvY:xe,vertOriginX:xe,vertOriginY:xe,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:xe,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),jse=/^data[-\w.:]+$/i,CD=/-[a-z]/g,Wse=/[A-Z]/g;function Gse(t,e){const n=hb(e);let i=e,r=Zs;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&jse.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(CD,Xse);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!CD.test(s)){let o=s.replace(Wse,qse);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}r=uA}return new r(i,e)}function qse(t){return"-"+t.toLowerCase()}function Xse(t){return t.charAt(1).toUpperCase()}const Kse={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},Yse=P5([k5,M5,N5,O5,Hse],"html"),hA=P5([k5,M5,N5,O5,Vse],"svg");function Jse(t){return t.join(" ").trim()}var F5={},_D=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,Qse=/\n/g,Zse=/^\s*/,eoe=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,toe=/^:\s*/,noe=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,ioe=/^[;\s]*/,roe=/^\s+|\s+$/g,soe=`
`,wD="/",ED="*",iu="",ooe="comment",aoe="declaration",coe=function(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,i=1;function r(f){var v=f.match(Qse);v&&(n+=v.length);var g=f.lastIndexOf(soe);i=~g?f.length-g:i+f.length}function s(){var f={line:n,column:i};return function(v){return v.position=new o(f),l(),v}}function o(f){this.start=f,this.end={line:n,column:i},this.source=e.source}o.prototype.content=t;function a(f){var v=new Error(e.source+":"+n+":"+i+": "+f);if(v.reason=f,v.filename=e.source,v.line=n,v.column=i,v.source=t,!e.silent)throw v}function c(f){var v=f.exec(t);if(v){var g=v[0];return r(g),t=t.slice(g.length),v}}function l(){c(Zse)}function u(f){var v;for(f=f||[];v=h();)v!==!1&&f.push(v);return f}function h(){var f=s();if(!(wD!=t.charAt(0)||ED!=t.charAt(1))){for(var v=2;iu!=t.charAt(v)&&(ED!=t.charAt(v)||wD!=t.charAt(v+1));)++v;if(v+=2,iu===t.charAt(v-1))return a("End of comment missing");var g=t.slice(2,v-2);return i+=2,r(g),t=t.slice(v),i+=2,f({type:ooe,comment:g})}}function d(){var f=s(),v=c(eoe);if(v){if(h(),!c(toe))return a("property missing ':'");var g=c(noe),m=f({type:aoe,property:RD(v[0].replace(_D,iu)),value:g?RD(g[0].replace(_D,iu)):iu});return c(ioe),m}}function p(){var f=[];u(f);for(var v;v=d();)v!==!1&&(f.push(v),u(f));return f}return l(),p()};function RD(t){return t?t.replace(roe,iu):iu}var loe=It&&It.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(F5,"__esModule",{value:!0});var bD=F5.default=hoe,uoe=loe(coe);function hoe(t,e){var n=null;if(!t||typeof t!="string")return n;var i=(0,uoe.default)(t),r=typeof e=="function";return i.forEach(function(s){if(s.type==="declaration"){var o=s.property,a=s.value;r?e(o,a,s):a&&(n=n||{},n[o]=a)}}),n}const doe=bD.default||bD,z5=U5("end"),dA=U5("start");function U5(t){return e;function e(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function poe(t){const e=dA(t),n=z5(t);if(e&&n)return{start:e,end:n}}function wg(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?TD(t.position):"start"in t||"end"in t?TD(t):"line"in t||"column"in t?pb(t):""}function pb(t){return AD(t&&t.line)+":"+AD(t&&t.column)}function TD(t){return pb(t&&t.start)+"-"+pb(t&&t.end)}function AD(t){return t&&typeof t=="number"?t:1}class gr extends Error{constructor(e,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let r="",s={},o=!1;if(n&&("line"in n&&"column"in n?s={place:n}:"start"in n&&"end"in n?s={place:n}:"type"in n?s={ancestors:[n],place:n.position}:s={...n}),typeof e=="string"?r=e:!s.cause&&e&&(o=!0,r=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof i=="string"){const c=i.indexOf(":");c===-1?s.ruleId=i:(s.source=i.slice(0,c),s.ruleId=i.slice(c+1))}if(!s.place&&s.ancestors&&s.ancestors){const c=s.ancestors[s.ancestors.length-1];c&&(s.place=c.position)}const a=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file,this.message=r,this.line=a?a.line:void 0,this.name=wg(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=o&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual,this.expected,this.note,this.url}}gr.prototype.file="";gr.prototype.name="";gr.prototype.reason="";gr.prototype.message="";gr.prototype.stack="";gr.prototype.column=void 0;gr.prototype.line=void 0;gr.prototype.ancestors=void 0;gr.prototype.cause=void 0;gr.prototype.fatal=void 0;gr.prototype.place=void 0;gr.prototype.ruleId=void 0;gr.prototype.source=void 0;const pA={}.hasOwnProperty,foe=new Map,moe=/[A-Z]/g,goe=/-([a-z])/g,voe=new Set(["table","tbody","thead","tfoot","tr"]),yoe=new Set(["td","th"]),B5="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function Soe(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let i;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=Toe(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");i=boe(n,e.jsx,e.jsxs)}const r={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:i,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?hA:Yse,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},s=$5(r,t,void 0);return s&&typeof s!="string"?s:r.create(t,r.Fragment,{children:s||void 0},void 0)}function $5(t,e,n){if(e.type==="element")return xoe(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return Coe(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return woe(t,e,n);if(e.type==="mdxjsEsm")return _oe(t,e);if(e.type==="root")return Eoe(t,e,n);if(e.type==="text")return Roe(t,e)}function xoe(t,e,n){const i=t.schema;let r=i;e.tagName.toLowerCase()==="svg"&&i.space==="html"&&(r=hA,t.schema=r),t.ancestors.push(e);const s=V5(t,e.tagName,!1),o=Aoe(t,e);let a=mA(t,e);return voe.has(e.tagName)&&(a=a.filter(function(c){return typeof c=="string"?!Use(c):!0})),H5(t,o,s,e),fA(o,a),t.ancestors.pop(),t.schema=i,t.create(e,s,o,n)}function Coe(t,e){if(e.data&&e.data.estree&&t.evaluater){const i=e.data.estree.body[0];return i.type,t.evaluater.evaluateExpression(i.expression)}s0(t,e.position)}function _oe(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);s0(t,e.position)}function woe(t,e,n){const i=t.schema;let r=i;e.name==="svg"&&i.space==="html"&&(r=hA,t.schema=r),t.ancestors.push(e);const s=e.name===null?t.Fragment:V5(t,e.name,!0),o=Poe(t,e),a=mA(t,e);return H5(t,o,s,e),fA(o,a),t.ancestors.pop(),t.schema=i,t.create(e,s,o,n)}function Eoe(t,e,n){const i={};return fA(i,mA(t,e)),t.create(e,t.Fragment,i,n)}function Roe(t,e){return e.value}function H5(t,e,n,i){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=i)}function fA(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function boe(t,e,n){return i;function i(r,s,o,a){const l=Array.isArray(o.children)?n:e;return a?l(s,o,a):l(s,o)}}function Toe(t,e){return n;function n(i,r,s,o){const a=Array.isArray(s.children),c=dA(i);return e(r,s,o,a,{columnNumber:c?c.column-1:void 0,fileName:t,lineNumber:c?c.line:void 0},void 0)}}function Aoe(t,e){const n={};let i,r;for(r in e.properties)if(r!=="children"&&pA.call(e.properties,r)){const s=Ioe(t,r,e.properties[r]);if(s){const[o,a]=s;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&yoe.has(e.tagName)?i=a:n[o]=a}}if(i){const s=n.style||(n.style={});s[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}return n}function Poe(t,e){const n={};for(const i of e.attributes)if(i.type==="mdxJsxExpressionAttribute")if(i.data&&i.data.estree&&t.evaluater){const s=i.data.estree.body[0];s.type;const o=s.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else s0(t,e.position);else{const r=i.name;let s;if(i.value&&typeof i.value=="object")if(i.value.data&&i.value.data.estree&&t.evaluater){const a=i.value.data.estree.body[0];a.type,s=t.evaluater.evaluateExpression(a.expression)}else s0(t,e.position);else s=i.value===null?!0:i.value;n[r]=s}return n}function mA(t,e){const n=[];let i=-1;const r=t.passKeys?new Map:foe;for(;++i<e.children.length;){const s=e.children[i];let o;if(t.passKeys){const c=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(c){const l=r.get(c)||0;o=c+"-"+l,r.set(c,l+1)}}const a=$5(t,s,o);a!==void 0&&n.push(a)}return n}function Ioe(t,e,n){const i=Gse(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?Dse(n):Jse(n)),i.property==="style"){let r=typeof n=="object"?n:Moe(t,String(n));return t.stylePropertyNameCase==="css"&&(r=koe(r)),["style",r]}return[t.elementAttributeNameCase==="react"&&i.space?Kse[i.property]||i.property:i.attribute,n]}}function Moe(t,e){const n={};try{doe(e,i)}catch(r){if(!t.ignoreInvalidStyle){const s=r,o=new gr("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:s,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw o.file=t.filePath||void 0,o.url=B5+"#cannot-parse-style-attribute",o}}return n;function i(r,s){let o=r;o.slice(0,2)!=="--"&&(o.slice(0,4)==="-ms-"&&(o="ms-"+o.slice(4)),o=o.replace(goe,Doe)),n[o]=s}}function V5(t,e,n){let i;if(!n)i={type:"Literal",value:e};else if(e.includes(".")){const r=e.split(".");let s=-1,o;for(;++s<r.length;){const a=yD(r[s])?{type:"Identifier",name:r[s]}:{type:"Literal",value:r[s]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(s&&a.type==="Literal"),optional:!1}:a}i=o}else i=yD(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(i.type==="Literal"){const r=i.value;return pA.call(t.components,r)?t.components[r]:r}if(t.evaluater)return t.evaluater.evaluateExpression(i);s0(t)}function s0(t,e){const n=new gr("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=B5+"#cannot-handle-mdx-estrees-without-createevaluater",n}function koe(t){const e={};let n;for(n in t)pA.call(t,n)&&(e[Loe(n)]=t[n]);return e}function Loe(t){let e=t.replace(moe,Noe);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function Doe(t,e){return e.toUpperCase()}function Noe(t){return"-"+t.toLowerCase()}const Ow={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Ooe={};function Foe(t,e){const n=Ooe,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,r=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return j5(t,i,r)}function j5(t,e,n){if(zoe(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return PD(t.children,e,n)}return Array.isArray(t)?PD(t,e,n):""}function PD(t,e,n){const i=[];let r=-1;for(;++r<t.length;)i[r]=j5(t[r],e,n);return i.join("")}function zoe(t){return!!(t&&typeof t=="object")}const ID=document.createElement("i");function gA(t){const e="&"+t+";";ID.innerHTML=e;const n=ID.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Qa(t,e,n,i){const r=t.length;let s=0,o;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);s<i.length;)o=i.slice(s,s+1e4),o.unshift(e,0),t.splice(...o),s+=1e4,e+=1e4}function Os(t,e){return t.length>0?(Qa(t,t.length,0,e),t):e}const MD={}.hasOwnProperty;function Uoe(t){const e={};let n=-1;for(;++n<t.length;)Boe(e,t[n]);return e}function Boe(t,e){let n;for(n in e){const r=(MD.call(t,n)?t[n]:void 0)||(t[n]={}),s=e[n];let o;if(s)for(o in s){MD.call(r,o)||(r[o]=[]);const a=s[o];$oe(r[o],Array.isArray(a)?a:a?[a]:[])}}}function $oe(t,e){let n=-1;const i=[];for(;++n<e.length;)(e[n].add==="after"?t:i).push(e[n]);Qa(t,0,0,i)}function W5(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function md(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ea=_l(/[A-Za-z]/),fs=_l(/[\dA-Za-z]/),Hoe=_l(/[#-'*+\--9=?A-Z^-~]/);function fb(t){return t!==null&&(t<32||t===127)}const mb=_l(/\d/),Voe=_l(/[\dA-Fa-f]/),joe=_l(/[!-/:-@[-`{-~]/);function Ct(t){return t!==null&&t<-2}function qr(t){return t!==null&&(t<0||t===32)}function nn(t){return t===-2||t===-1||t===32}const Woe=_l(new RegExp("\\p{P}|\\p{S}","u")),Goe=_l(/\s/);function _l(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function fp(t){const e=[];let n=-1,i=0,r=0;for(;++n<t.length;){const s=t.charCodeAt(n);let o="";if(s===37&&fs(t.charCodeAt(n+1))&&fs(t.charCodeAt(n+2)))r=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(o=String.fromCharCode(s));else if(s>55295&&s<57344){const a=t.charCodeAt(n+1);s<56320&&a>56319&&a<57344?(o=String.fromCharCode(s,a),r=1):o=""}else o=String.fromCharCode(s);o&&(e.push(t.slice(i,n),encodeURIComponent(o)),i=n+r+1,o=""),r&&(n+=r,r=0)}return e.join("")+t.slice(i)}function wn(t,e,n,i){const r=i?i-1:Number.POSITIVE_INFINITY;let s=0;return o;function o(c){return nn(c)?(t.enter(n),a(c)):e(c)}function a(c){return nn(c)&&s++<r?(t.consume(c),a):(t.exit(n),e(c))}}const qoe={tokenize:Xoe};function Xoe(t){const e=t.attempt(this.parser.constructs.contentInitial,i,r);let n;return e;function i(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),wn(t,e,"linePrefix")}function r(a){return t.enter("paragraph"),s(a)}function s(a){const c=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=c),n=c,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return Ct(a)?(t.consume(a),t.exit("chunkText"),s):(t.consume(a),o)}}const Koe={tokenize:Yoe},kD={tokenize:Joe};function Yoe(t){const e=this,n=[];let i=0,r,s,o;return a;function a(S){if(i<n.length){const x=n[i];return e.containerState=x[1],t.attempt(x[0].continuation,c,l)(S)}return l(S)}function c(S){if(i++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,r&&y();const x=e.events.length;let w=x,C;for(;w--;)if(e.events[w][0]==="exit"&&e.events[w][1].type==="chunkFlow"){C=e.events[w][1].end;break}m(i);let E=x;for(;E<e.events.length;)e.events[E][1].end=Object.assign({},C),E++;return Qa(e.events,w+1,0,e.events.slice(x)),e.events.length=E,l(S)}return a(S)}function l(S){if(i===n.length){if(!r)return d(S);if(r.currentConstruct&&r.currentConstruct.concrete)return f(S);e.interrupt=!!(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(kD,u,h)(S)}function u(S){return r&&y(),m(i),d(S)}function h(S){return e.parser.lazy[e.now().line]=i!==n.length,o=e.now().offset,f(S)}function d(S){return e.containerState={},t.attempt(kD,p,f)(S)}function p(S){return i++,n.push([e.currentConstruct,e.containerState]),d(S)}function f(S){if(S===null){r&&y(),m(0),t.consume(S);return}return r=r||e.parser.flow(e.now()),t.enter("chunkFlow",{contentType:"flow",previous:s,_tokenizer:r}),v(S)}function v(S){if(S===null){g(t.exit("chunkFlow"),!0),m(0),t.consume(S);return}return Ct(S)?(t.consume(S),g(t.exit("chunkFlow")),i=0,e.interrupt=void 0,a):(t.consume(S),v)}function g(S,x){const w=e.sliceStream(S);if(x&&w.push(null),S.previous=s,s&&(s.next=S),s=S,r.defineSkip(S.start),r.write(w),e.parser.lazy[S.start.line]){let C=r.events.length;for(;C--;)if(r.events[C][1].start.offset<o&&(!r.events[C][1].end||r.events[C][1].end.offset>o))return;const E=e.events.length;let b=E,M,_;for(;b--;)if(e.events[b][0]==="exit"&&e.events[b][1].type==="chunkFlow"){if(M){_=e.events[b][1].end;break}M=!0}for(m(i),C=E;C<e.events.length;)e.events[C][1].end=Object.assign({},_),C++;Qa(e.events,b+1,0,e.events.slice(E)),e.events.length=C}}function m(S){let x=n.length;for(;x-- >S;){const w=n[x];e.containerState=w[1],w[0].exit.call(e,t)}n.length=S}function y(){r.write([null]),s=void 0,r=void 0,e.containerState._closeFlow=void 0}}function Joe(t,e,n){return wn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function LD(t){if(t===null||qr(t)||Goe(t))return 1;if(Woe(t))return 2}function vA(t,e,n){const i=[];let r=-1;for(;++r<t.length;){const s=t[r].resolveAll;s&&!i.includes(s)&&(e=s(e,n),i.push(s))}return e}const gb={name:"attention",tokenize:Zoe,resolveAll:Qoe};function Qoe(t,e){let n=-1,i,r,s,o,a,c,l,u;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(i=n;i--;)if(t[i][0]==="exit"&&t[i][1].type==="attentionSequence"&&t[i][1]._open&&e.sliceSerialize(t[i][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[i][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[i][1].end.offset-t[i][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;c=t[i][1].end.offset-t[i][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const h=Object.assign({},t[i][1].end),d=Object.assign({},t[n][1].start);DD(h,-c),DD(d,c),o={type:c>1?"strongSequence":"emphasisSequence",start:h,end:Object.assign({},t[i][1].end)},a={type:c>1?"strongSequence":"emphasisSequence",start:Object.assign({},t[n][1].start),end:d},s={type:c>1?"strongText":"emphasisText",start:Object.assign({},t[i][1].end),end:Object.assign({},t[n][1].start)},r={type:c>1?"strong":"emphasis",start:Object.assign({},o.start),end:Object.assign({},a.end)},t[i][1].end=Object.assign({},o.start),t[n][1].start=Object.assign({},a.end),l=[],t[i][1].end.offset-t[i][1].start.offset&&(l=Os(l,[["enter",t[i][1],e],["exit",t[i][1],e]])),l=Os(l,[["enter",r,e],["enter",o,e],["exit",o,e],["enter",s,e]]),l=Os(l,vA(e.parser.constructs.insideSpan.null,t.slice(i+1,n),e)),l=Os(l,[["exit",s,e],["enter",a,e],["exit",a,e],["exit",r,e]]),t[n][1].end.offset-t[n][1].start.offset?(u=2,l=Os(l,[["enter",t[n][1],e],["exit",t[n][1],e]])):u=0,Qa(t,i-1,n-i+3,l),n=i+l.length-u-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function Zoe(t,e){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,r=LD(i);let s;return o;function o(c){return s=c,t.enter("attentionSequence"),a(c)}function a(c){if(c===s)return t.consume(c),a;const l=t.exit("attentionSequence"),u=LD(c),h=!u||u===2&&r||n.includes(c),d=!r||r===2&&u||n.includes(i);return l._open=!!(s===42?h:h&&(r||!d)),l._close=!!(s===42?d:d&&(u||!h)),e(c)}}function DD(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const eae={name:"autolink",tokenize:tae};function tae(t,e,n){let i=0;return r;function r(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),s}function s(p){return ea(p)?(t.consume(p),o):p===64?n(p):l(p)}function o(p){return p===43||p===45||p===46||fs(p)?(i=1,a(p)):l(p)}function a(p){return p===58?(t.consume(p),i=0,c):(p===43||p===45||p===46||fs(p))&&i++<32?(t.consume(p),a):(i=0,l(p))}function c(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||fb(p)?n(p):(t.consume(p),c)}function l(p){return p===64?(t.consume(p),u):Hoe(p)?(t.consume(p),l):n(p)}function u(p){return fs(p)?h(p):n(p)}function h(p){return p===46?(t.consume(p),i=0,u):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):d(p)}function d(p){if((p===45||fs(p))&&i++<63){const f=p===45?d:h;return t.consume(p),f}return n(p)}}const iC={tokenize:nae,partial:!0};function nae(t,e,n){return i;function i(s){return nn(s)?wn(t,r,"linePrefix")(s):r(s)}function r(s){return s===null||Ct(s)?e(s):n(s)}}const G5={name:"blockQuote",tokenize:iae,continuation:{tokenize:rae},exit:sae};function iae(t,e,n){const i=this;return r;function r(o){if(o===62){const a=i.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),s}return n(o)}function s(o){return nn(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function rae(t,e,n){const i=this;return r;function r(o){return nn(o)?wn(t,s,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):s(o)}function s(o){return t.attempt(G5,e,n)(o)}}function sae(t){t.exit("blockQuote")}const q5={name:"characterEscape",tokenize:oae};function oae(t,e,n){return i;function i(s){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(s),t.exit("escapeMarker"),r}function r(s){return joe(s)?(t.enter("characterEscapeValue"),t.consume(s),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(s)}}const X5={name:"characterReference",tokenize:aae};function aae(t,e,n){const i=this;let r=0,s,o;return a;function a(h){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(h),t.exit("characterReferenceMarker"),c}function c(h){return h===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(h),t.exit("characterReferenceMarkerNumeric"),l):(t.enter("characterReferenceValue"),s=31,o=fs,u(h))}function l(h){return h===88||h===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(h),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),s=6,o=Voe,u):(t.enter("characterReferenceValue"),s=7,o=mb,u(h))}function u(h){if(h===59&&r){const d=t.exit("characterReferenceValue");return o===fs&&!gA(i.sliceSerialize(d))?n(h):(t.enter("characterReferenceMarker"),t.consume(h),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(h)&&r++<s?(t.consume(h),u):n(h)}}const ND={tokenize:lae,partial:!0},OD={name:"codeFenced",tokenize:cae,concrete:!0};function cae(t,e,n){const i=this,r={tokenize:w,partial:!0};let s=0,o=0,a;return c;function c(C){return l(C)}function l(C){const E=i.events[i.events.length-1];return s=E&&E[1].type==="linePrefix"?E[2].sliceSerialize(E[1],!0).length:0,a=C,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),u(C)}function u(C){return C===a?(o++,t.consume(C),u):o<3?n(C):(t.exit("codeFencedFenceSequence"),nn(C)?wn(t,h,"whitespace")(C):h(C))}function h(C){return C===null||Ct(C)?(t.exit("codeFencedFence"),i.interrupt?e(C):t.check(ND,v,x)(C)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),d(C))}function d(C){return C===null||Ct(C)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),h(C)):nn(C)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),wn(t,p,"whitespace")(C)):C===96&&C===a?n(C):(t.consume(C),d)}function p(C){return C===null||Ct(C)?h(C):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),f(C))}function f(C){return C===null||Ct(C)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),h(C)):C===96&&C===a?n(C):(t.consume(C),f)}function v(C){return t.attempt(r,x,g)(C)}function g(C){return t.enter("lineEnding"),t.consume(C),t.exit("lineEnding"),m}function m(C){return s>0&&nn(C)?wn(t,y,"linePrefix",s+1)(C):y(C)}function y(C){return C===null||Ct(C)?t.check(ND,v,x)(C):(t.enter("codeFlowValue"),S(C))}function S(C){return C===null||Ct(C)?(t.exit("codeFlowValue"),y(C)):(t.consume(C),S)}function x(C){return t.exit("codeFenced"),e(C)}function w(C,E,b){let M=0;return _;function _(X){return C.enter("lineEnding"),C.consume(X),C.exit("lineEnding"),R}function R(X){return C.enter("codeFencedFence"),nn(X)?wn(C,L,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(X):L(X)}function L(X){return X===a?(C.enter("codeFencedFenceSequence"),O(X)):b(X)}function O(X){return X===a?(M++,C.consume(X),O):M>=o?(C.exit("codeFencedFenceSequence"),nn(X)?wn(C,V,"whitespace")(X):V(X)):b(X)}function V(X){return X===null||Ct(X)?(C.exit("codeFencedFence"),E(X)):b(X)}}}function lae(t,e,n){const i=this;return r;function r(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s)}function s(o){return i.parser.lazy[i.now().line]?n(o):e(o)}}const Fw={name:"codeIndented",tokenize:hae},uae={tokenize:dae,partial:!0};function hae(t,e,n){const i=this;return r;function r(l){return t.enter("codeIndented"),wn(t,s,"linePrefix",5)(l)}function s(l){const u=i.events[i.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?o(l):n(l)}function o(l){return l===null?c(l):Ct(l)?t.attempt(uae,o,c)(l):(t.enter("codeFlowValue"),a(l))}function a(l){return l===null||Ct(l)?(t.exit("codeFlowValue"),o(l)):(t.consume(l),a)}function c(l){return t.exit("codeIndented"),e(l)}}function dae(t,e,n){const i=this;return r;function r(o){return i.parser.lazy[i.now().line]?n(o):Ct(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),r):wn(t,s,"linePrefix",5)(o)}function s(o){const a=i.events[i.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):Ct(o)?r(o):n(o)}}const pae={name:"codeText",tokenize:gae,resolve:fae,previous:mae};function fae(t){let e=t.length-4,n=3,i,r;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(i=n;++i<e;)if(t[i][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(i=n-1,e++;++i<=e;)r===void 0?i!==e&&t[i][1].type!=="lineEnding"&&(r=i):(i===e||t[i][1].type==="lineEnding")&&(t[r][1].type="codeTextData",i!==r+2&&(t[r][1].end=t[i-1][1].end,t.splice(r+2,i-r-2),e-=i-r-2,i=r+2),r=void 0);return t}function mae(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function gae(t,e,n){let i=0,r,s;return o;function o(h){return t.enter("codeText"),t.enter("codeTextSequence"),a(h)}function a(h){return h===96?(t.consume(h),i++,a):(t.exit("codeTextSequence"),c(h))}function c(h){return h===null?n(h):h===32?(t.enter("space"),t.consume(h),t.exit("space"),c):h===96?(s=t.enter("codeTextSequence"),r=0,u(h)):Ct(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),c):(t.enter("codeTextData"),l(h))}function l(h){return h===null||h===32||h===96||Ct(h)?(t.exit("codeTextData"),c(h)):(t.consume(h),l)}function u(h){return h===96?(t.consume(h),r++,u):r===i?(t.exit("codeTextSequence"),t.exit("codeText"),e(h)):(s.type="codeTextData",l(h))}}class vae{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(e,i):e>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(e,n,i){const r=n||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return i&&zm(this.left,i),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),zm(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),zm(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);zm(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);zm(this.left,n.reverse())}}}function zm(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function K5(t){const e={};let n=-1,i,r,s,o,a,c,l;const u=new vae(t);for(;++n<u.length;){for(;n in e;)n=e[n];if(i=u.get(n),n&&i[1].type==="chunkFlow"&&u.get(n-1)[1].type==="listItemPrefix"&&(c=i[1]._tokenizer.events,s=0,s<c.length&&c[s][1].type==="lineEndingBlank"&&(s+=2),s<c.length&&c[s][1].type==="content"))for(;++s<c.length&&c[s][1].type!=="content";)c[s][1].type==="chunkText"&&(c[s][1]._isInFirstContentOfListItem=!0,s++);if(i[0]==="enter")i[1].contentType&&(Object.assign(e,yae(u,n)),n=e[n],l=!0);else if(i[1]._container){for(s=n,r=void 0;s--&&(o=u.get(s),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank");)o[0]==="enter"&&(r&&(u.get(r)[1].type="lineEndingBlank"),o[1].type="lineEnding",r=s);r&&(i[1].end=Object.assign({},u.get(r)[1].start),a=u.slice(r,n),a.unshift(i),u.splice(r,n-r+1,a))}}return Qa(t,0,Number.POSITIVE_INFINITY,u.slice(0)),!l}function yae(t,e){const n=t.get(e)[1],i=t.get(e)[2];let r=e-1;const s=[],o=n._tokenizer||i.parser[n.contentType](n.start),a=o.events,c=[],l={};let u,h,d=-1,p=n,f=0,v=0;const g=[v];for(;p;){for(;t.get(++r)[1]!==p;);s.push(r),p._tokenizer||(u=i.sliceStream(p),p.next||u.push(null),h&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),h=p,p=p.next}for(p=n;++d<a.length;)a[d][0]==="exit"&&a[d-1][0]==="enter"&&a[d][1].type===a[d-1][1].type&&a[d][1].start.line!==a[d][1].end.line&&(v=d+1,g.push(v),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):g.pop(),d=g.length;d--;){const m=a.slice(g[d],g[d+1]),y=s.pop();c.push([y,y+m.length-1]),t.splice(y,2,m)}for(c.reverse(),d=-1;++d<c.length;)l[f+c[d][0]]=f+c[d][1],f+=c[d][1]-c[d][0]-1;return l}const Sae={tokenize:_ae,resolve:Cae},xae={tokenize:wae,partial:!0};function Cae(t){return K5(t),t}function _ae(t,e){let n;return i;function i(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),r(a)}function r(a){return a===null?s(a):Ct(a)?t.check(xae,o,s)(a):(t.consume(a),r)}function s(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}}function wae(t,e,n){const i=this;return r;function r(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),wn(t,s,"linePrefix")}function s(o){if(o===null||Ct(o))return n(o);const a=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(i.parser.constructs.flow,n,e)(o)}}function Y5(t,e,n,i,r,s,o,a,c){const l=c||Number.POSITIVE_INFINITY;let u=0;return h;function h(m){return m===60?(t.enter(i),t.enter(r),t.enter(s),t.consume(m),t.exit(s),d):m===null||m===32||m===41||fb(m)?n(m):(t.enter(i),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),v(m))}function d(m){return m===62?(t.enter(s),t.consume(m),t.exit(s),t.exit(r),t.exit(i),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),p(m))}function p(m){return m===62?(t.exit("chunkString"),t.exit(a),d(m)):m===null||m===60||Ct(m)?n(m):(t.consume(m),m===92?f:p)}function f(m){return m===60||m===62||m===92?(t.consume(m),p):p(m)}function v(m){return!u&&(m===null||m===41||qr(m))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(i),e(m)):u<l&&m===40?(t.consume(m),u++,v):m===41?(t.consume(m),u--,v):m===null||m===32||m===40||fb(m)?n(m):(t.consume(m),m===92?g:v)}function g(m){return m===40||m===41||m===92?(t.consume(m),v):v(m)}}function J5(t,e,n,i,r,s){const o=this;let a=0,c;return l;function l(p){return t.enter(i),t.enter(r),t.consume(p),t.exit(r),t.enter(s),u}function u(p){return a>999||p===null||p===91||p===93&&!c||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(p):p===93?(t.exit(s),t.enter(r),t.consume(p),t.exit(r),t.exit(i),e):Ct(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),u):(t.enter("chunkString",{contentType:"string"}),h(p))}function h(p){return p===null||p===91||p===93||Ct(p)||a++>999?(t.exit("chunkString"),u(p)):(t.consume(p),c||(c=!nn(p)),p===92?d:h)}function d(p){return p===91||p===92||p===93?(t.consume(p),a++,h):h(p)}}function Q5(t,e,n,i,r,s){let o;return a;function a(d){return d===34||d===39||d===40?(t.enter(i),t.enter(r),t.consume(d),t.exit(r),o=d===40?41:d,c):n(d)}function c(d){return d===o?(t.enter(r),t.consume(d),t.exit(r),t.exit(i),e):(t.enter(s),l(d))}function l(d){return d===o?(t.exit(s),c(o)):d===null?n(d):Ct(d)?(t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),wn(t,l,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),u(d))}function u(d){return d===o||d===null||Ct(d)?(t.exit("chunkString"),l(d)):(t.consume(d),d===92?h:u)}function h(d){return d===o||d===92?(t.consume(d),u):u(d)}}function Eg(t,e){let n;return i;function i(r){return Ct(r)?(t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),n=!0,i):nn(r)?wn(t,i,n?"linePrefix":"lineSuffix")(r):e(r)}}const Eae={name:"definition",tokenize:bae},Rae={tokenize:Tae,partial:!0};function bae(t,e,n){const i=this;let r;return s;function s(p){return t.enter("definition"),o(p)}function o(p){return J5.call(i,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return r=md(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),c):n(p)}function c(p){return qr(p)?Eg(t,l)(p):l(p)}function l(p){return Y5(t,u,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function u(p){return t.attempt(Rae,h,h)(p)}function h(p){return nn(p)?wn(t,d,"whitespace")(p):d(p)}function d(p){return p===null||Ct(p)?(t.exit("definition"),i.parser.defined.push(r),e(p)):n(p)}}function Tae(t,e,n){return i;function i(a){return qr(a)?Eg(t,r)(a):n(a)}function r(a){return Q5(t,s,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function s(a){return nn(a)?wn(t,o,"whitespace")(a):o(a)}function o(a){return a===null||Ct(a)?e(a):n(a)}}const Aae={name:"hardBreakEscape",tokenize:Pae};function Pae(t,e,n){return i;function i(s){return t.enter("hardBreakEscape"),t.consume(s),r}function r(s){return Ct(s)?(t.exit("hardBreakEscape"),e(s)):n(s)}}const Iae={name:"headingAtx",tokenize:kae,resolve:Mae};function Mae(t,e){let n=t.length-2,i=3,r,s;return t[i][1].type==="whitespace"&&(i+=2),n-2>i&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&t[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(r={type:"atxHeadingText",start:t[i][1].start,end:t[n][1].end},s={type:"chunkText",start:t[i][1].start,end:t[n][1].end,contentType:"text"},Qa(t,i,n-i+1,[["enter",r,e],["enter",s,e],["exit",s,e],["exit",r,e]])),t}function kae(t,e,n){let i=0;return r;function r(u){return t.enter("atxHeading"),s(u)}function s(u){return t.enter("atxHeadingSequence"),o(u)}function o(u){return u===35&&i++<6?(t.consume(u),o):u===null||qr(u)?(t.exit("atxHeadingSequence"),a(u)):n(u)}function a(u){return u===35?(t.enter("atxHeadingSequence"),c(u)):u===null||Ct(u)?(t.exit("atxHeading"),e(u)):nn(u)?wn(t,a,"whitespace")(u):(t.enter("atxHeadingText"),l(u))}function c(u){return u===35?(t.consume(u),c):(t.exit("atxHeadingSequence"),a(u))}function l(u){return u===null||u===35||qr(u)?(t.exit("atxHeadingText"),a(u)):(t.consume(u),l)}}const Lae=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],FD=["pre","script","style","textarea"],Dae={name:"htmlFlow",tokenize:zae,resolveTo:Fae,concrete:!0},Nae={tokenize:Bae,partial:!0},Oae={tokenize:Uae,partial:!0};function Fae(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function zae(t,e,n){const i=this;let r,s,o,a,c;return l;function l(I){return u(I)}function u(I){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(I),h}function h(I){return I===33?(t.consume(I),d):I===47?(t.consume(I),s=!0,v):I===63?(t.consume(I),r=3,i.interrupt?e:P):ea(I)?(t.consume(I),o=String.fromCharCode(I),g):n(I)}function d(I){return I===45?(t.consume(I),r=2,p):I===91?(t.consume(I),r=5,a=0,f):ea(I)?(t.consume(I),r=4,i.interrupt?e:P):n(I)}function p(I){return I===45?(t.consume(I),i.interrupt?e:P):n(I)}function f(I){const $="CDATA[";return I===$.charCodeAt(a++)?(t.consume(I),a===$.length?i.interrupt?e:L:f):n(I)}function v(I){return ea(I)?(t.consume(I),o=String.fromCharCode(I),g):n(I)}function g(I){if(I===null||I===47||I===62||qr(I)){const $=I===47,K=o.toLowerCase();return!$&&!s&&FD.includes(K)?(r=1,i.interrupt?e(I):L(I)):Lae.includes(o.toLowerCase())?(r=6,$?(t.consume(I),m):i.interrupt?e(I):L(I)):(r=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(I):s?y(I):S(I))}return I===45||fs(I)?(t.consume(I),o+=String.fromCharCode(I),g):n(I)}function m(I){return I===62?(t.consume(I),i.interrupt?e:L):n(I)}function y(I){return nn(I)?(t.consume(I),y):_(I)}function S(I){return I===47?(t.consume(I),_):I===58||I===95||ea(I)?(t.consume(I),x):nn(I)?(t.consume(I),S):_(I)}function x(I){return I===45||I===46||I===58||I===95||fs(I)?(t.consume(I),x):w(I)}function w(I){return I===61?(t.consume(I),C):nn(I)?(t.consume(I),w):S(I)}function C(I){return I===null||I===60||I===61||I===62||I===96?n(I):I===34||I===39?(t.consume(I),c=I,E):nn(I)?(t.consume(I),C):b(I)}function E(I){return I===c?(t.consume(I),c=null,M):I===null||Ct(I)?n(I):(t.consume(I),E)}function b(I){return I===null||I===34||I===39||I===47||I===60||I===61||I===62||I===96||qr(I)?w(I):(t.consume(I),b)}function M(I){return I===47||I===62||nn(I)?S(I):n(I)}function _(I){return I===62?(t.consume(I),R):n(I)}function R(I){return I===null||Ct(I)?L(I):nn(I)?(t.consume(I),R):n(I)}function L(I){return I===45&&r===2?(t.consume(I),G):I===60&&r===1?(t.consume(I),J):I===62&&r===4?(t.consume(I),ee):I===63&&r===3?(t.consume(I),P):I===93&&r===5?(t.consume(I),ne):Ct(I)&&(r===6||r===7)?(t.exit("htmlFlowData"),t.check(Nae,ge,O)(I)):I===null||Ct(I)?(t.exit("htmlFlowData"),O(I)):(t.consume(I),L)}function O(I){return t.check(Oae,V,ge)(I)}function V(I){return t.enter("lineEnding"),t.consume(I),t.exit("lineEnding"),X}function X(I){return I===null||Ct(I)?O(I):(t.enter("htmlFlowData"),L(I))}function G(I){return I===45?(t.consume(I),P):L(I)}function J(I){return I===47?(t.consume(I),o="",D):L(I)}function D(I){if(I===62){const $=o.toLowerCase();return FD.includes($)?(t.consume(I),ee):L(I)}return ea(I)&&o.length<8?(t.consume(I),o+=String.fromCharCode(I),D):L(I)}function ne(I){return I===93?(t.consume(I),P):L(I)}function P(I){return I===62?(t.consume(I),ee):I===45&&r===2?(t.consume(I),P):L(I)}function ee(I){return I===null||Ct(I)?(t.exit("htmlFlowData"),ge(I)):(t.consume(I),ee)}function ge(I){return t.exit("htmlFlow"),e(I)}}function Uae(t,e,n){const i=this;return r;function r(o){return Ct(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):n(o)}function s(o){return i.parser.lazy[i.now().line]?n(o):e(o)}}function Bae(t,e,n){return i;function i(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),t.attempt(iC,e,n)}}const $ae={name:"htmlText",tokenize:Hae};function Hae(t,e,n){const i=this;let r,s,o;return a;function a(P){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(P),c}function c(P){return P===33?(t.consume(P),l):P===47?(t.consume(P),w):P===63?(t.consume(P),S):ea(P)?(t.consume(P),b):n(P)}function l(P){return P===45?(t.consume(P),u):P===91?(t.consume(P),s=0,f):ea(P)?(t.consume(P),y):n(P)}function u(P){return P===45?(t.consume(P),p):n(P)}function h(P){return P===null?n(P):P===45?(t.consume(P),d):Ct(P)?(o=h,J(P)):(t.consume(P),h)}function d(P){return P===45?(t.consume(P),p):h(P)}function p(P){return P===62?G(P):P===45?d(P):h(P)}function f(P){const ee="CDATA[";return P===ee.charCodeAt(s++)?(t.consume(P),s===ee.length?v:f):n(P)}function v(P){return P===null?n(P):P===93?(t.consume(P),g):Ct(P)?(o=v,J(P)):(t.consume(P),v)}function g(P){return P===93?(t.consume(P),m):v(P)}function m(P){return P===62?G(P):P===93?(t.consume(P),m):v(P)}function y(P){return P===null||P===62?G(P):Ct(P)?(o=y,J(P)):(t.consume(P),y)}function S(P){return P===null?n(P):P===63?(t.consume(P),x):Ct(P)?(o=S,J(P)):(t.consume(P),S)}function x(P){return P===62?G(P):S(P)}function w(P){return ea(P)?(t.consume(P),C):n(P)}function C(P){return P===45||fs(P)?(t.consume(P),C):E(P)}function E(P){return Ct(P)?(o=E,J(P)):nn(P)?(t.consume(P),E):G(P)}function b(P){return P===45||fs(P)?(t.consume(P),b):P===47||P===62||qr(P)?M(P):n(P)}function M(P){return P===47?(t.consume(P),G):P===58||P===95||ea(P)?(t.consume(P),_):Ct(P)?(o=M,J(P)):nn(P)?(t.consume(P),M):G(P)}function _(P){return P===45||P===46||P===58||P===95||fs(P)?(t.consume(P),_):R(P)}function R(P){return P===61?(t.consume(P),L):Ct(P)?(o=R,J(P)):nn(P)?(t.consume(P),R):M(P)}function L(P){return P===null||P===60||P===61||P===62||P===96?n(P):P===34||P===39?(t.consume(P),r=P,O):Ct(P)?(o=L,J(P)):nn(P)?(t.consume(P),L):(t.consume(P),V)}function O(P){return P===r?(t.consume(P),r=void 0,X):P===null?n(P):Ct(P)?(o=O,J(P)):(t.consume(P),O)}function V(P){return P===null||P===34||P===39||P===60||P===61||P===96?n(P):P===47||P===62||qr(P)?M(P):(t.consume(P),V)}function X(P){return P===47||P===62||qr(P)?M(P):n(P)}function G(P){return P===62?(t.consume(P),t.exit("htmlTextData"),t.exit("htmlText"),e):n(P)}function J(P){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(P),t.exit("lineEnding"),D}function D(P){return nn(P)?wn(t,ne,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(P):ne(P)}function ne(P){return t.enter("htmlTextData"),o(P)}}const yA={name:"labelEnd",tokenize:Xae,resolveTo:qae,resolveAll:Gae},Vae={tokenize:Kae},jae={tokenize:Yae},Wae={tokenize:Jae};function Gae(t){let e=-1;for(;++e<t.length;){const n=t[e][1];(n.type==="labelImage"||n.type==="labelLink"||n.type==="labelEnd")&&(t.splice(e+1,n.type==="labelImage"?4:2),n.type="data",e++)}return t}function qae(t,e){let n=t.length,i=0,r,s,o,a;for(;n--;)if(r=t[n][1],s){if(r.type==="link"||r.type==="labelLink"&&r._inactive)break;t[n][0]==="enter"&&r.type==="labelLink"&&(r._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(r.type==="labelImage"||r.type==="labelLink")&&!r._balanced&&(s=n,r.type!=="labelLink")){i=2;break}}else r.type==="labelEnd"&&(o=n);const c={type:t[s][1].type==="labelLink"?"link":"image",start:Object.assign({},t[s][1].start),end:Object.assign({},t[t.length-1][1].end)},l={type:"label",start:Object.assign({},t[s][1].start),end:Object.assign({},t[o][1].end)},u={type:"labelText",start:Object.assign({},t[s+i+2][1].end),end:Object.assign({},t[o-2][1].start)};return a=[["enter",c,e],["enter",l,e]],a=Os(a,t.slice(s+1,s+i+3)),a=Os(a,[["enter",u,e]]),a=Os(a,vA(e.parser.constructs.insideSpan.null,t.slice(s+i+4,o-3),e)),a=Os(a,[["exit",u,e],t[o-2],t[o-1],["exit",l,e]]),a=Os(a,t.slice(o+1)),a=Os(a,[["exit",c,e]]),Qa(t,s,t.length,a),t}function Xae(t,e,n){const i=this;let r=i.events.length,s,o;for(;r--;)if((i.events[r][1].type==="labelImage"||i.events[r][1].type==="labelLink")&&!i.events[r][1]._balanced){s=i.events[r][1];break}return a;function a(d){return s?s._inactive?h(d):(o=i.parser.defined.includes(md(i.sliceSerialize({start:s.end,end:i.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(d),t.exit("labelMarker"),t.exit("labelEnd"),c):n(d)}function c(d){return d===40?t.attempt(Vae,u,o?u:h)(d):d===91?t.attempt(jae,u,o?l:h)(d):o?u(d):h(d)}function l(d){return t.attempt(Wae,u,h)(d)}function u(d){return e(d)}function h(d){return s._balanced=!0,n(d)}}function Kae(t,e,n){return i;function i(h){return t.enter("resource"),t.enter("resourceMarker"),t.consume(h),t.exit("resourceMarker"),r}function r(h){return qr(h)?Eg(t,s)(h):s(h)}function s(h){return h===41?u(h):Y5(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function o(h){return qr(h)?Eg(t,c)(h):u(h)}function a(h){return n(h)}function c(h){return h===34||h===39||h===40?Q5(t,l,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):u(h)}function l(h){return qr(h)?Eg(t,u)(h):u(h)}function u(h){return h===41?(t.enter("resourceMarker"),t.consume(h),t.exit("resourceMarker"),t.exit("resource"),e):n(h)}}function Yae(t,e,n){const i=this;return r;function r(a){return J5.call(i,t,s,o,"reference","referenceMarker","referenceString")(a)}function s(a){return i.parser.defined.includes(md(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function Jae(t,e,n){return i;function i(s){return t.enter("reference"),t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),r}function r(s){return s===93?(t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),t.exit("reference"),e):n(s)}}const Qae={name:"labelStartImage",tokenize:Zae,resolveAll:yA.resolveAll};function Zae(t,e,n){const i=this;return r;function r(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),s}function s(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(a):e(a)}}const ece={name:"labelStartLink",tokenize:tce,resolveAll:yA.resolveAll};function tce(t,e,n){const i=this;return r;function r(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),s}function s(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(o):e(o)}}const zw={name:"lineEnding",tokenize:nce};function nce(t,e){return n;function n(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),wn(t,e,"linePrefix")}}const By={name:"thematicBreak",tokenize:ice};function ice(t,e,n){let i=0,r;return s;function s(l){return t.enter("thematicBreak"),o(l)}function o(l){return r=l,a(l)}function a(l){return l===r?(t.enter("thematicBreakSequence"),c(l)):i>=3&&(l===null||Ct(l))?(t.exit("thematicBreak"),e(l)):n(l)}function c(l){return l===r?(t.consume(l),i++,c):(t.exit("thematicBreakSequence"),nn(l)?wn(t,a,"whitespace")(l):a(l))}}const Fr={name:"list",tokenize:oce,continuation:{tokenize:ace},exit:lce},rce={tokenize:uce,partial:!0},sce={tokenize:cce,partial:!0};function oce(t,e,n){const i=this,r=i.events[i.events.length-1];let s=r&&r[1].type==="linePrefix"?r[2].sliceSerialize(r[1],!0).length:0,o=0;return a;function a(p){const f=i.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(f==="listUnordered"?!i.containerState.marker||p===i.containerState.marker:mb(p)){if(i.containerState.type||(i.containerState.type=f,t.enter(f,{_container:!0})),f==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(By,n,l)(p):l(p);if(!i.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),c(p)}return n(p)}function c(p){return mb(p)&&++o<10?(t.consume(p),c):(!i.interrupt||o<2)&&(i.containerState.marker?p===i.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),l(p)):n(p)}function l(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||p,t.check(iC,i.interrupt?n:u,t.attempt(rce,d,h))}function u(p){return i.containerState.initialBlankLine=!0,s++,d(p)}function h(p){return nn(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),d):n(p)}function d(p){return i.containerState.size=s+i.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function ace(t,e,n){const i=this;return i.containerState._closeFlow=void 0,t.check(iC,r,s);function r(a){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,wn(t,e,"listItemIndent",i.containerState.size+1)(a)}function s(a){return i.containerState.furtherBlankLines||!nn(a)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,o(a)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,t.attempt(sce,e,o)(a))}function o(a){return i.containerState._closeFlow=!0,i.interrupt=void 0,wn(t,t.attempt(Fr,e,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function cce(t,e,n){const i=this;return wn(t,r,"listItemIndent",i.containerState.size+1);function r(s){const o=i.events[i.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===i.containerState.size?e(s):n(s)}}function lce(t){t.exit(this.containerState.type)}function uce(t,e,n){const i=this;return wn(t,r,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function r(s){const o=i.events[i.events.length-1];return!nn(s)&&o&&o[1].type==="listItemPrefixWhitespace"?e(s):n(s)}}const zD={name:"setextUnderline",tokenize:dce,resolveTo:hce};function hce(t,e){let n=t.length,i,r,s;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){i=n;break}t[n][1].type==="paragraph"&&(r=n)}else t[n][1].type==="content"&&t.splice(n,1),!s&&t[n][1].type==="definition"&&(s=n);const o={type:"setextHeading",start:Object.assign({},t[r][1].start),end:Object.assign({},t[t.length-1][1].end)};return t[r][1].type="setextHeadingText",s?(t.splice(r,0,["enter",o,e]),t.splice(s+1,0,["exit",t[i][1],e]),t[i][1].end=Object.assign({},t[s][1].end)):t[i][1]=o,t.push(["exit",o,e]),t}function dce(t,e,n){const i=this;let r;return s;function s(l){let u=i.events.length,h;for(;u--;)if(i.events[u][1].type!=="lineEnding"&&i.events[u][1].type!=="linePrefix"&&i.events[u][1].type!=="content"){h=i.events[u][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||h)?(t.enter("setextHeadingLine"),r=l,o(l)):n(l)}function o(l){return t.enter("setextHeadingLineSequence"),a(l)}function a(l){return l===r?(t.consume(l),a):(t.exit("setextHeadingLineSequence"),nn(l)?wn(t,c,"lineSuffix")(l):c(l))}function c(l){return l===null||Ct(l)?(t.exit("setextHeadingLine"),e(l)):n(l)}}const pce={tokenize:fce};function fce(t){const e=this,n=t.attempt(iC,i,t.attempt(this.parser.constructs.flowInitial,r,wn(t,t.attempt(this.parser.constructs.flow,r,t.attempt(Sae,r)),"linePrefix")));return n;function i(s){if(s===null){t.consume(s);return}return t.enter("lineEndingBlank"),t.consume(s),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function r(s){if(s===null){t.consume(s);return}return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const mce={resolveAll:e6()},gce=Z5("string"),vce=Z5("text");function Z5(t){return{tokenize:e,resolveAll:e6(t==="text"?yce:void 0)};function e(n){const i=this,r=this.parser.constructs[t],s=n.attempt(r,o,a);return o;function o(u){return l(u)?s(u):a(u)}function a(u){if(u===null){n.consume(u);return}return n.enter("data"),n.consume(u),c}function c(u){return l(u)?(n.exit("data"),s(u)):(n.consume(u),c)}function l(u){if(u===null)return!0;const h=r[u];let d=-1;if(h)for(;++d<h.length;){const p=h[d];if(!p.previous||p.previous.call(i,i.previous))return!0}return!1}}}function e6(t){return e;function e(n,i){let r=-1,s;for(;++r<=n.length;)s===void 0?n[r]&&n[r][1].type==="data"&&(s=r,r++):(!n[r]||n[r][1].type!=="data")&&(r!==s+2&&(n[s][1].end=n[r-1][1].end,n.splice(s+2,r-s-2),r=s+2),s=void 0);return t?t(n,i):n}}function yce(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const i=t[n-1][1],r=e.sliceStream(i);let s=r.length,o=-1,a=0,c;for(;s--;){const l=r[s];if(typeof l=="string"){for(o=l.length;l.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(l===-2)c=!0,a++;else if(l!==-1){s++;break}}if(a){const l={type:n===t.length||c||a<2?"lineSuffix":"hardBreakTrailing",start:{line:i.end.line,column:i.end.column-a,offset:i.end.offset-a,_index:i.start._index+s,_bufferIndex:s?o:i.start._bufferIndex+o},end:Object.assign({},i.end)};i.end=Object.assign({},l.start),i.start.offset===i.end.offset?Object.assign(i,l):(t.splice(n,0,["enter",l,e],["exit",l,e]),n+=2)}n++}return t}function Sce(t,e,n){let i=Object.assign(n?Object.assign({},n):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const r={},s=[];let o=[],a=[];const c={consume:y,enter:S,exit:x,attempt:E(w),check:E(C),interrupt:E(C,{interrupt:!0})},l={previous:null,code:null,containerState:{},events:[],parser:t,sliceStream:p,sliceSerialize:d,now:f,defineSkip:v,write:h};let u=e.tokenize.call(l,c);return e.resolveAll&&s.push(e),l;function h(R){return o=Os(o,R),g(),o[o.length-1]!==null?[]:(b(e,0),l.events=vA(s,l.events,l),l.events)}function d(R,L){return Cce(p(R),L)}function p(R){return xce(o,R)}function f(){const{line:R,column:L,offset:O,_index:V,_bufferIndex:X}=i;return{line:R,column:L,offset:O,_index:V,_bufferIndex:X}}function v(R){r[R.line]=R.column,_()}function g(){let R;for(;i._index<o.length;){const L=o[i._index];if(typeof L=="string")for(R=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===R&&i._bufferIndex<L.length;)m(L.charCodeAt(i._bufferIndex));else m(L)}}function m(R){u=u(R)}function y(R){Ct(R)?(i.line++,i.column=1,i.offset+=R===-3?2:1,_()):R!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===o[i._index].length&&(i._bufferIndex=-1,i._index++)),l.previous=R}function S(R,L){const O=L||{};return O.type=R,O.start=f(),l.events.push(["enter",O,l]),a.push(O),O}function x(R){const L=a.pop();return L.end=f(),l.events.push(["exit",L,l]),L}function w(R,L){b(R,L.from)}function C(R,L){L.restore()}function E(R,L){return O;function O(V,X,G){let J,D,ne,P;return Array.isArray(V)?ge(V):"tokenize"in V?ge([V]):ee(V);function ee(oe){return he;function he(ze){const Me=ze!==null&&oe[ze],dt=ze!==null&&oe.null,it=[...Array.isArray(Me)?Me:Me?[Me]:[],...Array.isArray(dt)?dt:dt?[dt]:[]];return ge(it)(ze)}}function ge(oe){return J=oe,D=0,oe.length===0?G:I(oe[D])}function I(oe){return he;function he(ze){return P=M(),ne=oe,oe.partial||(l.currentConstruct=oe),oe.name&&l.parser.constructs.disable.null.includes(oe.name)?K():oe.tokenize.call(L?Object.assign(Object.create(l),L):l,c,$,K)(ze)}}function $(oe){return R(ne,P),X}function K(oe){return P.restore(),++D<J.length?I(J[D]):G}}}function b(R,L){R.resolveAll&&!s.includes(R)&&s.push(R),R.resolve&&Qa(l.events,L,l.events.length-L,R.resolve(l.events.slice(L),l)),R.resolveTo&&(l.events=R.resolveTo(l.events,l))}function M(){const R=f(),L=l.previous,O=l.currentConstruct,V=l.events.length,X=Array.from(a);return{restore:G,from:V};function G(){i=R,l.previous=L,l.currentConstruct=O,l.events.length=V,a=X,_()}}function _(){i.line in r&&i.column<2&&(i.column=r[i.line],i.offset+=r[i.line]-1)}}function xce(t,e){const n=e.start._index,i=e.start._bufferIndex,r=e.end._index,s=e.end._bufferIndex;let o;if(n===r)o=[t[n].slice(i,s)];else{if(o=t.slice(n,r),i>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(i):o.shift()}s>0&&o.push(t[r].slice(0,s))}return o}function Cce(t,e){let n=-1;const i=[];let r;for(;++n<t.length;){const s=t[n];let o;if(typeof s=="string")o=s;else switch(s){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&r)continue;o=" ";break}default:o=String.fromCharCode(s)}r=s===-2,i.push(o)}return i.join("")}const _ce={42:Fr,43:Fr,45:Fr,48:Fr,49:Fr,50:Fr,51:Fr,52:Fr,53:Fr,54:Fr,55:Fr,56:Fr,57:Fr,62:G5},wce={91:Eae},Ece={[-2]:Fw,[-1]:Fw,32:Fw},Rce={35:Iae,42:By,45:[zD,By],60:Dae,61:zD,95:By,96:OD,126:OD},bce={38:X5,92:q5},Tce={[-5]:zw,[-4]:zw,[-3]:zw,33:Qae,38:X5,42:gb,60:[eae,$ae],91:ece,92:[Aae,q5],93:yA,95:gb,96:pae},Ace={null:[gb,mce]},Pce={null:[42,95]},Ice={null:[]},Mce=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Pce,contentInitial:wce,disable:Ice,document:_ce,flow:Rce,flowInitial:Ece,insideSpan:Ace,string:bce,text:Tce},Symbol.toStringTag,{value:"Module"}));function kce(t){const n=Uoe([Mce,...(t||{}).extensions||[]]),i={defined:[],lazy:{},constructs:n,content:r(qoe),document:r(Koe),flow:r(pce),string:r(gce),text:r(vce)};return i;function r(s){return o;function o(a){return Sce(i,s,a)}}}function Lce(t){for(;!K5(t););return t}const UD=/[\0\t\n\r]/g;function Dce(){let t=1,e="",n=!0,i;return r;function r(s,o,a){const c=[];let l,u,h,d,p;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(o||void 0).decode(s)),h=0,e="",n&&(s.charCodeAt(0)===65279&&h++,n=void 0);h<s.length;){if(UD.lastIndex=h,l=UD.exec(s),d=l&&l.index!==void 0?l.index:s.length,p=s.charCodeAt(d),!l){e=s.slice(h);break}if(p===10&&h===d&&i)c.push(-3),i=void 0;else switch(i&&(c.push(-5),i=void 0),h<d&&(c.push(s.slice(h,d)),t+=d-h),p){case 0:{c.push(65533),t++;break}case 9:{for(u=Math.ceil(t/4)*4,c.push(-2);t++<u;)c.push(-1);break}case 10:{c.push(-4),t=1;break}default:i=!0,t=1}h=d+1}return a&&(i&&c.push(-5),e&&c.push(e),c.push(null)),c}}const Nce=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Oce(t){return t.replace(Nce,Fce)}function Fce(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const r=n.charCodeAt(1),s=r===120||r===88;return W5(n.slice(s?2:1),s?16:10)}return gA(n)||t}const t6={}.hasOwnProperty;function zce(t,e,n){return typeof e!="string"&&(n=e,e=void 0),Uce(n)(Lce(kce(n).document().write(Dce()(t,e,!0))))}function Uce(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(pt),autolinkProtocol:M,autolinkEmail:M,atxHeading:s(xt),blockQuote:s(dt),characterEscape:M,characterReference:M,codeFenced:s(it),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:s(it,o),codeText:s(St,o),codeTextData:M,data:M,codeFlowValue:M,definition:s(U),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:s(di),hardBreakEscape:s(Mt),hardBreakTrailing:s(Mt),htmlFlow:s(lt,o),htmlFlowData:M,htmlText:s(lt,o),htmlTextData:M,image:s(Zt),label:o,link:s(pt),listItem:s(T),listItemValue:d,listOrdered:s(k,h),listUnordered:s(k),paragraph:s(Q),reference:I,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:s(xt),strong:s(ae),thematicBreak:s(de)},exit:{atxHeading:c(),atxHeadingSequence:w,autolink:c(),autolinkEmail:Me,autolinkProtocol:ze,blockQuote:c(),characterEscapeValue:_,characterReferenceMarkerHexadecimal:K,characterReferenceMarkerNumeric:K,characterReferenceValue:oe,characterReference:he,codeFenced:c(g),codeFencedFence:v,codeFencedFenceInfo:p,codeFencedFenceMeta:f,codeFlowValue:_,codeIndented:c(m),codeText:c(X),codeTextData:_,data:_,definition:c(),definitionDestinationString:x,definitionLabelString:y,definitionTitleString:S,emphasis:c(),hardBreakEscape:c(L),hardBreakTrailing:c(L),htmlFlow:c(O),htmlFlowData:_,htmlText:c(V),htmlTextData:_,image:c(J),label:ne,labelText:D,lineEnding:R,link:c(G),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:$,resourceDestinationString:P,resourceTitleString:ee,resource:ge,setextHeading:c(b),setextHeadingLineSequence:E,setextHeadingText:C,strong:c(),thematicBreak:c()}};n6(e,(t||{}).mdastExtensions||[]);const n={};return i;function i(H){let Y={type:"root",children:[]};const le={stack:[Y],tokenStack:[],config:e,enter:a,exit:l,buffer:o,resume:u,data:n},ke=[];let ue=-1;for(;++ue<H.length;)if(H[ue][1].type==="listOrdered"||H[ue][1].type==="listUnordered")if(H[ue][0]==="enter")ke.push(ue);else{const Ce=ke.pop();ue=r(H,Ce,ue)}for(ue=-1;++ue<H.length;){const Ce=e[H[ue][0]];t6.call(Ce,H[ue][1].type)&&Ce[H[ue][1].type].call(Object.assign({sliceSerialize:H[ue][2].sliceSerialize},le),H[ue][1])}if(le.tokenStack.length>0){const Ce=le.tokenStack[le.tokenStack.length-1];(Ce[1]||BD).call(le,void 0,Ce[0])}for(Y.position={start:gc(H.length>0?H[0][1].start:{line:1,column:1,offset:0}),end:gc(H.length>0?H[H.length-2][1].end:{line:1,column:1,offset:0})},ue=-1;++ue<e.transforms.length;)Y=e.transforms[ue](Y)||Y;return Y}function r(H,Y,le){let ke=Y-1,ue=-1,Ce=!1,Te,Ze,Pe,wt;for(;++ke<=le;){const et=H[ke];switch(et[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{et[0]==="enter"?ue++:ue--,wt=void 0;break}case"lineEndingBlank":{et[0]==="enter"&&(Te&&!wt&&!ue&&!Pe&&(Pe=ke),wt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:wt=void 0}if(!ue&&et[0]==="enter"&&et[1].type==="listItemPrefix"||ue===-1&&et[0]==="exit"&&(et[1].type==="listUnordered"||et[1].type==="listOrdered")){if(Te){let Dt=ke;for(Ze=void 0;Dt--;){const B=H[Dt];if(B[1].type==="lineEnding"||B[1].type==="lineEndingBlank"){if(B[0]==="exit")continue;Ze&&(H[Ze][1].type="lineEndingBlank",Ce=!0),B[1].type="lineEnding",Ze=Dt}else if(!(B[1].type==="linePrefix"||B[1].type==="blockQuotePrefix"||B[1].type==="blockQuotePrefixWhitespace"||B[1].type==="blockQuoteMarker"||B[1].type==="listItemIndent"))break}Pe&&(!Ze||Pe<Ze)&&(Te._spread=!0),Te.end=Object.assign({},Ze?H[Ze][1].start:et[1].end),H.splice(Ze||ke,0,["exit",Te,et[2]]),ke++,le++}if(et[1].type==="listItemPrefix"){const Dt={type:"listItem",_spread:!1,start:Object.assign({},et[1].start),end:void 0};Te=Dt,H.splice(ke,0,["enter",Dt,et[2]]),ke++,le++,Pe=void 0,wt=!0}}}return H[Y][1]._spread=Ce,le}function s(H,Y){return le;function le(ke){a.call(this,H(ke),ke),Y&&Y.call(this,ke)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(H,Y,le){this.stack[this.stack.length-1].children.push(H),this.stack.push(H),this.tokenStack.push([Y,le]),H.position={start:gc(Y.start),end:void 0}}function c(H){return Y;function Y(le){H&&H.call(this,le),l.call(this,le)}}function l(H,Y){const le=this.stack.pop(),ke=this.tokenStack.pop();if(ke)ke[0].type!==H.type&&(Y?Y.call(this,H,ke[0]):(ke[1]||BD).call(this,H,ke[0]));else throw new Error("Cannot close `"+H.type+"` ("+wg({start:H.start,end:H.end})+"): its not open");le.position.end=gc(H.end)}function u(){return Foe(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function d(H){if(this.data.expectingFirstListItemValue){const Y=this.stack[this.stack.length-2];Y.start=Number.parseInt(this.sliceSerialize(H),10),this.data.expectingFirstListItemValue=void 0}}function p(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.lang=H}function f(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.meta=H}function v(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function g(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.value=H.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function m(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.value=H.replace(/(\r?\n|\r)$/g,"")}function y(H){const Y=this.resume(),le=this.stack[this.stack.length-1];le.label=Y,le.identifier=md(this.sliceSerialize(H)).toLowerCase()}function S(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.title=H}function x(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.url=H}function w(H){const Y=this.stack[this.stack.length-1];if(!Y.depth){const le=this.sliceSerialize(H).length;Y.depth=le}}function C(){this.data.setextHeadingSlurpLineEnding=!0}function E(H){const Y=this.stack[this.stack.length-1];Y.depth=this.sliceSerialize(H).codePointAt(0)===61?1:2}function b(){this.data.setextHeadingSlurpLineEnding=void 0}function M(H){const le=this.stack[this.stack.length-1].children;let ke=le[le.length-1];(!ke||ke.type!=="text")&&(ke=me(),ke.position={start:gc(H.start),end:void 0},le.push(ke)),this.stack.push(ke)}function _(H){const Y=this.stack.pop();Y.value+=this.sliceSerialize(H),Y.position.end=gc(H.end)}function R(H){const Y=this.stack[this.stack.length-1];if(this.data.atHardBreak){const le=Y.children[Y.children.length-1];le.position.end=gc(H.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Y.type)&&(M.call(this,H),_.call(this,H))}function L(){this.data.atHardBreak=!0}function O(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.value=H}function V(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.value=H}function X(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.value=H}function G(){const H=this.stack[this.stack.length-1];if(this.data.inReference){const Y=this.data.referenceType||"shortcut";H.type+="Reference",H.referenceType=Y,delete H.url,delete H.title}else delete H.identifier,delete H.label;this.data.referenceType=void 0}function J(){const H=this.stack[this.stack.length-1];if(this.data.inReference){const Y=this.data.referenceType||"shortcut";H.type+="Reference",H.referenceType=Y,delete H.url,delete H.title}else delete H.identifier,delete H.label;this.data.referenceType=void 0}function D(H){const Y=this.sliceSerialize(H),le=this.stack[this.stack.length-2];le.label=Oce(Y),le.identifier=md(Y).toLowerCase()}function ne(){const H=this.stack[this.stack.length-1],Y=this.resume(),le=this.stack[this.stack.length-1];if(this.data.inReference=!0,le.type==="link"){const ke=H.children;le.children=ke}else le.alt=Y}function P(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.url=H}function ee(){const H=this.resume(),Y=this.stack[this.stack.length-1];Y.title=H}function ge(){this.data.inReference=void 0}function I(){this.data.referenceType="collapsed"}function $(H){const Y=this.resume(),le=this.stack[this.stack.length-1];le.label=Y,le.identifier=md(this.sliceSerialize(H)).toLowerCase(),this.data.referenceType="full"}function K(H){this.data.characterReferenceType=H.type}function oe(H){const Y=this.sliceSerialize(H),le=this.data.characterReferenceType;let ke;le?(ke=W5(Y,le==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ke=gA(Y);const ue=this.stack[this.stack.length-1];ue.value+=ke}function he(H){const Y=this.stack.pop();Y.position.end=gc(H.end)}function ze(H){_.call(this,H);const Y=this.stack[this.stack.length-1];Y.url=this.sliceSerialize(H)}function Me(H){_.call(this,H);const Y=this.stack[this.stack.length-1];Y.url="mailto:"+this.sliceSerialize(H)}function dt(){return{type:"blockquote",children:[]}}function it(){return{type:"code",lang:null,meta:null,value:""}}function St(){return{type:"inlineCode",value:""}}function U(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function di(){return{type:"emphasis",children:[]}}function xt(){return{type:"heading",depth:0,children:[]}}function Mt(){return{type:"break"}}function lt(){return{type:"html",value:""}}function Zt(){return{type:"image",title:null,url:"",alt:null}}function pt(){return{type:"link",title:null,url:"",children:[]}}function k(H){return{type:"list",ordered:H.type==="listOrdered",start:null,spread:H._spread,children:[]}}function T(H){return{type:"listItem",spread:H._spread,checked:null,children:[]}}function Q(){return{type:"paragraph",children:[]}}function ae(){return{type:"strong",children:[]}}function me(){return{type:"text",value:""}}function de(){return{type:"thematicBreak"}}}function gc(t){return{line:t.line,column:t.column,offset:t.offset}}function n6(t,e){let n=-1;for(;++n<e.length;){const i=e[n];Array.isArray(i)?n6(t,i):Bce(t,i)}}function Bce(t,e){let n;for(n in e)if(t6.call(e,n))switch(n){case"canContainEols":{const i=e[n];i&&t[n].push(...i);break}case"transforms":{const i=e[n];i&&t[n].push(...i);break}case"enter":case"exit":{const i=e[n];i&&Object.assign(t[n],i);break}}}function BD(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+wg({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+wg({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+wg({start:e.start,end:e.end})+") is still open")}function $ce(t){const e=this;e.parser=n;function n(i){return zce(i,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function Hce(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function Vce(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function jce(t,e){const n=e.value?e.value+`
`:"",i={};e.lang&&(i.className=["language-"+e.lang]);let r={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return e.meta&&(r.data={meta:e.meta}),t.patch(e,r),r=t.applyData(e,r),r={type:"element",tagName:"pre",properties:{},children:[r]},t.patch(e,r),r}function Wce(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function Gce(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function qce(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",i=String(e.identifier).toUpperCase(),r=fp(i.toLowerCase()),s=t.footnoteOrder.indexOf(i);let o,a=t.footnoteCounts.get(i);a===void 0?(a=0,t.footnoteOrder.push(i),o=t.footnoteOrder.length):o=s+1,a+=1,t.footnoteCounts.set(i,a);const c={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+r,id:n+"fnref-"+r+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,c);const l={type:"element",tagName:"sup",properties:{},children:[c]};return t.patch(e,l),t.applyData(e,l)}function Xce(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function Kce(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function i6(t,e){const n=e.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+i}];const r=t.all(e),s=r[0];s&&s.type==="text"?s.value="["+s.value:r.unshift({type:"text",value:"["});const o=r[r.length-1];return o&&o.type==="text"?o.value+=i:r.push({type:"text",value:i}),r}function Yce(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return i6(t,e);const r={src:fp(i.url||""),alt:e.alt};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"img",properties:r,children:[]};return t.patch(e,s),t.applyData(e,s)}function Jce(t,e){const n={src:fp(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,i),t.applyData(e,i)}function Qce(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,i),t.applyData(e,i)}function Zce(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return i6(t,e);const r={href:fp(i.url||"")};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"a",properties:r,children:t.all(e)};return t.patch(e,s),t.applyData(e,s)}function ele(t,e){const n={href:fp(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function tle(t,e,n){const i=t.all(e),r=n?nle(n):r6(e),s={},o=[];if(typeof e.checked=="boolean"){const u=i[0];let h;u&&u.type==="element"&&u.tagName==="p"?h=u:(h={type:"element",tagName:"p",properties:{},children:[]},i.unshift(h)),h.children.length>0&&h.children.unshift({type:"text",value:" "}),h.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let a=-1;for(;++a<i.length;){const u=i[a];(r||a!==0||u.type!=="element"||u.tagName!=="p")&&o.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!r?o.push(...u.children):o.push(u)}const c=i[i.length-1];c&&(r||c.type!=="element"||c.tagName!=="p")&&o.push({type:"text",value:`
`});const l={type:"element",tagName:"li",properties:s,children:o};return t.patch(e,l),t.applyData(e,l)}function nle(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let i=-1;for(;!e&&++i<n.length;)e=r6(n[i])}return e}function r6(t){const e=t.spread;return e??t.children.length>1}function ile(t,e){const n={},i=t.all(e);let r=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++r<i.length;){const o=i[r];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(i,!0)};return t.patch(e,s),t.applyData(e,s)}function rle(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function sle(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function ole(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function ale(t,e){const n=t.all(e),i=n.shift(),r=[];if(i){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([i],!0)};t.patch(e.children[0],o),r.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=dA(e.children[1]),c=z5(e.children[e.children.length-1]);a&&c&&(o.position={start:a,end:c}),r.push(o)}const s={type:"element",tagName:"table",properties:{},children:t.wrap(r,!0)};return t.patch(e,s),t.applyData(e,s)}function cle(t,e,n){const i=n?n.children:void 0,s=(i?i.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let c=-1;const l=[];for(;++c<a;){const h=e.children[c],d={},p=o?o[c]:void 0;p&&(d.align=p);let f={type:"element",tagName:s,properties:d,children:[]};h&&(f.children=t.all(h),t.patch(h,f),f=t.applyData(h,f)),l.push(f)}const u={type:"element",tagName:"tr",properties:{},children:t.wrap(l,!0)};return t.patch(e,u),t.applyData(e,u)}function lle(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const $D=9,HD=32;function ule(t){const e=String(t),n=/\r?\n|\r/g;let i=n.exec(e),r=0;const s=[];for(;i;)s.push(VD(e.slice(r,i.index),r>0,!0),i[0]),r=i.index+i[0].length,i=n.exec(e);return s.push(VD(e.slice(r),r>0,!1)),s.join("")}function VD(t,e,n){let i=0,r=t.length;if(e){let s=t.codePointAt(i);for(;s===$D||s===HD;)i++,s=t.codePointAt(i)}if(n){let s=t.codePointAt(r-1);for(;s===$D||s===HD;)r--,s=t.codePointAt(r-1)}return r>i?t.slice(i,r):""}function hle(t,e){const n={type:"text",value:ule(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function dle(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const ple={blockquote:Hce,break:Vce,code:jce,delete:Wce,emphasis:Gce,footnoteReference:qce,heading:Xce,html:Kce,imageReference:Yce,image:Jce,inlineCode:Qce,linkReference:Zce,link:ele,listItem:tle,list:ile,paragraph:rle,root:sle,strong:ole,table:ale,tableCell:lle,tableRow:cle,text:hle,thematicBreak:dle,toml:ey,yaml:ey,definition:ey,footnoteDefinition:ey};function ey(){}const s6=-1,rC=0,O1=1,F1=2,SA=3,xA=4,CA=5,_A=6,o6=7,a6=8,jD=typeof self=="object"?self:globalThis,fle=(t,e)=>{const n=(r,s)=>(t.set(s,r),r),i=r=>{if(t.has(r))return t.get(r);const[s,o]=e[r];switch(s){case rC:case s6:return n(o,r);case O1:{const a=n([],r);for(const c of o)a.push(i(c));return a}case F1:{const a=n({},r);for(const[c,l]of o)a[i(c)]=i(l);return a}case SA:return n(new Date(o),r);case xA:{const{source:a,flags:c}=o;return n(new RegExp(a,c),r)}case CA:{const a=n(new Map,r);for(const[c,l]of o)a.set(i(c),i(l));return a}case _A:{const a=n(new Set,r);for(const c of o)a.add(i(c));return a}case o6:{const{name:a,message:c}=o;return n(new jD[a](c),r)}case a6:return n(BigInt(o),r);case"BigInt":return n(Object(BigInt(o)),r)}return n(new jD[s](o),r)};return i},WD=t=>fle(new Map,t)(0),Ah="",{toString:mle}={},{keys:gle}=Object,Um=t=>{const e=typeof t;if(e!=="object"||!t)return[rC,e];const n=mle.call(t).slice(8,-1);switch(n){case"Array":return[O1,Ah];case"Object":return[F1,Ah];case"Date":return[SA,Ah];case"RegExp":return[xA,Ah];case"Map":return[CA,Ah];case"Set":return[_A,Ah]}return n.includes("Array")?[O1,n]:n.includes("Error")?[o6,n]:[F1,n]},ty=([t,e])=>t===rC&&(e==="function"||e==="symbol"),vle=(t,e,n,i)=>{const r=(o,a)=>{const c=i.push(o)-1;return n.set(a,c),c},s=o=>{if(n.has(o))return n.get(o);let[a,c]=Um(o);switch(a){case rC:{let u=o;switch(c){case"bigint":a=a6,u=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+c);u=null;break;case"undefined":return r([s6],o)}return r([a,u],o)}case O1:{if(c)return r([c,[...o]],o);const u=[],h=r([a,u],o);for(const d of o)u.push(s(d));return h}case F1:{if(c)switch(c){case"BigInt":return r([c,o.toString()],o);case"Boolean":case"Number":case"String":return r([c,o.valueOf()],o)}if(e&&"toJSON"in o)return s(o.toJSON());const u=[],h=r([a,u],o);for(const d of gle(o))(t||!ty(Um(o[d])))&&u.push([s(d),s(o[d])]);return h}case SA:return r([a,o.toISOString()],o);case xA:{const{source:u,flags:h}=o;return r([a,{source:u,flags:h}],o)}case CA:{const u=[],h=r([a,u],o);for(const[d,p]of o)(t||!(ty(Um(d))||ty(Um(p))))&&u.push([s(d),s(p)]);return h}case _A:{const u=[],h=r([a,u],o);for(const d of o)(t||!ty(Um(d)))&&u.push(s(d));return h}}const{message:l}=o;return r([a,{name:c,message:l}],o)};return s},GD=(t,{json:e,lossy:n}={})=>{const i=[];return vle(!(e||n),!!e,new Map,i)(t),i},z1=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?WD(GD(t,e)):structuredClone(t):(t,e)=>WD(GD(t,e));function yle(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function Sle(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function xle(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||yle,i=t.options.footnoteBackLabel||Sle,r=t.options.footnoteLabel||"Footnotes",s=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let c=-1;for(;++c<t.footnoteOrder.length;){const l=t.footnoteById.get(t.footnoteOrder[c]);if(!l)continue;const u=t.all(l),h=String(l.identifier).toUpperCase(),d=fp(h.toLowerCase());let p=0;const f=[],v=t.footnoteCounts.get(h);for(;v!==void 0&&++p<=v;){f.length>0&&f.push({type:"text",value:" "});let y=typeof n=="string"?n:n(c,p);typeof y=="string"&&(y={type:"text",value:y}),f.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+d+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(c,p),className:["data-footnote-backref"]},children:Array.isArray(y)?y:[y]})}const g=u[u.length-1];if(g&&g.type==="element"&&g.tagName==="p"){const y=g.children[g.children.length-1];y&&y.type==="text"?y.value+=" ":g.children.push({type:"text",value:" "}),g.children.push(...f)}else u.push(...f);const m={type:"element",tagName:"li",properties:{id:e+"fn-"+d},children:t.wrap(u,!0)};t.patch(l,m),a.push(m)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...z1(o),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const c6=function(t){if(t==null)return Ele;if(typeof t=="function")return sC(t);if(typeof t=="object")return Array.isArray(t)?Cle(t):_le(t);if(typeof t=="string")return wle(t);throw new Error("Expected function, string, or object as test")};function Cle(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=c6(t[n]);return sC(i);function i(...r){let s=-1;for(;++s<e.length;)if(e[s].apply(this,r))return!0;return!1}}function _le(t){const e=t;return sC(n);function n(i){const r=i;let s;for(s in t)if(r[s]!==e[s])return!1;return!0}}function wle(t){return sC(e);function e(n){return n&&n.type===t}}function sC(t){return e;function e(n,i,r){return!!(Rle(n)&&t.call(this,n,typeof i=="number"?i:void 0,r||void 0))}}function Ele(){return!0}function Rle(t){return t!==null&&typeof t=="object"&&"type"in t}const l6=[],ble=!0,qD=!1,Tle="skip";function Ale(t,e,n,i){let r;typeof e=="function"&&typeof n!="function"?(i=n,n=e):r=e;const s=c6(r),o=i?-1:1;a(t,void 0,[])();function a(c,l,u){const h=c&&typeof c=="object"?c:{};if(typeof h.type=="string"){const p=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(d,"name",{value:"node ("+(c.type+(p?"<"+p+">":""))+")"})}return d;function d(){let p=l6,f,v,g;if((!e||s(c,l,u[u.length-1]||void 0))&&(p=Ple(n(c,u)),p[0]===qD))return p;if("children"in c&&c.children){const m=c;if(m.children&&p[0]!==Tle)for(v=(i?m.children.length:-1)+o,g=u.concat(m);v>-1&&v<m.children.length;){const y=m.children[v];if(f=a(y,v,g)(),f[0]===qD)return f;v=typeof f[1]=="number"?f[1]:v+o}}return p}}}function Ple(t){return Array.isArray(t)?t:typeof t=="number"?[ble,t]:t==null?l6:[t]}function u6(t,e,n,i){let r,s,o;typeof e=="function"&&typeof n!="function"?(s=void 0,o=e,r=n):(s=e,o=n,r=i),Ale(t,s,a,r);function a(c,l){const u=l[l.length-1],h=u?u.children.indexOf(c):void 0;return o(c,h,u)}}const vb={}.hasOwnProperty,Ile={};function Mle(t,e){const n=e||Ile,i=new Map,r=new Map,s=new Map,o={...ple,...n.handlers},a={all:l,applyData:Lle,definitionById:i,footnoteById:r,footnoteCounts:s,footnoteOrder:[],handlers:o,one:c,options:n,patch:kle,wrap:Nle};return u6(t,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){const h=u.type==="definition"?i:r,d=String(u.identifier).toUpperCase();h.has(d)||h.set(d,u)}}),a;function c(u,h){const d=u.type,p=a.handlers[d];if(vb.call(a.handlers,d)&&p)return p(a,u,h);if(a.options.passThrough&&a.options.passThrough.includes(d)){if("children"in u){const{children:v,...g}=u,m=z1(g);return m.children=a.all(u),m}return z1(u)}return(a.options.unknownHandler||Dle)(a,u,h)}function l(u){const h=[];if("children"in u){const d=u.children;let p=-1;for(;++p<d.length;){const f=a.one(d[p],u);if(f){if(p&&d[p-1].type==="break"&&(!Array.isArray(f)&&f.type==="text"&&(f.value=XD(f.value)),!Array.isArray(f)&&f.type==="element")){const v=f.children[0];v&&v.type==="text"&&(v.value=XD(v.value))}Array.isArray(f)?h.push(...f):h.push(f)}}}return h}}function kle(t,e){t.position&&(e.position=poe(t))}function Lle(t,e){let n=e;if(t&&t.data){const i=t.data.hName,r=t.data.hChildren,s=t.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const o="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:o}}n.type==="element"&&s&&Object.assign(n.properties,z1(s)),"children"in n&&n.children&&r!==null&&r!==void 0&&(n.children=r)}return n}function Dle(t,e){const n=e.data||{},i="value"in e&&!(vb.call(n,"hProperties")||vb.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function Nle(t,e){const n=[];let i=-1;for(e&&n.push({type:"text",value:`
`});++i<t.length;)i&&n.push({type:"text",value:`
`}),n.push(t[i]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function XD(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function KD(t,e){const n=Mle(t,e),i=n.one(t,void 0),r=xle(n),s=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return r&&s.children.push({type:"text",value:`
`},r),s}function Ole(t,e){return t&&"run"in t?async function(n,i){const r=KD(n,{file:i,...e});await t.run(r,i)}:function(n,i){return KD(n,{file:i,...t||e})}}function YD(t){if(t)throw t}var $y=Object.prototype.hasOwnProperty,h6=Object.prototype.toString,JD=Object.defineProperty,QD=Object.getOwnPropertyDescriptor,ZD=function(e){return typeof Array.isArray=="function"?Array.isArray(e):h6.call(e)==="[object Array]"},eN=function(e){if(!e||h6.call(e)!=="[object Object]")return!1;var n=$y.call(e,"constructor"),i=e.constructor&&e.constructor.prototype&&$y.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!i)return!1;var r;for(r in e);return typeof r>"u"||$y.call(e,r)},tN=function(e,n){JD&&n.name==="__proto__"?JD(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},nN=function(e,n){if(n==="__proto__")if($y.call(e,n)){if(QD)return QD(e,n).value}else return;return e[n]},Fle=function t(){var e,n,i,r,s,o,a=arguments[0],c=1,l=arguments.length,u=!1;for(typeof a=="boolean"&&(u=a,a=arguments[1]||{},c=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});c<l;++c)if(e=arguments[c],e!=null)for(n in e)i=nN(a,n),r=nN(e,n),a!==r&&(u&&r&&(eN(r)||(s=ZD(r)))?(s?(s=!1,o=i&&ZD(i)?i:[]):o=i&&eN(i)?i:{},tN(a,{name:n,newValue:t(u,o,r)})):typeof r<"u"&&tN(a,{name:n,newValue:r}));return a};const Uw=vS(Fle);function yb(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function zle(){const t=[],e={run:n,use:i};return e;function n(...r){let s=-1;const o=r.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...r);function a(c,...l){const u=t[++s];let h=-1;if(c){o(c);return}for(;++h<r.length;)(l[h]===null||l[h]===void 0)&&(l[h]=r[h]);r=l,u?Ule(u,a)(...l):o(null,...l)}}function i(r){if(typeof r!="function")throw new TypeError("Expected `middelware` to be a function, not "+r);return t.push(r),e}}function Ule(t,e){let n;return i;function i(...o){const a=t.length>o.length;let c;a&&o.push(r);try{c=t.apply(this,o)}catch(l){const u=l;if(a&&n)throw u;return r(u)}a||(c&&c.then&&typeof c.then=="function"?c.then(s,r):c instanceof Error?r(c):s(c))}function r(o,...a){n||(n=!0,e(o,...a))}function s(o){r(null,o)}}const Xo={basename:Ble,dirname:$le,extname:Hle,join:Vle,sep:"/"};function Ble(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');U0(t);let n=0,i=-1,r=t.length,s;if(e===void 0||e.length===0||e.length>t.length){for(;r--;)if(t.codePointAt(r)===47){if(s){n=r+1;break}}else i<0&&(s=!0,i=r+1);return i<0?"":t.slice(n,i)}if(e===t)return"";let o=-1,a=e.length-1;for(;r--;)if(t.codePointAt(r)===47){if(s){n=r+1;break}}else o<0&&(s=!0,o=r+1),a>-1&&(t.codePointAt(r)===e.codePointAt(a--)?a<0&&(i=r):(a=-1,i=o));return n===i?i=o:i<0&&(i=t.length),t.slice(n,i)}function $le(t){if(U0(t),t.length===0)return".";let e=-1,n=t.length,i;for(;--n;)if(t.codePointAt(n)===47){if(i){e=n;break}}else i||(i=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function Hle(t){U0(t);let e=t.length,n=-1,i=0,r=-1,s=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){i=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?r<0?r=e:s!==1&&(s=1):r>-1&&(s=-1)}return r<0||n<0||s===0||s===1&&r===n-1&&r===i+1?"":t.slice(r,n)}function Vle(...t){let e=-1,n;for(;++e<t.length;)U0(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":jle(n)}function jle(t){U0(t);const e=t.codePointAt(0)===47;let n=Wle(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function Wle(t,e){let n="",i=0,r=-1,s=0,o=-1,a,c;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||s===1))if(r!==o-1&&s===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(c=n.lastIndexOf("/"),c!==n.length-1){c<0?(n="",i=0):(n=n.slice(0,c),i=n.length-1-n.lastIndexOf("/")),r=o,s=0;continue}}else if(n.length>0){n="",i=0,r=o,s=0;continue}}e&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+t.slice(r+1,o):n=t.slice(r+1,o),i=o-r-1;r=o,s=0}else a===46&&s>-1?s++:s=-1}return n}function U0(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const Gle={cwd:qle};function qle(){return"/"}function Sb(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function Xle(t){if(typeof t=="string")t=new URL(t);else if(!Sb(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return Kle(t)}function Kle(t){if(t.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const i=e.codePointAt(n+2);if(i===70||i===102){const r=new TypeError("File URL path must not include encoded / characters");throw r.code="ERR_INVALID_FILE_URL_PATH",r}}return decodeURIComponent(e)}const Bw=["history","path","basename","stem","extname","dirname"];class d6{constructor(e){let n;e?Sb(e)?n={path:e}:typeof e=="string"||Yle(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":Gle.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<Bw.length;){const s=Bw[i];s in n&&n[s]!==void 0&&n[s]!==null&&(this[s]=s==="history"?[...n[s]]:n[s])}let r;for(r in n)Bw.includes(r)||(this[r]=n[r])}get basename(){return typeof this.path=="string"?Xo.basename(this.path):void 0}set basename(e){Hw(e,"basename"),$w(e,"basename"),this.path=Xo.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Xo.dirname(this.path):void 0}set dirname(e){iN(this.basename,"dirname"),this.path=Xo.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Xo.extname(this.path):void 0}set extname(e){if($w(e,"extname"),iN(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Xo.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){Sb(e)&&(e=Xle(e)),Hw(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Xo.basename(this.path,this.extname):void 0}set stem(e){Hw(e,"stem"),$w(e,"stem"),this.path=Xo.join(this.dirname||"",e+(this.extname||""))}fail(e,n,i){const r=this.message(e,n,i);throw r.fatal=!0,r}info(e,n,i){const r=this.message(e,n,i);return r.fatal=void 0,r}message(e,n,i){const r=new gr(e,n,i);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function $w(t,e){if(t&&t.includes(Xo.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Xo.sep+"`")}function Hw(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function iN(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Yle(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const Jle=function(t){const i=this.constructor.prototype,r=i[t],s=function(){return r.apply(s,arguments)};return Object.setPrototypeOf(s,i),s},Qle={}.hasOwnProperty;class wA extends Jle{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=zle()}copy(){const e=new wA;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];e.use(...i)}return e.data(Uw(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Ww("data",this.frozen),this.namespace[e]=n,this):Qle.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Ww("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const r=n.call(e,...i);typeof r=="function"&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=ny(e),i=this.parser||this.Parser;return Vw("parse",i),i(String(n),n)}process(e,n){const i=this;return this.freeze(),Vw("process",this.parser||this.Parser),jw("process",this.compiler||this.Compiler),n?r(void 0,n):new Promise(r);function r(s,o){const a=ny(e),c=i.parse(a);i.run(c,a,function(u,h,d){if(u||!h||!d)return l(u);const p=h,f=i.stringify(p,d);tue(f)?d.value=f:d.result=f,l(u,d)});function l(u,h){u||!h?o(u):s?s(h):n(void 0,h)}}}processSync(e){let n=!1,i;return this.freeze(),Vw("processSync",this.parser||this.Parser),jw("processSync",this.compiler||this.Compiler),this.process(e,r),sN("processSync","process",n),i;function r(s,o){n=!0,YD(s),i=o}}run(e,n,i){rN(e),this.freeze();const r=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?s(void 0,i):new Promise(s);function s(o,a){const c=ny(n);r.run(e,c,l);function l(u,h,d){const p=h||e;u?a(u):o?o(p):i(void 0,p,d)}}}runSync(e,n){let i=!1,r;return this.run(e,n,s),sN("runSync","run",i),r;function s(o,a){YD(o),r=a,i=!0}}stringify(e,n){this.freeze();const i=ny(n),r=this.compiler||this.Compiler;return jw("stringify",r),rN(e),r(e,i)}use(e,...n){const i=this.attachers,r=this.namespace;if(Ww("use",this.frozen),e!=null)if(typeof e=="function")c(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(l){if(typeof l=="function")c(l,[]);else if(typeof l=="object")if(Array.isArray(l)){const[u,...h]=l;c(u,h)}else o(l);else throw new TypeError("Expected usable value, not `"+l+"`")}function o(l){if(!("plugins"in l)&&!("settings"in l))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(l.plugins),l.settings&&(r.settings=Uw(!0,r.settings,l.settings))}function a(l){let u=-1;if(l!=null)if(Array.isArray(l))for(;++u<l.length;){const h=l[u];s(h)}else throw new TypeError("Expected a list of plugins, not `"+l+"`")}function c(l,u){let h=-1,d=-1;for(;++h<i.length;)if(i[h][0]===l){d=h;break}if(d===-1)i.push([l,...u]);else if(u.length>0){let[p,...f]=u;const v=i[d][1];yb(v)&&yb(p)&&(p=Uw(!0,v,p)),i[d]=[l,p,...f]}}}}const Zle=new wA().freeze();function Vw(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function jw(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Ww(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function rN(t){if(!yb(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function sN(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function ny(t){return eue(t)?t:new d6(t)}function eue(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function tue(t){return typeof t=="string"||nue(t)}function nue(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const iue="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",oN=[],aN={allowDangerousHtml:!0},rue=/^(https?|ircs?|mailto|xmpp)$/i,sue=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function oue(t){const e=t.allowedElements,n=t.allowElement,i=t.children||"",r=t.className,s=t.components,o=t.disallowedElements,a=t.rehypePlugins||oN,c=t.remarkPlugins||oN,l=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...aN}:aN,u=t.skipHtml,h=t.unwrapDisallowed,d=t.urlTransform||aue,p=Zle().use($ce).use(c).use(Ole,l).use(a),f=new d6;typeof i=="string"&&(f.value=i);for(const y of sue)Object.hasOwn(t,y.from)&&(""+y.from+(y.to?"use `"+y.to+"` instead":"remove it")+iue+y.id,void 0);const v=p.parse(f);let g=p.runSync(v,f);return r&&(g={type:"element",tagName:"div",properties:{className:r},children:g.type==="root"?g.children:[g]}),u6(g,m),Soe(g,{Fragment:ce.Fragment,components:s,ignoreInvalidStyle:!0,jsx:ce.jsx,jsxs:ce.jsxs,passKeys:!0,passNode:!0});function m(y,S,x){if(y.type==="raw"&&x&&typeof S=="number")return u?x.children.splice(S,1):x.children[S]={type:"text",value:y.value},S;if(y.type==="element"){let w;for(w in Ow)if(Object.hasOwn(Ow,w)&&Object.hasOwn(y.properties,w)){const C=y.properties[w],E=Ow[w];(E===null||E.includes(y.tagName))&&(y.properties[w]=d(String(C||""),w,y))}}if(y.type==="element"){let w=e?!e.includes(y.tagName):o?o.includes(y.tagName):!1;if(!w&&n&&typeof S=="number"&&(w=!n(y,S,x)),w&&x&&typeof S=="number")return h&&y.children?x.children.splice(S,1,...y.children):x.children.splice(S,1),S}}}function aue(t){const e=t.indexOf(":"),n=t.indexOf("?"),i=t.indexOf("#"),r=t.indexOf("/");return e<0||r>-1&&e>r||n>-1&&e>n||i>-1&&e>i||rue.test(t.slice(0,e))?t:""}class cue{constructor({interimResults:e=!1,baseUrl:n,apiKey:i,silenceThreshold:r=15,silenceDetectionTime:s=3e3}={}){this.onstart=null,this.onend=null,this.onresult=null,this.onerror=null,this.interimResults=e,this.mediaRecorder=null,this.recordedChunks=[],this.isRecording=!1,this.audioContext=null,this.silenceTimeout=null,this.silenceDetectionTime=s,this.baseUrl=n,this.apiKey=i,this.silenceThreshold=r}async start(){if(!this.isRecording){this.recordedChunks=[],this.isRecording=!0;try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(e),this.audioContext=new(window.AudioContext||window.webkitAudioContext);const n=this.audioContext.createMediaStreamSource(e),i=this.audioContext.createAnalyser();i.fftSize=512,n.connect(i),this.detectSilence(i),this.mediaRecorder.onstart=()=>{typeof this.onstart=="function"&&this.onstart()},this.mediaRecorder.ondataavailable=r=>{r.data.size>0&&this.recordedChunks.push(r.data)},this.mediaRecorder.onstop=async()=>{this.isRecording=!1;try{const r=new Blob(this.recordedChunks,{type:"audio/webm"}),s=await this.convertToWav(r),o=await this.sendToSpeechAPI(s);typeof this.onresult=="function"&&this.onresult({transcript:o,audioBlob:s})}catch(r){typeof this.onerror=="function"&&this.onerror(r)}typeof this.onend=="function"&&this.onend()},this.mediaRecorder.start()}catch(e){typeof this.onerror=="function"&&this.onerror(e)}}}stop(){this.isRecording&&this.mediaRecorder&&this.mediaRecorder.stop(),clearTimeout(this.silenceTimeout),this.silenceTimeout=null}abort(){this.isRecording&&this.mediaRecorder&&(this.mediaRecorder.stop(),typeof this.onend=="function"&&this.onend(),clearTimeout(this.silenceTimeout))}detectSilence(e){const n=new Uint8Array(e.fftSize),i=()=>{e.getByteFrequencyData(n);const r=n.reduce((s,o)=>s+o,0)/n.length;console.debug(`debug: volume = ${r}`),r<this.silenceThreshold?this.silenceTimeout||(this.silenceTimeout=setTimeout(()=>{this.stop()},this.silenceDetectionTime)):(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.isRecording&&requestAnimationFrame(i)};requestAnimationFrame(i)}async convertToWav(e){return new Promise((n,i)=>{const r=new FileReader;r.onload=s=>{const o=s.target.result;new AudioContext().decodeAudioData(o,c=>{const l=this.audioBufferToWav(c);n(l)},i)},r.onerror=i,r.readAsArrayBuffer(e)})}audioBufferToWav(e){let n=e.numberOfChannels,i=e.length*n*2+44,r=new DataView(new ArrayBuffer(i)),s=[],o=0,a=0;this.writeString(r,a,"RIFF"),a+=4,r.setUint32(a,i-8,!0),a+=4,this.writeString(r,a,"WAVE"),a+=4,this.writeString(r,a,"fmt "),a+=4,r.setUint32(a,16,!0),a+=4,r.setUint16(a,1,!0),a+=2,r.setUint16(a,n,!0),a+=2,r.setUint32(a,e.sampleRate,!0),a+=4,r.setUint32(a,e.sampleRate*2*n,!0),a+=4,r.setUint16(a,n*2,!0),a+=2,r.setUint16(a,16,!0),a+=2,this.writeString(r,a,"data"),a+=4,r.setUint32(a,i-a-4,!0),a+=4;for(let c=0;c<e.numberOfChannels;c++)s.push(e.getChannelData(c));for(;a<i;){for(let c=0;c<n;c++)r.setInt16(a,s[c][o]*32767,!0),a+=2;o++}return new Blob([r],{type:"audio/wav"})}writeString(e,n,i){for(let r=0;r<i.length;r++)e.setUint8(n+r,i.charCodeAt(r))}async sendToSpeechAPI(e){const n=`${this.baseUrl}/stt`,i=await fetch(n,{method:"POST",headers:{"x-api-key":this.apiKey},body:e});if(!i.ok){const s=await i.text();throw new Error(`API request failed with status: ${i.status}, message: ${s}`)}const r=await i.json();return r.NBest&&r.NBest.length>0?r.NBest[0].Display:"No speech recognized."}}const xb=yT.forwardRef(({className:t,variant:e="default",...n},i)=>ce.jsx("button",{className:`px-4 py-2 rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 ${e==="default"?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-destructive text-destructive-foreground hover:bg-destructive/90"} ${t}`,ref:i,...n}));xb.displayName="Button";const p6=yT.forwardRef(({className:t,...e},n)=>ce.jsx("input",{className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${t}`,ref:n,...e}));p6.displayName="Input";function lue(){const[t,e]=re.useState(""),[n,i]=re.useState([]),[r,s]=re.useState(!1),o=re.useRef(null),a=re.useRef(null);re.useEffect(()=>{o.current=new cue({interimResults:!1,baseUrl:"https://api.zzcreation.com/web",apiKey:"0f4404a5f9f56",silenceDetectionTime:1500}),o.current.onresult=d=>{d.transcript.trim()&&(i(p=>[...p,{type:"user",content:d.transcript}]),c(d.transcript))},o.current.onend=()=>{s(!1)}},[]);const c=d=>{const v=btoa("zzc-test:123456");fetch("https://app.zzcreation.com/draw/generate-image/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${v}`},body:JSON.stringify({prompt:d,session_id:"4"})}).then(g=>g.json()).then(g=>{var m;i(y=>[...y,{type:"avatar",content:g.answer}]),(m=a.current)==null||m.speak(g.answer.replace(/https?:\/\/\S+/g,"").trim())}).catch(g=>{console.error("Error:",g),i(m=>[...m,{type:"avatar",content:"Sorry, I couldn't generate an image."}])})},l=()=>{t.trim()&&(i(d=>[...d,{type:"user",content:t}]),c(t),e(""))},u=()=>{var d,p;r?(d=o.current)==null||d.stop():(p=o.current)==null||p.start(),s(!r)},h=re.useMemo(()=>n.map((d,p)=>ce.jsx("div",{className:`flex ${d.type==="user"?"justify-end":"justify-start"}`,children:ce.jsx("div",{className:`rounded-lg p-2 max-w-xs ${d.type==="user"?"bg-blue-500 text-white":"bg-white"}`,children:ce.jsx(oue,{children:d.content,components:{img:({node:f,...v})=>ce.jsx("img",{className:"max-w-full h-auto rounded-lg",...v})}})})},p)),[n]);return ce.jsxs("div",{className:"flex flex-row h-screen bg-gray-100",children:[ce.jsx("div",{className:"w-3/5 flex justify-center items-center bg-gray-500",children:ce.jsx(Lse,{ref:a})}),ce.jsxs("div",{className:"w-2/5 flex flex-col justify-center",children:[ce.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:h}),ce.jsx("div",{className:"p-4 bg-white border-t",children:ce.jsxs("div",{className:"flex space-x-2",children:[ce.jsx(p6,{value:t,onChange:d=>e(d.target.value),onKeyDown:d=>{d.key==="Enter"&&l()},placeholder:"",className:"flex-1"}),ce.jsxs(xb,{onClick:l,children:[ce.jsx(iW,{className:"w-4 h-4"}),ce.jsx("span",{className:"sr-only",children:"Send"})]}),ce.jsxs(xb,{onClick:u,variant:r?"destructive":"default",children:[ce.jsx(nW,{className:"w-4 h-4"}),ce.jsx("span",{className:"sr-only",children:"Toggle speech recognition"})]})]})})]})]})}/**
 * @remix-run/router v1.21.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dn(){return Dn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Dn.apply(this,arguments)}var ci;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ci||(ci={}));const cN="popstate";function uue(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return o0("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:B0(r)}return due(e,n,null,t)}function Wt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ud(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function hue(){return Math.random().toString(36).substr(2,8)}function lN(t,e){return{usr:t.state,key:t.key,idx:e}}function o0(t,e,n,i){return n===void 0&&(n=null),Dn({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?wl(e):e,{state:n,key:e&&e.key||i||hue()})}function B0(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function wl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function due(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=ci.Pop,c=null,l=u();l==null&&(l=0,o.replaceState(Dn({},o.state,{idx:l}),""));function u(){return(o.state||{idx:null}).idx}function h(){a=ci.Pop;let g=u(),m=g==null?null:g-l;l=g,c&&c({action:a,location:v.location,delta:m})}function d(g,m){a=ci.Push;let y=o0(v.location,g,m);l=u()+1;let S=lN(y,l),x=v.createHref(y);try{o.pushState(S,"",x)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;r.location.assign(x)}s&&c&&c({action:a,location:v.location,delta:1})}function p(g,m){a=ci.Replace;let y=o0(v.location,g,m);l=u();let S=lN(y,l),x=v.createHref(y);o.replaceState(S,"",x),s&&c&&c({action:a,location:v.location,delta:0})}function f(g){let m=r.location.origin!=="null"?r.location.origin:r.location.href,y=typeof g=="string"?g:B0(g);return y=y.replace(/ $/,"%20"),Wt(m,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,m)}let v={get action(){return a},get location(){return t(r,o)},listen(g){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(cN,h),c=g,()=>{r.removeEventListener(cN,h),c=null}},createHref(g){return e(r,g)},createURL:f,encodeLocation(g){let m=f(g);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:d,replace:p,go(g){return o.go(g)}};return v}var pn;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(pn||(pn={}));const pue=new Set(["lazy","caseSensitive","path","id","index","children"]);function fue(t){return t.index===!0}function U1(t,e,n,i){return n===void 0&&(n=[]),i===void 0&&(i={}),t.map((r,s)=>{let o=[...n,String(s)],a=typeof r.id=="string"?r.id:o.join("-");if(Wt(r.index!==!0||!r.children,"Cannot specify children on an index route"),Wt(!i[a],'Found a route id collision on id "'+a+`".  Route id's must be globally unique within Data Router usages`),fue(r)){let c=Dn({},r,e(r),{id:a});return i[a]=c,c}else{let c=Dn({},r,e(r),{id:a,children:void 0});return i[a]=c,r.children&&(c.children=U1(r.children,e,o,i)),c}})}function ru(t,e,n){return n===void 0&&(n="/"),Hy(t,e,n,!1)}function Hy(t,e,n,i){let r=typeof e=="string"?wl(e):e,s=$0(r.pathname||"/",n);if(s==null)return null;let o=f6(t);gue(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let l=Tue(s);a=Rue(o[c],l,i)}return a}function mue(t,e){let{route:n,pathname:i,params:r}=t;return{id:n.id,pathname:i,params:r,data:e[n.id],handle:n.handle}}function f6(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let c={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(Wt(c.relativePath.startsWith(i),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(i.length));let l=Jc([i,c.relativePath]),u=n.concat(c);s.children&&s.children.length>0&&(Wt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),f6(s.children,e,u,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:wue(l,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let c of m6(s.path))r(s,o,c)}),e}function m6(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=m6(i.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),r&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function gue(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Eue(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const vue=/^:[\w-]+$/,yue=3,Sue=2,xue=1,Cue=10,_ue=-2,uN=t=>t==="*";function wue(t,e){let n=t.split("/"),i=n.length;return n.some(uN)&&(i+=_ue),e&&(i+=Sue),n.filter(r=>!uN(r)).reduce((r,s)=>r+(vue.test(s)?yue:s===""?xue:Cue),i)}function Eue(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function Rue(t,e,n){n===void 0&&(n=!1);let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let c=i[a],l=a===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",h=hN({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},u),d=c.route;if(!h&&l&&n&&!i[i.length-1].route.index&&(h=hN({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!h)return null;Object.assign(r,h.params),o.push({params:r,pathname:Jc([s,h.pathname]),pathnameBase:Iue(Jc([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=Jc([s,h.pathnameBase]))}return o}function hN(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=bue(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((l,u,h)=>{let{paramName:d,isOptional:p}=u;if(d==="*"){let v=a[h]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const f=a[h];return p&&!f?l[d]=void 0:l[d]=(f||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:t}}function bue(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Ud(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(i.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function Tue(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ud(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function $0(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function Aue(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?wl(t):t;return{pathname:n?n.startsWith("/")?n:Pue(n,e):e,search:Mue(i),hash:kue(r)}}function Pue(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Gw(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function g6(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function v6(t,e){let n=g6(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function y6(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=wl(t):(r=Dn({},t),Wt(!r.pathname||!r.pathname.includes("?"),Gw("?","pathname","search",r)),Wt(!r.pathname||!r.pathname.includes("#"),Gw("#","pathname","hash",r)),Wt(!r.search||!r.search.includes("#"),Gw("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!i&&o.startsWith("..")){let d=o.split("/");for(;d[0]==="..";)d.shift(),h-=1;r.pathname=d.join("/")}a=h>=0?e[h]:"/"}let c=Aue(r,a),l=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(l||u)&&(c.pathname+="/"),c}const Jc=t=>t.join("/").replace(/\/\/+/g,"/"),Iue=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Mue=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,kue=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;class B1{constructor(e,n,i,r){r===void 0&&(r=!1),this.status=e,this.statusText=n||"",this.internal=r,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}}function oC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const S6=["post","put","patch","delete"],Lue=new Set(S6),Due=["get",...S6],Nue=new Set(Due),Oue=new Set([301,302,303,307,308]),Fue=new Set([307,308]),qw={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},zue={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Bm={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},EA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Uue=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),x6="remix-router-transitions";function Bue(t){const e=t.window?t.window:typeof window<"u"?window:void 0,n=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",i=!n;Wt(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let r;if(t.mapRouteProperties)r=t.mapRouteProperties;else if(t.detectErrorBoundary){let F=t.detectErrorBoundary;r=W=>({hasErrorBoundary:F(W)})}else r=Uue;let s={},o=U1(t.routes,r,void 0,s),a,c=t.basename||"/",l=t.dataStrategy||jue,u=t.patchRoutesOnNavigation,h=Dn({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},t.future),d=null,p=new Set,f=null,v=null,g=null,m=t.hydrationData!=null,y=ru(o,t.history.location,c),S=null;if(y==null&&!u){let F=Ur(404,{pathname:t.history.location.pathname}),{matches:W,route:ie}=_N(o);y=W,S={[ie.id]:F}}y&&!t.hydrationData&&Qn(y,o,t.history.location.pathname).active&&(y=null);let x;if(y)if(y.some(F=>F.route.lazy))x=!1;else if(!y.some(F=>F.route.loader))x=!0;else if(h.v7_partialHydration){let F=t.hydrationData?t.hydrationData.loaderData:null,W=t.hydrationData?t.hydrationData.errors:null;if(W){let ie=y.findIndex(fe=>W[fe.route.id]!==void 0);x=y.slice(0,ie+1).every(fe=>!_b(fe.route,F,W))}else x=y.every(ie=>!_b(ie.route,F,W))}else x=t.hydrationData!=null;else if(x=!1,y=[],h.v7_partialHydration){let F=Qn(null,o,t.history.location.pathname);F.active&&F.matches&&(y=F.matches)}let w,C={historyAction:t.history.action,location:t.history.location,matches:y,initialized:x,navigation:qw,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||S,fetchers:new Map,blockers:new Map},E=ci.Pop,b=!1,M,_=!1,R=new Map,L=null,O=!1,V=!1,X=[],G=new Set,J=new Map,D=0,ne=-1,P=new Map,ee=new Set,ge=new Map,I=new Map,$=new Set,K=new Map,oe=new Map,he;function ze(){if(d=t.history.listen(F=>{let{action:W,location:ie,delta:fe}=F;if(he){he(),he=void 0;return}Ud(oe.size===0||fe!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Oe=De({currentLocation:C.location,nextLocation:ie,historyAction:W});if(Oe&&fe!=null){let tt=new Promise(ut=>{he=ut});t.history.go(fe*-1),B(Oe,{state:"blocked",location:ie,proceed(){B(Oe,{state:"proceeding",proceed:void 0,reset:void 0,location:ie}),tt.then(()=>t.history.go(fe))},reset(){let ut=new Map(C.blockers);ut.set(Oe,Bm),it({blockers:ut})}});return}return xt(W,ie)}),n){rhe(e,R);let F=()=>she(e,R);e.addEventListener("pagehide",F),L=()=>e.removeEventListener("pagehide",F)}return C.initialized||xt(ci.Pop,C.location,{initialHydration:!0}),w}function Me(){d&&d(),L&&L(),p.clear(),M&&M.abort(),C.fetchers.forEach((F,W)=>ue(W)),C.blockers.forEach((F,W)=>Dt(W))}function dt(F){return p.add(F),()=>p.delete(F)}function it(F,W){W===void 0&&(W={}),C=Dn({},C,F);let ie=[],fe=[];h.v7_fetcherPersist&&C.fetchers.forEach((Oe,tt)=>{Oe.state==="idle"&&($.has(tt)?fe.push(tt):ie.push(tt))}),[...p].forEach(Oe=>Oe(C,{deletedFetchers:fe,viewTransitionOpts:W.viewTransitionOpts,flushSync:W.flushSync===!0})),h.v7_fetcherPersist&&(ie.forEach(Oe=>C.fetchers.delete(Oe)),fe.forEach(Oe=>ue(Oe)))}function St(F,W,ie){var fe,Oe;let{flushSync:tt}=ie===void 0?{}:ie,ut=C.actionData!=null&&C.navigation.formMethod!=null&&go(C.navigation.formMethod)&&C.navigation.state==="loading"&&((fe=F.state)==null?void 0:fe._isRedirect)!==!0,Be;W.actionData?Object.keys(W.actionData).length>0?Be=W.actionData:Be=null:ut?Be=C.actionData:Be=null;let Ue=W.loaderData?xN(C.loaderData,W.loaderData,W.matches||[],W.errors):C.loaderData,Fe=C.blockers;Fe.size>0&&(Fe=new Map(Fe),Fe.forEach((Vt,pi)=>Fe.set(pi,Bm)));let rt=b===!0||C.navigation.formMethod!=null&&go(C.navigation.formMethod)&&((Oe=F.state)==null?void 0:Oe._isRedirect)!==!0;a&&(o=a,a=void 0),O||E===ci.Pop||(E===ci.Push?t.history.push(F,F.state):E===ci.Replace&&t.history.replace(F,F.state));let Ot;if(E===ci.Pop){let Vt=R.get(C.location.pathname);Vt&&Vt.has(F.pathname)?Ot={currentLocation:C.location,nextLocation:F}:R.has(F.pathname)&&(Ot={currentLocation:F,nextLocation:C.location})}else if(_){let Vt=R.get(C.location.pathname);Vt?Vt.add(F.pathname):(Vt=new Set([F.pathname]),R.set(C.location.pathname,Vt)),Ot={currentLocation:C.location,nextLocation:F}}it(Dn({},W,{actionData:Be,loaderData:Ue,historyAction:E,location:F,initialized:!0,navigation:qw,revalidation:"idle",restoreScrollPosition:Tn(F,W.matches||C.matches),preventScrollReset:rt,blockers:Fe}),{viewTransitionOpts:Ot,flushSync:tt===!0}),E=ci.Pop,b=!1,_=!1,O=!1,V=!1,X=[]}async function U(F,W){if(typeof F=="number"){t.history.go(F);return}let ie=Cb(C.location,C.matches,c,h.v7_prependBasename,F,h.v7_relativeSplatPath,W==null?void 0:W.fromRouteId,W==null?void 0:W.relative),{path:fe,submission:Oe,error:tt}=dN(h.v7_normalizeFormMethod,!1,ie,W),ut=C.location,Be=o0(C.location,fe,W&&W.state);Be=Dn({},Be,t.history.encodeLocation(Be));let Ue=W&&W.replace!=null?W.replace:void 0,Fe=ci.Push;Ue===!0?Fe=ci.Replace:Ue===!1||Oe!=null&&go(Oe.formMethod)&&Oe.formAction===C.location.pathname+C.location.search&&(Fe=ci.Replace);let rt=W&&"preventScrollReset"in W?W.preventScrollReset===!0:void 0,Ot=(W&&W.flushSync)===!0,Vt=De({currentLocation:ut,nextLocation:Be,historyAction:Fe});if(Vt){B(Vt,{state:"blocked",location:Be,proceed(){B(Vt,{state:"proceeding",proceed:void 0,reset:void 0,location:Be}),U(F,W)},reset(){let pi=new Map(C.blockers);pi.set(Vt,Bm),it({blockers:pi})}});return}return await xt(Fe,Be,{submission:Oe,pendingError:tt,preventScrollReset:rt,replace:W&&W.replace,enableViewTransition:W&&W.viewTransition,flushSync:Ot})}function di(){if(H(),it({revalidation:"loading"}),C.navigation.state!=="submitting"){if(C.navigation.state==="idle"){xt(C.historyAction,C.location,{startUninterruptedRevalidation:!0});return}xt(E||C.historyAction,C.navigation.location,{overrideNavigation:C.navigation,enableViewTransition:_===!0})}}async function xt(F,W,ie){M&&M.abort(),M=null,E=F,O=(ie&&ie.startUninterruptedRevalidation)===!0,Ft(C.location,C.matches),b=(ie&&ie.preventScrollReset)===!0,_=(ie&&ie.enableViewTransition)===!0;let fe=a||o,Oe=ie&&ie.overrideNavigation,tt=ru(fe,W,c),ut=(ie&&ie.flushSync)===!0,Be=Qn(tt,fe,W.pathname);if(Be.active&&Be.matches&&(tt=Be.matches),!tt){let{error:A,notFoundMatches:z,route:q}=se(W.pathname);St(W,{matches:z,loaderData:{},errors:{[q.id]:A}},{flushSync:ut});return}if(C.initialized&&!V&&Yue(C.location,W)&&!(ie&&ie.submission&&go(ie.submission.formMethod))){St(W,{matches:tt},{flushSync:ut});return}M=new AbortController;let Ue=Ph(t.history,W,M.signal,ie&&ie.submission),Fe;if(ie&&ie.pendingError)Fe=[su(tt).route.id,{type:pn.error,error:ie.pendingError}];else if(ie&&ie.submission&&go(ie.submission.formMethod)){let A=await Mt(Ue,W,ie.submission,tt,Be.active,{replace:ie.replace,flushSync:ut});if(A.shortCircuited)return;if(A.pendingActionResult){let[z,q]=A.pendingActionResult;if(hs(q)&&oC(q.error)&&q.error.status===404){M=null,St(W,{matches:A.matches,loaderData:{},errors:{[z]:q.error}});return}}tt=A.matches||tt,Fe=A.pendingActionResult,Oe=Xw(W,ie.submission),ut=!1,Be.active=!1,Ue=Ph(t.history,Ue.url,Ue.signal)}let{shortCircuited:rt,matches:Ot,loaderData:Vt,errors:pi}=await lt(Ue,W,tt,Be.active,Oe,ie&&ie.submission,ie&&ie.fetcherSubmission,ie&&ie.replace,ie&&ie.initialHydration===!0,ut,Fe);rt||(M=null,St(W,Dn({matches:Ot||tt},CN(Fe),{loaderData:Vt,errors:pi})))}async function Mt(F,W,ie,fe,Oe,tt){tt===void 0&&(tt={}),H();let ut=nhe(W,ie);if(it({navigation:ut},{flushSync:tt.flushSync===!0}),Oe){let Fe=await Nt(fe,W.pathname,F.signal);if(Fe.type==="aborted")return{shortCircuited:!0};if(Fe.type==="error"){let rt=su(Fe.partialMatches).route.id;return{matches:Fe.partialMatches,pendingActionResult:[rt,{type:pn.error,error:Fe.error}]}}else if(Fe.matches)fe=Fe.matches;else{let{notFoundMatches:rt,error:Ot,route:Vt}=se(W.pathname);return{matches:rt,pendingActionResult:[Vt.id,{type:pn.error,error:Ot}]}}}let Be,Ue=ng(fe,W);if(!Ue.route.action&&!Ue.route.lazy)Be={type:pn.error,error:Ur(405,{method:F.method,pathname:W.pathname,routeId:Ue.route.id})};else if(Be=(await me("action",C,F,[Ue],fe,null))[Ue.route.id],F.signal.aborted)return{shortCircuited:!0};if(du(Be)){let Fe;return tt&&tt.replace!=null?Fe=tt.replace:Fe=vN(Be.response.headers.get("Location"),new URL(F.url),c)===C.location.pathname+C.location.search,await ae(F,Be,!0,{submission:ie,replace:Fe}),{shortCircuited:!0}}if(Fc(Be))throw Ur(400,{type:"defer-action"});if(hs(Be)){let Fe=su(fe,Ue.route.id);return(tt&&tt.replace)!==!0&&(E=ci.Push),{matches:fe,pendingActionResult:[Fe.route.id,Be]}}return{matches:fe,pendingActionResult:[Ue.route.id,Be]}}async function lt(F,W,ie,fe,Oe,tt,ut,Be,Ue,Fe,rt){let Ot=Oe||Xw(W,tt),Vt=tt||ut||EN(Ot),pi=!O&&(!h.v7_partialHydration||!Ue);if(fe){if(pi){let vt=Zt(rt);it(Dn({navigation:Ot},vt!==void 0?{actionData:vt}:{}),{flushSync:Fe})}let Ke=await Nt(ie,W.pathname,F.signal);if(Ke.type==="aborted")return{shortCircuited:!0};if(Ke.type==="error"){let vt=su(Ke.partialMatches).route.id;return{matches:Ke.partialMatches,loaderData:{},errors:{[vt]:Ke.error}}}else if(Ke.matches)ie=Ke.matches;else{let{error:vt,notFoundMatches:rn,route:fi}=se(W.pathname);return{matches:rn,loaderData:{},errors:{[fi.id]:vt}}}}let A=a||o,[z,q]=fN(t.history,C,ie,Vt,W,h.v7_partialHydration&&Ue===!0,h.v7_skipActionErrorRevalidation,V,X,G,$,ge,ee,A,c,rt);if(pe(Ke=>!(ie&&ie.some(vt=>vt.route.id===Ke))||z&&z.some(vt=>vt.route.id===Ke)),ne=++D,z.length===0&&q.length===0){let Ke=Pe();return St(W,Dn({matches:ie,loaderData:{},errors:rt&&hs(rt[1])?{[rt[0]]:rt[1].error}:null},CN(rt),Ke?{fetchers:new Map(C.fetchers)}:{}),{flushSync:Fe}),{shortCircuited:!0}}if(pi){let Ke={};if(!fe){Ke.navigation=Ot;let vt=Zt(rt);vt!==void 0&&(Ke.actionData=vt)}q.length>0&&(Ke.fetchers=pt(q)),it(Ke,{flushSync:Fe})}q.forEach(Ke=>{Te(Ke.key),Ke.controller&&J.set(Ke.key,Ke.controller)});let te=()=>q.forEach(Ke=>Te(Ke.key));M&&M.signal.addEventListener("abort",te);let{loaderResults:j,fetcherResults:ve}=await de(C,ie,z,q,F);if(F.signal.aborted)return{shortCircuited:!0};M&&M.signal.removeEventListener("abort",te),q.forEach(Ke=>J.delete(Ke.key));let we=iy(j);if(we)return await ae(F,we.result,!0,{replace:Be}),{shortCircuited:!0};if(we=iy(ve),we)return ee.add(we.key),await ae(F,we.result,!0,{replace:Be}),{shortCircuited:!0};let{loaderData:Ve,errors:je}=SN(C,ie,j,rt,q,ve,K);K.forEach((Ke,vt)=>{Ke.subscribe(rn=>{(rn||Ke.done)&&K.delete(vt)})}),h.v7_partialHydration&&Ue&&C.errors&&(je=Dn({},C.errors,je));let at=Pe(),ft=wt(ne),Je=at||ft||q.length>0;return Dn({matches:ie,loaderData:Ve,errors:je},Je?{fetchers:new Map(C.fetchers)}:{})}function Zt(F){if(F&&!hs(F[1]))return{[F[0]]:F[1].data};if(C.actionData)return Object.keys(C.actionData).length===0?null:C.actionData}function pt(F){return F.forEach(W=>{let ie=C.fetchers.get(W.key),fe=$m(void 0,ie?ie.data:void 0);C.fetchers.set(W.key,fe)}),new Map(C.fetchers)}function k(F,W,ie,fe){if(i)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Te(F);let Oe=(fe&&fe.flushSync)===!0,tt=a||o,ut=Cb(C.location,C.matches,c,h.v7_prependBasename,ie,h.v7_relativeSplatPath,W,fe==null?void 0:fe.relative),Be=ru(tt,ut,c),Ue=Qn(Be,tt,ut);if(Ue.active&&Ue.matches&&(Be=Ue.matches),!Be){le(F,W,Ur(404,{pathname:ut}),{flushSync:Oe});return}let{path:Fe,submission:rt,error:Ot}=dN(h.v7_normalizeFormMethod,!0,ut,fe);if(Ot){le(F,W,Ot,{flushSync:Oe});return}let Vt=ng(Be,Fe),pi=(fe&&fe.preventScrollReset)===!0;if(rt&&go(rt.formMethod)){T(F,W,Fe,Vt,Be,Ue.active,Oe,pi,rt);return}ge.set(F,{routeId:W,path:Fe}),Q(F,W,Fe,Vt,Be,Ue.active,Oe,pi,rt)}async function T(F,W,ie,fe,Oe,tt,ut,Be,Ue){H(),ge.delete(F);function Fe(mt){if(!mt.route.action&&!mt.route.lazy){let Ye=Ur(405,{method:Ue.formMethod,pathname:ie,routeId:W});return le(F,W,Ye,{flushSync:ut}),!0}return!1}if(!tt&&Fe(fe))return;let rt=C.fetchers.get(F);Y(F,ihe(Ue,rt),{flushSync:ut});let Ot=new AbortController,Vt=Ph(t.history,ie,Ot.signal,Ue);if(tt){let mt=await Nt(Oe,ie,Vt.signal);if(mt.type==="aborted")return;if(mt.type==="error"){le(F,W,mt.error,{flushSync:ut});return}else if(mt.matches){if(Oe=mt.matches,fe=ng(Oe,ie),Fe(fe))return}else{le(F,W,Ur(404,{pathname:ie}),{flushSync:ut});return}}J.set(F,Ot);let pi=D,z=(await me("action",C,Vt,[fe],Oe,F))[fe.route.id];if(Vt.signal.aborted){J.get(F)===Ot&&J.delete(F);return}if(h.v7_fetcherPersist&&$.has(F)){if(du(z)||hs(z)){Y(F,Sc(void 0));return}}else{if(du(z))if(J.delete(F),ne>pi){Y(F,Sc(void 0));return}else return ee.add(F),Y(F,$m(Ue)),ae(Vt,z,!1,{fetcherSubmission:Ue,preventScrollReset:Be});if(hs(z)){le(F,W,z.error);return}}if(Fc(z))throw Ur(400,{type:"defer-action"});let q=C.navigation.location||C.location,te=Ph(t.history,q,Ot.signal),j=a||o,ve=C.navigation.state!=="idle"?ru(j,C.navigation.location,c):C.matches;Wt(ve,"Didn't find any matches after fetcher action");let we=++D;P.set(F,we);let Ve=$m(Ue,z.data);C.fetchers.set(F,Ve);let[je,at]=fN(t.history,C,ve,Ue,q,!1,h.v7_skipActionErrorRevalidation,V,X,G,$,ge,ee,j,c,[fe.route.id,z]);at.filter(mt=>mt.key!==F).forEach(mt=>{let Ye=mt.key,si=C.fetchers.get(Ye),en=$m(void 0,si?si.data:void 0);C.fetchers.set(Ye,en),Te(Ye),mt.controller&&J.set(Ye,mt.controller)}),it({fetchers:new Map(C.fetchers)});let ft=()=>at.forEach(mt=>Te(mt.key));Ot.signal.addEventListener("abort",ft);let{loaderResults:Je,fetcherResults:Ke}=await de(C,ve,je,at,te);if(Ot.signal.aborted)return;Ot.signal.removeEventListener("abort",ft),P.delete(F),J.delete(F),at.forEach(mt=>J.delete(mt.key));let vt=iy(Je);if(vt)return ae(te,vt.result,!1,{preventScrollReset:Be});if(vt=iy(Ke),vt)return ee.add(vt.key),ae(te,vt.result,!1,{preventScrollReset:Be});let{loaderData:rn,errors:fi}=SN(C,ve,Je,void 0,at,Ke,K);if(C.fetchers.has(F)){let mt=Sc(z.data);C.fetchers.set(F,mt)}wt(we),C.navigation.state==="loading"&&we>ne?(Wt(E,"Expected pending action"),M&&M.abort(),St(C.navigation.location,{matches:ve,loaderData:rn,errors:fi,fetchers:new Map(C.fetchers)})):(it({errors:fi,loaderData:xN(C.loaderData,rn,ve,fi),fetchers:new Map(C.fetchers)}),V=!1)}async function Q(F,W,ie,fe,Oe,tt,ut,Be,Ue){let Fe=C.fetchers.get(F);Y(F,$m(Ue,Fe?Fe.data:void 0),{flushSync:ut});let rt=new AbortController,Ot=Ph(t.history,ie,rt.signal);if(tt){let z=await Nt(Oe,ie,Ot.signal);if(z.type==="aborted")return;if(z.type==="error"){le(F,W,z.error,{flushSync:ut});return}else if(z.matches)Oe=z.matches,fe=ng(Oe,ie);else{le(F,W,Ur(404,{pathname:ie}),{flushSync:ut});return}}J.set(F,rt);let Vt=D,A=(await me("loader",C,Ot,[fe],Oe,F))[fe.route.id];if(Fc(A)&&(A=await RA(A,Ot.signal,!0)||A),J.get(F)===rt&&J.delete(F),!Ot.signal.aborted){if($.has(F)){Y(F,Sc(void 0));return}if(du(A))if(ne>Vt){Y(F,Sc(void 0));return}else{ee.add(F),await ae(Ot,A,!1,{preventScrollReset:Be});return}if(hs(A)){le(F,W,A.error);return}Wt(!Fc(A),"Unhandled fetcher deferred data"),Y(F,Sc(A.data))}}async function ae(F,W,ie,fe){let{submission:Oe,fetcherSubmission:tt,preventScrollReset:ut,replace:Be}=fe===void 0?{}:fe;W.response.headers.has("X-Remix-Revalidate")&&(V=!0);let Ue=W.response.headers.get("Location");Wt(Ue,"Expected a Location header on the redirect Response"),Ue=vN(Ue,new URL(F.url),c);let Fe=o0(C.location,Ue,{_isRedirect:!0});if(n){let z=!1;if(W.response.headers.has("X-Remix-Reload-Document"))z=!0;else if(EA.test(Ue)){const q=t.history.createURL(Ue);z=q.origin!==e.location.origin||$0(q.pathname,c)==null}if(z){Be?e.location.replace(Ue):e.location.assign(Ue);return}}M=null;let rt=Be===!0||W.response.headers.has("X-Remix-Replace")?ci.Replace:ci.Push,{formMethod:Ot,formAction:Vt,formEncType:pi}=C.navigation;!Oe&&!tt&&Ot&&Vt&&pi&&(Oe=EN(C.navigation));let A=Oe||tt;if(Fue.has(W.response.status)&&A&&go(A.formMethod))await xt(rt,Fe,{submission:Dn({},A,{formAction:Ue}),preventScrollReset:ut||b,enableViewTransition:ie?_:void 0});else{let z=Xw(Fe,Oe);await xt(rt,Fe,{overrideNavigation:z,fetcherSubmission:tt,preventScrollReset:ut||b,enableViewTransition:ie?_:void 0})}}async function me(F,W,ie,fe,Oe,tt){let ut,Be={};try{ut=await Wue(l,F,W,ie,fe,Oe,tt,s,r)}catch(Ue){return fe.forEach(Fe=>{Be[Fe.route.id]={type:pn.error,error:Ue}}),Be}for(let[Ue,Fe]of Object.entries(ut))if(Jue(Fe)){let rt=Fe.result;Be[Ue]={type:pn.redirect,response:Xue(rt,ie,Ue,Oe,c,h.v7_relativeSplatPath)}}else Be[Ue]=await que(Fe);return Be}async function de(F,W,ie,fe,Oe){let tt=F.matches,ut=me("loader",F,Oe,ie,W,null),Be=Promise.all(fe.map(async rt=>{if(rt.matches&&rt.match&&rt.controller){let Vt=(await me("loader",F,Ph(t.history,rt.path,rt.controller.signal),[rt.match],rt.matches,rt.key))[rt.match.route.id];return{[rt.key]:Vt}}else return Promise.resolve({[rt.key]:{type:pn.error,error:Ur(404,{pathname:rt.path})}})})),Ue=await ut,Fe=(await Be).reduce((rt,Ot)=>Object.assign(rt,Ot),{});return await Promise.all([ehe(W,Ue,Oe.signal,tt,F.loaderData),the(W,Fe,fe)]),{loaderResults:Ue,fetcherResults:Fe}}function H(){V=!0,X.push(...pe()),ge.forEach((F,W)=>{J.has(W)&&G.add(W),Te(W)})}function Y(F,W,ie){ie===void 0&&(ie={}),C.fetchers.set(F,W),it({fetchers:new Map(C.fetchers)},{flushSync:(ie&&ie.flushSync)===!0})}function le(F,W,ie,fe){fe===void 0&&(fe={});let Oe=su(C.matches,W);ue(F),it({errors:{[Oe.route.id]:ie},fetchers:new Map(C.fetchers)},{flushSync:(fe&&fe.flushSync)===!0})}function ke(F){return h.v7_fetcherPersist&&(I.set(F,(I.get(F)||0)+1),$.has(F)&&$.delete(F)),C.fetchers.get(F)||zue}function ue(F){let W=C.fetchers.get(F);J.has(F)&&!(W&&W.state==="loading"&&P.has(F))&&Te(F),ge.delete(F),P.delete(F),ee.delete(F),$.delete(F),G.delete(F),C.fetchers.delete(F)}function Ce(F){if(h.v7_fetcherPersist){let W=(I.get(F)||0)-1;W<=0?(I.delete(F),$.add(F)):I.set(F,W)}else ue(F);it({fetchers:new Map(C.fetchers)})}function Te(F){let W=J.get(F);W&&(W.abort(),J.delete(F))}function Ze(F){for(let W of F){let ie=ke(W),fe=Sc(ie.data);C.fetchers.set(W,fe)}}function Pe(){let F=[],W=!1;for(let ie of ee){let fe=C.fetchers.get(ie);Wt(fe,"Expected fetcher: "+ie),fe.state==="loading"&&(ee.delete(ie),F.push(ie),W=!0)}return Ze(F),W}function wt(F){let W=[];for(let[ie,fe]of P)if(fe<F){let Oe=C.fetchers.get(ie);Wt(Oe,"Expected fetcher: "+ie),Oe.state==="loading"&&(Te(ie),P.delete(ie),W.push(ie))}return Ze(W),W.length>0}function et(F,W){let ie=C.blockers.get(F)||Bm;return oe.get(F)!==W&&oe.set(F,W),ie}function Dt(F){C.blockers.delete(F),oe.delete(F)}function B(F,W){let ie=C.blockers.get(F)||Bm;Wt(ie.state==="unblocked"&&W.state==="blocked"||ie.state==="blocked"&&W.state==="blocked"||ie.state==="blocked"&&W.state==="proceeding"||ie.state==="blocked"&&W.state==="unblocked"||ie.state==="proceeding"&&W.state==="unblocked","Invalid blocker state transition: "+ie.state+" -> "+W.state);let fe=new Map(C.blockers);fe.set(F,W),it({blockers:fe})}function De(F){let{currentLocation:W,nextLocation:ie,historyAction:fe}=F;if(oe.size===0)return;oe.size>1&&Ud(!1,"A router only supports one blocker at a time");let Oe=Array.from(oe.entries()),[tt,ut]=Oe[Oe.length-1],Be=C.blockers.get(tt);if(!(Be&&Be.state==="proceeding")&&ut({currentLocation:W,nextLocation:ie,historyAction:fe}))return tt}function se(F){let W=Ur(404,{pathname:F}),ie=a||o,{matches:fe,route:Oe}=_N(ie);return pe(),{notFoundMatches:fe,route:Oe,error:W}}function pe(F){let W=[];return K.forEach((ie,fe)=>{(!F||F(fe))&&(ie.cancel(),W.push(fe),K.delete(fe))}),W}function Le(F,W,ie){if(f=F,g=W,v=ie||null,!m&&C.navigation===qw){m=!0;let fe=Tn(C.location,C.matches);fe!=null&&it({restoreScrollPosition:fe})}return()=>{f=null,g=null,v=null}}function Ne(F,W){return v&&v(F,W.map(fe=>mue(fe,C.loaderData)))||F.key}function Ft(F,W){if(f&&g){let ie=Ne(F,W);f[ie]=g()}}function Tn(F,W){if(f){let ie=Ne(F,W),fe=f[ie];if(typeof fe=="number")return fe}return null}function Qn(F,W,ie){if(u)if(F){if(Object.keys(F[0].params).length>0)return{active:!0,matches:Hy(W,ie,c,!0)}}else return{active:!0,matches:Hy(W,ie,c,!0)||[]};return{active:!1,matches:null}}async function Nt(F,W,ie){if(!u)return{type:"success",matches:F};let fe=F;for(;;){let Oe=a==null,tt=a||o,ut=s;try{await u({path:W,matches:fe,patch:(Fe,rt)=>{ie.aborted||gN(Fe,rt,tt,ut,r)}})}catch(Fe){return{type:"error",error:Fe,partialMatches:fe}}finally{Oe&&!ie.aborted&&(o=[...o])}if(ie.aborted)return{type:"aborted"};let Be=ru(tt,W,c);if(Be)return{type:"success",matches:Be};let Ue=Hy(tt,W,c,!0);if(!Ue||fe.length===Ue.length&&fe.every((Fe,rt)=>Fe.route.id===Ue[rt].route.id))return{type:"success",matches:null};fe=Ue}}function bi(F){s={},a=U1(F,r,void 0,s)}function es(F,W){let ie=a==null;gN(F,W,a||o,s,r),ie&&(o=[...o],it({}))}return w={get basename(){return c},get future(){return h},get state(){return C},get routes(){return o},get window(){return e},initialize:ze,subscribe:dt,enableScrollRestoration:Le,navigate:U,fetch:k,revalidate:di,createHref:F=>t.history.createHref(F),encodeLocation:F=>t.history.encodeLocation(F),getFetcher:ke,deleteFetcher:Ce,dispose:Me,getBlocker:et,deleteBlocker:Dt,patchRoutes:es,_internalFetchControllers:J,_internalActiveDeferreds:K,_internalSetRoutes:bi},w}function $ue(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function Cb(t,e,n,i,r,s,o,a){let c,l;if(o){c=[];for(let h of e)if(c.push(h),h.route.id===o){l=h;break}}else c=e,l=e[e.length-1];let u=y6(r||".",v6(c,s),$0(t.pathname,n)||t.pathname,a==="path");if(r==null&&(u.search=t.search,u.hash=t.hash),(r==null||r===""||r===".")&&l){let h=bA(u.search);if(l.route.index&&!h)u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index";else if(!l.route.index&&h){let d=new URLSearchParams(u.search),p=d.getAll("index");d.delete("index"),p.filter(v=>v).forEach(v=>d.append("index",v));let f=d.toString();u.search=f?"?"+f:""}}return i&&n!=="/"&&(u.pathname=u.pathname==="/"?n:Jc([n,u.pathname])),B0(u)}function dN(t,e,n,i){if(!i||!$ue(i))return{path:n};if(i.formMethod&&!Zue(i.formMethod))return{path:n,error:Ur(405,{method:i.formMethod})};let r=()=>({path:n,error:Ur(400,{type:"invalid-body"})}),s=i.formMethod||"get",o=t?s.toUpperCase():s.toLowerCase(),a=w6(n);if(i.body!==void 0){if(i.formEncType==="text/plain"){if(!go(o))return r();let d=typeof i.body=="string"?i.body:i.body instanceof FormData||i.body instanceof URLSearchParams?Array.from(i.body.entries()).reduce((p,f)=>{let[v,g]=f;return""+p+v+"="+g+`
`},""):String(i.body);return{path:n,submission:{formMethod:o,formAction:a,formEncType:i.formEncType,formData:void 0,json:void 0,text:d}}}else if(i.formEncType==="application/json"){if(!go(o))return r();try{let d=typeof i.body=="string"?JSON.parse(i.body):i.body;return{path:n,submission:{formMethod:o,formAction:a,formEncType:i.formEncType,formData:void 0,json:d,text:void 0}}}catch{return r()}}}Wt(typeof FormData=="function","FormData is not available in this environment");let c,l;if(i.formData)c=wb(i.formData),l=i.formData;else if(i.body instanceof FormData)c=wb(i.body),l=i.body;else if(i.body instanceof URLSearchParams)c=i.body,l=yN(c);else if(i.body==null)c=new URLSearchParams,l=new FormData;else try{c=new URLSearchParams(i.body),l=yN(c)}catch{return r()}let u={formMethod:o,formAction:a,formEncType:i&&i.formEncType||"application/x-www-form-urlencoded",formData:l,json:void 0,text:void 0};if(go(u.formMethod))return{path:n,submission:u};let h=wl(n);return e&&h.search&&bA(h.search)&&c.append("index",""),h.search="?"+c,{path:B0(h),submission:u}}function pN(t,e,n){n===void 0&&(n=!1);let i=t.findIndex(r=>r.route.id===e);return i>=0?t.slice(0,n?i+1:i):t}function fN(t,e,n,i,r,s,o,a,c,l,u,h,d,p,f,v){let g=v?hs(v[1])?v[1].error:v[1].data:void 0,m=t.createURL(e.location),y=t.createURL(r),S=n;s&&e.errors?S=pN(n,Object.keys(e.errors)[0],!0):v&&hs(v[1])&&(S=pN(n,v[0]));let x=v?v[1].statusCode:void 0,w=o&&x&&x>=400,C=S.filter((b,M)=>{let{route:_}=b;if(_.lazy)return!0;if(_.loader==null)return!1;if(s)return _b(_,e.loaderData,e.errors);if(Hue(e.loaderData,e.matches[M],b)||c.some(O=>O===b.route.id))return!0;let R=e.matches[M],L=b;return mN(b,Dn({currentUrl:m,currentParams:R.params,nextUrl:y,nextParams:L.params},i,{actionResult:g,actionStatus:x,defaultShouldRevalidate:w?!1:a||m.pathname+m.search===y.pathname+y.search||m.search!==y.search||C6(R,L)}))}),E=[];return h.forEach((b,M)=>{if(s||!n.some(V=>V.route.id===b.routeId)||u.has(M))return;let _=ru(p,b.path,f);if(!_){E.push({key:M,routeId:b.routeId,path:b.path,matches:null,match:null,controller:null});return}let R=e.fetchers.get(M),L=ng(_,b.path),O=!1;d.has(M)?O=!1:l.has(M)?(l.delete(M),O=!0):R&&R.state!=="idle"&&R.data===void 0?O=a:O=mN(L,Dn({currentUrl:m,currentParams:e.matches[e.matches.length-1].params,nextUrl:y,nextParams:n[n.length-1].params},i,{actionResult:g,actionStatus:x,defaultShouldRevalidate:w?!1:a})),O&&E.push({key:M,routeId:b.routeId,path:b.path,matches:_,match:L,controller:new AbortController})}),[C,E]}function _b(t,e,n){if(t.lazy)return!0;if(!t.loader)return!1;let i=e!=null&&e[t.id]!==void 0,r=n!=null&&n[t.id]!==void 0;return!i&&r?!1:typeof t.loader=="function"&&t.loader.hydrate===!0?!0:!i&&!r}function Hue(t,e,n){let i=!e||n.route.id!==e.route.id,r=t[n.route.id]===void 0;return i||r}function C6(t,e){let n=t.route.path;return t.pathname!==e.pathname||n!=null&&n.endsWith("*")&&t.params["*"]!==e.params["*"]}function mN(t,e){if(t.route.shouldRevalidate){let n=t.route.shouldRevalidate(e);if(typeof n=="boolean")return n}return e.defaultShouldRevalidate}function gN(t,e,n,i,r){var s;let o;if(t){let l=i[t];Wt(l,"No route found to patch children into: routeId = "+t),l.children||(l.children=[]),o=l.children}else o=n;let a=e.filter(l=>!o.some(u=>_6(l,u))),c=U1(a,r,[t||"_","patch",String(((s=o)==null?void 0:s.length)||"0")],i);o.push(...c)}function _6(t,e){return"id"in t&&"id"in e&&t.id===e.id?!0:t.index===e.index&&t.path===e.path&&t.caseSensitive===e.caseSensitive?(!t.children||t.children.length===0)&&(!e.children||e.children.length===0)?!0:t.children.every((n,i)=>{var r;return(r=e.children)==null?void 0:r.some(s=>_6(n,s))}):!1}async function Vue(t,e,n){if(!t.lazy)return;let i=await t.lazy();if(!t.lazy)return;let r=n[t.id];Wt(r,"No route found in manifest");let s={};for(let o in i){let c=r[o]!==void 0&&o!=="hasErrorBoundary";Ud(!c,'Route "'+r.id+'" has a static property "'+o+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+o+'" will be ignored.')),!c&&!pue.has(o)&&(s[o]=i[o])}Object.assign(r,s),Object.assign(r,Dn({},e(r),{lazy:void 0}))}async function jue(t){let{matches:e}=t,n=e.filter(r=>r.shouldLoad);return(await Promise.all(n.map(r=>r.resolve()))).reduce((r,s,o)=>Object.assign(r,{[n[o].route.id]:s}),{})}async function Wue(t,e,n,i,r,s,o,a,c,l){let u=s.map(p=>p.route.lazy?Vue(p.route,c,a):void 0),h=s.map((p,f)=>{let v=u[f],g=r.some(y=>y.route.id===p.route.id);return Dn({},p,{shouldLoad:g,resolve:async y=>(y&&i.method==="GET"&&(p.route.lazy||p.route.loader)&&(g=!0),g?Gue(e,i,p,v,y,l):Promise.resolve({type:pn.data,result:void 0}))})}),d=await t({matches:h,request:i,params:s[0].params,fetcherKey:o,context:l});try{await Promise.all(u)}catch{}return d}async function Gue(t,e,n,i,r,s){let o,a,c=l=>{let u,h=new Promise((f,v)=>u=v);a=()=>u(),e.signal.addEventListener("abort",a);let d=f=>typeof l!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+t+'" [routeId: '+n.route.id+"]"))):l({request:e,params:n.params,context:s},...f!==void 0?[f]:[]),p=(async()=>{try{return{type:"data",result:await(r?r(v=>d(v)):d())}}catch(f){return{type:"error",result:f}}})();return Promise.race([p,h])};try{let l=n.route[t];if(i)if(l){let u,[h]=await Promise.all([c(l).catch(d=>{u=d}),i]);if(u!==void 0)throw u;o=h}else if(await i,l=n.route[t],l)o=await c(l);else if(t==="action"){let u=new URL(e.url),h=u.pathname+u.search;throw Ur(405,{method:e.method,pathname:h,routeId:n.route.id})}else return{type:pn.data,result:void 0};else if(l)o=await c(l);else{let u=new URL(e.url),h=u.pathname+u.search;throw Ur(404,{pathname:h})}Wt(o.result!==void 0,"You defined "+(t==="action"?"an action":"a loader")+" for route "+('"'+n.route.id+"\" but didn't return anything from your `"+t+"` ")+"function. Please return a value or `null`.")}catch(l){return{type:pn.error,result:l}}finally{a&&e.signal.removeEventListener("abort",a)}return o}async function que(t){let{result:e,type:n}=t;if(E6(e)){let l;try{let u=e.headers.get("Content-Type");u&&/\bapplication\/json\b/.test(u)?e.body==null?l=null:l=await e.json():l=await e.text()}catch(u){return{type:pn.error,error:u}}return n===pn.error?{type:pn.error,error:new B1(e.status,e.statusText,l),statusCode:e.status,headers:e.headers}:{type:pn.data,data:l,statusCode:e.status,headers:e.headers}}if(n===pn.error){if(wN(e)){var i;if(e.data instanceof Error){var r;return{type:pn.error,error:e.data,statusCode:(r=e.init)==null?void 0:r.status}}e=new B1(((i=e.init)==null?void 0:i.status)||500,void 0,e.data)}return{type:pn.error,error:e,statusCode:oC(e)?e.status:void 0}}if(Que(e)){var s,o;return{type:pn.deferred,deferredData:e,statusCode:(s=e.init)==null?void 0:s.status,headers:((o=e.init)==null?void 0:o.headers)&&new Headers(e.init.headers)}}if(wN(e)){var a,c;return{type:pn.data,data:e.data,statusCode:(a=e.init)==null?void 0:a.status,headers:(c=e.init)!=null&&c.headers?new Headers(e.init.headers):void 0}}return{type:pn.data,data:e}}function Xue(t,e,n,i,r,s){let o=t.headers.get("Location");if(Wt(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!EA.test(o)){let a=i.slice(0,i.findIndex(c=>c.route.id===n)+1);o=Cb(new URL(e.url),a,r,!0,o,s),t.headers.set("Location",o)}return t}function vN(t,e,n){if(EA.test(t)){let i=t,r=i.startsWith("//")?new URL(e.protocol+i):new URL(i),s=$0(r.pathname,n)!=null;if(r.origin===e.origin&&s)return r.pathname+r.search+r.hash}return t}function Ph(t,e,n,i){let r=t.createURL(w6(e)).toString(),s={signal:n};if(i&&go(i.formMethod)){let{formMethod:o,formEncType:a}=i;s.method=o.toUpperCase(),a==="application/json"?(s.headers=new Headers({"Content-Type":a}),s.body=JSON.stringify(i.json)):a==="text/plain"?s.body=i.text:a==="application/x-www-form-urlencoded"&&i.formData?s.body=wb(i.formData):s.body=i.formData}return new Request(r,s)}function wb(t){let e=new URLSearchParams;for(let[n,i]of t.entries())e.append(n,typeof i=="string"?i:i.name);return e}function yN(t){let e=new FormData;for(let[n,i]of t.entries())e.append(n,i);return e}function Kue(t,e,n,i,r){let s={},o=null,a,c=!1,l={},u=n&&hs(n[1])?n[1].error:void 0;return t.forEach(h=>{if(!(h.route.id in e))return;let d=h.route.id,p=e[d];if(Wt(!du(p),"Cannot handle redirect results in processLoaderData"),hs(p)){let f=p.error;u!==void 0&&(f=u,u=void 0),o=o||{};{let v=su(t,d);o[v.route.id]==null&&(o[v.route.id]=f)}s[d]=void 0,c||(c=!0,a=oC(p.error)?p.error.status:500),p.headers&&(l[d]=p.headers)}else Fc(p)?(i.set(d,p.deferredData),s[d]=p.deferredData.data,p.statusCode!=null&&p.statusCode!==200&&!c&&(a=p.statusCode),p.headers&&(l[d]=p.headers)):(s[d]=p.data,p.statusCode&&p.statusCode!==200&&!c&&(a=p.statusCode),p.headers&&(l[d]=p.headers))}),u!==void 0&&n&&(o={[n[0]]:u},s[n[0]]=void 0),{loaderData:s,errors:o,statusCode:a||200,loaderHeaders:l}}function SN(t,e,n,i,r,s,o){let{loaderData:a,errors:c}=Kue(e,n,i,o);return r.forEach(l=>{let{key:u,match:h,controller:d}=l,p=s[u];if(Wt(p,"Did not find corresponding fetcher result"),!(d&&d.signal.aborted))if(hs(p)){let f=su(t.matches,h==null?void 0:h.route.id);c&&c[f.route.id]||(c=Dn({},c,{[f.route.id]:p.error})),t.fetchers.delete(u)}else if(du(p))Wt(!1,"Unhandled fetcher revalidation redirect");else if(Fc(p))Wt(!1,"Unhandled fetcher deferred data");else{let f=Sc(p.data);t.fetchers.set(u,f)}}),{loaderData:a,errors:c}}function xN(t,e,n,i){let r=Dn({},e);for(let s of n){let o=s.route.id;if(e.hasOwnProperty(o)?e[o]!==void 0&&(r[o]=e[o]):t[o]!==void 0&&s.route.loader&&(r[o]=t[o]),i&&i.hasOwnProperty(o))break}return r}function CN(t){return t?hs(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function su(t,e){return(e?t.slice(0,t.findIndex(i=>i.route.id===e)+1):[...t]).reverse().find(i=>i.route.hasErrorBoundary===!0)||t[0]}function _N(t){let e=t.length===1?t[0]:t.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Ur(t,e){let{pathname:n,routeId:i,method:r,type:s,message:o}=e===void 0?{}:e,a="Unknown Server Error",c="Unknown @remix-run/router error";return t===400?(a="Bad Request",r&&n&&i?c="You made a "+r+' request to "'+n+'" but '+('did not provide a `loader` for route "'+i+'", ')+"so there is no way to handle the request.":s==="defer-action"?c="defer() is not supported in actions":s==="invalid-body"&&(c="Unable to encode submission body")):t===403?(a="Forbidden",c='Route "'+i+'" does not match URL "'+n+'"'):t===404?(a="Not Found",c='No route matches URL "'+n+'"'):t===405&&(a="Method Not Allowed",r&&n&&i?c="You made a "+r.toUpperCase()+' request to "'+n+'" but '+('did not provide an `action` for route "'+i+'", ')+"so there is no way to handle the request.":r&&(c='Invalid request method "'+r.toUpperCase()+'"')),new B1(t||500,a,new Error(c),!0)}function iy(t){let e=Object.entries(t);for(let n=e.length-1;n>=0;n--){let[i,r]=e[n];if(du(r))return{key:i,result:r}}}function w6(t){let e=typeof t=="string"?wl(t):t;return B0(Dn({},e,{hash:""}))}function Yue(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function Jue(t){return E6(t.result)&&Oue.has(t.result.status)}function Fc(t){return t.type===pn.deferred}function hs(t){return t.type===pn.error}function du(t){return(t&&t.type)===pn.redirect}function wN(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function Que(t){let e=t;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function E6(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function Zue(t){return Nue.has(t.toLowerCase())}function go(t){return Lue.has(t.toLowerCase())}async function ehe(t,e,n,i,r){let s=Object.entries(e);for(let o=0;o<s.length;o++){let[a,c]=s[o],l=t.find(d=>(d==null?void 0:d.route.id)===a);if(!l)continue;let u=i.find(d=>d.route.id===l.route.id),h=u!=null&&!C6(u,l)&&(r&&r[l.route.id])!==void 0;Fc(c)&&h&&await RA(c,n,!1).then(d=>{d&&(e[a]=d)})}}async function the(t,e,n){for(let i=0;i<n.length;i++){let{key:r,routeId:s,controller:o}=n[i],a=e[r];t.find(l=>(l==null?void 0:l.route.id)===s)&&Fc(a)&&(Wt(o,"Expected an AbortController for revalidating fetcher deferred result"),await RA(a,o.signal,!0).then(l=>{l&&(e[r]=l)}))}}async function RA(t,e,n){if(n===void 0&&(n=!1),!await t.deferredData.resolveData(e)){if(n)try{return{type:pn.data,data:t.deferredData.unwrappedData}}catch(r){return{type:pn.error,error:r}}return{type:pn.data,data:t.deferredData.data}}}function bA(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function ng(t,e){let n=typeof e=="string"?wl(e).search:e.search;if(t[t.length-1].route.index&&bA(n||""))return t[t.length-1];let i=g6(t);return i[i.length-1]}function EN(t){let{formMethod:e,formAction:n,formEncType:i,text:r,formData:s,json:o}=t;if(!(!e||!n||!i)){if(r!=null)return{formMethod:e,formAction:n,formEncType:i,formData:void 0,json:void 0,text:r};if(s!=null)return{formMethod:e,formAction:n,formEncType:i,formData:s,json:void 0,text:void 0};if(o!==void 0)return{formMethod:e,formAction:n,formEncType:i,formData:void 0,json:o,text:void 0}}}function Xw(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function nhe(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function $m(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function ihe(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function Sc(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function rhe(t,e){try{let n=t.sessionStorage.getItem(x6);if(n){let i=JSON.parse(n);for(let[r,s]of Object.entries(i||{}))s&&Array.isArray(s)&&e.set(r,new Set(s||[]))}}catch{}}function she(t,e){if(e.size>0){let n={};for(let[i,r]of e)n[i]=[...r];try{t.sessionStorage.setItem(x6,JSON.stringify(n))}catch(i){Ud(!1,"Failed to save applied view transitions in sessionStorage ("+i+").")}}}/**
 * React Router v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $1(){return $1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},$1.apply(this,arguments)}const aC=re.createContext(null),R6=re.createContext(null),cC=re.createContext(null),TA=re.createContext(null),mp=re.createContext({outlet:null,matches:[],isDataRoute:!1}),b6=re.createContext(null);function lC(){return re.useContext(TA)!=null}function AA(){return lC()||Wt(!1),re.useContext(TA).location}function T6(t){re.useContext(cC).static||re.useLayoutEffect(t)}function ohe(){let{isDataRoute:t}=re.useContext(mp);return t?yhe():ahe()}function ahe(){lC()||Wt(!1);let t=re.useContext(aC),{basename:e,future:n,navigator:i}=re.useContext(cC),{matches:r}=re.useContext(mp),{pathname:s}=AA(),o=JSON.stringify(v6(r,n.v7_relativeSplatPath)),a=re.useRef(!1);return T6(()=>{a.current=!0}),re.useCallback(function(l,u){if(u===void 0&&(u={}),!a.current)return;if(typeof l=="number"){i.go(l);return}let h=y6(l,JSON.parse(o),s,u.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Jc([e,h.pathname])),(u.replace?i.replace:i.push)(h,u.state,u)},[e,i,o,s,t])}function che(t,e,n,i){lC()||Wt(!1);let{navigator:r}=re.useContext(cC),{matches:s}=re.useContext(mp),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let l=AA(),u;u=l;let h=u.pathname||"/",d=h;if(c!=="/"){let v=c.replace(/^\//,"").split("/");d="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let p=ru(t,{pathname:d});return phe(p&&p.map(v=>Object.assign({},v,{params:Object.assign({},a,v.params),pathname:Jc([c,r.encodeLocation?r.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:Jc([c,r.encodeLocation?r.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),s,n,i)}function lhe(){let t=vhe(),e=oC(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return re.createElement(re.Fragment,null,re.createElement("h2",null,"Unexpected Application Error!"),re.createElement("h3",{style:{fontStyle:"italic"}},e),n?re.createElement("pre",{style:r},n):null,null)}const uhe=re.createElement(lhe,null);class hhe extends re.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?re.createElement(mp.Provider,{value:this.props.routeContext},re.createElement(b6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function dhe(t){let{routeContext:e,match:n,children:i}=t,r=re.useContext(aC);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),re.createElement(mp.Provider,{value:e},i)}function phe(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let u=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);u>=0||Wt(!1),o=o.slice(0,Math.min(o.length,u+1))}let c=!1,l=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<o.length;u++){let h=o[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=u),h.route.id){let{loaderData:d,errors:p}=n,f=h.route.loader&&d[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||f){c=!0,l>=0?o=o.slice(0,l+1):o=[o[0]];break}}}return o.reduceRight((u,h,d)=>{let p,f=!1,v=null,g=null;n&&(p=a&&h.route.id?a[h.route.id]:void 0,v=h.route.errorElement||uhe,c&&(l<0&&d===0?(She("route-fallback"),f=!0,g=null):l===d&&(f=!0,g=h.route.hydrateFallbackElement||null)));let m=e.concat(o.slice(0,d+1)),y=()=>{let S;return p?S=v:f?S=g:h.route.Component?S=re.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=u,re.createElement(dhe,{match:h,routeContext:{outlet:u,matches:m,isDataRoute:n!=null},children:S})};return n&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?re.createElement(hhe,{location:n.location,revalidation:n.revalidation,component:v,error:p,children:y(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):y()},null)}var A6=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(A6||{}),H1=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(H1||{});function fhe(t){let e=re.useContext(aC);return e||Wt(!1),e}function mhe(t){let e=re.useContext(R6);return e||Wt(!1),e}function ghe(t){let e=re.useContext(mp);return e||Wt(!1),e}function P6(t){let e=ghe(),n=e.matches[e.matches.length-1];return n.route.id||Wt(!1),n.route.id}function vhe(){var t;let e=re.useContext(b6),n=mhe(H1.UseRouteError),i=P6(H1.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function yhe(){let{router:t}=fhe(A6.UseNavigateStable),e=P6(H1.UseNavigateStable),n=re.useRef(!1);return T6(()=>{n.current=!0}),re.useCallback(function(r,s){s===void 0&&(s={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,$1({fromRouteId:e},s)))},[t,e])}const RN={};function She(t,e,n){RN[t]||(RN[t]=!0)}const bN={};function xhe(t,e){bN[e]||(bN[e]=!0,console.warn(e))}const Ih=(t,e,n)=>xhe(t," React Router Future Flag Warning: "+e+". "+("You can use the `"+t+"` future flag to opt-in early. ")+("For more information, see "+n+"."));function Che(t,e){t!=null&&t.v7_startTransition||Ih("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),!(t!=null&&t.v7_relativeSplatPath)&&(!e||!e.v7_relativeSplatPath)&&Ih("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath"),e&&(e.v7_fetcherPersist||Ih("v7_fetcherPersist","The persistence behavior of fetchers is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist"),e.v7_normalizeFormMethod||Ih("v7_normalizeFormMethod","Casing of `formMethod` fields is being normalized to uppercase in v7","https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod"),e.v7_partialHydration||Ih("v7_partialHydration","`RouterProvider` hydration behavior is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_partialhydration"),e.v7_skipActionErrorRevalidation||Ih("v7_skipActionErrorRevalidation","The revalidation behavior after 4xx/5xx `action` responses is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation"))}function _he(t){let{basename:e="/",children:n=null,location:i,navigationType:r=ci.Pop,navigator:s,static:o=!1,future:a}=t;lC()&&Wt(!1);let c=e.replace(/^\/*/,"/"),l=re.useMemo(()=>({basename:c,navigator:s,static:o,future:$1({v7_relativeSplatPath:!1},a)}),[c,a,s,o]);typeof i=="string"&&(i=wl(i));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:f="default"}=i,v=re.useMemo(()=>{let g=$0(u,c);return g==null?null:{location:{pathname:g,search:h,hash:d,state:p,key:f},navigationType:r}},[c,u,h,d,p,f,r]);return v==null?null:re.createElement(cC.Provider,{value:l},re.createElement(TA.Provider,{children:n,value:v}))}new Promise(()=>{});function whe(t){let e={hasErrorBoundary:t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&Object.assign(e,{element:re.createElement(t.Component),Component:void 0}),t.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:re.createElement(t.HydrateFallback),HydrateFallback:void 0}),t.ErrorBoundary&&Object.assign(e,{errorElement:re.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function V1(){return V1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},V1.apply(this,arguments)}function Eb(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let i=t[n];return e.concat(Array.isArray(i)?i.map(r=>[n,r]):[[n,i]])},[]))}function Ehe(t,e){let n=Eb(t);return e&&e.forEach((i,r)=>{n.has(r)||e.getAll(r).forEach(s=>{n.append(r,s)})}),n}const Rhe="6";try{window.__reactRouterVersion=Rhe}catch{}function bhe(t,e){return Bue({basename:e==null?void 0:e.basename,future:V1({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:uue({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||The(),routes:t,mapRouteProperties:whe,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function The(){var t;let e=(t=window)==null?void 0:t.__staticRouterHydrationData;return e&&e.errors&&(e=V1({},e,{errors:Ahe(e.errors)})),e}function Ahe(t){if(!t)return null;let e=Object.entries(t),n={};for(let[i,r]of e)if(r&&r.__type==="RouteErrorResponse")n[i]=new B1(r.status,r.statusText,r.data,r.internal===!0);else if(r&&r.__type==="Error"){if(r.__subType){let s=window[r.__subType];if(typeof s=="function")try{let o=new s(r.message);o.stack="",n[i]=o}catch{}}if(n[i]==null){let s=new Error(r.message);s.stack="",n[i]=s}}else n[i]=r;return n}const Phe=re.createContext({isTransitioning:!1}),Ihe=re.createContext(new Map),Mhe="startTransition",TN=B7[Mhe],khe="flushSync",AN=Q9[khe];function Lhe(t){TN?TN(t):t()}function Hm(t){AN?AN(t):t()}class Dhe{constructor(){this.status="pending",this.promise=new Promise((e,n)=>{this.resolve=i=>{this.status==="pending"&&(this.status="resolved",e(i))},this.reject=i=>{this.status==="pending"&&(this.status="rejected",n(i))}})}}function Nhe(t){let{fallbackElement:e,router:n,future:i}=t,[r,s]=re.useState(n.state),[o,a]=re.useState(),[c,l]=re.useState({isTransitioning:!1}),[u,h]=re.useState(),[d,p]=re.useState(),[f,v]=re.useState(),g=re.useRef(new Map),{v7_startTransition:m}=i||{},y=re.useCallback(b=>{m?Lhe(b):b()},[m]),S=re.useCallback((b,M)=>{let{deletedFetchers:_,flushSync:R,viewTransitionOpts:L}=M;_.forEach(V=>g.current.delete(V)),b.fetchers.forEach((V,X)=>{V.data!==void 0&&g.current.set(X,V.data)});let O=n.window==null||n.window.document==null||typeof n.window.document.startViewTransition!="function";if(!L||O){R?Hm(()=>s(b)):y(()=>s(b));return}if(R){Hm(()=>{d&&(u&&u.resolve(),d.skipTransition()),l({isTransitioning:!0,flushSync:!0,currentLocation:L.currentLocation,nextLocation:L.nextLocation})});let V=n.window.document.startViewTransition(()=>{Hm(()=>s(b))});V.finished.finally(()=>{Hm(()=>{h(void 0),p(void 0),a(void 0),l({isTransitioning:!1})})}),Hm(()=>p(V));return}d?(u&&u.resolve(),d.skipTransition(),v({state:b,currentLocation:L.currentLocation,nextLocation:L.nextLocation})):(a(b),l({isTransitioning:!0,flushSync:!1,currentLocation:L.currentLocation,nextLocation:L.nextLocation}))},[n.window,d,u,g,y]);re.useLayoutEffect(()=>n.subscribe(S),[n,S]),re.useEffect(()=>{c.isTransitioning&&!c.flushSync&&h(new Dhe)},[c]),re.useEffect(()=>{if(u&&o&&n.window){let b=o,M=u.promise,_=n.window.document.startViewTransition(async()=>{y(()=>s(b)),await M});_.finished.finally(()=>{h(void 0),p(void 0),a(void 0),l({isTransitioning:!1})}),p(_)}},[y,o,u,n.window]),re.useEffect(()=>{u&&o&&r.location.key===o.location.key&&u.resolve()},[u,d,r.location,o]),re.useEffect(()=>{!c.isTransitioning&&f&&(a(f.state),l({isTransitioning:!0,flushSync:!1,currentLocation:f.currentLocation,nextLocation:f.nextLocation}),v(void 0))},[c.isTransitioning,f]),re.useEffect(()=>{},[]);let x=re.useMemo(()=>({createHref:n.createHref,encodeLocation:n.encodeLocation,go:b=>n.navigate(b),push:(b,M,_)=>n.navigate(b,{state:M,preventScrollReset:_==null?void 0:_.preventScrollReset}),replace:(b,M,_)=>n.navigate(b,{replace:!0,state:M,preventScrollReset:_==null?void 0:_.preventScrollReset})}),[n]),w=n.basename||"/",C=re.useMemo(()=>({router:n,navigator:x,static:!1,basename:w}),[n,x,w]),E=re.useMemo(()=>({v7_relativeSplatPath:n.future.v7_relativeSplatPath}),[n.future.v7_relativeSplatPath]);return re.useEffect(()=>Che(i,n.future),[i,n.future]),re.createElement(re.Fragment,null,re.createElement(aC.Provider,{value:C},re.createElement(R6.Provider,{value:r},re.createElement(Ihe.Provider,{value:g.current},re.createElement(Phe.Provider,{value:c},re.createElement(_he,{basename:w,location:r.location,navigationType:r.historyAction,navigator:x,future:E},r.initialized||n.future.v7_partialHydration?re.createElement(Ohe,{routes:n.routes,future:n.future,state:r}):e))))),null)}const Ohe=re.memo(Fhe);function Fhe(t){let{routes:e,future:n,state:i}=t;return che(e,void 0,i,n)}var PN;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(PN||(PN={}));var IN;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(IN||(IN={}));function zhe(t){let e=re.useRef(Eb(t)),n=re.useRef(!1),i=AA(),r=re.useMemo(()=>Ehe(i.search,n.current?null:e.current),[i.search]),s=ohe(),o=re.useCallback((a,c)=>{const l=Eb(typeof a=="function"?a(r):a);n.current=!0,s("?"+l,c)},[s,r]);return[r,o]}var Nu=typeof self<"u"?self:{};function Rb(t,e){e:{for(var n=["CLOSURE_FLAGS"],i=Nu,r=0;r<n.length;r++)if((i=i[n[r]])==null){n=null;break e}n=i}return(t=n&&n[t])!=null?t:e}function Kl(){throw Error("Invalid UTF8")}function MN(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}let ry,Kw;const Uhe=typeof TextDecoder<"u";let Bhe;const $he=typeof TextEncoder<"u";function I6(t){if($he)t=(Bhe||(Bhe=new TextEncoder)).encode(t);else{let n=0;const i=new Uint8Array(3*t.length);for(let r=0;r<t.length;r++){var e=t.charCodeAt(r);if(e<128)i[n++]=e;else{if(e<2048)i[n++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&r<t.length){const s=t.charCodeAt(++r);if(s>=56320&&s<=57343){e=1024*(e-55296)+s-56320+65536,i[n++]=e>>18|240,i[n++]=e>>12&63|128,i[n++]=e>>6&63|128,i[n++]=63&e|128;continue}r--}e=65533}i[n++]=e>>12|224,i[n++]=e>>6&63|128}i[n++]=63&e|128}}t=n===i.length?i:i.subarray(0,n)}return t}var a0,M6=Rb(610401301,!1),Hhe=Rb(653718497,Rb(1,!0));const kN=Nu.navigator;function bb(t){return!!M6&&!!a0&&a0.brands.some(({brand:e})=>e&&e.indexOf(t)!=-1)}function Fs(t){var e;return(e=Nu.navigator)&&(e=e.userAgent)||(e=""),e.indexOf(t)!=-1}function Ic(){return!!M6&&!!a0&&a0.brands.length>0}function Yw(){return Ic()?bb("Chromium"):(Fs("Chrome")||Fs("CriOS"))&&!(!Ic()&&Fs("Edge"))||Fs("Silk")}function PA(t){return PA[" "](t),t}a0=kN&&kN.userAgentData||null,PA[" "]=function(){};var Vhe=!Ic()&&(Fs("Trident")||Fs("MSIE"));!Fs("Android")||Yw(),Yw(),Fs("Safari")&&(Yw()||!Ic()&&Fs("Coast")||!Ic()&&Fs("Opera")||!Ic()&&Fs("Edge")||(Ic()?bb("Microsoft Edge"):Fs("Edg/"))||Ic()&&bb("Opera"));var k6={},ig=null;function jhe(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):"=.".indexOf(t[e-1])!=-1&&(n="=.".indexOf(t[e-2])!=-1?n-2:n-1);var i=new Uint8Array(n),r=0;return function(s,o){function a(p){for(;c<s.length;){var f=s.charAt(c++),v=ig[f];if(v!=null)return v;if(!/^[\s\xa0]*$/.test(f))throw Error("Unknown base64 encoding at char: "+f)}return p}L6();for(var c=0;;){var l=a(-1),u=a(0),h=a(64),d=a(64);if(d===64&&l===-1)break;o(l<<2|u>>4),h!=64&&(o(u<<4&240|h>>2),d!=64&&o(h<<6&192|d))}}(t,function(s){i[r++]=s}),r!==n?i.subarray(0,r):i}function L6(){if(!ig){ig={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;n<5;n++){var i=t.concat(e[n].split(""));k6[n]=i;for(var r=0;r<i.length;r++){var s=i[r];ig[s]===void 0&&(ig[s]=r)}}}}var D6=typeof Uint8Array<"u",N6=!Vhe&&typeof btoa=="function";function LN(t){if(!N6){var e;e===void 0&&(e=0),L6(),e=k6[e];var n=Array(Math.floor(t.length/3)),i=e[64]||"";let c=0,l=0;for(;c<t.length-2;c+=3){var r=t[c],s=t[c+1],o=t[c+2],a=e[r>>2];r=e[(3&r)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],n[l++]=a+r+s+o}switch(a=0,o=i,t.length-c){case 2:o=e[(15&(a=t[c+1]))<<2]||i;case 1:t=t[c],n[l]=e[t>>2]+e[(3&t)<<4|a>>4]+o+i}return n.join("")}for(e="",n=0,i=t.length-10240;n<i;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const DN=/[-_.]/g,Whe={"-":"+",_:"/",".":"="};function Ghe(t){return Whe[t]||""}function O6(t){if(!N6)return jhe(t);DN.test(t)&&(t=t.replace(DN,Ghe)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function H0(t){return D6&&t!=null&&t instanceof Uint8Array}var Bd={};let qhe;function F6(t){if(t!==Bd)throw Error("illegal external caller")}function Ou(){return qhe||(qhe=new Va(null,Bd))}function IA(t){F6(Bd);var e=t.g;return(e=e==null||H0(e)?e:typeof e=="string"?O6(e):null)==null?e:t.g=e}var Va=class{constructor(t,e){if(F6(e),this.g=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}h(){return new Uint8Array(IA(this)||0)}};function z6(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}let Xhe;function uC(){const t=Error();z6(t,"incident"),function(e){Nu.setTimeout(()=>{throw e},0)}(t)}function Tb(t){return z6(t=Error(t),"warning"),t}function MA(){return typeof BigInt=="function"}function Cs(t){return Array.prototype.slice.call(t)}var gp=typeof Symbol=="function"&&typeof Symbol()=="symbol";function hC(t){return typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():t}var V0=hC(),NN=hC("0di"),Jw=hC("2ex"),Vm=hC("1oa"),dC=gp?(t,e)=>{t[V0]|=e}:(t,e)=>{t.G!==void 0?t.G|=e:Object.defineProperties(t,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})},j1=gp?(t,e)=>{t[V0]&=~e}:(t,e)=>{t.G!==void 0&&(t.G&=~e)},Wn=gp?t=>0|t[V0]:t=>0|t.G,un=gp?t=>t[V0]:t=>t.G,Hn=gp?(t,e)=>{t[V0]=e}:(t,e)=>{t.G!==void 0?t.G=e:Object.defineProperties(t,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})};function Yu(t){return dC(t,34),t}function Khe(t,e){Hn(e,-30975&(0|t))}function Ab(t,e){Hn(e,-30941&(34|t))}var kA,j0={},U6={};function ON(t){return!(!t||typeof t!="object"||t.Ja!==U6)}function pC(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}function LA(t,e,n){if(t!=null){if(typeof t=="string")t=t?new Va(t,Bd):Ou();else if(t.constructor!==Va)if(H0(t))t=t.length?new Va(n?t:new Uint8Array(t),Bd):Ou();else{if(!e)throw Error();t=void 0}}return t}function W1(t){return!(!Array.isArray(t)||t.length)&&!!(1&Wn(t))}const FN=[];function nc(t){if(2&t)throw Error()}Hn(FN,55),kA=Object.freeze(FN);class G1{constructor(e,n,i){this.l=0,this.g=e,this.h=n,this.m=i}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new G1(this.g,this.h,this.m)}}let Qc;function B6(t,e){(e=Qc?e[Qc]:void 0)&&(t[Qc]=Cs(e))}var Yhe=Object.freeze({}),Jhe=Object.freeze({}),Qhe=Object.freeze({});function fC(t){return t.Qa=!0,t}var Zhe=fC(t=>typeof t=="number"),zN=fC(t=>typeof t=="string"),ede=fC(t=>typeof t=="boolean"),mC=typeof Nu.BigInt=="function"&&typeof Nu.BigInt(0)=="bigint",Pb=fC(t=>mC?t>=nde&&t<=rde:t[0]==="-"?UN(t,tde):UN(t,ide));const tde=Number.MIN_SAFE_INTEGER.toString(),nde=mC?BigInt(Number.MIN_SAFE_INTEGER):void 0,ide=Number.MAX_SAFE_INTEGER.toString(),rde=mC?BigInt(Number.MAX_SAFE_INTEGER):void 0;function UN(t,e){if(t.length>e.length)return!1;if(t.length<e.length||t===e)return!0;for(let n=0;n<t.length;n++){const i=t[n],r=e[n];if(i>r)return!1;if(i<r)return!0}}const sde=typeof Uint8Array.prototype.slice=="function";let $6,vn=0,Kn=0;function BN(t){const e=t>>>0;vn=e,Kn=(t-e)/4294967296>>>0}function $d(t){if(t<0){BN(-t);const[e,n]=FA(vn,Kn);vn=e>>>0,Kn=n>>>0}else BN(t)}function DA(t){const e=$6||($6=new DataView(new ArrayBuffer(8)));e.setFloat32(0,+t,!0),Kn=0,vn=e.getUint32(0,!0)}function NA(t,e){return 4294967296*e+(t>>>0)}function OA(t,e){const n=2147483648&e;return n&&(e=~e>>>0,(t=1+~t>>>0)==0&&(e=e+1>>>0)),t=NA(t,e),n?-t:t}function q1(t,e){if(t>>>=0,(e>>>=0)<=2097151)var n=""+(4294967296*e+t);else MA()?n=""+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,t>=1e7&&(n+=t/1e7>>>0,t%=1e7),n>=1e7&&(e+=n/1e7>>>0,n%=1e7),n=e+$N(n)+$N(t));return n}function $N(t){return t=String(t),"0000000".slice(t.length)+t}function gC(t){if(t.length<16)$d(Number(t));else if(MA())t=BigInt(t),vn=Number(t&BigInt(4294967295))>>>0,Kn=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+(t[0]==="-");Kn=vn=0;const n=t.length;for(let i=e,r=(n-e)%6+e;r<=n;i=r,r+=6){const s=Number(t.slice(i,r));Kn*=1e6,vn=1e6*vn+s,vn>=4294967296&&(Kn+=Math.trunc(vn/4294967296),Kn>>>=0,vn>>>=0)}if(e){const[i,r]=FA(vn,Kn);vn=i,Kn=r}}}function FA(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}function El(t){return t==null||typeof t=="number"?t:t==="NaN"||t==="Infinity"||t==="-Infinity"?Number(t):void 0}function H6(t){return t==null||typeof t=="boolean"?t:typeof t=="number"?!!t:void 0}const ode=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function vC(t){const e=typeof t;switch(e){case"bigint":return!0;case"number":return Number.isFinite(t)}return e==="string"&&ode.test(t)}function vp(t){if(t==null)return t;if(typeof t=="string"){if(!t)return;t=+t}return typeof t=="number"&&Number.isFinite(t)?0|t:void 0}function ade(t){if(t==null)return t;if(typeof t=="string"){if(!t)return;t=+t}return typeof t=="number"&&Number.isFinite(t)?t>>>0:void 0}function HN(t){return t[0]!=="-"&&(t.length<20||t.length===20&&Number(t.substring(0,6))<184467)}function zA(t){return t=Math.trunc(t),Number.isSafeInteger(t)||($d(t),t=OA(vn,Kn)),t}function UA(t){var e=Math.trunc(Number(t));if(Number.isSafeInteger(e))return String(e);if((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),!(t[0]==="-"?t.length<20||t.length===20&&Number(t.substring(0,7))>-922337:t.length<19||t.length===19&&Number(t.substring(0,6))<922337))if(gC(t),t=vn,2147483648&(e=Kn))if(MA())t=""+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,i]=FA(t,e);t="-"+q1(n,i)}else t=q1(t,e);return t}function X1(t){return t==null?t:typeof t=="bigint"?(Pb(t)?t=Number(t):(t=BigInt.asIntN(64,t),t=Pb(t)?Number(t):String(t)),t):vC(t)?typeof t=="number"?zA(t):UA(t):void 0}function cde(t){if(t==null)return t;var e=typeof t;if(e==="bigint")return String(BigInt.asUintN(64,t));if(vC(t)){if(e==="string")return e=Math.trunc(Number(t)),Number.isSafeInteger(e)&&e>=0?t=String(e):((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),HN(t)||(gC(t),t=q1(vn,Kn))),t;if(e==="number")return(t=Math.trunc(t))>=0&&Number.isSafeInteger(t)?t:function(n){if(n<0){$d(n);const i=q1(vn,Kn);return n=Number(i),Number.isSafeInteger(n)?n:i}return HN(String(n))?n:($d(n),NA(vn,Kn))}(t)}}function V6(t){if(typeof t!="string")throw Error();return t}function yp(t){if(t!=null&&typeof t!="string")throw Error();return t}function Zc(t){return t==null||typeof t=="string"?t:void 0}function BA(t,e,n,i){if(t!=null&&typeof t=="object"&&t.X===j0)return t;if(!Array.isArray(t))return n?2&i?(t=e[NN])?e=t:(Yu((t=new e).u),e=e[NN]=t):e=new e:e=void 0,e;let r=n=Wn(t);return r===0&&(r|=32&i),r|=2&i,r!==n&&Hn(t,r),new e(t)}function lde(t,e,n){if(e)e:{if(!vC(e=t))throw Tb("int64");switch(typeof e){case"string":e=UA(e);break e;case"bigint":if(t=e=BigInt.asIntN(64,e),zN(t)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(t))throw Error(String(t))}else if(Zhe(t)&&!Number.isSafeInteger(t))throw Error(String(t));e=mC?BigInt(e):ede(e)?e?"1":"0":zN(e)?e.trim()||"0":String(e);break e;default:e=zA(e)}}else e=X1(t);return typeof(n=(t=e)==null?n?0:void 0:t)=="string"&&(e=+n,Number.isSafeInteger(e))?e:n}function j6(t){if(jm===void 0&&(jm=typeof Proxy=="function"?q6(Proxy):null),!jm||!G6())return t;let e=ur==null?void 0:ur.get(t);return e||(Math.random()>.01?t:(function(n){if(Qw===void 0){const i=new jm([],{});Qw=Array.prototype.concat.call([],i).length===1}Qw&&typeof Symbol=="function"&&Symbol.isConcatSpreadable&&(n[Symbol.isConcatSpreadable]=!0)}(t),e=new jm(t,{set:(n,i,r)=>(uC(),n[i]=r,!0)}),function(n,i){(ur||(ur=new Su)).set(n,i),(Vy||(Vy=new Su)).set(i,n)}(t,e),e))}let ur,Vy,jm,Su,Qw,ms,K1,W6,ude;function G6(){return Su===void 0&&(Su=typeof WeakMap=="function"?q6(WeakMap):null),Su}function q6(t){try{return t.toString().indexOf("[native code]")!==-1?t:null}catch{return null}}function $A(t,e,n){var o;if(G6()){if((o=ms==null?void 0:ms.get(e))!=null&&o.get(t)){if(n)return}else if(Math.random()>.01)return;var i=t.length;n={length:i};for(var r=0;r<Math.min(i,10);r++){if(i<=10)var s=r;else{s=i/10;const a=Math.floor(r*s);s=a+Math.floor(Math.random()*(Math.floor((r+1)*s)-a))}n[s]=t[s]}X6(t,n)?((r=(i=ms||(ms=new Su)).get(e))||(r=new Su,i.set(e,r)),r.set(t,n)):(uC(),c0(t,e))}}function Y1(t,e){var i;const n=(i=ms==null?void 0:ms.get(e))==null?void 0:i.get(t);n&&!X6(t,n)&&(uC(),c0(t,e))}function X6(t,e){if(t.length!==e.length)return!1;for(const r in e){var n,i=Number(r);if((n=Number.isInteger(i))&&(n=t[i],i=e[i],n=!(Number.isNaN(n)?Number.isNaN(i):n===i)),n)return!1}return!0}function yC(t){if(t&&(ms!=null&&ms.has(t))){var e=t.u;if(e)for(let n=0;n<e.length;n++){const i=e[n];if(n===e.length-1&&pC(i))for(const r in i){const s=i[r];Array.isArray(s)&&Y1(s,t)}else Array.isArray(i)&&Y1(i,t)}}}function c0(t,e){var n;(n=ms==null?void 0:ms.get(e))==null||n.delete(t)}function el(t,e,n){return t=K6(t,e[0],e[1],n?1:2),e!==W6&&n&&dC(t,16384),t}function K6(t,e,n,i){if(i=i??0,t==null&&(t=K1),K1=void 0,t==null){var r=96;n?(t=[n],r|=512):t=[],e&&(r=-33521665&r|(1023&e)<<15)}else{if(!Array.isArray(t))throw Error("narr");if(2048&(r=Wn(t)))throw Error("farr");if(64&r)return t;if(i===1||i===2||(r|=64),n&&(r|=512,n!==t[0]))throw Error("mid");e:{if(i=(n=t).length){const s=i-1;if(pC(n[s])){if((e=s-(+!!(512&(r|=256))-1))>=1024)throw Error("pvtlmt");r=-33521665&r|(1023&e)<<15;break e}}if(e){if((e=Math.max(e,i-(+!!(512&r)-1)))>1024)throw Error("spvt");r=-33521665&r|(1023&e)<<15}}}return Hn(t,r),t}const hde={};let dde=function(){try{return PA(new class extends Map{constructor(){super()}}),!1}catch{return!0}}();class Zw{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,n){return this.g.set(e,n),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,n){return this.g.forEach(e,n)}[Symbol.iterator](){return this.entries()}}const pde=dde?(Object.setPrototypeOf(Zw.prototype,Map.prototype),Object.defineProperties(Zw.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),Zw):class extends Map{constructor(){super()}};function VN(t){return t}function eE(t){if(2&t.M)throw Error("Cannot mutate an immutable Map")}var Js=class extends pde{constructor(t,e,n=VN,i=VN){super();let r=Wn(t);r|=64,Hn(t,r),this.M=r,this.T=e,this.S=n,this.Z=this.T?fde:i;for(let s=0;s<t.length;s++){const o=t[s],a=n(o[0],!1,!0);let c=o[1];e?c===void 0&&(c=null):c=i(o[1],!1,!0,void 0,void 0,r),super.set(a,c)}}pa(t=jN){if(this.size!==0)return this.Y(t)}Y(t=jN){const e=[],n=super.entries();for(var i;!(i=n.next()).done;)(i=i.value)[0]=t(i[0]),i[1]=t(i[1]),e.push(i);return e}clear(){eE(this),super.clear()}delete(t){return eE(this),super.delete(this.S(t,!0,!1))}entries(){var t=this.oa();return new G1(t,mde,this)}keys(){return this.Ia()}values(){var t=this.oa();return new G1(t,Js.prototype.get,this)}forEach(t,e){super.forEach((n,i)=>{t.call(e,this.get(i),i,this)})}set(t,e){return eE(this),(t=this.S(t,!0,!1))==null?this:e==null?(super.delete(t),this):super.set(t,this.Z(e,!0,!0,this.T,!1,this.M))}Oa(t){const e=this.S(t[0],!1,!0);t=t[1],t=this.T?t===void 0?null:t:this.Z(t,!1,!0,void 0,!1,this.M),super.set(e,t)}has(t){return super.has(this.S(t,!1,!1))}get(t){t=this.S(t,!1,!1);const e=super.get(t);if(e!==void 0){var n=this.T;return n?((n=this.Z(e,!1,!0,n,this.ta,this.M))!==e&&super.set(t,n),n):e}}oa(){return Array.from(super.keys())}Ia(){return super.keys()}[Symbol.iterator](){return this.entries()}};function fde(t,e,n,i,r,s){return t=BA(t,i,n,s),r&&(t=xC(t)),t}function jN(t){return t}function mde(t){return[t,this.get(t)]}let gde;function WN(){return gde||(gde=new Js(Yu([]),void 0,void 0,void 0,hde))}function HA(t,e,n,i,r){if(t!=null){if(Array.isArray(t))t=W1(t)?void 0:r&&2&Wn(t)?t:SC(t,e,n,i!==void 0,r);else if(pC(t)){const s={};for(let o in t)s[o]=HA(t[o],e,n,i,r);t=s}else t=e(t,i);return t}}function SC(t,e,n,i,r){const s=i||n?Wn(t):0;i=i?!!(32&s):void 0;const o=Cs(t);for(let a=0;a<o.length;a++)o[a]=HA(o[a],e,n,i,r);return n&&(B6(o,t),n(s,o)),o}function vde(t){return HA(t,VA,void 0,void 0,!1)}function VA(t){return t.X===j0?t.toJSON():t instanceof Js?t.pa(vde):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return Pb(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(W1(e))return}else{if(H0(e))return LN(e);if(e instanceof Va){const n=e.g;return n==null?"":typeof n=="string"?n:e.g=LN(n)}if(e instanceof Js)return e.pa()}}return e}(t)}function Ib(t,e,n=Ab){if(t!=null){if(D6&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var i=Wn(t);return 2&i?t:(e&&(e=i===0||!!(32&i)&&!(64&i||!(16&i))),e?(Hn(t,-12293&(34|i)),t):SC(t,Ib,4&i?Ab:n,!0,!0))}return t.X===j0?(n=t.u,t=2&(i=un(n))?t:jA(t,n,i,!0)):t instanceof Js&&!(2&t.M)&&(n=Yu(t.Y(Ib)),t=new Js(n,t.T,t.S,t.Z)),t}}function jA(t,e,n,i){return yC(t),t=t.constructor,K1=e=Y6(e,n,i),e=new t(e),K1=void 0,e}function Y6(t,e,n){const i=n||2&e?Ab:Khe,r=!!(32&e);return t=function(s,o,a){const c=Cs(s);var l=c.length;const u=256&o?c[l-1]:void 0;for(l+=u?-1:0,o=512&o?1:0;o<l;o++)c[o]=a(c[o]);if(u){o=c[o]={};for(const h in u)o[h]=a(u[h])}return B6(c,s),c}(t,e,s=>Ib(s,r,i)),dC(t,32|(n?2:0)),t}function xC(t){const e=t.u,n=un(e);return 2&n?jA(t,e,n,!1):t}function J6(t,e,n,i){return!(4&e)||n!=null}function cl(t,e){return ma(t=t.u,un(t),e)}function GN(t,e,n,i){if(!((e=i+(+!!(512&e)-1))<0||e>=t.length||e>=n))return t[e]}function ma(t,e,n,i){if(n===-1)return null;const r=e>>15&1023||536870912;if(!(n>=r)){var s=t.length;return i&&256&e&&(i=t[s-1][n])!=null?(GN(t,e,r,n)&&Jw!=null&&((e=(t=Xhe??(Xhe={}))[Jw]||0)>=4||(t[Jw]=e+1,uC())),i):GN(t,e,r,n)}return 256&e?t[t.length-1][n]:void 0}function Cn(t,e,n){const i=t.u;let r=un(i);return nc(r),On(i,r,e,n),t}function On(t,e,n,i){const r=e>>15&1023||536870912;if(n>=r){let s,o=e;if(256&e)s=t[t.length-1];else{if(i==null)return o;s=t[r+(+!!(512&e)-1)]={},o|=256}return s[n]=i,n<r&&(t[n+(+!!(512&e)-1)]=void 0),o!==e&&Hn(t,o),o}return t[n+(+!!(512&e)-1)]=i,256&e&&n in(t=t[t.length-1])&&delete t[n],e}function Sp(t,e,n,i,r){var s=2&e;r=ma(t,e,n,r),Array.isArray(r)||(r=kA);const o=!(2&i);i=!(1&i);const a=!!(32&e);let c=Wn(r);return c!==0||!a||s||o?1&c||(c|=1,Hn(r,c)):(c|=33,Hn(r,c)),s?(t=!1,2&c||(Yu(r),t=!!(4&c)),(i||t)&&Object.freeze(r)):(s=!!(2&c)||!!(2048&c),i&&s?(r=Cs(r),s=1,a&&!o&&(s|=32),Hn(r,s),On(t,e,n,r)):o&&32&c&&!s&&j1(r,32)),r}function jy(t,e){t=t.u;let n=un(t);const i=ma(t,n,e),r=El(i);return r!=null&&r!==i&&On(t,n,e,r),r}function Q6(t){t=t.u;let e=un(t);const n=ma(t,e,1),i=LA(n,!0,!!(34&e));return i!=null&&i!==n&&On(t,e,1,i),i}function pu(){return Yhe===void 0?2:5}function fu(t,e,n,i,r,s){const o=t.u;let a=un(o);i=2&a?1:i,s=!!s,r=Z6(o,a,e,r);var c=Wn(r),l=r;if(Y1(l,t),i!==2&&i!==1||c0(l,t),J6(t,c,void 0)){4&c&&(r=Cs(r),c=Fu(c,a),a=On(o,a,e,r));let h=l=0;for(;l<r.length;l++){const d=n(r[l]);d!=null&&(r[h++]=d)}h<l&&(r.length=h),c=-4097&(20|(c=e$(c,a))),Hn(r,c&=-8193),2&c&&Object.freeze(r)}let u;return i===1||i===4&&32&c?La(c)||(t=c,(c|=2)!==t&&Hn(r,c),Object.freeze(r)):(n=i===5&&(!!(32&c)||La(c)||!!(ur!=null&&ur.get(r))),(i===2||n)&&La(c)&&(r=Cs(r),c=Hd(c=Fu(c,a),a,s),Hn(r,c),a=On(o,a,e,r)),La(c)||(e=c,(c=Hd(c,a,s))!==e&&Hn(r,c)),n?(u=j6(r),$A(r,t,!0)):i!==2||s||(ur==null||ur.delete(r))),u||r}function Z6(t,e,n,i){return t=ma(t,e,n,i),Array.isArray(t)?t:kA}function e$(t,e){return t===0&&(t=Fu(t,e)),1|t}function La(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function t$(t){t=Cs(t);for(let e=0;e<t.length;e++){const n=t[e]=Cs(t[e]);Array.isArray(n[1])&&(n[1]=Yu(n[1]))}return t}function Mb(t,e,n,i){t=t.u;let r=un(t);nc(r),On(t,r,e,(i==="0"?Number(n)===0:n===i)?void 0:n)}function tE(t,e){var n=V$;return GA(WA(t=t.u),t,un(t),n)===e?e:-1}function WA(t){if(gp)return t[Vm]??(t[Vm]=new Map);if(Vm in t)return t[Vm];const e=new Map;return Object.defineProperty(t,Vm,{value:e}),e}function n$(t,e,n,i){const r=WA(t),s=GA(r,t,e,n);return s!==i&&(s&&(e=On(t,e,s)),r.set(n,i)),e}function GA(t,e,n,i){let r=t.get(i);if(r!=null)return r;r=0;for(let s=0;s<i.length;s++){const o=i[s];ma(e,n,o)!=null&&(r!==0&&(n=On(e,n,r)),r=o)}return t.set(i,r),r}function qA(t,e,n,i){let r,s=un(t);if((i=ma(t,s,n,i))!=null&&i.X===j0)return(e=xC(i))!==i&&On(t,s,n,e),e.u;if(Array.isArray(i)){const o=Wn(i);r=2&o?el(Y6(i,o,!1),e,!0):64&o?i:el(r,e,!0)}else r=el(void 0,e,!0);return r!==i&&On(t,s,n,r),r}function i$(t,e,n,i){t=t.u;let r=un(t);return(e=BA(i=ma(t,r,n,i),e,!1,r))!==i&&e!=null&&On(t,r,n,e),e}function Jt(t,e,n,i=!1){if((e=i$(t,e,n,i))==null)return e;if(t=t.u,!(2&(i=un(t)))){const r=xC(e);r!==e&&On(t,i,n,e=r)}return e}function r$(t,e,n,i,r,s,o){const a=t.u;var c=!!(2&e);r=c?1:r,s=!!s,o&&(o=!c),c=Z6(a,e,i);var l=Wn(c),u=c;if(Y1(u,t),r!==2&&r!==1||c0(u,t),!(u=!!(4&l))){var h=c,d=e;const f=!!(2&(l=e$(l,e)));f&&(d|=2);let v=!f,g=!0,m=0,y=0;for(;m<h.length;m++){const S=BA(h[m],n,!1,d);if(S instanceof n){if(!f){const x=!!(2&Wn(S.u));v&&(v=!x),g&&(g=x)}h[y++]=S}}y<m&&(h.length=y),l|=4,l=g?16|l:-17&l,Hn(h,l=v?8|l:-9&l),f&&Object.freeze(h)}if(o&&!(8&l||!c.length&&(r===1||r===4&&32&l))){for(La(l)?(c=Cs(c),l=Fu(l,e),e=On(a,e,i,c)):c0(c,t),n=c,o=l,h=0;h<n.length;h++)(l=n[h])!==(d=xC(l))&&(n[h]=d);o|=8,o=n.length?-17&o:16|o,Hn(n,o),l=o}let p;return r===1||r===4&&32&l?La(l)||(t=l,(l|=!c.length||16&l&&(!u||32&l)?2:2048)!==t&&Hn(c,l),Object.freeze(c)):(u=r===5&&(!!(32&l)||La(l)||!!(ur!=null&&ur.get(c))),(r===2||u)&&La(l)&&(c=Cs(c),l=Hd(l=Fu(l,e),e,s),Hn(c,l),e=On(a,e,i,c)),La(l)||(i=l,(l=Hd(l,e,s))!==i&&Hn(c,l)),u?(p=j6(c),$A(c,t,!0)):r!==2||s||(ur==null||ur.delete(c))),p||c}function Za(t,e,n){const i=un(t.u);return r$(t,i,e,n,pu(),!1,!(2&i))}function ct(t,e,n,i){return i==null&&(i=void 0),Cn(t,n,i)}function Rg(t,e,n,i){i==null&&(i=void 0);e:{t=t.u;let r=un(t);if(nc(r),i==null){const s=WA(t);if(GA(s,t,r,n)!==e)break e;s.set(n,0)}else r=n$(t,r,n,e);On(t,r,e,i)}}function Fu(t,e){return-2049&(t=32|(2&e?2|t:-3&t))}function Hd(t,e,n){return 32&e&&n||(t&=-33),t}function J1(t,e,n,i){const r=un(t.u);nc(r),t=r$(t,r,n,e,2,!0),i=i??new n,t.push(i),2&Wn(i.u)?j1(t,8):j1(t,16)}function Io(t,e){return t??e}function $s(t,e){return vp(cl(t,e))}function ti(t,e){return Io(jy(t,e),0)}function ca(t,e){return Io(Zc(cl(t,e)),"")}function l0(t,e,n){if(n!=null&&typeof n!="boolean")throw t=typeof n,Error(`Expected boolean but got ${t!="object"?t:n?Array.isArray(n)?"array":t:"null"}: ${n}`);Cn(t,e,n)}function la(t,e,n){if(n!=null){if(typeof n!="number"||!Number.isFinite(n))throw Tb("int32");n|=0}Cn(t,e,n)}function nt(t,e,n){if(n!=null&&typeof n!="number")throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);Cn(t,e,n)}function Q1(t,e,n){{const a=t.u;let c=un(a);if(nc(c),n==null)On(a,c,e);else{n=(Vy==null?void 0:Vy.get(n))||n;var i,r=Wn(n),s=r,o=!!(2&r)||Object.isFrozen(n);if((i=!o)&&((i=Qhe===void 0)||(i=!!Hhe&&Jhe!==void 0)),J6(t,r)){r=21,o&&(n=Cs(n),s=0,r=Hd(r=Fu(r,c),c,!0));for(let l=0;l<n.length;l++)n[l]=V6(n[l])}i?(n=Cs(n),s=0,r=Hd(r=Fu(r,c),c,!0)):o||$A(n,t),r!==s&&Hn(n,r),On(a,c,e,n)}}}function CC(t,e,n){nc(un(t.u)),fu(t,e,Zc,2,void 0,!0).push(V6(n))}function s$(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function XA(){return Error("Failed to read varint, encoding is invalid.")}function o$(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function KA(t){if(typeof t=="string")return{buffer:O6(t),O:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),O:!1};if(t.constructor===Uint8Array)return{buffer:t,O:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),O:!1};if(t.constructor===Va)return{buffer:IA(t)||new Uint8Array(0),O:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),O:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function YA(t,e){let n,i=0,r=0,s=0;const o=t.h;let a=t.g;do n=o[a++],i|=(127&n)<<s,s+=7;while(s<32&&128&n);for(s>32&&(r|=(127&n)>>4),s=3;s<32&&128&n;s+=7)n=o[a++],r|=(127&n)<<s;if(xu(t,a),n<128)return e(i>>>0,r>>>0);throw XA()}function JA(t){let e=0,n=t.g;const i=n+10,r=t.h;for(;n<i;){const s=r[n++];if(e|=s,(128&s)==0)return xu(t,n),!!(127&e)}throw XA()}function ll(t){const e=t.h;let n=t.g,i=e[n++],r=127&i;if(128&i&&(i=e[n++],r|=(127&i)<<7,128&i&&(i=e[n++],r|=(127&i)<<14,128&i&&(i=e[n++],r|=(127&i)<<21,128&i&&(i=e[n++],r|=i<<28,128&i&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw XA();return xu(t,n),r}function ul(t){return ll(t)>>>0}function kb(t){var e=t.h;const n=t.g,i=e[n],r=e[n+1],s=e[n+2];return e=e[n+3],xu(t,t.g+4),(i<<0|r<<8|s<<16|e<<24)>>>0}function Lb(t){var e=kb(t);t=2*(e>>31)+1;const n=e>>>23&255;return e&=8388607,n==255?e?NaN:t*(1/0):n==0?1401298464324817e-60*t*e:t*Math.pow(2,n-150)*(e+8388608)}function yde(t){return ll(t)}function nE(t,e,{ca:n=!1}={}){t.ca=n,e&&(e=KA(e),t.h=e.buffer,t.m=e.O,t.j=0,t.l=t.h.length,t.g=t.j)}function xu(t,e){if(t.g=e,e>t.l)throw o$(t.l,e)}function a$(t,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,i=n+e;if(i>t.l)throw o$(e,t.l-n);return t.g=i,n}function c$(t,e){if(e==0)return Ou();var n=a$(t,e);return t.ca&&t.m?n=t.h.subarray(n,n+e):(t=t.h,n=n===(e=n+e)?new Uint8Array(0):sde?t.slice(n,e):new Uint8Array(t.subarray(n,e))),n.length==0?Ou():new Va(n,Bd)}Js.prototype.toJSON=void 0,Js.prototype.Ja=U6;var qN=[];function l$(t){var e=t.g;if(e.g==e.l)return!1;t.l=t.g.g;var n=ul(t.g);if(e=n>>>3,!((n&=7)>=0&&n<=5))throw s$(n,t.l);if(e<1)throw Error(`Invalid field number: ${e} (at position ${t.l})`);return t.m=e,t.h=n,!0}function Wy(t){switch(t.h){case 0:t.h!=0?Wy(t):JA(t.g);break;case 1:xu(t=t.g,t.g+8);break;case 2:if(t.h!=2)Wy(t);else{var e=ul(t.g);xu(t=t.g,t.g+e)}break;case 5:xu(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!l$(t))throw Error("Unmatched start-group tag: stream EOF");if(t.h==4){if(t.m!=e)throw Error("Unmatched end-group tag");break}Wy(t)}break;default:throw s$(t.h,t.l)}}function W0(t,e,n){const i=t.g.l,r=ul(t.g),s=t.g.g+r;let o=s-i;if(o<=0&&(t.g.l=s,n(e,t,void 0,void 0,void 0),o=s-t.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${r} bytes, instead read ${r-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return t.g.g=s,t.g.l=i,e}function QA(t){var e=ul(t.g),n=a$(t=t.g,e);if(t=t.h,Uhe){var i,r=t;(i=Kw)||(i=Kw=new TextDecoder("utf-8",{fatal:!0})),e=n+e,r=n===0&&e===r.length?r:r.subarray(n,e);try{var s=i.decode(r)}catch(a){if(ry===void 0){try{i.decode(new Uint8Array([128]))}catch{}try{i.decode(new Uint8Array([97])),ry=!0}catch{ry=!1}}throw!ry&&(Kw=void 0),a}}else{e=(s=n)+e,n=[];let a,c=null;for(;s<e;){var o=t[s++];o<128?n.push(o):o<224?s>=e?Kl():(a=t[s++],o<194||(192&a)!=128?(s--,Kl()):n.push((31&o)<<6|63&a)):o<240?s>=e-1?Kl():(a=t[s++],(192&a)!=128||o===224&&a<160||o===237&&a>=160||(192&(i=t[s++]))!=128?(s--,Kl()):n.push((15&o)<<12|(63&a)<<6|63&i)):o<=244?s>=e-2?Kl():(a=t[s++],(192&a)!=128||a-144+(o<<28)>>30||(192&(i=t[s++]))!=128||(192&(r=t[s++]))!=128?(s--,Kl()):(o=(7&o)<<18|(63&a)<<12|(63&i)<<6|63&r,o-=65536,n.push(55296+(o>>10&1023),56320+(1023&o)))):Kl(),n.length>=8192&&(c=MN(c,n),n.length=0)}s=MN(c,n)}return s}function u$(t){const e=ul(t.g);return c$(t.g,e)}function _C(t,e,n){var i=ul(t.g);for(i=t.g.g+i;t.g.g<i;)n.push(e(t.g))}var sy=[];let Z1;function Oo(t,e,n){e.g?e.m(t,e.g,e.h,n,!0):e.m(t,e.h,n,!0)}var Qe=class{constructor(t,e){this.u=K6(t,e)}toJSON(){return h$(this)}l(){var t=Zde;return t.g?t.l(this,t.g,t.h,!0):t.l(this,t.h,t.defaultValue,!0)}clone(){const t=this.u;return jA(this,t,un(t),!1)}O(){return!!(2&Wn(this.u))}};function h$(t){yC(t),t=Z1?t.u:SC(t.u,VA,void 0,void 0,!1);{var e=!Z1;let l=t.length;if(l){var n=t[l-1],i=pC(n);i?l--:n=void 0;var r=t;if(i){e:{var s,o=n,a=!1;if(o)for(let u in o)isNaN(+u)?(s??(s={}))[u]=o[u]:(i=o[u],Array.isArray(i)&&(W1(i)||ON(i)&&i.size===0)&&(i=null),i==null&&(a=!0),i!=null&&((s??(s={}))[u]=i));if(a||(s=o),s)for(let u in s){a=s;break e}a=null}o=a==null?n!=null:a!==n}for(;l>0&&((s=r[l-1])==null||W1(s)||ON(s)&&s.size===0);l--)var c=!0;(r!==t||o||c)&&(e?(c||o||a)&&(r.length=l):r=Array.prototype.slice.call(r,0,l),a&&r.push(a)),c=r}else c=t}return c}function XN(t){return t?/^\d+$/.test(t)?(gC(t),new Db(vn,Kn)):null:Sde||(Sde=new Db(0,0))}Qe.prototype.X=j0,Qe.prototype.toString=function(){try{return Z1=!0,h$(this).toString()}finally{Z1=!1}};var Db=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let Sde;function KN(t){return t?/^-?\d+$/.test(t)?(gC(t),new Nb(vn,Kn)):null:xde||(xde=new Nb(0,0))}var Nb=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let xde;function gd(t,e,n){for(;n>0||e>127;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function G0(t,e){for(;e>127;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function wC(t,e){if(e>=0)G0(t,e);else{for(let n=0;n<9;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function u0(t,e){t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function Vd(t,e){e.length!==0&&(t.l.push(e),t.h+=e.length)}function eo(t,e,n){G0(t.g,8*e+n)}function ZA(t,e){return eo(t,e,2),e=t.g.end(),Vd(t,e),e.push(t.h),e}function eP(t,e){var n=e.pop();for(n=t.h+t.g.length()-n;n>127;)e.push(127&n|128),n>>>=7,t.h++;e.push(n),t.h++}function EC(t,e,n){eo(t,e,2),G0(t.g,n.length),Vd(t,t.g.end()),Vd(t,n)}function eS(t,e,n,i){n!=null&&(e=ZA(t,e),i(n,t),eP(t,e))}function Fo(){const t=class{constructor(){throw Error()}};return Object.setPrototypeOf(t,t.prototype),t}var tP=Fo(),d$=Fo(),nP=Fo(),iP=Fo(),p$=Fo(),rP=Fo(),f$=Fo(),m$=Fo(),xp=class{constructor(t,e,n){this.g=t,this.h=e,t=tP,this.l=!!t&&n===t||!1}};function RC(t,e){return new xp(t,e,tP)}function g$(t,e,n,i,r){eS(t,n,x$(e,i),r)}const Cde=RC(function(t,e,n,i,r){return t.h===2&&(W0(t,qA(e,i,n),r),!0)},g$),_de=RC(function(t,e,n,i,r){return t.h===2&&(W0(t,qA(e,i,n,!0),r),!0)},g$);var bC=Symbol(),sP=Symbol(),YN=Symbol(),JN=Symbol();let v$,y$;function Ju(t,e,n,i){var r=i[t];if(r)return r;(r={}).W=function(h){switch(typeof h){case"boolean":return W6||(W6=[0,void 0,!0]);case"number":return h>0?void 0:h===0?ude||(ude=[0,void 0]):[-h,void 0];case"string":return[0,h];case"object":return h}}(i[0]);var s=i[1];let o=1;s&&s.constructor===Object&&(r.ia=s,typeof(s=i[++o])=="function"&&(r.na=!0,v$??(v$=s),y$??(y$=i[o+1]),s=i[o+=2]));const a={};for(;s&&Array.isArray(s)&&s.length&&typeof s[0]=="number"&&s[0]>0;){for(var c=0;c<s.length;c++)a[s[c]]=s;s=i[++o]}for(c=1;s!==void 0;){let h;typeof s=="number"&&(c+=s,s=i[++o]);var l=void 0;if(s instanceof xp?h=s:(h=Cde,o--),h==null?void 0:h.l){s=i[++o],l=i;var u=o;typeof s=="function"&&(s=s(),l[u]=s),l=s}for(u=c+1,typeof(s=i[++o])=="number"&&s<0&&(u-=s,s=i[++o]);c<u;c++){const d=a[c];l?n(r,c,h,l,d):e(r,c,h,d)}}return i[t]=r}function S$(t){return Array.isArray(t)?t[0]instanceof xp?t:[_de,t]:[t,void 0]}function x$(t,e){return t instanceof Qe?(yC(t),t.u):Array.isArray(t)?el(t,e,!1):void 0}function oP(t,e,n,i){const r=n.g;t[e]=i?(s,o,a)=>r(s,o,a,i):r}function aP(t,e,n,i,r){const s=n.g;let o,a;t[e]=(c,l,u)=>s(c,l,u,a||(a=Ju(sP,oP,aP,i).W),o||(o=cP(i)),r)}function cP(t){let e=t[YN];if(e!=null)return e;const n=Ju(sP,oP,aP,t);return e=n.na?(i,r)=>v$(i,r,n):(i,r)=>{const s=un(i);for(;l$(r)&&r.h!=4;){var o=r.m,a=n[o];if(a==null){var c=n.ia;c&&(c=c[o])&&(c=wde(c))!=null&&(a=n[o]=c)}a!=null&&a(r,i,o)||(o=(a=r).l,Wy(a),a.ha?a=void 0:(c=a.g.g-o,a.g.g=o,a=c$(a.g,c)),o=i,a&&(Qc||(Qc=Symbol()),(c=o[Qc])?c.push(a):o[Qc]=[a]))}return 16384&s&&Yu(i),!0},t[YN]=e}function wde(t){const e=(t=S$(t))[0].g;if(t=t[1]){const n=cP(t),i=Ju(sP,oP,aP,t).W;return(r,s,o)=>e(r,s,o,i,n)}return e}function TC(t,e,n){t[e]=n.h}function AC(t,e,n,i){let r,s;const o=n.h;t[e]=(a,c,l)=>o(a,c,l,s||(s=Ju(bC,TC,AC,i).W),r||(r=C$(i)))}function C$(t){let e=t[JN];if(!e){const n=Ju(bC,TC,AC,t);e=(i,r)=>_$(i,r,n),t[JN]=e}return e}function _$(t,e,n){for(var i=Wn(t),r=+!!(512&i)-1,s=t.length,o=512&i?1:0,a=s+(256&i?-1:0);o<a;o++){const c=t[o];if(c==null)continue;const l=o-r,u=QN(n,l);u&&u(e,c,l)}if(256&i){i=t[s-1];for(const c in i)r=+c,Number.isNaN(r)||(s=i[r])!=null&&(a=QN(n,r))&&a(e,s,r)}if(t=Qc?t[Qc]:void 0)for(Vd(e,e.g.end()),n=0;n<t.length;n++)Vd(e,IA(t[n])||new Uint8Array(0))}function QN(t,e){var n=t[e];if(n)return n;if((n=t.ia)&&(n=n[e])){var i=(n=S$(n))[0].h;if(n=n[1]){const r=C$(n),s=Ju(bC,TC,AC,n).W;n=t.na?y$(s,r):(o,a,c)=>i(o,a,c,s,r)}else n=i;return t[e]=n}}function Cp(t,e){if(Array.isArray(e)){var n=Wn(e);if(4&n)return e;for(var i=0,r=0;i<e.length;i++){const s=t(e[i]);s!=null&&(e[r++]=s)}return r<i&&(e.length=r),Hn(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}function Yr(t,e,n){return new xp(t,e,n)}function _p(t,e,n){return new xp(t,e,n)}function Jr(t,e,n){On(t,un(t),e,n)}var Ede=RC(function(t,e,n,i,r){return t.h===2&&(t=W0(t,el([void 0,void 0],i,!0),r),nc(i=un(e)),(r=ma(e,i,n))instanceof Js?2&r.M?((r=r.Y()).push(t),On(e,i,n,r)):r.Oa(t):Array.isArray(r)?(2&Wn(r)&&On(e,i,n,r=t$(r)),r.push(t)):On(e,i,n,[t]),!0)},function(t,e,n,i,r){if(e instanceof Js)e.forEach((s,o)=>{eS(t,n,el([o,s],i,!1),r)});else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&eS(t,n,el(o,i,!1),r)}});function w$(t,e,n){if(e=function(i){if(i==null)return i;const r=typeof i;if(r==="bigint")return String(BigInt.asIntN(64,i));if(vC(i)){if(r==="string")return UA(i);if(r==="number")return zA(i)}}(e),e!=null&&(typeof e=="string"&&KN(e),e!=null))switch(eo(t,n,0),typeof e){case"number":t=t.g,$d(e),gd(t,vn,Kn);break;case"bigint":n=BigInt.asUintN(64,e),n=new Nb(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),gd(t.g,n.h,n.g);break;default:n=KN(e),gd(t.g,n.h,n.g)}}function E$(t,e,n){(e=vp(e))!=null&&e!=null&&(eo(t,n,0),wC(t.g,e))}function R$(t,e,n){(e=H6(e))!=null&&(eo(t,n,0),t.g.g.push(e?1:0))}function b$(t,e,n){(e=Zc(e))!=null&&EC(t,n,I6(e))}function T$(t,e,n,i,r){eS(t,n,x$(e,i),r)}function A$(t,e,n){(e=e==null||typeof e=="string"||H0(e)||e instanceof Va?e:void 0)!=null&&EC(t,n,KA(e).buffer)}function P$(t,e,n){return(t.h===5||t.h===2)&&(e=Sp(e,un(e),n,2,!1),t.h==2?_C(t,Lb,e):e.push(Lb(t.g)),!0)}var ka=Yr(function(t,e,n){if(t.h!==1)return!1;var i=t.g;t=kb(i);const r=kb(i);i=2*(r>>31)+1;const s=r>>>20&2047;return t=4294967296*(1048575&r)+t,Jr(e,n,s==2047?t?NaN:i*(1/0):s==0?5e-324*i*t:i*Math.pow(2,s-1075)*(t+4503599627370496)),!0},function(t,e,n){(e=El(e))!=null&&(eo(t,n,1),t=t.g,(n=$6||($6=new DataView(new ArrayBuffer(8)))).setFloat64(0,+e,!0),vn=n.getUint32(0,!0),Kn=n.getUint32(4,!0),u0(t,vn),u0(t,Kn))},Fo()),Ci=Yr(function(t,e,n){return t.h===5&&(Jr(e,n,Lb(t.g)),!0)},function(t,e,n){(e=El(e))!=null&&(eo(t,n,5),t=t.g,DA(e),u0(t,vn))},rP),Rde=_p(P$,function(t,e,n){if((e=Cp(El,e))!=null)for(let o=0;o<e.length;o++){var i=t,r=n,s=e[o];s!=null&&(eo(i,r,5),i=i.g,DA(s),u0(i,vn))}},rP),lP=_p(P$,function(t,e,n){if((e=Cp(El,e))!=null&&e.length){eo(t,n,2),G0(t.g,4*e.length);for(let i=0;i<e.length;i++)n=t.g,DA(e[i]),u0(n,vn)}},rP),hl=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,YA(t.g,OA)),!0)},w$,p$),iE=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,(t=YA(t.g,OA))===0?void 0:t),!0)},w$,p$),bde=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,YA(t.g,NA)),!0)},function(t,e,n){if((e=cde(e))!=null&&(typeof e=="string"&&XN(e),e!=null))switch(eo(t,n,0),typeof e){case"number":t=t.g,$d(e),gd(t,vn,Kn);break;case"bigint":n=BigInt.asUintN(64,e),n=new Db(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),gd(t.g,n.h,n.g);break;default:n=XN(e),gd(t.g,n.h,n.g)}},Fo()),Yn=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,ll(t.g)),!0)},E$,iP),PC=_p(function(t,e,n){return(t.h===0||t.h===2)&&(e=Sp(e,un(e),n,2,!1),t.h==2?_C(t,ll,e):e.push(ll(t.g)),!0)},function(t,e,n){if((e=Cp(vp,e))!=null&&e.length){n=ZA(t,n);for(let i=0;i<e.length;i++)wC(t.g,e[i]);eP(t,n)}},iP),ed=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,(t=ll(t.g))===0?void 0:t),!0)},E$,iP),Bn=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,JA(t.g)),!0)},R$,d$),bg=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,(t=JA(t.g))===!1?void 0:t),!0)},R$,d$),sr=_p(function(t,e,n){if(t.h!==2)return!1;t=QA(t);const i=un(e);return nc(i),Sp(e,i,n,2).push(t),!0},function(t,e,n){if((e=Cp(Zc,e))!=null)for(let o=0;o<e.length;o++){var i=t,r=n,s=e[o];s!=null&&EC(i,r,I6(s))}},nP),Mc=Yr(function(t,e,n){return t.h===2&&(Jr(e,n,(t=QA(t))===""?void 0:t),!0)},b$,nP),cn=Yr(function(t,e,n){return t.h===2&&(Jr(e,n,QA(t)),!0)},b$,nP),vi=function(t,e,n=tP){return new xp(t,e,n)}(function(t,e,n,i,r){if(t.h!==2)return!1;i=el(void 0,i,!0);let s=un(e);nc(s);let o=Sp(e,s,n,3);return s=un(e),4&Wn(o)&&(o=Cs(o),Hn(o,-2079&(1|Wn(o))),On(e,s,n,o)),o.push(i),W0(t,i,r),!0},function(t,e,n,i,r){if(Array.isArray(e))for(let s=0;s<e.length;s++)T$(t,e[s],n,i,r)}),dn=RC(function(t,e,n,i,r,s){return t.h===2&&(n$(e,Wn(e),s,n),W0(t,e=qA(e,i,n),r),!0)},T$),I$=Yr(function(t,e,n){return t.h===2&&(Jr(e,n,u$(t)),!0)},A$,f$),Tde=_p(function(t,e,n){return(t.h===0||t.h===2)&&(e=Sp(e,un(e),n,2,!1),t.h==2?_C(t,ul,e):e.push(ul(t.g)),!0)},function(t,e,n){if((e=Cp(ade,e))!=null)for(let o=0;o<e.length;o++){var i=t,r=n,s=e[o];s!=null&&(eo(i,r,0),G0(i.g,s))}},Fo()),Mo=Yr(function(t,e,n){return t.h===0&&(Jr(e,n,ll(t.g)),!0)},function(t,e,n){(e=vp(e))!=null&&(e=parseInt(e,10),eo(t,n,0),wC(t.g,e))},m$);class Ade{constructor(e,n){this.h=e,this.g=n,this.l=Jt,this.m=ct,this.defaultValue=void 0}}function zo(t,e){return new Ade(t,e)}function Rl(t,e){return(n,i)=>{if(sy.length){const s=sy.pop();s.o(i),nE(s.g,n,i),n=s}else n=new class{constructor(s,o){if(qN.length){const a=qN.pop();nE(a,s,o),s=a}else s=new class{constructor(a,c){this.h=null,this.m=!1,this.g=this.l=this.j=0,nE(this,a,c)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ca=!1}}(s,o);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(o)}o({ha:s=!1}={}){this.ha=s}}(n,i);try{const s=new t,o=s.u;cP(e)(o,n);var r=s}finally{n.g.clear(),n.m=-1,n.h=-1,sy.length<100&&sy.push(n)}return r}}function IC(t){return function(){yC(this);const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const o=this.g;return this.g=[],o}}}};_$(this.u,e,Ju(bC,TC,AC,t)),Vd(e,e.g.end());const n=new Uint8Array(e.h),i=e.l,r=i.length;let s=0;for(let o=0;o<r;o++){const a=i[o];n.set(a,s),s+=a.length}return e.l=[n],n}}var ZN=class extends Qe{constructor(t){super(t)}},eO=[0,Mc,Yr(function(t,e,n){return t.h===2&&(Jr(e,n,(t=u$(t))===Ou()?void 0:t),!0)},function(t,e,n){if(e!=null){if(e instanceof Qe){const i=e.Ra;return void(i&&(e=i(e),e!=null&&EC(t,n,KA(e).buffer)))}if(Array.isArray(e))return}A$(t,e,n)},f$)];let rE,tO=globalThis.trustedTypes;function nO(t){rE===void 0&&(rE=function(){let n=null;if(!tO)return n;try{const i=r=>r;n=tO.createPolicy("goog#html",{createHTML:i,createScript:i,createScriptURL:i})}catch{}return n}());var e=rE;return new class{constructor(n){this.g=n}toString(){return this.g+""}}(e?e.createScriptURL(t):t)}function Pde(t,...e){if(e.length===0)return nO(t[0]);let n=t[0];for(let i=0;i<e.length;i++)n+=encodeURIComponent(e[i])+t[i+1];return nO(n)}var M$=[0,Yn,Mo,Bn,-1,PC,Mo,-1],Ide=class extends Qe{constructor(){super()}},k$=[0,Bn,cn,Bn,Mo,-1,_p(function(t,e,n){return(t.h===0||t.h===2)&&(e=Sp(e,un(e),n,2,!1),t.h==2?_C(t,yde,e):e.push(ll(t.g)),!0)},function(t,e,n){if((e=Cp(vp,e))!=null&&e.length){n=ZA(t,n);for(let i=0;i<e.length;i++)wC(t.g,e[i]);eP(t,n)}},m$),cn,-1,[0,Bn,-1],Mo,Bn,-1],L$=[0,cn,-2],iO=class extends Qe{constructor(){super()}},D$=[0],N$=[0,Yn,Bn,1,Bn,-3],_s=class extends Qe{constructor(t){super(t,2)}},hi={};hi[336783863]=[0,cn,Bn,-1,Yn,[0,[1,2,3,4,5,6,7],dn,D$,dn,k$,dn,L$,dn,N$,dn,M$,dn,[0,cn,-2],dn,[0,cn,Mo]],[0,cn],Bn,[0,[1,3],[2,4],dn,[0,PC],-1,dn,[0,sr],-1,vi,[0,cn,-1]],cn];var rO=[0,iE,-1,bg,-3,iE,PC,Mc,ed,iE,-1,bg,ed,bg,-2,Mc];function Rs(t,e){Mb(t,2,yp(e),"")}function En(t,e){CC(t,3,e)}function jt(t,e){CC(t,4,e)}var Ar=class extends Qe{constructor(t){super(t,500)}o(t){return ct(this,0,7,t)}},Tg=[-1,{}],sO=[0,cn,1,Tg],oO=[0,cn,sr,Tg];function bs(t,e){J1(t,1,Ar,e)}function kn(t,e){CC(t,10,e)}function tn(t,e){CC(t,15,e)}var Qr=class extends Qe{constructor(t){super(t,500)}o(t){return ct(this,0,1001,t)}},O$=[-500,vi,[-500,Mc,-1,sr,-3,[-2,hi,Bn],vi,eO,ed,-1,sO,oO,vi,[0,Mc,bg],Mc,rO,ed,sr,987,sr],4,vi,[-500,cn,-1,[-1,{}],998,cn],vi,[-500,cn,sr,-1,[-2,{},Bn],997,sr,-1],ed,vi,[-500,cn,sr,Tg,998,sr],sr,ed,sO,oO,vi,[0,Mc,-1,Tg],sr,-2,rO,Mc,-1,bg,979,Tg,vi,eO];Qr.prototype.g=IC(O$);var Mde=Rl(Qr,O$),kde=class extends Qe{constructor(t){super(t)}},F$=class extends Qe{constructor(t){super(t)}g(){return Za(this,kde,1)}},z$=[0,vi,[0,Yn,Ci,cn,-1]],MC=Rl(F$,z$),Lde=class extends Qe{constructor(t){super(t)}},Dde=class extends Qe{constructor(t){super(t)}},sE=class extends Qe{constructor(t){super(t)}h(){return Jt(this,Lde,2)}g(){return Za(this,Dde,5)}},U$=Rl(class extends Qe{constructor(t){super(t)}},[0,sr,PC,lP,[0,Mo,[0,Yn,-3],[0,Ci,-3],[0,Yn,-1,[0,vi,[0,Yn,-2]]],vi,[0,Ci,-1,cn,Ci]],cn,-1,hl,vi,[0,Yn,Ci],sr,hl]),B$=class extends Qe{constructor(t){super(t)}},vd=Rl(class extends Qe{constructor(t){super(t)}},[0,vi,[0,Ci,-4]]),$$=class extends Qe{constructor(t){super(t)}},q0=Rl(class extends Qe{constructor(t){super(t)}},[0,vi,[0,Ci,-4]]),Nde=class extends Qe{constructor(t){super(t)}},Ode=[0,Yn,-1,lP,Mo],H$=class extends Qe{constructor(){super()}};H$.prototype.g=IC([0,Ci,-4,hl]);var Fde=class extends Qe{constructor(t){super(t)}},zde=Rl(class extends Qe{constructor(t){super(t)}},[0,vi,[0,1,Yn,cn,z$],hl]),aO=class extends Qe{constructor(t){super(t)}},Ude=class extends Qe{constructor(t){super(t)}qa(){const t=Q6(this);return t??Ou()}},Bde=class extends Qe{constructor(t){super(t)}},V$=[1,2],$de=Rl(class extends Qe{constructor(t){super(t)}},[0,vi,[0,V$,dn,[0,lP],dn,[0,I$],Yn,cn],hl]),uP=class extends Qe{constructor(t){super(t)}},j$=[0,cn,Yn,Ci,sr,-1],cO=class extends Qe{constructor(t){super(t)}},Hde=[0,Bn,-1],lO=class extends Qe{constructor(t){super(t)}},Gy=[1,2,3,4,5],tS=class extends Qe{constructor(t){super(t)}g(){return Q6(this)!=null}h(){return Zc(cl(this,2))!=null}},Fn=class extends Qe{constructor(t){super(t)}g(){return H6(cl(this,2))??!1}},W$=[0,I$,cn,[0,Yn,hl,-1],[0,bde,hl]],ri=[0,W$,Bn,[0,Gy,dn,N$,dn,k$,dn,M$,dn,D$,dn,L$],Mo],kC=class extends Qe{constructor(t){super(t)}},hP=[0,ri,Ci,-1,Yn],Vde=zo(502141897,kC);hi[502141897]=hP;var jde=Rl(class extends Qe{constructor(t){super(t)}},[0,[0,Mo,-1,Rde,Tde],Ode]),G$=class extends Qe{constructor(t){super(t)}},q$=class extends Qe{constructor(t){super(t)}},dP=[0,ri,Ci,[0,ri],Bn],X$=[0,ri,hP,dP,Ci,[0,[0,W$]]],Wde=zo(508968150,q$);hi[508968150]=X$,hi[508968149]=dP;var K$=class extends Qe{constructor(t){super(t)}},Gde=zo(513916220,K$);hi[513916220]=[0,ri,X$,Yn];var Mh=class extends Qe{constructor(t){super(t)}h(){return Jt(this,uP,2)}g(){Cn(this,2)}},Y$=[0,ri,j$];hi[478825465]=Y$;var qde=class extends Qe{constructor(t){super(t)}},J$=class extends Qe{constructor(t){super(t)}},pP=class extends Qe{constructor(t){super(t)}},fP=class extends Qe{constructor(t){super(t)}},Q$=class extends Qe{constructor(t){super(t)}},uO=[0,ri,[0,ri],Y$,-1],Z$=[0,ri,Ci,Yn],mP=[0,ri,Ci],e8=[0,ri,Z$,mP,Ci],Xde=zo(479097054,Q$);hi[479097054]=[0,ri,e8,uO],hi[463370452]=uO,hi[464864288]=Z$;var Kde=zo(462713202,fP);hi[462713202]=e8,hi[474472470]=mP;var Yde=class extends Qe{constructor(t){super(t)}},t8=class extends Qe{constructor(t){super(t)}},n8=class extends Qe{constructor(t){super(t)}},i8=class extends Qe{constructor(){super()}},gP=[0,ri,Ci,-1,Yn],Ob=[0,ri,Ci,Bn];i8.prototype.g=IC([0,ri,mP,[0,ri],hP,dP,gP,Ob]);var r8=class extends Qe{constructor(t){super(t)}},Jde=zo(456383383,r8);hi[456383383]=[0,ri,j$];var s8=class extends Qe{constructor(t){super(t)}},Qde=zo(476348187,s8);hi[476348187]=[0,ri,Hde];var o8=class extends Qe{constructor(t){super(t)}},hO=class extends Qe{constructor(t){super(t)}},a8=[0,Mo,-1],Zde=zo(458105876,class extends Qe{constructor(t){super(t)}g(){var t=this.u;const e=un(t),n=2&e;return t=function(i,r,s){var o=hO;const a=2&r;let c=!1;if(s==null){if(a)return WN();s=[]}else if(s.constructor===Js){if(!(2&s.M)||a)return s;s=s.Y()}else Array.isArray(s)?c=!!(2&Wn(s)):s=[];if(a){if(!s.length)return WN();c||(c=!0,Yu(s))}else c&&(c=!1,s=t$(s));return c||(64&Wn(s)?j1(s,32):32&r&&dC(s,32)),On(i,r,2,o=new Js(s,o,lde,void 0)),o}(t,e,ma(t,e,2)),!n&&hO&&(t.ta=!0),t}});hi[458105876]=[0,a8,Ede,[!0,hl,[0,cn,-1,sr]]];var vP=class extends Qe{constructor(t){super(t)}},c8=zo(458105758,vP);hi[458105758]=[0,ri,cn,a8];var l8=class extends Qe{constructor(t){super(t)}},epe=zo(443442058,l8);hi[443442058]=[0,ri,cn,Yn,Ci,sr,-1],hi[514774813]=gP;var u8=class extends Qe{constructor(t){super(t)}},tpe=zo(516587230,u8);function Fb(t,e){return e=e?e.clone():new uP,t.displayNamesLocale!==void 0?Cn(e,1,yp(t.displayNamesLocale)):t.displayNamesLocale===void 0&&Cn(e,1),t.maxResults!==void 0?la(e,2,t.maxResults):"maxResults"in t&&Cn(e,2),t.scoreThreshold!==void 0?nt(e,3,t.scoreThreshold):"scoreThreshold"in t&&Cn(e,3),t.categoryAllowlist!==void 0?Q1(e,4,t.categoryAllowlist):"categoryAllowlist"in t&&Cn(e,4),t.categoryDenylist!==void 0?Q1(e,5,t.categoryDenylist):"categoryDenylist"in t&&Cn(e,5),e}function yP(t,e=-1,n=""){return{categories:t.map(i=>({index:Io($s(i,1),0)??-1,score:ti(i,2)??0,categoryName:ca(i,3)??"",displayName:ca(i,4)??""})),headIndex:e,headName:n}}function h8(t){var o,a;var e=fu(t,3,El,pu()),n=fu(t,2,vp,pu()),i=fu(t,1,Zc,pu()),r=fu(t,9,Zc,pu());const s={categories:[],keypoints:[]};for(let c=0;c<e.length;c++)s.categories.push({score:e[c],index:n[c]??-1,categoryName:i[c]??"",displayName:r[c]??""});if((e=(o=Jt(t,sE,4))==null?void 0:o.h())&&(s.boundingBox={originX:$s(e,1)??0,originY:$s(e,2)??0,width:$s(e,3)??0,height:$s(e,4)??0,angle:0}),(a=Jt(t,sE,4))==null?void 0:a.g().length)for(const c of Jt(t,sE,4).g())s.keypoints.push({x:jy(c,1)??0,y:jy(c,2)??0,score:jy(c,4)??0,label:Zc(cl(c,3))??""});return s}function LC(t){const e=[];for(const n of Za(t,$$,1))e.push({x:ti(n,1)??0,y:ti(n,2)??0,z:ti(n,3)??0,visibility:ti(n,4)??0});return e}function Ag(t){const e=[];for(const n of Za(t,B$,1))e.push({x:ti(n,1)??0,y:ti(n,2)??0,z:ti(n,3)??0,visibility:ti(n,4)??0});return e}function dO(t){return Array.from(t,e=>e>127?e-256:e)}function pO(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,i=0,r=0;for(let s=0;s<t.length;s++)n+=t[s]*e[s],i+=t[s]*t[s],r+=e[s]*e[s];if(i<=0||r<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(i*r)}let oy;hi[516587230]=[0,ri,gP,Ob,Ci],hi[518928384]=Ob;const npe=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function d8(){if(oy===void 0)try{await WebAssembly.instantiate(npe),oy=!0}catch{oy=!1}return oy}async function Wm(t,e=Pde``){const n=await d8()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var Rc=class{};function p8(){var t=navigator;return typeof OffscreenCanvas<"u"&&(!function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(t)||!!((t=t.userAgent.match(/Version\/([\d]+).*Safari/))&&t.length>=1&&Number(t[1])>=17))}async function fO(t){if(typeof importScripts!="function"){const e=document.createElement("script");return e.src=t.toString(),e.crossOrigin="anonymous",new Promise((n,i)=>{e.addEventListener("load",()=>{n()},!1),e.addEventListener("error",r=>{i(r)},!1),document.body.appendChild(e)})}importScripts(t.toString())}function f8(t){return t.videoWidth!==void 0?[t.videoWidth,t.videoHeight]:t.naturalWidth!==void 0?[t.naturalWidth,t.naturalHeight]:t.displayWidth!==void 0?[t.displayWidth,t.displayHeight]:[t.width,t.height]}function st(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(e=t.i.stringToNewUTF8(e)),t.i._free(e)}function mO(t,e,n){if(!t.i.canvas)throw Error("No OpenGL canvas configured.");if(n?t.i._bindTextureToStream(n):t.i._bindTextureToCanvas(),!(n=t.i.canvas.getContext("webgl2")||t.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[i,r]=f8(e);return!t.l||i===t.i.canvas.width&&r===t.i.canvas.height||(t.i.canvas.width=i,t.i.canvas.height=r),[i,r]}function gO(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const i=new Uint32Array(e.length);for(let r=0;r<e.length;r++)i[r]=t.i.stringToNewUTF8(e[r]);e=t.i._malloc(4*i.length),t.i.HEAPU32.set(i,e>>2),n(e);for(const r of i)t.i._free(r);t.i._free(e)}function jo(t,e,n){t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=n}function vc(t,e,n){let i=[];t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=(r,s,o)=>{s?(n(i,o),i=[]):i.push(r)}}Rc.forVisionTasks=function(t){return Wm("vision",t)},Rc.forTextTasks=function(t){return Wm("text",t)},Rc.forGenAiExperimentalTasks=function(t){return Wm("genai_experimental",t)},Rc.forGenAiTasks=function(t){return Wm("genai",t)},Rc.forAudioTasks=function(t){return Wm("audio",t)},Rc.isSimdSupported=function(){return d8()};async function ipe(t,e,n,i){return t=await(async(r,s,o,a,c)=>{if(s&&await fO(s),!self.ModuleFactory||o&&(await fO(o),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&c&&((s=self.Module).locateFile=c.locateFile,c.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=c.mainScriptUrlOrBlob)),c=await self.ModuleFactory(self.Module||c),self.ModuleFactory=self.Module=void 0,new r(c,a)})(t,n.wasmLoaderPath,n.assetLoaderPath,e,{locateFile:r=>r.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&r.endsWith(".data")?n.assetBinaryPath.toString():r}),await t.o(i),t}function oE(t,e){const n=Jt(t.baseOptions,tS,1)||new tS;typeof e=="string"?(Cn(n,2,yp(e)),Cn(n,1)):e instanceof Uint8Array&&(Cn(n,1,LA(e,!1,!1)),Cn(n,2)),ct(t.baseOptions,0,1,n)}function vO(t){try{const e=t.H.length;if(e===1)throw Error(t.H[0].message);if(e>1)throw Error("Encountered multiple errors: "+t.H.map(n=>n.message).join(", "))}finally{t.H=[]}}function He(t,e){t.B=Math.max(t.B,e)}function DC(t,e){t.A=new Ar,Rs(t.A,"PassThroughCalculator"),En(t.A,"free_memory"),jt(t.A,"free_memory_unused_out"),kn(e,"free_memory"),bs(e,t.A)}function jd(t,e){En(t.A,e),jt(t.A,e+"_unused_out")}function NC(t){t.g.addBoolToStream(!0,"free_memory",t.B)}var qy=class{constructor(t){this.g=t,this.H=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(t,e=!0){var n,i,r,s,o,a;if(e){const c=t.baseOptions||{};if((n=t.baseOptions)!=null&&n.modelAssetBuffer&&((i=t.baseOptions)!=null&&i.modelAssetPath))throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!((r=Jt(this.baseOptions,tS,1))!=null&&r.g()||(s=Jt(this.baseOptions,tS,1))!=null&&s.h()||(o=t.baseOptions)!=null&&o.modelAssetBuffer||(a=t.baseOptions)!=null&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(l,u){let h=Jt(l.baseOptions,lO,3);if(!h){var d=h=new lO,p=new iO;Rg(d,4,Gy,p)}"delegate"in u&&(u.delegate==="GPU"?(u=h,d=new Ide,Rg(u,2,Gy,d)):(u=h,d=new iO,Rg(u,4,Gy,d))),ct(l.baseOptions,0,3,h)}(this,c),c.modelAssetPath)return fetch(c.modelAssetPath.toString()).then(l=>{if(l.ok)return l.arrayBuffer();throw Error(`Failed to fetch model: ${c.modelAssetPath} (${l.status})`)}).then(l=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(l),!0,!1,!1),oE(this,"/model.dat"),this.m(),this.J()});if(c.modelAssetBuffer instanceof Uint8Array)oE(this,c.modelAssetBuffer);else if(c.modelAssetBuffer)return async function(l){const u=[];for(var h=0;;){const{done:d,value:p}=await l.read();if(d)break;u.push(p),h+=p.length}if(u.length===0)return new Uint8Array(0);if(u.length===1)return u[0];l=new Uint8Array(h),h=0;for(const d of u)l.set(d,h),h+=d.length;return l}(c.modelAssetBuffer).then(l=>{oE(this,l),this.m(),this.J()})}return this.m(),this.J(),Promise.resolve()}J(){}ea(){let t;if(this.g.ea(e=>{t=Mde(e)}),!t)throw Error("Failed to retrieve CalculatorGraphConfig");return t}setGraph(t,e){this.g.attachErrorListener((n,i)=>{this.H.push(Error(i))}),this.g.Ma(),this.g.setGraph(t,e),this.A=void 0,vO(this)}finishProcessing(){this.g.finishProcessing(),vO(this)}close(){this.A=void 0,this.g.closeGraph()}};function ja(t,e){if(!t)throw Error(`Unable to obtain required WebGL resource: ${e}`);return t}qy.prototype.close=qy.prototype.close,function(t,e){t=t.split(".");var n,i=Nu;for((t[0]in i)||i.execScript===void 0||i.execScript("var "+t[0]);t.length&&(n=t.shift());)t.length||e===void 0?i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={}:i[n]=e}("TaskRunner",qy);class rpe{constructor(e,n,i,r){this.g=e,this.h=n,this.m=i,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function yO(t,e,n){const i=t.g;if(n=ja(i.createShader(n),"Failed to create WebGL shader"),i.shaderSource(n,e),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${i.getShaderInfoLog(n)}`);return i.attachShader(t.h,n),n}function SO(t,e){const n=t.g,i=ja(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(i);const r=ja(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,r),n.enableVertexAttribArray(t.P),n.vertexAttribPointer(t.P,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=ja(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(t.J),n.vertexAttribPointer(t.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new rpe(n,i,r,s)}function SP(t,e){if(t.g){if(e!==t.g)throw Error("Cannot change GL context once initialized")}else t.g=e}function xP(t,e,n,i){return SP(t,e),t.h||(t.m(),t.C()),n?(t.s||(t.s=SO(t,!0)),n=t.s):(t.v||(t.v=SO(t,!1)),n=t.v),e.useProgram(t.h),n.bind(),t.l(),t=i(),n.g.bindVertexArray(null),t}function OC(t,e,n){return SP(t,e),t=ja(e.createTexture(),"Failed to create texture"),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),t}function FC(t,e,n){SP(t,e),t.A||(t.A=ja(e.createFramebuffer(),"Failed to create framebuffe.")),e.bindFramebuffer(e.FRAMEBUFFER,t.A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function CP(t){var e;(e=t.g)==null||e.bindFramebuffer(t.g.FRAMEBUFFER,null)}var _P=class{H(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const t=this.g;if(this.h=ja(t.createProgram(),"Failed to create WebGL program"),this.ba=yO(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,t.VERTEX_SHADER),this.aa=yO(this,this.H(),t.FRAGMENT_SHADER),t.linkProgram(this.h),!t.getProgramParameter(this.h,t.LINK_STATUS))throw Error(`Error during program linking: ${t.getProgramInfoLog(this.h)}`);this.P=t.getAttribLocation(this.h,"aVertex"),this.J=t.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const t=this.g;t.deleteProgram(this.h),t.deleteShader(this.ba),t.deleteShader(this.aa)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function Da(t,e){switch(e){case 0:return t.g.find(n=>n instanceof Uint8Array);case 1:return t.g.find(n=>n instanceof Float32Array);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function zb(t){var e=Da(t,1);if(!e){if(e=Da(t,0))e=new Float32Array(e).map(i=>i/255);else{e=new Float32Array(t.width*t.height);const i=Wd(t);var n=wP(t);if(FC(n,i,m8(t)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){n=new Float32Array(t.width*t.height*4),i.readPixels(0,0,t.width,t.height,i.RGBA,i.FLOAT,n);for(let r=0,s=0;r<e.length;++r,s+=4)e[r]=n[s]}else i.readPixels(0,0,t.width,t.height,i.RED,i.FLOAT,e)}t.g.push(e)}return e}function m8(t){let e=Da(t,2);if(!e){const n=Wd(t);e=v8(t);const i=zb(t),r=g8(t);n.texImage2D(n.TEXTURE_2D,0,r,t.width,t.height,0,n.RED,n.FLOAT,i),Ub(t)}return e}function Wd(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=ja(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function g8(t){if(t=Wd(t),!ay)if(t.getExtension("EXT_color_buffer_float")&&t.getExtension("OES_texture_float_linear")&&t.getExtension("EXT_float_blend"))ay=t.R32F;else{if(!t.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");ay=t.R16F}return ay}function wP(t){return t.l||(t.l=new _P),t.l}function v8(t){const e=Wd(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Da(t,2);return n||(n=OC(wP(t),e,t.m?e.LINEAR:e.NEAREST),t.g.push(n),t.j=!0),e.bindTexture(e.TEXTURE_2D,n),n}function Ub(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}var ay,Ai=class{constructor(t,e,n,i,r,s,o){this.g=t,this.m=e,this.j=n,this.canvas=i,this.l=r,this.width=s,this.height=o,this.j&&--xO===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Ha(){return!!Da(this,0)}la(){return!!Da(this,1)}R(){return!!Da(this,2)}ka(){return(e=Da(t=this,0))||(e=zb(t),e=new Uint8Array(e.map(n=>255*n)),t.g.push(e)),e;var t,e}ja(){return zb(this)}N(){return m8(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof Uint8Array)n=new Uint8Array(e);else if(e instanceof Float32Array)n=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const i=Wd(this),r=wP(this);i.activeTexture(i.TEXTURE1),n=OC(r,i,this.m?i.LINEAR:i.NEAREST),i.bindTexture(i.TEXTURE_2D,n);const s=g8(this);i.texImage2D(i.TEXTURE_2D,0,s,this.width,this.height,0,i.RED,i.FLOAT,null),i.bindTexture(i.TEXTURE_2D,null),FC(r,i,n),xP(r,i,!1,()=>{v8(this),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),Ub(this)}),CP(r),Ub(this)}}t.push(n)}return new Ai(t,this.m,this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Wd(this).deleteTexture(Da(this,2)),xO=-1}};Ai.prototype.close=Ai.prototype.close,Ai.prototype.clone=Ai.prototype.clone,Ai.prototype.getAsWebGLTexture=Ai.prototype.N,Ai.prototype.getAsFloat32Array=Ai.prototype.ja,Ai.prototype.getAsUint8Array=Ai.prototype.ka,Ai.prototype.hasWebGLTexture=Ai.prototype.R,Ai.prototype.hasFloat32Array=Ai.prototype.la,Ai.prototype.hasUint8Array=Ai.prototype.Ha;var xO=250;function Jo(t,e){switch(e){case 0:return t.g.find(n=>n instanceof ImageData);case 1:return t.g.find(n=>typeof ImageBitmap<"u"&&n instanceof ImageBitmap);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function y8(t){var e=Jo(t,0);if(!e){e=Gd(t);const n=zC(t),i=new Uint8Array(t.width*t.height*4);FC(n,e,Xy(t)),e.readPixels(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,i),CP(n),e=new ImageData(new Uint8ClampedArray(i.buffer),t.width,t.height),t.g.push(e)}return e}function Xy(t){let e=Jo(t,2);if(!e){const n=Gd(t);e=Ky(t);const i=Jo(t,1)||y8(t);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i),rg(t)}return e}function Gd(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when iniitializing the image.");return t.h||(t.h=ja(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function zC(t){return t.l||(t.l=new _P),t.l}function Ky(t){const e=Gd(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Jo(t,2);return n||(n=OC(zC(t),e),t.g.push(n),t.m=!0),e.bindTexture(e.TEXTURE_2D,n),n}function rg(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}function CO(t){const e=Gd(t);return xP(zC(t),e,!0,()=>function(n,i){const r=n.canvas;if(r.width===n.width&&r.height===n.height)return i();const s=r.width,o=r.height;return r.width=n.width,r.height=n.height,n=i(),r.width=s,r.height=o,n}(t,()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(t.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return t.canvas.transferToImageBitmap()}))}var Pi=class{constructor(t,e,n,i,r,s,o){this.g=t,this.j=e,this.m=n,this.canvas=i,this.l=r,this.width=s,this.height=o,(this.j||this.m)&&--_O===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ga(){return!!Jo(this,0)}ma(){return!!Jo(this,1)}R(){return!!Jo(this,2)}Ea(){return y8(this)}Da(){var t=Jo(this,1);return t||(Xy(this),Ky(this),t=CO(this),rg(this),this.g.push(t),this.j=!0),t}N(){return Xy(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof ImageData)n=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const i=Gd(this),r=zC(this);i.activeTexture(i.TEXTURE1),n=OC(r,i),i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindTexture(i.TEXTURE_2D,null),FC(r,i,n),xP(r,i,!1,()=>{Ky(this),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),rg(this)}),CP(r),rg(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);Xy(this),Ky(this),n=CO(this),rg(this)}t.push(n)}return new Pi(t,this.ma(),this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Jo(this,1).close(),this.m&&Gd(this).deleteTexture(Jo(this,2)),_O=-1}};Pi.prototype.close=Pi.prototype.close,Pi.prototype.clone=Pi.prototype.clone,Pi.prototype.getAsWebGLTexture=Pi.prototype.N,Pi.prototype.getAsImageBitmap=Pi.prototype.Da,Pi.prototype.getAsImageData=Pi.prototype.Ea,Pi.prototype.hasWebGLTexture=Pi.prototype.R,Pi.prototype.hasImageBitmap=Pi.prototype.ma,Pi.prototype.hasImageData=Pi.prototype.Ga;var _O=250;function Uo(...t){return t.map(([e,n])=>({start:e,end:n}))}const spe=function(t){return class extends t{Ma(){this.i._registerModelResourcesGraphService()}}}((wO=class{constructor(t,e){this.l=!0,this.i=t,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",e!==void 0?this.i.canvas=e:p8()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(".pbtxt")||t.endsWith(".textproto")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph(new TextEncoder().encode(t),!1)}setGraph(t,e){const n=t.length,i=this.i._malloc(n);this.i.HEAPU8.set(t,i),e?this.i._changeBinaryGraph(n,i):this.i._changeTextGraph(n,i),this.i._free(i)}configureAudio(t,e,n,i,r){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),st(this,i||"input_audio",s=>{st(this,r=r||"audio_header",o=>{this.i._configureAudio(s,o,t,e??0,n)})})}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.i._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.i.gpuOriginForWebTexturesIsBottomLeft=t}ea(t){jo(this,"__graph_config__",e=>{t(e)}),st(this,"__graph_config__",e=>{this.i._getGraphConfig(e,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(t){this.i.errorListener=t}attachEmptyPacketListener(t,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,i,r){const s=4*t.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(t,this.g/4),st(this,i,o=>{this.i._addAudioToInputStream(this.g,e,n,o,r)})}addGpuBufferToStream(t,e,n){st(this,e,i=>{const[r,s]=mO(this,t,i);this.i._addBoundTextureToStream(i,r,s,n)})}addBoolToStream(t,e,n){st(this,e,i=>{this.i._addBoolToInputStream(t,i,n)})}addDoubleToStream(t,e,n){st(this,e,i=>{this.i._addDoubleToInputStream(t,i,n)})}addFloatToStream(t,e,n){st(this,e,i=>{this.i._addFloatToInputStream(t,i,n)})}addIntToStream(t,e,n){st(this,e,i=>{this.i._addIntToInputStream(t,i,n)})}addUintToStream(t,e,n){st(this,e,i=>{this.i._addUintToInputStream(t,i,n)})}addStringToStream(t,e,n){st(this,e,i=>{st(this,t,r=>{this.i._addStringToInputStream(r,i,n)})})}addStringRecordToStream(t,e,n){st(this,e,i=>{gO(this,Object.keys(t),r=>{gO(this,Object.values(t),s=>{this.i._addFlatHashMapToInputStream(r,s,Object.keys(t).length,i,n)})})})}addProtoToStream(t,e,n,i){st(this,n,r=>{st(this,e,s=>{const o=this.i._malloc(t.length);this.i.HEAPU8.set(t,o),this.i._addProtoToInputStream(o,t.length,s,r,i),this.i._free(o)})})}addEmptyPacketToStream(t,e){st(this,t,n=>{this.i._addEmptyPacketToInputStream(n,e)})}addBoolVectorToStream(t,e,n){st(this,e,i=>{const r=this.i._allocateBoolVector(t.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const s of t)this.i._addBoolVectorEntry(r,s);this.i._addBoolVectorToInputStream(r,i,n)})}addDoubleVectorToStream(t,e,n){st(this,e,i=>{const r=this.i._allocateDoubleVector(t.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const s of t)this.i._addDoubleVectorEntry(r,s);this.i._addDoubleVectorToInputStream(r,i,n)})}addFloatVectorToStream(t,e,n){st(this,e,i=>{const r=this.i._allocateFloatVector(t.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const s of t)this.i._addFloatVectorEntry(r,s);this.i._addFloatVectorToInputStream(r,i,n)})}addIntVectorToStream(t,e,n){st(this,e,i=>{const r=this.i._allocateIntVector(t.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const s of t)this.i._addIntVectorEntry(r,s);this.i._addIntVectorToInputStream(r,i,n)})}addUintVectorToStream(t,e,n){st(this,e,i=>{const r=this.i._allocateUintVector(t.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const s of t)this.i._addUintVectorEntry(r,s);this.i._addUintVectorToInputStream(r,i,n)})}addStringVectorToStream(t,e,n){st(this,e,i=>{const r=this.i._allocateStringVector(t.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const s of t)st(this,s,o=>{this.i._addStringVectorEntry(r,o)});this.i._addStringVectorToInputStream(r,i,n)})}addBoolToInputSidePacket(t,e){st(this,e,n=>{this.i._addBoolToInputSidePacket(t,n)})}addDoubleToInputSidePacket(t,e){st(this,e,n=>{this.i._addDoubleToInputSidePacket(t,n)})}addFloatToInputSidePacket(t,e){st(this,e,n=>{this.i._addFloatToInputSidePacket(t,n)})}addIntToInputSidePacket(t,e){st(this,e,n=>{this.i._addIntToInputSidePacket(t,n)})}addUintToInputSidePacket(t,e){st(this,e,n=>{this.i._addUintToInputSidePacket(t,n)})}addStringToInputSidePacket(t,e){st(this,e,n=>{st(this,t,i=>{this.i._addStringToInputSidePacket(i,n)})})}addProtoToInputSidePacket(t,e,n){st(this,n,i=>{st(this,e,r=>{const s=this.i._malloc(t.length);this.i.HEAPU8.set(t,s),this.i._addProtoToInputSidePacket(s,t.length,r,i),this.i._free(s)})})}addBoolVectorToInputSidePacket(t,e){st(this,e,n=>{const i=this.i._allocateBoolVector(t.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const r of t)this.i._addBoolVectorEntry(i,r);this.i._addBoolVectorToInputSidePacket(i,n)})}addDoubleVectorToInputSidePacket(t,e){st(this,e,n=>{const i=this.i._allocateDoubleVector(t.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const r of t)this.i._addDoubleVectorEntry(i,r);this.i._addDoubleVectorToInputSidePacket(i,n)})}addFloatVectorToInputSidePacket(t,e){st(this,e,n=>{const i=this.i._allocateFloatVector(t.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const r of t)this.i._addFloatVectorEntry(i,r);this.i._addFloatVectorToInputSidePacket(i,n)})}addIntVectorToInputSidePacket(t,e){st(this,e,n=>{const i=this.i._allocateIntVector(t.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const r of t)this.i._addIntVectorEntry(i,r);this.i._addIntVectorToInputSidePacket(i,n)})}addUintVectorToInputSidePacket(t,e){st(this,e,n=>{const i=this.i._allocateUintVector(t.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const r of t)this.i._addUintVectorEntry(i,r);this.i._addUintVectorToInputSidePacket(i,n)})}addStringVectorToInputSidePacket(t,e){st(this,e,n=>{const i=this.i._allocateStringVector(t.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const r of t)st(this,r,s=>{this.i._addStringVectorEntry(i,s)});this.i._addStringVectorToInputSidePacket(i,n)})}attachBoolListener(t,e){jo(this,t,e),st(this,t,n=>{this.i._attachBoolListener(n)})}attachBoolVectorListener(t,e){vc(this,t,e),st(this,t,n=>{this.i._attachBoolVectorListener(n)})}attachIntListener(t,e){jo(this,t,e),st(this,t,n=>{this.i._attachIntListener(n)})}attachIntVectorListener(t,e){vc(this,t,e),st(this,t,n=>{this.i._attachIntVectorListener(n)})}attachUintListener(t,e){jo(this,t,e),st(this,t,n=>{this.i._attachUintListener(n)})}attachUintVectorListener(t,e){vc(this,t,e),st(this,t,n=>{this.i._attachUintVectorListener(n)})}attachDoubleListener(t,e){jo(this,t,e),st(this,t,n=>{this.i._attachDoubleListener(n)})}attachDoubleVectorListener(t,e){vc(this,t,e),st(this,t,n=>{this.i._attachDoubleVectorListener(n)})}attachFloatListener(t,e){jo(this,t,e),st(this,t,n=>{this.i._attachFloatListener(n)})}attachFloatVectorListener(t,e){vc(this,t,e),st(this,t,n=>{this.i._attachFloatVectorListener(n)})}attachStringListener(t,e){jo(this,t,e),st(this,t,n=>{this.i._attachStringListener(n)})}attachStringVectorListener(t,e){vc(this,t,e),st(this,t,n=>{this.i._attachStringVectorListener(n)})}attachProtoListener(t,e,n){jo(this,t,e),st(this,t,i=>{this.i._attachProtoListener(i,n||!1)})}attachProtoVectorListener(t,e,n){vc(this,t,e),st(this,t,i=>{this.i._attachProtoVectorListener(i,n||!1)})}attachAudioListener(t,e,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),jo(this,t,(i,r)=>{i=new Float32Array(i.buffer,i.byteOffset,i.length/4),e(i,r)}),st(this,t,i=>{this.i._attachAudioListener(i,n||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends wO{get ga(){return this.i}sa(t,e,n){st(this,e,i=>{const[r,s]=mO(this,t,i);this.ga._addBoundTextureAsImageToStream(i,r,s,n)})}V(t,e){jo(this,t,e),st(this,t,n=>{this.ga._attachImageListener(n)})}da(t,e){vc(this,t,e),st(this,t,n=>{this.ga._attachImageVectorListener(n)})}}));var wO,to=class extends spe{};async function Ht(t,e,n){return async function(i,r,s,o){return ipe(i,r,s,o)}(t,n.canvas??(p8()?void 0:document.createElement("canvas")),e,n)}function S8(t,e,n,i){if(t.U){const s=new H$;if(n!=null&&n.regionOfInterest){if(!t.ra)throw Error("This task doesn't support region-of-interest.");var r=n.regionOfInterest;if(r.left>=r.right||r.top>=r.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(r.left<0||r.top<0||r.right>1||r.bottom>1)throw Error("Expected RectF values to be in [0,1].");nt(s,1,(r.left+r.right)/2),nt(s,2,(r.top+r.bottom)/2),nt(s,4,r.right-r.left),nt(s,3,r.bottom-r.top)}else nt(s,1,.5),nt(s,2,.5),nt(s,4,1),nt(s,3,1);if(n!=null&&n.rotationDegrees){if((n==null?void 0:n.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90.");if(nt(s,5,-Math.PI*n.rotationDegrees/180),(n==null?void 0:n.rotationDegrees)%180!=0){const[o,a]=f8(e);n=ti(s,3)*a/o,r=ti(s,4)*o/a,nt(s,4,n),nt(s,3,r)}}t.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",t.U,i)}t.g.sa(e,t.ba,i??performance.now()),t.finishProcessing()}function no(t,e,n){var i;if((i=t.baseOptions)!=null&&i.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");S8(t,e,n,t.B+1)}function ga(t,e,n,i){var r;if(!((r=t.baseOptions)!=null&&r.g()))throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");S8(t,e,n,i)}function qd(t,e,n,i){var r=e.data;const s=e.width,o=s*(e=e.height);if((r instanceof Uint8Array||r instanceof Float32Array)&&r.length!==o)throw Error("Unsupported channel count: "+r.length/o);return t=new Ai([r],n,!1,t.g.i.canvas,t.P,s,e),i?t.clone():t}var Xr=class extends qy{constructor(t,e,n,i){super(t),this.g=t,this.ba=e,this.U=n,this.ra=i,this.P=new _P}l(t,e=!0){if("runningMode"in t&&l0(this.baseOptions,2,!!t.runningMode&&t.runningMode!=="IMAGE"),t.canvas!==void 0&&this.g.i.canvas!==t.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(t,e)}close(){this.P.close(),super.close()}};Xr.prototype.close=Xr.prototype.close;var zr=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect_in",!1),this.j={detections:[]},ct(t=this.h=new kC,0,1,e=new Fn),nt(this.h,2,.5),nt(this.h,3,.3)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return"minDetectionConfidence"in t&&nt(this.h,2,t.minDetectionConfidence??.5),"minSuppressionThreshold"in t&&nt(this.h,3,t.minSuppressionThreshold??.3),this.l(t)}D(t,e){return this.j={detections:[]},no(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},ga(this,t,n,e),this.j}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect_in"),tn(t,"detections");const e=new _s;Oo(e,Vde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect_in"),jt(n,"DETECTIONS:detections"),n.o(e),bs(t,n),this.g.attachProtoVectorListener("detections",(i,r)=>{for(const s of i)i=U$(s),this.j.detections.push(h8(i));He(this,r)}),this.g.attachEmptyPacketListener("detections",i=>{He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};zr.prototype.detectForVideo=zr.prototype.F,zr.prototype.detect=zr.prototype.D,zr.prototype.setOptions=zr.prototype.o,zr.createFromModelPath=async function(t,e){return Ht(zr,t,{baseOptions:{modelAssetPath:e}})},zr.createFromModelBuffer=function(t,e){return Ht(zr,t,{baseOptions:{modelAssetBuffer:e}})},zr.createFromOptions=function(t,e){return Ht(zr,t,e)};var EP=Uo([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),RP=Uo([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),bP=Uo([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),x8=Uo([474,475],[475,476],[476,477],[477,474]),TP=Uo([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),AP=Uo([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),C8=Uo([469,470],[470,471],[471,472],[472,469]),PP=Uo([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),_8=[...EP,...RP,...bP,...TP,...AP,...PP],w8=Uo([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function EO(t){t.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var Gn=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,ct(t=this.h=new q$,0,1,e=new Fn),this.v=new G$,ct(this.h,0,3,this.v),this.s=new kC,ct(this.h,0,2,this.s),la(this.s,4,1),nt(this.s,2,.5),nt(this.v,2,.5),nt(this.h,4,.5)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return"numFaces"in t&&la(this.s,4,t.numFaces??1),"minFaceDetectionConfidence"in t&&nt(this.s,2,t.minFaceDetectionConfidence??.5),"minTrackingConfidence"in t&&nt(this.h,4,t.minTrackingConfidence??.5),"minFacePresenceConfidence"in t&&nt(this.v,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in t&&(this.outputFacialTransformationMatrixes=!!t.outputFacialTransformationMatrixes),this.l(t)}D(t,e){return EO(this),no(this,t,e),this.j}F(t,e,n){return EO(this),ga(this,t,n,e),this.j}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"face_landmarks");const e=new _s;Oo(e,Wde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"NORM_LANDMARKS:face_landmarks"),n.o(e),bs(t,n),this.g.attachProtoVectorListener("face_landmarks",(i,r)=>{for(const s of i)i=q0(s),this.j.faceLandmarks.push(LC(i));He(this,r)}),this.g.attachEmptyPacketListener("face_landmarks",i=>{He(this,i)}),this.outputFaceBlendshapes&&(tn(t,"blendshapes"),jt(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(i,r)=>{if(this.outputFaceBlendshapes)for(const s of i)i=MC(s),this.j.faceBlendshapes.push(yP(i.g()??[]));He(this,r)}),this.g.attachEmptyPacketListener("blendshapes",i=>{He(this,i)})),this.outputFacialTransformationMatrixes&&(tn(t,"face_geometry"),jt(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(i,r)=>{if(this.outputFacialTransformationMatrixes)for(const s of i)(i=Jt(jde(s),Nde,2))&&this.j.facialTransformationMatrixes.push({rows:Io($s(i,1),0)??0,columns:Io($s(i,2),0)??0,data:fu(i,3,El,pu()).slice()??[]});He(this,r)}),this.g.attachEmptyPacketListener("face_geometry",i=>{He(this,i)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Gn.prototype.detectForVideo=Gn.prototype.F,Gn.prototype.detect=Gn.prototype.D,Gn.prototype.setOptions=Gn.prototype.o,Gn.createFromModelPath=function(t,e){return Ht(Gn,t,{baseOptions:{modelAssetPath:e}})},Gn.createFromModelBuffer=function(t,e){return Ht(Gn,t,{baseOptions:{modelAssetBuffer:e}})},Gn.createFromOptions=function(t,e){return Ht(Gn,t,e)},Gn.FACE_LANDMARKS_LIPS=EP,Gn.FACE_LANDMARKS_LEFT_EYE=RP,Gn.FACE_LANDMARKS_LEFT_EYEBROW=bP,Gn.FACE_LANDMARKS_LEFT_IRIS=x8,Gn.FACE_LANDMARKS_RIGHT_EYE=TP,Gn.FACE_LANDMARKS_RIGHT_EYEBROW=AP,Gn.FACE_LANDMARKS_RIGHT_IRIS=C8,Gn.FACE_LANDMARKS_FACE_OVAL=PP,Gn.FACE_LANDMARKS_CONTOURS=_8,Gn.FACE_LANDMARKS_TESSELATION=w8;var Wo=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!0),ct(t=this.j=new K$,0,1,e=new Fn)}get baseOptions(){return Jt(this.j,Fn,1)}set baseOptions(t){ct(this.j,0,1,t)}o(t){return super.l(t)}Pa(t,e,n){const i=typeof e!="function"?e:{};if(this.h=typeof e=="function"?e:n,no(this,t,i??{}),!this.h)return this.s}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"stylized_image");const e=new _s;Oo(e,Gde,this.j);const n=new Ar;Rs(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"STYLIZED_IMAGE:stylized_image"),n.o(e),bs(t,n),this.g.V("stylized_image",(i,r)=>{var s=!this.h,o=i.data,a=i.width;const c=a*(i=i.height);if(o instanceof Uint8Array)if(o.length===3*c){const l=new Uint8ClampedArray(4*c);for(let u=0;u<c;++u)l[4*u]=o[3*u],l[4*u+1]=o[3*u+1],l[4*u+2]=o[3*u+2],l[4*u+3]=255;o=new ImageData(l,a,i)}else{if(o.length!==4*c)throw Error("Unsupported channel count: "+o.length/c);o=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,o.length),a,i)}else if(!(o instanceof WebGLTexture))throw Error(`Unsupported format: ${o.constructor.name}`);a=new Pi([o],!1,!1,this.g.i.canvas,this.P,a,i),this.s=s=s?a.clone():a,this.h&&this.h(s),He(this,r)}),this.g.attachEmptyPacketListener("stylized_image",i=>{this.s=null,this.h&&this.h(null),He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Wo.prototype.stylize=Wo.prototype.Pa,Wo.prototype.setOptions=Wo.prototype.o,Wo.createFromModelPath=function(t,e){return Ht(Wo,t,{baseOptions:{modelAssetPath:e}})},Wo.createFromModelBuffer=function(t,e){return Ht(Wo,t,{baseOptions:{modelAssetBuffer:e}})},Wo.createFromOptions=function(t,e){return Ht(Wo,t,e)};var IP=Uo([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function RO(t){t.gestures=[],t.landmarks=[],t.worldLandmarks=[],t.handedness=[]}function bO(t){return t.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:t.gestures,landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handedness:t.handedness,handednesses:t.handedness}}function TO(t,e=!0){const n=[];for(const r of t){var i=MC(r);t=[];for(const s of i.g())i=e&&$s(s,1)!=null?Io($s(s,1),0):-1,t.push({score:ti(s,2)??0,index:i,categoryName:ca(s,3)??"",displayName:ca(s,4)??""});n.push(t)}return n}var ss=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],ct(t=this.j=new Q$,0,1,e=new Fn),this.s=new fP,ct(this.j,0,2,this.s),this.C=new pP,ct(this.s,0,3,this.C),this.v=new J$,ct(this.s,0,2,this.v),this.h=new qde,ct(this.j,0,3,this.h),nt(this.v,2,.5),nt(this.s,4,.5),nt(this.C,2,.5)}get baseOptions(){return Jt(this.j,Fn,1)}set baseOptions(t){ct(this.j,0,1,t)}o(t){var r,s,o,a;if(la(this.v,3,t.numHands??1),"minHandDetectionConfidence"in t&&nt(this.v,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&nt(this.s,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&nt(this.C,2,t.minHandPresenceConfidence??.5),t.cannedGesturesClassifierOptions){var e=new Mh,n=e,i=Fb(t.cannedGesturesClassifierOptions,(r=Jt(this.h,Mh,3))==null?void 0:r.h());ct(n,0,2,i),ct(this.h,0,3,e)}else t.cannedGesturesClassifierOptions===void 0&&((s=Jt(this.h,Mh,3))==null||s.g());return t.customGesturesClassifierOptions?(ct(n=e=new Mh,0,2,i=Fb(t.customGesturesClassifierOptions,(o=Jt(this.h,Mh,4))==null?void 0:o.h())),ct(this.h,0,4,e)):t.customGesturesClassifierOptions===void 0&&((a=Jt(this.h,Mh,4))==null||a.g()),this.l(t)}Ka(t,e){return RO(this),no(this,t,e),bO(this)}La(t,e,n){return RO(this),ga(this,t,n,e),bO(this)}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"hand_gestures"),tn(t,"hand_landmarks"),tn(t,"world_hand_landmarks"),tn(t,"handedness");const e=new _s;Oo(e,Xde,this.j);const n=new Ar;Rs(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"HAND_GESTURES:hand_gestures"),jt(n,"LANDMARKS:hand_landmarks"),jt(n,"WORLD_LANDMARKS:world_hand_landmarks"),jt(n,"HANDEDNESS:handedness"),n.o(e),bs(t,n),this.g.attachProtoVectorListener("hand_landmarks",(i,r)=>{for(const s of i){i=q0(s);const o=[];for(const a of Za(i,$$,1))o.push({x:ti(a,1)??0,y:ti(a,2)??0,z:ti(a,3)??0,visibility:ti(a,4)??0});this.landmarks.push(o)}He(this,r)}),this.g.attachEmptyPacketListener("hand_landmarks",i=>{He(this,i)}),this.g.attachProtoVectorListener("world_hand_landmarks",(i,r)=>{for(const s of i){i=vd(s);const o=[];for(const a of Za(i,B$,1))o.push({x:ti(a,1)??0,y:ti(a,2)??0,z:ti(a,3)??0,visibility:ti(a,4)??0});this.worldLandmarks.push(o)}He(this,r)}),this.g.attachEmptyPacketListener("world_hand_landmarks",i=>{He(this,i)}),this.g.attachProtoVectorListener("hand_gestures",(i,r)=>{this.gestures.push(...TO(i,!1)),He(this,r)}),this.g.attachEmptyPacketListener("hand_gestures",i=>{He(this,i)}),this.g.attachProtoVectorListener("handedness",(i,r)=>{this.handedness.push(...TO(i)),He(this,r)}),this.g.attachEmptyPacketListener("handedness",i=>{He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};function AO(t){return{landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handednesses:t.handedness,handedness:t.handedness}}ss.prototype.recognizeForVideo=ss.prototype.La,ss.prototype.recognize=ss.prototype.Ka,ss.prototype.setOptions=ss.prototype.o,ss.createFromModelPath=function(t,e){return Ht(ss,t,{baseOptions:{modelAssetPath:e}})},ss.createFromModelBuffer=function(t,e){return Ht(ss,t,{baseOptions:{modelAssetBuffer:e}})},ss.createFromOptions=function(t,e){return Ht(ss,t,e)},ss.HAND_CONNECTIONS=IP;var os=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],ct(t=this.h=new fP,0,1,e=new Fn),this.s=new pP,ct(this.h,0,3,this.s),this.j=new J$,ct(this.h,0,2,this.j),la(this.j,3,1),nt(this.j,2,.5),nt(this.s,2,.5),nt(this.h,4,.5)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return"numHands"in t&&la(this.j,3,t.numHands??1),"minHandDetectionConfidence"in t&&nt(this.j,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&nt(this.h,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&nt(this.s,2,t.minHandPresenceConfidence??.5),this.l(t)}D(t,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],no(this,t,e),AO(this)}F(t,e,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],ga(this,t,n,e),AO(this)}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"hand_landmarks"),tn(t,"world_hand_landmarks"),tn(t,"handedness");const e=new _s;Oo(e,Kde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"LANDMARKS:hand_landmarks"),jt(n,"WORLD_LANDMARKS:world_hand_landmarks"),jt(n,"HANDEDNESS:handedness"),n.o(e),bs(t,n),this.g.attachProtoVectorListener("hand_landmarks",(i,r)=>{for(const s of i)i=q0(s),this.landmarks.push(LC(i));He(this,r)}),this.g.attachEmptyPacketListener("hand_landmarks",i=>{He(this,i)}),this.g.attachProtoVectorListener("world_hand_landmarks",(i,r)=>{for(const s of i)i=vd(s),this.worldLandmarks.push(Ag(i));He(this,r)}),this.g.attachEmptyPacketListener("world_hand_landmarks",i=>{He(this,i)}),this.g.attachProtoVectorListener("handedness",(i,r)=>{var s=this.handedness,o=s.push;const a=[];for(const c of i){i=MC(c);const l=[];for(const u of i.g())l.push({score:ti(u,2)??0,index:Io($s(u,1),0)??-1,categoryName:ca(u,3)??"",displayName:ca(u,4)??""});a.push(l)}o.call(s,...a),He(this,r)}),this.g.attachEmptyPacketListener("handedness",i=>{He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};os.prototype.detectForVideo=os.prototype.F,os.prototype.detect=os.prototype.D,os.prototype.setOptions=os.prototype.o,os.createFromModelPath=function(t,e){return Ht(os,t,{baseOptions:{modelAssetPath:e}})},os.createFromModelBuffer=function(t,e){return Ht(os,t,{baseOptions:{modelAssetBuffer:e}})},os.createFromOptions=function(t,e){return Ht(os,t,e)},os.HAND_CONNECTIONS=IP;var E8=Uo([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function PO(t){t.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function IO(t){try{if(!t.C)return t.h;t.C(t.h)}finally{NC(t)}}function cy(t,e){t=q0(t),e.push(LC(t))}var Ln=class extends Xr{constructor(t,e){super(new to(t,e),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,ct(t=this.j=new i8,0,1,e=new Fn),this.K=new pP,ct(this.j,0,2,this.K),this.aa=new Yde,ct(this.j,0,3,this.aa),this.s=new kC,ct(this.j,0,4,this.s),this.I=new G$,ct(this.j,0,5,this.I),this.v=new t8,ct(this.j,0,6,this.v),this.L=new n8,ct(this.j,0,7,this.L),nt(this.s,2,.5),nt(this.s,3,.3),nt(this.I,2,.5),nt(this.v,2,.5),nt(this.v,3,.3),nt(this.L,2,.5),nt(this.K,2,.5)}get baseOptions(){return Jt(this.j,Fn,1)}set baseOptions(t){ct(this.j,0,1,t)}o(t){return"minFaceDetectionConfidence"in t&&nt(this.s,2,t.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in t&&nt(this.s,3,t.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in t&&nt(this.I,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"minPoseDetectionConfidence"in t&&nt(this.v,2,t.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in t&&nt(this.v,3,t.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in t&&nt(this.L,2,t.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in t&&(this.outputPoseSegmentationMasks=!!t.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in t&&nt(this.K,2,t.minHandLandmarksConfidence??.5),this.l(t)}D(t,e,n){const i=typeof e!="function"?e:{};return this.C=typeof e=="function"?e:n,PO(this),no(this,t,i),IO(this)}F(t,e,n,i){const r=typeof n!="function"?n:{};return this.C=typeof n=="function"?n:i,PO(this),ga(this,t,r,e),IO(this)}m(){var t=new Qr;kn(t,"input_frames_image"),tn(t,"pose_landmarks"),tn(t,"pose_world_landmarks"),tn(t,"face_landmarks"),tn(t,"left_hand_landmarks"),tn(t,"left_hand_world_landmarks"),tn(t,"right_hand_landmarks"),tn(t,"right_hand_world_landmarks");const e=new _s,n=new ZN;Mb(n,1,yp("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(r,s){if(s!=null)if(Array.isArray(s))Cn(r,2,SC(s,VA,void 0,void 0,!1));else{if(!(typeof s=="string"||s instanceof Va||H0(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");Mb(r,2,LA(s,!1,!1),Ou())}}(n,this.j.g());const i=new Ar;Rs(i,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),J1(i,8,ZN,n),En(i,"IMAGE:input_frames_image"),jt(i,"POSE_LANDMARKS:pose_landmarks"),jt(i,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),jt(i,"FACE_LANDMARKS:face_landmarks"),jt(i,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),jt(i,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),jt(i,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),jt(i,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),i.o(e),bs(t,i),DC(this,t),this.g.attachProtoListener("pose_landmarks",(r,s)=>{cy(r,this.h.poseLandmarks),He(this,s)}),this.g.attachEmptyPacketListener("pose_landmarks",r=>{He(this,r)}),this.g.attachProtoListener("pose_world_landmarks",(r,s)=>{var o=this.h.poseWorldLandmarks;r=vd(r),o.push(Ag(r)),He(this,s)}),this.g.attachEmptyPacketListener("pose_world_landmarks",r=>{He(this,r)}),this.outputPoseSegmentationMasks&&(jt(i,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),jd(this,"pose_segmentation_mask"),this.g.V("pose_segmentation_mask",(r,s)=>{this.h.poseSegmentationMasks=[qd(this,r,!0,!this.C)],He(this,s)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",r=>{this.h.poseSegmentationMasks=[],He(this,r)})),this.g.attachProtoListener("face_landmarks",(r,s)=>{cy(r,this.h.faceLandmarks),He(this,s)}),this.g.attachEmptyPacketListener("face_landmarks",r=>{He(this,r)}),this.outputFaceBlendshapes&&(tn(t,"extra_blendshapes"),jt(i,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(r,s)=>{var o=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(r=MC(r),o.push(yP(r.g()??[]))),He(this,s)}),this.g.attachEmptyPacketListener("extra_blendshapes",r=>{He(this,r)})),this.g.attachProtoListener("left_hand_landmarks",(r,s)=>{cy(r,this.h.leftHandLandmarks),He(this,s)}),this.g.attachEmptyPacketListener("left_hand_landmarks",r=>{He(this,r)}),this.g.attachProtoListener("left_hand_world_landmarks",(r,s)=>{var o=this.h.leftHandWorldLandmarks;r=vd(r),o.push(Ag(r)),He(this,s)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",r=>{He(this,r)}),this.g.attachProtoListener("right_hand_landmarks",(r,s)=>{cy(r,this.h.rightHandLandmarks),He(this,s)}),this.g.attachEmptyPacketListener("right_hand_landmarks",r=>{He(this,r)}),this.g.attachProtoListener("right_hand_world_landmarks",(r,s)=>{var o=this.h.rightHandWorldLandmarks;r=vd(r),o.push(Ag(r)),He(this,s)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",r=>{He(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ln.prototype.detectForVideo=Ln.prototype.F,Ln.prototype.detect=Ln.prototype.D,Ln.prototype.setOptions=Ln.prototype.o,Ln.createFromModelPath=function(t,e){return Ht(Ln,t,{baseOptions:{modelAssetPath:e}})},Ln.createFromModelBuffer=function(t,e){return Ht(Ln,t,{baseOptions:{modelAssetBuffer:e}})},Ln.createFromOptions=function(t,e){return Ht(Ln,t,e)},Ln.HAND_CONNECTIONS=IP,Ln.POSE_CONNECTIONS=E8,Ln.FACE_LANDMARKS_LIPS=EP,Ln.FACE_LANDMARKS_LEFT_EYE=RP,Ln.FACE_LANDMARKS_LEFT_EYEBROW=bP,Ln.FACE_LANDMARKS_LEFT_IRIS=x8,Ln.FACE_LANDMARKS_RIGHT_EYE=TP,Ln.FACE_LANDMARKS_RIGHT_EYEBROW=AP,Ln.FACE_LANDMARKS_RIGHT_IRIS=C8,Ln.FACE_LANDMARKS_FACE_OVAL=PP,Ln.FACE_LANDMARKS_CONTOURS=_8,Ln.FACE_LANDMARKS_TESSELATION=w8;var Is=class extends Xr{constructor(t,e){super(new to(t,e),"input_image","norm_rect",!0),this.j={classifications:[]},ct(t=this.h=new r8,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return ct(this.h,0,2,Fb(t,Jt(this.h,uP,2))),this.l(t)}ua(t,e){return this.j={classifications:[]},no(this,t,e),this.j}va(t,e,n){return this.j={classifications:[]},ga(this,t,n,e),this.j}m(){var t=new Qr;kn(t,"input_image"),kn(t,"norm_rect"),tn(t,"classifications");const e=new _s;Oo(e,Jde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),En(n,"IMAGE:input_image"),En(n,"NORM_RECT:norm_rect"),jt(n,"CLASSIFICATIONS:classifications"),n.o(e),bs(t,n),this.g.attachProtoListener("classifications",(i,r)=>{this.j=function(s){const o={classifications:Za(s,Fde,1).map(a=>{var c;return yP(((c=Jt(a,F$,4))==null?void 0:c.g())??[],Io($s(a,2),0),ca(a,3))})};return X1(cl(s,2))!=null&&(o.timestampMs=Io(X1(cl(s,2)),0)),o}(zde(i)),He(this,r)}),this.g.attachEmptyPacketListener("classifications",i=>{He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Is.prototype.classifyForVideo=Is.prototype.va,Is.prototype.classify=Is.prototype.ua,Is.prototype.setOptions=Is.prototype.o,Is.createFromModelPath=function(t,e){return Ht(Is,t,{baseOptions:{modelAssetPath:e}})},Is.createFromModelBuffer=function(t,e){return Ht(Is,t,{baseOptions:{modelAssetBuffer:e}})},Is.createFromOptions=function(t,e){return Ht(Is,t,e)};var as=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!0),this.h=new s8,this.embeddings={embeddings:[]},ct(t=this.h,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){var e=this.h,n=Jt(this.h,cO,2);return n=n?n.clone():new cO,t.l2Normalize!==void 0?l0(n,1,t.l2Normalize):"l2Normalize"in t&&Cn(n,1),t.quantize!==void 0?l0(n,2,t.quantize):"quantize"in t&&Cn(n,2),ct(e,0,2,n),this.l(t)}Ba(t,e){return no(this,t,e),this.embeddings}Ca(t,e,n){return ga(this,t,n,e),this.embeddings}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"embeddings_out");const e=new _s;Oo(e,Qde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"EMBEDDINGS:embeddings_out"),n.o(e),bs(t,n),this.g.attachProtoListener("embeddings_out",(i,r)=>{i=$de(i),this.embeddings=function(s){return{embeddings:Za(s,Bde,1).map(o=>{var c,l;const a={headIndex:Io($s(o,3),0)??-1,headName:ca(o,4)??""};if(i$(o,aO,tE(o,1))!==void 0)o=fu(o=Jt(o,aO,tE(o,1)),1,El,pu()),a.floatEmbedding=o.slice();else{const u=new Uint8Array(0);a.quantizedEmbedding=((l=(c=Jt(o,Ude,tE(o,2)))==null?void 0:c.qa())==null?void 0:l.h())??u}return a}),timestampMs:Io(X1(cl(s,2)),0)}}(i),He(this,r)}),this.g.attachEmptyPacketListener("embeddings_out",i=>{He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};as.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=pO(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");t=pO(dO(t.quantizedEmbedding),dO(e.quantizedEmbedding))}return t},as.prototype.embedForVideo=as.prototype.Ca,as.prototype.embed=as.prototype.Ba,as.prototype.setOptions=as.prototype.o,as.createFromModelPath=function(t,e){return Ht(as,t,{baseOptions:{modelAssetPath:e}})},as.createFromModelBuffer=function(t,e){return Ht(as,t,{baseOptions:{modelAssetBuffer:e}})},as.createFromOptions=function(t,e){return Ht(as,t,e)};var Bb=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){var t,e;(t=this.confidenceMasks)==null||t.forEach(n=>{n.close()}),(e=this.categoryMask)==null||e.close()}};function MO(t){t.categoryMask=void 0,t.confidenceMasks=void 0,t.qualityScores=void 0}function kO(t){try{const e=new Bb(t.confidenceMasks,t.categoryMask,t.qualityScores);if(!t.j)return e;t.j(e)}finally{NC(t)}}Bb.prototype.close=Bb.prototype.close;var Nr=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new vP,this.v=new o8,ct(this.h,0,3,this.v),ct(t=this.h,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Cn(this.h,2,yp(t.displayNamesLocale)):"displayNamesLocale"in t&&Cn(this.h,2),"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}J(){(function(t){var n,i;const e=Za(t.ea(),Ar,1).filter(r=>ca(r,1).includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(t.s=[],e.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");e.length===1&&(((i=(n=Jt(e[0],_s,7))==null?void 0:n.l())==null?void 0:i.g())??new Map).forEach((r,s)=>{t.s[Number(s)]=ca(r,1)})})(this)}fa(t,e,n){const i=typeof e!="function"?e:{};return this.j=typeof e=="function"?e:n,MO(this),no(this,t,i),kO(this)}Na(t,e,n,i){const r=typeof n!="function"?n:{};return this.j=typeof n=="function"?n:i,MO(this),ga(this,t,r,e),kO(this)}Fa(){return this.s}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect");const e=new _s;Oo(e,c8,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),n.o(e),bs(t,n),DC(this,t),this.outputConfidenceMasks&&(tn(t,"confidence_masks"),jt(n,"CONFIDENCE_MASKS:confidence_masks"),jd(this,"confidence_masks"),this.g.da("confidence_masks",(i,r)=>{this.confidenceMasks=i.map(s=>qd(this,s,!0,!this.j)),He(this,r)}),this.g.attachEmptyPacketListener("confidence_masks",i=>{this.confidenceMasks=[],He(this,i)})),this.outputCategoryMask&&(tn(t,"category_mask"),jt(n,"CATEGORY_MASK:category_mask"),jd(this,"category_mask"),this.g.V("category_mask",(i,r)=>{this.categoryMask=qd(this,i,!1,!this.j),He(this,r)}),this.g.attachEmptyPacketListener("category_mask",i=>{this.categoryMask=void 0,He(this,i)})),tn(t,"quality_scores"),jt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(i,r)=>{this.qualityScores=i,He(this,r)}),this.g.attachEmptyPacketListener("quality_scores",i=>{this.categoryMask=void 0,He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Nr.prototype.getLabels=Nr.prototype.Fa,Nr.prototype.segmentForVideo=Nr.prototype.Na,Nr.prototype.segment=Nr.prototype.fa,Nr.prototype.setOptions=Nr.prototype.o,Nr.createFromModelPath=function(t,e){return Ht(Nr,t,{baseOptions:{modelAssetPath:e}})},Nr.createFromModelBuffer=function(t,e){return Ht(Nr,t,{baseOptions:{modelAssetBuffer:e}})},Nr.createFromOptions=function(t,e){return Ht(Nr,t,e)};var $b=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){var t,e;(t=this.confidenceMasks)==null||t.forEach(n=>{n.close()}),(e=this.categoryMask)==null||e.close()}};$b.prototype.close=$b.prototype.close;var ope=class extends Qe{constructor(t){super(t)}},kh=[0,Yn,-2],nS=[0,ka,-3,Bn,ka,-1],LO=[0,nS],DO=[0,nS,Yn,-1],aE=class extends Qe{constructor(t){super(t)}},NO=[0,ka,-1,Bn],ape=class extends Qe{constructor(){super()}},OO=class extends Qe{constructor(t){super(t)}},Hb=[1,2,3,4,5,6,7,8,9,10,14,15],R8=class extends Qe{constructor(){super()}};R8.prototype.g=IC([0,vi,[0,Hb,dn,nS,dn,[0,nS,kh],dn,LO,dn,[0,LO,kh],dn,NO,dn,[0,ka,-3,Bn,Mo],dn,[0,ka,-3,Bn],dn,[0,cn,ka,-2,Bn,Yn,Bn,-1,2,ka,kh],dn,DO,dn,[0,DO,kh],ka,kh,cn,dn,[0,ka,-3,Bn,kh,-1],dn,[0,vi,NO]],cn,[0,cn,Yn,-1,Bn]]);var Go=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new vP,this.s=new o8,ct(this.h,0,3,this.s),ct(t=this.h,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}fa(t,e,n,i){const r=typeof n!="function"?n:{};this.j=typeof n=="function"?n:i,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,i=new R8;const s=new OO;var o=new ope;if(la(o,1,255),ct(s,0,12,o),e.keypoint&&e.scribble)throw Error("Cannot provide both keypoint and scribble.");if(e.keypoint){var a=new aE;l0(a,3,!0),nt(a,1,e.keypoint.x),nt(a,2,e.keypoint.y),Rg(s,5,Hb,a)}else{if(!e.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(o=new ape,e.scribble))l0(e=new aE,3,!0),nt(e,1,a.x),nt(e,2,a.y),J1(o,1,aE,e);Rg(s,15,Hb,o)}J1(i,1,OO,s),this.g.addProtoToStream(i.g(),"drishti.RenderData","roi_in",n),no(this,t,r);e:{try{const l=new $b(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var c=l;break e}this.j(l)}finally{NC(this)}c=void 0}return c}m(){var t=new Qr;kn(t,"image_in"),kn(t,"roi_in"),kn(t,"norm_rect_in");const e=new _s;Oo(e,c8,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),En(n,"IMAGE:image_in"),En(n,"ROI:roi_in"),En(n,"NORM_RECT:norm_rect_in"),n.o(e),bs(t,n),DC(this,t),this.outputConfidenceMasks&&(tn(t,"confidence_masks"),jt(n,"CONFIDENCE_MASKS:confidence_masks"),jd(this,"confidence_masks"),this.g.da("confidence_masks",(i,r)=>{this.confidenceMasks=i.map(s=>qd(this,s,!0,!this.j)),He(this,r)}),this.g.attachEmptyPacketListener("confidence_masks",i=>{this.confidenceMasks=[],He(this,i)})),this.outputCategoryMask&&(tn(t,"category_mask"),jt(n,"CATEGORY_MASK:category_mask"),jd(this,"category_mask"),this.g.V("category_mask",(i,r)=>{this.categoryMask=qd(this,i,!1,!this.j),He(this,r)}),this.g.attachEmptyPacketListener("category_mask",i=>{this.categoryMask=void 0,He(this,i)})),tn(t,"quality_scores"),jt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(i,r)=>{this.qualityScores=i,He(this,r)}),this.g.attachEmptyPacketListener("quality_scores",i=>{this.categoryMask=void 0,He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Go.prototype.segment=Go.prototype.fa,Go.prototype.setOptions=Go.prototype.o,Go.createFromModelPath=function(t,e){return Ht(Go,t,{baseOptions:{modelAssetPath:e}})},Go.createFromModelBuffer=function(t,e){return Ht(Go,t,{baseOptions:{modelAssetBuffer:e}})},Go.createFromOptions=function(t,e){return Ht(Go,t,e)};var Ms=class extends Xr{constructor(t,e){super(new to(t,e),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},ct(t=this.h=new l8,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Cn(this.h,2,yp(t.displayNamesLocale)):"displayNamesLocale"in t&&Cn(this.h,2),t.maxResults!==void 0?la(this.h,3,t.maxResults):"maxResults"in t&&Cn(this.h,3),t.scoreThreshold!==void 0?nt(this.h,4,t.scoreThreshold):"scoreThreshold"in t&&Cn(this.h,4),t.categoryAllowlist!==void 0?Q1(this.h,5,t.categoryAllowlist):"categoryAllowlist"in t&&Cn(this.h,5),t.categoryDenylist!==void 0?Q1(this.h,6,t.categoryDenylist):"categoryDenylist"in t&&Cn(this.h,6),this.l(t)}D(t,e){return this.j={detections:[]},no(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},ga(this,t,n,e),this.j}m(){var t=new Qr;kn(t,"input_frame_gpu"),kn(t,"norm_rect"),tn(t,"detections");const e=new _s;Oo(e,epe,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),En(n,"IMAGE:input_frame_gpu"),En(n,"NORM_RECT:norm_rect"),jt(n,"DETECTIONS:detections"),n.o(e),bs(t,n),this.g.attachProtoVectorListener("detections",(i,r)=>{for(const s of i)i=U$(s),this.j.detections.push(h8(i));He(this,r)}),this.g.attachEmptyPacketListener("detections",i=>{He(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ms.prototype.detectForVideo=Ms.prototype.F,Ms.prototype.detect=Ms.prototype.D,Ms.prototype.setOptions=Ms.prototype.o,Ms.createFromModelPath=async function(t,e){return Ht(Ms,t,{baseOptions:{modelAssetPath:e}})},Ms.createFromModelBuffer=function(t,e){return Ht(Ms,t,{baseOptions:{modelAssetBuffer:e}})},Ms.createFromOptions=function(t,e){return Ht(Ms,t,e)};var Vb=class{constructor(t,e,n){this.landmarks=t,this.worldLandmarks=e,this.segmentationMasks=n}close(){var t;(t=this.segmentationMasks)==null||t.forEach(e=>{e.close()})}};function FO(t){t.landmarks=[],t.worldLandmarks=[],t.segmentationMasks=void 0}function zO(t){try{const e=new Vb(t.landmarks,t.worldLandmarks,t.segmentationMasks);if(!t.s)return e;t.s(e)}finally{NC(t)}}Vb.prototype.close=Vb.prototype.close;var cs=class extends Xr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,ct(t=this.h=new u8,0,1,e=new Fn),this.v=new n8,ct(this.h,0,3,this.v),this.j=new t8,ct(this.h,0,2,this.j),la(this.j,4,1),nt(this.j,2,.5),nt(this.v,2,.5),nt(this.h,4,.5)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){ct(this.h,0,1,t)}o(t){return"numPoses"in t&&la(this.j,4,t.numPoses??1),"minPoseDetectionConfidence"in t&&nt(this.j,2,t.minPoseDetectionConfidence??.5),"minTrackingConfidence"in t&&nt(this.h,4,t.minTrackingConfidence??.5),"minPosePresenceConfidence"in t&&nt(this.v,2,t.minPosePresenceConfidence??.5),"outputSegmentationMasks"in t&&(this.outputSegmentationMasks=t.outputSegmentationMasks??!1),this.l(t)}D(t,e,n){const i=typeof e!="function"?e:{};return this.s=typeof e=="function"?e:n,FO(this),no(this,t,i),zO(this)}F(t,e,n,i){const r=typeof n!="function"?n:{};return this.s=typeof n=="function"?n:i,FO(this),ga(this,t,r,e),zO(this)}m(){var t=new Qr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"normalized_landmarks"),tn(t,"world_landmarks"),tn(t,"segmentation_masks");const e=new _s;Oo(e,tpe,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"NORM_LANDMARKS:normalized_landmarks"),jt(n,"WORLD_LANDMARKS:world_landmarks"),n.o(e),bs(t,n),DC(this,t),this.g.attachProtoVectorListener("normalized_landmarks",(i,r)=>{this.landmarks=[];for(const s of i)i=q0(s),this.landmarks.push(LC(i));He(this,r)}),this.g.attachEmptyPacketListener("normalized_landmarks",i=>{this.landmarks=[],He(this,i)}),this.g.attachProtoVectorListener("world_landmarks",(i,r)=>{this.worldLandmarks=[];for(const s of i)i=vd(s),this.worldLandmarks.push(Ag(i));He(this,r)}),this.g.attachEmptyPacketListener("world_landmarks",i=>{this.worldLandmarks=[],He(this,i)}),this.outputSegmentationMasks&&(jt(n,"SEGMENTATION_MASK:segmentation_masks"),jd(this,"segmentation_masks"),this.g.da("segmentation_masks",(i,r)=>{this.segmentationMasks=i.map(s=>qd(this,s,!0,!this.s)),He(this,r)}),this.g.attachEmptyPacketListener("segmentation_masks",i=>{this.segmentationMasks=[],He(this,i)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};cs.prototype.detectForVideo=cs.prototype.F,cs.prototype.detect=cs.prototype.D,cs.prototype.setOptions=cs.prototype.o,cs.createFromModelPath=function(t,e){return Ht(cs,t,{baseOptions:{modelAssetPath:e}})},cs.createFromModelBuffer=function(t,e){return Ht(cs,t,{baseOptions:{modelAssetBuffer:e}})},cs.createFromOptions=function(t,e){return Ht(cs,t,e)},cs.POSE_CONNECTIONS=E8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cpe=1e-7,lpe=1e-4;class upe{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class b8{refCount(e){return Or("refCount")}incRef(e){return Or("incRef")}timerAvailable(){return!0}time(e){return Or("time")}read(e){return Or("read")}readSync(e){return Or("readSync")}readToGPU(e,n){return Or("readToGPU")}numDataIds(){return Or("numDataIds")}disposeData(e,n){return Or("disposeData")}write(e,n,i){return Or("write")}move(e,n,i,r,s){return Or("move")}createTensorFromGPUData(e,n,i){return Or("createTensorFromGPUData")}memory(){return Or("memory")}floatPrecision(){return Or("floatPrecision")}epsilon(){return this.floatPrecision()===32?cpe:lpe}dispose(){return Or("dispose")}}function Or(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iS(t,e,n){return Math.max(t,Math.min(e,n))}function MP(t){return t%2===0?t:t+1}function Gm(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function hpe(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function Ee(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function T8(t,e,n=""){Ee(Ni(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function be(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Ni(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function rS(t){return t%1===0}function jb(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function yd(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function UO(t,e=r=>0,n,i){return new Promise((r,s)=>{let o=0;const a=()=>{if(t()){r();return}o++;const c=e(o);if(n!=null&&o>=n){s();return}i!=null?i(a,c):setTimeout(a,c)};a()})}function dpe(t,e){let n=1,i=-1;for(let s=0;s<t.length;++s)if(t[s]>=0)n*=t[s];else if(t[s]===-1){if(i!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${i} and dim ${s}`);i=s}else if(t[s]<0)throw Error(`Shapes can not be < 0. Found ${t[s]} at dim ${s}`);if(i===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[i]=e/n,r}function kr(t,e){const n=e.length;return t=t==null?e.map((i,r)=>r):[].concat(t),Ee(t.every(i=>i>=-n&&i<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),Ee(t.every(i=>rS(i)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(i=>i<0?n+i:i)}function Qu(t,e){const n=[],i=[];for(let r=0;r<t.length;++r)t[r]!==1&&(n.push(t[r]),i.push(r));return{newShape:n,keptDims:i}}function zu(t,e){return _i(t,e)}function _i(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function ppe(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${e} being uploaded contains ${i}.`)}}function fpe(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function mpe(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function sS(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function gpe(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function UC(t){return typeof t=="string"||t instanceof String}function vpe(t){return typeof t=="boolean"}function ype(t){return typeof t=="number"}function X0(t){return Array.isArray(t)?X0(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":ype(t)?"float32":UC(t)?"string":vpe(t)?"bool":"float32"}function Wb(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Gb(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Di(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let i=e-3;i>=0;--i)n[i]=n[i+1]*t[i+1];return n}function A8(t,e,n,i=!1){const r=new Array;if(e.length===1){const s=e[0]*(i?2:1);for(let o=0;o<s;o++)r[o]=n[t+o]}else{const s=e[0],o=e.slice(1),a=o.reduce((c,l)=>c*l)*(i?2:1);for(let c=0;c<s;c++)r[c]=A8(t+c*a,o,n,i)}return r}function BO(t,e,n=!1){if(t.length===0)return e[0];const i=t.reduce((r,s)=>r*s)*(n?2:1);if(i===0)return[];if(i!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return A8(0,t,e,n)}function Spe(t,e){const n=dl(t,e);for(let i=0;i<n.length;i++)n[i]=1;return n}function dl(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function K0(t){t.forEach(e=>{Ee(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function qb(t,e,n){if(e===0)return 0;if(e===1)return t[0];let i=t[t.length-1];for(let r=0;r<t.length-1;++r)i+=n[r]*t[r];return i}function kP(t,e,n){if(e===0)return[];if(e===1)return[t];const i=new Array(e);for(let r=0;r<i.length-1;++r)i[r]=Math.floor(t/n[r]),t-=i[r]*n[r];return i[i.length-1]=t,i}function LP(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $O="tfjsflags";class xpe{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Cpe,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,i){if(this.flagRegistry[e]={evaluationFn:n,setHook:i},this.urlFlags[e]!=null){const r=this.urlFlags[e];Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(LP(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);$O in e&&e[$O].split(",").forEach(i=>{const[r,s]=i.split(":");this.urlFlags[r]=wpe(r,s)})}}function Cpe(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...i)=>(_pe(e,i[0],i[1]),i.join("="))),e}function _pe(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function wpe(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function Z(){return P8}let P8=null;function Epe(t){P8=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let cE;function I8(){if(cE==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");cE=t}return cE}function Rpe(){const t=I8();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function DP(t,e){const n=Rpe();if(n.has(t))return n.get(t);{const i=e();return n.set(t,i),n.get(t)}}const M8="Abs",bpe="Acos",Tpe="Acosh",NP="Add",Ape="AddN",Ppe="All",Ipe="Any",Mpe="ArgMax",kpe="ArgMin",Lpe="Asin",Dpe="Asinh",Npe="Atan",Ope="Atanh",Fpe="Atan2",zpe="AvgPool",Upe="AvgPoolGrad",Bpe="AvgPool3D",$pe="AvgPool3DGrad",Hpe="BatchMatMul",Vpe="BatchToSpaceND",jpe="Bincount",Wpe="BitwiseAnd",Gpe="BroadcastArgs",OP="Cast",qpe="Ceil",Xpe="ClipByValue",k8="Complex",L8="ComplexAbs",Kpe="Concat",Ype="Conv2D",Jpe="Conv2DBackpropFilter",Qpe="Conv2DBackpropInput",Zpe="Conv3D",efe="Conv3DBackpropFilterV2",tfe="Conv3DBackpropInputV2",nfe="Cos",ife="Cosh",rfe="Cumprod",sfe="Cumsum",ofe="CropAndResize",afe="DenseBincount",cfe="DepthToSpace",lfe="DepthwiseConv2dNative",ufe="DepthwiseConv2dNativeBackpropFilter",hfe="DepthwiseConv2dNativeBackpropInput",dfe="Diag",pfe="Dilation2D",D8="RealDiv",ffe="Einsum",N8="Elu",mfe="EluGrad",gfe="Erf",vfe="Equal",yfe="Exp",Sfe="ExpandDims",xfe="Expm1",Cfe="FFT",O8="Fill",_fe="FlipLeftRight",wfe="Floor",F8="FloorDiv",Efe="FusedBatchNorm",Rfe="GatherV2",bfe="GatherNd",Tfe="Greater",Afe="GreaterEqual",FP="Identity",Pfe="IFFT",Ife="Imag",Mfe="IsFinite",kfe="IsInf",Lfe="IsNan",z8="LeakyRelu",Dfe="Less",Nfe="LessEqual",Ofe="LinSpace",Ffe="Log",zfe="Log1p",Ufe="LogicalAnd",Bfe="LogicalNot",$fe="LogicalOr",Hfe="LRN",Vfe="LRNGrad",jfe="Max",U8="Maximum",Wfe="MaxPool",Gfe="MaxPoolGrad",qfe="MaxPool3D",Xfe="MaxPool3DGrad",Kfe="MaxPoolWithArgmax",Yfe="Mean",Jfe="Min",Qfe="Minimum",Zfe="MirrorPad",eme="Mod",tme="Multinomial",B8="Multiply",nme="Neg",ime="NotEqual",rme="NonMaxSuppressionV3",sme="NonMaxSuppressionV4",ome="NonMaxSuppressionV5",ame="OnesLike",cme="OneHot",lme="Pack",ume="PadV2",$8="Pow",H8="Prelu",hme="Prod",dme="RaggedGather",pme="RaggedRange",fme="RaggedTensorToTensor",mme="Range",gme="Real",vme="Reciprocal",V8="Relu",j8="Reshape",yme="ResizeNearestNeighbor",Sme="ResizeNearestNeighborGrad",xme="ResizeBilinear",Cme="ResizeBilinearGrad",W8="Relu6",_me="Reverse",wme="Round",Eme="Rsqrt",Rme="ScatterNd",bme="TensorScatterUpdate",Tme="SearchSorted",Ame="Select",Pme="Selu",Ime="Slice",Mme="Sin",kme="Sinh",Lme="Sign",G8="Sigmoid",Dme="Softplus",q8="Sqrt",X8="Sum",Nme="SpaceToBatchND",Ome="SplitV",Fme="Softmax",zme="SparseFillEmptyRows",Ume="SparseReshape",Bme="SparseSegmentMean",$me="SparseSegmentSum",Hme="SparseToDense",Vme="SquaredDifference",jme="Square",Wme="StaticRegexReplace",Gme="StridedSlice",qme="StringNGrams",Xme="StringSplit",Kme="StringToHashBucketFast",K8="Sub",Yme="Tan",Jme="Tanh",Y8="Tile",Qme="TopK",Zme="Transform",ege="Transpose",tge="Unique",nge="Unpack",ige="UnsortedSegmentSum",J8="ZerosLike",Q8="Step",rge="FromPixels",sge="RotateWithOffset",oge="_FusedMatMul",age="FusedConv2D",cge="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eo(...t){Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(...t)}function lge(...t){Z().getBool("IS_TEST")||Z().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oS=DP("kernelRegistry",()=>new Map),uge=DP("gradRegistry",()=>new Map);function HO(t,e){const n=Z8(t,e);return oS.get(n)}function VO(t){return uge.get(t)}function jO(t){const e=oS.entries(),n=[];for(;;){const{done:i,value:r}=e.next();if(i)break;const[s,o]=r,[a]=s.split("_");a===t&&n.push(o)}return n}function hge(t){const{kernelName:e,backendName:n}=t,i=Z8(e,n);oS.has(i)&&Eo(`The kernel '${e}' for backend '${n}' is already registered`),oS.set(i,t)}function Z8(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eH(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var tH=Rn,Hs=null;try{Hs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Rn(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Rn.prototype.__isLong__;Object.defineProperty(Rn.prototype,"__isLong__",{value:!0});function Zr(t){return(t&&t.__isLong__)===!0}Rn.isLong=Zr;var WO={},GO={};function Zu(t,e){var n,i,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(i=GO[t],i)?i:(n=bn(t,(t|0)<0?-1:0,!0),r&&(GO[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(i=WO[t],i)?i:(n=bn(t,t<0?-1:0,!1),r&&(WO[t]=n),n))}Rn.fromInt=Zu;function Vs(t,e){if(isNaN(t))return e?mu:js;if(e){if(t<0)return mu;if(t>=nH)return sH}else{if(t<=-XO)return Vr;if(t+1>=XO)return rH}return t<0?Vs(-t,e).neg():bn(t%Xd|0,t/Xd|0,e)}Rn.fromNumber=Vs;function bn(t,e,n){return new Rn(t,e,n)}Rn.fromBits=bn;var aS=Math.pow;function zP(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return js;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return zP(t.substring(1),e,n).neg();for(var r=Vs(aS(n,8)),s=js,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+a),n);if(a<8){var l=Vs(aS(n,a));s=s.mul(l).add(Vs(c))}else s=s.mul(r),s=s.add(Vs(c))}return s.unsigned=e,s}Rn.fromString=zP;function Bo(t,e){return typeof t=="number"?Vs(t,e):typeof t=="string"?zP(t,e):bn(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Rn.fromValue=Bo;var qO=65536,dge=1<<24,Xd=qO*qO,nH=Xd*Xd,XO=nH/2,KO=Zu(dge),js=Zu(0);Rn.ZERO=js;var mu=Zu(0,!0);Rn.UZERO=mu;var td=Zu(1);Rn.ONE=td;var iH=Zu(1,!0);Rn.UONE=iH;var Xb=Zu(-1);Rn.NEG_ONE=Xb;var rH=bn(-1,2147483647,!1);Rn.MAX_VALUE=rH;var sH=bn(-1,-1,!0);Rn.MAX_UNSIGNED_VALUE=sH;var Vr=bn(0,-2147483648,!1);Rn.MIN_VALUE=Vr;var Re=Rn.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Xd+(this.low>>>0):this.high*Xd+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Vr)){var n=Vs(e),i=this.div(n),r=i.mul(n).sub(this);return i.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=Vs(aS(e,6),this.unsigned),o=this,a="";;){var c=o.div(s),l=o.sub(c.mul(s)).toInt()>>>0,u=l.toString(e);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Vr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return Zr(e)||(e=Bo(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(Zr(e)||(e=Bo(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Vr)?Vr:this.not().add(td)};Re.neg=Re.negate;Re.add=function(e){Zr(e)||(e=Bo(e));var n=this.high>>>16,i=this.high&65535,r=this.low>>>16,s=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,h=0,d=0,p=0;return p+=s+l,d+=p>>>16,p&=65535,d+=r+c,h+=d>>>16,d&=65535,h+=i+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,bn(d<<16|p,u<<16|h,this.unsigned)};Re.subtract=function(e){return Zr(e)||(e=Bo(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return js;if(Zr(e)||(e=Bo(e)),Hs){var n=Hs.mul(this.low,this.high,e.low,e.high);return bn(n,Hs.get_high(),this.unsigned)}if(e.isZero())return js;if(this.eq(Vr))return e.isOdd()?Vr:js;if(e.eq(Vr))return this.isOdd()?Vr:js;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(KO)&&e.lt(KO))return Vs(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=this.high&65535,s=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,h=0,d=0,p=0,f=0;return f+=o*u,p+=f>>>16,f&=65535,p+=s*u,d+=p>>>16,p&=65535,p+=o*l,d+=p>>>16,p&=65535,d+=r*u,h+=d>>>16,d&=65535,d+=s*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=i*u+r*l+s*c+o*a,h&=65535,bn(p<<16|f,h<<16|d,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(Zr(e)||(e=Bo(e)),e.isZero())throw Error("division by zero");if(Hs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Hs.div_u:Hs.div_s)(this.low,this.high,e.low,e.high);return bn(n,Hs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?mu:js;var i,r,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return mu;if(e.gt(this.shru(1)))return iH;s=mu}else{if(this.eq(Vr)){if(e.eq(td)||e.eq(Xb))return Vr;if(e.eq(Vr))return td;var o=this.shr(1);return i=o.div(e).shl(1),i.eq(js)?e.isNegative()?td:Xb:(r=this.sub(e.mul(i)),s=i.add(r.div(e)),s)}else if(e.eq(Vr))return this.unsigned?mu:js;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=js}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),c=a<=48?1:aS(2,a-48),l=Vs(i),u=l.mul(e);u.isNegative()||u.gt(r);)i-=c,l=Vs(i,this.unsigned),u=l.mul(e);l.isZero()&&(l=td),s=s.add(l),r=r.sub(u)}return s};Re.div=Re.divide;Re.modulo=function(e){if(Zr(e)||(e=Bo(e)),Hs){var n=(this.unsigned?Hs.rem_u:Hs.rem_s)(this.low,this.high,e.low,e.high);return bn(n,Hs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return bn(~this.low,~this.high,this.unsigned)};Re.and=function(e){return Zr(e)||(e=Bo(e)),bn(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return Zr(e)||(e=Bo(e)),bn(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return Zr(e)||(e=Bo(e)),bn(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return Zr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?bn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):bn(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return Zr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?bn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):bn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(Zr(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var i=this.low;return bn(i>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?bn(n,0,this.unsigned):bn(n>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?bn(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:bn(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Rn.fromBytes=function(e,n,i){return i?Rn.fromBytesLE(e,n):Rn.fromBytesBE(e,n)};Rn.fromBytesLE=function(e,n){return new Rn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Rn.fromBytesBE=function(e,n){return new Rn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const oH=vS(tH),pge=pT({__proto__:null,default:oH},[tH]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ou=oH||pge;function BC(t){return ou.fromString(t,!0,16)}const aH=BC("c3a5c85c97cb3127"),eu=BC("b492b66fbe98f273"),hr=BC("9ae16a3b2f90404f");function Kb(t){return t.xor(t.shru(47))}function cH(t,e,n){const i=t.slice(e,e+n);return ou.fromBytes(Array.from(i),!0,!0)}function yn(t,e){return cH(t,e,8)}function YO(t,e){return cH(t,e,4)}function Si(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function tl(t,e,n=BC("9ddfea08eb382d69")){let i=t.xor(e).mul(n);i=i.xor(i.shru(47));let r=e.xor(i).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function fge(t,e,n,i,r,s){r=r.add(t),s=Si(s.add(r).add(i),21);const o=r;return r=r.add(e),r=r.add(n),s=s.add(Si(r,44)),[r.add(i),s.add(o)]}function ly(t,e,n,i){return fge(yn(t,e),yn(t,e+8),yn(t,e+16),yn(t,e+24),n,i)}function mge(t,e=t.length){if(e>=8){const n=hr.add(e*2),i=yn(t,0).add(hr),r=yn(t,e-8),s=Si(r,37).mul(n).add(i),o=Si(i,25).add(r).mul(n);return tl(s,o,n)}if(e>=4){const n=hr.add(e*2),i=YO(t,0);return tl(i.shl(3).add(e),YO(t,e-4),n)}if(e>0){const n=t[0],i=t[e>>1],r=t[e-1],s=n+(i<<8),o=e+(r<<2);return Kb(hr.mul(s).xor(aH.mul(o))).mul(hr)}return hr}function gge(t,e=t.length){const n=hr.add(e*2),i=yn(t,0).mul(eu),r=yn(t,8),s=yn(t,e-8).mul(n),o=yn(t,e-16).mul(hr);return tl(Si(i.add(r),43).add(Si(s,30)).add(o),i.add(Si(r.add(hr),18)).add(s),n)}function vge(t,e=t.length){const n=hr.add(e*2),i=yn(t,0).mul(hr),r=yn(t,8),s=yn(t,e-8).mul(n),o=yn(t,e-16).mul(hr),a=Si(i.add(r),43).add(Si(s,30)).add(o),c=tl(a,i.add(Si(r.add(hr),18)).add(s),n),l=yn(t,16).mul(n),u=yn(t,24),h=a.add(yn(t,e-32)).mul(n),d=c.add(yn(t,e-24)).mul(n);return tl(Si(l.add(u),43).add(Si(h,30)).add(d),l.add(Si(u.add(i),18)).add(h),n)}function yge(t,e=t.length){const n=ou.fromNumber(81,!0);if(e<=32)return e<=16?mge(t,e):gge(t,e);if(e<=64)return vge(t,e);let i=n,r=n.mul(eu).add(113),s=Kb(r.mul(hr).add(113)).mul(hr),o=[ou.UZERO,ou.UZERO],a=[ou.UZERO,ou.UZERO];i=i.mul(hr).add(yn(t,0));let c=0;const l=(e-1>>6)*64,u=l+(e-1&63)-63;do i=Si(i.add(r).add(o[0]).add(yn(t,c+8)),37).mul(eu),r=Si(r.add(o[1]).add(yn(t,c+48)),42).mul(eu),i=i.xor(a[1]),r=r.add(o[0]).add(yn(t,c+40)),s=Si(s.add(a[0]),33).mul(eu),o=ly(t,c,o[1].mul(eu),i.add(a[0])),a=ly(t,c+32,s.add(a[1]),r.add(yn(t,c+16))),[s,i]=[i,s],c+=64;while(c!==l);const h=eu.add(s.and(255).shl(1));return c=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),i=Si(i.add(r).add(o[0]).add(yn(t,c+8)),37).mul(h),r=Si(r.add(o[1]).add(yn(t,c+48)),42).mul(h),i=i.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(yn(t,c+40))),s=Si(s.add(a[0]),33).mul(h),o=ly(t,c,o[1].mul(h),i.add(a[0])),a=ly(t,c+32,s.add(a[1]),r.add(yn(t,c+16))),[s,i]=[i,s],tl(tl(o[0],a[0],h).add(Kb(r).mul(aH)).add(s),tl(o[1],a[1],h).add(i),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(t,e){return e==="string"?Cu(t):$C([t],e)}function Sge(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function $C(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Uu(t)),Z().getBool("DEBUG")&&ppe(t,e),Sge(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let i=0;i<n.length;++i)Math.round(t[i])!==0&&(n[i]=1);return n}else throw new Error(`Unknown data type ${e}`)}function vo(){return Z().platform.now()}function Cu(t,e="utf-8"){return e=e||"utf-8",Z().platform.encode(t,e)}function Kd(t,e="utf-8"){return e=e||"utf-8",Z().platform.decode(t,e)}function Qs(t){return Z().platform.isTypedArray!=null?Z().platform.isTypedArray(t):eH(t)}function Uu(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||LP(t)||t==null||Qs(t)&&n)e.push(t);else if(Array.isArray(t)||Qs(t))for(let i=0;i<t.length;++i)Uu(t[i],e,n);else{let i=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(i=Math.max(i,Number(r)));for(let r=0;r<=i;r++)Uu(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xge{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new _ge)}profileKernel(e,n,i){let r;const s=()=>{r=i()};let o;const a=vo();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const l of r)l.dataSync();o=Promise.resolve({kernelMs:vo()-a})}if(Z().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){const u=r[l];u.data().then(h=>{Cge(h,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:i,timeMs:r,inputs:s,extraInfo:o}=e;i.forEach(a=>{Promise.all([a.data(),r,o]).then(c=>{this.logger.logKernelProfile(n,a,c[0],c[1],s,c[2])})})}}function Cge(t,e,n){if(e!=="float32")return!1;for(let i=0;i<t.length;i++){const r=t[i];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class _ge{logKernelProfile(e,n,i,r,s,o){const a=typeof r=="number"?yd(`${r}ms`,9):r.error,c=yd(e,25),l=n.rank,u=n.size,h=yd(n.shape.toString(),14);let d="";for(const p in s){const f=s[p];if(f!=null){const v=f.shape||n.shape,g=v.length;d+=`${p}: ${g}D ${g>0?v:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${h}	%c${u}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wge(t,e,n){const i={},r={};for(let c=0;c<e.length;c++)i[e[c].id]=!0;for(let c=0;c<t.length;c++){const l=t[c],u=l.inputs;for(const h in u){const d=u[h];let p=!1;for(let f=0;f<e.length;f++)if(i[d.id]){l.outputs.forEach(v=>i[v.id]=!0),p=!0,r[l.id]=!0;break}if(p)break}}const s={};s[n.id]=!0;const o={};for(let c=t.length-1;c>=0;c--){const l=t[c],u=l.inputs;for(let h=0;h<l.outputs.length;h++)if(s[l.outputs[h].id]){for(const d in u)s[u[d].id]=!0,o[l.id]=!0;break}}const a=[];for(let c=0;c<t.length;c++){const l=t[c];if(r[l.id]&&o[l.id]){const u={};for(const d in l.inputs){const p=l.inputs[d];i[p.id]&&(u[d]=p)}const h=Object.assign({},l);h.inputs=u,h.outputs=l.outputs,a.push(h)}}return a}function Ege(t,e,n,i){for(let r=e.length-1;r>=0;r--){const s=e[r],o=[];if(s.outputs.forEach(c=>{const l=t[c.id];l!=null?o.push(l):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const c in s.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);const l=n(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);const u=s.inputs[c];if(!Ni(l.shape,u.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=l;else{const h=t[u.id];t[u.id]=i(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JO=20,qm=3,lE=7;function Rge(t,e,n,i){const r=Di(e),s=bge(t,e,n,r),o=e.length,a=Yy(t,e,n,r,s),c=["Tensor"];return i&&(c.push(`  dtype: ${n}`),c.push(`  rank: ${o}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function bge(t,e,n,i){const r=be(e),s=i[i.length-1],o=new Array(s).fill(0),a=e.length,c=n==="complex64"?og(t):t;if(a>1)for(let l=0;l<r/s;l++){const u=l*s;for(let h=0;h<s;h++)o[h]=Math.max(o[h],sg(c[u+h],0,n).length)}return o}function sg(t,e,n){let i;return Array.isArray(t)?i=`${parseFloat(t[0].toFixed(lE))} + ${parseFloat(t[1].toFixed(lE))}j`:UC(t)?i=`'${t}'`:n==="bool"?i=lH(t):i=parseFloat(t.toFixed(lE)).toString(),yd(i,e)}function lH(t){return t===0?"false":"true"}function Yy(t,e,n,i,r,s=!0){const o=n==="complex64"?2:1,a=e[0],c=e.length;if(c===0){if(n==="complex64"){const v=og(t);return[sg(v[0],0,n)]}return n==="bool"?[lH(t[0])]:[t[0].toString()]}if(c===1){if(a>JO){const g=qm*o;let m=Array.from(t.slice(0,g)),y=Array.from(t.slice((a-qm)*o,a*o));return n==="complex64"&&(m=og(m),y=og(y)),["["+m.map((S,x)=>sg(S,r[x],n)).join(", ")+", ..., "+y.map((S,x)=>sg(S,r[a-qm+x],n)).join(", ")+"]"]}return["["+(n==="complex64"?og(t):Array.from(t)).map((g,m)=>sg(g,r[m],n)).join(", ")+"]"]}const l=e.slice(1),u=i.slice(1),h=i[0]*o,d=[];if(a>JO){for(let v=0;v<qm;v++){const g=v*h,m=g+h;d.push(...Yy(t.slice(g,m),l,n,u,r,!1))}d.push("...");for(let v=a-qm;v<a;v++){const g=v*h,m=g+h;d.push(...Yy(t.slice(g,m),l,n,u,r,v===a-1))}}else for(let v=0;v<a;v++){const g=v*h,m=g+h;d.push(...Yy(t.slice(g,m),l,n,u,r,v===a-1))}const p=c===2?",":"";d[0]="["+(a>0?d[0]+p:"");for(let v=1;v<d.length-1;v++)d[v]=" "+d[v]+p;let f=`,
`;for(let v=2;v<c;v++)f+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function og(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cS{constructor(e,n,i){if(this.dtype=n,this.shape=e.slice(),this.size=be(e),i!=null){const r=i.length;Ee(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=i||_i(n,this.size),this.strides=Di(e)}set(e,...n){n.length===0&&(n=[0]),Ee(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const i=this.locToIndex(n);this.values[i]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const s=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(s)}n++}let i=e[e.length-1];for(let r=0;r<e.length-1;++r)i+=this.strides[r]*e[r];return this.values[i]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let i=0;i<e.length-1;++i)n+=this.strides[i]*e[i];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let i=0;i<n.length-1;++i)n[i]=Math.floor(e/this.strides[i]),e-=n[i]*this.strides[i];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return So().makeTensor(this.values,this.shape,this.dtype)}}let So=null,Dh=null;function Tge(t){So=t}function Age(t){Dh=t}class xo{constructor(e,n,i,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=be(e),this.strides=Di(e),this.dataId=i,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Dh.buffer(this.shape,this.dtype,e)}bufferSync(){return Dh.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return BO(this.shape,e,this.dtype==="complex64")}arraySync(){return BO(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=So().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(i=>Kd(i))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),So().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=So().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Kd(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await So().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),So().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Dh.print(this,e)}clone(){return this.throwIfDisposed(),Dh.clone(this)}toString(e=!1){const n=this.dataSync();return Rge(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Dh.cast(this,e)}variable(e=!0,n,i){return this.throwIfDisposed(),So().makeVariable(this,e,n,i)}}Object.defineProperty(xo,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function uH(){return DP("Tensor",()=>xo)}uH();class lS extends xo{constructor(e,n,i,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=i}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ni(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);So().disposeTensor(this),this.dataId=e.dataId,So().incRef(this,null)}dispose(){So().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(lS,Symbol.hasInstance,{value:t=>t instanceof xo&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var QO;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(QO||(QO={}));var Yb;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(Yb||(Yb={}));var Jb;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(Jb||(Jb={}));var Qb;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(Qb||(Qb={}));var Zb;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(Zb||(Zb={}));const Pge={float32:Qb,int32:Yb,bool:Jb,complex64:Zb};function ua(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Pge[t][e]}function UP(t){return ua(t,"int32")}function hH(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function dH(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eh(t,e){if(t.dtype===e.dtype)return[t,e];const n=ua(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function pH(t){const e=[];return fH(t,e,new Set),e}function fH(t,e,n){if(t==null)return;if(t instanceof xo){e.push(t);return}if(!Ige(t))return;const i=t;for(const r in i){const s=i[r];n.has(s)||(n.add(s),fH(s,e,n))}}function Ige(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uE(t){return t.kernelName!=null}class ZO{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Yd{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ZO}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const i=e[n];if(await this.initializeBackend(i).success){await this.setBackend(i);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,i=1){return e in this.registryFactory?(Eo(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:i},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:i}=this.initializeBackend(e);if(!(i?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new xge(this.backendInstance),!0}setupRegisteredKernels(){jO(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){jO(e).forEach(i=>{i.disposeFunc!=null&&i.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const i=n.factory();if(i&&!(i instanceof b8)&&typeof i.then=="function"){const r=++this.pendingBackendInitId,s=i.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Eo(`Initialization of backend ${e} failed`),Eo(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(i){return Eo(`Initialization of backend ${e} failed`),Eo(i.stack||i.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const i=e[n],{success:r,asyncInit:s}=this.initializeBackend(i);if(s||r)return{name:i,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const i=this.state.tensorInfo.get(n),r=i.backend,s=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),i.backend=e,e.move(n,s,i.shape,i.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let i=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}let r;return this.scopedRun(()=>this.startScope(i),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,i){e();try{const r=i();return n(),r}catch(r){throw n(),r}}nextTensorId(){return Yd.nextTensorId++}nextVariableId(){return Yd.nextVariableId++}clone(e){const n=ot.runKernel(FP,{x:e}),i={x:e},r=o=>({x:()=>{const a="float32",c={x:o},l={dtype:a};return ot.runKernel(OP,c,l)}}),s=[];return this.addTapeNode(this.state.activeScope.name,i,[n],r,s,{}),n}runKernel(e,n,i){if(this.backendName==null&&this.backend,!(HO(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:i})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,i){const r=this.backend.numDataIds();let s=0;i.forEach(c=>{s+=c.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-s-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,i=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let c;const l=uE(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(uE(e)){const{kernelName:f,inputs:v,attrs:g}=e;this.backendName==null&&this.backend;const m=HO(f,this.backendName);Ee(m!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),a=()=>{const y=this.backend.numDataIds();c=m.kernelFunc({inputs:v,attrs:g,backend:this.backend});const S=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,y,S);const x=S.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(r){const w=this.getTensorsForGradient(f,v,x);i=this.saveTensorsForBackwardMode(w)}return x}}else{const{forwardFunc:f}=e,v=g=>{r&&(i=g.map(m=>this.keep(this.clone(m))))};a=()=>{const g=this.backend.numDataIds();c=this.tidy(()=>f(this.backend,v));const m=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,g,m),m}}const{inputs:u,attrs:h}=e,d=uE(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(p=this.profiler.profileKernel(l,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),n=p.outputs)}),r&&this.addTapeNode(l,u,n,d,i,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(f=>u[f]!=null?u[f].shape:null),outputShapes:n.map(f=>f.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(c)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(i=>this.keep(this.clone(i)))}getTensorsForGradient(e,n,i){const r=VO(e);if(r!=null){const s=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(Ee(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(l=>n[l])):a=s.map(l=>n[l]);const c=i.filter((l,u)=>o[u]);return a.concat(c)}return[]}makeTensor(e,n,i,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");i=i||"float32",r=r||this.backend;let s=e;i==="string"&&UC(e[0])&&(s=e.map(c=>Cu(c)));const o=r.write(s,n,i),a=new xo(n,i,o,this.nextTensorId());if(this.trackTensor(a,r),i==="string"){const c=this.state.tensorInfo.get(o),l=gpe(s);this.state.numBytes+=l-c.bytes,c.bytes=l}return a}makeTensorFromDataId(e,n,i,r){i=i||"float32";const s={dataId:e,shape:n,dtype:i};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(e,n){const{dataId:i,shape:r,dtype:s}=e,o=new xo(r,s,i,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,i,r){i=i||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const s=new lS(e,n,i,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*sS(e.dtype)),this.state.numBytes+=i,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:i})),e instanceof lS||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const i=e.size*sS(e.dtype);this.state.numBytes-=i}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,i=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-i;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,i,r,s,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:i,saved:s},c=VO(e);c!=null&&(r=c.gradFunc),r!=null&&(a.gradient=l=>(l=l.map((u,h)=>{if(u==null){const d=i[h],p=dl(d.size,d.dtype);return this.makeTensor(p,d.shape,d.dtype)}return u}),r(l.length>1?l:l[0],s,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=pH(e),i=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const o=this.state.activeScope.track[s];!o.kept&&!i.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===r.id&&this.track(s)})}gradients(e,n,i,r=!1){if(Ee(n.length>0,()=>"gradients() received an empty list of xs."),i!=null&&i.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${i.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));Ee(s instanceof xo,()=>"The result y returned by f() must be a tensor.");const o=wge(this.state.activeTape,n,s);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=i??Mge(s.shape),Ege(a,o,l=>this.tidy(l),kge);const c=n.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const u of l.saved)u.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(e){return Ee(Wb(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{Ee(n.every(a=>a instanceof xo),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let i;const r={};n.forEach((a,c)=>{r[c]=a});const s=(a,c)=>(i=e(...n,c),Ee(i.value instanceof xo,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),Ee(Wb(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),o=(a,c)=>{const l=i.gradFunc(a,c),u=Array.isArray(l)?l:[l];Ee(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),Ee(u.every(d=>d instanceof xo),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((d,p)=>{h[p]=()=>d}),h};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=vo(),i=await this.backend.time(e);return i.wallMs=vo()-n,i}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ZO;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Yd.nextTensorId=0;Yd.nextVariableId=0;function Mge(t){const e=Spe(be(t),"float32");return ot.makeTensor(e,t,"float32")}function mH(){const t=I8();if(t._tfengine==null){const e=new xpe(t);t._tfengine=new Yd(e)}return Epe(t._tfengine.ENV),Tge(()=>t._tfengine),t._tfengine}const ot=mH();function kge(t,e){const n={a:t,b:e};return ot.runKernel(NP,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lge(){return typeof navigator<"u"&&navigator!=null}function gH(t){if(t||Lge()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function vH(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pr=Z();Pr.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Pr.registerFlag("IS_BROWSER",()=>vH());Pr.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Pr.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Pr.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Pr.registerFlag("PROD",()=>!1);Pr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Pr.getBool("DEBUG"));Pr.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Pr.registerFlag("IS_TEST",()=>!1);Pr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Pr.getBool("DEBUG"));Pr.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Pr.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Pr.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dge(t,e){let n=t;if(Qs(t))return e==="string"?[]:[t.length];if(hH(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(dH(t))return[t.buffer.size/(e==null?4:sS(e))];if(!Array.isArray(t))return[];const i=[];for(;Array.isArray(n)||Qs(n)&&e!=="string";)i.push(n.length),n=n[0];return Array.isArray(t)&&Z().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&yH(t,i,[]),i}function yH(t,e,n){if(n=n||[],!Array.isArray(t)&&!Qs(t)){Ee(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}Ee(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),Ee(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const i=e.slice(1);for(let r=0;r<t.length;++r)yH(t[r],i,n.concat(r))}function e4(t,e,n,i){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${i}' must be ${t} tensor, but got ${e} tensor`)}}function Qt(t,e,n,i="numeric"){if(t instanceof uH())return e4(i,t.dtype,e,n),t;let r=X0(t);if(r!=="string"&&["bool","int32","float32"].indexOf(i)>=0&&(r=i),e4(i,r,e,n),t==null||!Qs(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const c=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${c}'`)}const s=Dge(t,r);!Qs(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?$C(t,r):Uu(t,[],!0);return ot.makeTensor(a,s,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nge="__op";function zn(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const i=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+Nge;const r=(...s)=>{ot.startScope(n);try{const o=i(...s);return LP(o)&&console.error("Cannot return a Promise inside of tidy."),ot.endScope(o),o}catch(o){throw ot.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oge(t,e){const n=Qt(t,"real","complex"),i=Qt(e,"imag","complex");T8(n.shape,i.shape,`real and imag shapes, ${n.shape} and ${i.shape}, must match in call to tf.complex().`);const r={real:n,imag:i};return ot.runKernel(k8,r)}const Fge=zn({complex_:Oge});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zge(t,e,n,i){if(i==null)i=X0(t);else if(i==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(dH(t)||hH(t)){if(i!=="float32"&&i!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${i}.`);return ot.backend.createTensorFromGPUData(t,e||n,i)}if(!Qs(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){K0(e);const r=be(e),s=be(n);Ee(r===s,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${s}`);for(let o=0;o<n.length;++o){const a=n[o],c=o===n.length-1?a!==be(e.slice(o)):!0;Ee(n[o]===e[o]||!c,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Qs(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=i!=="string"?$C(t,i):Uu(t,[],!0),ot.makeTensor(t,e,i)}class th{static join(e){return new th(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(i=>Qs(i)?i.buffer:i),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let i=0;i<e.length;i++){const r=e[i];i!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const s=n+r.byteLength;this.shards.push({buffer:r,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const i=this.findShardForByte(e);if(i===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,s=new ArrayBuffer(r),o=new Uint8Array(s);let a=0;for(let c=i;c<this.shards.length;c++){const l=this.shards[c],h=e+a-l.start,d=a,f=Math.min(n,l.end)-l.start,v=new Uint8Array(l.buffer,h,f-h);if(o.set(v,d),a+=v.length,n<l.end)break}return s}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const i=Uge(this.shards,n);return i===-1?-1:(this.previousShardIndex=i,this.previousShardIndex)}}function Uge(t,e){let n=0,i=t.length;for(;n<=i;){const r=Math.floor((i-n)/2)+n,s=e(t[r]);if(s===0)return r;s<0?i=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yc(){return ot}function ii(t,e){return ot.tidy(t,e)}function Ss(t){pH(t).forEach(n=>n.dispose())}function Bge(t){return ot.keep(t)}function SH(t){return ot.setBackend(t)}function $ge(t,e,n=1){return ot.registerBackend(t,e,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BP=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function t4(t){return BP?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function Hge(t){if(BP)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let i=0,r=e.length;i<r;i++)n+=String.fromCharCode(e[i]);return btoa(n)}function Vge(t){if(BP){const i=Buffer.from(t,"base64");return i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let i=0;i<e.length;++i)n.set([e.charCodeAt(i)],i);return n.buffer}function xH(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function jge(t,e,n){const i={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(i.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=e,i.weightData=n}return t.signature!=null&&(i.signature=t.signature),t.userDefinedMetadata!=null&&(i.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(i.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(i.initializerSignature=t.initializerSignature),i}async function Wge(t,e){let n,i;return t.weightsManifest!=null&&([n,i]=await e(t.weightsManifest)),jge(t,n,i)}function HC(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:t4(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:t4(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new th(t.weightData).byteLength}}function n4(t){const e=[];for(const n of t)e.push(...n.weights);return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ii{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Ii.instance==null&&(Ii.instance=new Ii),Ii.instance}static registerSaveRouter(e){Ii.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Ii.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Ii.getHandlers(e,"save")}static getLoadHandlers(e,n){return Ii.getHandlers(e,"load",n)}static getHandlers(e,n,i){const r=[];return(n==="load"?Ii.getInstance().loadRouters:Ii.getInstance().saveRouters).forEach(o=>{const a=o(e,i);a!==null&&r.push(a)}),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eT="tensorflowjs",tT=1,gu="models_store",zc="model_info_store";function CH(){if(!Z().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function nT(t){const e=t.result;e.createObjectStore(gu,{keyPath:"modelPath"}),e.createObjectStore(zc,{keyPath:"modelPath"})}class Bu{constructor(e){if(this.indexedDB=CH(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((i,r)=>{const s=this.indexedDB.open(eT,tT);s.onupgradeneeded=()=>nT(s),s.onsuccess=()=>{const o=s.result;if(n==null){const a=o.transaction(gu,"readonly"),l=a.objectStore(gu).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));i(l.result.modelArtifacts)},l.onerror=u=>(o.close(),r(l.error)),a.oncomplete=()=>o.close()}else{n.weightData=th.join(n.weightData);const a=HC(n),c=o.transaction(zc,"readwrite");let l=c.objectStore(zc),u;try{u=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return r(d)}let h;u.onsuccess=()=>{h=o.transaction(gu,"readwrite");const d=h.objectStore(gu);let p;try{p=d.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(f){return r(f)}p.onsuccess=()=>i({modelArtifactsInfo:a}),p.onerror=f=>{l=c.objectStore(zc);const v=l.delete(this.modelPath);v.onsuccess=()=>(o.close(),r(p.error)),v.onerror=g=>(o.close(),r(p.error))}},u.onerror=d=>(o.close(),r(u.error)),c.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},s.onerror=o=>r(s.error)})}}Bu.URL_SCHEME="indexeddb://";const _H=t=>Z().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Bu.URL_SCHEME)?Gge(t.slice(Bu.URL_SCHEME.length)):null;Ii.registerSaveRouter(_H);Ii.registerLoadRouter(_H);function Gge(t){return new Bu(t)}function qge(t){return t.startsWith(Bu.URL_SCHEME)?t.slice(Bu.URL_SCHEME.length):t}class Xge{constructor(){this.indexedDB=CH()}async listModels(){return new Promise((e,n)=>{const i=this.indexedDB.open(eT,tT);i.onupgradeneeded=()=>nT(i),i.onsuccess=()=>{const r=i.result,s=r.transaction(zc,"readonly"),a=s.objectStore(zc).getAll();a.onsuccess=()=>{const c={};for(const l of a.result)c[l.modelPath]=l.modelArtifactsInfo;e(c)},a.onerror=c=>(r.close(),n(a.error)),s.oncomplete=()=>r.close()},i.onerror=r=>n(i.error)})}async removeModel(e){return e=qge(e),new Promise((n,i)=>{const r=this.indexedDB.open(eT,tT);r.onupgradeneeded=()=>nT(r),r.onsuccess=()=>{const s=r.result,o=s.transaction(zc,"readwrite"),a=o.objectStore(zc),c=a.get(e);let l;c.onsuccess=()=>{if(c.result==null)return s.close(),i(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),h=()=>{l=s.transaction(gu,"readwrite");const p=l.objectStore(gu).delete(e);p.onsuccess=()=>n(c.result.modelArtifactsInfo),p.onerror=f=>i(c.error)};u.onsuccess=h,u.onerror=d=>(h(),s.close(),i(c.error))}},c.onerror=u=>(s.close(),i(c.error)),o.oncomplete=()=>{l==null?s.close():l.oncomplete=()=>s.close()}},r.onerror=s=>i(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Na="/",Nh="tensorflowjs_models",wH="info",Kge="model_topology",Yge="weight_specs",Jge="weight_data",Qge="model_metadata";function EH(t){return{info:[Nh,t,wH].join(Na),topology:[Nh,t,Kge].join(Na),weightSpecs:[Nh,t,Yge].join(Na),weightData:[Nh,t,Jge].join(Na),modelMetadata:[Nh,t,Qge].join(Na)}}function RH(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Zge(t){const e=t.split(Na);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Na)}function e0e(t){return t.startsWith($u.URL_SCHEME)?t.slice($u.URL_SCHEME.length):t}class $u{constructor(e){if(!Z().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=EH(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),i=JSON.stringify(e.weightSpecs),r=HC(e),s=th.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,Hge(s));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw RH(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},i=JSON.parse(this.LS.getItem(this.keys.topology));if(i==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=i;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){const a=JSON.parse(s);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=Vge(o),n}}$u.URL_SCHEME="localstorage://";const bH=t=>Z().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith($u.URL_SCHEME)?t0e(t.slice($u.URL_SCHEME.length)):null;Ii.registerSaveRouter(bH);Ii.registerLoadRouter(bH);function t0e(t){return new $u(t)}class n0e{constructor(){Ee(Z().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),Ee(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Nh+Na,i=Na+wH;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(n)&&s.endsWith(i)){const o=Zge(s);e[o]=JSON.parse(this.LS.getItem(s))}}return e}async removeModel(e){e=e0e(e);const n=EH(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const i=JSON.parse(this.LS.getItem(n.info));return RH(n),i}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i4="://";class Ko{constructor(){this.managers={}}static getInstance(){return Ko.instance==null&&(Ko.instance=new Ko),Ko.instance}static registerManager(e,n){Ee(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(i4)&&(e=e.slice(0,e.indexOf(i4))),Ee(e.length>0,()=>"scheme must not be an empty string.");const i=Ko.getInstance();Ee(i.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),i.managers[e]=n}static getManager(e){const n=Ko.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Ko.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i0e{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!Z().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",i=>{if(i.source===window&&i.data.name===this.messageName){i.stopPropagation();const r=this.functionRefs[i.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return eH(e)}}if(Z().get("IS_BROWSER")){Z().setPlatform("browser",new i0e);try{Ko.registerManager($u.URL_SCHEME,new n0e)}catch{}try{Ko.registerManager(Bu.URL_SCHEME,new Xge)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r0e={importFetch:()=>require("node-fetch")};let hE;class s0e{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return Z().global.fetch!=null?Z().global.fetch(e,n):(hE==null&&(hE=r0e.importFetch()),hE(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}Z().get("IS_NODE")&&!Z().get("IS_BROWSER")&&Z().setPlatform("node",new s0e);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oi(t,e="float32",n){return e=e||"float32",K0(t),new cS(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(t,e){const n=Qt(t,"x","cast");if(!fpe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const i={x:n},r={dtype:e};return ot.runKernel(OP,i,r)}const uS=zn({cast_:o0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0e(t){const n={x:Qt(t,"x","clone","string_or_numeric")};return ot.runKernel(FP,n)}const TH=zn({clone_:a0e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0e(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mH();const l0e={buffer:Oi,cast:uS,clone:TH,print:c0e};Age(l0e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0e(t,e){let n=Qt(t,"a","add"),i=Qt(e,"b","add");[n,i]=eh(n,i);const r={a:n,b:i};return ot.runKernel(NP,r)}const an=zn({add_:u0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h0e(t,e){let n=Qt(t,"a","floorDiv"),i=Qt(e,"b","floorDiv");[n,i]=eh(n,i);const r={a:n,b:i};return ot.runKernel(F8,r)}const d0e=zn({floorDiv_:h0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0e(t,e){let n=Qt(t,"a","div"),i=Qt(e,"b","div");if([n,i]=eh(n,i),n.dtype==="int32"&&i.dtype==="int32")return d0e(n,i);const r={a:n,b:i},s={};return ot.runKernel(D8,r,s)}const oa=zn({div_:p0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0e(t,e){let n=Qt(t,"a","mul"),i=Qt(e,"b","mul");[n,i]=eh(n,i);const r={a:n,b:i};return ot.runKernel(B8,r)}const $t=zn({mul_:f0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m0e(t){const e=Qt(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return ot.runKernel(L8,n)}else{const n={x:e};return ot.runKernel(M8,n)}}const g0e=zn({abs_:m0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AH(t,e,n,i,r="NHWC",s){const o=t[3],a=[...e,o],c=bp(r);return $o(t,a,n,s,i,null,null,c)}function Ep(t,e,n,i,r,s,o="channelsLast"){const[a,c]=h0(e);let l;if(o==="channelsLast")l=[a,c,t[3],t[3]];else if(o==="channelsFirst")l=[a,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return $o(t,l,n,i,r,s,!1,o)}function Y0(t,e,n,i,r,s,o="NDHWC"){const[a,c,l]=iT(e);let u,h;if(o==="NDHWC")h="channelsLast",u=[a,c,l,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",u=[a,c,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return J0(t,u,n,i,r,!1,h,s)}function $o(t,e,n,i,r,s,o=!1,a="channelsLast"){let[c,l,u,h]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,u,h]=t;else if(a==="channelsFirst")[c,h,l,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[d,p,,f]=e,[v,g]=h0(n),[m,y]=h0(i),S=Sd(d,m),x=Sd(p,y),{padInfo:w,outHeight:C,outWidth:E}=S0e(r,l,u,v,g,S,x,s,a),b=o?f*h:f;let M;return a==="channelsFirst"?M=[c,b,C,E]:a==="channelsLast"&&(M=[c,C,E,b]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:u,inChannels:h,outHeight:C,outWidth:E,outChannels:b,padInfo:w,strideHeight:v,strideWidth:g,filterHeight:d,filterWidth:p,effectiveFilterHeight:S,effectiveFilterWidth:x,dilationHeight:m,dilationWidth:y,inShape:t,outShape:M,filterShape:e}}function J0(t,e,n,i,r,s=!1,o="channelsLast",a){let[c,l,u,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[c,l,u,h,d]=t;else if(o==="channelsFirst")[c,d,l,u,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[p,f,v,,g]=e,[m,y,S]=iT(n),[x,w,C]=iT(i),E=Sd(p,x),b=Sd(f,w),M=Sd(v,C),{padInfo:_,outDepth:R,outHeight:L,outWidth:O}=x0e(r,l,u,h,m,y,S,E,b,M,a),V=s?g*d:g;let X;return o==="channelsFirst"?X=[c,V,R,L,O]:o==="channelsLast"&&(X=[c,R,L,O,V]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:u,inWidth:h,inChannels:d,outDepth:R,outHeight:L,outWidth:O,outChannels:V,padInfo:_,strideDepth:m,strideHeight:y,strideWidth:S,filterDepth:p,filterHeight:f,filterWidth:v,effectiveFilterDepth:E,effectiveFilterHeight:b,effectiveFilterWidth:M,dilationDepth:x,dilationHeight:w,dilationWidth:C,inShape:t,outShape:X,filterShape:e}}function v0e(t,e,n,i,r){i==null&&(i=$P(t,e,n));const s=t[0],o=t[1],a=d0((s-e+2*i)/n+1,r),c=d0((o-e+2*i)/n+1,r);return[a,c]}function y0e(t,e,n,i,r,s){r==null&&(r=$P(t,e[0],i[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=d0((t[a]-e[a]+2*r)/i[a]+1,s));return o}function $P(t,e,n,i=1){const r=Sd(e,i);return Math.floor((t[0]*(n-1)-n+r)/2)}function h0(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function iT(t){return typeof t=="number"?[t,t,t]:t}function Sd(t,e){return e<=1?t:t+(t-1)*(e-1)}function S0e(t,e,n,i,r,s,o,a,c){let l,u,h;if(typeof t=="number"){l={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const p=v0e([e,n],s,i,t,a);u=p[0],h=p[1]}else if(t==="same"){u=Math.ceil(e/i),h=Math.ceil(n/r);const d=Math.max(0,(u-1)*i+s-e),p=Math.max(0,(h-1)*r+o-n),f=Math.floor(d/2),v=d-f,g=Math.floor(p/2),m=p-g;l={top:f,bottom:v,left:g,right:m,type:"SAME"}}else if(t==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/i),h=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const d=c==="channelsLast"?t[1][0]:t[2][0],p=c==="channelsLast"?t[1][1]:t[2][1],f=c==="channelsLast"?t[2][0]:t[3][0],v=c==="channelsLast"?t[2][1]:t[3][1];l={top:d,bottom:p,left:f,right:v,type:d===0&&p===0&&f===0&&v===0?"VALID":"EXPLICIT"},u=d0((e-s+d+p)/i+1,a),h=d0((n-o+f+v)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:l,outHeight:u,outWidth:h}}function x0e(t,e,n,i,r,s,o,a,c,l,u){let h,d,p,f;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=y0e([e,n,i,1],[a,c,l],1,[r,s,o],t,u);d=g[0],p=g[1],f=g[2]}else if(t==="same"){d=Math.ceil(e/r),p=Math.ceil(n/s),f=Math.ceil(i/o);const v=(d-1)*r+a-e,g=(p-1)*s+c-n,m=(f-1)*o+l-i,y=Math.floor(v/2),S=v-y,x=Math.floor(g/2),w=g-x,C=Math.floor(m/2),E=m-C;h={top:x,bottom:w,left:C,right:E,front:y,back:S,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}function d0(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function rT(t){const[e,n,i]=h0(t);return e===1&&n===1&&i===1}function Rp(t,e){return rT(t)||rT(e)}function C0e(t){return h0(t).every(e=>e>0)}function bp(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function _0e(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")Ee(rS(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(i=>{i.forEach(r=>{Ee(rS(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0e(t,e){const i={x:Qt(t,"x","reshape","string_or_numeric")},r={shape:e};return ot.runKernel(j8,i,r)}const HP=zn({reshape_:w0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E0e(t){const n={x:Qt(t,"x","sigmoid","float32")};return ot.runKernel(G8,n)}const R0e=zn({sigmoid_:E0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b0e(t,e){let n=Qt(t,"broadcastTo","x");const i=n.shape;if(K0(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const l=n.shape.slice();for(;l.length<e.length;)l.unshift(1);n=HP(n,l)}const r=n.shape,s=Array.from(e);for(let l=e.length-1;l>=0;l--)if(r[l]===e[l])s[l]=1;else if(n.shape[l]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${e}].`);if(s.map((l,u)=>l>1?u:-1).filter(l=>l>=0).length===0)return TH(n);const a={x:n},c={reps:s};return ot.runKernel(Y8,a,c)}const T0e=zn({broadcastTo_:b0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A0e(t,e,n){K0(t),n=n||X0(e);const i={shape:t,value:e,dtype:n};return ot.runKernel(O8,{},i)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hS(t,e){const n=t.length,i=[];for(let r=0;r<n;r++){const s=n-1-r,o=t[s]||1;(e[e.length-1-r]||1)>1&&o===1&&i.unshift(s)}return i}function PH(t,e){const n=[];for(let i=0;i<e.length;i++){const r=t[t.length-i-1],s=e.length-i-1,o=e[s];(r==null||r===1&&o>1)&&n.unshift(s)}return n}function pr(t,e){const n=Math.max(t.length,e.length),i=new Array(n);for(let r=0;r<n;r++){let s=t[t.length-r-1];s==null&&(s=1);let o=e[e.length-r-1];if(o==null&&(o=1),s===1)i[n-r-1]=o;else if(o===1)i[n-r-1]=s;else if(s!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else i[n-r-1]=s}return i}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P0e(t){const n={x:Qt(t,"x","zerosLike")};return ot.runKernel(J8,n)}const aa=zn({zerosLike_:P0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0e(t){const n={x:Qt(t,"x","elu","float32")};return ot.runKernel(N8,n)}const M0e=zn({elu_:I0e});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VP(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function IH(t,e,n){const i=t.length+e.length,r=[];let s=0,o=0;for(let a=0;a<i;a++)n.indexOf(a)===-1?r.push(t[s++]):r.push(e[o++]);return r}function va(t,e){const n=[],i=t.length;for(let s=0;s<i;s++)e.indexOf(s)===-1&&n.push(t[s]);const r=e.map(s=>t[s]);return[n,r]}function ic(t,e){const n=e.map(i=>1);return IH(t,n,e)}function Ho(t,e,n){Ee(VP(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function io(t,e){if(VP(t,e))return null;const n=[];for(let i=0;i<e;++i)t.indexOf(i)===-1&&n.push(i);return t.forEach(i=>n.push(i)),n}function jP(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function ro(t,e){const n=[];for(let i=e-t;i<e;++i)n.push(i);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0e(t,e){let n=Qt(t,"base","pow"),i=Qt(e,"exp","pow");[n,i]=eh(n,i);const r={a:n,b:i};return ot.runKernel($8,r)}const r4=zn({pow_:k0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pl(t,e){if((Qs(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Qs(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return zge(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L0e(t){const n={x:Qt(t,"x","sqrt","float32")};return ot.runKernel(q8,n)}const Jd=zn({sqrt_:L0e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0e(t){const e=Qt(t,"x","square"),n={};return ot.runKernel("Square",{x:e},n)}const _u=zn({square_:D0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N0e(t,e=null,n=!1){let i=Qt(t,"x","sum");i.dtype==="bool"&&(i=uS(i,"int32"));const r={x:i},s={axis:e,keepDims:n};return ot.runKernel(X8,r,s)}const O0e=zn({sum_:N0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F0e(t,e=.2){const i={x:Qt(t,"x","leakyRelu")},r={alpha:e};return ot.runKernel(z8,i,r)}const z0e=zn({leakyRelu_:F0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U0e(t,e){Ee(Wb(t),()=>"The f passed in variableGrads(f) must be a function"),Ee(e==null||Array.isArray(e)&&e.every(l=>l instanceof lS),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const l in ot.registeredVariables)e.push(ot.registeredVariables[l])}const i=n?e.filter(l=>!l.trainable):null,r=e.length;e=e.filter(l=>l.trainable),Ee(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const s=!0,{value:o,grads:a}=ot.gradients(t,e,null,s);Ee(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),Ee(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const c={};return e.forEach((l,u)=>{a[u]!=null&&(c[l.name]=a[u])}),i!=null&&i.forEach(l=>c[l.name]=null),{value:o,grads:c}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0e(t,e){let n=Qt(t,"a","sub"),i=Qt(e,"b","sub");[n,i]=eh(n,i);const r={a:n,b:i};return ot.runKernel(K8,r)}const xd=zn({sub_:B0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $0e(t,e){let n=Qt(t,"a","maximum"),i=Qt(e,"b","maximum");[n,i]=eh(n,i),n.dtype==="bool"&&(n=uS(n,"int32"),i=uS(i,"int32")),pr(n.shape,i.shape);const r={a:n,b:i};return ot.runKernel(U8,r)}const H0e=zn({maximum_:$0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sT(t,e="float32"){if(K0(t),e==="complex64"){const i=sT(t,"float32"),r=sT(t,"float32");return Fge(i,r)}const n=dl(be(t),e);return ot.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0e(t,e){const n=Qt(t,"x","prelu"),i=Qt(e,"alpha","prelu"),r={x:n,alpha:i};return ot.runKernel(H8,r)}const j0e=zn({prelu_:V0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W0e(t){const n={x:Qt(t,"x","relu")};return ot.runKernel(V8,n)}const G0e=zn({relu_:W0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0e(t){const n={x:Qt(t,"x","relu6")};return ot.runKernel(W8,n)}const X0e=zn({relu6_:q0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0e(t,e=0){const i={x:Qt(t,"x","step")},r={alpha:e};return ot.runKernel(Q8,i,r)}const Y0e=zn({step_:K0e});function MH(t,e,n){const i=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${i}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(s+` update.rank < ${r}. `);if(t.length<i+(n.rank-r))throw new Error(s+` Output shape length < ${i+(n.rank-r)}`);if(n.rank!==r+t.length-i)throw new Error(s+` update.rank != ${r+t.length-i}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+i])throw new Error(s+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function J0e(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}MH(n,e,t)}function VC(t,e,n){const i=e.shape.length,r=i>1?e.shape[i-1]:1,s=n.length;let o=1;for(let h=r;h<s;++h)o*=n[h];const a=r<1?1:r,c=be(e.shape)/a,l=[...Di(n.slice(0,r)),1],u=be(n);return{sliceRank:r,numUpdates:c,sliceSize:o,strides:l,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0e(t,e){const n=[];for(let s=0;s<e.length;s++)e[s]&&n.push(s);const i=Oi(t,"int32"),r=Oi([n.length,t.length],"int32");for(let s=0;s<n.length;s++){const o=i.indexToLoc(n[s]),a=s*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0e(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return $t(t,Y0e(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function eve(t,e){let n=e;const i=PH(t.shape,e.shape);return i.length>0&&(n=O0e(n,i)),HP(n,t.shape)}function tve(t,e,n,i){if(e==="linear")return t;if(e==="relu")return G0e(t);if(e==="elu")return M0e(t);if(e==="relu6")return X0e(t);if(e==="prelu")return j0e(t,n);if(e==="leakyrelu")return z0e(t,i);if(e==="sigmoid")return R0e(t);throw new Error(`Unknown fused activation ${e}.`)}const nve=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ive(t,e,n){const i=rve(t,e,n),r=i<0?-(i+1):i;t.splice(r,0,e)}function rve(t,e,n){return ove(t,e,n||sve)}function sve(t,e){return t>e?1:t<e?-1:0}function ove(t,e,n){let i=0,r=t.length,s=0,o=!1;for(;i<r;){s=i+(r-i>>>1);const a=n(e,t[s]);a>0?i=s+1:(r=s,o=!a)}return o?i:-i-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ave(t,e,n,i,r){return WP(t,e,n,i,r,0)}function cve(t,e,n,i,r,s){return WP(t,e,n,i,r,0,!1,s,!0)}function lve(t,e,n,i,r,s){return WP(t,e,n,i,r,s,!0)}function WP(t,e,n,i,r,s,o=!1,a=!1,c=!1){const l=[];for(let g=0;g<e.length;g++)e[g]>r&&l.push({score:e[g],boxIndex:g,suppressBeginIndex:0});l.sort(s4);const u=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&l.length>0;){const g=l.pop(),{score:m,boxIndex:y,suppressBeginIndex:S}=g;if(m<r)break;let x=!1;for(let w=h.length-1;w>=S;--w){const C=uve(t,y,h[w]);if(C>=i){x=!0;break}if(g.score=g.score*hve(i,u,C),g.score<=r)break}g.suppressBeginIndex=h.length,x||(g.score===m?(h.push(y),d.push(g.score)):g.score>r&&ive(l,g,s4))}const p=h.length,f=n-p;a&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const v={selectedIndices:h};return o&&(v.selectedScores=d),c&&(v.validOutputs=p),v}function uve(t,e,n){const i=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),s=Math.min(i[0],i[2]),o=Math.min(i[1],i[3]),a=Math.max(i[0],i[2]),c=Math.max(i[1],i[3]),l=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),p=(a-s)*(c-o),f=(h-l)*(d-u);if(p<=0||f<=0)return 0;const v=Math.max(s,l),g=Math.max(o,u),m=Math.min(a,h),y=Math.min(c,d),S=Math.max(m-v,0)*Math.max(y-g,0);return S/(p+f-S)}function hve(t,e,n){const i=Math.exp(e*n*n);return n<=t?i:0}function s4(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dve=new Map,pve=new Map;class fve{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class au{constructor(){this.classNameMap={}}static getMap(){return au.instance==null&&(au.instance=new au),au.instance}static register(e){au.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function mve(t,e,n){Ee(t.className!=null,()=>"Class being registered does not have the static className property defined."),Ee(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),Ee(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const i=n,r=e+">"+i;return au.register(t),dve.set(r,t),pve.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nh extends fve{minimize(e,n=!1,i){const{value:r,grads:s}=this.computeGradients(e,i);if(i!=null){const o=i.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(o)}else this.applyGradients(s);return Ss(s),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return U0e(e,n)}dispose(){this.iterations_!=null&&Ss(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:pl(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(nh,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gve extends nh{static get className(){return"Adadelta"}constructor(e,n,i=null){super(),this.learningRate=e,this.rho=n,this.epsilon=i,this.accumulatedGrads=[],this.accumulatedUpdates=[],i==null&&(this.epsilon=ot.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=ot.registeredVariables[i],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${i}/accum_grad`,variable:ii(()=>aa(s).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${i}/accum_var`,variable:ii(()=>aa(s).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[i];if(a==null)return;const c=this.accumulatedGrads[r].variable,l=this.accumulatedUpdates[r].variable;ii(()=>{const u=an($t(c,this.rho),$t(_u(a),1-this.rho)),h=$t(oa(Jd(an(l,this.epsilon)),Jd(an(c,this.epsilon))),a),d=an($t(l,this.rho),$t(_u(h),1-this.rho));c.assign(u),l.assign(d);const p=an($t(h,-this.learningRate),s);s.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ss(this.accumulatedGrads.map(e=>e.variable)),Ss(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,i=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vve extends nh{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=ot.registeredVariables[i];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${i}/accumulator`,variable:ii(()=>A0e(s.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[i];if(o==null)return;const a=this.accumulatedGrads[r].variable;ii(()=>{const c=an(a,_u(o));a.assign(c);const l=an($t(oa(o,Jd(an(c,ot.backend.epsilon()))),-this.learningRate),s);s.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ss(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yve extends nh{static get className(){return"Adam"}constructor(e,n,i,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=i,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ii(()=>{this.accBeta1=pl(n).variable(),this.accBeta2=pl(i).variable()}),r==null&&(this.epsilon=ot.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ii(()=>{const i=xd(1,this.accBeta1),r=xd(1,this.accBeta2);n.forEach((s,o)=>{const a=ot.registeredVariables[s],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:ii(()=>aa(a).variable(c))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${s}/v`,variable:ii(()=>aa(a).variable(c))});const l=Array.isArray(e)?e[o].tensor:e[s];if(l==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=an($t(u,this.beta1),$t(l,1-this.beta1)),p=an($t(h,this.beta2),$t(_u(l),1-this.beta2)),f=oa(d,i),v=oa(p,r);u.assign(d),h.assign(p);const g=an($t(oa(f,an(Jd(v),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign($t(this.accBeta1,this.beta1)),this.accBeta2.assign($t(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ss(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ss(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),ii(()=>{this.accBeta1.assign(r4(this.beta1,this.iterations_+1)),this.accBeta2.assign(r4(this.beta2,this.iterations_+1))});const n=e.length/2,i=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sve extends nh{static get className(){return"Adamax"}constructor(e,n,i,r=null,s=0){super(),this.learningRate=e,this.beta1=n,this.beta2=i,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ii(()=>{this.iteration=pl(0).variable(),this.accBeta1=pl(n).variable()}),r==null&&(this.epsilon=ot.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ii(()=>{const i=xd(1,this.accBeta1),r=oa(-this.learningRate,an($t(this.iteration,this.decay),1));n.forEach((s,o)=>{const a=ot.registeredVariables[s],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:aa(a).variable(c)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${s}/v`,variable:aa(a).variable(c)});const l=Array.isArray(e)?e[o].tensor:e[s];if(l==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=an($t(u,this.beta1),$t(l,1-this.beta1)),p=$t(h,this.beta2),f=g0e(l),v=H0e(p,f);u.assign(d),h.assign(v);const g=an($t(oa(r,i),oa(d,an(v,this.epsilon))),a);a.assign(g)}),this.iteration.assign(an(this.iteration,1)),this.accBeta1.assign($t(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ss(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ss(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kH extends nh{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=Array.isArray(e)?e[r].tensor:e[i];if(s==null)return;const o=ot.registeredVariables[i];ii(()=>{const a=an($t(this.c,s),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Bge(pl(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xve extends kH{static get className(){return"Momentum"}constructor(e,n,i=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=i,this.accumulations=[],this.m=pl(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=ot.registeredVariables[i];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${i}/momentum`,variable:ii(()=>aa(s).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[i];a!=null&&ii(()=>{let c;const l=an($t(this.m,o),a);this.useNesterov?c=an($t(this.c,an(a,$t(l,this.m))),s):c=an($t(this.c,l),s),o.assign(l),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ss(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cve extends nh{static get className(){return"RMSProp"}constructor(e,n=.9,i=0,r=null,s=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=i,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,r==null&&(this.epsilon=ot.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=ot.registeredVariables[i],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${i}/rms`,variable:ii(()=>aa(s).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${i}/momentum`,variable:ii(()=>aa(s).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${i}/mg`,variable:ii(()=>aa(s).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[i];if(a==null)return;const c=this.accumulatedMeanSquares[r].variable,l=this.accumulatedMoments[r].variable;ii(()=>{const u=an($t(c,this.decay),$t(_u(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,d=an($t(h,this.decay),$t(a,1-this.decay)),p=oa($t(a,this.learningRate),Jd(xd(u,an(_u(d),this.epsilon)))),f=an($t(l,this.momentum),p);c.assign(u),h.assign(d),l.assign(f);const v=xd(s,f);s.assign(v)}else{const h=an($t(c,this.decay),$t(_u(a),1-this.decay)),d=an($t(l,this.momentum),oa($t(a,this.learningRate),Jd(an(h,this.epsilon))));c.assign(h),l.assign(d);const p=xd(s,d);s.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ss(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ss(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ss(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,i=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ve=[gve,vve,yve,Sve,xve,Cve,kH];function wve(){for(const t of _ve)mve(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eve="model",Rve=".json",bve=".weights.bin";function o4(t){return new Promise(e=>setTimeout(e)).then(t)}class Hu{constructor(e){if(!Z().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Hu.URL_SCHEME)&&(e=e.slice(Hu.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Eve),this.modelJsonFileName=e+Rve,this.weightDataFileName=e+bve}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=th.join(e.weightData),i=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s=xH(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await o4(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;c.download=this.weightDataFileName,c.href=i,await o4(()=>c.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:HC(e)}}}}Hu.URL_SCHEME="downloads://";const Tve=t=>Z().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Hu.URL_SCHEME)?Ave(t.slice(Hu.URL_SCHEME.length)):null;Ii.registerSaveRouter(Tve);function Ave(t="model"){return new Hu(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a4(t,e,n,i){o(t),n=n??0,i=i??1,a(n,i);let r=0;const s=c=>(c.then(l=>{const u=n+ ++r/t.length*(i-n);return e(u),l}),c);function o(c){Ee(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function a(c,l){Ee(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),Ee(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),Ee(l>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${l}`)}return Promise.all(t.map(s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Pve(t,e){e==null&&(e={});const n=e.fetchFunc==null?Z().platform.fetch:e.fetchFunc,i=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(i):await a4(i,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await a4(a,e.onProgress,.5,1)}function Ive(t,e){var n;const i=e.fetchFunc==null?Z().platform.fetch:e.fetchFunc;let r=0,s;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<t.length;){s||(s=(await i(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:c,value:l}=await s.read();if(c){r++,s=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}o.enqueue(l);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mve="application/octet-stream",kve="application/json";class GP{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(Ee(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Z().platform.fetch,Ee(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&Ee(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const i=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=xH(e,i);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:kve}),"model.json"),e.weightData!=null){const o=th.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:Mve}),"model.weights.bin")}const s=await this.fetch(this.path,n);if(s.ok)return{modelArtifactsInfo:HC(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const i=n.modelTopology,r=n.weightsManifest;if(i==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return Wge(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),i=n4(e.weightsManifest),r=()=>Ive(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:i,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[i,r]=Lve(n),s=this.weightPathPrefix||i,o=[],a=[];for(const c of e)for(const l of c.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(l)):o.push(s+l+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),i=n4(e),r=await Pve(n,this.loadOptions);return[i,r]}}GP.URL_SCHEME_REGEX=/^https?:\/\//;function Lve(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),i=t.substring(0,e),r=n>e?t.substring(n):"";return[i+"/",r]}function c4(t){return t.match(GP.URL_SCHEME_REGEX)!=null}const LH=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(i=>c4(i)):n=c4(t),n)return Dve(t,e)}return null};Ii.registerSaveRouter(LH);Ii.registerLoadRouter(LH);function Dve(t,e){return new GP(t,e)}function DH(t,e){const n=t.shape.length,i=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(i<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${i}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[i-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[i-1]} vs. ${n}`);if(be(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,s=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=t.shape,c=r.slice();c.pop();let l=1;for(let h=s;h<n;++h)l*=a[h],c.push(a[h]);const u=[...Di(t.shape).map(h=>h/l),1].slice(0,s);return[c,o,l,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oT=-2,Nve=-1;function NH(t,e,n){const i=t.shape.length;Ee(i===e.length,()=>`Error in slice${i}D: Length of begin ${e} must match the rank of the array (${i}).`),Ee(i===n.length,()=>`Error in slice${i}D: Length of size ${n} must match the rank of the array (${i}).`);for(let r=0;r<i;++r)Ee(e[r]+n[r]<=t.shape[r],()=>`Error in slice${i}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function Ove(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function OH(t,e,n){const i=[];for(let r=0;r<t.length;r++)i[r]=Math.ceil((e[r]-t[r])/n[r]);return i}function FH(t,e,n,i){const r=[...t];for(let s=r.length;s<i.length;s++)r.push(1);for(let s=0;s<n;s++)s===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function zH(t,e,n){return n<=t?n:n-(e-1)}function UH(t,e){const n=[];for(let i=0;i<t;i++)n.push(e+i);return n}function Fve(t,e,n,i,r,s,o,a,c){const l=t.length;let u=new Array(l),h=new Array(l),d=new Array(l);if(e.length&&n>0){const p=e[0],f=n+1;u=BH(o,p,f,i,t),h=$H(a,p,f,r,t),d=FH(s,p,f,t)}else for(let p=0;p<l;p++)u[p]=VH(o,i,s,t,p,c),h[p]=jH(a,r,s,t,p,c),d[p]=HH(s,p,c);return{begin:u,end:h,strides:d}}function BH(t,e,n,i,r){const s=[...r],o=UH(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const c=zH(e,n,a);let l=i[c];t&1<<c&&(l=0),s[a]=l}return s}function $H(t,e,n,i,r){const s=[...r],o=UH(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const c=zH(e,n,a);let l=i[c];t&1<<c&&(l=Number.MAX_SAFE_INTEGER),s[a]=l}for(let a=0;a<s.length;a++){const c=r[a];s[a]<0&&(s[a]+=c),s[a]=iS(0,s[a],r[a])}return s}function HH(t,e,n){let i=t[e];return(n&1<<e||i==null)&&(i=1),i}function VH(t,e,n,i,r,s){let o=e[r];const a=n[r]||1;(t&1<<r||s&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const c=i[r];return o<0&&(o+=c),o=iS(0,o,c-1),o}function jH(t,e,n,i,r,s){let o=e[r];const a=n[r]||1;(t&1<<r||s&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const c=i[r];return o<0&&(o+=c),a>0?o=iS(0,o,c):o=iS(-1,o,c-1),o}function qP(t,e,n){let i=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){i=r;break}for(let r=i+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function XP(t,e){let n=t.length>0?t[t.length-1]:1;for(let i=0;i<t.length-1;i++)n+=t[i]*e[i];return n}function WH(t,e,n){let i;const r=t.shape.length;typeof e=="number"?i=[e,...new Array(r-1).fill(0)]:e.length<r?i=e.concat(new Array(r-e.length).fill(0)):i=e.slice(),i.forEach(o=>{Ee(o!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(r).fill(-1):typeof n=="number"?s=[n,...new Array(r-1).fill(-1)]:n.length<r?s=n.concat(new Array(r-n.length).fill(-1)):s=n,s=s.map((o,a)=>o>=0?o:(Ee(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-i[a])),[i,s]}function GH(t,e,n,i,r,s,o,a,c){let l;if(i==null?(l=new Array(e.length),l.fill(1)):l=i,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:l.slice(),beginMask:r,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:c};for(let S=0;S<h.dims;S++)u&&1<<S&a&&h.numAddAxisAfterEllipsis++,1<<S&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};zve(h,d);let p=!0,f=!0,v=!0;const g=[],m=[];for(let S=0;S<t.length;++S){if(d.strides[S]===0)throw Error(`strides[${S}] must be non-zero`);const x=!!(d.shrinkAxisMask&1<<S),w=t[S];if(w===-1){g.push(x?1:-1);continue}const C=[d.beginMask&1<<S,d.endMask&1<<S],E=[d.strides[S]>0?0:-1,d.strides[S]>0?w:w-1];if(x&&d.strides[S]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&d.strides[S]===1;const b=!!(d.beginMask&1<<S&&d.endMask&1<<S);if(d.beginValid&&d.endValid){if(x){const L=d.begin[S]<0?w+d.begin[S]:d.begin[S];if(d.begin[S]=L,d.end[S]=d.begin[S]+1,L<0||L>=w)throw Error(`slice index ${d.begin[S]} of dimension ${S} out of bounds.`)}else d.begin[S]=l4(d.begin[S],0,d.strides[S],w,C,E),d.end[S]=l4(d.end[S],1,d.strides[S],w,C,E);const R=d.strides[S]===1&&d.begin[S]===0&&d.end[S]===w;p=p&&R,f=f&&(S===0&&d.strides[S]===1||R)}else p=p&&d.strides[S]===1&&b,f=f&&(S===0&&d.strides[S]===1||b);let M,_=!1;if(d.beginValid&&d.endValid?(M=d.end[S]-d.begin[S],_=!0):x?(M=1,_=!0):b&&w>=0&&(d.strides[S]<0?M=-w:M=w,_=!0),_){let R;M===0||M<0!=d.strides[S]<0?R=0:R=Math.trunc(M/d.strides[S])+(M%d.strides[S]!==0?1:0),g.push(R)}else g.push(-1)}for(let S=0;S<d.finalShapeGatherIndices.length;++S){const x=d.finalShapeGatherIndices[S];x>=0?m.push(g[x]):x===oT&&m.push(1)}return{finalShapeSparse:m.filter((S,x)=>d.finalShapeGatherIndices[x]!==oT),finalShape:m,isIdentity:p,sliceDim0:f,isSimpleSlice:v,begin:d.begin,end:d.end,strides:d.strides}}function zve(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let i=0;i<t.dims;i++)if(1<<i&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-i)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=i}else if(1<<i&t.newAxisMask)e.finalShapeGatherIndices.push(oT),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[i]),t.end!=null&&(e.end[n]=t.end[i]),e.strides[n]=t.strides[i],t.beginMask&1<<i&&(e.beginMask|=1<<n),t.endMask&1<<i&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<i?(e.finalShapeGatherIndices.push(Nve),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(i)),e.inputShapeGatherIndicesSparse[n]=i,n++}}function l4(t,e,n,i,r,s){if(r[e])return n>0?s[e]:s[e+1&1];{const o=t<0?i+t:t;return o<s[0]?s[0]:o>s[1]?s[1]:o}}const Uve=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:NH,computeFlatOffset:XP,computeOutShape:OH,getNormalizedAxes:Fve,isSliceContinous:qP,maskToAxes:Ove,parseSliceParams:WH,sliceInfo:GH,startForAxis:VH,startIndicesWithElidedDims:BH,stopForAxis:jH,stopIndicesWithElidedDims:$H,stridesForAxis:HH,stridesWithElidedDims:FH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bve=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function $ve(){return new Promise(t=>Bve(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qH(t,e){const n=t[0].length;t.forEach((r,s)=>{Ee(r.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),Ee(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const i=t[0];t.forEach((r,s)=>{for(let o=0;o<n;o++)Ee(o===e||r[o]===i[o],()=>`Error in concat${n}D: Shape of tensors[${s}] (${r}) does not match the shape of the rest (${i}) along the non-concatenated axis ${s}.`)})}function Vu(t,e){const n=t[0].slice();for(let i=1;i<t.length;i++)n[e]+=t[i][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Co;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Co||(Co={}));function XH(t,e,n){let i=new Array;if(n==null&&e==null)return i;if(e==null)for(;i.length<t+n.length;)i.push(-1);else i=e.slice();if(n==null)return i;if(t+n.length!==i.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${i.length}`);for(let r=1;r<n.length;++r){const s=n[r],o=i[i.length-n.length+r],a=i[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${s} but shape[${r+t}] = ${a}`)}else i[o]=s}return i}function KH(t){const e={FIRST_DIM_SIZE:Co.FIRST_DIM_SIZE,VALUE_ROWIDS:Co.VALUE_ROWIDS,ROW_LENGTHS:Co.ROW_LENGTHS,ROW_SPLITS:Co.ROW_SPLITS,ROW_LIMITS:Co.ROW_LIMITS,ROW_STARTS:Co.ROW_STARTS},n=[];for(const i of t)if(i in e)n.push(e[i]);else break;return n}function YH(t){return t.length===0?0:t[0]===Co.FIRST_DIM_SIZE?t.length-1:t.length}function JH(t,e){if(t==null||e==null)return;const n=t.length,i=e.length;if(n>=i)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${i})`);for(let r=0;r<Math.min(n,i-1);++r){const s=t[r],o=e[r+1];if(s>=0&&o>=0&&s!==1&&s!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${s} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KP=30;function jC(t){return t<=KP?t:Gb(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QH(t,e,n){const i=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[i,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YP(t,e,n,i=!0){let r=[];if(i)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const s=e.length;for(let o=0;o<s;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(s+1))}return r}function JP(t,e,n=!0){const i=[];if(n){i.push(e);for(let r=e+1;r<t;++r)r<=2*e?(i.push(r),i.push(r-(e+1))):i.push(r)}else{const r=[],s=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?s.push(o):r.push(o);i.push(...r),i.push(0),i.push(...s)}return i}function QP(t,e,n,i=!0){const r=[];i?r.push(t[0]/n):r.push(t[0]*n);for(let s=1;s<t.length;++s)s<=e.length?i?r.push(e[s-1]*t[s]):r.push(t[s]/e[s-1]):r.push(t[s]);return r}function ZH(t,e){const n=[0];for(let i=0;i<e;++i)n.push(t[i][0]);return n}function eV(t,e,n){const i=t.slice(0,1);for(let r=0;r<n;++r)i.push(t[r+1]-e[r][0]-e[r][1]);return i}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tV=1.7580993408473768,nV=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iV=.3275911,rV=.254829592,sV=-.284496736,oV=1.421413741,aV=-1.453152027,cV=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aT(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let i=0;i<n.length;i+=2)n[i]=t[i/2],n[i+1]=e[i/2];return n}function Hve(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let i=0;i<t.length;i+=2)e[i/2]=t[i],n[i/2]=t[i+1];return{real:e,imag:n}}function Vve(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],i[Math.floor(r/4)]=t[r+1];return{real:n,imag:i}}function jve(t){const e=Math.floor(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],i[Math.floor(r/4)]=t[r+1];return{real:n,imag:i}}function Wve(t,e){const n=t[e*2],i=t[e*2+1];return{real:n,imag:i}}function Gve(t,e,n,i){t[i*2]=e,t[i*2+1]=n}function qve(t,e){const n=new Float32Array(t/2),i=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const s=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(s),i[r]=Math.sin(s)}return{real:n,imag:i}}function Xve(t,e,n){const i=(n?2:-2)*Math.PI*(t/e),r=Math.cos(i),s=Math.sin(i);return{real:r,imag:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dE="->",Kve=/->/g,u4=",",h4="...";function lV(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(Kve,"").length)/dE.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${dE}").`);const[i,r]=t.split(dE);Ee(i.indexOf(h4)===-1,()=>`The ellipsis notation ("${h4}") is not supported yet.`);const s=i.split(u4),o=s.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<r.length;++d){const p=r[d];if(!s.some(f=>f.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let d=0;d<i.length;++d){const p=i[d];a.indexOf(p)===-1&&p!==u4&&a.push(p)}const c=new Array(s.length);for(let d=0;d<o;++d){if(new Set(s[d].split("")).size!==s[d].length)throw new Error(`Found duplicate axes in input component ${s[d]}. Support for duplicate axes in input is not implemented yet.`);c[d]=[];for(let p=0;p<s[d].length;++p)c[d].push(a.indexOf(s[d][p]))}const l=a.length,u=r.length,h=[];for(let d=u;d<l;++d)h.push(d);return{allDims:a,summedDims:h,idDims:c}}function uV(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const i=[];for(let r=0;r<t;++r)n[r]===-1&&i.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:i}}function hV(t,e,n){const i=new Array(t);for(let r=0;r<n.length;++r){const s=n[r].shape;for(let o=0;o<e[r].length;++o)i[e[r][o]]===void 0?i[e[r][o]]=s[o]:Ee(i[e[r][o]]===s[o],()=>`Expected dimension ${i[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(s)}, but got dimension ${s[o]}`)}}function dV(t,e){const n=t,i=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)i.push([]);const s=[];for(let o=0;o<n.length;++o){const a=n[o],c=Yve(e,a);for(const l of c)s.indexOf(l)===-1&&(i[o].push(l),s.push(l))}return{path:n,steps:i}}function pV(t){return t.every((e,n)=>e===n)}function Yve(t,e){const n=[];for(let i=0;i<t.length;++i)(t[i].length===0||t[i].indexOf(e)!==-1||e===-1)&&n.push(i);return n}function fV(t,e,n=0){let i=[];if(typeof e=="number")Ee(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),i=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);Ee(r<=1,()=>"There should be only one negative value in split array.");const s=e.indexOf(-1);if(s!==-1){const o=e.reduce((a,c)=>c>0?a+c:a);e[s]=t.shape[n]-o}Ee(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),i=e}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function gV(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function vV(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function SV(t,e){return`size ${t} must be non-negative, not ${e}`}function xV(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function CV(t,e){const n=be(t),i=be(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${i}. inputShape=${t} outputShape= ${e}`}function _V(t,e){const n=be(t),i=be(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${i}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cT(){return"segment ids must be >= 0"}function wV(){return"segment ids are not increasing"}function EV(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function RV(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(t,e){let n=!1,i;for(t<=KP?(i=t,n=!0):i=Gb(t,Math.floor(Math.sqrt(t)));!n;)i>e||i===t?n=!0:i=Gb(t,i+1);return i}function TV(t,e,n){const i=[],r=t.length;for(let s=0;s<r;s++)s!==e?i.push(t[s]):i.push(n);return i}function AV(t,e,n,i){const r=e.shape.length,s=t.shape.length;if(i!==0&&(i<-r||i>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${i}`);if(i<0&&(i+=r),i>s)throw new Error(`batchDims (${i}) must be less than rank(x) (
    ${s}).`);if(n<i)throw new Error(`batchDims (${i}) must be less than or equal to axis (${n}).`);for(let h=0;h<i;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let c=1,l=1,u=1;for(let h=0;h<i;++h)a.push(t.shape[h]),c*=t.shape[h];for(let h=i;h<n;h++)a.push(t.shape[h]),l*=t.shape[h];for(let h=i;h<r;h++)a.push(e.shape[h]);for(let h=n+1;h<s;h++)a.push(t.shape[h]),u*=t.shape[h];return{batchSize:c,sliceSize:u,outerSize:l,dimSize:o,outputShape:a}}const Jve=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:AV,computeOutShape:TV,segOpComputeOptimalWindowSize:bV},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qd(t){try{return t.map(e=>Kd(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function PV(t){return t.map(e=>Cu(e))}const Qve=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:rV,ERF_A2:sV,ERF_A3:oV,ERF_A4:aV,ERF_A5:cV,ERF_P:iV,PARALLELIZE_THRESHOLD:KP,get RowPartitionType(){return Co},SELU_SCALE:nV,SELU_SCALEALPHA:tV,applyActivation:tve,assertAndGetBroadcastShape:pr,assertAxesAreInnerMostDims:Ho,assertParamsConsistent:qH,assignToTypedArray:Gve,axesAreInnerMostDims:VP,calculateShapes:VC,checkEinsumDimSizes:hV,checkPadOnDimRoundingMode:_0e,combineLocations:IH,combineRaggedTensorToTensorShapes:XH,complexWithEvenIndex:Vve,complexWithOddIndex:jve,computeConv2DInfo:$o,computeConv3DInfo:J0,computeDefaultPad:$P,computeDilation2DInfo:AH,computeOptimalWindowSize:jC,computeOutAndReduceShapes:va,computeOutShape:Vu,computePool2DInfo:Ep,computePool3DInfo:Y0,convertConv2DDataFormat:bp,decodeEinsumEquation:lV,eitherStridesOrDilationsAreOne:Rp,expandShapeToKeepDim:ic,exponent:Xve,exponents:qve,fromStringArrayToUint8:PV,fromUint8ToStringArray:Qd,getAxesPermutation:io,getBroadcastDims:hS,getComplexWithIndex:Wve,getEinsumComputePath:dV,getEinsumPermutation:uV,getFusedBiasGradient:eve,getFusedDyActivation:Z0e,getImageCenter:QH,getInnerMostAxes:ro,getPermuted:JP,getRaggedRank:YH,getReductionAxes:PH,getReshaped:YP,getReshapedPermuted:QP,getRowPartitionTypesHelper:KH,getSliceBeginCoords:ZH,getSliceSize:eV,getSparseFillEmptyRowsIndicesDenseShapeMismatch:mV,getSparseFillEmptyRowsNegativeIndexErrorMessage:gV,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:vV,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:xV,getSparseReshapeInputOutputMismatchErrorMessage:_V,getSparseReshapeInputOutputMultipleErrorMessage:CV,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:yV,getSparseReshapeNegativeOutputDimErrorMessage:SV,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:RV,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:cT,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:wV,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:EV,getUndoAxesPermutation:jP,isIdentityPermutation:pV,log:lge,mergeRealAndImagArrays:aT,prepareAndValidate:DH,prepareSplitSize:fV,segment_util:Jve,shouldFuse:nve,slice_util:Uve,splitRealAndImagArrays:Hve,stridesOrDilationsArePositive:C0e,tupleValuesAreOne:rT,upcastType:ua,validateDefaultValueShape:JH,validateInput:J0e,validateUpdateShape:MH,warn:Eo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */wve();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cu={},uy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Zve(t,e){cu[t]=e}function ko(t,e){if(!(t in cu)||e!=null){const i=tye(t,e);if(i!==null)cu[t]=i;else return console.log("Could not get context for WebGL version",t),null}const n=cu[t];return n==null||n.isContextLost()?(delete cu[t],ko(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),cu[t])}function eye(t){if(!Z().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function tye(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??eye(t);return n.addEventListener("webglcontextlost",i=>{i.preventDefault(),delete cu[t]},!1),Z().getBool("SOFTWARE_WEBGL_ENABLED")&&(uy.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",uy)||n.getContext("experimental-webgl",uy):n.getContext("webgl2",uy)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var p0;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(p0||(p0={}));var gs;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(gs||(gs={}));var ki;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ki||(ki={}));function Q0(t,e){return[e,t]}function nye(t,e){return t*e}function hy(t){const e=be(t),n=Math.ceil(e/4);return jb(n)}function Tp(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function iye(t,e){const[n,i]=Tp(t,e);return n*i*4}function ZP(t,e){const n=t;let i,r,s,o,a,c,l,u,h,d;return Z().getNumber("WEBGL_VERSION")===2?(i=n.R32F,r=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,l=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,c=n.RGBA8):(i=t.RGBA,r=t.RGBA,s=t.RGBA,o=n.RGBA,a=t.RGBA,l=4,u=4,h=e!=null?e.HALF_FLOAT_OES:null,d=t.FLOAT,c=t.RGBA),{internalFormatFloat:i,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ie(t,e){const n=e();return Z().getBool("DEBUG")&&rye(t),n}function rye(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+cye(t,e))}const sye=596e-10,oye=65504;function aye(t){return!!(Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||sye<Math.abs(t)&&Math.abs(t)<oye)}function cye(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function dy(t,e){return rc(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function lye(t,e){const n=rc(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ie(t,()=>t.shaderSource(n,e)),Ie(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function uye(t,e){const n=rc(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ie(t,()=>t.shaderSource(n,e)),Ie(t,()=>t.compileShader(n)),Z().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw IV(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const hye=/ERROR: [0-9]+:([0-9]+):/g;function IV(t,e){const n=hye.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const i=+n[1],r=t.split(`
`),s=r.length.toString().length+2,o=r.map((h,d)=>yd((d+1).toString(),s)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const c=o.slice(0,i-1),l=o.slice(i-1,i),u=o.slice(i);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${yd(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function dye(t){return rc(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function pye(t,e){if(Ie(t,()=>t.linkProgram(e)),!Z().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function pE(t,e){if(Ie(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function fye(t,e){const n=rc(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ie(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Ie(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function mye(t,e){const n=rc(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ie(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),Ie(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function gye(t){return rc(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function vye(t,e){const n=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const i=`[${t}x${e}]`;throw new Error("Requested texture size "+i+" is invalid.")}if(t>n||e>n){const i=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+r+".")}}function yye(t){return rc(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function d4(t,e,n,i,r,s,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(Ie(t,()=>t.bindBuffer(t.ARRAY_BUFFER,i)),Ie(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,s,o)),Ie(t,()=>t.enableVertexAttribArray(a)),!0)}function Sye(t,e,n){Eye(t,n),Ie(t,()=>t.activeTexture(t.TEXTURE0+n)),Ie(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function xye(t,e,n){return rc(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function Cye(t,e,n){return t.getUniformLocation(e,n)}function _ye(t,e,n,i){Ie(t,()=>Sye(t,e,i)),Ie(t,()=>t.uniform1i(n,i))}function fE(t,e,n){Ie(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Ie(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function p4(t,e){Ie(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Ie(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function py(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+wye(t,e))}function wye(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function rc(t,e,n){const i=Ie(t,()=>e());if(i==null)throw new Error(n);return i}function Eye(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=e+t.TEXTURE0;if(i<t.TEXTURE0||i>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Zd(t,e=2){return be(t.slice(0,t.length-e))}function ep(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function fy(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Zd(t),...ep(t)]),e}function Rye(t,e=!1){let n=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE"),i=Z().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");i===1/0&&Z().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(i=n/2),e&&(n=n*2,i=i*2,t=t.map((a,c)=>c>=t.length-2?MP(t[c]):t[c]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Qu(t).newShape);let r=be(t),s=null;t.length<=1&&r<=n?s=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?s=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?s=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?s=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?s=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(s=[t[0],t[1]*t[2]*t[3]]);const o=s!=null&&Math.max(...s)>i&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(s==null||o)if(e){const a=Zd(t);let c=2,l=2;t.length&&([c,l]=ep(t)),r=a*(c/2)*(l/2),s=jb(r).map(u=>u*2)}else s=jb(r);return s}function my(t){return t%2===0}function dS(t,e){if(t=t.slice(-2),e=e.slice(-2),Ni(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],i=e[e.length-1];if(n===i||my(n)&&my(i)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&my(t[0])&&my(e[0])}let mE,gE;function bye(t){if(mE==null){const e=ko(t);mE=e.getParameter(e.MAX_TEXTURE_SIZE)}return mE}function Tye(t){if(gE==null){const e=ko(t);gE=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,gE)}function Aye(t){if(t===0)return 0;let e;const n=ko(t);return Ws(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Ws(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ws(t,e){return t.getExtension(e)!=null}function f4(t){try{if(ko(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Pye(t){if(t===0)return!1;const e=ko(t);if(t===1){if(!Ws(e,"OES_texture_float"))return!1}else if(!Ws(e,"EXT_color_buffer_float"))return!1;return lT(e)}function Iye(t){if(t===0)return!1;const e=ko(t);if(t===1){if(!Ws(e,"OES_texture_float")||!Ws(e,"WEBGL_color_buffer_float"))return!1}else{if(Ws(e,"EXT_color_buffer_float"))return lT(e);const i="EXT_color_buffer_half_float";if(Ws(e,i)){const r=e.getExtension(i);return Mye(e,r)}return!1}return lT(e)}function lT(t){const e=ZP(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(s),o}function Mye(t,e){const n=ZP(t,e),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(i),t.deleteFramebuffer(o),a}function kye(t){return t!==2?!1:ko(t).fenceSync!=null}function Z0(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&Ee(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qe=Z();qe.registerFlag("HAS_WEBGL",()=>qe.getNumber("WEBGL_VERSION")>0);qe.registerFlag("WEBGL_VERSION",()=>f4(2)?2:f4(1)?1:0);qe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);qe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>qe.get("WEBGL_VERSION")===2);qe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);qe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);qe.registerFlag("WEBGL_PACK",()=>qe.getBool("HAS_WEBGL"));qe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_CLIP",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_REDUCE",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_LAZILY_UNPACK",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_CONV_IM2COL",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>qe.getBool("WEBGL_PACK"));qe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>bye(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Tye(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=qe.getNumber("WEBGL_VERSION");return t===0?0:Aye(t)});qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>qe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!gH());qe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Pye(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>qe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:qe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));qe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Iye(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>kye(qe.getNumber("WEBGL_VERSION")));qe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>qe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);qe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});qe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>gH()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});qe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);qe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);qe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);qe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);qe.registerFlag("WEBGL_EXP_CONV",()=>!1);qe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>qe.getBool("IS_TEST"));qe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);qe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);qe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);qe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vr(){let t,e,n,i,r,s,o,a,c,l;return Z().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",i="in",r="texture",s="outputColor",o="out vec4 outputColor;",a=Z().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",i="varying",r="texture2D",s="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:i,texture2D:r,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ih(t,e,n="index"){const i=Di(e);return i.map((r,s)=>{const o=`int ${t[s]} = ${n} / ${r}`,a=s===i.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * ${r}`:`index -= ${t[s]} * ${r}`;return`${o}; ${a};`}).join("")}function WC(t,e,n="index"){const i=Di(e);return i.map((r,s)=>{const o=`int ${t[s]} = ${n} / outShapeStrides[${s}]`,a=s===i.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * outShapeStrides[${s}]`:`index -= ${t[s]} * outShapeStrides[${s}]`;return`${o}; ${a};`}).join("")}function Lye(t,e){const n=t.length,i=t.map(s=>`${e}[${s}]`),r=new Array(n-1);r[n-2]=i[n-1];for(let s=n-3;s>=0;--s)r[s]=`(${r[s+1]} * ${i[s+1]})`;return r}function Dye(t,e,n="index"){const i=t.map((s,o)=>o),r=Lye(i,e);return r.map((s,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,c=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${c};`}).join("")}function eI(t){const e=Di(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function tI(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const MV=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:kV}=Qve;function Nye(t,e,n){const i=[];if(t.forEach(p=>{const f=be(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?i.push(`uniform float ${p.name}${f>1?`[${f}]`:""};`):(i.push(`uniform sampler2D ${p.name};`),i.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){const{uniformShape:v}=nI(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(v.length){case 1:i.push(`uniform int ${p.name}Shape;`);break;case 2:i.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:i.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:i.push(`uniform ivec4 ${p.name}Shape;`);break}i.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;");break}i.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{i.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=i.join(`
`),s=t.map(p=>Oye(p,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=vr(),c=Uye(a);let l,u,h=Hye(a);return e.isPacked?(l=Fye(e.logicalShape,o,n.enableShapeUniforms),u=$ye(a)):(l=zye(e.logicalShape,o,n.enableShapeUniforms),u=Bye(a)),n.packedInputs&&(h+=Gye),[h,c,u,r,l,s,n.userCode].join(`
`)}function Ap(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return r1e(t,e);case 1:return o1e(t,e);case 2:return c1e(t,e);case 3:return u1e(t,e);case 4:return d1e(t,e);case 5:return p1e(t);case 6:return f1e(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function LV(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return i1e(t);case 1:return s1e(t,e);case 2:return a1e(t,e);case 3:return l1e(t,e);default:return h1e(t,e)}}function Oye(t,e,n=!1,i){let r="";n?r+=LV(t,i):r+=Ap(t,i);const s=t.shapeInfo.logicalShape,o=e.logicalShape;return s.length<=o.length&&(n?r+=m1e(t,e):r+=g1e(t,e)),r}function Fye(t,e,n){switch(t.length){case 0:return DV();case 1:return qye(t,e,n);case 2:return t1e(t,e,n);case 3:return Kye(t,e,n);default:return Jye(t,e,n)}}function zye(t,e,n){switch(t.length){case 0:return DV();case 1:return Xye(t,e,n);case 2:return n1e(t,e,n);case 3:return Yye(t,e,n);case 4:return Qye(t,e,n);case 5:return Zye(t,e);case 6:return e1e(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Uye(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Bye(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function $ye(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Hye(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Vye}
    ${jye}
    ${Wye}
  `}const Vye=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jye=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Wye=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Gye=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function DV(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function qye(t,e,n){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return i[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${i[1]}.0);
      }
    `:i[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${i[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      return 2 * (resTexRC.x * ${i[1]} + resTexRC.y);
    }
  `}function Xye(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Kye(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),s=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Yye(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${WC(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const i=ih(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec3(r, c, d);
    }
  `}function Jye(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),s=r*Math.ceil(t[t.length-2]/2);let o=s,a="",c="b, r, c";for(let l=2;l<t.length-1;l++)o*=t[t.length-l-1],a=`
      int b${l} = index / ${o};
      index -= b${l} * ${o};
    `+a,c=`b${l}, `+c;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${c});
    }
  `}function Qye(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${WC(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const i=ih(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec4(r, c, d, d2);
    }
  `}function Zye(t,e){const n=ih(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function e1e(t,e){const n=ih(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function t1e(t,e,n){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ni(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${i[0]}, ${i[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));

      int index = resTexRC.x * ${i[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function n1e(t,e,n){return Ni(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function rh(t){return`offset${t}`}function i1e(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),i=vr();return`
    vec4 ${n}() {
      return ${i.texture2D}(${e}, halfCR);
    }
  `}function r1e(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${i}() {return ${n};}`;const[r,s]=t.shapeInfo.texShape;if(r===1&&s===1)return`
      float ${i}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=rh(n);if(e)return`
    float ${i}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,c]=t.shapeInfo.texShape;return`
    float ${i}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function s1e(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,s=vr();if(e)return`
    vec4 ${i}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${i}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function o1e(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${i}(int index) {
        ${Pp(t)}
      }
    `;const r=t.shapeInfo.texShape,s=r[0],o=r[1];if(o===1&&s===1)return`
      float ${i}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=rh(n);return o===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function a1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape,o=s[0],a=s[1],c=vr();if(s!=null&&Ni(n,s))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);

        return ${c.texture2D}(${i}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${c.texture2D}(${i}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${i}, uv);
    }
  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${i}, uv);
    }
  `}function c1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(s!=null&&Ni(n,s)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `;const d=s[0],p=s[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${i}, uv);
    }
  `}const{newShape:o,keptDims:a}=Qu(n),c=o;if(c.length<n.length){const d=Ip(t,c),p=["row","col"];return`
      ${Ap(d,e)}
      float ${r}(int row, int col) {
        return ${r}(${Mp(p,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Pp(t)}
      }
    `;const l=s[0],u=s[1],h=rh(i);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${i}TexShape[0]));
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${i}, uv);
    }
  `:l===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${i}TexShape[1]), 0.5);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${i}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
        return sampleTexture(${i}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${u}, index);
    return sampleTexture(${i}, uv);
  }
`}function l1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){const d=n.slice(1),p=[1,2],f=Ip(t,d),v=["b","row","col"];return`
        ${LV(f,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Mp(v,p)});
        }
      `}const a=vr();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `;const c=o[0],l=o[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${h}, ${u}, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `}function u1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:c}=Qu(n),l=a;if(l.length<n.length){const v=Ip(t,l),g=["row","col","depth"];return`
        ${Ap(v,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Mp(g,c)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${o}, 1)));
        ${Pp(t)}
      }
    `;const u=t.shapeInfo.texShape,h=u[0],d=u[1],p=t.shapeInfo.flatOffset;if(d===s&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${i}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${i}, uv);
        }
      `;if(d===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${i}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${i}, uv);
    }
  `;const f=rh(i);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${i}Shape[1] * ${i}Shape[2];
      int stride1 = ${i}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
      return sampleTexture(${i}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${o} + depth + ${f};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${i}, uv);
      }
  `}function h1e(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=vr();if(e)return`
    vec4 ${i}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const s=t.shapeInfo.logicalShape,o=s.length,a=t.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],u=c[1],h=Math.ceil(s[o-1]/2);let d=h*Math.ceil(s[o-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let v=2;v<o-1;v++)p=`int b${v}, `+p,d*=s[o-v-1],f=`b${v} * ${d} + `+f;return`
    vec4 ${i}(${p}) {
      int index = ${f};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${l});
      return ${r.texture2D}(${n}, uv);
    }
  `}function d1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:c,keptDims:l}=Qu(n);if(c.length<n.length){const y=Ip(t,c),S=["row","col","depth","depth2"];return`
      ${Ap(y,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Mp(S,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${s}, 1)));
        ${Pp(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${i}Shape[3];`,v=`int stride1 = ${i}Shape[2] * stride2;`,g=`int stride0 = ${i}Shape[1] * stride1;`;if(p===a&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${f}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${i}, uv);
      }
    `;if(p===s&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${i}Shape[1] * ${i}Shape[2], ${i}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${i}, uv);
      }
    `;const m=rh(i);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${v}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index + ${m});
      return sampleTexture(${i}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${m});
      return sampleTexture(${i}, uv);
    }
  `}function p1e(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],s=e[3]*r,o=e[2]*s,a=e[1]*o,{newShape:c,keptDims:l}=Qu(e);if(c.length<e.length){const v=Ip(t,c),g=["row","col","depth","depth2","depth3"];return`
      ${Ap(v)}
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        return ${i}(${Mp(g,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${s}, ${r})) +
          depth3;
        ${Pp(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];if(p===a&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${s}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===r&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const f=rh(n);return`
    float ${i}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${s} +
          depth2 * ${r} + depth3 + ${f};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function f1e(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:s}=Qu(e);if(r.length<e.length){const g=Ip(t,r),m=["row","col","depth","depth2","depth3","depth4"];return`
      ${Ap(g)}
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${i}(${Mp(m,s)});
      }
    `}const o=e[5],a=e[4]*o,c=e[3]*a,l=e[2]*c,u=e[1]*l;if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Pp(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&h==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===o&&h==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const v=rh(n);return`
    float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${v};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Pp(t){const e=t.name,n=be(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function m1e(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=kV(t.shapeInfo.logicalShape,e.logicalShape),c=hn(o),l=o-s;let u;const h=["x","y","z","w","u","v"];s===0?u="":o<2&&a.length>=1?u="coords = 0;":u=a.map(y=>`coords.${h[y+l]} = 0;`).join(`
`);let d="";o<2&&s>0?d="coords":d=t.shapeInfo.logicalShape.map((y,S)=>`coords.${h[S+l]}`).join(", ");let p="return outputValue;";const v=be(t.shapeInfo.logicalShape)===1,m=be(e.logicalShape)===1;if(s===1&&!v&&!m)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!m)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const y=s-2,S=s-1;a.indexOf(y)>-1&&a.indexOf(S)>-1?p="return vec4(outputValue.x);":a.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${i}(${d});
      ${p}
    }
  `}function g1e(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===c&&t.shapeInfo.flatOffset==null&&Ni(o,s))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const l=hn(c),u=kV(t.shapeInfo.logicalShape,e.logicalShape),h=c-a;let d;const p=["x","y","z","w","u","v"];a===0?d="":c<2&&u.length>=1?d="coords = 0;":d=u.map(v=>`coords.${p[v+h]} = 0;`).join(`
`);let f="";return c<2&&a>0?f="coords":f=t.shapeInfo.logicalShape.map((v,g)=>`coords.${p[g+h]}`).join(", "),`
    float ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      return get${i}(${f});
    }
  `}function hn(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function nI(t,e,n){const{newShape:i,keptDims:r}=Qu(e),s=e.length,o=t&&s===3&&e[0]===1,a=o?e.slice(1):i,c=!t&&s>1&&!Ni(e,n)&&i.length<s||o;return{useSqueezeShape:c,uniformShape:c?a:e,keptDims:r}}function Ip(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Mp(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1e(t,e,n,i){const r=n.map((u,h)=>{const d={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(d.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:d}}),s=r.map(u=>u.shapeInfo),o={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},a=Nye(r,o,e),c=uye(t.gl,a),l=t.createProgram(c);return Z().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(l),Object.assign({program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o},NV(t,e,l)))}function NV(t,e,n){const i=[],r=[];let s,o,a,c=null,l=null;l=t.getUniformLocation(n,"NAN",!1),Z().getNumber("WEBGL_VERSION")===1&&(c=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const h of e.variableNames){const d={name:h,uniform:t.getUniformLocation(n,h,u),offset:t.getUniformLocation(n,`offset${h}`,u)};e.enableShapeUniforms&&(d.shape=t.getUniformLocation(n,`${h}Shape`,u),d.texShape=t.getUniformLocation(n,`${h}TexShape`,u)),i.push(d)}if(e.enableShapeUniforms&&(s=t.getUniformLocation(n,"outShape",u),a=t.getUniformLocation(n,"outShapeStrides",u),o=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const h of e.customUniforms)r.push(t.getUniformLocation(n,h.name,u));return{variablesLocations:i,customUniformLocations:r,infLoc:c,nanLoc:l,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}}function m4(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,i)=>{const r=n.logicalShape,s=e[i],o=s.shape;if(!Ni(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&s.isUniform)return;const a=n.texShape,c=s.isUniform?null:s.texData.texShape;if(!Ni(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function y1e(t,e,n,i,r){e.program.enableShapeUniforms||(m4(e.inShapeInfos,n),m4([e.outShapeInfo],[i]));const s=i.texData.texture,o=i.texData.texShape;i.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):t.setOutputMatrixTexture(s.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),Z().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<n.length;++c){const l=n[c],{uniform:u,offset:h,shape:d,texShape:p}=e.variablesLocations[c];if(d){const{uniformShape:f}=nI(e.program.packedInputs,l.shape,l.texData.texShape);switch(f.length){case 1:t.gl.uniform1iv(d,new Int32Array(f));break;case 2:t.gl.uniform2iv(d,new Int32Array(f));break;case 3:t.gl.uniform3iv(d,new Int32Array(f));break;case 4:t.gl.uniform4iv(d,new Int32Array(f));break}}if(p&&t.gl.uniform2i(p,l.texData.texShape[0],l.texData.texShape[1]),u!=null){if(l.isUniform){if(be(l.shape)<2)t.gl.uniform1f(u,l.uniformValues[0]);else{let f=l.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),t.gl.uniform1fv(u,f)}continue}l.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,l.texData.slice.flatOffset),t.setInputMatrixTexture(l.texData.texture.texture,u,c)}}const a=e.outShapeLocation;if(a)switch(i.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(i.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(i.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(i.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(i.shape));break}if(e.outShapeStridesLocation){const c=Di(i.shape);switch(i.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),e.program.customUniforms&&r)for(let c=0;c<e.program.customUniforms.length;++c){const l=e.program.customUniforms[c],u=e.customUniformLocations[c],h=r[c];if(l.type==="float")t.gl.uniform1fv(u,h);else if(l.type==="vec2")t.gl.uniform2fv(u,h);else if(l.type==="vec3")t.gl.uniform3fv(u,h);else if(l.type==="vec4")t.gl.uniform4fv(u,h);else if(l.type==="int")t.gl.uniform1iv(u,h);else if(l.type==="ivec2")t.gl.uniform2iv(u,h);else if(l.type==="ivec3")t.gl.uniform3iv(u,h);else if(l.type==="ivec4")t.gl.uniform4iv(u,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}t.executeProgram()}function S1e(t,e,n){let i="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const c=o.texData.texShape,{useSqueezeShape:l,uniformShape:u,keptDims:h}=nI(t.packedInputs,o.shape,c);let d="",p="",f="";if(u.length===1&&t.packedInputs){const w=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];d=`${w[0]>1}_${w[1]>1}`}else if(u.length===2&&!t.packedInputs)p=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const w=Di(u);f=`${w[0]===c[1]}_${w[w.length-1]===c[1]}`}const v=o.shape.length,g=u.length===2&&Ni(o.shape,c),m=be(o.shape)===1,y=hS(o.shape,n.shape),S=!t.packedInputs&&v===n.shape.length&&Ni(c,n.texData.texShape),x=t.packedInputs||u.length>2?"":`${c[0]>1}_${c[1]>1}`;i+=`${v}_${S}_${l?h:""}_${u.length}_${m}_${y}_${g}_${d}_${p}_${f}_${x}_${a}`}else{const c=o.isUniform?"uniform":o.texData.texShape;i+=`${o.shape}_${c}_${a}`}});const r=t.userCode;let s=t.constructor.name;return s+="_"+i+"_"+r+`${Z().getNumber("WEBGL_VERSION")}`,s}function Yi(t){return Z().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x1e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=p0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?WC(["r","c","d"],e):ih(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C1e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=p0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?WC(["r","c","d"],e):ih(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _1e{constructor(e){this.variableNames=["A"],this.outTexUsage=gs.DOWNLOAD;const n=vr();this.outputShape=e,this.userCode=`
      ${MV}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w1e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=gs.DOWNLOAD;const n=vr();this.outputShape=e,this.userCode=`
      ${MV}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E1e={R:0,G:1,B:2,A:3};class g4{constructor(e,n=!1,i="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);let s="result";n&&(s="floor(result * 255. + 0.5)");let o="";for(let a=0;a<i.length;a++){const c=i[a];o+=`
          if(offset == ${a}) {
            result = values[${E1e[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?tI():eI(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${i.length});

        flatIndex = idiv(flatIndex, ${i.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${s}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R1e{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);let r="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const c=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${i.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?tI():eI(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${i.output} = ${s};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1e(t){const e=vr(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return lye(t,n)}function T1e(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return fye(t,e)}function A1e(t){const e=new Uint16Array([0,1,2,2,1,3]);return mye(t,e)}function ev(t,e,n,i,r,s){vye(e,n);const o=gye(t),a=t.TEXTURE_2D;return Ie(t,()=>t.bindTexture(a,o)),Ie(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Ie(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Ie(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Ie(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),Z().getNumber("WEBGL_VERSION")===1?Ie(t,()=>t.texImage2D(a,0,i,e,n,0,r,s,null)):Ie(t,()=>t.texStorage2D(a,1,i,e,n)),Ie(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function OV(t){return t.internalFormatFloat}function P1e(t,e,n,i){const[r,s]=Q0(e,n);return ev(t,r,s,OV(i),i.textureFormatFloat,t.FLOAT)}function FV(t){return t.internalFormatHalfFloat}function I1e(t,e,n,i){const[r,s]=Q0(e,n);return ev(t,r,s,FV(i),i.textureFormatFloat,i.textureTypeHalfFloat)}function zV(t){return t.downloadTextureFormat}function M1e(t,e,n,i){const[r,s]=Q0(e,n);return ev(t,r,s,zV(i),t.RGBA,t.UNSIGNED_BYTE)}function UV(t){return t.internalFormatPackedFloat}function k1e(t,e,n,i){const[r,s]=Tp(e,n);return ev(t,r,s,UV(i),t.RGBA,t.FLOAT)}function BV(t){return t.internalFormatPackedHalfFloat}function L1e(t,e,n,i){const[r,s]=Tp(e,n);return ev(t,r,s,BV(i),t.RGBA,i.textureTypeHalfFloat)}function D1e(t,e,n){return Ie(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),d4(t,e,"clipSpacePos",n,3,20,0)&&d4(t,e,"uv",n,2,20,12)}function N1e(t,e,n,i,r,s){Ie(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,c;r instanceof Uint8Array?(o=new Uint8Array(n*i*4),a=t.UNSIGNED_BYTE,c=t.RGBA):(o=new Float32Array(n*i*4),a=t.FLOAT,c=s.internalFormatPackedFloat),o.set(r),Z().getNumber("WEBGL_VERSION")===2?Ie(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,i,t.RGBA,a,o)):Ie(t,()=>t.texImage2D(t.TEXTURE_2D,0,c,n,i,0,t.RGBA,a,o)),Ie(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function O1e(t,e,n){Ie(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?Z().getNumber("WEBGL_VERSION")===2?Ie(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):Ie(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):Z().getNumber("WEBGL_VERSION")===2?Ie(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):Ie(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),Ie(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function F1e(t,e,n,i){const r=t.createBuffer();Ie(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return Ie(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Ie(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),Ie(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function z1e(t,e,n){const i=t,r=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,r),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),r}function U1e(t,e,n,i){const[r,s]=Q0(e,n),o=4,a=new Uint8Array(nye(e*n,o));return Ie(t,()=>t.readPixels(0,0,r,s,i.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function B1e(t,e,n,i,r,s,o,a){const c=t,l=new Float32Array(iye(s,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function $1e(t,e,n){const i=new Float32Array(e*n*4);return Ie(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,i)),i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vE{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=Z().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Zve(n,e)):this.gl=ko(n),e=this.gl,Z().getNumber("WEBGL_VERSION")===2){const s=e;this.createVertexArray=()=>Ie(s,()=>s.createVertexArray()),this.bindVertexArray=o=>Ie(s,()=>s.bindVertexArray(o)),this.deleteVertexArray=o=>Ie(s,()=>s.deleteVertexArray(o)),this.getVertexArray=()=>Ie(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(e!=null){const s=e.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ie(e,()=>s.createVertexArrayOES()),this.bindVertexArray=o=>Ie(e,()=>s.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Ie(e,()=>s.deleteVertexArrayOES(o)),this.getVertexArray=()=>Ie(e,()=>e.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let i="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Z().getNumber("WEBGL_VERSION")===1){const s="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=dy(this.gl,s),Ws(this.gl,o))this.textureHalfFloatExtension=dy(this.gl,o);else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),Ws(this.gl,r))this.colorBufferHalfFloatExtension=dy(this.gl,r);else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",Ws(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(Ws(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=T1e(this.gl),this.indexBuffer=A1e(this.gl),this.framebuffer=yye(this.gl),this.textureConfig=ZP(this.gl,this.textureHalfFloatExtension)}get debug(){return Z().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ie(e,()=>e.finish()),Ie(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ie(e,()=>e.deleteFramebuffer(this.framebuffer)),Ie(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ie(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ie(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),P1e(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),I1e(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),M1e(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),O1e(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,i,r){this.throwIfDisposed(),N1e(this.gl,e,n,i,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),L1e(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),k1e(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(p4(this.gl,this.framebuffer),this.outputTexture=null),Ie(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,i){return this.downloadMatrixDriver(e,()=>U1e(this.gl,n,i,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,i,r,s,o){return B1e(this.gl,e,n,i,r,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return z1e(this.gl,e,n)}createBufferFromTexture(e,n,i){this.bindTextureToFrameBuffer(e);const r=F1e(this.gl,n,i,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,i;if(Z().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,s=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),i=()=>{const o=r.clientWaitSync(s,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=s}else Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),i=()=>this.isQueryAvailable(n,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):i=()=>!0;return{query:n,isFencePassed:i}}downloadMatrixFromPackedTexture(e,n,i){return this.downloadMatrixDriver(e,()=>$1e(this.gl,n,i))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=b1e(n));const i=dye(n);Ie(n,()=>n.attachShader(i,this.vertexShader)),Ie(n,()=>n.attachShader(i,e)),pye(n,i);const r=Object.assign(i,{vao:this.createVertexArray()});return this.debug&&pE(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;Ie(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),D1e(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ie(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&pE(this.gl,this.program),Ie(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,i=!0){return this.throwIfDisposed(),i?xye(this.gl,e,n):Cye(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),Ie(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,i){this.throwIfDisposed(),this.throwIfNoProgram(),_ye(this.gl,e,n,i)}setOutputMatrixTexture(e,n,i){this.setOutputMatrixTextureDriver(e,i,n)}setOutputPackedMatrixTexture(e,n,i){this.throwIfDisposed();const[r,s]=Tp(n,i);this.setOutputMatrixTextureDriver(e,r,s)}setOutputMatrixWriteRegion(e,n,i,r){this.setOutputMatrixWriteRegionDriver(i,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,i,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&pE(this.gl,this.program),py(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ie(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ie(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=dy(this.gl,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const i=this.gl,r=this.getQueryTimerExtensionWebGL2(),s=i.createQuery();return i.beginQuery(r.TIME_ELAPSED_EXT,s),s}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,i=this.getQueryTimerExtensionWebGL2();n.endQuery(i.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await UO(()=>this.disposed||this.isQueryAvailable(e,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const i=this.gl;return i.getQueryParameter(e,i.QUERY_RESULT)/1e6}else{const i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const i=this.gl,r=this.getQueryTimerExtensionWebGL2(),s=i.getQueryParameter(e,i.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{const i=this.getQueryTimerExtensionWebGL1(),r=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=H1e(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:i}=this.itemsToPoll[n];i()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let i;"setTimeoutCustom"in Z().platform&&(i=Z().platform.setTimeoutCustom.bind(Z().platform)),UO(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,i)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),fE(this.gl,e,this.framebuffer),this.debug&&py(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(fE(this.gl,this.outputTexture,this.framebuffer),this.debug&&py(this.gl)):p4(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const i=n();return this.unbindTextureToFrameBuffer(),i}setOutputMatrixTextureDriver(e,n,i){this.throwIfDisposed();const r=this.gl;fE(r,e,this.framebuffer),this.debug&&py(r),this.outputTexture=e,Ie(r,()=>r.viewport(0,0,n,i)),Ie(r,()=>r.scissor(0,0,n,i))}setOutputMatrixWriteRegionDriver(e,n,i,r){this.throwIfDisposed(),Ie(this.gl,()=>this.gl.scissor(e,n,i,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function H1e(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1e(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lr(t){return(e,n,i,r,s)=>{const o=pr(e,n),a=o.length,c=Di(o),l=be(o),u=zu(s,l),h=e.length,d=n.length,p=Di(e),f=Di(n),v=hS(e,o),g=hS(n,o);if(v.length+g.length===0)for(let m=0;m<u.length;++m)u[m]=t(i[m%i.length],r[m%r.length]);else for(let m=0;m<u.length;++m){const y=kP(m,a,c),S=y.slice(-h);v.forEach(E=>S[E]=0);const x=qb(S,h,p),w=y.slice(-d);g.forEach(E=>w[E]=0);const C=qb(w,d,f);u[m]=t(i[x],r[C])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j1e(t,e,n,i){if(i==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(i==="bool"){const r=$C([0],n),[s,o]=Lr((a,c)=>a!==c?1:0)(e,[],t,r,"bool");return[o,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${i}`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W1e=Lr((t,e)=>t+e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G1e(t,e,n,i,r){const s=be(i),o=dl(r,n);for(let a=0;a<t.length;a++){const c=t[a];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(s>0?o[c]+=e[a]:o[c]+=1)}return o}function q1e(t,e,n,i=!1){const r=t.shape[0],s=t.shape[1],o=Oi([r,n],e.dtype);for(let a=0;a<r;a++)for(let c=0;c<s;c++){const l=t.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(i?o.set(1,a,l):e.size>0?o.set(o.get(a,l)+e.get(a,c),a,l):o.set(o.get(a,l)+1,a,l))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X1e=Lr((t,e)=>t&e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sc(t){return(e,n,i)=>{const r=_i(n,e.length);for(let s=0;s<e.length;++s)r[s]=t(e[s],i);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1e=sc(t=>Math.ceil(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y1e(t,e,n,i){const r=_i(n,be(e));if(i&&n!=="string"){let s=0;t.forEach(o=>{const a=be(o.shape);r.set(o.vals,s),s+=a})}else{let s=0;t.forEach(o=>{const a=n==="string"?Qd(o.vals):o.vals;let c=0;for(let l=0;l<o.shape[0];++l){const u=l*e[1]+s;for(let h=0;h<o.shape[1];++h)r[u+h]=a[c++]}s+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1e=Lr((t,e)=>t===e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1e=sc(t=>Math.exp(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z1e=sc(t=>Math.expm1(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eSe=sc(t=>Math.floor(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tSe=Lr((t,e)=>Math.floor(t/e));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nSe(t,e,n,i,r,s,o,a,c){const l=Oi([i,s],n);for(let u=0;u<i;u++){const h=[];let d=0;for(let p=0;p<r;p++){const f=t[u*r+p];d+=f*o[p],h.push(f)}if(d<0||d>=c/s)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let p=0;p<s;p++)l.values[u*s+p]=e.get(...e.indexToLoc(d*s+p))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(t,e,n){const i=Oi(n,t.dtype);for(let r=0;r<i.size;++r){const o=i.indexToLoc(r).slice(),a=o[0],c=o[2],l=e.locToIndex([a,c]);o[2]=e.values[l];const u=t.locToIndex(o);0<=u&&u<t.values.length&&(i.values[r]=t.values[u])}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rSe=Lr((t,e)=>t>e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sSe=Lr((t,e)=>t>=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oSe=Lr((t,e)=>t<e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aSe=Lr((t,e)=>t<=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cSe(t,e,n){const i=(e-t)/(n-1),r=dl(n,"float32");r[0]=t;for(let s=1;s<r.length;s++)r[s]=r[s-1]+i;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lSe=sc(t=>Math.log(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uSe(t,e,n,i){const r=zu(i,be(n));for(let s=0;s<r.length;++s){const o=s*e;let a=t[o];for(let c=0;c<e;++c){const l=t[o+c];(Number.isNaN(l)||l>a)&&(a=l)}r[s]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hSe=Lr((t,e)=>Math.max(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dSe=Lr((t,e)=>Math.min(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $V=Lr((t,e)=>t*e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pSe(t,e,n){const i=wp(-1,n);return $V([],e,i,t,n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fSe=Lr((t,e)=>t!==e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(t,e,n,i,r){const s=e.length,o=be(e),a=Di(e),c=Di(r),l=zu(n,be(r));for(let u=0;u<o;++u){const h=kP(u,s,a),d=new Array(h.length);for(let f=0;f<d.length;f++)d[f]=h[i[f]];const p=qb(d,s,c);l[p]=t[u]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gSe(t,e,n,i){const[r,s]=va(t,i),o=ua(e,"int32"),a=dl(be(r),o),c=be(s);for(let l=0;l<a.length;++l){const u=l*c;let h=1;for(let d=0;d<c;++d)h*=n[u+d];a[l]=h}return{outVals:a,outShape:r,outDtype:o}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vSe(t,e,n){t.forEach((i,r)=>{if(i<0||i>=n){const s=kP(r,e.length,Di(e)).join(",");throw new Error(`indices[${s}] = ${i} is not in [0, ${n})`)}})}function ySe(t,e){for(let n=0;n<t.length;++n){const i=t[n],r=n===t.length-1?e:t[n+1].length;if(i.length===0)throw new Error("Ragged splits may not be empty");if(i[0]<0)throw new Error("Ragged splits must be non-negative");if(i[i.length-1]>r)throw new Error("Ragged splits must not point past values");for(let s=1;s<i.length;++s)if(i[s-1]>i[s])throw new Error("Ragged splits must be sorted in ascending order")}}function SSe(t,e,n,i){const r=[];let s=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);ySe(n,i);let c=1;for(let l=0;l<e.length-1;++l){c*=e[l];const u=e[l+1];for(let h=1;h<c+1;++h)a[l].push(h*u)}for(let l=0;l<t.length;++l){let u=t[l],h=t[l]+1;for(let d=0;d<n.length;++d){const p=n[d],f=d+e.length-1;if(f>=0){const v=a[f],g=v[v.length-1]-p[u];for(let m=u;m<h;++m)a[f].push(p[m+1]+g)}u=p[u],h=p[h]}h!==u&&(r.push([u,h]),s+=h-u)}return{outSplits:a,valueSlices:r,numValues:s}}function xSe(t){const e=[];for(let n=0;n<t.length;++n){const i=t[n].length,r=_i("int32",i);e.push(r),t[n].forEach((s,o)=>r[o]=s)}return e}function v4(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let i=e;i<t.length;i++)n[e-1]*=t[i];return n}function CSe(t,e,n,i,r,s){const o=v4(e,2)[1],a=v4(s,2)[1];let c=0;for(const l of n)for(let u=l[0];u<l[1];++u){for(let h=0;h<i;++h)r[c*a+h]=t[u*o+h];++c}}function _Se(t,e,n,i,r){const s=e.slice();s[0]=r;const o=_i(n,be(s)),a=t.length,c=a===0?0:a/e[0];return CSe(t,e,i,c,o,s),[o,s]}function wSe(t,e,n,i,r,s,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(vSe(s,o,c),i.length===0)throw new Error("params.rank must be nonzero");const l=i[0],{outSplits:u,valueSlices:h,numValues:d}=SSe(s,o,t,l),p=xSe(u),f=_Se(n,i,r,h,d);return[p,f[0],f[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y4=2147483647;function ESe(t,e,n,i,r,s,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,c=r.length===0,l=o.length===0,u=[];a||u.push(e[0]),c||u.push(r[0]),l||u.push(o[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=u.length===0?1:u[0],d=_i("int32",h+1);d[0]=0;for(let g=0;g<h;++g){const m=a?t[0]:t[g],y=c?i[0]:i[g],S=l?s[0]:s[g];if(S===0)throw new Error("Requires delta != 0");let x;if(S>0&&y<m||S<0&&y>m)x=0;else if(x=Math.ceil(Math.abs((y-m)/S)),x>y4)throw new Error(`Requires ((limit - start) / delta) <= ${y4}`);d[g+1]=d[g]+x}const p=d[h],f=_i(n,p);let v=0;for(let g=0;g<h;++g){const m=d[g+1]-d[g];let y=a?t[0]:t[g];const S=l?s[0]:s[g];for(let x=0;x<m;++x)f[v++]=y,y+=S}return[d,f]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ks=Co;class pS{constructor(e,n,i,r,s,o,a,c,l,u){this.shape=e,this.shapeShape=n,this.values=i,this.valuesShape=r,this.valuesDType=s,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=KH(u),this.raggedRank=YH(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ks.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ks.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ks.VALUE_ROWIDS:return pS.getMaxWidthValueRowID(n);case ks.ROW_SPLITS:return pS.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${ks[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let i=0;for(let r=0;r<n-1;++r){const s=e[r+1]-e[r];s>i&&(i=s)}return i}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let i=0,r=e[0],s=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,s=Math.max(o-i,s),i=o)}return Math.max(n-i,s)}tensorShapeFromTensor(e,n,i=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return x4(e,i)}calculateOutputSize(e){const n=this.valuesShape,i=this.defaultValueShape;JH(i,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=XH(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,i){const r=Math.min(e,i),s=[];let o=0;for(let a=0;a<r;++a,o+=n)s.push(o);for(let a=r;a<e;++a)s.push(-1);return Ee(s.length===e,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(e,n,i,r){const s=e.length,o=[];for(let a=0;a<s-1;++a){const c=e[a+1]-e[a];let l=Math.min(r,c),u=n[a];u===-1&&(l=0);for(let h=0;h<l;++h)o.push(u),u+=i;for(let h=0;h<c-l;++h)o.push(-1)}if(s>0&&o.length!==e[s-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,i,r){const s=e.length,o=[];if(s===0)return[];let a=0,c=e[0];if(c>=n.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${n.length}`);let l=n[c];o.push(l);for(let u=1;u<s;++u){const h=e[u];if(h===c)l>=0&&(++a,a<r?l+=i:l=-1);else{if(a=0,c=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);l=n[h]}o.push(l)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,i,r){const s=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ks.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,i,r);case ks.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,i,r);default:throw new Error(`Unsupported partition type: ${ks[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case ks.FIRST_DIM_SIZE:return e[0];case ks.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ks.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ks[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),i=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*i[c+1];const s=x4(i,!1),o=_i(this.valuesDType,be(s));if(r[0]*i[0]>0){let c=this.calculateFirstParentOutputIndex(n,r[0],i[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,r[l],i[l]);this.setOutput(this.raggedRank,c,o,s)}return[s,o]}setOutput(e,n,i,r){if(i.length===0)return;const s=this.values,o=i;let a=r.slice();a=a.slice(e+1);const c=be(a),l=n.length;let u=this.defaultValue;if(u.length!==c&&u.length!==1){const f=this.defaultValueShape;ii(()=>{const v=HP(u,f);u=T0e(v,a).dataSync()})}let h=0,d=0,p=0;for(let f=0;f<=l;++f){let v=f<l?n[f]:-1;if(v===p){++p;continue}if(d<p){const g=s.subarray(h*c),m=o.subarray(d*c),y=(p-d)*c;S4(m,g,y)}if(f>=l){const g=i.length;v=Math.floor(g/c)}if(v>p)if(this.defaultValue.length===1)o.subarray(p*c,v*c).fill(this.defaultValue[0]),p=v;else for(;v>p;){const g=o.slice(p*c);S4(g,u,c),++p}v<0?(h=f+1,d=p):(h=f,d=p,p=d+1)}}}function S4(t,e,n){for(let i=0;i<n;i++)t[i]=e[i]}function x4(t,e){const n=[];for(let i of t){if(i<0){if(!e)throw new Error(`Dimension ${i} must be >= 0`);if(i<-1)throw new Error(`Dimension ${i} must be >= -1`);i=-1}n.push(i)}return n}function RSe(t,e,n,i,r,s,o,a,c,l){return new pS(t,e,n,i,r,s,o,a,c,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bSe(t,e,n,i){const r=t===e,s=t<e&&n<0,o=e<t&&n>1;if(r||s||o)return dl(0,i);const a=Math.abs(Math.ceil((e-t)/n)),c=dl(a,i);e<t&&n===1&&(n=-1),c[0]=t;for(let l=1;l<c.length;l++)c[l]=c[l-1]+n;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TSe=sc(t=>1/Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ASe(t,e,n,i,r,s,o,a,c,l){const u=[i/r,r],h=t.values,d=e.values;if(i===0)return Oi(n,e.dtype);const p=c instanceof cS?c:Oi(u,e.dtype);typeof c=="string"||typeof c=="number"?p.values.fill(c):typeof c=="boolean"&&p.values.fill(+c);for(let f=0;f<s;f++){const v=[];let g=0;for(let m=0;m<o;m++){const y=h[f*o+m];v.push(y),g+=y*a[m]}if(g<0||g>=i/r)throw new Error(`Invalid indices: ${v} does not index into ${n}`);for(let m=0;m<r;m++)l?p.values[g*r+m]+=d[f*r+m]:p.values[g*r+m]=e.rank===0?d[0]:d[f*r+m]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PSe=sc(t=>1/(1+Math.exp(-t)));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ISe(t,e,n,i,r){const s=qP(i,e,n),o=be(n),a=Di(i);if(s){const h=XP(e,a);return r==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const c=r==="string"?Qd(t):t,l=Oi(i,r,c),u=Oi(n,r);for(let h=0;h<u.size;++h){const d=u.indexToLoc(h),p=d.map((f,v)=>f+e[v]);u.set(l.get(...p),...d)}return r==="string"?PV(u.values):u.values}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MSe(t,e,n,i,r,s,o){const a=e[0],c=s[0],l=new Array(c),u=new Array(a),h=e[1];if(c===0){if(a!==0)throw new Error(mV(a));const g=_i(n,0),m=_i(r,0);return[g,[0,h],m,l,u]}let d=!0,p=0;const f=new Array(c).fill(0);for(let g=0;g<a;++g){const m=t[g*h];if(m<0)throw new Error(gV(g,m));if(m>=c)throw new Error(vV(g,m,c));++f[m],d=d&&m>=p,p=m}let v=!0;for(let g=0;g<c;++g){const m=f[g]===0;l[g]=m,v=v&&!m,f[g]=Math.max(f[g],1),g>0&&(f[g]+=f[g-1])}if(v&&d){const g=t,m=i;for(let y=0;y<a;++y)u[y]=y;return[g,[a,h],m,l,u]}else{const g=f[c-1],m=_i(n,g*h),y=_i(r,g),S=new Array(c).fill(0);for(let x=0;x<a;++x){const w=t[x*h],C=S[w],E=(w===0?0:f[w-1])+C;S[w]++;for(let b=0;b<h;++b)m[E*h+b]=t[x*h+b];y[E]=i[x],u[x]=E}for(let x=0;x<c;++x)if(S[x]===0){const C=x===0?0:f[x-1];m[C*h+0]=x;for(let E=1;E<h;++E)m[C*h+E]=0;y[C]=o}return[m,[g,h],y,l,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kSe(t,e,n,i,r){const s=be(i),o=e[0],a=r.length,c=[];let l=1,u=-1;for(let g=0;g<a;++g){const m=r[g];if(m===-1){if(u!==-1)throw new Error(yV(u,g));u=g,c.push(1)}else{if(m<0)throw new Error(SV(g,m));l*=m,c.push(m)}}if(u!==-1){if(l<=0)throw new Error(xV());const g=Math.trunc(s/l);if(l*g!==s)throw new Error(CV(i,c));c[u]=g}if(be(c)!==s)throw new Error(_V(i,c));const d=i.length,p=[];if(d>0){p[d-1]=1;for(let g=d-2;g>=0;--g)p[g]=p[g+1]*i[g+1]}const f=[];if(a>0){f[a-1]=1;for(let g=a-2;g>=0;--g)f[g]=f[g+1]*c[g+1]}const v=_i(n,o*a);for(let g=0;g<o;++g){let m=0;for(let y=0;y<d;++y)m+=t[g*d+y]*p[y];for(let y=0;y<a;++y)v[g*a+y]=Math.trunc(m/f[y]),m%=f[y]}return[v,[o,a],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSe(t,e,n,i,r,s=!1,o=0){const a=i.length,c=[e[0],t.length/e[0]],l=c[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(cT());const d=e.slice();d[0]=h;const p=d.reduce((S,x)=>S*x,1),f=_i(n,p);if(a===0)return h>0&&f.fill(o),[f,d];if(h<=0)throw new Error(cT());let v=0,g=1,m=0,y=r[v];for(;;){let S=0;if(g<a){if(S=r[g],y===S){++g;continue}if(y>=S)throw new Error(wV())}if(y<0||y>=h)throw new Error(EV(y,h));y>m&&f.fill(o,m*l,y*l);for(let x=v;x<g;++x){const w=i[x];if(w<0||w>=c[0])throw new Error(RV(x,i[x],c[0]));for(let C=0;C<l;C++)f[y*l+C]+=t[w*l+C]}if(s)for(let x=0;x<l;x++)f[y*l+x]/=g-v;if(v=g,++g,m=y+1,y=S,g>a)break}return m<h&&f.fill(o,m*l,h*l),[f,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DSe=sc(t=>Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NSe=Lr((t,e)=>{const n=t-e;return n*n});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OSe=sc((t,e)=>{const{pattern:n,replaceGlobal:i,rewrite:r}=e;return t.replace(new RegExp(n,i?"g":""),r)});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FSe(t,e,n,i){const r=Oi(t,e.dtype);for(let s=0;s<r.size;s++){const o=r.indexToLoc(s),a=new Array(o.length);for(let c=0;c<a.length;c++)a[c]=o[c]*n[c]+i[c];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zSe{constructor(e,n,i,r,s,o){this.separator=Cu(e),this.nGramWidths=n,this.leftPad=Cu(i),this.rightPad=Cu(r),this.padWidth=s,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const i=this.getPadWidth(n);return Math.max(0,e+2*i-n+1)}createNGrams(e,n,i,r,s,o){for(let a=0;a<s;++a){const c=this.getPadWidth(o),l=Math.max(0,c-a),u=Math.max(0,c-(s-(a+1))),h=o-(l+u),d=n+(l>0?0:a-c);let p=0;p+=l*this.leftPad.length;for(let y=0;y<h;++y)p+=e[d+y].length;p+=u*this.rightPad.length;const f=l+u+h-1;p+=f*this.separator.length,i[r+a]=new Uint8Array(p);const v=i[r+a];let g=0;const m=y=>y.forEach(S=>v[g++]=S);for(let y=0;y<l;++y)m(this.leftPad),m(this.separator);for(let y=0;y<h-1;++y)m(e[d+y]),m(this.separator);if(h>0){m(e[d+h-1]);for(let y=0;y<u;++y)m(this.separator),m(this.rightPad)}else{for(let y=0;y<u-1;++y)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,n){const i=e.length,r=n.length;if(r>0){let c=n[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<r;++l){let u=n[l]>=c;if(u=u&&n[l]<=i,!u)throw new Error(`Invalid split value ${n[l]}, must be in [${c}, ${i}]`);c=n[l]}if(c!==i)throw new Error(`Last split value must be data size. Expected ${i}, got ${c}`)}const s=r-1,o=_i("int32",r);if(i===0||r===0){const c=new Array(i);for(let l=0;l<=s;++l)o[l]=0;return[c,o]}o[0]=0;for(let c=1;c<=s;++c){const l=n[c]-n[c-1];let u=0;this.nGramWidths.forEach(h=>{u+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&u===0&&(u=1),o[c]=o[c-1]+u}const a=new Array(o[s]);for(let c=0;c<s;++c){const l=n[c];let u=o[c];if(this.nGramWidths.forEach(h=>{const d=n[c+1]-n[c],p=this.getNumNGrams(d,h);this.createNGrams(e,l,a,u,p,h),u+=p}),this.preserveShort&&u===o[c]){const h=n[c+1]-n[c];if(h===0)continue;const d=h+2*this.padWidth;this.createNGrams(e,l,a,u,1,d)}}return[a,o]}}function USe(t,e,n,i,r,s,o,a){return new zSe(n,i,r,s,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSe(t,e,n,i){if(!t.length)return;if(e.length===0){for(let s=0;s<t.length;++s)i.push(t.subarray(s,s+1));return}if(e.length===1){const s=e[0];let o=t.indexOf(s);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&i.push(a),t=t.subarray(o+1),o=t.indexOf(s)}(!n||t.length!==0)&&i.push(t);return}let r=0;for(let s=0;s<t.length+1;s++)if(s===t.length||e.indexOf(t[s])!==-1){const o=t.subarray(r,s);(!n||o.length!==0)&&i.push(o),r=s+1}}function $Se(t,e,n){const i=t.length,r=[];let s=0,o=0;const a=new Array(i);for(let d=0;d<i;++d){const p=r.length;BSe(t[d],e,n,r);const f=r.length-p;a[d]=f,s+=f,o=Math.max(o,f)}const c=_i("int32",s*2),l=new Array(s),u=[i,o];let h=0;for(let d=0;d<i;++d)for(let p=0;p<a[d];++p)c[h*2]=d,c[h*2+1]=p,l[h]=r[h],++h;return[c,l,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(t,e){const n=_i("int32",t.length);for(let i=0;i<t.length;++i)n[i]=yge(t[i]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VSe=Lr((t,e)=>t-e);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jSe(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const i=Oi(n,t.dtype);for(let r=0;r<i.values.length;++r){const s=i.indexToLoc(r),o=new Array(t.rank);for(let c=0;c<o.length;c++)o[c]=s[c]%t.shape[c];const a=t.locToIndex(o);i.values[r]=t.values[a]}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ag=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function HV(t,e,n=0,i=t.length-1){for(;i>n;){if(i-n>600){const a=i-n+1,c=e-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(a-u)/a)*Math.sign(c-a/2),d=Math.max(n,Math.floor(e-c*u/a+h)),p=Math.min(i,Math.floor(e+(a-c)*u/a+h));HV(t,e,d,p)}const r=t[e];let s=n,o=i;for(Gm(t,n,e),ag(t[i],r)>0&&Gm(t,n,i);s<o;){for(Gm(t,s,o),s++,o--;ag(t[s],r)<0;)s=s+1;for(;ag(t[o],r)>0;)o=o-1}ag(t[n],r)===0?Gm(t,n,o):(o=o+1,Gm(t,o,i)),o<=e&&(n=o+1),e<=o&&(i=o-1)}}function WSe(t,e,n,i,r){const s=e[e.length-1],[o,a]=[t.length/s,s],c=zu(n,o*i),l=zu("int32",o*i);for(let h=0;h<o;h++){const d=h*a,p=t.subarray(d,d+a);let f=new Array(p.length);p.forEach((y,S)=>f[S]={value:y,index:S}),i<f.length&&(HV(f,i),f=f.slice(0,i)),r&&f.sort(ag);const v=h*i,g=c.subarray(v,v+i),m=l.subarray(v,v+i);for(let y=0;y<i;y++)g[y]=f[y].value,m[y]=f[y].index}const u=e.slice();return u[u.length-1]=i,[Oi(u,n,c),Oi(u,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GSe(t,e,n,i){const r=kr(e,n)[0],s=[1,n[0],1];for(let f=0;f<r;f++)s[0]*=n[f];s[1]=n[r];for(let f=r+1;f<n.length;f++)s[2]*=n[f];const o=new Map,a=new Int32Array(n[r]),c=new cS(s,i,t),l=[],u=s[0]===1&&s[2]===1;for(let f=0;f<n[r];f++){let v;if(u)v=t[f].toString();else{const m=[];for(let y=0;y<s[0];y++)for(let S=0;S<s[2];S++)m.push(c.get(y,f,S));v=m.join(",")}const g=o.get(v);if(g!=null)a[f]=g;else{const m=o.size;o.set(v,m),a[f]=m,l.push(f)}}const h=s.slice();h[1]=o.size;const d=new cS(h,i);l.forEach((f,v)=>{for(let g=0;g<s[0];g++)for(let m=0;m<s[2];m++)d.set(c.get(g,f,m),g,v,m)});const p=n.slice();return p[r]=h[1],{outputValues:d.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qSe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:W1e,bincountImpl:G1e,bincountReduceImpl:q1e,bitwiseAndImpl:X1e,castImpl:j1e,ceilImpl:K1e,concatImpl:Y1e,equalImpl:J1e,expImpl:Q1e,expm1Impl:Z1e,floorDivImpl:tSe,floorImpl:eSe,gatherNdImpl:nSe,gatherV2Impl:iSe,greaterEqualImpl:sSe,greaterImpl:rSe,lessEqualImpl:aSe,lessImpl:oSe,linSpaceImpl:cSe,logImpl:lSe,maxImpl:uSe,maximumImpl:hSe,minimumImpl:dSe,multiplyImpl:$V,negImpl:pSe,notEqualImpl:fSe,prodImpl:gSe,raggedGatherImpl:wSe,raggedRangeImpl:ESe,raggedTensorToTensorImpl:RSe,rangeImpl:bSe,rsqrtImpl:TSe,scatterImpl:ASe,sigmoidImpl:PSe,simpleAbsImpl:V1e,sliceImpl:ISe,sparseFillEmptyRowsImpl:MSe,sparseReshapeImpl:kSe,sparseSegmentReductionImpl:LSe,sqrtImpl:DSe,squaredDifferenceImpl:NSe,staticRegexReplaceImpl:OSe,stridedSliceImpl:FSe,stringNGramsImpl:USe,stringSplitImpl:$Se,stringToHashBucketFastImpl:HSe,subImpl:VSe,tileImpl:jSe,topKImpl:WSe,transposeImpl:mSe,uniqueImpl:GSe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:XSe,bincountImpl:VV,bincountReduceImpl:KSe,bitwiseAndImpl:YSe,castImpl:JSe,ceilImpl:QSe,concatImpl:ZSe,equalImpl:exe,expImpl:txe,expm1Impl:nxe,floorImpl:ixe,gatherNdImpl:rxe,gatherV2Impl:sxe,greaterImpl:oxe,greaterEqualImpl:axe,lessImpl:cxe,lessEqualImpl:lxe,linSpaceImpl:uxe,logImpl:hxe,maxImpl:dxe,maximumImpl:pxe,minimumImpl:fxe,multiplyImpl:mxe,negImpl:gxe,notEqualImpl:vxe,prodImpl:yxe,raggedGatherImpl:Sxe,raggedRangeImpl:xxe,raggedTensorToTensorImpl:Cxe,rangeImpl:_xe,rsqrtImpl:wxe,scatterImpl:Exe,sigmoidImpl:Rxe,simpleAbsImpl:jV,sliceImpl:bxe,sparseFillEmptyRowsImpl:Txe,sparseReshapeImpl:Axe,sparseSegmentReductionImpl:WV,sqrtImpl:Pxe,staticRegexReplaceImpl:Ixe,stridedSliceImpl:Mxe,stringNGramsImpl:kxe,stringSplitImpl:Lxe,stringToHashBucketFastImpl:Dxe,subImpl:Nxe,tileImpl:Oxe,topKImpl:Fxe,transposeImpl:iI,uniqueImpl:zxe}=qSe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function dr(t,e){return e===1?[t]:GV(t,e)}function Uxe(t,e){if(t===1)return"rc";let n="";for(let i=0;i<t;i++)n+=e[i],i<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bxe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Yi(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=dr("rc",this.rank),i=hn(this.rank),r=this.getOutOfBoundsCondition(n),s=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let i=0;i<=1;i++)for(let r=0;r<=1;r++){let s=`${i===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)s=`${e[e.length-1-o]},`+s;n.push(s)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let i=this.rank-2;i<this.rank;i++)n+=`${e[i]} >= ${this.enableShapeUniforms?`outShape[${i}]`:this.outputShape[i]}`,i<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),i=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${i};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qV{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);let i="";for(let r=0;r<4;r++){let s="thisRC = rc;";r%2===1&&(s+="thisRC.z += 1;"),r>1&&(s+="thisRC.y += 1;"),i+=`
        ${s}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${$xe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?tI():eI(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${i}

        setOutput(result);
      }
    `}}function $xe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Dye(["r","c","d"],"inputShape"):ih(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hxe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,i){const r=_4(n,i),s=w4(e,r,i);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=C4(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,i);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const c=this.freeTextures[s].pop();return this.usedTextures[s].push(c),c}let a;return r===ki.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===ki.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===ki.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===ki.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===ki.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,i,r){if(this.freeTextures==null)return;const s=_4(i,r),o=w4(n,s,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=C4(n,s,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=Z().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[o],u=l&&l.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[u]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Vxe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function C4(t,e,n,i,r){const s=jxe(e,i);let o;if(r){const[c,l]=Tp(t[0],t[1]);o=c*l}else{const[c,l]=Q0(t[0],t[1]);o=c*l}const a=Vxe(n,s);return o*a}function jxe(t,e){switch(t){case ki.PACKED_2X2_FLOAT32:return UV(e);case ki.PACKED_2X2_FLOAT16:return BV(e);case ki.UNPACKED_FLOAT32:return OV(e);case ki.UNPACKED_FLOAT16:return FV(e);case ki.PACKED_4X1_UNSIGNED_BYTE:return zV(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function Wxe(t){return Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?ki.PACKED_2X2_FLOAT32:ki.UNPACKED_FLOAT32:t?ki.PACKED_2X2_FLOAT16:ki.UNPACKED_FLOAT16}function _4(t,e){if(t===gs.UPLOAD)return ki.PACKED_2X2_FLOAT32;if(t===gs.RENDER||t==null)return Wxe(e);if(t===gs.DOWNLOAD||t===gs.PIXELS)return ki.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function w4(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ia{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const so="if (isnan(x)) return x;",Gxe="return x;",E4="return abs(x);",qxe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Xxe=so+`
  return (x < 0.0) ? 0.0 : x;
`,Kxe=so+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,bc="return x;",Yxe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jxe="return x;",Qxe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Zxe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eCe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tCe="return 1.0 / (1.0 + exp(-1.0 * x));";class Uc{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nCe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);const n=e.length,i=dr("rc",n),r=hn(n),s=Uxe(n,i),o=i.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iCe=Q0e,rCe=1e-7,sCe=1e-4,gy={};function oCe(t){return t in gy||(gy[t]={}),gy[t]}const aCe=Z().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),cCe=600;function lCe(){return Z().global.screen==null?1024:Z().global.screen.height*Z().global.screen.width*window.devicePixelRatio*cCe/1024/1024}class GC extends b8{nextDataId(){return GC.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Z().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof vE)n=e;else{const i=ko(Z().getNumber("WEBGL_VERSION"),e);n=new vE(i)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const i=ko(Z().getNumber("WEBGL_VERSION"));n=new vE(i),this.binaryCache=oCe(Z().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Hxe(this.gpgpu),this.numMBBeforeWarning=lCe(),this.texData=new upe(this,yc())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,i,r,s,o){const a=this.makeTensorInfo(n,i),c=this.texData.get(a.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[r,s]},c.texShape=[r,s];const l=fy(n),u=new g4(l,!1,o),h=this.runWebGLProgram(u,[a],i,[[r,s]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,i){if((Z().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Z().getBool("DEBUG"))&&this.checkNumericalProblems(e),i==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:i,values:e,usage:gs.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,i,r,s){if(Z().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:i,dtype:r,values:n,usage:gs.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:i,dtype:r,complexTensorInfos:s,slice:o,shape:a,isPacked:c}=n;if(o!=null){let d;c?d=new Uc(a,bc):d=new ia(a,bc);const p=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:r}],r),f=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),f}if(i!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return i;const l=this.activeTimers!=null;let u;l&&(u=vo());let h;if(r==="complex64"){const d=this.readSync(s.real.dataId),p=this.readSync(s.imag.dataId);h=aT(d,p)}else h=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=vo()-u),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const f=this.pendingRead.get(e);return new Promise(v=>f.push(v))}const n=this.texData.get(e),{values:i,shape:r,slice:s,dtype:o,complexTensorInfos:a,isPacked:c}=n;if(s!=null){let f;c?f=new Uc(r,bc):f=new ia(r,bc);const v=this.runWebGLProgram(f,[{dataId:e,shape:r,dtype:o}],o),g=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),g}if(i!=null)return this.convertAndCacheOnCPU(e);if(Z().getBool("DEBUG")&&!Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Z().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,u;if(o!=="complex64"&&Z().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const f=this.texData.get(u.dataId);l=this.gpgpu.createBufferFromTexture(f.texture.texture,...hy(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const f=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),v=f[0],g=f[1];h=aT(v,g)}else if(l==null)h=this.getValuesFromTexture(e);else{const f=be(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,f)}if(u!=null&&this.disposeIntermediateTensorInfo(u),l!=null){const f=this.gpgpu.gl;Ie(f,()=>f.deleteBuffer(l))}const d=this.convertAndCacheOnCPU(e,h),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(f=>f(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&yc().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,n={}){const i=this.texData.get(e),{values:r,shape:s,slice:o,dtype:a,isPacked:c,texture:l}=i;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let p;c?p=new Uc(s,bc):p=new ia(s,bc);const f=this.runWebGLProgram(p,[{dataId:e,shape:s,dtype:a}],a),v=this.readToGPU(f,n);return this.disposeIntermediateTensorInfo(f),v}if(l==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,n.customTexShape),h=yc().makeTensorFromTensorInfo(u),d=this.texData.get(u.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const i=n.map(r=>Kd(r));return Oi(e.shape,e.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Oi(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const i=e[n];if(!aye(i))throw Z().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${i} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${i} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:i,isPacked:r}=this.texData.get(e),s=be(n);if(Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(e),p=this.texData.get(d.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...hy(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(d),f}const o=Z().getBool("WEBGL_PACK")&&r===!0,a=o?fy(n):n,c=o?new w1e(a):new _1e(a),l=this.runWebGLProgram(c,[{shape:a,dtype:i,dataId:e}],"float32"),u=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,i=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=i,r=!0):this.activeTimers.push(i),this.activeTimers=i,e();const s=Uu(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),o=Uu(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(s);a.kernelMs=hpe(c),a.getExtraProfileInfo=()=>c.map((l,u)=>({name:o[u],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:vo(),endMs:null}}endTimer(e){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=vo(),e)}async getQueryTime(e){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:i}=this.texData.get(e);return i!=null&&(this.disposeData(i.real.dataId,n),this.disposeData(i.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:i,texShape:r,usage:s,isPacked:o,slice:a}=this.texData.get(e),c=a&&a.origDataId||e,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,i),this.textureManager.releaseTexture(n,r,s,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=aCe){return Z().getBool("WEBGL_CPU_FORWARD")&&e.every(i=>this.texData.get(i.dataId).texture==null&&be(i.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Eo("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return iCe(e.shape,n)}packedUnaryOp(e,n,i){const r=new Uc(e.shape,n),s=this.compileAndRun(r,[e],i);return yc().makeTensorFromTensorInfo(s)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=jV(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,E4,e.dtype);const n=new ia(e.shape,E4),i=this.compileAndRun(n,[e]);return yc().makeTensorFromTensorInfo(i)}makeTensorInfo(e,n,i){let r;if(n==="string"&&i!=null&&i.length>0&&UC(i[0])){const s=i.map(o=>Cu(o));r=this.write(s,e,n)}else r=this.write(i,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,i){return yc().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,i),this)}unpackTensor(e){const n=new nCe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new Bxe(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const i=[Zd(e.shape),...ep(e.shape)],r={dtype:e.dtype,shape:i,dataId:e.dataId},s=[Zd(n),...ep(n)],o=new qV(s,i),a=!0,c=[i],l=this.runWebGLProgram(o,[r],e.dtype,c,a);return{dataId:l.dataId,shape:n,dtype:l.dtype}}decode(e,n){const i=this.texData.get(e),{isPacked:r,shape:s,dtype:o}=i;if(n!=null){const d=be(s),p=n[0]*n[1]*4;Ee(d<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=fy(s);let c;r?c=new C1e(a):c=new x1e(a);const l=!0,u=[n??hy(a)],h=this.runWebGLProgram(c,[{shape:a,dtype:o,dataId:e}],o,u,l,n);return{dtype:o,shape:s,dataId:h.dataId}}runWebGLProgram(e,n,i,r,s=!1,o){const a=this.makeTensorInfo(e.outputShape,i),c=this.texData.get(a.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===p0.DENSE){const m=o??hy(e.outputShape);c.texShape=m.map(y=>y*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),be(a.shape)===0)return c.values=zu(a.dtype,0),a;const l=[],u=n.map(m=>{if(m.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(m.dataId);if(y.texture==null){if(!e.packedInputs&&be(m.shape)<=Z().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:m.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=m.shape)}if(this.uploadToGPU(m.dataId),!!y.isPacked!=!!e.packedInputs)m=y.isPacked?this.unpackTensor(m):this.packTensor(m),l.push(m),y=this.texData.get(m.dataId);else if(y.isPacked&&!dS(y.shape,m.shape)){const S=m,x=m.shape;m.shape=y.shape,m=this.packedReshape(m,x),l.push(m),y=this.texData.get(m.dataId),S.shape=x}return{shape:m.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:c,isUniform:!1},d=S1e(e,u,h),p=this.getAndSaveBinary(d,()=>v1e(this.gpgpu,e,u,h)),f=this.activeTimers!=null;let v;f&&(v=this.startTimer()),Z().get("ENGINE_COMPILE_ONLY")||y1e(this.gpgpu,p,u,h,r),l.forEach(m=>this.disposeIntermediateTensorInfo(m)),f&&(v=this.endTimer(v),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(v)}));const g=Z().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const m=vo();m-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=m)}if(!Z().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&s===!1){const m=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),m}return a}compileAndRun(e,n,i,r,s=!1){return i=i||n[0].dtype,this.runWebGLProgram(e,n,i,r,s)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Z().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ii(()=>{if(!Z().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Z().getBool("DEBUG");Z().set("DEBUG",!1);const n=this.abs(pl(1e-8)).dataSync()[0];if(Z().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?rCe:sCe}uploadToGPU(e){const n=this.texData.get(e),{shape:i,dtype:r,values:s,texture:o,usage:a,isPacked:c}=n;if(o!=null)return;const l=this.activeTimers!=null;let u;l&&(u=vo());let h=n.texShape;if(h==null&&(h=Rye(i,c),n.texShape=h),s!=null){const d=fy(i);let p,f=h[1],v=h[0];const g=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(c||!g)&&([f,v]=Tp(h[0],h[1])),c?p=new R1e(d,g):p=new g4(d,g);const m=g?[v,f]:h,y=this.makeTensorInfo(m,r),S=this.texData.get(y.dataId);g?S.usage=gs.PIXELS:S.usage=gs.UPLOAD,S.texShape=m,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),f,v,s);const x=[[v,f]],C=this.runWebGLProgram(p,[y],r,x,!0),E=this.texData.get(C.dataId);n.texShape=E.texShape,n.isPacked=E.isPacked,n.usage=E.usage,Z().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=E.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(y),l&&(this.uploadWaitMs+=vo()-u)}else{const d=this.acquireTexture(h,a,r,c);n.texture=d}}convertAndCacheOnCPU(e,n){const i=this.texData.get(e),{dtype:r}=i;return n!=null&&(i.values=uCe(n,r)),i.values}acquireTexture(e,n,i,r){if(this.numBytesInGPU+=this.computeBytes(e,i),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*sS(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const i=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(s){throw s}});e.push(i)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await $ve(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(IV(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:i,infLoc:r,nanLoc:s,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:c}=NV(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=i,e.infLoc=r,e.nanLoc=s,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=c}}createTensorFromGPUData(e,n,i){e.channels=e.channels||"RGBA";const{texture:r,height:s,width:o,channels:a}=e,c=yc().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=c.writeTexture(r,n,i,s,o,a);return yc().makeTensorFromDataId(l,n,i,c)}}GC.nextDataId=0;function uCe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let i=0;i<n.length;++i)n[i]=Math.round(t[i]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */vH()&&$ge("webgl",()=>new GC,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rI=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class ju{constructor(e,n,i){this.variableNames=["A","B"],this.outputShape=pr(n,i),this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class kp{constructor(e,n,i,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=pr(n,i);const s=this.outputShape.length;this.enableShapeUniforms=Yi(s);let o="";if(r)if(s===0||be(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${hn(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=dr("coords",s);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${c[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${c[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${c[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${c[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kr(t){const{inputs:e,backend:n}=t,{x:i}=e;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const hCe={kernelName:FP,backendName:"webgl",kernelFunc:Kr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bl(t){const{inputs:e,backend:n}=t,{real:i,imag:r}=e,s=n.makeTensorInfo(i.shape,"complex64"),o=n.texData.get(s.dataId),a=Kr({inputs:{x:i},backend:n}),c=Kr({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:c},s}const dCe={kernelName:k8,backendName:"webgl",kernelFunc:bl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XV="return (a < 0.) ? b * a : a;",KV=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function pCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{alpha:s}=i,o=n.makeTensorInfo([],"float32",wp(s,"float32")),a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kp(KV,r.shape,o.shape):new ju(XV,r.shape,o.shape),c=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),c}const fCe={kernelName:z8,backendName:"webgl",kernelFunc:pCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YV="return (a < 0.) ? b * a : a;",JV=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function mCe(t){const{inputs:e,backend:n}=t,{x:i,alpha:r}=e,s=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kp(JV,i.shape,r.shape):new ju(YV,i.shape,r.shape);return n.runWebGLProgram(s,[i,r],"float32")}const gCe={kernelName:H8,backendName:"webgl",kernelFunc:mCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lp="if (isnan(x)) return x;";function qt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:i}){return({inputs:r,backend:s})=>{const{x:o}=r,a=s,c=i||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),d=n(h.values,c);return a.makeTensorInfo(o.shape,c,d)}const l=Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return l?u=new Uc(o.shape,e):u=new ia(o.shape,t),a.runWebGLProgram(u,[o],c)}}function Ui({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:i=!1,cpuKernelImpl:r,dtype:s}){return({inputs:o,backend:a})=>{const{a:c,b:l}=o,u=a;if(i&&c.dtype==="complex64"){const f=u.texData.get(c.dataId),v=u.texData.get(l.dataId),[g,m]=[[f.complexTensorInfos.real,v.complexTensorInfos.real],[f.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(S=>{const[x,w]=S,C={dataId:x.dataId,dtype:x.dtype,shape:c.shape},E={dataId:w.dataId,dtype:w.dtype,shape:l.shape},b=new ju(t,c.shape,l.shape);return u.runWebGLProgram(b,[C,E],ua(x.dtype,w.dtype))}),y=bl({inputs:{real:g,imag:m},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(m),y}const h=s||ua(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||u.shouldExecuteOnCPU([c,l]))&&r!=null){const f=u.texData.get(c.dataId).values,v=u.texData.get(l.dataId).values,g=c.dtype==="string"?Qd(f):f,m=c.dtype==="string"?Qd(v):v,[y,S]=r(c.shape,l.shape,g,m,h),x=u.makeTensorInfo(S,h),w=u.texData.get(x.dataId);return w.values=y,x}const d=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return d?p=new kp(e,c.shape,l.shape,n):p=new ju(t,c.shape,l.shape),u.runWebGLProgram(p,[c,l],h)}}function f0(t,e=!1){if(t==="linear")return e?Jxe:Gxe;if(t==="relu")return e?Zxe:Xxe;if(t==="elu")return e?Qxe:qxe;if(t==="relu6")return e?eCe:Kxe;if(t==="prelu")return e?JV:YV;if(t==="leakyrelu")return e?KV:XV;if(t==="sigmoid")return e?tCe:Yxe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QV{constructor(e,n,i,r=!1,s=!1,o=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i,this.enableShapeUniforms=Yi(this.outputShape.length);const u=r?e[1]:e[2],h=Math.ceil(u/2),d=r?"i * 2, rc.y":"rc.y, i * 2",p=s?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",m="";a&&(c?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,m="result = activation(result);");const y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let S="rc.x",x="rc.x";e[0]<n[0]?S=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(x=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${S};
        int batchB = ${x};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${f[0]} * ${v[0]});
          result += (${f[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${m}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R4={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class b4{constructor(e,n,i){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=pr(n,i),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4="return a * b;";function sI(t){const{inputs:e,backend:n}=t,{a:i,b:r}=e,s=ua(i.dtype,r.dtype);if(i.dtype==="complex64"){const a=n.texData.get(i.dataId),c=n.texData.get(r.dataId),l=new b4(R4.REAL,i.shape,r.shape),u=new b4(R4.IMAG,i.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:i.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],d=n.runWebGLProgram(l,h,"float32"),p=n.runWebGLProgram(u,h,"float32"),f=bl({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}if(n.shouldExecuteOnCPU([i,r])){const a=n.texData.get(i.dataId),c=n.texData.get(r.dataId),[l,u]=mxe(i.shape,r.shape,a.values,c.values,s),h=n.makeTensorInfo(u,s),d=n.texData.get(h.dataId);return d.values=l,h}let o;return Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new kp(T4,i.shape,r.shape):o=new ju(T4,i.shape,r.shape),n.runWebGLProgram(o,[i,r],s)}const vCe={kernelName:B8,backendName:"webgl",kernelFunc:sI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yCe(t,e,n){const i=[Zd(t.shape),...ep(t.shape)],r={dtype:t.dtype,shape:i,dataId:t.dataId},s=[Zd(e),...ep(e)],o=new qV(s,i),a=!0,c=[i],l=n.runWebGLProgram(o,[r],t.dtype,c,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{shape:s}=i,o=n,a=be(r.shape),c=dpe(s,a),l=be(c);Ee(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(r.dataId);return u.isPacked&&!dS(r.shape,c)&&!(u.texture!==null&&dS(u.shape,c))?yCe(r,c,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const SCe={kernelName:j8,backendName:"webgl",kernelFunc:_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A4{constructor(e,n){this.variableNames=["x"];const{windowSize:i,batchSize:r,inSize:s,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(i/4)*4,c=i%4;let l="sumValue += dot(values, ones);";if(n!=null){const h=1/n;l=`sumValue += dot(values * ${rS(h)?h.toPrecision(2):h}, ones);`}let u="";s%i>0&&(u=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xCe{constructor(e,n){this.variableNames=["x"];const{windowSize:i,batchSize:r,inSize:s,outSize:o}=e;this.outputShape=[r,o];let a="0.0",c="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",c="min"):n==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?l="sumValue":n==="prod"?l="prodValue":n==="all"?l="allValue":n==="any"&&(l="anyValue");const u=Math.floor(i/4)*4,h=i%4;let d=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";n==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let f="";s%i>0&&(f=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CCe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],i=jC(n);e.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return e}function oh(t,e,n,i){const r=CCe(t.shape);let s=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:c,outSize:l}=r[o];let u,h;n==="mean"?u=o===0?new A4({windowSize:c,inSize:a,batchSize:t.shape[0],outSize:l},a):new A4({windowSize:c,inSize:a,batchSize:t.shape[0],outSize:l}):u=new xCe({windowSize:c,inSize:a,batchSize:t.shape[0],outSize:l},n),h=s,s=i.runWebGLProgram(u,[s],e),h.dataId!==t.dataId&&i.disposeIntermediateTensorInfo(h)}return s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Ce{constructor(e,n){this.variableNames=["A"];const i=new Array(e.length);for(let o=0;o<i.length;o++)i[o]=e[n[o]];this.outputShape=i,this.rank=i.length;const r=hn(this.rank),s=wCe(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}function wCe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(e);for(let r=0;r<t.length;r++)i[t[r]]=n[r];return i.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ECe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const i=new Array(e.length);for(let u=0;u<i.length;u++)i[u]=e[n[u]];if(this.outputShape=i,this.rank=i.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=hn(this.rank),s=GV("rc",this.rank),o=new Array(this.rank);for(let u=0;u<n.length;u++)o[n[u]]=s[u];const a=`vec2(${o.slice(-2).join()})`,c=`++${s[this.rank-1]} < ${i[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${i[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qC(t,e,n){const i=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ECe(t.shape,e):new _Ce(t.shape,e);return n.runWebGLProgram(i,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RCe(t,e,n,i){const r=e,s=t.shape.length,o=kr(r,t.shape);let a=o;const c=io(a,s),l=c!=null;let u=t;l&&(u=qC(t,c,i),a=ro(a.length,s)),Ho("sum",a,s);const[h,d]=va(u.shape,a);let p=h;n&&(p=ic(h,o));const f=be(d),g=be(t.shape)/f,m=_e({inputs:{x:u},attrs:{shape:[g,f]},backend:i}),y=UP(t.dtype),S=oh(m,y,"sum",i),x=_e({inputs:{x:S},attrs:{shape:p},backend:i});return i.disposeIntermediateTensorInfo(m),i.disposeIntermediateTensorInfo(S),l&&i.disposeIntermediateTensorInfo(u),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XC(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i;return RCe(r,s,o,n)}const bCe={kernelName:X8,backendName:"webgl",kernelFunc:XC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mr(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{perm:s}=i,o=n,a=r.shape.length,c=new Array(a);for(let u=0;u<c.length;u++)c[u]=r.shape[s[u]];let l;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,d=iI(h,r.shape,r.dtype,s,c);l=o.makeTensorInfo(c,r.dtype);const p=o.texData.get(l.dataId);p.values=d}else l=qC(r,s,o);return l}const TCe={kernelName:ege,backendName:"webgl",kernelFunc:mr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZV=1e3;function fS({a:t,b:e,transposeA:n,transposeB:i,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:c=null}){const l=t.shape.length,u=e.shape.length,h=n?t.shape[l-2]:t.shape[l-1],d=i?e.shape[u-1]:e.shape[u-2],p=n?t.shape[l-1]:t.shape[l-2],f=i?e.shape[u-2]:e.shape[u-1],v=t.shape.slice(0,-2),g=e.shape.slice(0,-2),m=be(v),y=be(g),x=pr(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);Ee(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${i} must match.`);const w=n?[m,h,p]:[m,p,h],C=i?[y,f,d]:[y,d,f],E=_e({inputs:{x:t},backend:r,attrs:{shape:w}}),b=_e({inputs:{x:e},backend:r,attrs:{shape:C}}),M=[E,b],_=Math.max(m,y),R=n?E.shape[1]:E.shape[2],L=s!=null,O=o!=null,V=c==="leakyrelu",X=c!=null?f0(c,!0):null,G=L||O||V||X!=null;let J;if((p===1||f===1)&&R>ZV&&G===!1){let ne=E,P=b;n&&(ne=mr({inputs:{x:E},backend:r,attrs:{perm:[0,2,1]}}),M.push(ne)),i&&(P=mr({inputs:{x:b},backend:r,attrs:{perm:[0,2,1]}}),M.push(P));const ee=f!==1,ge=f===1;let I=ne;ee&&(I=_e({inputs:{x:ne},backend:r,attrs:{shape:[_,R,1]}}),M.push(I));const $=f===1?2:1;let K=P;ge&&(K=_e({inputs:{x:P},backend:r,attrs:{shape:[_,1,R]}}),M.push(K));const oe=sI({inputs:{a:I,b:K},backend:r});J=XC({inputs:{x:oe},backend:r,attrs:{axis:$,keepDims:!0}}),M.push(oe)}else{const ne=ua(t.dtype,e.dtype),P=new QV(w,C,[_,p,f],n,i,L,X,O,V),ee=[E,b];if(s!=null&&ee.push(s),O&&ee.push(o),V){const ge=r.makeTensorInfo([],"float32",wp(a,"float32"));ee.push(ge),M.push(ge)}J=r.runWebGLProgram(P,ee,ne)}const D=_e({inputs:{x:J},backend:r,attrs:{shape:x}});M.push(J);for(const ne of M)r.disposeIntermediateTensorInfo(ne);return D}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ACe(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=i;return fS({a:r,b:s,transposeA:c,transposeB:l,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}const PCe={kernelName:oge,backendName:"webgl",kernelFunc:ACe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P4="return abs(x);";function ICe(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])&&i.dtype!=="complex64"){const s=n.texData.get(i.dataId),o=jV(s.values);return n.makeTensorInfo(i.shape,i.dtype,o)}let r;return Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Uc(i.shape,P4):r=new ia(i.shape,P4),n.runWebGLProgram(r,[i],i.dtype)}const MCe={kernelName:M8,backendName:"webgl",kernelFunc:ICe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kCe=so+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,LCe=qt({opSnippet:kCe}),DCe={kernelName:bpe,backendName:"webgl",kernelFunc:LCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NCe=so+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,OCe=qt({opSnippet:NCe}),FCe={kernelName:Tpe,backendName:"webgl",kernelFunc:OCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I4="return a + b;",zCe=Ui({opSnippet:I4,packedOpSnippet:I4,supportsComplex:!0,cpuKernelImpl:XSe}),UCe={kernelName:NP,backendName:"webgl",kernelFunc:zCe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BCe{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((s,o)=>`T${o}`);const i=[];this.variableNames.forEach(s=>{i.push(`float v${s} = get${s}AtOutCoords();`)});const r=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Ce{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((s,o)=>`T${o}`);const i=[];this.variableNames.forEach(s=>{i.push(`vec4 v${s} = get${s}AtOutCoords();`)});const r=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jy(t){const{inputs:e,backend:n}=t,i=e;if(i.length===1)return Kr({inputs:{x:i[0]},backend:n});if(i.length>Z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(i.length/2),l=Jy({inputs:i.slice(0,c),backend:n}),u=Jy({inputs:i.slice(c),backend:n});return Jy({inputs:[l,u],backend:n})}const r=i.map(c=>c.dtype).reduce((c,l)=>ua(c,l)),s=i.map(c=>c.shape),a=Z().getBool("WEBGL_PACK")?new $Ce(i[0].shape,s):new BCe(i[0].shape,s);return n.runWebGLProgram(a,i,r)}const HCe={kernelName:Ape,backendName:"webgl",kernelFunc:Jy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,c=kr(s,r.shape);let l=c;const u=io(l,a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),l=ro(l.length,a)),Ho("all",l,a);const[d,p]=va(h.shape,l),f=be(p),v=_e({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=oh(v,v.dtype,"all",n);let m;if(o){const y=ic(d,c);m=_e({inputs:{x:g},backend:n,attrs:{shape:y}})}else m=_e({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(h),m}const jCe={kernelName:Ppe,backendName:"webgl",kernelFunc:VCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,c=kr(s,r.shape);let l=c;const u=io(l,a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),l=ro(l.length,a)),Ho("any",l,a);const[d,p]=va(h.shape,l),f=be(p),v=_e({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=oh(v,v.dtype,"any",n);let m;if(o){const y=ic(d,c);m=_e({inputs:{x:g},backend:n,attrs:{shape:y}})}else m=_e({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(h),m}const GCe={kernelName:Ipe,backendName:"webgl",kernelFunc:WCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qCe{constructor(e,n,i){this.variableNames=["A"];const{windowSize:r,batchSize:s,outSize:o}=e;i||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const a=n==="max"?">":"<",c=i?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XCe{constructor(e,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Ee(e.length>2,()=>`Packed arg${i.charAt(0).toUpperCase()+i.slice(1)} supports only inputs with rank above 2.`);const s=e[e.length-1],o=Math.ceil(s/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,c=a.length,l=hn(c),u=dr("coords",c);let h,d;if(o===1){d=c+1;const b=hn(d);h=`
        ${b} sourceLocR = ${b}(${u.join()}, 0);
        ++${u[c-1]};
        ${b} sourceLocG = ${b}(${u.join()}, 0);
        ++${u[c-2]};
        ${b} sourceLocA = ${b}(${u.join()}, 0);
        --${u[c-1]};
        ${b} sourceLocB = ${b}(${u.join()}, 0);
        --${u[c-2]};`}else d=c,h=`
        ${l} sourceLocR = coords;
        ++${u[c-1]};
        ${l} sourceLocG = coords;
        ++${u[c-2]};
        ${l} sourceLocA = coords;
        --${u[c-1]};
        ${l} sourceLocB = coords;
        --${u[c-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],v=p.map(b=>"int "+b),g=dr("sourceLocR",d-1).concat("inIdx.r"),m=dr("sourceLocG",d-1).concat("inIdx.g"),y=dr("sourceLocB",d-1).concat("inIdx.b"),S=dr("sourceLocA",d-1).concat("inIdx.a"),x=i==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${S.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${m.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,E=r?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${E}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${u[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${u[c-2]} < ${a[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},
          sourceLocB${f}, sourceLocA${f}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(t,e,n,i=null){let r=e.shape[0],s=e.shape[1];i!=null&&(r=i.shape[0],s=i.shape[1]);const o=jC(s),a={windowSize:o,inSize:s,batchSize:r,outSize:Math.ceil(s/o)},c=new qCe(a,n,i==null),l=[e];i!=null&&l.push(i);const u=t.runWebGLProgram(c,l,"int32");if(u.shape[1]===1)return u;const h=e7(t,e,n,u);return t.disposeIntermediateTensorInfo(u),h}function t7(t,e,n,i=null){const r=i!=null?i.shape:e.shape,s=r[r.length-1],o=jC(s),a=new XCe(r,o,n,i==null),c=i==null?[e]:[e,i],l=t.runWebGLProgram(a,c,"int32");if(l.shape.length===e.shape.length){const u=t7(t,e,n,l);return t.disposeIntermediateTensorInfo(l),u}return l}function n7(t,e,n,i){const r=[n];if(Ho("arg"+i.charAt(0).toUpperCase()+i.slice(1),r,e.shape.length),!Z().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const s=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let c=e;a&&(c=t.unpackTensor(e),s.push(c));const[l,u]=va(c.shape,r),h=be(u),d=_e({inputs:{x:c},backend:t,attrs:{shape:[-1,h]}});s.push(d);const p=e7(t,d,i);s.push(p);const f=_e({inputs:{x:p},backend:t,attrs:{shape:l}});return s.forEach(v=>t.disposeIntermediateTensorInfo(v)),f}return t7(t,e,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s}=i;let o=kr(s,r.shape);const a=io(o,r.shape.length);let c=r;const l=[];a!=null&&(c=mr({inputs:{x:r},backend:n,attrs:{perm:a}}),l.push(c),o=ro(o.length,c.shape.length)),Ho("argMax",[o[0]],c.shape.length);const u=n7(n,c,o[0],"max");return l.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const YCe={kernelName:Mpe,backendName:"webgl",kernelFunc:KCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s}=i;let o=kr(s,r.shape);const a=io(o,r.shape.length);let c=r;const l=[];a!=null&&(c=mr({inputs:{x:r},backend:n,attrs:{perm:a}}),l.push(c),o=ro(o.length,c.shape.length)),Ho("argMin",[o[0]],c.shape.length);const u=n7(n,c,o[0],"min");return l.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const QCe={kernelName:kpe,backendName:"webgl",kernelFunc:JCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZCe=so+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,e_e=qt({opSnippet:ZCe}),t_e={kernelName:Lpe,backendName:"webgl",kernelFunc:e_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n_e=so+"return log(x + sqrt(x * x + 1.0));",i_e=qt({opSnippet:n_e}),r_e={kernelName:Dpe,backendName:"webgl",kernelFunc:i_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s_e=so+`
  return atan(x);
`,o_e=qt({opSnippet:s_e}),a_e={kernelName:Npe,backendName:"webgl",kernelFunc:o_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c_e=rI+`
  return atan(a, b);
`,l_e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sh+`
  return result;
`,u_e=Ui({opSnippet:c_e,packedOpSnippet:l_e}),h_e={kernelName:Fpe,backendName:"webgl",kernelFunc:u_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d_e=so+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,p_e=qt({opSnippet:d_e}),f_e={kernelName:Ope,backendName:"webgl",kernelFunc:p_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m0{constructor(e,n,i,r=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const v=n==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,m=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(v||(y="-1.0 / 1e-20"),i){const b=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${p}, ${f});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${b} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?s?g:m:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let x=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(x="avgValue / max(count, 1.0)");const w=Math.floor(o/4)*4,C=o%4,E=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${p}, ${f});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${E}
          }

          int xC = xCCorner + ${w};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${E}
          }
        }
        setOutput(${x});
      }
    `}}class oI{constructor(e,n,i,r=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,c=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,v=e.effectiveFilterWidth,g=e.padInfo.front,m=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const S=n==="avg";let x="0.0";if(S||(x="-1.0 / 1e-20"),i){const _=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${g}, ${m}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${f};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${_} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?s?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const E=Math.floor(o/4)*4,b=o%4,M=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${g}, ${m}, ${y});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${E}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${M}
            }

            int xC = xCCorner + ${E};
            if (${b===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${b===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${b===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${M}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m_e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;Z0(r,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:c}=i,l=1;Ee(Rp(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const u=Ep(r.shape,s,o,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&Ni(u.inShape,u.outShape))return Kr({inputs:{x:r},backend:n});const h=new m0(u,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const g_e={kernelName:zpe,backendName:"webgl",kernelFunc:m_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:c,dataFormat:l}=i,u=[1,1,1],h=Y0(r.shape,s,o,u,a,c,l),d=new oI(h,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const y_e={kernelName:Bpe,backendName:"webgl",kernelFunc:v_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,r=e.strideHeight,s=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=c-1-e.padInfo.top,h=l-1-e.padInfo.left,d=1/(n*i);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class x_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,i=e.filterHeight,r=e.filterWidth,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=h-1-e.padInfo.front,v=d-1-e.padInfo.top,g=p-1-e.padInfo.left,m=1/(n*i*r);this.userCode=`
      const ivec3 pads = ivec3(${f}, ${v}, ${g});
      const float avgMultiplier = float(${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C_e(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s}=e,o=s,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=i,h=[1,1,1],d=Y0(o.shape,a,c,h,l,u),p=new x_e(d);return n.runWebGLProgram(p,[r],o.dtype)}const __e={kernelName:$pe,backendName:"webgl",kernelFunc:C_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w_e(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s}=e,o=s;Z0([r,s],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=i,u=Ep(o.shape,a,c,1,l),h=new S_e(u);return n.runWebGLProgram(h,[r],o.dtype)}const E_e={kernelName:Upe,backendName:"webgl",kernelFunc:w_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_e(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:s}=e,{transposeA:o,transposeB:a}=i;return fS({a:r,b:s,transposeA:o,transposeB:a,backend:n})}const b_e={kernelName:Hpe,backendName:"webgl",kernelFunc:R_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T_e{constructor(e,n,i,r,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],pr(e,n),pr(e,i);let a="0.0";r!=null&&(pr(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";s!=null&&(pr(e,s),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A_e{constructor(e,n,i,r,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],pr(e,n),pr(e,i);let a="vec4(0.0)";r!=null&&(pr(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";s!=null&&(pr(e,s),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_e=({inputs:t,backend:e,attrs:n})=>{const{x:i,mean:r,variance:s,offset:o,scale:a}=t;Ee(r.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Ee(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Ee(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=n;c==null&&(c=.001);const l=[i,r,s];let u=null;o!=null&&(u=o.shape,l.push(o));let h=null;a!=null&&(h=a.shape,l.push(a));const d=Z().getBool("WEBGL_PACK_NORMALIZATION")?new A_e(i.shape,r.shape,s.shape,u,h,c):new T_e(i.shape,r.shape,s.shape,u,h,c);return e.runWebGLProgram(d,l,l[0].dtype)},I_e={kernelName:Efe,backendName:"webgl",kernelFunc:P_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M_e{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=hn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const i=k_e(this.rank);let r;const s=e.map((o,a)=>`sourceLoc.${uT[a]} = start[${a}] + coords.${uT[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${i}));
      }
    `}}const uT=["x","y","z","w","u","v"];function k_e(t){if(t===1)return"sourceLoc";if(t<=6)return uT.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L_e{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=hn(this.rank),i=dr("coords",this.rank),r=dr("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${s})`,a=`
      result.x = ${o};
      if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${i[this.rank-1]};
      if (++${i[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,h)=>`start[${h}]`).join()});`:e.map((u,h)=>`${r[h]} = ${i[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_e(t,e,n,i){const r=i.texData.get(t.dataId),s=i.makeTensorInfo(n,t.dtype),o=i.texData.get(s.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=XP(e,Di(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const c=i.dataRefCount.get(o.slice.origDataId)||1;return i.dataRefCount.set(o.slice.origDataId,c+1),s}function Dp(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:s,size:o}=i,[a,c]=WH(r,s,o);if(NH(r,a,c),be(c)===0)return n.makeTensorInfo(c,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.texData.get(r.dataId),d=bxe(h.values,a,c,r.shape,r.dtype);return n.makeTensorInfo(c,r.dtype,d)}const{isPacked:l}=n.texData.get(r.dataId),u=qP(r.shape,a,c);if(l||!u){const h=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new L_e(c):new M_e(c),d=[a];return n.runWebGLProgram(h,[r],r.dtype,d)}return n.uploadToGPU(r.dataId),D_e(r,a,c,n)}const N_e={kernelName:Ime,backendName:"webgl",kernelFunc:Dp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_e=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:s,crops:o}=i;Ee(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((y,S)=>y*S),c=YP(r.shape,s,a),l=JP(c.length,s.length),u=QP(r.shape,s,a),h=ZH(o,s.length),d=eV(u,o,s.length),p=[],f=_e({inputs:{x:r},backend:n,attrs:{shape:c}}),v=mr({inputs:{x:f},backend:n,attrs:{perm:l}}),g=_e({inputs:{x:v},backend:n,attrs:{shape:u}}),m=Dp({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(v),p.push(g),p.forEach(y=>n.disposeIntermediateTensorInfo(y)),m},F_e={kernelName:Vpe,backendName:"webgl",kernelFunc:O_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:s}=e,{size:o}=i,a=n.readSync(r.dataId),c=n.readSync(s.dataId),l=VV(a,c,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}const U_e={kernelName:jpe,backendName:"webgl",kernelFunc:z_e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B_e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,$_e=`
  return float(int(a.r) & int(b.r));
`;function H_e(t){const{inputs:e,backend:n}=t,{a:i,b:r}=e,s=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=Z().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([i,r])||o===1){const c=n.texData.get(i.dataId).values,l=n.texData.get(r.dataId).values,[u,h]=YSe(i.shape,r.shape,c,l,i.dtype),d=n.makeTensorInfo(h,i.dtype),p=n.texData.get(d.dataId);return p.values=u,d}let a;return s?a=new kp(B_e,i.shape,r.shape,!1):a=new ju($_e,i.shape,r.shape),n.runWebGLProgram(a,[i,r],i.dtype)}const V_e={kernelName:Wpe,backendName:"webgl",kernelFunc:H_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_e(t){const{inputs:e,backend:n}=t,{s0:i,s1:r}=e,s=n.readSync(i.dataId),o=n.readSync(r.dataId),a=pr(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const W_e={kernelName:Gpe,backendName:"webgl",kernelFunc:j_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G_e="return float(a != b);",i7=Ui({opSnippet:G_e,cpuKernelImpl:vxe,dtype:"bool"}),q_e={kernelName:ime,backendName:"webgl",kernelFunc:i7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tv(t){const{inputs:e,backend:n}=t,{input:i}=e,r=n.texData.get(i.dataId);return Kr({inputs:{x:r.complexTensorInfos.real},backend:n})}const X_e={kernelName:gme,backendName:"webgl",kernelFunc:tv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K_e="return float(int(x));";function Y_e(t,e){const n=new ia(t.shape,K_e),i=e.runWebGLProgram(n,[t],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hT(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{dtype:s}=i;if(s==="complex64"){if(r.dtype==="complex64")return Kr({inputs:{x:r},backend:n});const o=sT(r.shape),a=hT({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),c=bl({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),c}if(r.dtype==="complex64"){const o=tv({inputs:{input:r},backend:n}),a=hT({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),a}if(!mpe(r.dtype,s)){const o=Kr({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,c,l]=JSe(o,r.shape,r.dtype,s);return n.makeTensorInfo(a,c,l)}if(s==="int32")return Y_e(r,n);if(s==="bool"){const o=n.makeTensorInfo([],"bool",zu("bool",1)),c=i7({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${s}`)}const J_e={kernelName:OP,backendName:"webgl",kernelFunc:hT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M4="return ceil(x);",Q_e=qt({opSnippet:M4,packedOpSnippet:M4,cpuKernelImpl:QSe}),Z_e={kernelName:qpe,backendName:"webgl",kernelFunc:Q_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ewe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class twe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{clipValueMin:s,clipValueMax:o}=i;let a;Z().getBool("WEBGL_PACK_CLIP")?a=new twe(r.shape):a=new ewe(r.shape);const c=[[s],[o]];return n.runWebGLProgram(a,[r],r.dtype,c)}const iwe={kernelName:Xpe,backendName:"webgl",kernelFunc:nwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rwe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function swe(t){const{inputs:e,backend:n}=t,{x:i}=e,r=n.texData.get(i.dataId),s=new rwe(i.shape),o=[k4(i,r.complexTensorInfos.real),k4(i,r.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}const owe={kernelName:L8,backendName:"webgl",kernelFunc:swe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class awe{constructor(e){this.outputShape=[],this.outputShape=Vu(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const i=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];i.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,s=n[n.length-1];i.push(`else setOutput(getT${r}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${i.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cwe{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Vu(e,n);const i=this.outputShape,r=i.length,s=hn(r),o=dr("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((v,g)=>`T${g}`);const c=new Array(e.length-1);c[0]=e[0][n];for(let v=1;v<c.length;v++)c[v]=c[v-1]+e[v][n];const l=a[n],u=a.slice(-2),h=a.join();let d=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${u.join()}));
        }`;for(let v=1;v<c.length;v++){const g=c[v-1];d+=`
        if (${l} < ${c[v]}  && ${l} >= ${c[v-1]}) {
          return getChannel(
            getT${v}(${vy(a,l,g)}),
            vec2(${vy(u,l,g)}));
        }`}const p=c.length,f=c[c.length-1];d+=`
        return getChannel(
          getT${p}(${vy(a,l,f)}),
          vec2(${vy(u,l,f)}));`,this.userCode=`
      float getValue(${a.map(v=>"int "+v)}) {
        ${d}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${i[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${i[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${i[r-2]} &&
            ${o[r-1]} < ${i[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function vy(t,e,n){const i=t.indexOf(e);return t.map((s,o)=>o===i?`${s} - ${n}`:s).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KC(t){const{inputs:e,backend:n}=t,{input:i}=e,r=n.texData.get(i.dataId);return Kr({inputs:{x:r.complexTensorInfos.imag},backend:n})}const lwe={kernelName:Ife,backendName:"webgl",kernelFunc:KC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cg(t,e,n){const i=t[0].dtype;if(i==="complex64"){const p=t.map(y=>tv({inputs:{input:y},backend:n})),f=t.map(y=>KC({inputs:{input:y},backend:n})),v=cg(p,e,n),g=cg(f,e,n),m=bl({inputs:{real:v,imag:g},backend:n});return p.forEach(y=>n.disposeIntermediateTensorInfo(y)),f.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),m}let r=n.shouldExecuteOnCPU(t);if(i==="string"&&(r=!0),r){const p=t.map(x=>{const C=[-1,be(x.shape.slice(e))];return _e({inputs:{x},backend:n,attrs:{shape:C}})}),f=p.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),v=Vu(p.map(x=>x.shape),1),g=p[0].shape[0]===1,m=ZSe(f,v,i,g),y=Vu(t.map(x=>x.shape),e),S=n.makeTensorInfo(y,i,m);return p.forEach(x=>n.disposeIntermediateTensorInfo(x)),S}const s=t.filter(p=>be(p.shape)>0),o=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){const p=o?new ia(t[0].shape,bc):new Uc(t[0].shape,bc);return n.runWebGLProgram(p,t,i)}const a=Z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){const p=[];for(let v=0;v<s.length;v+=a){const g=s.slice(v,v+a);p.push(cg(g,e,n))}const f=cg(p,e,n);for(const v of p)n.disposeIntermediateTensorInfo(v);return f}if(o){const p=new cwe(s.map(f=>f.shape),e);return n.runWebGLProgram(p,s,i)}const{tensors2D:c,outShape:l}=uwe(s,e,n),u=new awe(c.map(p=>p.shape)),h=n.runWebGLProgram(u,c,i);c.forEach(p=>n.disposeIntermediateTensorInfo(p));const d=_e({inputs:{x:h},attrs:{shape:l},backend:n});return n.disposeIntermediateTensorInfo(h),d}function uwe(t,e,n){const i=Vu(t.map(s=>s.shape),e);return{tensors2D:t.map(s=>_e({inputs:{x:s},attrs:{shape:[-1,be(s.shape.slice(e))]},backend:n})),outShape:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r7(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i,s=kr(r,e[0].shape)[0],o=e.map(l=>l.shape);qH(o,s);const a=Vu(e.map(l=>l.shape),s);if(be(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(l=>be(l.shape)>0);return c.length===1?Kr({inputs:{x:c[0]},backend:n}):cg(c,s,n)}const hwe={kernelName:Kpe,backendName:"webgl",kernelFunc:r7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s7{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,g=e.dataFormat==="channelsLast",m=g?1:2,y=g?2:3,S=g?3:1;let x="",w="";i&&(r?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:s?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:x=`
          float activation(float x) {
            ${i}
          }
        `,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${m}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${f}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${f}) *
                    getW(wR, wC, ${f}, d2);
              } else {
                dotProd +=
                    getX(batch, ${f}, xR, xC) *
                    getW(wR, wC, ${f}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2),
                getW(wR, wC, ${f} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1),
                  getX(batch, xR, xC, ${f} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC),
                  getX(batch, ${f} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${w}
        setOutput(result);
      }
    `}}class dwe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,i=e.padInfo.top,r=e.padInfo.left,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,h=e.filterDepth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${i}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${f}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${f}) *
                  getW(wF, wR, wC, ${f}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1),
                  getX(batch, xF, xR, xC, ${f} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2),
                  getW(wF, wR, wC, ${f} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o7{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Yi(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,u=e.filterWidth,h=u;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)d+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;d+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)d+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(h+1)/2;g++){const m=g*2;if(d+=`
           xC = xCCorner + ${m*c};
           `,a===1){if(m<u&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }
               `,c===1&&m>0?d+=`
                 xC${m} = vec4(xTexelC${m-2}.zw, xTexelC${m}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${m} = vec4(previous.zw, xTexelC${m}.xy);
                   } else {
                     xC${m} = vec4(0.0, 0.0, xTexelC${m}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 xC${m} = xTexelC${m};
                 `,m+1<u)){const y=o%2===0?MP(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                     xTexelC${m+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${m+1}.zw = vec2(0.0);
                     }
                     xTexelC${m+1}Ready = 1;
                   }
                   `,c>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${m+1} = vec4(previous.zw, xTexelC${m+1}.xy);
                     } else {
                      xC${m+1} = vec4(0.0, 0.0, xTexelC${m+1}.xy);
                     }
                     `:d+=`
                     xC${m+1} = vec4(xTexelC${m}.zw, xTexelC${m+1}.xy);
                     `):y===1?d+=`
                     xC${m+1} = xTexelC${m};
                     `:d+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                       xTexelC${m+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${m+1}.zw = vec2(0.0);
                       }
                       xTexelC${m+1}Ready = 1;
                     }

                     xC${m+1} = xTexelC${m+1};
                     `}}else m<u&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${m+1}Ready == 0) {
                   xTexelC${m+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${m+1}.zw = vec2(0.0);
                   }
                   xTexelC${m+1}Ready = 1;
                 }

                 xC${m} = vec4(xTexelC${m}.zw, xTexelC${m+1}.zw);
               `,m+1<u&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${m+1} = vec4(xTexelC${m+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                   xTexelC${m+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m+1}.zw = vec2(0.);
                   }
                   xTexelC${m+1}Ready = 1;
                 }

                 xC${m} = vec4(
                   xTexelC${m}.xy, xTexelC${m+1}.xy);
               `,m+1<u&&(d+=`
                   xC${m+1} = vec4(xTexelC${m}.zw, xTexelC${m+1}.zw);
                 `)));m<u&&(d+=`
             wTexel = getW(r, ${m}, d1, d2);
             dotProd += xC${m}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${m}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,m+1<u&&(d+=`
               wTexel = getW(r, ${m+1}, d1, d2);
               dotProd += xC${m+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${m+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let p="",f="";i&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${i}
         }`:s?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${i}
         }`:p=`vec4 activation(vec4 x) {
           ${i}
         }`,f="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${f}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pwe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);const{dataFormat:i}=n,r=vr(),s=i==="channelsLast",o=s?1:2,a=s?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${u};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mS(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function a7({x:t,filter:e,convInfo:n,backend:i,bias:r=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const c=t.shape,l=i.texData.get(t.dataId),u=n.inChannels,h=c[0]*c[1]*c[2],d=n.outChannels,p=n.dataFormat==="channelsLast",f=!1,v=!1;let g;const m=[];if(s!=null){const x=mS(s.shape,p);x!=null&&(s=_e({inputs:{x:s},backend:i,attrs:{shape:x}}),m.push(s))}if(r!=null){const x=mS(r.shape,p);x!=null&&(r=_e({inputs:{x:r},backend:i,attrs:{shape:x}}),m.push(r))}if(!((h===1||d===1)&&u>ZV)&&l.isPacked&&p&&l.texture!=null&&c[2]%2!==0&&Ni(l.shape.slice(-3),c.slice(-3))){const x=c[0]*c[1]*(c[2]+1),w={dataId:t.dataId,shape:[1,x,n.inChannels],dtype:t.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,Ee(dS(l.shape,w.shape),()=>`packed reshape ${l.shape} to ${w.shape} isn't free`);const E=_e({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(E);const b=fS({a:w,b:E,backend:i,transposeA:f,transposeB:v,bias:r,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),M=i.texData.get(b.dataId);Ee(M.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=C,M.shape=n.outShape,g=Kr({inputs:{x:b},backend:i}),g.shape=n.outShape,m.push(b)}else{const x=n.outHeight*n.outWidth,w=_e({inputs:{x:t},backend:i,attrs:{shape:p?[n.batchSize,x,n.inChannels]:[n.batchSize,n.inChannels,x]}}),C=_e({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}}),E=fS({a:p?w:C,b:p?C:w,transposeA:!p,transposeB:v,backend:i,bias:r,activation:a,preluActivationWeights:s,leakyreluAlpha:o});g=_e({inputs:{x:E},backend:i,attrs:{shape:n.outShape}}),m.push(w),m.push(C),m.push(E)}for(const x of m)i.disposeIntermediateTensorInfo(x);return g}function c7({x:t,filter:e,convInfo:n,backend:i,bias:r=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:c,filterHeight:l,inChannels:u,outWidth:h,outHeight:d,dataFormat:p}=n,f=p==="channelsLast",v=c*l*u,g=d*h,m=[n.batchSize,v,g],y=!0,S=!1,x=[];if(s!=null){const D=mS(s.shape,f);D!=null&&(s=_e({inputs:{x:s},backend:i,attrs:{shape:D}}),x.push(s))}if(r!=null){const D=mS(r.shape,f);D!=null&&(r=_e({inputs:{x:r},backend:i,attrs:{shape:D}}),x.push(r))}const w=_e({inputs:{x:e},backend:i,attrs:{shape:[1,v,be(e.shape)/v]}});x.push(w);const C=new pwe(m,n),E=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],b=i.runWebGLProgram(C,[t],"float32",E),M=_e({inputs:{x:b},backend:i,attrs:{shape:m}});x.push(b),x.push(M);const _=r!=null,R=s!=null,L=a==="leakyrelu",O=a?f0(a,!0):null,V=new QV(f?M.shape:w.shape,f?w.shape:M.shape,f?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],y,S,_,O,R,L),X=f?[M,w]:[w,M];if(r&&X.push(r),R&&X.push(s),L){const D=i.makeTensorInfo([],"float32",wp(o,"float32"));X.push(D),x.push(D)}const G=i.runWebGLProgram(V,X,"float32"),J=_e({inputs:{x:G},backend:i,attrs:{shape:n.outShape}});x.push(G);for(const D of x)i.disposeIntermediateTensorInfo(D);return J}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=i,h=bp(c),d=$o(r.shape,s.shape,o,l,a,u,!1,h);let p;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))p=a7({x:r,filter:s,convInfo:d,backend:n});else if(d.strideWidth<=2&&h==="channelsLast"&&Z().getBool("WEBGL_EXP_CONV")){const v=new o7(d),g=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(v,[r,s],"float32",g)}else if(Z().getBool("WEBGL_CONV_IM2COL"))p=c7({x:r,filter:s,convInfo:d,backend:n});else{const v=new s7(d);p=n.runWebGLProgram(v,[r,s],"float32")}const f=_e({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}const mwe={kernelName:Ype,backendName:"webgl",kernelFunc:fwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,i=e.strideWidth,r=e.padInfo.top,s=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class vwe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,r=e.strideHeight,s=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,c=i-1-e.padInfo.left,l=o?1:2,u=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ywe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,i=e.strideHeight,r=e.strideWidth,s=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${s};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${i} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Swe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,i=e.filterHeight,r=e.filterWidth,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,c=n-1-e.padInfo.front,l=i-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${i}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${i} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:s}=e,{strides:o,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=i,h=bp(c),d=$o(r.shape,u,o,1,a,l,!1,h),p=new gwe(d);return n.runWebGLProgram(p,[r,s],"float32")}const Cwe={kernelName:Jpe,backendName:"webgl",kernelFunc:xwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _we{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Yi(this.outputShape.length);const n=e.filterHeight,i=e.filterWidth,r=n-1-e.padInfo.top,s=i-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            int wCPerm = ${i} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wwe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:s}=e,{inputShape:o,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=i,h=bp(l),d=$o(o,s.shape,a,1,c,u,!1,h);if(Z().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[d.strideHeight,d.strideWidth]],f=new _we(d);return n.runWebGLProgram(f,[r,s],"float32",p)}else{const p=new vwe(d);return n.runWebGLProgram(p,[r,s],"float32")}}const Ewe={kernelName:Qpe,backendName:"webgl",kernelFunc:wwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dilations:c}=i,l=J0(r.shape,s.shape,o,c,a),u=new dwe(l);return n.runWebGLProgram(u,[r,s],"float32")}const bwe={kernelName:Zpe,backendName:"webgl",kernelFunc:Rwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Twe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:s}=e,{strides:o,pad:a,filterShape:c}=i,l=J0(r.shape,c,o,1,a),u=new ywe(l);return n.runWebGLProgram(u,[r,s],"float32")}const Awe={kernelName:efe,backendName:"webgl",kernelFunc:Twe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pwe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:s}=e,{pad:o,strides:a,inputShape:c}=i,l=J0(c,s.shape,a,1,o),u=new Swe(l);return n.runWebGLProgram(u,[r,s],"float32")}const Iwe={kernelName:tfe,backendName:"webgl",kernelFunc:Pwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mwe=Lp+`
  return cos(x);
`,kwe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${sh}
  return result;
`,Lwe=qt({opSnippet:Mwe,packedOpSnippet:kwe}),Dwe={kernelName:nfe,backendName:"webgl",kernelFunc:Lwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nwe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Owe=qt({opSnippet:Nwe}),Fwe={kernelName:ife,backendName:"webgl",kernelFunc:Owe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zwe{constructor(e,n,i,r,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,c,l]=e,[u]=n,[h,d]=i;this.outputShape=[u,h,d,l];const p=r==="bilinear"?1:0,[f,v]=[`${a-1}.0`,`${c-1}.0`],[g,m,y]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[S,x,w]=d>1?[`${(c-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${m};
        float width_scale = ${x};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${f} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uwe=t=>{const{inputs:e,backend:n,attrs:i}=t,{image:r,boxes:s,boxInd:o}=e,{cropSize:a,method:c,extrapolationValue:l}=i,u=new zwe(r.shape,s.shape,a,c,l);return n.runWebGLProgram(u,[r,s,o],"float32")},Bwe={kernelName:ofe,backendName:"webgl",kernelFunc:Uwe};var g0;(function(t){t.Prod="*",t.Sum="+"})(g0||(g0={}));class L4{constructor(e,n,i,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,o=this.op===g0.Prod?"1.0":"0.0",a=i?o:`getX(${D4(s,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let l="",u="";i?(l=r?`end != ${c-1}`:"end != 0",u=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${c}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${hn(s)} coords = getOutputCoords();
        int end = ${N4(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${u};
          ${N4(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${D4(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function D4(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function N4(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(t,e,n,i,r,s){const o=e.shape.length,a=io([i],o);let c=e;a!=null&&(c=mr({inputs:{x:e},backend:n,attrs:{perm:a}}));const l=ro(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${i}`);const u=c.shape[l];let h=Kr({inputs:{x:c},backend:n});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){const p=new L4(t,c.shape,!1,s),f=[[d]],v=h;h=n.runWebGLProgram(p,[h],h.dtype,f),n.disposeIntermediateTensorInfo(v)}if(r){const d=new L4(t,c.shape,r,s),p=h;h=n.runWebGLProgram(d,[h],h.dtype),n.disposeIntermediateTensorInfo(p)}if(a!=null){const d=jP(a),p=mr({inputs:{x:h},backend:n,attrs:{perm:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $we(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,exclusive:o,reverse:a}=i;return l7(g0.Prod,r,n,s,o,a)}const Hwe={kernelName:rfe,backendName:"webgl",kernelFunc:$we};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,exclusive:o,reverse:a}=i;return l7(g0.Sum,r,n,s,o,a)}const jwe={kernelName:sfe,backendName:"webgl",kernelFunc:Vwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:s}=e,{size:o,binaryOutput:a}=i;if(r.shape.length===1){const c=n.readSync(r.dataId),l=n.readSync(s.dataId),u=VV(c,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,u)}else if(r.shape.length===2){const c=n.bufferSync(r),l=n.bufferSync(s),u=KSe(c,l,o,a);return n.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Gwe={kernelName:afe,backendName:"webgl",kernelFunc:Wwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qwe{constructor(e,n,i){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=i,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockSize:s,dataFormat:o}=i,a=r.shape[0],c=o==="NHWC"?r.shape[1]:r.shape[2],l=o==="NHWC"?r.shape[2]:r.shape[3],u=o==="NHWC"?r.shape[3]:r.shape[1],h=c*s,d=l*s,p=u/(s*s),f=o==="NHWC"?[a,h,d,p]:[a,p,h,d],v=new qwe(f,s,o);return n.runWebGLProgram(v,[r],r.dtype)}const Kwe={kernelName:cfe,backendName:"webgl",kernelFunc:Xwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u7{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Yi(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,c=e.outChannels/e.inChannels;let l="",u="";i&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:s?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:l=`
          float activation(float x) {
            ${i}
          }
        `,u="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h7{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Yi(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,c=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,d=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<h;m++)p+=`
          vec4 xTexelC${m*2};
          int xTexelC${m*2}Ready;
          vec4 xTexelC${m*2+1};
          int xTexelC${m*2+1}Ready;
          vec4 xC${m};`;p+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let m=0;m<h;m++)p+=`
          xTexelC${m*2} = vec4(0.0);
          xTexelC${m*2}Ready = 0;
          xTexelC${m*2+1} = vec4(0.0);
          xTexelC${m*2+1}Ready = 0;
          xC${m} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let m=0;m<(d+1)/2;m++){const y=m*2;if(p+=`
          xC = xCCorner + ${y*l};
          `,c===1){if(y<h&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,l===1&&y>0?p+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<h)){const S=a%2===0?MP(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${S};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,l>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:p+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):S===1?p+=`
                    xC${y+1} = xTexelC${y};
                    `:p+=`
                    xCOffset = xC + ${S};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<h&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<h&&(p+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<h&&(p+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<h&&(p+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let f="",v="";i&&(r?f=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:s?f=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:f=`vec4 activation(vec4 x) {
          ${i}
        }`,v="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ywe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dilations:c,dimRoundingMode:l}=i;let u=c;u==null&&(u=[1,1]),Ee(Rp(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=$o(r.shape,s.shape,o,u,a,l,!0);let d;Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new h7(h):d=new u7(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[r,s],"float32",p)}const Jwe={kernelName:lfe,backendName:"webgl",kernelFunc:Ywe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,i=e.strideWidth,r=e.padInfo.top,s=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Zwe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,r=e.strideHeight,s=e.strideWidth,o=n-1-e.padInfo.top,a=i-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eEe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:s}=e,{strides:o,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=i,h=$o(r.shape,u,o,a,c,l,!0),d=new Qwe(h);return n.runWebGLProgram(d,[r,s],"float32")}const tEe={kernelName:ufe,backendName:"webgl",kernelFunc:eEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nEe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:s}=e,{strides:o,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=i,h=$o(u,s.shape,o,a,c,l,!0),d=new Zwe(h);return n.runWebGLProgram(d,[r,s],"float32")}const iEe={kernelName:hfe,backendName:"webgl",kernelFunc:nEe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rEe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sEe(t){const{inputs:e,backend:n}=t,{x:i}=e,r=[...i.shape,...i.shape],s=be(i.shape),o=_e({inputs:{x:i},backend:n,attrs:{shape:[s]}}),a=new rEe(s),c=n.runWebGLProgram(a,[o],o.dtype),l=_e({inputs:{x:c},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),l}const oEe={kernelName:dfe,backendName:"webgl",kernelFunc:sEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aEe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:i,padInfo:r,strideHeight:s,strideWidth:o,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:u}=e,{top:h,left:d}=r;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${i}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cEe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dilations:c}=i,l=AH(r.shape,s.shape,o,a,"NHWC",c);let u;const h=new aEe(l);u=n.runWebGLProgram(h,[r,s],"float32");const d=_e({inputs:{x:u},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(u),d}const lEe={kernelName:pfe,backendName:"webgl",kernelFunc:cEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uEe(t){const{inputs:e,backend:n,attrs:i}=t,{equation:r}=i,s=e,{allDims:o,summedDims:a,idDims:c}=lV(r,s.length);hV(o.length,c,s);const{path:l,steps:u}=dV(a,c),h=u.length;let d=null,p=o.length;const f=[];for(let v=0;v<h;++v){for(const g of u[v]){const{permutationIndices:m,expandDims:y}=uV(p,c[g]);let S;pV(m)?S=s[g]:(S=mr({inputs:{x:s[g]},backend:n,attrs:{perm:m}}),f.push(S));const x=S.shape.slice();for(let w=0;w<y.length;++w)x.splice(y[w],0,1);Ni(S.shape,x)||(S=_e({inputs:{x:S},backend:n,attrs:{shape:x}}),f.push(S)),d===null?d=S:(d=sI({inputs:{a:S,b:d},backend:n}),f.push(d))}v<h-1&&(l[v]>=0&&(d=XC({inputs:{x:d},backend:n,attrs:{axis:l[v]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const v of f)v!==d&&n.disposeIntermediateTensorInfo(v);return d}const hEe={kernelName:ffe,backendName:"webgl",kernelFunc:uEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dEe="return (x >= 0.0) ? x : (exp(x) - 1.0);",pEe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,fEe=qt({opSnippet:dEe,packedOpSnippet:pEe}),mEe={kernelName:N8,backendName:"webgl",kernelFunc:fEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gEe="return (b >= 0.0) ? a : a * (b + 1.0);",vEe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,yEe=t=>{const{inputs:e,backend:n}=t,{dy:i,y:r}=e,s=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kp(vEe,i.shape,r.shape):new ju(gEe,i.shape,r.shape);return n.runWebGLProgram(s,[i,r],i.dtype)},SEe={kernelName:mfe,backendName:"webgl",kernelFunc:yEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xEe=`
  return vec4(equal(a, b));
`,CEe="return float(a == b);",_Ee=Ui({opSnippet:CEe,packedOpSnippet:xEe,dtype:"bool",cpuKernelImpl:exe}),wEe={kernelName:vfe,backendName:"webgl",kernelFunc:_Ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EEe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${iV};
  float a1 = ${rV};
  float a2 = ${sV};
  float a3 = ${oV};
  float a4 = ${aV};
  float a5 = ${cV};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,REe=qt({opSnippet:EEe}),bEe={kernelName:gfe,backendName:"webgl",kernelFunc:REe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TEe=Lp+`
  return exp(x);
`,AEe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,d7=qt({opSnippet:TEe,packedOpSnippet:AEe,cpuKernelImpl:txe,dtype:"float32"}),PEe={kernelName:yfe,backendName:"webgl",kernelFunc:d7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dT(t){const{inputs:e,attrs:n,backend:i}=t,{dim:r}=n,{input:s}=e,o=s.shape.length,a=s.shape.slice();let c=r;return r<0&&(Ee(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+r+1),a.splice(c,0,1),_e({inputs:{x:s},backend:i,attrs:{shape:a}})}const IEe={kernelName:Sfe,backendName:"webgl",kernelFunc:dT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O4="return exp(x) - 1.0;",MEe=qt({opSnippet:O4,packedOpSnippet:O4,cpuKernelImpl:nxe}),kEe={kernelName:xfe,backendName:"webgl",kernelFunc:MEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F4{constructor(e,n,i){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const s=i?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=i?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(t,e,n){const i=n.texData.get(t.dataId),r=be(t.shape),s=t.shape[t.shape.length-1],o=r/s,a=_e({inputs:{x:t},backend:n,attrs:{shape:[o,s]}}),c=a.shape,l=new F4("real",c,e),u=new F4("imag",c,e),h=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:c},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:c}],d=n.runWebGLProgram(l,h,"float32"),p=n.runWebGLProgram(u,h,"float32"),f=bl({inputs:{real:d,imag:p},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p);const v=_e({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(f),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LEe(t){const{inputs:e,backend:n}=t,{input:i}=e;return p7(i,!1,n)}const DEe={kernelName:Cfe,backendName:"webgl",kernelFunc:LEe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NEe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nv(t){const{backend:e,attrs:n}=t,{shape:i,value:r}=n;let{dtype:s}=n;if(s=s||X0(r),s==="string"){const o=_i(s,be(i));return o.fill(r),e.makeTensorInfo(i,s,o)}else{const o=new NEe(i,r),a=[[r]];return e.runWebGLProgram(o,[],s,a)}}const OEe={kernelName:O8,backendName:"webgl",kernelFunc:nv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FEe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zEe={kernelName:_fe,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,i=e,r=new FEe(n.shape);return i.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z4="return floor(x);",UEe=qt({opSnippet:z4,packedOpSnippet:z4,cpuKernelImpl:ixe}),BEe={kernelName:wfe,backendName:"webgl",kernelFunc:UEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ee=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,HEe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,VEe=Ui({opSnippet:$Ee,packedOpSnippet:HEe,dtype:"int32"}),jEe={kernelName:F8,backendName:"webgl",kernelFunc:VEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WEe{constructor(e){this.variableNames=["A"];const n=vr(),[i,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${i}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GEe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=vr(),[i,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${i}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEe={kernelName:rge,backendName:"webgl",kernelFunc:XEe};let Lh,yE=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function XEe(t){const{inputs:e,backend:n,attrs:i}=t;let{pixels:r}=e;const{numChannels:s}=i,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,l]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[l,c],h=[l,c,s];if(a||o){const v=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Lh==null||v!==yE)&&(yE=v,Lh=document.createElement("canvas").getContext("2d",{willReadFrequently:yE})),Lh.canvas.width=c,Lh.canvas.height=l,Lh.drawImage(r,0,0,c,l),r=Lh.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=gs.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),r);const p=Z().getBool("WEBGL_PACK")?new GEe(h):new WEe(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KEe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s,bias:o,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i,v=bp(u),g=$o(r.shape,s.shape,c,h,l,d,!1,v);let m;const y=[],S=o!=null,x=a!=null,w=p==="leakyrelu",C=()=>{const b=[r,s],M=(_,R)=>{if(R==="NCHW"&&_.shape.length===1&&_.shape[0]!==1){const L=_e({inputs:{x:_},backend:n,attrs:{shape:[_.shape[0],1,1]}});return y.push(L),L}return _};if(S&&b.push(M(o,u)),x&&b.push(M(a,u)),w){const _=n.makeTensorInfo([],"float32",wp(f,"float32"));b.push(_),y.push(_)}return b};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))m=a7({x:r,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else if(g.strideWidth<=2&&v==="channelsLast"&&Z().getBool("WEBGL_EXP_CONV")){const b=p?f0(p,!0):null,M=new o7(g,S,b,x,w),_=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],R=C();m=n.runWebGLProgram(M,R,"float32",_)}else if(Z().getBool("WEBGL_CONV_IM2COL"))m=c7({x:r,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const b=p?f0(p,!1):null,M=new s7(g,S,b,x,w),_=C();m=n.runWebGLProgram(M,_,"float32")}const E=_e({inputs:{x:m},backend:n,attrs:{shape:g.outShape}});return y.push(m),y.forEach(b=>n.disposeIntermediateTensorInfo(b)),E}const YEe={kernelName:age,backendName:"webgl",kernelFunc:KEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JEe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s,bias:o,preluActivationWeights:a}=e,{strides:c,pad:l,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=i,f=[];let v=u;v==null&&(v=[1,1]),Ee(Rp(c,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${v}'`);const g=$o(r.shape,s.shape,c,v,l,h,!0),m=Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,y=d?f0(d,m):null,S=[r,s],x=o!=null,w=a!=null,C=d==="leakyrelu";if(x&&S.push(o),w&&S.push(a),C){const _=n.makeTensorInfo([],"float32",wp(p,"float32"));S.push(_),f.push(_)}let E;m?E=new h7(g,x,y,w,C):E=new u7(g,x,y,w,C);const b=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],M=n.runWebGLProgram(E,S,"float32",b);return f.forEach(_=>n.disposeIntermediateTensorInfo(_)),M}const QEe={kernelName:cge,backendName:"webgl",kernelFunc:JEe};class ZEe{constructor(e,n,i,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=i;const s=hn(i.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eRe(t){const{inputs:e,backend:n}=t,{params:i,indices:r}=e,s=r.shape,o=s[s.length-1],a=be(i.shape),[c,l,u,h]=DH(i,r),d=_e({inputs:{x:r},backend:n,attrs:{shape:[l,o]}}),p=_e({inputs:{x:i},backend:n,attrs:{shape:[be(i.shape)/u,u]}});if(n.shouldExecuteOnCPU([i,r])||i.dtype==="string"){const m=n.readSync(r.dataId),y=n.bufferSync(i),S=rxe(m,y,i.dtype,l,o,u,h,i.shape,a);return n.makeTensorInfo(c,i.dtype,S.values)}const f=new ZEe(o,h,[l,u],i.shape),v=n.runWebGLProgram(f,[p,d],p.dtype),g=_e({inputs:{x:v},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),g}const tRe={kernelName:bfe,backendName:"webgl",kernelFunc:eRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nRe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const i=hn(this.rank),r=iRe(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function iRe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let r=0;r<t.length;r++)r===2?i.push("index"):i.push(`${n[r]}`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,indices:s}=e,{axis:o,batchDims:a}=i,c=kr(o,r.shape)[0];if(Z().get("DEBUG")){const y=n.readSync(s.dataId),S=r.shape[c];for(let x=0;x<y.length;++x){const w=y[x];Ee(w<=S-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${S-1}]`)}}const l=AV(r,s,c,a),u=be(s.shape),h=[],d=_e({inputs:{x:r},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),p=_e({inputs:{x:s},backend:n,attrs:{shape:[l.batchSize,u/l.batchSize]}});h.push(d),h.push(p);const f=[l.batchSize,l.outerSize,u/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const y=n.bufferSync(p),S=n.bufferSync(d),x=sxe(S,y,f);return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(l.outputShape,x.dtype,x.values)}const v=new nRe(d.shape,f),g=n.runWebGLProgram(v,[d,p],d.dtype);h.push(g);const m=_e({inputs:{x:g},backend:n,attrs:{shape:l.outputShape}});return h.forEach(y=>n.disposeIntermediateTensorInfo(y)),m}const rRe={kernelName:Rfe,backendName:"webgl",kernelFunc:f7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sRe="return float(a > b);",oRe=`
  return vec4(greaterThan(a, b));
`,aRe=Ui({opSnippet:sRe,packedOpSnippet:oRe,cpuKernelImpl:oxe,dtype:"bool"}),cRe={kernelName:Tfe,backendName:"webgl",kernelFunc:aRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lRe="return float(a >= b);",uRe=`
  return vec4(greaterThanEqual(a, b));
`,hRe=Ui({opSnippet:lRe,packedOpSnippet:uRe,dtype:"bool",cpuKernelImpl:axe}),dRe={kernelName:Afe,backendName:"webgl",kernelFunc:hRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pRe(t){const{inputs:e,backend:n}=t,{input:i}=e;return p7(i,!0,n)}const fRe={kernelName:Pfe,backendName:"webgl",kernelFunc:pRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mRe="return float(!isnan(x) && !isinf(x));",gRe=qt({opSnippet:mRe,dtype:"bool"}),vRe={kernelName:Mfe,backendName:"webgl",kernelFunc:gRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yRe="return float(isinf(x));",SRe=qt({opSnippet:yRe,dtype:"bool"}),xRe={kernelName:kfe,backendName:"webgl",kernelFunc:SRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CRe="return float(isnan(x));",_Re=qt({opSnippet:CRe,dtype:"bool"}),wRe={kernelName:Lfe,backendName:"webgl",kernelFunc:_Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ERe="return float(a < b);",RRe=`
  return vec4(lessThan(a, b));
`,bRe=Ui({opSnippet:ERe,packedOpSnippet:RRe,cpuKernelImpl:cxe,dtype:"bool"}),TRe={kernelName:Dfe,backendName:"webgl",kernelFunc:bRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ARe="return float(a <= b);",PRe=`
  return vec4(lessThanEqual(a, b));
`,IRe=Ui({opSnippet:ARe,packedOpSnippet:PRe,cpuKernelImpl:lxe,dtype:"bool"}),MRe={kernelName:Nfe,backendName:"webgl",kernelFunc:IRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kRe(t){const{backend:e,attrs:n}=t,{start:i,stop:r,num:s}=n,o=uxe(i,r,s);return e.makeTensorInfo([o.length],"float32",o)}const LRe={kernelName:Ofe,backendName:"webgl",kernelFunc:kRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DRe=Lp+`
  return x < 0.0 ? 0./0. : log(x);
`,NRe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,ORe=qt({opSnippet:DRe,packedOpSnippet:NRe,cpuKernelImpl:hxe}),FRe={kernelName:Ffe,backendName:"webgl",kernelFunc:ORe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zRe=Lp+`
  return log(1.0 + x);
`,URe=qt({opSnippet:zRe}),BRe={kernelName:zfe,backendName:"webgl",kernelFunc:URe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Re="return float(a >= 1.0 && b >= 1.0);",HRe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,VRe=Ui({opSnippet:$Re,packedOpSnippet:HRe,dtype:"bool"}),jRe={kernelName:Ufe,backendName:"webgl",kernelFunc:VRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WRe="return float(!(x >= 1.0));",GRe=qt({opSnippet:WRe}),qRe={kernelName:Bfe,backendName:"webgl",kernelFunc:GRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XRe="return float(a >= 1.0 || b >= 1.0);",KRe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,YRe=Ui({opSnippet:XRe,packedOpSnippet:KRe,dtype:"bool"}),JRe={kernelName:$fe,backendName:"webgl",kernelFunc:YRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QRe{constructor(e,n,i,r,s){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let c;const l=`float(${i}) + float(${r}) * sum`;s===.5?c=`inversesqrt(${l})`:s===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZRe{constructor(e,n,i,r,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let c;const l=`float(${i}) + float(${r}) * sum`;s===.5?c=`inversesqrt(${l})`:s===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ebe=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{depthRadius:s,bias:o,alpha:a,beta:c}=i,l=Z().getBool("WEBGL_PACK_NORMALIZATION")?new ZRe(r.shape,s,o,a,c):new QRe(r.shape,s,o,a,c);return n.runWebGLProgram(l,[r],r.dtype)},tbe={kernelName:Hfe,backendName:"webgl",kernelFunc:ebe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nbe{constructor(e,n,i,r,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=i,this.alpha=r,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${i});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ibe=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r,y:s,dy:o}=e,{depthRadius:a,bias:c,alpha:l,beta:u}=i,h=new nbe(r.shape,a,c,l,u);return n.runWebGLProgram(h,[r,s,o],r.dtype)},rbe={kernelName:Vfe,backendName:"webgl",kernelFunc:ibe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sbe(t,e,n,i){const r=be(e),o=be(t.shape)/r,a=_e({inputs:{x:t},attrs:{shape:[o,r]},backend:i}),c=oh(a,t.dtype,"max",i),l=_e({inputs:{x:c},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m7(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reductionIndices:s,keepDims:o}=i,a=r.shape.length,c=kr(s,r.shape);let l=c;const u=io(l,a),h=u!=null,d=n.shouldExecuteOnCPU([r]);let p=r;if(h){if(d){const S=n.texData.get(p.dataId).values,x=new Array(a);for(let E=0;E<x.length;E++)x[E]=r.shape[u[E]];const w=iI(S,r.shape,r.dtype,u,x);p=n.makeTensorInfo(x,r.dtype);const C=n.texData.get(p.dataId);C.values=w}else p=qC(r,u,n);l=ro(l.length,a)}Ho("max",l,a);const[f,v]=va(p.shape,l);let g=f;o&&(g=ic(f,c));let m;if(d){const S=n.texData.get(p.dataId).values,x=dxe(S,be(v),g,r.dtype);m=n.makeTensorInfo(g,r.dtype);const w=n.texData.get(m.dataId);w.values=x}else m=sbe(p,v,g,n);return h&&n.disposeIntermediateTensorInfo(p),m}const obe={kernelName:jfe,backendName:"webgl",kernelFunc:m7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const abe=rI+`
  return max(a, b);
`,cbe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sh+`
  return result;
`,lbe=Ui({opSnippet:abe,packedOpSnippet:cbe,cpuKernelImpl:pxe}),ube={kernelName:U8,backendName:"webgl",kernelFunc:lbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hbe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;Z0(r,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:c}=i,l=1;Ee(Rp(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const u=Ep(r.shape,s,o,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&Ni(u.inShape,u.outShape))return Kr({inputs:{x:r},backend:n});const h=new m0(u,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const dbe={kernelName:Wfe,backendName:"webgl",kernelFunc:hbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pbe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:s,strides:o,pad:a,dataFormat:c,dimRoundingMode:l}=i,u=[1,1,1],h=Y0(r.shape,s,o,u,a,l,c),d=new oI(h,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const fbe={kernelName:qfe,backendName:"webgl",kernelFunc:pbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mbe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,i=e.strideWidth,r=e.dilationHeight,s=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=s-1-e.padInfo.top,c=o-1-e.padInfo.left,l=s*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class gbe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,i=e.strideHeight,r=e.strideWidth,s=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=c-1-e.padInfo.front,d=l-1-e.padInfo.top,p=u-1-e.padInfo.left,f=c*l*u-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${f} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s}=e,o=s,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=i,h=[1,1,1],d=Y0(o.shape,a,c,h,l,u),p=new oI(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),v=new gbe(d),g=n.runWebGLProgram(v,[r,f],o.dtype);return n.disposeIntermediateTensorInfo(f),g}const ybe={kernelName:Xfe,backendName:"webgl",kernelFunc:vbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sbe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s,output:o}=e,a=s;Z0([s,o],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=i,d=Ep(a.shape,c,l,1,u,h),p=!0,f=new m0(d,"max",p),v=n.runWebGLProgram(f,[a],a.dtype),g=new mbe(d),m=n.runWebGLProgram(g,[r,v],a.dtype);return n.disposeIntermediateTensorInfo(v),m}const xbe={kernelName:Gfe,backendName:"webgl",kernelFunc:Sbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cbe(t,e,n,i){let r=new m0(n,"max",!1);const s=i.runWebGLProgram(r,[t],"float32");r=new m0(n,"max",!0,!0,e);const o=i.runWebGLProgram(r,[t],"float32");return[s,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _be={kernelName:Kfe,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:r,strides:s,pad:o,includeBatchInIndex:a}=e,c=n;Ee(i.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const l=[1,1];Ee(Rp(s,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`);const u=Ep(i.shape,r,s,l,o),[h,d]=Cbe(i,a,u,c);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wbe(t,e,n,i){const r=be(e),o=be(t.shape)/r,a=_e({inputs:{x:t},attrs:{shape:[o,r]},backend:i}),c=oh(a,"float32","mean",i),l=_e({inputs:{x:c},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ebe={kernelName:Yfe,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{keepDims:r,axis:s}=e,o=n,a=i.shape.length,c=kr(s,i.shape);let l=c;const u=io(l,a),h=u!=null,d=o.shouldExecuteOnCPU([i]),p=[];let f=i;if(h){if(d){const x=o.texData.get(f.dataId).values,w=new Array(a);for(let b=0;b<w.length;b++)w[b]=i.shape[u[b]];const C=iI(x,i.shape,i.dtype,u,w);f=o.makeTensorInfo(w,i.dtype);const E=o.texData.get(f.dataId);E.values=C}else f=qC(i,u,o);p.push(f),l=ro(l.length,a)}Ho("sum",l,a);const[v,g]=va(f.shape,l);let m=v;r&&(m=ic(v,c));const y=wbe(f,g,m,o);for(const S of p)o.disposeIntermediateTensorInfo(S);return y}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rbe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,c=kr(s,r.shape);let l=c;const u=io(l,a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),l=ro(l.length,r.shape.length)),Ho("min",l,a);const[d,p]=va(h.shape,l),f=be(p),v=_e({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=oh(v,v.dtype,"min",n);let m;if(o){const y=ic(d,c);m=_e({inputs:{x:g},backend:n,attrs:{shape:y}})}else m=_e({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(h),m}const bbe={kernelName:Jfe,backendName:"webgl",kernelFunc:Rbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tbe=rI+`
  return min(a, b);
`,Abe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sh+`
  return result;
`,Pbe=Ui({opSnippet:Tbe,packedOpSnippet:Abe,cpuKernelImpl:fxe}),Ibe={kernelName:Qfe,backendName:"webgl",kernelFunc:Pbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mbe{constructor(e,n,i){this.variableNames=["x"],this.outputShape=n.map((u,h)=>u[0]+e[h]+u[1]);const r=e.length,s=hn(r),o=n.map(u=>u[0]).join(","),a=n.map((u,h)=>u[0]+e[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=i==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kbe{constructor(e,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((f,v)=>f[0]+e[v]+f[1]);const r=e.length,s=hn(r),o=n.map(f=>f[0]).join(","),a=n.map((f,v)=>f[0]+e[v]).join(","),c=dr("rc",r),l=dr("source",r),u=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,d=i==="reflect"?0:1;let p="";if(r===1){const f=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;p=`
        ${s} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const f=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;p=`
        ${s} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${f}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${c[r-1]} += 1;
          if(${u}) {
            ${f}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lbe=({inputs:t,backend:e,attrs:n})=>{const{x:i}=t,{paddings:r,mode:s}=n,o=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kbe(i.shape,r,s):new Mbe(i.shape,r,s);return e.runWebGLProgram(o,[i],i.dtype)},Dbe={kernelName:Zfe,backendName:"webgl",kernelFunc:Lbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nbe=`if (b == 0.0) return NAN;
  return mod(a, b);`,Obe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+sh+`
  return result;
`,Fbe=Ui({opSnippet:Nbe,packedOpSnippet:Obe}),zbe={kernelName:eme,backendName:"webgl",kernelFunc:Fbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ube{constructor(e,n,i){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,i],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bbe=`
if (a == b) {
  return 1.0;
};
return a / b;`,$be=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,g7=Ui({opSnippet:Bbe,packedOpSnippet:$be,checkOutOfBounds:!0}),Hbe={kernelName:D8,backendName:"webgl",kernelFunc:g7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U4="return a - b;",v7=Ui({opSnippet:U4,packedOpSnippet:U4,supportsComplex:!0,cpuKernelImpl:Nxe}),Vbe={kernelName:K8,backendName:"webgl",kernelFunc:v7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{dim:s}=i,o=kr([s],r.shape),a=m7({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),c=ic(a.shape,o),l=_e({inputs:{x:a},backend:n,attrs:{shape:c}}),u=v7({inputs:{a:r,b:l},backend:n}),h=d7({inputs:{x:u},backend:n}),d=XC({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=_e({inputs:{x:d},backend:n,attrs:{shape:c}}),f=g7({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const jbe={kernelName:Fme,backendName:"webgl",kernelFunc:y7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wbe(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{numSamples:s,seed:o,normalized:a}=i,c=a?r:y7({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),l=c.shape[0],u=c.shape[1],h=new Ube(l,u,s),d=[[o]],p=n.runWebGLProgram(h,[c],"int32",d);return a||n.disposeIntermediateTensorInfo(c),p}const Gbe={kernelName:tme,backendName:"webgl",kernelFunc:Wbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qbe=so+`
  return -x;
`,Xbe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Kbe(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])){const s=n.texData.get(i.dataId),[o,a]=gxe(s.values,i.shape,i.dtype);return n.makeTensorInfo(a,i.dtype,o)}let r;return Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Uc(i.shape,Xbe):r=new ia(i.shape,qbe),n.runWebGLProgram(r,[i],i.dtype)}const Ybe={kernelName:nme,backendName:"webgl",kernelFunc:Kbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jbe=ave;function Qbe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c}=i,l=n.readSync(r.dataId),u=n.readSync(s.dataId),{selectedIndices:h}=Jbe(l,u,o,a,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Zbe={kernelName:rme,backendName:"webgl",kernelFunc:Qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eTe=cve;function tTe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=i,u=n.readSync(r.dataId),h=n.readSync(s.dataId),{selectedIndices:d,validOutputs:p}=eTe(u,h,o,a,c,l);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const nTe={kernelName:sme,backendName:"webgl",kernelFunc:tTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iTe=lve;function rTe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=i,u=n.readSync(r.dataId),h=n.readSync(s.dataId),d=o,p=a,f=c,v=l,{selectedIndices:g,selectedScores:m}=iTe(u,h,d,p,f,v);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}const sTe={kernelName:ome,backendName:"webgl",kernelFunc:rTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oTe{constructor(e,n,i,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${i}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aTe=t=>{const{inputs:e,backend:n,attrs:i}=t,{indices:r}=e,{dtype:s,depth:o,onValue:a,offValue:c}=i,l=be(r.shape),u=new oTe(l,o,a,c),h=_e({inputs:{x:r},backend:n,attrs:{shape:[l]}}),d=n.runWebGLProgram(u,[h],s);n.disposeIntermediateTensorInfo(h);const p=[...r.shape,o],f=_e({inputs:{x:d},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(d),f},cTe={kernelName:cme,backendName:"webgl",kernelFunc:aTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gS(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="complex64"){const r=tv({inputs:{input:i},backend:n}),s=gS({inputs:{x:r},backend:n}),o=KC({inputs:{input:i},backend:n}),a=gS({inputs:{x:o},backend:n}),c=bl({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),c}else return nv({attrs:{shape:i.shape,dtype:i.dtype,value:i.dtype==="string"?"":0},backend:n})}const lTe={kernelName:J8,backendName:"webgl",kernelFunc:gS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(i.dtype==="complex64"){const r=tv({inputs:{input:i},backend:n}),s=S7({inputs:{x:r},backend:n}),o=KC({inputs:{input:i},backend:n}),a=gS({inputs:{x:o},backend:n}),c=bl({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),c}else return nv({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:n})}const uTe={kernelName:ame,backendName:"webgl",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hTe(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i;if(e.length===1)return dT({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const s=e[0].shape,o=e[0].dtype;e.forEach(u=>{T8(s,u.shape,"All tensors passed to stack must have matching shapes"),Ee(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(u=>{const h=dT({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(h),h}),l=r7({inputs:c,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),l}const dTe={kernelName:lme,backendName:"webgl",kernelFunc:hTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pTe{constructor(e,n,i){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((l,u)=>l[0]+e[u]+l[1]);const r=e.length,s=hn(r),o=n.map(l=>l[0]).join(","),a=n.map((l,u)=>l[0]+e[u]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fTe{constructor(e,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((v,g)=>v[0]+e[g]+v[1]);const r=e.length,s=hn(r),o=n.map(v=>v[0]).join(","),a=n.map((v,g)=>v[0]+e[g]).join(","),c=dr("rc",r),l=dr("source",r),u=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,d=[`${s} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${u}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let v=0,g=r===1?2:4;v<g;v++)f+=`
        ${d[v]}
        if (${p}) {
          result[${v}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${v}] = getChannel(getX(${l.join()}), ${h});
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{paddings:s,constantValue:o}=i;if(be(r.shape)===0){const l=s.map((u,h)=>u[0]+r.shape[h]+u[1]);return nv({backend:n,attrs:{shape:l,value:o,dtype:r.dtype}})}const a=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fTe(r.shape,s,o):new pTe(r.shape,s,o),c=[[o]];return n.runWebGLProgram(a,[r],r.dtype,c)},mTe={kernelName:ume,backendName:"webgl",kernelFunc:x7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gTe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,vTe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+sh+`
  return result;
`,yTe=Ui({opSnippet:gTe,packedOpSnippet:vTe}),STe={kernelName:$8,backendName:"webgl",kernelFunc:yTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xTe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,c=[],l=kr(s,r.shape);let u=l;const h=io(u,a);let d=r;h!=null&&(d=mr({inputs:{x:r},backend:n,attrs:{perm:h}}),u=ro(u.length,a),c.push(d)),Ho("prod",u,a);let p;if(n.shouldExecuteOnCPU([d])){const f=n.texData.get(d.dataId).values,{outVals:v,outShape:g,outDtype:m}=yxe(d.shape,d.dtype,f,u);p=n.makeTensorInfo(g,m,v)}else{const[f,v]=va(d.shape,u),g=be(v),m=_e({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),y=UP(r.dtype),S=oh(m,y,"prod",n);p=_e({inputs:{x:S},backend:n,attrs:{shape:f}}),c.push(m),c.push(S)}if(o){c.push(p);const f=ic(p.shape,l);p=_e({inputs:{x:p},backend:n,attrs:{shape:f}})}return c.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const CTe={kernelName:hme,backendName:"webgl",kernelFunc:xTe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Te(t){const{inputs:e,backend:n,attrs:i}=t,{paramsNestedSplits:r,paramsDenseValues:s,indices:o}=e,{outputRaggedRank:a}=i,c=r.map(m=>n.readSync(m.dataId)),l=r.map(m=>m.shape),u=n.readSync(s.dataId),h=n.readSync(o.dataId),[d,p,f]=Sxe(c,l,u,s.shape,s.dtype,h,o.shape,a),v=d.map(m=>n.makeTensorInfo([m.length],"int32",m)),g=n.makeTensorInfo(f,s.dtype,p);return v.concat([g])}const wTe={kernelName:dme,backendName:"webgl",kernelFunc:_Te};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ETe(t){const{inputs:e,backend:n}=t,{starts:i,limits:r,deltas:s}=e,o=n.readSync(i.dataId),a=n.readSync(r.dataId),c=n.readSync(s.dataId),[l,u]=xxe(o,i.shape,i.dtype,a,r.shape,c,s.shape),h=n.makeTensorInfo([l.length],"int32",l),d=n.makeTensorInfo([u.length],i.dtype,u);return[h,d]}const RTe={kernelName:pme,backendName:"webgl",kernelFunc:ETe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bTe(t){const{inputs:e,backend:n,attrs:i}=t,{shape:r,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=i,l=n.readSync(r.dataId),u=n.readSync(s.dataId),h=n.readSync(o.dataId),d=a.map(g=>n.readSync(g.dataId)),p=a.map(g=>g.shape),[f,v]=Cxe(l,r.shape,u,s.shape,s.dtype,h,o.shape,d,p,c);return n.makeTensorInfo(f,s.dtype,v)}const TTe={kernelName:fme,backendName:"webgl",kernelFunc:bTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7=t=>{const{backend:e,attrs:n}=t,{start:i,stop:r,step:s,dtype:o}=n,a=_xe(i,r,s,o);return e.makeTensorInfo([a.length],o,a)},ATe={kernelName:mme,backendName:"webgl",kernelFunc:C7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PTe="return 1.0 / x;",ITe=qt({opSnippet:PTe}),MTe={kernelName:vme,backendName:"webgl",kernelFunc:ITe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kTe=so+`
  return (x < 0.0) ? 0.0 : x;
`,LTe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,DTe=qt({opSnippet:kTe,packedOpSnippet:LTe}),NTe={kernelName:V8,backendName:"webgl",kernelFunc:DTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OTe=so+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,FTe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zTe=qt({opSnippet:OTe,packedOpSnippet:FTe}),UTe={kernelName:W8,backendName:"webgl",kernelFunc:zTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BTe{constructor(e,n,i,r,s){this.variableNames=["A"],this.outputShape=[];const[o,a,c,l]=e;this.outputShape=[o,n,i,l];const u=[r&&n>1?a-1:a,r&&i>1?c-1:c],h=[r&&n>1?n-1:n,r&&i>1?i-1:i];let d;s?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Te{constructor(e,n,i,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,c,l]=e;this.outputShape=[o,n,i,l];const u=[r&&n>1?a-1:a,r&&i>1?c-1:c],h=[r&&n>1?n-1:n,r&&i>1?i-1:i];let d;s?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${i-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HTe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:s,halfPixelCenters:o,size:a}=i,[c,l]=a,u=Z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new $Te(r.shape,c,l,s,o):new BTe(r.shape,c,l,s,o);return n.runWebGLProgram(u,[r],"float32")}const VTe={kernelName:xme,backendName:"webgl",kernelFunc:HTe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jTe{constructor(e,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,s]=n,[,o,a]=e,c=[i&&o>1?r-1:r,i&&a>1?s-1:s],l=[i&&o>1?o-1:o,i&&a>1?a-1:a],u=c[0]/l[0],h=c[1]/l[1],d=1/u,p=1/h,f=Math.ceil(d)*2+2,v=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WTe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:s}=e,{alignCorners:o}=i,a=new jTe(s.shape,r.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const GTe={kernelName:Cme,backendName:"webgl",kernelFunc:WTe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qTe{constructor(e,n,i,r,s){this.variableNames=["A"],this.outputShape=[];const[o,a,c,l]=e;this.outputShape=[o,n,i,l];const u=[r&&n>1?a-1:a,r&&i>1?c-1:c],h=[r&&n>1?n-1:n,r&&i>1?i-1:i],d=r?"0.5":"0.0";let p;s?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XTe{constructor(e,n,i,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,c,l]=e;this.outputShape=[o,n,i,l];const u=[r&&n>1?a-1:a,r&&i>1?c-1:c],h=[r&&n>1?n-1:n,r&&i>1?i-1:i],d=r?"0.5":"0.0";let p;s?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${i-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KTe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:s,halfPixelCenters:o,size:a}=i,[c,l]=a,u=Z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new XTe(r.shape,c,l,s,o):new qTe(r.shape,c,l,s,o);return n.runWebGLProgram(u,[r],r.dtype)}const YTe={kernelName:yme,backendName:"webgl",kernelFunc:KTe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JTe{constructor(e,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,s]=n,[,o,a]=e,c=[i&&o>1?r-1:r,i&&a>1?s-1:s],l=[i&&o>1?o-1:o,i&&a>1?a-1:a],u=c[0]/l[0],h=c[1]/l[1],d=1/u,p=1/h,f=Math.ceil(d)*2+2,v=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${i} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${i} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QTe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:s}=e,{alignCorners:o}=i,a=new JTe(s.shape,r.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const ZTe={kernelName:Sme,backendName:"webgl",kernelFunc:QTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e2e{constructor(e,n){this.variableNames=["x"];const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);if(this.outputShape=e,i===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,s=e.map((a,c)=>r(c)).join(","),o=hn(i);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t2e{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);this.outputShape=e;const r=dr("rc",i),s=`${r[i-1]} + 1 < ${this.outputShape[i-1]}`,o=`${r[i-2]} + 1 < ${this.outputShape[i-2]}`,a=hn(i);i===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${s}){
            result.g = ${l(r.slice())};
          }
          if(${o}) {
            result.b = ${u(r.slice())};
            if(${s}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(f){return d(f)}function l(f){return f[i-1]="("+f[i-1]+" + 1)",d(f)}function u(f){return f[i-2]="("+f[i-2]+" + 1)",d(f)}function h(f){return f[i-1]="("+f[i-1]+" + 1)",f[i-2]="("+f[i-2]+" + 1)",d(f)}function d(f){const v=e.map((y,S)=>p(S,f)),g=v.join(","),m=v.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${m}))`}function p(f,v){return n.indexOf(f)!==-1&&e[f]!==1?`${e[f]} - ${v[f]} - 1`:`${v[f]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{dims:s}=i,o=r.shape.length,a=kr(s,r.shape);if(o===0)return Kr({inputs:{x:r},backend:n});const c=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t2e(r.shape,a):new e2e(r.shape,a);return n.runWebGLProgram(c,[r],r.dtype)}const i2e={kernelName:_me,backendName:"webgl",kernelFunc:n2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r2e{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const i=e[1],r=e[2];this.outputShape=e;let s="";typeof n=="number"?s=`float outputValue = ${n.toFixed(2)};`:s=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${i}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s2e={kernelName:sge,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,{radians:r,fillValue:s,center:o}=e,a=n,c=new r2e(i.shape,s),[l,u]=QH(o,i.shape[1],i.shape[2]),h=[[l,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(c,[i],i.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o2e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,a2e=qt({opSnippet:o2e}),c2e={kernelName:wme,backendName:"webgl",kernelFunc:a2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l2e="return inversesqrt(x);",u2e=qt({opSnippet:l2e,cpuKernelImpl:wxe}),h2e={kernelName:Eme,backendName:"webgl",kernelFunc:u2e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aI{constructor(e,n,i,r,s,o,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=hn(s.length),u=hn(o.length);let h="";i===1?h="i":i===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let v="";c&&(v="coords[0], coords[1]");const g=`getDefaultValue(${v})`,m=n>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d2e{constructor(e,n,i,r,s,o,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const l=hn(s.length),u=hn(o.length);let h="";i===1?h="i":i===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let v="";c&&(v="coords[0], coords[1]");const g=`getDefaultValue(${v})`,m=n>1?"strides[j]":"strides",y=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${m};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${f};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2e(t){const{inputs:e,backend:n,attrs:i}=t,{indices:r,updates:s}=e,{shape:o}=i,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=VC(s,r,o),d=[h/l,l];if(h===0)return n.makeTensorInfo(o,r.dtype);const p=_e({inputs:{x:r},backend:n,attrs:{shape:[c,a]}}),f=_e({inputs:{x:s},backend:n,attrs:{shape:[c,l]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;Z().getBool("WEBGL_PACK")?g=new d2e(c,a,p.shape.length,f.shape.length,u,d):g=new aI(c,a,p.shape.length,f.shape.length,u,d);const m=n.runWebGLProgram(g,[f,p,v],f.dtype),y=_e({inputs:{x:m},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),y}const f2e={kernelName:Rme,backendName:"webgl",kernelFunc:p2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m2e{constructor(e,n,i,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,i];const s="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=Z().getNumber("WEBGL_VERSION")===2?s:o,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g2e(t){const{inputs:e,backend:n,attrs:i}=t,{sortedSequence:r,values:s}=e,{side:o}=i,a=new m2e(r.shape[0],r.shape[1],s.shape[1],o),c=[[r.shape[1]]];return n.runWebGLProgram(a,[r,s],"int32",c)}const v2e={kernelName:Tme,backendName:"webgl",kernelFunc:g2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y2e{constructor(e,n,i){this.variableNames=["c","a","b"],this.outputShape=n;let r,s;if(i>4)throw Error(`Where for rank ${i} is not yet supported`);if(i===1)s="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let u=0;u<n.length;u++)l.push(`${a[u]}`),u<e&&c.push(`${a[u]}`);r=c.join(),s=l.join()}const o=hn(i);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2e(t){const{inputs:e,backend:n}=t,{condition:i,t:r,e:s}=e,o=new y2e(i.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[i,r,s],ua(r.dtype,s.dtype))}const x2e={kernelName:Ame,backendName:"webgl",kernelFunc:S2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C2e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${tV};
  float scale = ${nV};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,_2e=qt({opSnippet:C2e}),w2e={kernelName:Pme,backendName:"webgl",kernelFunc:_2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E2e=Lp+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,R2e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,b2e=qt({opSnippet:E2e,packedOpSnippet:R2e,cpuKernelImpl:Rxe}),T2e={kernelName:G8,backendName:"webgl",kernelFunc:b2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,P2e=qt({opSnippet:A2e}),I2e={kernelName:Lme,backendName:"webgl",kernelFunc:P2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M2e=Lp+`
  return sin(x);
`,k2e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${sh}
  return result;
`,L2e=qt({opSnippet:M2e,packedOpSnippet:k2e}),D2e={kernelName:Mme,backendName:"webgl",kernelFunc:L2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N2e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,O2e=qt({opSnippet:N2e}),F2e={kernelName:kme,backendName:"webgl",kernelFunc:O2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z2e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,U2e=qt({opSnippet:z2e}),B2e={kernelName:Dme,backendName:"webgl",kernelFunc:U2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $2e=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:s,paddings:o}=i;Ee(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((m,y)=>m*y),c=[[0,0]];c.push(...o);for(let m=1+s.length;m<r.shape.length;++m)c.push([0,0]);const l=[],u=x7({inputs:{x:r},backend:n,attrs:{paddings:c,constantValue:0}}),h=YP(u.shape,s,a,!1),d=JP(h.length,s.length,!1),p=QP(u.shape,s,a,!1),f=_e({inputs:{x:u},backend:n,attrs:{shape:h}}),v=mr({inputs:{x:f},backend:n,attrs:{perm:d}}),g=_e({inputs:{x:v},backend:n,attrs:{shape:p}});return l.push(u),l.push(f),l.push(v),l.forEach(m=>n.disposeIntermediateTensorInfo(m)),g},H2e={kernelName:Nme,backendName:"webgl",kernelFunc:$2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V2e(t){const{inputs:e,backend:n}=t,{indices:i,values:r,denseShape:s,defaultValue:o}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${i.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(i.dataId),c=n.readSync(r.dataId),l=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[h,d,p,f,v]=Txe(a,i.shape,i.dtype,c,r.dtype,l,u);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(g=>Number(g)))),n.makeTensorInfo([v.length],i.dtype,new Int32Array(v))]}const j2e={kernelName:zme,backendName:"webgl",kernelFunc:V2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2e(t){const{inputs:e,backend:n}=t,{inputIndices:i,inputShape:r,newShape:s}=e;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(i.dataId),c=Array.from(n.readSync(s.dataId)),[l,u,h]=Axe(a,i.shape,i.dtype,o,c);return[n.makeTensorInfo(u,i.dtype,l),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}const G2e={kernelName:Ume,backendName:"webgl",kernelFunc:W2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2e(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:s}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);const o=n.readSync(i.dataId),a=n.readSync(r.dataId),c=n.readSync(s.dataId),[l,u]=WV(o,i.shape,i.dtype,a,c,!0);return n.makeTensorInfo(u,i.dtype,l)}const X2e={kernelName:Bme,backendName:"webgl",kernelFunc:q2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K2e(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:s}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);const o=n.readSync(i.dataId),a=n.readSync(r.dataId),c=n.readSync(s.dataId),[l,u]=WV(o,i.shape,i.dtype,a,c);return n.makeTensorInfo(u,i.dtype,l)}const Y2e={kernelName:$me,backendName:"webgl",kernelFunc:K2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2e(t){const{inputs:e,backend:n,attrs:i}=t,{sparseIndices:r,sparseValues:s,defaultValue:o}=e,{outputShape:a}=i,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=VC(s,r,a),p=!1;if(s.dtype==="string"){const m=n.bufferSync(r),y=n.bufferSync(s),S=Kd(n.readSync(o.dataId)[0]),x=Exe(m,y,a,d,u,l,c,h,S,p);return n.makeTensorInfo(a,x.dtype,x.values)}const f=new aI(l,c,r.shape.length,s.shape.length,h,[d,1],p),v=n.runWebGLProgram(f,[s,r,o],s.dtype),g=_e({inputs:{x:v},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(v),g}const Q2e={kernelName:Hme,backendName:"webgl",kernelFunc:J2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z2e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{numOrSizeSplits:s,axis:o}=i,a=kr(o,r.shape)[0],c=fV(r,s,a),l=r.shape.length,u=new Array(l).fill(0),h=r.shape.slice();return c.map(d=>{const p=[...h];p[a]=d;const f=Dp({inputs:{x:r},backend:n,attrs:{begin:u,size:p}});return u[a]+=d,f})}const eAe={kernelName:Ome,backendName:"webgl",kernelFunc:Z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B4="return sqrt(x);",tAe=qt({opSnippet:B4,packedOpSnippet:B4,cpuKernelImpl:Pxe}),nAe={kernelName:q8,backendName:"webgl",kernelFunc:tAe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iAe="return x * x;",rAe=qt({opSnippet:iAe}),sAe={kernelName:jme,backendName:"webgl",kernelFunc:rAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $4="return (a - b) * (a - b);",oAe=Ui({opSnippet:$4,packedOpSnippet:$4}),aAe={kernelName:Vme,backendName:"webgl",kernelFunc:oAe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cAe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const s=n.readSync(r.dataId),o=Qd(s),a=Ixe(o,"string",i);return n.makeTensorInfo(r.shape,"string",a)}const lAe={kernelName:Wme,backendName:"webgl",kernelFunc:cAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uAe({inputs:t,attrs:e,backend:n}){const{x:i}=t,r=so+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,s=new ia(i.shape,r);return n.runWebGLProgram(s,[i],i.dtype)}const hAe={kernelName:Q8,backendName:"webgl",kernelFunc:uAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dAe{constructor(e,n,i){this.variableNames=["x"],this.outputShape=i;const r=i.length,s=hn(i.length),o=hn(i.length);let a="";if(r===1)a="coords * strides + begin";else{let c=0;a=i.map((l,u)=>(c++,i.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${c-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${e});
      ${s} strides = ${s}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pAe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:s,end:o,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=i,{finalShapeSparse:p,finalShape:f,isIdentity:v,sliceDim0:g,isSimpleSlice:m,begin:y,end:S,strides:x}=GH(r.shape,s,o,a,c,l,u,h,d);let w;if(v)w=_e({inputs:{x:r},backend:n,attrs:{shape:f}});else if(g||m){Ee(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const E=OH(y,S,x),b=Dp({inputs:{x:r},backend:n,attrs:{begin:y,size:E}});w=_e({inputs:{x:b},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(b)}else if(n.shouldExecuteOnCPU([r])){const b=n.readSync(r.dataId),M=Oi(r.shape,r.dtype,b),_=Mxe(p,M,x,y);w=n.makeTensorInfo(f,r.dtype,_.values)}else{const b=new dAe(y,x,p);w=n.runWebGLProgram(b,[r],r.dtype)}const C=_e({inputs:{x:w},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(w),C}const fAe={kernelName:Gme,backendName:"webgl",kernelFunc:pAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mAe(t){const{inputs:e,backend:n,attrs:i}=t,{separator:r,nGramWidths:s,leftPad:o,rightPad:a,padWidth:c,preserveShortSequences:l}=i,{data:u,dataSplits:h}=e,d=n.readSync(u.dataId),p=n.readSync(h.dataId),[f,v]=kxe(d,p,r,s,o,a,c,l);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",v)]}const gAe={kernelName:qme,backendName:"webgl",kernelFunc:mAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vAe(t){const{inputs:e,backend:n,attrs:i}=t,{skipEmpty:r}=i,{input:s,delimiter:o}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),c=n.readSync(o.dataId)[0],[l,u,h]=Lxe(a,c,r),d=u.length;return[n.makeTensorInfo([d,2],"int32",l),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const yAe={kernelName:Xme,backendName:"webgl",kernelFunc:vAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SAe(t){const{inputs:e,backend:n,attrs:i}=t,{numBuckets:r}=i,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=Dxe(o,r);return n.makeTensorInfo(s.shape,"int32",a)}const xAe={kernelName:Kme,backendName:"webgl",kernelFunc:SAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CAe="return tan(x);",_Ae=qt({opSnippet:CAe}),wAe={kernelName:Yme,backendName:"webgl",kernelFunc:_Ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EAe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,RAe=qt({opSnippet:EAe}),bAe={kernelName:Jme,backendName:"webgl",kernelFunc:RAe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TAe(t){const{inputs:e,backend:n,attrs:i}=t,{tensor:r,indices:s,updates:o}=e,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=VC(o,s,r.shape),d=[h/l,l];if(h===0)return n.makeTensorInfo(r.shape,s.dtype);const p=_e({inputs:{x:s},backend:n,attrs:{shape:[c,a]}}),f=_e({inputs:{x:o},backend:n,attrs:{shape:[c,l]}}),v=_e({inputs:{x:r},backend:n,attrs:{shape:d}}),g=new aI(c,a,p.shape.length,f.shape.length,u,d,!1,!0),m=n.runWebGLProgram(g,[f,p,v],v.dtype),y=_e({inputs:{x:m},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),y}const AAe={kernelName:bme,backendName:"webgl",kernelFunc:TAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PAe{constructor(e,n){this.variableNames=["A"];const i=new Array(e.length);for(let o=0;o<i.length;o++)i[o]=e[o]*n[o];this.outputShape=i,this.rank=i.length;const r=hn(this.rank),s=IAe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}function IAe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let r=0;r<t.length;r++)i.push(`imod(${n[r]}, ${t[r]})`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reps:s}=i;if(r.dtype==="string"||r.shape.length>5){const c=n.readSync(r.dataId),l=r.dtype==="string"?c.map(d=>Kd(d)):c,u=Oi(r.shape,r.dtype,l),h=Oxe(u,s);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new PAe(r.shape,s);return n.runWebGLProgram(o,[r],r.dtype)}const MAe={kernelName:Y8,backendName:"webgl",kernelFunc:_7};class kAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class LAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yl(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function H4(t){let e=1;for(;e<t;)e*=2;return e}function DAe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{k:s,sorted:o}=i,a=Z().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=Z().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=r.shape,u=l[l.length-1];if(n.shouldExecuteOnCPU([r])||u<a||s>c){const _=n.readSync(r.dataId),[R,L]=Fxe(_,l,r.dtype,s,o);return[n.makeTensorInfo(R.shape,R.dtype,R.values),n.makeTensorInfo(L.shape,L.dtype,L.values)]}if(s===0)return l[l.length-1]=0,[n.makeTensorInfo(l,r.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(u===1)return[r,nv({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),d=h!==null&&h.isPacked,p=d?n.unpackTensor(r):r,v=be(l)/u,g=_e({inputs:{x:p},attrs:{shape:[v,u]},backend:n});d&&Yl(n,p);const m=H4(s),y=H4(u);let S=null;const x=()=>S===null?[g,g]:[g,S],w=(_,R,L)=>{const O=x(),V=new kAe(L),G=[[u],[S===null?1:0],[Number.NEGATIVE_INFINITY],[_],[R]],J=S;S=n.runWebGLProgram(V,O,"int32",G),Yl(n,J)};for(let _=1;_<m;_*=2){const R=_*2;for(let L=_;L>=1;L/=2)w(R,L,[v,y])}for(let _=y;_>m;_/=2){const R=x(),L=new LAe([v,_/2]),V=[[u],[S===null?1:0],[m]],X=S;S=n.runWebGLProgram(L,R,"int32",V),Yl(n,X);const G=m/2,J=G*2;for(let D=G;D>=1;D/=2)w(J,D,S.shape)}let C=S;S=Dp({inputs:{x:S},backend:n,attrs:{begin:0,size:[v,s]}}),Yl(n,C);let E=f7({inputs:{x:g,indices:S},backend:n,attrs:{axis:1,batchDims:1}});Yl(n,g);const b=l.slice(0,-1);b.push(s),C=S,S=_e({inputs:{x:S},attrs:{shape:b},backend:n}),Yl(n,C);const M=E;return E=_e({inputs:{x:E},attrs:{shape:b},backend:n}),Yl(n,M),[E,S]}const NAe={kernelName:Qme,backendName:"webgl",kernelFunc:DAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OAe{constructor(e,n,i,r,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=i==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FAe(t){const{inputs:e,backend:n,attrs:i}=t,{image:r,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:c,outputShape:l}=i,[u,h,d,p]=r.shape,[f,v]=l??[h,d],g=[u,f,v,p],m=new OAe(h,d,o,a,c,g);return n.runWebGLProgram(m,[r,s],"float32")}const zAe={kernelName:Zme,backendName:"webgl",kernelFunc:FAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UAe(t){const{inputs:e,attrs:n,backend:i}=t,{axis:r}=n,{x:s}=e;Z0(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=i.readSync(s.dataId),{outputValues:a,outputShape:c,indices:l}=zxe(o,r,s.shape,s.dtype);return[i.makeTensorInfo(c,s.dtype,a),i.makeTensorInfo([l.length],"int32",l)]}const BAe={kernelName:tge,backendName:"webgl",kernelFunc:UAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ae(t){const{inputs:e,backend:n,attrs:i}=t,{value:r}=e;let{axis:s}=i;s<0&&(s+=r.shape.length);const o=r,a=o.shape.length,c=r.shape[s],l=new Array(a-1);let u=0;for(let v=0;v<a;v++)v!==s&&(l[u++]=o.shape[v]);const h=[],d=new Array(a).fill(0),p=o.shape.slice();p[s]=1;const f=new Array(c);for(let v=0;v<f.length;v++){d[s]=v;const g=Dp({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),m=_e({inputs:{x:g},backend:n,attrs:{shape:l}});f[v]=m,h.push(g)}return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),f}const HAe={kernelName:nge,backendName:"webgl",kernelFunc:$Ae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VAe{constructor(e,n){this.variableNames=["x","segmentIds"];const i=e.windowSize,r=e.batchSize,s=e.inSize,o=e.numSegments,a=o*Math.ceil(s/i);this.outputShape=[r,a];const c="0.0",l="sumValue",u=Math.floor(i/4)*4,h=i%4,d=`
        sumValue += dot(values, segFilter);
    `;let p="";s%i>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let f="";s%i>0&&(f=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${f}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${i}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jAe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,segmentIds:s}=e,{numSegments:o}=i,a=r.shape.length,c=[];let l=0;const u=io([l],a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),c.push(h),l=ro(1,a)[0]);const d=TV(h.shape,l,o),p=be([h.shape[l]]),f=_e({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});c.push(f);const v=UP(r.dtype),g=(x,w,C,E,b)=>{const M=x.shape[0],_=x.shape[1],R=bV(_,b),L={windowSize:R,inSize:_,batchSize:M,numSegments:b},O=new VAe(L,w),V=n.compileAndRun(O,[x,C],E);if(c.push(V),V.shape[1]===b)return V;const X=C7({backend:n,attrs:{start:0,stop:b,step:1,dtype:"float32"}}),G=_7({inputs:{x:X},backend:n,attrs:{reps:[_/R]}});return c.push(X),c.push(G),g(V,w,G,E,b)},m=g(f,"unsortedSegmentSum",s,v,o),y=_e({inputs:{x:m},backend:n,attrs:{shape:d}});let S=y;if(u!=null){c.push(y);const x=jP(u);S=mr({inputs:{x:S},backend:n,attrs:{perm:x}})}return c.forEach(x=>n.disposeIntermediateTensorInfo(x)),S}const WAe={kernelName:ige,backendName:"webgl",kernelFunc:jAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GAe=[PCe,MCe,DCe,FCe,UCe,HCe,jCe,GCe,YCe,QCe,t_e,r_e,a_e,h_e,f_e,g_e,y_e,__e,E_e,b_e,I_e,F_e,U_e,V_e,W_e,J_e,Z_e,iwe,dCe,owe,hwe,mwe,Cwe,Ewe,bwe,Awe,Iwe,Dwe,Fwe,Bwe,Hwe,jwe,Gwe,Kwe,Jwe,tEe,iEe,oEe,lEe,hEe,mEe,SEe,wEe,bEe,PEe,IEe,kEe,DEe,OEe,zEe,BEe,jEe,qEe,YEe,QEe,tRe,rRe,cRe,dRe,hCe,fRe,lwe,vRe,xRe,wRe,fCe,TRe,MRe,LRe,FRe,BRe,jRe,qRe,JRe,tbe,rbe,obe,ube,dbe,fbe,ybe,xbe,_be,Ebe,bbe,Ibe,Dbe,zbe,Gbe,vCe,Ybe,Zbe,nTe,sTe,q_e,cTe,uTe,dTe,mTe,STe,gCe,CTe,wTe,RTe,TTe,ATe,X_e,Hbe,MTe,NTe,UTe,SCe,VTe,GTe,YTe,ZTe,i2e,s2e,c2e,h2e,f2e,v2e,x2e,w2e,T2e,I2e,D2e,F2e,N_e,jbe,B2e,H2e,j2e,G2e,X2e,Y2e,Q2e,eAe,nAe,sAe,aAe,lAe,hAe,fAe,gAe,yAe,xAe,Vbe,bCe,wAe,bAe,AAe,MAe,NAe,zAe,TCe,BAe,HAe,WAe,lTe];for(const t of GAe)hge(t);const qAe=[{key:"herstory.mp4",name:" Herstory",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/herstory.gif",description:""},{key:"hermione.mp4",name:"Hermione",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/hermione.gif",description:"Its Leviosa, Not Leviosaaa!"},{key:"natasha_tony.mp4",name:"Natasha",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/natasha.gif",description:"Need your impression, i mean fingerprint"},{key:"peterparker.mp4",name:"Peter Parker",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/peterparker.gif",description:"Spider-Man awakens"},{key:"peterparker2.mp4",name:"Peter Parker II",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/peterparker2.gif",description:"Trying to be a hero"}],XAe=["male","female","any"],KAe=()=>{const t=re.useRef(null),e=re.useRef(null),[n,i]=re.useState(!1),[r,s]=re.useState(!1),[o,a]=re.useState(null),[c,l]=re.useState(!1),u=re.useRef(null),h=re.useRef(-1),[d,p]=re.useState(null),[f,v]=re.useState("idle"),[g,m]=re.useState(null),[y,S]=re.useState(0),x=re.useRef(),[w,C]=re.useState(null),[E,b]=re.useState("any"),[M,_]=re.useState(!1),[R,L]=re.useState(!1),O=async()=>{if(!u.current){L(!0);try{const ee=await Rc.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm");u.current=await zr.createFromOptions(ee,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_detector/blaze_face_short_range/float16/1/blaze_face_short_range.tflite",delegate:"GPU"},runningMode:"VIDEO"})}finally{L(!1)}}};re.useEffect(()=>(SH("webgl"),n&&(async()=>{if(!t.current)return;await O();const ge=async()=>{if(!(!t.current||!e.current||!u.current)){if(t.current.currentTime!==h.current){h.current=t.current.currentTime;const I=performance.now(),$=u.current.detectForVideo(t.current,I),K=e.current.getContext("2d");if(!K)return;K.clearRect(0,0,e.current.width,e.current.height),K.drawImage(t.current,0,0,e.current.width,e.current.height),s($.detections.length>0),$.detections.forEach(oe=>{const{boundingBox:he,keypoints:ze}=oe;he&&(K.strokeStyle="#00ff00",K.lineWidth=2,K.strokeRect(he.originX,he.originY,he.width,he.height),ze&&ze.forEach(Me=>{K.beginPath(),K.arc(Me.x*e.current.width,Me.y*e.current.height,3,0,2*Math.PI),K.fillStyle="#ff0000",K.fill()}))})}requestAnimationFrame(ge)}};try{const I=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480},audio:!1});t.current.srcObject=I,await t.current.play(),ge()}catch(I){console.error("Error accessing camera:",I)}})(),()=>{var ge;(ge=t.current)!=null&&ge.srcObject&&t.current.srcObject.getTracks().forEach($=>$.stop())}),[n]),re.useEffect(()=>(f==="processing"?(S(0),x.current=setInterval(()=>{S(ee=>ee+1)},1e3)):x.current&&clearInterval(x.current),()=>{x.current&&clearInterval(x.current)}),[f]);const V=()=>{i(!0),a(null)},X=()=>{i(!1)},G=()=>{if(!e.current||!t.current||!r)return;const ee=document.createElement("canvas");ee.width=e.current.width,ee.height=e.current.height;const ge=ee.getContext("2d");if(!ge)return;ge.drawImage(t.current,0,0,ee.width,ee.height);const I=ee.toDataURL("image/jpeg");a(I),X()},J=async ee=>{try{const I=await(await fetch(`https://app.zzcreation.com/mini/comfy_task_status?task_id=${ee}`)).json();I.status==="processing"?(v("processing"),setTimeout(()=>J(ee),2e3)):I.status==="completed"&&I.video_url&&(v("completed"),m(I.video_url))}catch(ge){console.error("Error checking task status:",ge)}},D=async()=>{if(!(!o||!w))try{l(!0);const ge=await(await fetch(o)).blob(),I=new FormData;I.append("image",ge,"selfie.jpg"),I.append("videoFile",w.key),I.append("genderToSwap",E);const $=await fetch("https://api.zzcreation.com/web/face_swap_task",{method:"POST",body:I,headers:{"x-api-key":"0f4404a5f9f56"}});if(!$.ok)throw new Error("Upload failed");alert("Image uploaded successfully!");const K=await $.json();K.success&&K.taskId&&(p(K.taskId),v("processing"),J(K.taskId))}catch(ee){console.error("Upload error:",ee),alert("Failed to upload image")}finally{l(!1)}},ne=ee=>{const ge=Math.floor(ee/60),I=ee%60;return`${ge.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}`},P=async ee=>{var I;const ge=(I=ee.target.files)==null?void 0:I[0];if(ge){_(!0);try{await O();const $=URL.createObjectURL(ge),K=new Image;K.src=$,await K.decode();const oe=document.createElement("canvas");oe.width=K.width,oe.height=K.height;const he=oe.getContext("2d");if(!he||!u.current)return;he.drawImage(K,0,0);const ze=performance.now();u.current.detectForVideo(K,ze).detections.length>0?a($):(alert(""),URL.revokeObjectURL($))}catch($){console.error("Error processing uploaded image:",$),alert("Error processing image. Please try again.")}finally{_(!1)}}};return ce.jsxs("div",{className:"flex flex-col items-center p-4 max-w-2xl mx-auto",children:[ce.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Face Swapper"}),ce.jsx("div",{className:"relative w-full aspect-video bg-gray-100 rounded-lg overflow-hidden",children:n?ce.jsxs(ce.Fragment,{children:[ce.jsx("video",{ref:t,className:"absolute top-0 left-0 w-full h-full object-cover",autoPlay:!0,playsInline:!0}),ce.jsx("canvas",{ref:e,className:"absolute top-0 left-0 w-full h-full object-cover",width:640,height:480}),ce.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center",children:ce.jsx("button",{onClick:G,disabled:!r,className:`px-4 py-2 rounded-full ${r?"bg-green-500 hover:bg-green-600":"bg-gray-400"} text-white transition-colors`,children:r?" ":""})})]}):o?ce.jsx("img",{src:o,alt:"Captured selfie",className:"w-full h-full object-cover"}):ce.jsx("div",{className:"flex items-center justify-center h-full gap-4",children:R?ce.jsxs(ce.Fragment,{children:[ce.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),ce.jsx("span",{children:"..."})]}):ce.jsxs(ce.Fragment,{children:[ce.jsx("button",{onClick:V,className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",disabled:R,children:"1."}),"",ce.jsxs("label",{className:"px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors cursor-pointer flex items-center gap-2",children:["1. ",ce.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P,disabled:R||M})]})]})})}),f==="processing"&&ce.jsxs("div",{className:"mt-4 text-center",children:[ce.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"}),ce.jsxs("p",{children:["... (Task ID: ",d,")"]}),ce.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[": ",ne(y)]})]}),f==="completed"&&g&&ce.jsxs("div",{className:"mt-4",children:[ce.jsx("h2",{className:"text-xl font-bold mb-2",children:"Result"}),ce.jsx("video",{controls:!0,autoPlay:!0,loop:!0,className:"w-full rounded-lg",src:g})]}),o&&ce.jsxs("div",{className:"mt-4 space-x-4",children:[ce.jsx("button",{onClick:()=>{a(null)},disabled:f==="processing",className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:bg-gray-300",children:""}),ce.jsx("button",{onClick:D,disabled:c||f==="processing"||!w,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:bg-blue-300",children:c?"...":"3. "})]}),!w&&o&&ce.jsx("p",{className:"mt-2 text-red-500",children:""}),ce.jsxs("div",{className:"w-full mb-6",children:[ce.jsx("h2",{className:"text-xl font-semibold mb-2",children:"2. "}),ce.jsx("div",{className:"flex overflow-x-auto gap-4 pb-4 hide-scrollbar",children:qAe.map(ee=>ce.jsxs("div",{onClick:()=>C(ee),className:`flex-shrink-0 w-64 cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${(w==null?void 0:w.key)===ee.key?"border-blue-500 scale-105":"border-gray-200 hover:border-blue-300"}`,children:[ce.jsx("img",{src:ee.thumbnail,alt:ee.name,className:"w-full aspect-video object-cover"}),ce.jsxs("div",{className:"p-2",children:[ce.jsx("h3",{className:"font-medium",children:ee.name}),ce.jsx("p",{className:"text-sm text-gray-500",children:ee.description})]})]},ee.key))})]}),ce.jsxs("div",{className:"w-full mb-6",children:[ce.jsx("h2",{className:"text-xl font-semibold mb-2",children:" Target Gender"}),ce.jsx("div",{className:"flex gap-4",children:XAe.map(ee=>ce.jsx("button",{onClick:()=>b(ee),className:`px-4 py-2 rounded-lg capitalize ${E===ee?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:ee},ee))})]}),M&&ce.jsxs("div",{className:"mt-4 text-center",children:[ce.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),ce.jsx("p",{children:"Validating image..."})]})]})},YAe=[{key:"app1/herstory.mp4",name:" Herstory",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/herstory.gif",description:""},{key:"app1/hermione.mp4",name:"Hermione",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/hermione.gif",description:"Its Leviosa, Not Leviosaaa!"},{key:"app1/natasha_tony.mp4",name:"Natasha",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/natasha.gif",description:"Need your impression, i mean fingerprint"},{key:"app1/peterparker.mp4",name:"Peter Parker",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/peterparker.gif",description:"Spider-Man awakens"},{key:"app1/peterparker2.mp4",name:"Peter Parker II",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/peterparker2.gif",description:"Trying to be a hero"}],JAe=()=>{const t=re.useRef(null),e=re.useRef(null),[n,i]=re.useState(!1),[r,s]=re.useState(!1),[o,a]=re.useState(null),[c,l]=re.useState(!1),u=re.useRef(null),h=re.useRef(-1),[d,p]=re.useState(null),[f,v]=re.useState("idle"),[g,m]=re.useState(null),[y,S]=re.useState(0),x=re.useRef(),[w,C]=re.useState(null),[E,b]=re.useState(!1),[M,_]=re.useState(!1),[R,L]=re.useState(0),[O,V]=zhe(),X=async()=>{if(!u.current){_(!0);try{const I=await Rc.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm");u.current=await zr.createFromOptions(I,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_detector/blaze_face_short_range/float16/1/blaze_face_short_range.tflite",delegate:"GPU"},runningMode:"VIDEO"})}finally{_(!1)}}};re.useEffect(()=>(SH("webgl"),n&&(async()=>{if(!t.current)return;await X();const $=async()=>{if(!(!t.current||!e.current||!u.current)){if(t.current.currentTime!==h.current){h.current=t.current.currentTime;const K=performance.now(),oe=u.current.detectForVideo(t.current,K),he=e.current.getContext("2d");if(!he)return;he.clearRect(0,0,e.current.width,e.current.height),he.drawImage(t.current,0,0,e.current.width,e.current.height),s(oe.detections.length>0),oe.detections.forEach(ze=>{const{boundingBox:Me,keypoints:dt}=ze;Me&&(he.strokeStyle="#00ff00",he.lineWidth=2,he.strokeRect(Me.originX,Me.originY,Me.width,Me.height),dt&&dt.forEach(it=>{he.beginPath(),he.arc(it.x*e.current.width,it.y*e.current.height,3,0,2*Math.PI),he.fillStyle="#ff0000",he.fill()}))})}requestAnimationFrame($)}};try{const K=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480},audio:!1});t.current.srcObject=K,await t.current.play(),$()}catch(K){console.error("Error accessing camera:",K)}})(),()=>{var $;($=t.current)!=null&&$.srcObject&&t.current.srcObject.getTracks().forEach(oe=>oe.stop())}),[n]),re.useEffect(()=>(f==="processing"||f==="pending"?(f==="processing"&&y===0&&S(0),x.current=setInterval(()=>{S(I=>I+1)},1e3)):x.current&&clearInterval(x.current),()=>{x.current&&clearInterval(x.current)}),[f]),re.useEffect(()=>{const I=O.get("taskId");I&&(p(I),v("processing"),ne(I))},[]);const G=()=>{i(!0),a(null)},J=()=>{i(!1)},D=()=>{if(!e.current||!t.current||!r)return;const I=document.createElement("canvas");I.width=e.current.width,I.height=e.current.height;const $=I.getContext("2d");if(!$)return;$.drawImage(t.current,0,0,I.width,I.height);const K=I.toDataURL("image/jpeg");a(K),J()},ne=async I=>{try{const K=await(await fetch(`https://app.zzcreation.com/app1/cloud_comfy_task_status?task_id=${I}`)).json();K.data.status==="pendding"?(V({taskId:I}),v("pending"),L(K.data.position),setTimeout(()=>ne(I),2e3)):K.data.status==="running"?(V({taskId:I}),v("processing"),setTimeout(()=>ne(I),2e3)):K.completed&&K.pubFileUrl&&(v("completed"),m(K.pubFileUrl))}catch($){console.error("Error checking task status:",$)}},P=async()=>{if(!(!o||!w))try{l(!0);const $=await(await fetch(o)).blob(),K=new FormData;K.append("image",$,"selfie.jpg"),K.append("videoFile",w.key);const oe=await fetch("https://api.zzcreation.com/web/cloud_face_swap_task",{method:"POST",body:K,headers:{"x-api-key":"0f4404a5f9f56"}});if(!oe.ok)throw new Error("Upload failed");alert("Image uploaded successfully!");const he=await oe.json();he.success&&he.data.taskId&&(p(he.data.taskId),V({taskId:he.data.taskId}),v("processing"),S(0),ne(he.data.taskId))}catch(I){console.error("Upload error:",I),alert("Failed to upload image")}finally{l(!1)}},ee=I=>{const $=Math.floor(I/60),K=I%60;return`${$.toString().padStart(2,"0")}:${K.toString().padStart(2,"0")}`},ge=async I=>{var K;const $=(K=I.target.files)==null?void 0:K[0];if($){b(!0);try{await X();const oe=URL.createObjectURL($),he=new Image;he.src=oe,await he.decode();const ze=document.createElement("canvas");ze.width=he.width,ze.height=he.height;const Me=ze.getContext("2d");if(!Me||!u.current)return;Me.drawImage(he,0,0);const dt=performance.now();u.current.detectForVideo(he,dt).detections.length>0?a(oe):(alert(""),URL.revokeObjectURL(oe))}catch(oe){console.error("Error processing uploaded image:",oe),alert("Error processing image. Please try again.")}finally{b(!1)}}};return ce.jsxs("div",{className:"flex flex-col items-center p-4 max-w-2xl mx-auto",children:[ce.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Face Swapper"}),ce.jsx("div",{className:"relative w-full aspect-video bg-gray-100 rounded-lg overflow-hidden",children:n?ce.jsxs(ce.Fragment,{children:[ce.jsx("video",{ref:t,className:"absolute top-0 left-0 w-full h-full object-cover",autoPlay:!0,playsInline:!0}),ce.jsx("canvas",{ref:e,className:"absolute top-0 left-0 w-full h-full object-cover",width:640,height:480}),ce.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center",children:ce.jsx("button",{onClick:D,disabled:!r,className:`px-4 py-2 rounded-full ${r?"bg-green-500 hover:bg-green-600":"bg-gray-400"} text-white transition-colors`,children:r?" ":""})})]}):o?ce.jsx("img",{src:o,alt:"Captured selfie",className:"w-full h-full object-cover"}):ce.jsx("div",{className:"flex items-center justify-center h-full gap-4",children:M?ce.jsxs(ce.Fragment,{children:[ce.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),ce.jsx("span",{children:"..."})]}):ce.jsxs(ce.Fragment,{children:[ce.jsx("button",{onClick:G,className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",disabled:M,children:"1."}),"",ce.jsxs("label",{className:"px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors cursor-pointer flex items-center gap-2",children:["1. ",ce.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:ge,disabled:M||E})]})]})})}),(f==="processing"||f==="pending")&&ce.jsxs("div",{className:"mt-4 text-center",children:[ce.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"}),f==="processing"?ce.jsxs("p",{children:["... (Task ID: ",d,")"]}):ce.jsxs("p",{children:[": ",R]}),ce.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[": ",ee(y)]})]}),f==="completed"&&g&&ce.jsxs("div",{className:"mt-4",children:[ce.jsx("h2",{className:"text-xl font-bold mb-2",children:"Result"}),ce.jsx("video",{controls:!0,autoPlay:!0,loop:!0,className:"w-full rounded-lg",src:g})]}),o&&ce.jsxs("div",{className:"mt-4 space-x-4",children:[ce.jsx("button",{onClick:()=>{a(null)},disabled:f==="processing",className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:bg-gray-300",children:""}),ce.jsx("button",{onClick:P,disabled:c||f==="processing"||!w,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:bg-blue-300",children:c?"...":"3. "})]}),!w&&o&&ce.jsx("p",{className:"mt-2 text-red-500",children:""}),ce.jsxs("div",{className:"w-full mb-6",children:[ce.jsx("h2",{className:"text-xl font-semibold mb-2",children:"2. "}),ce.jsx("div",{className:"flex overflow-x-auto gap-4 pb-4 hide-scrollbar",children:YAe.map(I=>ce.jsxs("div",{onClick:()=>C(I),className:`flex-shrink-0 w-64 cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${(w==null?void 0:w.key)===I.key?"border-blue-500 scale-105":"border-gray-200 hover:border-blue-300"}`,children:[ce.jsx("img",{src:I.thumbnail,alt:I.name,className:"w-full aspect-video object-cover"}),ce.jsxs("div",{className:"p-2",children:[ce.jsx("h3",{className:"font-medium",children:I.name}),ce.jsx("p",{className:"text-sm text-gray-500",children:I.description})]})]},I.key))})]}),E&&ce.jsxs("div",{className:"mt-4 text-center",children:[ce.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),ce.jsx("p",{children:"Validating image..."})]})]})},QAe=bhe([{path:"/",element:ce.jsx(lue,{})},{path:"playground",element:ce.jsx(KAe,{})},{path:"cloud_app_test",element:ce.jsx(JAe,{})}],{basename:"/m2-avatar-web"});tU(document.getElementById("root")).render(ce.jsx(re.StrictMode,{children:ce.jsx(Nhe,{router:QAe})}));
