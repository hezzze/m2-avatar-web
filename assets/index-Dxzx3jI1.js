function cb(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var It=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function g7(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}),n}var U4={exports:{}},mS={},B4={exports:{}},Ut={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g0=Symbol.for("react.element"),v7=Symbol.for("react.portal"),y7=Symbol.for("react.fragment"),S7=Symbol.for("react.strict_mode"),x7=Symbol.for("react.profiler"),C7=Symbol.for("react.provider"),_7=Symbol.for("react.context"),w7=Symbol.for("react.forward_ref"),E7=Symbol.for("react.suspense"),R7=Symbol.for("react.memo"),T7=Symbol.for("react.lazy"),sI=Symbol.iterator;function b7(t){return t===null||typeof t!="object"?null:(t=sI&&t[sI]||t["@@iterator"],typeof t=="function"?t:null)}var $4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H4=Object.assign,V4={};function tp(t,e,n){this.props=t,this.context=e,this.refs=V4,this.updater=n||$4}tp.prototype.isReactComponent={};tp.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};tp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function j4(){}j4.prototype=tp.prototype;function ub(t,e,n){this.props=t,this.context=e,this.refs=V4,this.updater=n||$4}var hb=ub.prototype=new j4;hb.constructor=ub;H4(hb,tp.prototype);hb.isPureReactComponent=!0;var oI=Array.isArray,W4=Object.prototype.hasOwnProperty,db={current:null},G4={key:!0,ref:!0,__self:!0,__source:!0};function q4(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)W4.call(e,i)&&!G4.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:g0,type:t,key:s,ref:o,props:r,_owner:db.current}}function A7(t,e){return{$$typeof:g0,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function pb(t){return typeof t=="object"&&t!==null&&t.$$typeof===g0}function P7(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var aI=/\/+/g;function XC(t,e){return typeof t=="object"&&t!==null&&t.key!=null?P7(""+t.key):e.toString(36)}function vy(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case g0:case v7:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+XC(o,0):i,oI(r)?(n="",t!=null&&(n=t.replace(aI,"$&/")+"/"),vy(r,e,n,"",function(c){return c})):r!=null&&(pb(r)&&(r=A7(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(aI,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",oI(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+XC(s,a);o+=vy(s,e,n,l,r)}else if(l=b7(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+XC(s,a++),o+=vy(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function nv(t,e,n){if(t==null)return t;var i=[],r=0;return vy(t,i,"","",function(s){return e.call(n,s,r++)}),i}function I7(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ir={current:null},yy={transition:null},M7={ReactCurrentDispatcher:Ir,ReactCurrentBatchConfig:yy,ReactCurrentOwner:db};function X4(){throw Error("act(...) is not supported in production builds of React.")}Ut.Children={map:nv,forEach:function(t,e,n){nv(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return nv(t,function(){e++}),e},toArray:function(t){return nv(t,function(e){return e})||[]},only:function(t){if(!pb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ut.Component=tp;Ut.Fragment=y7;Ut.Profiler=x7;Ut.PureComponent=ub;Ut.StrictMode=S7;Ut.Suspense=E7;Ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M7;Ut.act=X4;Ut.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=H4({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=db.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)W4.call(e,l)&&!G4.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:g0,type:t.type,key:r,ref:s,props:i,_owner:o}};Ut.createContext=function(t){return t={$$typeof:_7,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:C7,_context:t},t.Consumer=t};Ut.createElement=q4;Ut.createFactory=function(t){var e=q4.bind(null,t);return e.type=t,e};Ut.createRef=function(){return{current:null}};Ut.forwardRef=function(t){return{$$typeof:w7,render:t}};Ut.isValidElement=pb;Ut.lazy=function(t){return{$$typeof:T7,_payload:{_status:-1,_result:t},_init:I7}};Ut.memo=function(t,e){return{$$typeof:R7,type:t,compare:e===void 0?null:e}};Ut.startTransition=function(t){var e=yy.transition;yy.transition={};try{t()}finally{yy.transition=e}};Ut.unstable_act=X4;Ut.useCallback=function(t,e){return Ir.current.useCallback(t,e)};Ut.useContext=function(t){return Ir.current.useContext(t)};Ut.useDebugValue=function(){};Ut.useDeferredValue=function(t){return Ir.current.useDeferredValue(t)};Ut.useEffect=function(t,e){return Ir.current.useEffect(t,e)};Ut.useId=function(){return Ir.current.useId()};Ut.useImperativeHandle=function(t,e,n){return Ir.current.useImperativeHandle(t,e,n)};Ut.useInsertionEffect=function(t,e){return Ir.current.useInsertionEffect(t,e)};Ut.useLayoutEffect=function(t,e){return Ir.current.useLayoutEffect(t,e)};Ut.useMemo=function(t,e){return Ir.current.useMemo(t,e)};Ut.useReducer=function(t,e,n){return Ir.current.useReducer(t,e,n)};Ut.useRef=function(t){return Ir.current.useRef(t)};Ut.useState=function(t){return Ir.current.useState(t)};Ut.useSyncExternalStore=function(t,e,n){return Ir.current.useSyncExternalStore(t,e,n)};Ut.useTransition=function(){return Ir.current.useTransition()};Ut.version="18.3.1";B4.exports=Ut;var he=B4.exports;const fb=fS(he),k7=cb({__proto__:null,default:fb},[he]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L7=he,D7=Symbol.for("react.element"),N7=Symbol.for("react.fragment"),O7=Object.prototype.hasOwnProperty,F7=L7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,z7={key:!0,ref:!0,__self:!0,__source:!0};function K4(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)O7.call(e,i)&&!z7.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:D7,type:t,key:s,ref:o,props:r,_owner:F7.current}}mS.Fragment=N7;mS.jsx=K4;mS.jsxs=K4;U4.exports=mS;var ze=U4.exports,Y4={exports:{}},ws={},J4={exports:{}},Q4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,Z){var P=D.length;D.push(Z);e:for(;0<P;){var le=P-1>>>1,Se=D[le];if(0<r(Se,Z))D[le]=Z,D[P]=Se,P=le;else break e}}function n(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var Z=D[0],P=D.pop();if(P!==Z){D[0]=P;e:for(var le=0,Se=D.length,k=Se>>>1;le<k;){var J=2*(le+1)-1,oe=D[J],pe=J+1,ye=D[pe];if(0>r(oe,P))pe<Se&&0>r(ye,oe)?(D[le]=ye,D[pe]=P,le=pe):(D[le]=oe,D[J]=P,le=J);else if(pe<Se&&0>r(ye,P))D[le]=ye,D[pe]=P,le=pe;else break e}}return Z}function r(D,Z){var P=D.sortIndex-Z.sortIndex;return P!==0?P:D.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(D){for(var Z=n(c);Z!==null;){if(Z.callback===null)i(c);else if(Z.startTime<=D)i(c),Z.sortIndex=Z.expirationTime,e(l,Z);else break;Z=n(c)}}function x(D){if(v=!1,S(D),!f)if(n(l)!==null)f=!0,H(w);else{var Z=n(c);Z!==null&&q(x,Z.startTime-D)}}function w(D,Z){f=!1,v&&(v=!1,m(T),T=-1),p=!0;var P=d;try{for(S(Z),h=n(l);h!==null&&(!(h.expirationTime>Z)||D&&!R());){var le=h.callback;if(typeof le=="function"){h.callback=null,d=h.priorityLevel;var Se=le(h.expirationTime<=Z);Z=t.unstable_now(),typeof Se=="function"?h.callback=Se:h===n(l)&&i(l),S(Z)}else i(l);h=n(l)}if(h!==null)var k=!0;else{var J=n(c);J!==null&&q(x,J.startTime-Z),k=!1}return k}finally{h=null,d=P,p=!1}}var C=!1,E=null,T=-1,M=5,_=-1;function R(){return!(t.unstable_now()-_<M)}function L(){if(E!==null){var D=t.unstable_now();_=D;var Z=!0;try{Z=E(!0,D)}finally{Z?z():(C=!1,E=null)}}else C=!1}var z;if(typeof y=="function")z=function(){y(L)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,$=G.port2;G.port1.onmessage=L,z=function(){$.postMessage(null)}}else z=function(){g(L,0)};function H(D){E=D,C||(C=!0,z())}function q(D,Z){T=g(function(){D(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,H(w))},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(D){switch(d){case 1:case 2:case 3:var Z=3;break;default:Z=d}var P=d;d=Z;try{return D()}finally{d=P}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(D,Z){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var P=d;d=D;try{return Z()}finally{d=P}},t.unstable_scheduleCallback=function(D,Z,P){var le=t.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?le+P:le):P=le,D){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=P+Se,D={id:u++,callback:Z,priorityLevel:D,startTime:P,expirationTime:Se,sortIndex:-1},P>le?(D.sortIndex=P,e(c,D),n(l)===null&&D===n(c)&&(v?(m(T),T=-1):v=!0,q(x,P-le))):(D.sortIndex=Se,e(l,D),f||p||(f=!0,H(w))),D},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(D){var Z=d;return function(){var P=d;d=Z;try{return D.apply(this,arguments)}finally{d=P}}}})(Q4);J4.exports=Q4;var U7=J4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B7=he,xs=U7;function ge(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Z4=new Set,Ag={};function Wu(t,e){Cd(t,e),Cd(t+"Capture",e)}function Cd(t,e){for(Ag[t]=e,t=0;t<e.length;t++)Z4.add(e[t])}var Wa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fE=Object.prototype.hasOwnProperty,$7=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,lI={},cI={};function H7(t){return fE.call(cI,t)?!0:fE.call(lI,t)?!1:$7.test(t)?cI[t]=!0:(lI[t]=!0,!1)}function V7(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function j7(t,e,n,i){if(e===null||typeof e>"u"||V7(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mr(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Gi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Gi[t]=new Mr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Gi[e]=new Mr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Gi[t]=new Mr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Gi[t]=new Mr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Gi[t]=new Mr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Gi[t]=new Mr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Gi[t]=new Mr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Gi[t]=new Mr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Gi[t]=new Mr(t,5,!1,t.toLowerCase(),null,!1,!1)});var mb=/[\-:]([a-z])/g;function gb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(mb,gb);Gi[e]=new Mr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(mb,gb);Gi[e]=new Mr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(mb,gb);Gi[e]=new Mr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Gi[t]=new Mr(t,1,!1,t.toLowerCase(),null,!1,!1)});Gi.xlinkHref=new Mr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Gi[t]=new Mr(t,1,!1,t.toLowerCase(),null,!0,!0)});function vb(t,e,n,i){var r=Gi.hasOwnProperty(e)?Gi[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(j7(e,n,r,i)&&(n=null),i||r===null?H7(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var el=B7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,iv=Symbol.for("react.element"),Oh=Symbol.for("react.portal"),Fh=Symbol.for("react.fragment"),yb=Symbol.for("react.strict_mode"),mE=Symbol.for("react.profiler"),eF=Symbol.for("react.provider"),tF=Symbol.for("react.context"),Sb=Symbol.for("react.forward_ref"),gE=Symbol.for("react.suspense"),vE=Symbol.for("react.suspense_list"),xb=Symbol.for("react.memo"),xl=Symbol.for("react.lazy"),nF=Symbol.for("react.offscreen"),uI=Symbol.iterator;function Dp(t){return t===null||typeof t!="object"?null:(t=uI&&t[uI]||t["@@iterator"],typeof t=="function"?t:null)}var jn=Object.assign,KC;function qm(t){if(KC===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);KC=e&&e[1]||""}return`
`+KC+t}var YC=!1;function JC(t,e){if(!t||YC)return"";YC=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{YC=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?qm(t):""}function W7(t){switch(t.tag){case 5:return qm(t.type);case 16:return qm("Lazy");case 13:return qm("Suspense");case 19:return qm("SuspenseList");case 0:case 2:case 15:return t=JC(t.type,!1),t;case 11:return t=JC(t.type.render,!1),t;case 1:return t=JC(t.type,!0),t;default:return""}}function yE(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Fh:return"Fragment";case Oh:return"Portal";case mE:return"Profiler";case yb:return"StrictMode";case gE:return"Suspense";case vE:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case tF:return(t.displayName||"Context")+".Consumer";case eF:return(t._context.displayName||"Context")+".Provider";case Sb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case xb:return e=t.displayName||null,e!==null?e:yE(t.type)||"Memo";case xl:e=t._payload,t=t._init;try{return yE(t(e))}catch{}}return null}function G7(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yE(e);case 8:return e===yb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ec(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function iF(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function q7(t){var e=iF(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function rv(t){t._valueTracker||(t._valueTracker=q7(t))}function rF(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=iF(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Jy(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function SE(t,e){var n=e.checked;return jn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function hI(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=ec(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function sF(t,e){e=e.checked,e!=null&&vb(t,"checked",e,!1)}function xE(t,e){sF(t,e);var n=ec(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?CE(t,e.type,n):e.hasOwnProperty("defaultValue")&&CE(t,e.type,ec(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function dI(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function CE(t,e,n){(e!=="number"||Jy(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Xm=Array.isArray;function nd(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ec(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function _E(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ge(91));return jn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function pI(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ge(92));if(Xm(n)){if(1<n.length)throw Error(ge(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ec(n)}}function oF(t,e){var n=ec(e.value),i=ec(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function fI(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function aF(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wE(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?aF(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var sv,lF=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(sv=sv||document.createElement("div"),sv.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=sv.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Pg(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var lg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},X7=["Webkit","ms","Moz","O"];Object.keys(lg).forEach(function(t){X7.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),lg[e]=lg[t]})});function cF(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||lg.hasOwnProperty(t)&&lg[t]?(""+e).trim():e+"px"}function uF(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=cF(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var K7=jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function EE(t,e){if(e){if(K7[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ge(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ge(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ge(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ge(62))}}function RE(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var TE=null;function Cb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var bE=null,id=null,rd=null;function mI(t){if(t=S0(t)){if(typeof bE!="function")throw Error(ge(280));var e=t.stateNode;e&&(e=xS(e),bE(t.stateNode,t.type,e))}}function hF(t){id?rd?rd.push(t):rd=[t]:id=t}function dF(){if(id){var t=id,e=rd;if(rd=id=null,mI(t),e)for(t=0;t<e.length;t++)mI(e[t])}}function pF(t,e){return t(e)}function fF(){}var QC=!1;function mF(t,e,n){if(QC)return t(e,n);QC=!0;try{return pF(t,e,n)}finally{QC=!1,(id!==null||rd!==null)&&(fF(),dF())}}function Ig(t,e){var n=t.stateNode;if(n===null)return null;var i=xS(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ge(231,e,typeof n));return n}var AE=!1;if(Wa)try{var Np={};Object.defineProperty(Np,"passive",{get:function(){AE=!0}}),window.addEventListener("test",Np,Np),window.removeEventListener("test",Np,Np)}catch{AE=!1}function Y7(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var cg=!1,Qy=null,Zy=!1,PE=null,J7={onError:function(t){cg=!0,Qy=t}};function Q7(t,e,n,i,r,s,o,a,l){cg=!1,Qy=null,Y7.apply(J7,arguments)}function Z7(t,e,n,i,r,s,o,a,l){if(Q7.apply(this,arguments),cg){if(cg){var c=Qy;cg=!1,Qy=null}else throw Error(ge(198));Zy||(Zy=!0,PE=c)}}function Gu(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function gF(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function gI(t){if(Gu(t)!==t)throw Error(ge(188))}function e9(t){var e=t.alternate;if(!e){if(e=Gu(t),e===null)throw Error(ge(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return gI(r),t;if(s===i)return gI(r),e;s=s.sibling}throw Error(ge(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(ge(189))}}if(n.alternate!==i)throw Error(ge(190))}if(n.tag!==3)throw Error(ge(188));return n.stateNode.current===n?t:e}function vF(t){return t=e9(t),t!==null?yF(t):null}function yF(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=yF(t);if(e!==null)return e;t=t.sibling}return null}var SF=xs.unstable_scheduleCallback,vI=xs.unstable_cancelCallback,t9=xs.unstable_shouldYield,n9=xs.unstable_requestPaint,ni=xs.unstable_now,i9=xs.unstable_getCurrentPriorityLevel,_b=xs.unstable_ImmediatePriority,xF=xs.unstable_UserBlockingPriority,e1=xs.unstable_NormalPriority,r9=xs.unstable_LowPriority,CF=xs.unstable_IdlePriority,gS=null,ra=null;function s9(t){if(ra&&typeof ra.onCommitFiberRoot=="function")try{ra.onCommitFiberRoot(gS,t,void 0,(t.current.flags&128)===128)}catch{}}var To=Math.clz32?Math.clz32:l9,o9=Math.log,a9=Math.LN2;function l9(t){return t>>>=0,t===0?32:31-(o9(t)/a9|0)|0}var ov=64,av=4194304;function Km(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function t1(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Km(a):(s&=o,s!==0&&(i=Km(s)))}else o=n&~r,o!==0?i=Km(o):s!==0&&(i=Km(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-To(e),r=1<<n,i|=t[n],e&=~r;return i}function c9(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function u9(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-To(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=c9(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function IE(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function _F(){var t=ov;return ov<<=1,!(ov&4194240)&&(ov=64),t}function ZC(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function v0(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-To(e),t[e]=n}function h9(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-To(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function wb(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-To(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var cn=0;function wF(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var EF,Eb,RF,TF,bF,ME=!1,lv=[],Ul=null,Bl=null,$l=null,Mg=new Map,kg=new Map,Tl=[],d9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yI(t,e){switch(t){case"focusin":case"focusout":Ul=null;break;case"dragenter":case"dragleave":Bl=null;break;case"mouseover":case"mouseout":$l=null;break;case"pointerover":case"pointerout":Mg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":kg.delete(e.pointerId)}}function Op(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=S0(e),e!==null&&Eb(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function p9(t,e,n,i,r){switch(e){case"focusin":return Ul=Op(Ul,t,e,n,i,r),!0;case"dragenter":return Bl=Op(Bl,t,e,n,i,r),!0;case"mouseover":return $l=Op($l,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Mg.set(s,Op(Mg.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,kg.set(s,Op(kg.get(s)||null,t,e,n,i,r)),!0}return!1}function AF(t){var e=lu(t.target);if(e!==null){var n=Gu(e);if(n!==null){if(e=n.tag,e===13){if(e=gF(n),e!==null){t.blockedOn=e,bF(t.priority,function(){RF(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Sy(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=kE(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);TE=i,n.target.dispatchEvent(i),TE=null}else return e=S0(n),e!==null&&Eb(e),t.blockedOn=n,!1;e.shift()}return!0}function SI(t,e,n){Sy(t)&&n.delete(e)}function f9(){ME=!1,Ul!==null&&Sy(Ul)&&(Ul=null),Bl!==null&&Sy(Bl)&&(Bl=null),$l!==null&&Sy($l)&&($l=null),Mg.forEach(SI),kg.forEach(SI)}function Fp(t,e){t.blockedOn===e&&(t.blockedOn=null,ME||(ME=!0,xs.unstable_scheduleCallback(xs.unstable_NormalPriority,f9)))}function Lg(t){function e(r){return Fp(r,t)}if(0<lv.length){Fp(lv[0],t);for(var n=1;n<lv.length;n++){var i=lv[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Ul!==null&&Fp(Ul,t),Bl!==null&&Fp(Bl,t),$l!==null&&Fp($l,t),Mg.forEach(e),kg.forEach(e),n=0;n<Tl.length;n++)i=Tl[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Tl.length&&(n=Tl[0],n.blockedOn===null);)AF(n),n.blockedOn===null&&Tl.shift()}var sd=el.ReactCurrentBatchConfig,n1=!0;function m9(t,e,n,i){var r=cn,s=sd.transition;sd.transition=null;try{cn=1,Rb(t,e,n,i)}finally{cn=r,sd.transition=s}}function g9(t,e,n,i){var r=cn,s=sd.transition;sd.transition=null;try{cn=4,Rb(t,e,n,i)}finally{cn=r,sd.transition=s}}function Rb(t,e,n,i){if(n1){var r=kE(t,e,n,i);if(r===null)c_(t,e,i,i1,n),yI(t,i);else if(p9(r,t,e,n,i))i.stopPropagation();else if(yI(t,i),e&4&&-1<d9.indexOf(t)){for(;r!==null;){var s=S0(r);if(s!==null&&EF(s),s=kE(t,e,n,i),s===null&&c_(t,e,i,i1,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else c_(t,e,i,null,n)}}var i1=null;function kE(t,e,n,i){if(i1=null,t=Cb(i),t=lu(t),t!==null)if(e=Gu(t),e===null)t=null;else if(n=e.tag,n===13){if(t=gF(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return i1=t,null}function PF(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(i9()){case _b:return 1;case xF:return 4;case e1:case r9:return 16;case CF:return 536870912;default:return 16}default:return 16}}var Ml=null,Tb=null,xy=null;function IF(){if(xy)return xy;var t,e=Tb,n=e.length,i,r="value"in Ml?Ml.value:Ml.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return xy=r.slice(t,1<i?1-i:void 0)}function Cy(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function cv(){return!0}function xI(){return!1}function Es(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?cv:xI,this.isPropagationStopped=xI,this}return jn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=cv)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=cv)},persist:function(){},isPersistent:cv}),e}var np={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bb=Es(np),y0=jn({},np,{view:0,detail:0}),v9=Es(y0),e_,t_,zp,vS=jn({},y0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ab,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==zp&&(zp&&t.type==="mousemove"?(e_=t.screenX-zp.screenX,t_=t.screenY-zp.screenY):t_=e_=0,zp=t),e_)},movementY:function(t){return"movementY"in t?t.movementY:t_}}),CI=Es(vS),y9=jn({},vS,{dataTransfer:0}),S9=Es(y9),x9=jn({},y0,{relatedTarget:0}),n_=Es(x9),C9=jn({},np,{animationName:0,elapsedTime:0,pseudoElement:0}),_9=Es(C9),w9=jn({},np,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),E9=Es(w9),R9=jn({},np,{data:0}),_I=Es(R9),T9={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b9={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},A9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function P9(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=A9[t])?!!e[t]:!1}function Ab(){return P9}var I9=jn({},y0,{key:function(t){if(t.key){var e=T9[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Cy(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?b9[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ab,charCode:function(t){return t.type==="keypress"?Cy(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cy(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),M9=Es(I9),k9=jn({},vS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wI=Es(k9),L9=jn({},y0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ab}),D9=Es(L9),N9=jn({},np,{propertyName:0,elapsedTime:0,pseudoElement:0}),O9=Es(N9),F9=jn({},vS,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),z9=Es(F9),U9=[9,13,27,32],Pb=Wa&&"CompositionEvent"in window,ug=null;Wa&&"documentMode"in document&&(ug=document.documentMode);var B9=Wa&&"TextEvent"in window&&!ug,MF=Wa&&(!Pb||ug&&8<ug&&11>=ug),EI=" ",RI=!1;function kF(t,e){switch(t){case"keyup":return U9.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function LF(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var zh=!1;function $9(t,e){switch(t){case"compositionend":return LF(e);case"keypress":return e.which!==32?null:(RI=!0,EI);case"textInput":return t=e.data,t===EI&&RI?null:t;default:return null}}function H9(t,e){if(zh)return t==="compositionend"||!Pb&&kF(t,e)?(t=IF(),xy=Tb=Ml=null,zh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return MF&&e.locale!=="ko"?null:e.data;default:return null}}var V9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function TI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!V9[t.type]:e==="textarea"}function DF(t,e,n,i){hF(i),e=r1(e,"onChange"),0<e.length&&(n=new bb("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var hg=null,Dg=null;function j9(t){WF(t,0)}function yS(t){var e=$h(t);if(rF(e))return t}function W9(t,e){if(t==="change")return e}var NF=!1;if(Wa){var i_;if(Wa){var r_="oninput"in document;if(!r_){var bI=document.createElement("div");bI.setAttribute("oninput","return;"),r_=typeof bI.oninput=="function"}i_=r_}else i_=!1;NF=i_&&(!document.documentMode||9<document.documentMode)}function AI(){hg&&(hg.detachEvent("onpropertychange",OF),Dg=hg=null)}function OF(t){if(t.propertyName==="value"&&yS(Dg)){var e=[];DF(e,Dg,t,Cb(t)),mF(j9,e)}}function G9(t,e,n){t==="focusin"?(AI(),hg=e,Dg=n,hg.attachEvent("onpropertychange",OF)):t==="focusout"&&AI()}function q9(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return yS(Dg)}function X9(t,e){if(t==="click")return yS(e)}function K9(t,e){if(t==="input"||t==="change")return yS(e)}function Y9(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Po=typeof Object.is=="function"?Object.is:Y9;function Ng(t,e){if(Po(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!fE.call(e,r)||!Po(t[r],e[r]))return!1}return!0}function PI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function II(t,e){var n=PI(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=PI(n)}}function FF(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?FF(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function zF(){for(var t=window,e=Jy();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Jy(t.document)}return e}function Ib(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function J9(t){var e=zF(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&FF(n.ownerDocument.documentElement,n)){if(i!==null&&Ib(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=II(n,s);var o=II(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Q9=Wa&&"documentMode"in document&&11>=document.documentMode,Uh=null,LE=null,dg=null,DE=!1;function MI(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;DE||Uh==null||Uh!==Jy(i)||(i=Uh,"selectionStart"in i&&Ib(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),dg&&Ng(dg,i)||(dg=i,i=r1(LE,"onSelect"),0<i.length&&(e=new bb("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Uh)))}function uv(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Bh={animationend:uv("Animation","AnimationEnd"),animationiteration:uv("Animation","AnimationIteration"),animationstart:uv("Animation","AnimationStart"),transitionend:uv("Transition","TransitionEnd")},s_={},UF={};Wa&&(UF=document.createElement("div").style,"AnimationEvent"in window||(delete Bh.animationend.animation,delete Bh.animationiteration.animation,delete Bh.animationstart.animation),"TransitionEvent"in window||delete Bh.transitionend.transition);function SS(t){if(s_[t])return s_[t];if(!Bh[t])return t;var e=Bh[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in UF)return s_[t]=e[n];return t}var BF=SS("animationend"),$F=SS("animationiteration"),HF=SS("animationstart"),VF=SS("transitionend"),jF=new Map,kI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function dc(t,e){jF.set(t,e),Wu(e,[t])}for(var o_=0;o_<kI.length;o_++){var a_=kI[o_],Z9=a_.toLowerCase(),ej=a_[0].toUpperCase()+a_.slice(1);dc(Z9,"on"+ej)}dc(BF,"onAnimationEnd");dc($F,"onAnimationIteration");dc(HF,"onAnimationStart");dc("dblclick","onDoubleClick");dc("focusin","onFocus");dc("focusout","onBlur");dc(VF,"onTransitionEnd");Cd("onMouseEnter",["mouseout","mouseover"]);Cd("onMouseLeave",["mouseout","mouseover"]);Cd("onPointerEnter",["pointerout","pointerover"]);Cd("onPointerLeave",["pointerout","pointerover"]);Wu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ym="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tj=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ym));function LI(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,Z7(i,e,void 0,t),t.currentTarget=null}function WF(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;LI(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;LI(r,a,c),s=l}}}if(Zy)throw t=PE,Zy=!1,PE=null,t}function An(t,e){var n=e[UE];n===void 0&&(n=e[UE]=new Set);var i=t+"__bubble";n.has(i)||(GF(e,t,2,!1),n.add(i))}function l_(t,e,n){var i=0;e&&(i|=4),GF(n,t,i,e)}var hv="_reactListening"+Math.random().toString(36).slice(2);function Og(t){if(!t[hv]){t[hv]=!0,Z4.forEach(function(n){n!=="selectionchange"&&(tj.has(n)||l_(n,!1,t),l_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[hv]||(e[hv]=!0,l_("selectionchange",!1,e))}}function GF(t,e,n,i){switch(PF(e)){case 1:var r=m9;break;case 4:r=g9;break;default:r=Rb}n=r.bind(null,e,n,t),r=void 0,!AE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function c_(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=lu(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}mF(function(){var c=s,u=Cb(n),h=[];e:{var d=jF.get(t);if(d!==void 0){var p=bb,f=t;switch(t){case"keypress":if(Cy(n)===0)break e;case"keydown":case"keyup":p=M9;break;case"focusin":f="focus",p=n_;break;case"focusout":f="blur",p=n_;break;case"beforeblur":case"afterblur":p=n_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=CI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=S9;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=D9;break;case BF:case $F:case HF:p=_9;break;case VF:p=O9;break;case"scroll":p=v9;break;case"wheel":p=z9;break;case"copy":case"cut":case"paste":p=E9;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=wI}var v=(e&4)!==0,g=!v&&t==="scroll",m=v?d!==null?d+"Capture":null:d;v=[];for(var y=c,S;y!==null;){S=y;var x=S.stateNode;if(S.tag===5&&x!==null&&(S=x,m!==null&&(x=Ig(y,m),x!=null&&v.push(Fg(y,x,S)))),g)break;y=y.return}0<v.length&&(d=new p(d,f,null,n,u),h.push({event:d,listeners:v}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",d&&n!==TE&&(f=n.relatedTarget||n.fromElement)&&(lu(f)||f[Ga]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=n.relatedTarget||n.toElement,p=c,f=f?lu(f):null,f!==null&&(g=Gu(f),f!==g||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=c),p!==f)){if(v=CI,x="onMouseLeave",m="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(v=wI,x="onPointerLeave",m="onPointerEnter",y="pointer"),g=p==null?d:$h(p),S=f==null?d:$h(f),d=new v(x,y+"leave",p,n,u),d.target=g,d.relatedTarget=S,x=null,lu(u)===c&&(v=new v(m,y+"enter",f,n,u),v.target=S,v.relatedTarget=g,x=v),g=x,p&&f)t:{for(v=p,m=f,y=0,S=v;S;S=lh(S))y++;for(S=0,x=m;x;x=lh(x))S++;for(;0<y-S;)v=lh(v),y--;for(;0<S-y;)m=lh(m),S--;for(;y--;){if(v===m||m!==null&&v===m.alternate)break t;v=lh(v),m=lh(m)}v=null}else v=null;p!==null&&DI(h,d,p,v,!1),f!==null&&g!==null&&DI(h,g,f,v,!0)}}e:{if(d=c?$h(c):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var w=W9;else if(TI(d))if(NF)w=K9;else{w=q9;var C=G9}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(w=X9);if(w&&(w=w(t,c))){DF(h,w,n,u);break e}C&&C(t,d,c),t==="focusout"&&(C=d._wrapperState)&&C.controlled&&d.type==="number"&&CE(d,"number",d.value)}switch(C=c?$h(c):window,t){case"focusin":(TI(C)||C.contentEditable==="true")&&(Uh=C,LE=c,dg=null);break;case"focusout":dg=LE=Uh=null;break;case"mousedown":DE=!0;break;case"contextmenu":case"mouseup":case"dragend":DE=!1,MI(h,n,u);break;case"selectionchange":if(Q9)break;case"keydown":case"keyup":MI(h,n,u)}var E;if(Pb)e:{switch(t){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else zh?kF(t,n)&&(T="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(MF&&n.locale!=="ko"&&(zh||T!=="onCompositionStart"?T==="onCompositionEnd"&&zh&&(E=IF()):(Ml=u,Tb="value"in Ml?Ml.value:Ml.textContent,zh=!0)),C=r1(c,T),0<C.length&&(T=new _I(T,t,null,n,u),h.push({event:T,listeners:C}),E?T.data=E:(E=LF(n),E!==null&&(T.data=E)))),(E=B9?$9(t,n):H9(t,n))&&(c=r1(c,"onBeforeInput"),0<c.length&&(u=new _I("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:c}),u.data=E))}WF(h,e)})}function Fg(t,e,n){return{instance:t,listener:e,currentTarget:n}}function r1(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Ig(t,n),s!=null&&i.unshift(Fg(t,s,r)),s=Ig(t,e),s!=null&&i.push(Fg(t,s,r))),t=t.return}return i}function lh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function DI(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=Ig(n,s),l!=null&&o.unshift(Fg(n,l,a))):r||(l=Ig(n,s),l!=null&&o.push(Fg(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var nj=/\r\n?/g,ij=/\u0000|\uFFFD/g;function NI(t){return(typeof t=="string"?t:""+t).replace(nj,`
`).replace(ij,"")}function dv(t,e,n){if(e=NI(e),NI(t)!==e&&n)throw Error(ge(425))}function s1(){}var NE=null,OE=null;function FE(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var zE=typeof setTimeout=="function"?setTimeout:void 0,rj=typeof clearTimeout=="function"?clearTimeout:void 0,OI=typeof Promise=="function"?Promise:void 0,sj=typeof queueMicrotask=="function"?queueMicrotask:typeof OI<"u"?function(t){return OI.resolve(null).then(t).catch(oj)}:zE;function oj(t){setTimeout(function(){throw t})}function u_(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Lg(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Lg(e)}function Hl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function FI(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ip=Math.random().toString(36).slice(2),Qo="__reactFiber$"+ip,zg="__reactProps$"+ip,Ga="__reactContainer$"+ip,UE="__reactEvents$"+ip,aj="__reactListeners$"+ip,lj="__reactHandles$"+ip;function lu(t){var e=t[Qo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ga]||n[Qo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=FI(t);t!==null;){if(n=t[Qo])return n;t=FI(t)}return e}t=n,n=t.parentNode}return null}function S0(t){return t=t[Qo]||t[Ga],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function $h(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ge(33))}function xS(t){return t[zg]||null}var BE=[],Hh=-1;function pc(t){return{current:t}}function Mn(t){0>Hh||(t.current=BE[Hh],BE[Hh]=null,Hh--)}function _n(t,e){Hh++,BE[Hh]=t.current,t.current=e}var tc={},fr=pc(tc),Vr=pc(!1),wu=tc;function _d(t,e){var n=t.type.contextTypes;if(!n)return tc;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function jr(t){return t=t.childContextTypes,t!=null}function o1(){Mn(Vr),Mn(fr)}function zI(t,e,n){if(fr.current!==tc)throw Error(ge(168));_n(fr,e),_n(Vr,n)}function qF(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(ge(108,G7(t)||"Unknown",r));return jn({},n,i)}function a1(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||tc,wu=fr.current,_n(fr,t),_n(Vr,Vr.current),!0}function UI(t,e,n){var i=t.stateNode;if(!i)throw Error(ge(169));n?(t=qF(t,e,wu),i.__reactInternalMemoizedMergedChildContext=t,Mn(Vr),Mn(fr),_n(fr,t)):Mn(Vr),_n(Vr,n)}var Ma=null,CS=!1,h_=!1;function XF(t){Ma===null?Ma=[t]:Ma.push(t)}function cj(t){CS=!0,XF(t)}function fc(){if(!h_&&Ma!==null){h_=!0;var t=0,e=cn;try{var n=Ma;for(cn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Ma=null,CS=!1}catch(r){throw Ma!==null&&(Ma=Ma.slice(t+1)),SF(_b,fc),r}finally{cn=e,h_=!1}}return null}var Vh=[],jh=0,l1=null,c1=0,Ds=[],Ns=0,Eu=null,Oa=1,Fa="";function Kc(t,e){Vh[jh++]=c1,Vh[jh++]=l1,l1=t,c1=e}function KF(t,e,n){Ds[Ns++]=Oa,Ds[Ns++]=Fa,Ds[Ns++]=Eu,Eu=t;var i=Oa;t=Fa;var r=32-To(i)-1;i&=~(1<<r),n+=1;var s=32-To(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Oa=1<<32-To(e)+r|n<<r|i,Fa=s+t}else Oa=1<<s|n<<r|i,Fa=t}function Mb(t){t.return!==null&&(Kc(t,1),KF(t,1,0))}function kb(t){for(;t===l1;)l1=Vh[--jh],Vh[jh]=null,c1=Vh[--jh],Vh[jh]=null;for(;t===Eu;)Eu=Ds[--Ns],Ds[Ns]=null,Fa=Ds[--Ns],Ds[Ns]=null,Oa=Ds[--Ns],Ds[Ns]=null}var vs=null,ps=null,Nn=!1,yo=null;function YF(t,e){var n=Us(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function BI(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,vs=t,ps=Hl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,vs=t,ps=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Eu!==null?{id:Oa,overflow:Fa}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Us(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,vs=t,ps=null,!0):!1;default:return!1}}function $E(t){return(t.mode&1)!==0&&(t.flags&128)===0}function HE(t){if(Nn){var e=ps;if(e){var n=e;if(!BI(t,e)){if($E(t))throw Error(ge(418));e=Hl(n.nextSibling);var i=vs;e&&BI(t,e)?YF(i,n):(t.flags=t.flags&-4097|2,Nn=!1,vs=t)}}else{if($E(t))throw Error(ge(418));t.flags=t.flags&-4097|2,Nn=!1,vs=t}}}function $I(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;vs=t}function pv(t){if(t!==vs)return!1;if(!Nn)return $I(t),Nn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!FE(t.type,t.memoizedProps)),e&&(e=ps)){if($E(t))throw JF(),Error(ge(418));for(;e;)YF(t,e),e=Hl(e.nextSibling)}if($I(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ge(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ps=Hl(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ps=null}}else ps=vs?Hl(t.stateNode.nextSibling):null;return!0}function JF(){for(var t=ps;t;)t=Hl(t.nextSibling)}function wd(){ps=vs=null,Nn=!1}function Lb(t){yo===null?yo=[t]:yo.push(t)}var uj=el.ReactCurrentBatchConfig;function Up(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ge(309));var i=n.stateNode}if(!i)throw Error(ge(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(ge(284));if(!n._owner)throw Error(ge(290,t))}return t}function fv(t,e){throw t=Object.prototype.toString.call(e),Error(ge(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function HI(t){var e=t._init;return e(t._payload)}function QF(t){function e(m,y){if(t){var S=m.deletions;S===null?(m.deletions=[y],m.flags|=16):S.push(y)}}function n(m,y){if(!t)return null;for(;y!==null;)e(m,y),y=y.sibling;return null}function i(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function r(m,y){return m=Gl(m,y),m.index=0,m.sibling=null,m}function s(m,y,S){return m.index=S,t?(S=m.alternate,S!==null?(S=S.index,S<y?(m.flags|=2,y):S):(m.flags|=2,y)):(m.flags|=1048576,y)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,y,S,x){return y===null||y.tag!==6?(y=y_(S,m.mode,x),y.return=m,y):(y=r(y,S),y.return=m,y)}function l(m,y,S,x){var w=S.type;return w===Fh?u(m,y,S.props.children,x,S.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===xl&&HI(w)===y.type)?(x=r(y,S.props),x.ref=Up(m,y,S),x.return=m,x):(x=Ay(S.type,S.key,S.props,null,m.mode,x),x.ref=Up(m,y,S),x.return=m,x)}function c(m,y,S,x){return y===null||y.tag!==4||y.stateNode.containerInfo!==S.containerInfo||y.stateNode.implementation!==S.implementation?(y=S_(S,m.mode,x),y.return=m,y):(y=r(y,S.children||[]),y.return=m,y)}function u(m,y,S,x,w){return y===null||y.tag!==7?(y=vu(S,m.mode,x,w),y.return=m,y):(y=r(y,S),y.return=m,y)}function h(m,y,S){if(typeof y=="string"&&y!==""||typeof y=="number")return y=y_(""+y,m.mode,S),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case iv:return S=Ay(y.type,y.key,y.props,null,m.mode,S),S.ref=Up(m,null,y),S.return=m,S;case Oh:return y=S_(y,m.mode,S),y.return=m,y;case xl:var x=y._init;return h(m,x(y._payload),S)}if(Xm(y)||Dp(y))return y=vu(y,m.mode,S,null),y.return=m,y;fv(m,y)}return null}function d(m,y,S,x){var w=y!==null?y.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return w!==null?null:a(m,y,""+S,x);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case iv:return S.key===w?l(m,y,S,x):null;case Oh:return S.key===w?c(m,y,S,x):null;case xl:return w=S._init,d(m,y,w(S._payload),x)}if(Xm(S)||Dp(S))return w!==null?null:u(m,y,S,x,null);fv(m,S)}return null}function p(m,y,S,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return m=m.get(S)||null,a(y,m,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case iv:return m=m.get(x.key===null?S:x.key)||null,l(y,m,x,w);case Oh:return m=m.get(x.key===null?S:x.key)||null,c(y,m,x,w);case xl:var C=x._init;return p(m,y,S,C(x._payload),w)}if(Xm(x)||Dp(x))return m=m.get(S)||null,u(y,m,x,w,null);fv(y,x)}return null}function f(m,y,S,x){for(var w=null,C=null,E=y,T=y=0,M=null;E!==null&&T<S.length;T++){E.index>T?(M=E,E=null):M=E.sibling;var _=d(m,E,S[T],x);if(_===null){E===null&&(E=M);break}t&&E&&_.alternate===null&&e(m,E),y=s(_,y,T),C===null?w=_:C.sibling=_,C=_,E=M}if(T===S.length)return n(m,E),Nn&&Kc(m,T),w;if(E===null){for(;T<S.length;T++)E=h(m,S[T],x),E!==null&&(y=s(E,y,T),C===null?w=E:C.sibling=E,C=E);return Nn&&Kc(m,T),w}for(E=i(m,E);T<S.length;T++)M=p(E,m,T,S[T],x),M!==null&&(t&&M.alternate!==null&&E.delete(M.key===null?T:M.key),y=s(M,y,T),C===null?w=M:C.sibling=M,C=M);return t&&E.forEach(function(R){return e(m,R)}),Nn&&Kc(m,T),w}function v(m,y,S,x){var w=Dp(S);if(typeof w!="function")throw Error(ge(150));if(S=w.call(S),S==null)throw Error(ge(151));for(var C=w=null,E=y,T=y=0,M=null,_=S.next();E!==null&&!_.done;T++,_=S.next()){E.index>T?(M=E,E=null):M=E.sibling;var R=d(m,E,_.value,x);if(R===null){E===null&&(E=M);break}t&&E&&R.alternate===null&&e(m,E),y=s(R,y,T),C===null?w=R:C.sibling=R,C=R,E=M}if(_.done)return n(m,E),Nn&&Kc(m,T),w;if(E===null){for(;!_.done;T++,_=S.next())_=h(m,_.value,x),_!==null&&(y=s(_,y,T),C===null?w=_:C.sibling=_,C=_);return Nn&&Kc(m,T),w}for(E=i(m,E);!_.done;T++,_=S.next())_=p(E,m,T,_.value,x),_!==null&&(t&&_.alternate!==null&&E.delete(_.key===null?T:_.key),y=s(_,y,T),C===null?w=_:C.sibling=_,C=_);return t&&E.forEach(function(L){return e(m,L)}),Nn&&Kc(m,T),w}function g(m,y,S,x){if(typeof S=="object"&&S!==null&&S.type===Fh&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case iv:e:{for(var w=S.key,C=y;C!==null;){if(C.key===w){if(w=S.type,w===Fh){if(C.tag===7){n(m,C.sibling),y=r(C,S.props.children),y.return=m,m=y;break e}}else if(C.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===xl&&HI(w)===C.type){n(m,C.sibling),y=r(C,S.props),y.ref=Up(m,C,S),y.return=m,m=y;break e}n(m,C);break}else e(m,C);C=C.sibling}S.type===Fh?(y=vu(S.props.children,m.mode,x,S.key),y.return=m,m=y):(x=Ay(S.type,S.key,S.props,null,m.mode,x),x.ref=Up(m,y,S),x.return=m,m=x)}return o(m);case Oh:e:{for(C=S.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===S.containerInfo&&y.stateNode.implementation===S.implementation){n(m,y.sibling),y=r(y,S.children||[]),y.return=m,m=y;break e}else{n(m,y);break}else e(m,y);y=y.sibling}y=S_(S,m.mode,x),y.return=m,m=y}return o(m);case xl:return C=S._init,g(m,y,C(S._payload),x)}if(Xm(S))return f(m,y,S,x);if(Dp(S))return v(m,y,S,x);fv(m,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,y!==null&&y.tag===6?(n(m,y.sibling),y=r(y,S),y.return=m,m=y):(n(m,y),y=y_(S,m.mode,x),y.return=m,m=y),o(m)):n(m,y)}return g}var Ed=QF(!0),ZF=QF(!1),u1=pc(null),h1=null,Wh=null,Db=null;function Nb(){Db=Wh=h1=null}function Ob(t){var e=u1.current;Mn(u1),t._currentValue=e}function VE(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function od(t,e){h1=t,Db=Wh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&($r=!0),t.firstContext=null)}function Xs(t){var e=t._currentValue;if(Db!==t)if(t={context:t,memoizedValue:e,next:null},Wh===null){if(h1===null)throw Error(ge(308));Wh=t,h1.dependencies={lanes:0,firstContext:t}}else Wh=Wh.next=t;return e}var cu=null;function Fb(t){cu===null?cu=[t]:cu.push(t)}function ez(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Fb(e)):(n.next=r.next,r.next=n),e.interleaved=n,qa(t,i)}function qa(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Cl=!1;function zb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tz(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $a(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Vl(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Yt&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,qa(t,n)}return r=i.interleaved,r===null?(e.next=e,Fb(i)):(e.next=r.next,r.next=e),i.interleaved=e,qa(t,n)}function _y(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,wb(t,n)}}function VI(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function d1(t,e,n,i){var r=t.updateQueue;Cl=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;o=0,u=c=l=null,a=s;do{var d=a.lane,p=a.eventTime;if((i&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=t,v=a;switch(d=e,p=n,v.tag){case 1:if(f=v.payload,typeof f=="function"){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=v.payload,d=typeof f=="function"?f.call(p,h,d):f,d==null)break e;h=jn({},h,d);break e;case 2:Cl=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(u===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Tu|=o,t.lanes=o,t.memoizedState=h}}function jI(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(ge(191,r));r.call(i)}}}var x0={},sa=pc(x0),Ug=pc(x0),Bg=pc(x0);function uu(t){if(t===x0)throw Error(ge(174));return t}function Ub(t,e){switch(_n(Bg,e),_n(Ug,t),_n(sa,x0),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wE(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=wE(e,t)}Mn(sa),_n(sa,e)}function Rd(){Mn(sa),Mn(Ug),Mn(Bg)}function nz(t){uu(Bg.current);var e=uu(sa.current),n=wE(e,t.type);e!==n&&(_n(Ug,t),_n(sa,n))}function Bb(t){Ug.current===t&&(Mn(sa),Mn(Ug))}var Un=pc(0);function p1(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var d_=[];function $b(){for(var t=0;t<d_.length;t++)d_[t]._workInProgressVersionPrimary=null;d_.length=0}var wy=el.ReactCurrentDispatcher,p_=el.ReactCurrentBatchConfig,Ru=0,Vn=null,gi=null,Mi=null,f1=!1,pg=!1,$g=0,hj=0;function Ji(){throw Error(ge(321))}function Hb(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Po(t[n],e[n]))return!1;return!0}function Vb(t,e,n,i,r,s){if(Ru=s,Vn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,wy.current=t===null||t.memoizedState===null?mj:gj,t=n(i,r),pg){s=0;do{if(pg=!1,$g=0,25<=s)throw Error(ge(301));s+=1,Mi=gi=null,e.updateQueue=null,wy.current=vj,t=n(i,r)}while(pg)}if(wy.current=m1,e=gi!==null&&gi.next!==null,Ru=0,Mi=gi=Vn=null,f1=!1,e)throw Error(ge(300));return t}function jb(){var t=$g!==0;return $g=0,t}function qo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mi===null?Vn.memoizedState=Mi=t:Mi=Mi.next=t,Mi}function Ks(){if(gi===null){var t=Vn.alternate;t=t!==null?t.memoizedState:null}else t=gi.next;var e=Mi===null?Vn.memoizedState:Mi.next;if(e!==null)Mi=e,gi=t;else{if(t===null)throw Error(ge(310));gi=t,t={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},Mi===null?Vn.memoizedState=Mi=t:Mi=Mi.next=t}return Mi}function Hg(t,e){return typeof e=="function"?e(t):e}function f_(t){var e=Ks(),n=e.queue;if(n===null)throw Error(ge(311));n.lastRenderedReducer=t;var i=gi,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Ru&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,Vn.lanes|=u,Tu|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Po(i,e.memoizedState)||($r=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Vn.lanes|=s,Tu|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function m_(t){var e=Ks(),n=e.queue;if(n===null)throw Error(ge(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Po(s,e.memoizedState)||($r=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function iz(){}function rz(t,e){var n=Vn,i=Ks(),r=e(),s=!Po(i.memoizedState,r);if(s&&(i.memoizedState=r,$r=!0),i=i.queue,Wb(az.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Mi!==null&&Mi.memoizedState.tag&1){if(n.flags|=2048,Vg(9,oz.bind(null,n,i,r,e),void 0,null),Li===null)throw Error(ge(349));Ru&30||sz(n,e,r)}return r}function sz(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Vn.updateQueue,e===null?(e={lastEffect:null,stores:null},Vn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function oz(t,e,n,i){e.value=n,e.getSnapshot=i,lz(e)&&cz(t)}function az(t,e,n){return n(function(){lz(e)&&cz(t)})}function lz(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Po(t,n)}catch{return!0}}function cz(t){var e=qa(t,1);e!==null&&bo(e,t,1,-1)}function WI(t){var e=qo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hg,lastRenderedState:t},e.queue=t,t=t.dispatch=fj.bind(null,Vn,t),[e.memoizedState,t]}function Vg(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Vn.updateQueue,e===null?(e={lastEffect:null,stores:null},Vn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function uz(){return Ks().memoizedState}function Ey(t,e,n,i){var r=qo();Vn.flags|=t,r.memoizedState=Vg(1|e,n,void 0,i===void 0?null:i)}function _S(t,e,n,i){var r=Ks();i=i===void 0?null:i;var s=void 0;if(gi!==null){var o=gi.memoizedState;if(s=o.destroy,i!==null&&Hb(i,o.deps)){r.memoizedState=Vg(e,n,s,i);return}}Vn.flags|=t,r.memoizedState=Vg(1|e,n,s,i)}function GI(t,e){return Ey(8390656,8,t,e)}function Wb(t,e){return _S(2048,8,t,e)}function hz(t,e){return _S(4,2,t,e)}function dz(t,e){return _S(4,4,t,e)}function pz(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function fz(t,e,n){return n=n!=null?n.concat([t]):null,_S(4,4,pz.bind(null,e,t),n)}function Gb(){}function mz(t,e){var n=Ks();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Hb(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function gz(t,e){var n=Ks();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Hb(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function vz(t,e,n){return Ru&21?(Po(n,e)||(n=_F(),Vn.lanes|=n,Tu|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,$r=!0),t.memoizedState=n)}function dj(t,e){var n=cn;cn=n!==0&&4>n?n:4,t(!0);var i=p_.transition;p_.transition={};try{t(!1),e()}finally{cn=n,p_.transition=i}}function yz(){return Ks().memoizedState}function pj(t,e,n){var i=Wl(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Sz(t))xz(e,n);else if(n=ez(t,e,n,i),n!==null){var r=Rr();bo(n,t,i,r),Cz(n,e,i)}}function fj(t,e,n){var i=Wl(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Sz(t))xz(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Po(a,o)){var l=e.interleaved;l===null?(r.next=r,Fb(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=ez(t,e,r,i),n!==null&&(r=Rr(),bo(n,t,i,r),Cz(n,e,i))}}function Sz(t){var e=t.alternate;return t===Vn||e!==null&&e===Vn}function xz(t,e){pg=f1=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Cz(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,wb(t,n)}}var m1={readContext:Xs,useCallback:Ji,useContext:Ji,useEffect:Ji,useImperativeHandle:Ji,useInsertionEffect:Ji,useLayoutEffect:Ji,useMemo:Ji,useReducer:Ji,useRef:Ji,useState:Ji,useDebugValue:Ji,useDeferredValue:Ji,useTransition:Ji,useMutableSource:Ji,useSyncExternalStore:Ji,useId:Ji,unstable_isNewReconciler:!1},mj={readContext:Xs,useCallback:function(t,e){return qo().memoizedState=[t,e===void 0?null:e],t},useContext:Xs,useEffect:GI,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Ey(4194308,4,pz.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ey(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ey(4,2,t,e)},useMemo:function(t,e){var n=qo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=qo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=pj.bind(null,Vn,t),[i.memoizedState,t]},useRef:function(t){var e=qo();return t={current:t},e.memoizedState=t},useState:WI,useDebugValue:Gb,useDeferredValue:function(t){return qo().memoizedState=t},useTransition:function(){var t=WI(!1),e=t[0];return t=dj.bind(null,t[1]),qo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Vn,r=qo();if(Nn){if(n===void 0)throw Error(ge(407));n=n()}else{if(n=e(),Li===null)throw Error(ge(349));Ru&30||sz(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,GI(az.bind(null,i,s,t),[t]),i.flags|=2048,Vg(9,oz.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=qo(),e=Li.identifierPrefix;if(Nn){var n=Fa,i=Oa;n=(i&~(1<<32-To(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=$g++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=hj++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},gj={readContext:Xs,useCallback:mz,useContext:Xs,useEffect:Wb,useImperativeHandle:fz,useInsertionEffect:hz,useLayoutEffect:dz,useMemo:gz,useReducer:f_,useRef:uz,useState:function(){return f_(Hg)},useDebugValue:Gb,useDeferredValue:function(t){var e=Ks();return vz(e,gi.memoizedState,t)},useTransition:function(){var t=f_(Hg)[0],e=Ks().memoizedState;return[t,e]},useMutableSource:iz,useSyncExternalStore:rz,useId:yz,unstable_isNewReconciler:!1},vj={readContext:Xs,useCallback:mz,useContext:Xs,useEffect:Wb,useImperativeHandle:fz,useInsertionEffect:hz,useLayoutEffect:dz,useMemo:gz,useReducer:m_,useRef:uz,useState:function(){return m_(Hg)},useDebugValue:Gb,useDeferredValue:function(t){var e=Ks();return gi===null?e.memoizedState=t:vz(e,gi.memoizedState,t)},useTransition:function(){var t=m_(Hg)[0],e=Ks().memoizedState;return[t,e]},useMutableSource:iz,useSyncExternalStore:rz,useId:yz,unstable_isNewReconciler:!1};function po(t,e){if(t&&t.defaultProps){e=jn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function jE(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:jn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var wS={isMounted:function(t){return(t=t._reactInternals)?Gu(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Rr(),r=Wl(t),s=$a(i,r);s.payload=e,n!=null&&(s.callback=n),e=Vl(t,s,r),e!==null&&(bo(e,t,r,i),_y(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Rr(),r=Wl(t),s=$a(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Vl(t,s,r),e!==null&&(bo(e,t,r,i),_y(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Rr(),i=Wl(t),r=$a(n,i);r.tag=2,e!=null&&(r.callback=e),e=Vl(t,r,i),e!==null&&(bo(e,t,i,n),_y(e,t,i))}};function qI(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Ng(n,i)||!Ng(r,s):!0}function _z(t,e,n){var i=!1,r=tc,s=e.contextType;return typeof s=="object"&&s!==null?s=Xs(s):(r=jr(e)?wu:fr.current,i=e.contextTypes,s=(i=i!=null)?_d(t,r):tc),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=wS,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function XI(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&wS.enqueueReplaceState(e,e.state,null)}function WE(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},zb(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Xs(s):(s=jr(e)?wu:fr.current,r.context=_d(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(jE(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&wS.enqueueReplaceState(r,r.state,null),d1(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Td(t,e){try{var n="",i=e;do n+=W7(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function g_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function GE(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var yj=typeof WeakMap=="function"?WeakMap:Map;function wz(t,e,n){n=$a(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){v1||(v1=!0,nR=i),GE(t,e)},n}function Ez(t,e,n){n=$a(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){GE(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){GE(t,e),typeof i!="function"&&(jl===null?jl=new Set([this]):jl.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function KI(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new yj;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=kj.bind(null,t,e,n),e.then(t,t))}function YI(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function JI(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=$a(-1,1),e.tag=2,Vl(n,e,1))),n.lanes|=1),t)}var Sj=el.ReactCurrentOwner,$r=!1;function _r(t,e,n,i){e.child=t===null?ZF(e,null,n,i):Ed(e,t.child,n,i)}function QI(t,e,n,i,r){n=n.render;var s=e.ref;return od(e,r),i=Vb(t,e,n,i,s,r),n=jb(),t!==null&&!$r?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Xa(t,e,r)):(Nn&&n&&Mb(e),e.flags|=1,_r(t,e,i,r),e.child)}function ZI(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!e2(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Rz(t,e,s,i,r)):(t=Ay(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Ng,n(o,i)&&t.ref===e.ref)return Xa(t,e,r)}return e.flags|=1,t=Gl(s,i),t.ref=e.ref,t.return=e,e.child=t}function Rz(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Ng(s,i)&&t.ref===e.ref)if($r=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&($r=!0);else return e.lanes=t.lanes,Xa(t,e,r)}return qE(t,e,n,i,r)}function Tz(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_n(qh,us),us|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,_n(qh,us),us|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,_n(qh,us),us|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,_n(qh,us),us|=i;return _r(t,e,r,n),e.child}function bz(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function qE(t,e,n,i,r){var s=jr(n)?wu:fr.current;return s=_d(e,s),od(e,r),n=Vb(t,e,n,i,s,r),i=jb(),t!==null&&!$r?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Xa(t,e,r)):(Nn&&i&&Mb(e),e.flags|=1,_r(t,e,n,r),e.child)}function eM(t,e,n,i,r){if(jr(n)){var s=!0;a1(e)}else s=!1;if(od(e,r),e.stateNode===null)Ry(t,e),_z(e,n,i),WE(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Xs(c):(c=jr(n)?wu:fr.current,c=_d(e,c));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&XI(e,o,i,c),Cl=!1;var d=e.memoizedState;o.state=d,d1(e,i,o,r),l=e.memoizedState,a!==i||d!==l||Vr.current||Cl?(typeof u=="function"&&(jE(e,n,u,i),l=e.memoizedState),(a=Cl||qI(e,n,a,i,d,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,tz(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:po(e.type,a),o.props=c,h=e.pendingProps,d=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Xs(l):(l=jr(n)?wu:fr.current,l=_d(e,l));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&XI(e,o,i,l),Cl=!1,d=e.memoizedState,o.state=d,d1(e,i,o,r);var f=e.memoizedState;a!==h||d!==f||Vr.current||Cl?(typeof p=="function"&&(jE(e,n,p,i),f=e.memoizedState),(c=Cl||qI(e,n,c,i,d,f,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,f,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,f,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return XE(t,e,n,i,s,r)}function XE(t,e,n,i,r,s){bz(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&UI(e,n,!1),Xa(t,e,s);i=e.stateNode,Sj.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Ed(e,t.child,null,s),e.child=Ed(e,null,a,s)):_r(t,e,a,s),e.memoizedState=i.state,r&&UI(e,n,!0),e.child}function Az(t){var e=t.stateNode;e.pendingContext?zI(t,e.pendingContext,e.pendingContext!==e.context):e.context&&zI(t,e.context,!1),Ub(t,e.containerInfo)}function tM(t,e,n,i,r){return wd(),Lb(r),e.flags|=256,_r(t,e,n,i),e.child}var KE={dehydrated:null,treeContext:null,retryLane:0};function YE(t){return{baseLanes:t,cachePool:null,transitions:null}}function Pz(t,e,n){var i=e.pendingProps,r=Un.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),_n(Un,r&1),t===null)return HE(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=TS(o,i,0,null),t=vu(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=YE(n),e.memoizedState=KE,t):qb(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return xj(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Gl(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Gl(a,s):(s=vu(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?YE(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=KE,i}return s=t.child,t=s.sibling,i=Gl(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function qb(t,e){return e=TS({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function mv(t,e,n,i){return i!==null&&Lb(i),Ed(e,t.child,null,n),t=qb(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function xj(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=g_(Error(ge(422))),mv(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=TS({mode:"visible",children:i.children},r,0,null),s=vu(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Ed(e,t.child,null,o),e.child.memoizedState=YE(o),e.memoizedState=KE,s);if(!(e.mode&1))return mv(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(ge(419)),i=g_(s,i,void 0),mv(t,e,o,i)}if(a=(o&t.childLanes)!==0,$r||a){if(i=Li,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,qa(t,r),bo(i,t,r,-1))}return Zb(),i=g_(Error(ge(421))),mv(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Lj.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,ps=Hl(r.nextSibling),vs=e,Nn=!0,yo=null,t!==null&&(Ds[Ns++]=Oa,Ds[Ns++]=Fa,Ds[Ns++]=Eu,Oa=t.id,Fa=t.overflow,Eu=e),e=qb(e,i.children),e.flags|=4096,e)}function nM(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),VE(t.return,e,n)}function v_(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Iz(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(_r(t,e,i.children,n),i=Un.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&nM(t,n,e);else if(t.tag===19)nM(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(_n(Un,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&p1(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),v_(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&p1(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}v_(e,!0,n,null,s);break;case"together":v_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ry(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xa(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Tu|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ge(153));if(e.child!==null){for(t=e.child,n=Gl(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Gl(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Cj(t,e,n){switch(e.tag){case 3:Az(e),wd();break;case 5:nz(e);break;case 1:jr(e.type)&&a1(e);break;case 4:Ub(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;_n(u1,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(_n(Un,Un.current&1),e.flags|=128,null):n&e.child.childLanes?Pz(t,e,n):(_n(Un,Un.current&1),t=Xa(t,e,n),t!==null?t.sibling:null);_n(Un,Un.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Iz(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),_n(Un,Un.current),i)break;return null;case 22:case 23:return e.lanes=0,Tz(t,e,n)}return Xa(t,e,n)}var Mz,JE,kz,Lz;Mz=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};JE=function(){};kz=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,uu(sa.current);var s=null;switch(n){case"input":r=SE(t,r),i=SE(t,i),s=[];break;case"select":r=jn({},r,{value:void 0}),i=jn({},i,{value:void 0}),s=[];break;case"textarea":r=_E(t,r),i=_E(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=s1)}EE(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ag.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ag.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&An("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Lz=function(t,e,n,i){n!==i&&(e.flags|=4)};function Bp(t,e){if(!Nn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Qi(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function _j(t,e,n){var i=e.pendingProps;switch(kb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qi(e),null;case 1:return jr(e.type)&&o1(),Qi(e),null;case 3:return i=e.stateNode,Rd(),Mn(Vr),Mn(fr),$b(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(pv(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,yo!==null&&(sR(yo),yo=null))),JE(t,e),Qi(e),null;case 5:Bb(e);var r=uu(Bg.current);if(n=e.type,t!==null&&e.stateNode!=null)kz(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(ge(166));return Qi(e),null}if(t=uu(sa.current),pv(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Qo]=e,i[zg]=s,t=(e.mode&1)!==0,n){case"dialog":An("cancel",i),An("close",i);break;case"iframe":case"object":case"embed":An("load",i);break;case"video":case"audio":for(r=0;r<Ym.length;r++)An(Ym[r],i);break;case"source":An("error",i);break;case"img":case"image":case"link":An("error",i),An("load",i);break;case"details":An("toggle",i);break;case"input":hI(i,s),An("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},An("invalid",i);break;case"textarea":pI(i,s),An("invalid",i)}EE(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&dv(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&dv(i.textContent,a,t),r=["children",""+a]):Ag.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&An("scroll",i)}switch(n){case"input":rv(i),dI(i,s,!0);break;case"textarea":rv(i),fI(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=s1)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=aF(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Qo]=e,t[zg]=i,Mz(t,e,!1,!1),e.stateNode=t;e:{switch(o=RE(n,i),n){case"dialog":An("cancel",t),An("close",t),r=i;break;case"iframe":case"object":case"embed":An("load",t),r=i;break;case"video":case"audio":for(r=0;r<Ym.length;r++)An(Ym[r],t);r=i;break;case"source":An("error",t),r=i;break;case"img":case"image":case"link":An("error",t),An("load",t),r=i;break;case"details":An("toggle",t),r=i;break;case"input":hI(t,i),r=SE(t,i),An("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=jn({},i,{value:void 0}),An("invalid",t);break;case"textarea":pI(t,i),r=_E(t,i),An("invalid",t);break;default:r=i}EE(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?uF(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&lF(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Pg(t,l):typeof l=="number"&&Pg(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ag.hasOwnProperty(s)?l!=null&&s==="onScroll"&&An("scroll",t):l!=null&&vb(t,s,l,o))}switch(n){case"input":rv(t),dI(t,i,!1);break;case"textarea":rv(t),fI(t);break;case"option":i.value!=null&&t.setAttribute("value",""+ec(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?nd(t,!!i.multiple,s,!1):i.defaultValue!=null&&nd(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=s1)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Qi(e),null;case 6:if(t&&e.stateNode!=null)Lz(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ge(166));if(n=uu(Bg.current),uu(sa.current),pv(e)){if(i=e.stateNode,n=e.memoizedProps,i[Qo]=e,(s=i.nodeValue!==n)&&(t=vs,t!==null))switch(t.tag){case 3:dv(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&dv(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Qo]=e,e.stateNode=i}return Qi(e),null;case 13:if(Mn(Un),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Nn&&ps!==null&&e.mode&1&&!(e.flags&128))JF(),wd(),e.flags|=98560,s=!1;else if(s=pv(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(ge(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ge(317));s[Qo]=e}else wd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Qi(e),s=!1}else yo!==null&&(sR(yo),yo=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Un.current&1?xi===0&&(xi=3):Zb())),e.updateQueue!==null&&(e.flags|=4),Qi(e),null);case 4:return Rd(),JE(t,e),t===null&&Og(e.stateNode.containerInfo),Qi(e),null;case 10:return Ob(e.type._context),Qi(e),null;case 17:return jr(e.type)&&o1(),Qi(e),null;case 19:if(Mn(Un),s=e.memoizedState,s===null)return Qi(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Bp(s,!1);else{if(xi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=p1(t),o!==null){for(e.flags|=128,Bp(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return _n(Un,Un.current&1|2),e.child}t=t.sibling}s.tail!==null&&ni()>bd&&(e.flags|=128,i=!0,Bp(s,!1),e.lanes=4194304)}else{if(!i)if(t=p1(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Bp(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Nn)return Qi(e),null}else 2*ni()-s.renderingStartTime>bd&&n!==1073741824&&(e.flags|=128,i=!0,Bp(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ni(),e.sibling=null,n=Un.current,_n(Un,i?n&1|2:n&1),e):(Qi(e),null);case 22:case 23:return Qb(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?us&1073741824&&(Qi(e),e.subtreeFlags&6&&(e.flags|=8192)):Qi(e),null;case 24:return null;case 25:return null}throw Error(ge(156,e.tag))}function wj(t,e){switch(kb(e),e.tag){case 1:return jr(e.type)&&o1(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Rd(),Mn(Vr),Mn(fr),$b(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Bb(e),null;case 13:if(Mn(Un),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ge(340));wd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Mn(Un),null;case 4:return Rd(),null;case 10:return Ob(e.type._context),null;case 22:case 23:return Qb(),null;case 24:return null;default:return null}}var gv=!1,lr=!1,Ej=typeof WeakSet=="function"?WeakSet:Set,Ue=null;function Gh(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Xn(t,e,i)}else n.current=null}function QE(t,e,n){try{n()}catch(i){Xn(t,e,i)}}var iM=!1;function Rj(t,e){if(NE=n1,t=zF(),Ib(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,d=null;t:for(;;){for(var p;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===t)break t;if(d===n&&++c===r&&(a=o),d===s&&++u===i&&(l=o),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(OE={focusedElem:t,selectionRange:n},n1=!1,Ue=e;Ue!==null;)if(e=Ue,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ue=t;else for(;Ue!==null;){e=Ue;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var v=f.memoizedProps,g=f.memoizedState,m=e.stateNode,y=m.getSnapshotBeforeUpdate(e.elementType===e.type?v:po(e.type,v),g);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ge(163))}}catch(x){Xn(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,Ue=t;break}Ue=e.return}return f=iM,iM=!1,f}function fg(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&QE(e,n,s)}r=r.next}while(r!==i)}}function ES(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function ZE(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Dz(t){var e=t.alternate;e!==null&&(t.alternate=null,Dz(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qo],delete e[zg],delete e[UE],delete e[aj],delete e[lj])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Nz(t){return t.tag===5||t.tag===3||t.tag===4}function rM(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Nz(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function eR(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=s1));else if(i!==4&&(t=t.child,t!==null))for(eR(t,e,n),t=t.sibling;t!==null;)eR(t,e,n),t=t.sibling}function tR(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(tR(t,e,n),t=t.sibling;t!==null;)tR(t,e,n),t=t.sibling}var $i=null,mo=!1;function al(t,e,n){for(n=n.child;n!==null;)Oz(t,e,n),n=n.sibling}function Oz(t,e,n){if(ra&&typeof ra.onCommitFiberUnmount=="function")try{ra.onCommitFiberUnmount(gS,n)}catch{}switch(n.tag){case 5:lr||Gh(n,e);case 6:var i=$i,r=mo;$i=null,al(t,e,n),$i=i,mo=r,$i!==null&&(mo?(t=$i,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):$i.removeChild(n.stateNode));break;case 18:$i!==null&&(mo?(t=$i,n=n.stateNode,t.nodeType===8?u_(t.parentNode,n):t.nodeType===1&&u_(t,n),Lg(t)):u_($i,n.stateNode));break;case 4:i=$i,r=mo,$i=n.stateNode.containerInfo,mo=!0,al(t,e,n),$i=i,mo=r;break;case 0:case 11:case 14:case 15:if(!lr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&QE(n,e,o),r=r.next}while(r!==i)}al(t,e,n);break;case 1:if(!lr&&(Gh(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Xn(n,e,a)}al(t,e,n);break;case 21:al(t,e,n);break;case 22:n.mode&1?(lr=(i=lr)||n.memoizedState!==null,al(t,e,n),lr=i):al(t,e,n);break;default:al(t,e,n)}}function sM(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Ej),e.forEach(function(i){var r=Dj.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function ao(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:$i=a.stateNode,mo=!1;break e;case 3:$i=a.stateNode.containerInfo,mo=!0;break e;case 4:$i=a.stateNode.containerInfo,mo=!0;break e}a=a.return}if($i===null)throw Error(ge(160));Oz(s,o,r),$i=null,mo=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Xn(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Fz(e,t),e=e.sibling}function Fz(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ao(e,t),Vo(t),i&4){try{fg(3,t,t.return),ES(3,t)}catch(v){Xn(t,t.return,v)}try{fg(5,t,t.return)}catch(v){Xn(t,t.return,v)}}break;case 1:ao(e,t),Vo(t),i&512&&n!==null&&Gh(n,n.return);break;case 5:if(ao(e,t),Vo(t),i&512&&n!==null&&Gh(n,n.return),t.flags&32){var r=t.stateNode;try{Pg(r,"")}catch(v){Xn(t,t.return,v)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&sF(r,s),RE(a,o);var c=RE(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?uF(r,h):u==="dangerouslySetInnerHTML"?lF(r,h):u==="children"?Pg(r,h):vb(r,u,h,c)}switch(a){case"input":xE(r,s);break;case"textarea":oF(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?nd(r,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?nd(r,!!s.multiple,s.defaultValue,!0):nd(r,!!s.multiple,s.multiple?[]:"",!1))}r[zg]=s}catch(v){Xn(t,t.return,v)}}break;case 6:if(ao(e,t),Vo(t),i&4){if(t.stateNode===null)throw Error(ge(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(v){Xn(t,t.return,v)}}break;case 3:if(ao(e,t),Vo(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Lg(e.containerInfo)}catch(v){Xn(t,t.return,v)}break;case 4:ao(e,t),Vo(t);break;case 13:ao(e,t),Vo(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Yb=ni())),i&4&&sM(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(lr=(c=lr)||u,ao(e,t),lr=c):ao(e,t),Vo(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(Ue=t,u=t.child;u!==null;){for(h=Ue=u;Ue!==null;){switch(d=Ue,p=d.child,d.tag){case 0:case 11:case 14:case 15:fg(4,d,d.return);break;case 1:Gh(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){i=d,n=d.return;try{e=i,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(v){Xn(i,n,v)}}break;case 5:Gh(d,d.return);break;case 22:if(d.memoizedState!==null){aM(h);continue}}p!==null?(p.return=d,Ue=p):aM(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=cF("display",o))}catch(v){Xn(t,t.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){Xn(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ao(e,t),Vo(t),i&4&&sM(t);break;case 21:break;default:ao(e,t),Vo(t)}}function Vo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Nz(n)){var i=n;break e}n=n.return}throw Error(ge(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Pg(r,""),i.flags&=-33);var s=rM(t);tR(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=rM(t);eR(t,a,o);break;default:throw Error(ge(161))}}catch(l){Xn(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Tj(t,e,n){Ue=t,zz(t)}function zz(t,e,n){for(var i=(t.mode&1)!==0;Ue!==null;){var r=Ue,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||gv;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||lr;a=gv;var c=lr;if(gv=o,(lr=l)&&!c)for(Ue=r;Ue!==null;)o=Ue,l=o.child,o.tag===22&&o.memoizedState!==null?lM(r):l!==null?(l.return=o,Ue=l):lM(r);for(;s!==null;)Ue=s,zz(s),s=s.sibling;Ue=r,gv=a,lr=c}oM(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Ue=s):oM(t)}}function oM(t){for(;Ue!==null;){var e=Ue;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:lr||ES(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!lr)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:po(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&jI(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}jI(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Lg(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ge(163))}lr||e.flags&512&&ZE(e)}catch(d){Xn(e,e.return,d)}}if(e===t){Ue=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ue=n;break}Ue=e.return}}function aM(t){for(;Ue!==null;){var e=Ue;if(e===t){Ue=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ue=n;break}Ue=e.return}}function lM(t){for(;Ue!==null;){var e=Ue;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ES(4,e)}catch(l){Xn(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Xn(e,r,l)}}var s=e.return;try{ZE(e)}catch(l){Xn(e,s,l)}break;case 5:var o=e.return;try{ZE(e)}catch(l){Xn(e,o,l)}}}catch(l){Xn(e,e.return,l)}if(e===t){Ue=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ue=a;break}Ue=e.return}}var bj=Math.ceil,g1=el.ReactCurrentDispatcher,Xb=el.ReactCurrentOwner,Gs=el.ReactCurrentBatchConfig,Yt=0,Li=null,ui=null,ji=0,us=0,qh=pc(0),xi=0,jg=null,Tu=0,RS=0,Kb=0,mg=null,Br=null,Yb=0,bd=1/0,Pa=null,v1=!1,nR=null,jl=null,vv=!1,kl=null,y1=0,gg=0,iR=null,Ty=-1,by=0;function Rr(){return Yt&6?ni():Ty!==-1?Ty:Ty=ni()}function Wl(t){return t.mode&1?Yt&2&&ji!==0?ji&-ji:uj.transition!==null?(by===0&&(by=_F()),by):(t=cn,t!==0||(t=window.event,t=t===void 0?16:PF(t.type)),t):1}function bo(t,e,n,i){if(50<gg)throw gg=0,iR=null,Error(ge(185));v0(t,n,i),(!(Yt&2)||t!==Li)&&(t===Li&&(!(Yt&2)&&(RS|=n),xi===4&&bl(t,ji)),Wr(t,i),n===1&&Yt===0&&!(e.mode&1)&&(bd=ni()+500,CS&&fc()))}function Wr(t,e){var n=t.callbackNode;u9(t,e);var i=t1(t,t===Li?ji:0);if(i===0)n!==null&&vI(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&vI(n),e===1)t.tag===0?cj(cM.bind(null,t)):XF(cM.bind(null,t)),sj(function(){!(Yt&6)&&fc()}),n=null;else{switch(wF(i)){case 1:n=_b;break;case 4:n=xF;break;case 16:n=e1;break;case 536870912:n=CF;break;default:n=e1}n=Gz(n,Uz.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Uz(t,e){if(Ty=-1,by=0,Yt&6)throw Error(ge(327));var n=t.callbackNode;if(ad()&&t.callbackNode!==n)return null;var i=t1(t,t===Li?ji:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=S1(t,i);else{e=i;var r=Yt;Yt|=2;var s=$z();(Li!==t||ji!==e)&&(Pa=null,bd=ni()+500,gu(t,e));do try{Ij();break}catch(a){Bz(t,a)}while(!0);Nb(),g1.current=s,Yt=r,ui!==null?e=0:(Li=null,ji=0,e=xi)}if(e!==0){if(e===2&&(r=IE(t),r!==0&&(i=r,e=rR(t,r))),e===1)throw n=jg,gu(t,0),bl(t,i),Wr(t,ni()),n;if(e===6)bl(t,i);else{if(r=t.current.alternate,!(i&30)&&!Aj(r)&&(e=S1(t,i),e===2&&(s=IE(t),s!==0&&(i=s,e=rR(t,s))),e===1))throw n=jg,gu(t,0),bl(t,i),Wr(t,ni()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(ge(345));case 2:Yc(t,Br,Pa);break;case 3:if(bl(t,i),(i&130023424)===i&&(e=Yb+500-ni(),10<e)){if(t1(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Rr(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=zE(Yc.bind(null,t,Br,Pa),e);break}Yc(t,Br,Pa);break;case 4:if(bl(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-To(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=ni()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*bj(i/1960))-i,10<i){t.timeoutHandle=zE(Yc.bind(null,t,Br,Pa),i);break}Yc(t,Br,Pa);break;case 5:Yc(t,Br,Pa);break;default:throw Error(ge(329))}}}return Wr(t,ni()),t.callbackNode===n?Uz.bind(null,t):null}function rR(t,e){var n=mg;return t.current.memoizedState.isDehydrated&&(gu(t,e).flags|=256),t=S1(t,e),t!==2&&(e=Br,Br=n,e!==null&&sR(e)),t}function sR(t){Br===null?Br=t:Br.push.apply(Br,t)}function Aj(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Po(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function bl(t,e){for(e&=~Kb,e&=~RS,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-To(e),i=1<<n;t[n]=-1,e&=~i}}function cM(t){if(Yt&6)throw Error(ge(327));ad();var e=t1(t,0);if(!(e&1))return Wr(t,ni()),null;var n=S1(t,e);if(t.tag!==0&&n===2){var i=IE(t);i!==0&&(e=i,n=rR(t,i))}if(n===1)throw n=jg,gu(t,0),bl(t,e),Wr(t,ni()),n;if(n===6)throw Error(ge(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Yc(t,Br,Pa),Wr(t,ni()),null}function Jb(t,e){var n=Yt;Yt|=1;try{return t(e)}finally{Yt=n,Yt===0&&(bd=ni()+500,CS&&fc())}}function bu(t){kl!==null&&kl.tag===0&&!(Yt&6)&&ad();var e=Yt;Yt|=1;var n=Gs.transition,i=cn;try{if(Gs.transition=null,cn=1,t)return t()}finally{cn=i,Gs.transition=n,Yt=e,!(Yt&6)&&fc()}}function Qb(){us=qh.current,Mn(qh)}function gu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,rj(n)),ui!==null)for(n=ui.return;n!==null;){var i=n;switch(kb(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&o1();break;case 3:Rd(),Mn(Vr),Mn(fr),$b();break;case 5:Bb(i);break;case 4:Rd();break;case 13:Mn(Un);break;case 19:Mn(Un);break;case 10:Ob(i.type._context);break;case 22:case 23:Qb()}n=n.return}if(Li=t,ui=t=Gl(t.current,null),ji=us=e,xi=0,jg=null,Kb=RS=Tu=0,Br=mg=null,cu!==null){for(e=0;e<cu.length;e++)if(n=cu[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}cu=null}return t}function Bz(t,e){do{var n=ui;try{if(Nb(),wy.current=m1,f1){for(var i=Vn.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}f1=!1}if(Ru=0,Mi=gi=Vn=null,pg=!1,$g=0,Xb.current=null,n===null||n.return===null){xi=1,jg=e,ui=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=ji,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=YI(o);if(p!==null){p.flags&=-257,JI(p,o,a,s,e),p.mode&1&&KI(s,c,e),e=p,l=c;var f=e.updateQueue;if(f===null){var v=new Set;v.add(l),e.updateQueue=v}else f.add(l);break e}else{if(!(e&1)){KI(s,c,e),Zb();break e}l=Error(ge(426))}}else if(Nn&&a.mode&1){var g=YI(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),JI(g,o,a,s,e),Lb(Td(l,a));break e}}s=l=Td(l,a),xi!==4&&(xi=2),mg===null?mg=[s]:mg.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=wz(s,l,e);VI(s,m);break e;case 1:a=l;var y=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(jl===null||!jl.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var x=Ez(s,a,e);VI(s,x);break e}}s=s.return}while(s!==null)}Vz(n)}catch(w){e=w,ui===n&&n!==null&&(ui=n=n.return);continue}break}while(!0)}function $z(){var t=g1.current;return g1.current=m1,t===null?m1:t}function Zb(){(xi===0||xi===3||xi===2)&&(xi=4),Li===null||!(Tu&268435455)&&!(RS&268435455)||bl(Li,ji)}function S1(t,e){var n=Yt;Yt|=2;var i=$z();(Li!==t||ji!==e)&&(Pa=null,gu(t,e));do try{Pj();break}catch(r){Bz(t,r)}while(!0);if(Nb(),Yt=n,g1.current=i,ui!==null)throw Error(ge(261));return Li=null,ji=0,xi}function Pj(){for(;ui!==null;)Hz(ui)}function Ij(){for(;ui!==null&&!t9();)Hz(ui)}function Hz(t){var e=Wz(t.alternate,t,us);t.memoizedProps=t.pendingProps,e===null?Vz(t):ui=e,Xb.current=null}function Vz(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=wj(n,e),n!==null){n.flags&=32767,ui=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xi=6,ui=null;return}}else if(n=_j(n,e,us),n!==null){ui=n;return}if(e=e.sibling,e!==null){ui=e;return}ui=e=t}while(e!==null);xi===0&&(xi=5)}function Yc(t,e,n){var i=cn,r=Gs.transition;try{Gs.transition=null,cn=1,Mj(t,e,n,i)}finally{Gs.transition=r,cn=i}return null}function Mj(t,e,n,i){do ad();while(kl!==null);if(Yt&6)throw Error(ge(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ge(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(h9(t,s),t===Li&&(ui=Li=null,ji=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vv||(vv=!0,Gz(e1,function(){return ad(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Gs.transition,Gs.transition=null;var o=cn;cn=1;var a=Yt;Yt|=4,Xb.current=null,Rj(t,n),Fz(n,t),J9(OE),n1=!!NE,OE=NE=null,t.current=n,Tj(n),n9(),Yt=a,cn=o,Gs.transition=s}else t.current=n;if(vv&&(vv=!1,kl=t,y1=r),s=t.pendingLanes,s===0&&(jl=null),s9(n.stateNode),Wr(t,ni()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(v1)throw v1=!1,t=nR,nR=null,t;return y1&1&&t.tag!==0&&ad(),s=t.pendingLanes,s&1?t===iR?gg++:(gg=0,iR=t):gg=0,fc(),null}function ad(){if(kl!==null){var t=wF(y1),e=Gs.transition,n=cn;try{if(Gs.transition=null,cn=16>t?16:t,kl===null)var i=!1;else{if(t=kl,kl=null,y1=0,Yt&6)throw Error(ge(331));var r=Yt;for(Yt|=4,Ue=t.current;Ue!==null;){var s=Ue,o=s.child;if(Ue.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Ue=c;Ue!==null;){var u=Ue;switch(u.tag){case 0:case 11:case 15:fg(8,u,s)}var h=u.child;if(h!==null)h.return=u,Ue=h;else for(;Ue!==null;){u=Ue;var d=u.sibling,p=u.return;if(Dz(u),u===c){Ue=null;break}if(d!==null){d.return=p,Ue=d;break}Ue=p}}}var f=s.alternate;if(f!==null){var v=f.child;if(v!==null){f.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(v!==null)}}Ue=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Ue=o;else e:for(;Ue!==null;){if(s=Ue,s.flags&2048)switch(s.tag){case 0:case 11:case 15:fg(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,Ue=m;break e}Ue=s.return}}var y=t.current;for(Ue=y;Ue!==null;){o=Ue;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,Ue=S;else e:for(o=y;Ue!==null;){if(a=Ue,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ES(9,a)}}catch(w){Xn(a,a.return,w)}if(a===o){Ue=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,Ue=x;break e}Ue=a.return}}if(Yt=r,fc(),ra&&typeof ra.onPostCommitFiberRoot=="function")try{ra.onPostCommitFiberRoot(gS,t)}catch{}i=!0}return i}finally{cn=n,Gs.transition=e}}return!1}function uM(t,e,n){e=Td(n,e),e=wz(t,e,1),t=Vl(t,e,1),e=Rr(),t!==null&&(v0(t,1,e),Wr(t,e))}function Xn(t,e,n){if(t.tag===3)uM(t,t,n);else for(;e!==null;){if(e.tag===3){uM(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(jl===null||!jl.has(i))){t=Td(n,t),t=Ez(e,t,1),e=Vl(e,t,1),t=Rr(),e!==null&&(v0(e,1,t),Wr(e,t));break}}e=e.return}}function kj(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Rr(),t.pingedLanes|=t.suspendedLanes&n,Li===t&&(ji&n)===n&&(xi===4||xi===3&&(ji&130023424)===ji&&500>ni()-Yb?gu(t,0):Kb|=n),Wr(t,e)}function jz(t,e){e===0&&(t.mode&1?(e=av,av<<=1,!(av&130023424)&&(av=4194304)):e=1);var n=Rr();t=qa(t,e),t!==null&&(v0(t,e,n),Wr(t,n))}function Lj(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),jz(t,n)}function Dj(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(ge(314))}i!==null&&i.delete(e),jz(t,n)}var Wz;Wz=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Vr.current)$r=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return $r=!1,Cj(t,e,n);$r=!!(t.flags&131072)}else $r=!1,Nn&&e.flags&1048576&&KF(e,c1,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ry(t,e),t=e.pendingProps;var r=_d(e,fr.current);od(e,n),r=Vb(null,e,i,t,r,n);var s=jb();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,jr(i)?(s=!0,a1(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,zb(e),r.updater=wS,e.stateNode=r,r._reactInternals=e,WE(e,i,t,n),e=XE(null,e,i,!0,s,n)):(e.tag=0,Nn&&s&&Mb(e),_r(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Ry(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Oj(i),t=po(i,t),r){case 0:e=qE(null,e,i,t,n);break e;case 1:e=eM(null,e,i,t,n);break e;case 11:e=QI(null,e,i,t,n);break e;case 14:e=ZI(null,e,i,po(i.type,t),n);break e}throw Error(ge(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),qE(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),eM(t,e,i,r,n);case 3:e:{if(Az(e),t===null)throw Error(ge(387));i=e.pendingProps,s=e.memoizedState,r=s.element,tz(t,e),d1(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Td(Error(ge(423)),e),e=tM(t,e,i,n,r);break e}else if(i!==r){r=Td(Error(ge(424)),e),e=tM(t,e,i,n,r);break e}else for(ps=Hl(e.stateNode.containerInfo.firstChild),vs=e,Nn=!0,yo=null,n=ZF(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wd(),i===r){e=Xa(t,e,n);break e}_r(t,e,i,n)}e=e.child}return e;case 5:return nz(e),t===null&&HE(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,FE(i,r)?o=null:s!==null&&FE(i,s)&&(e.flags|=32),bz(t,e),_r(t,e,o,n),e.child;case 6:return t===null&&HE(e),null;case 13:return Pz(t,e,n);case 4:return Ub(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Ed(e,null,i,n):_r(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),QI(t,e,i,r,n);case 7:return _r(t,e,e.pendingProps,n),e.child;case 8:return _r(t,e,e.pendingProps.children,n),e.child;case 12:return _r(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,_n(u1,i._currentValue),i._currentValue=o,s!==null)if(Po(s.value,o)){if(s.children===r.children&&!Vr.current){e=Xa(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=$a(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),VE(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ge(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),VE(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}_r(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,od(e,n),r=Xs(r),i=i(r),e.flags|=1,_r(t,e,i,n),e.child;case 14:return i=e.type,r=po(i,e.pendingProps),r=po(i.type,r),ZI(t,e,i,r,n);case 15:return Rz(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:po(i,r),Ry(t,e),e.tag=1,jr(i)?(t=!0,a1(e)):t=!1,od(e,n),_z(e,i,r),WE(e,i,r,n),XE(null,e,i,!0,t,n);case 19:return Iz(t,e,n);case 22:return Tz(t,e,n)}throw Error(ge(156,e.tag))};function Gz(t,e){return SF(t,e)}function Nj(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(t,e,n,i){return new Nj(t,e,n,i)}function e2(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Oj(t){if(typeof t=="function")return e2(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Sb)return 11;if(t===xb)return 14}return 2}function Gl(t,e){var n=t.alternate;return n===null?(n=Us(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ay(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")e2(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Fh:return vu(n.children,r,s,e);case yb:o=8,r|=8;break;case mE:return t=Us(12,n,e,r|2),t.elementType=mE,t.lanes=s,t;case gE:return t=Us(13,n,e,r),t.elementType=gE,t.lanes=s,t;case vE:return t=Us(19,n,e,r),t.elementType=vE,t.lanes=s,t;case nF:return TS(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case eF:o=10;break e;case tF:o=9;break e;case Sb:o=11;break e;case xb:o=14;break e;case xl:o=16,i=null;break e}throw Error(ge(130,t==null?t:typeof t,""))}return e=Us(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function vu(t,e,n,i){return t=Us(7,t,i,e),t.lanes=n,t}function TS(t,e,n,i){return t=Us(22,t,i,e),t.elementType=nF,t.lanes=n,t.stateNode={isHidden:!1},t}function y_(t,e,n){return t=Us(6,t,null,e),t.lanes=n,t}function S_(t,e,n){return e=Us(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Fj(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ZC(0),this.expirationTimes=ZC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ZC(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function t2(t,e,n,i,r,s,o,a,l){return t=new Fj(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Us(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},zb(s),t}function zj(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oh,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function qz(t){if(!t)return tc;t=t._reactInternals;e:{if(Gu(t)!==t||t.tag!==1)throw Error(ge(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(jr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ge(171))}if(t.tag===1){var n=t.type;if(jr(n))return qF(t,n,e)}return e}function Xz(t,e,n,i,r,s,o,a,l){return t=t2(n,i,!0,t,r,s,o,a,l),t.context=qz(null),n=t.current,i=Rr(),r=Wl(n),s=$a(i,r),s.callback=e??null,Vl(n,s,r),t.current.lanes=r,v0(t,r,i),Wr(t,i),t}function bS(t,e,n,i){var r=e.current,s=Rr(),o=Wl(r);return n=qz(n),e.context===null?e.context=n:e.pendingContext=n,e=$a(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Vl(r,e,o),t!==null&&(bo(t,r,o,s),_y(t,r,o)),o}function x1(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function hM(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function n2(t,e){hM(t,e),(t=t.alternate)&&hM(t,e)}function Uj(){return null}var Kz=typeof reportError=="function"?reportError:function(t){console.error(t)};function i2(t){this._internalRoot=t}AS.prototype.render=i2.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ge(409));bS(t,e,null,null)};AS.prototype.unmount=i2.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;bu(function(){bS(null,t,null,null)}),e[Ga]=null}};function AS(t){this._internalRoot=t}AS.prototype.unstable_scheduleHydration=function(t){if(t){var e=TF();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Tl.length&&e!==0&&e<Tl[n].priority;n++);Tl.splice(n,0,t),n===0&&AF(t)}};function r2(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function PS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function dM(){}function Bj(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=x1(o);s.call(c)}}var o=Xz(e,i,t,0,null,!1,!1,"",dM);return t._reactRootContainer=o,t[Ga]=o.current,Og(t.nodeType===8?t.parentNode:t),bu(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=x1(l);a.call(c)}}var l=t2(t,0,!1,null,null,!1,!1,"",dM);return t._reactRootContainer=l,t[Ga]=l.current,Og(t.nodeType===8?t.parentNode:t),bu(function(){bS(e,l,n,i)}),l}function IS(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=x1(o);a.call(l)}}bS(e,o,t,r)}else o=Bj(n,e,t,r,i);return x1(o)}EF=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Km(e.pendingLanes);n!==0&&(wb(e,n|1),Wr(e,ni()),!(Yt&6)&&(bd=ni()+500,fc()))}break;case 13:bu(function(){var i=qa(t,1);if(i!==null){var r=Rr();bo(i,t,1,r)}}),n2(t,1)}};Eb=function(t){if(t.tag===13){var e=qa(t,134217728);if(e!==null){var n=Rr();bo(e,t,134217728,n)}n2(t,134217728)}};RF=function(t){if(t.tag===13){var e=Wl(t),n=qa(t,e);if(n!==null){var i=Rr();bo(n,t,e,i)}n2(t,e)}};TF=function(){return cn};bF=function(t,e){var n=cn;try{return cn=t,e()}finally{cn=n}};bE=function(t,e,n){switch(e){case"input":if(xE(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=xS(i);if(!r)throw Error(ge(90));rF(i),xE(i,r)}}}break;case"textarea":oF(t,n);break;case"select":e=n.value,e!=null&&nd(t,!!n.multiple,e,!1)}};pF=Jb;fF=bu;var $j={usingClientEntryPoint:!1,Events:[S0,$h,xS,hF,dF,Jb]},$p={findFiberByHostInstance:lu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hj={bundleType:$p.bundleType,version:$p.version,rendererPackageName:$p.rendererPackageName,rendererConfig:$p.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:el.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=vF(t),t===null?null:t.stateNode},findFiberByHostInstance:$p.findFiberByHostInstance||Uj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yv.isDisabled&&yv.supportsFiber)try{gS=yv.inject(Hj),ra=yv}catch{}}ws.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$j;ws.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!r2(e))throw Error(ge(200));return zj(t,e,null,n)};ws.createRoot=function(t,e){if(!r2(t))throw Error(ge(299));var n=!1,i="",r=Kz;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=t2(t,1,!1,null,null,n,!1,i,r),t[Ga]=e.current,Og(t.nodeType===8?t.parentNode:t),new i2(e)};ws.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ge(188)):(t=Object.keys(t).join(","),Error(ge(268,t)));return t=vF(e),t=t===null?null:t.stateNode,t};ws.flushSync=function(t){return bu(t)};ws.hydrate=function(t,e,n){if(!PS(e))throw Error(ge(200));return IS(null,t,e,!0,n)};ws.hydrateRoot=function(t,e,n){if(!r2(t))throw Error(ge(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Kz;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Xz(e,null,t,1,n??null,r,!1,s,o),t[Ga]=e.current,Og(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new AS(e)};ws.render=function(t,e,n){if(!PS(e))throw Error(ge(200));return IS(null,t,e,!1,n)};ws.unmountComponentAtNode=function(t){if(!PS(t))throw Error(ge(40));return t._reactRootContainer?(bu(function(){IS(null,null,t,!1,function(){t._reactRootContainer=null,t[Ga]=null})}),!0):!1};ws.unstable_batchedUpdates=Jb;ws.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!PS(n))throw Error(ge(200));if(t==null||t._reactInternals===void 0)throw Error(ge(38));return IS(t,e,n,!1,i)};ws.version="18.3.1-next-f1338f8080-20240426";function Yz(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Yz)}catch(t){console.error(t)}}Yz(),Y4.exports=ws;var s2=Y4.exports;const Vj=fS(s2),jj=cb({__proto__:null,default:Vj},[s2]);var Jz,pM=s2;Jz=pM.createRoot,pM.hydrateRoot;/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wj=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Qz=(...t)=>t.filter((e,n,i)=>!!e&&i.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Gj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qj=he.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:s,iconNode:o,...a},l)=>he.createElement("svg",{ref:l,...Gj,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:Qz("lucide",r),...a},[...o.map(([c,u])=>he.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zz=(t,e)=>{const n=he.forwardRef(({className:i,...r},s)=>he.createElement(qj,{ref:s,iconNode:e,className:Qz(`lucide-${Wj(t)}`,i),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xj=Zz("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kj=Zz("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var Jm={},x_={},MS={},C_={},qn={},rp={},Ys={},eU={},kS={},LS={};Object.defineProperty(LS,"__esModule",{value:!0});LS.default=Jj;let Sv;const Yj=new Uint8Array(16);function Jj(){if(!Sv&&(Sv=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Sv))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sv(Yj)}var mc={},qu={},DS={};Object.defineProperty(DS,"__esModule",{value:!0});DS.default=void 0;var Qj=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;DS.default=Qj;Object.defineProperty(qu,"__esModule",{value:!0});qu.default=void 0;var Zj=eW(DS);function eW(t){return t&&t.__esModule?t:{default:t}}function tW(t){return typeof t=="string"&&Zj.default.test(t)}var nW=tW;qu.default=nW;Object.defineProperty(mc,"__esModule",{value:!0});mc.default=void 0;mc.unsafeStringify=tU;var iW=rW(qu);function rW(t){return t&&t.__esModule?t:{default:t}}const Bi=[];for(let t=0;t<256;++t)Bi.push((t+256).toString(16).slice(1));function tU(t,e=0){return Bi[t[e+0]]+Bi[t[e+1]]+Bi[t[e+2]]+Bi[t[e+3]]+"-"+Bi[t[e+4]]+Bi[t[e+5]]+"-"+Bi[t[e+6]]+Bi[t[e+7]]+"-"+Bi[t[e+8]]+Bi[t[e+9]]+"-"+Bi[t[e+10]]+Bi[t[e+11]]+Bi[t[e+12]]+Bi[t[e+13]]+Bi[t[e+14]]+Bi[t[e+15]]}function sW(t,e=0){const n=tU(t,e);if(!(0,iW.default)(n))throw TypeError("Stringified UUID is invalid");return n}var oW=sW;mc.default=oW;Object.defineProperty(kS,"__esModule",{value:!0});kS.default=void 0;var aW=cW(LS),lW=mc;function cW(t){return t&&t.__esModule?t:{default:t}}let fM,__,w_=0,E_=0;function uW(t,e,n){let i=e&&n||0;const r=e||new Array(16);t=t||{};let s=t.node||fM,o=t.clockseq!==void 0?t.clockseq:__;if(s==null||o==null){const d=t.random||(t.rng||aW.default)();s==null&&(s=fM=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),o==null&&(o=__=(d[6]<<8|d[7])&16383)}let a=t.msecs!==void 0?t.msecs:Date.now(),l=t.nsecs!==void 0?t.nsecs:E_+1;const c=a-w_+(l-E_)/1e4;if(c<0&&t.clockseq===void 0&&(o=o+1&16383),(c<0||a>w_)&&t.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");w_=a,E_=l,__=o,a+=122192928e5;const u=((a&268435455)*1e4+l)%4294967296;r[i++]=u>>>24&255,r[i++]=u>>>16&255,r[i++]=u>>>8&255,r[i++]=u&255;const h=a/4294967296*1e4&268435455;r[i++]=h>>>8&255,r[i++]=h&255,r[i++]=h>>>24&15|16,r[i++]=h>>>16&255,r[i++]=o>>>8|128,r[i++]=o&255;for(let d=0;d<6;++d)r[i+d]=s[d];return e||(0,lW.unsafeStringify)(r)}var hW=uW;kS.default=hW;var NS={},nc={},C0={};Object.defineProperty(C0,"__esModule",{value:!0});C0.default=void 0;var dW=pW(qu);function pW(t){return t&&t.__esModule?t:{default:t}}function fW(t){if(!(0,dW.default)(t))throw TypeError("Invalid UUID");let e;const n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}var mW=fW;C0.default=mW;Object.defineProperty(nc,"__esModule",{value:!0});nc.URL=nc.DNS=void 0;nc.default=xW;var gW=mc,vW=yW(C0);function yW(t){return t&&t.__esModule?t:{default:t}}function SW(t){t=unescape(encodeURIComponent(t));const e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}const nU="6ba7b810-9dad-11d1-80b4-00c04fd430c8";nc.DNS=nU;const iU="6ba7b811-9dad-11d1-80b4-00c04fd430c8";nc.URL=iU;function xW(t,e,n){function i(r,s,o,a){var l;if(typeof r=="string"&&(r=SW(r)),typeof s=="string"&&(s=(0,vW.default)(s)),((l=s)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+r.length);if(c.set(s),c.set(r,s.length),c=n(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=c[u];return o}return(0,gW.unsafeStringify)(c)}try{i.name=t}catch{}return i.DNS=nU,i.URL=iU,i}var OS={};Object.defineProperty(OS,"__esModule",{value:!0});OS.default=void 0;function CW(t){if(typeof t=="string"){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n)}return _W(wW(EW(t),t.length*8))}function _W(t){const e=[],n=t.length*32,i="0123456789abcdef";for(let r=0;r<n;r+=8){const s=t[r>>5]>>>r%32&255,o=parseInt(i.charAt(s>>>4&15)+i.charAt(s&15),16);e.push(o)}return e}function rU(t){return(t+64>>>9<<4)+14+1}function wW(t,e){t[e>>5]|=128<<e%32,t[rU(e)-1]=e;let n=1732584193,i=-271733879,r=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=n,l=i,c=r,u=s;n=Zi(n,i,r,s,t[o],7,-680876936),s=Zi(s,n,i,r,t[o+1],12,-389564586),r=Zi(r,s,n,i,t[o+2],17,606105819),i=Zi(i,r,s,n,t[o+3],22,-1044525330),n=Zi(n,i,r,s,t[o+4],7,-176418897),s=Zi(s,n,i,r,t[o+5],12,1200080426),r=Zi(r,s,n,i,t[o+6],17,-1473231341),i=Zi(i,r,s,n,t[o+7],22,-45705983),n=Zi(n,i,r,s,t[o+8],7,1770035416),s=Zi(s,n,i,r,t[o+9],12,-1958414417),r=Zi(r,s,n,i,t[o+10],17,-42063),i=Zi(i,r,s,n,t[o+11],22,-1990404162),n=Zi(n,i,r,s,t[o+12],7,1804603682),s=Zi(s,n,i,r,t[o+13],12,-40341101),r=Zi(r,s,n,i,t[o+14],17,-1502002290),i=Zi(i,r,s,n,t[o+15],22,1236535329),n=er(n,i,r,s,t[o+1],5,-165796510),s=er(s,n,i,r,t[o+6],9,-1069501632),r=er(r,s,n,i,t[o+11],14,643717713),i=er(i,r,s,n,t[o],20,-373897302),n=er(n,i,r,s,t[o+5],5,-701558691),s=er(s,n,i,r,t[o+10],9,38016083),r=er(r,s,n,i,t[o+15],14,-660478335),i=er(i,r,s,n,t[o+4],20,-405537848),n=er(n,i,r,s,t[o+9],5,568446438),s=er(s,n,i,r,t[o+14],9,-1019803690),r=er(r,s,n,i,t[o+3],14,-187363961),i=er(i,r,s,n,t[o+8],20,1163531501),n=er(n,i,r,s,t[o+13],5,-1444681467),s=er(s,n,i,r,t[o+2],9,-51403784),r=er(r,s,n,i,t[o+7],14,1735328473),i=er(i,r,s,n,t[o+12],20,-1926607734),n=tr(n,i,r,s,t[o+5],4,-378558),s=tr(s,n,i,r,t[o+8],11,-2022574463),r=tr(r,s,n,i,t[o+11],16,1839030562),i=tr(i,r,s,n,t[o+14],23,-35309556),n=tr(n,i,r,s,t[o+1],4,-1530992060),s=tr(s,n,i,r,t[o+4],11,1272893353),r=tr(r,s,n,i,t[o+7],16,-155497632),i=tr(i,r,s,n,t[o+10],23,-1094730640),n=tr(n,i,r,s,t[o+13],4,681279174),s=tr(s,n,i,r,t[o],11,-358537222),r=tr(r,s,n,i,t[o+3],16,-722521979),i=tr(i,r,s,n,t[o+6],23,76029189),n=tr(n,i,r,s,t[o+9],4,-640364487),s=tr(s,n,i,r,t[o+12],11,-421815835),r=tr(r,s,n,i,t[o+15],16,530742520),i=tr(i,r,s,n,t[o+2],23,-995338651),n=nr(n,i,r,s,t[o],6,-198630844),s=nr(s,n,i,r,t[o+7],10,1126891415),r=nr(r,s,n,i,t[o+14],15,-1416354905),i=nr(i,r,s,n,t[o+5],21,-57434055),n=nr(n,i,r,s,t[o+12],6,1700485571),s=nr(s,n,i,r,t[o+3],10,-1894986606),r=nr(r,s,n,i,t[o+10],15,-1051523),i=nr(i,r,s,n,t[o+1],21,-2054922799),n=nr(n,i,r,s,t[o+8],6,1873313359),s=nr(s,n,i,r,t[o+15],10,-30611744),r=nr(r,s,n,i,t[o+6],15,-1560198380),i=nr(i,r,s,n,t[o+13],21,1309151649),n=nr(n,i,r,s,t[o+4],6,-145523070),s=nr(s,n,i,r,t[o+11],10,-1120210379),r=nr(r,s,n,i,t[o+2],15,718787259),i=nr(i,r,s,n,t[o+9],21,-343485551),n=Ll(n,a),i=Ll(i,l),r=Ll(r,c),s=Ll(s,u)}return[n,i,r,s]}function EW(t){if(t.length===0)return[];const e=t.length*8,n=new Uint32Array(rU(e));for(let i=0;i<e;i+=8)n[i>>5]|=(t[i/8]&255)<<i%32;return n}function Ll(t,e){const n=(t&65535)+(e&65535);return(t>>16)+(e>>16)+(n>>16)<<16|n&65535}function RW(t,e){return t<<e|t>>>32-e}function FS(t,e,n,i,r,s){return Ll(RW(Ll(Ll(e,t),Ll(i,s)),r),n)}function Zi(t,e,n,i,r,s,o){return FS(e&n|~e&i,t,e,r,s,o)}function er(t,e,n,i,r,s,o){return FS(e&i|n&~i,t,e,r,s,o)}function tr(t,e,n,i,r,s,o){return FS(e^n^i,t,e,r,s,o)}function nr(t,e,n,i,r,s,o){return FS(n^(e|~i),t,e,r,s,o)}var TW=CW;OS.default=TW;Object.defineProperty(NS,"__esModule",{value:!0});NS.default=void 0;var bW=sU(nc),AW=sU(OS);function sU(t){return t&&t.__esModule?t:{default:t}}const PW=(0,bW.default)("v3",48,AW.default);var IW=PW;NS.default=IW;var zS={},US={};Object.defineProperty(US,"__esModule",{value:!0});US.default=void 0;const MW=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var kW={randomUUID:MW};US.default=kW;Object.defineProperty(zS,"__esModule",{value:!0});zS.default=void 0;var mM=oU(US),LW=oU(LS),DW=mc;function oU(t){return t&&t.__esModule?t:{default:t}}function NW(t,e,n){if(mM.default.randomUUID&&!e&&!t)return mM.default.randomUUID();t=t||{};const i=t.random||(t.rng||LW.default)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){n=n||0;for(let r=0;r<16;++r)e[n+r]=i[r];return e}return(0,DW.unsafeStringify)(i)}var OW=NW;zS.default=OW;var BS={},$S={};Object.defineProperty($S,"__esModule",{value:!0});$S.default=void 0;function FW(t,e,n,i){switch(t){case 0:return e&n^~e&i;case 1:return e^n^i;case 2:return e&n^e&i^n&i;case 3:return e^n^i}}function R_(t,e){return t<<e|t>>>32-e}function zW(t){const e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){const o=unescape(encodeURIComponent(t));t=[];for(let a=0;a<o.length;++a)t.push(o.charCodeAt(a))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const i=t.length/4+2,r=Math.ceil(i/16),s=new Array(r);for(let o=0;o<r;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=t[o*64+l*4]<<24|t[o*64+l*4+1]<<16|t[o*64+l*4+2]<<8|t[o*64+l*4+3];s[o]=a}s[r-1][14]=(t.length-1)*8/Math.pow(2,32),s[r-1][14]=Math.floor(s[r-1][14]),s[r-1][15]=(t.length-1)*8&4294967295;for(let o=0;o<r;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=s[o][p];for(let p=16;p<80;++p)a[p]=R_(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let l=n[0],c=n[1],u=n[2],h=n[3],d=n[4];for(let p=0;p<80;++p){const f=Math.floor(p/20),v=R_(l,5)+FW(f,c,u,h)+d+e[f]+a[p]>>>0;d=h,h=u,u=R_(c,30)>>>0,c=l,l=v}n[0]=n[0]+l>>>0,n[1]=n[1]+c>>>0,n[2]=n[2]+u>>>0,n[3]=n[3]+h>>>0,n[4]=n[4]+d>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var UW=zW;$S.default=UW;Object.defineProperty(BS,"__esModule",{value:!0});BS.default=void 0;var BW=aU(nc),$W=aU($S);function aU(t){return t&&t.__esModule?t:{default:t}}const HW=(0,BW.default)("v5",80,$W.default);var VW=HW;BS.default=VW;var HS={};Object.defineProperty(HS,"__esModule",{value:!0});HS.default=void 0;var jW="00000000-0000-0000-0000-000000000000";HS.default=jW;var VS={};Object.defineProperty(VS,"__esModule",{value:!0});VS.default=void 0;var WW=GW(qu);function GW(t){return t&&t.__esModule?t:{default:t}}function qW(t){if(!(0,WW.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}var XW=qW;VS.default=XW;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return o.default}});var e=u(kS),n=u(NS),i=u(zS),r=u(BS),s=u(HS),o=u(VS),a=u(qu),l=u(mc),c=u(C0);function u(h){return h&&h.__esModule?h:{default:h}}})(eU);Object.defineProperty(Ys,"__esModule",{value:!0});Ys.createNoDashGuid=Ys.createGuid=void 0;const KW=eU,lU=()=>KW.v4();Ys.createGuid=lU;const YW=()=>lU().replace(new RegExp("-","g"),"").toUpperCase();Ys.createNoDashGuid=YW;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformEvent=t.EventType=void 0;const e=Ys;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warning=2]="Warning",i[i.Error=3]="Error",i[i.None=4]="None"})(t.EventType||(t.EventType={}));class n{constructor(r,s){this.privName=r,this.privEventId=e.createNoDashGuid(),this.privEventTime=new Date().toISOString(),this.privEventType=s,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}t.PlatformEvent=n})(rp);Object.defineProperty(qn,"__esModule",{value:!0});qn.AudioStreamNodeErrorEvent=qn.AudioStreamNodeDetachedEvent=qn.AudioStreamNodeAttachedEvent=qn.AudioStreamNodeAttachingEvent=qn.AudioStreamNodeEvent=qn.AudioSourceErrorEvent=qn.AudioSourceOffEvent=qn.AudioSourceReadyEvent=qn.AudioSourceInitializingEvent=qn.AudioSourceEvent=void 0;const oR=rp;class sp extends oR.PlatformEvent{constructor(e,n,i=oR.EventType.Info){super(e,i),this.privAudioSourceId=n}get audioSourceId(){return this.privAudioSourceId}}qn.AudioSourceEvent=sp;class JW extends sp{constructor(e){super("AudioSourceInitializingEvent",e)}}qn.AudioSourceInitializingEvent=JW;class QW extends sp{constructor(e){super("AudioSourceReadyEvent",e)}}qn.AudioSourceReadyEvent=QW;class ZW extends sp{constructor(e){super("AudioSourceOffEvent",e)}}qn.AudioSourceOffEvent=ZW;class eG extends sp{constructor(e,n){super("AudioSourceErrorEvent",e,oR.EventType.Error),this.privError=n}get error(){return this.privError}}qn.AudioSourceErrorEvent=eG;class _0 extends sp{constructor(e,n,i){super(e,n),this.privAudioNodeId=i}get audioNodeId(){return this.privAudioNodeId}}qn.AudioStreamNodeEvent=_0;class tG extends _0{constructor(e,n){super("AudioStreamNodeAttachingEvent",e,n)}}qn.AudioStreamNodeAttachingEvent=tG;class nG extends _0{constructor(e,n){super("AudioStreamNodeAttachedEvent",e,n)}}qn.AudioStreamNodeAttachedEvent=nG;class iG extends _0{constructor(e,n){super("AudioStreamNodeDetachedEvent",e,n)}}qn.AudioStreamNodeDetachedEvent=iG;class rG extends _0{constructor(e,n,i){super("AudioStreamNodeErrorEvent",e,n),this.privError=i}get error(){return this.privError}}qn.AudioStreamNodeErrorEvent=rG;var ci={};Object.defineProperty(ci,"__esModule",{value:!0});ci.ConnectionMessageSentEvent=ci.ConnectionMessageReceivedEvent=ci.ConnectionEstablishErrorEvent=ci.ConnectionErrorEvent=ci.ConnectionClosedEvent=ci.ConnectionEstablishedEvent=ci.ConnectionStartEvent=ci.ConnectionEvent=ci.ServiceEvent=void 0;const Au=rp;class sG extends Au.PlatformEvent{constructor(e,n,i=Au.EventType.Info){super(e,i),this.privJsonResult=n}get jsonString(){return this.privJsonResult}}ci.ServiceEvent=sG;class gc extends Au.PlatformEvent{constructor(e,n,i=Au.EventType.Info){super(e,i),this.privConnectionId=n}get connectionId(){return this.privConnectionId}}ci.ConnectionEvent=gc;class oG extends gc{constructor(e,n,i){super("ConnectionStartEvent",e),this.privUri=n,this.privHeaders=i}get uri(){return this.privUri}get headers(){return this.privHeaders}}ci.ConnectionStartEvent=oG;class aG extends gc{constructor(e){super("ConnectionEstablishedEvent",e)}}ci.ConnectionEstablishedEvent=aG;class lG extends gc{constructor(e,n,i){super("ConnectionClosedEvent",e,Au.EventType.Debug),this.privReason=i,this.privStatusCode=n}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}ci.ConnectionClosedEvent=lG;class cG extends gc{constructor(e,n,i){super("ConnectionErrorEvent",e,Au.EventType.Debug),this.privMessage=n,this.privType=i}get message(){return this.privMessage}get type(){return this.privType}}ci.ConnectionErrorEvent=cG;class uG extends gc{constructor(e,n,i){super("ConnectionEstablishErrorEvent",e,Au.EventType.Error),this.privStatusCode=n,this.privReason=i}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}ci.ConnectionEstablishErrorEvent=uG;class hG extends gc{constructor(e,n,i){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=n,this.privMessage=i}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}ci.ConnectionMessageReceivedEvent=hG;class dG extends gc{constructor(e,n,i){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=n,this.privMessage=i}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}ci.ConnectionMessageSentEvent=dG;var o2={},Wi={};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.ObjectDisposedError=Wi.InvalidOperationError=Wi.ArgumentNullError=void 0;class pG extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}}Wi.ArgumentNullError=pG;class fG extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}}Wi.InvalidOperationError=fG;class mG extends Error{constructor(e,n){super(n),this.name=e+"ObjectDisposed",this.message=n}}Wi.ObjectDisposedError=mG;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionMessage=t.MessageType=void 0;const e=Wi,n=Ys;var i;(function(s){s[s.Text=0]="Text",s[s.Binary=1]="Binary"})(i=t.MessageType||(t.MessageType={}));class r{constructor(o,a,l,c){if(this.privBody=null,o===i.Text&&a&&typeof a!="string")throw new e.InvalidOperationError("Payload must be a string");if(o===i.Binary&&a&&!(a instanceof ArrayBuffer))throw new e.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=o,this.privBody=a,this.privHeaders=l||{},this.privId=c||n.createNoDashGuid(),this.messageType){case i.Binary:this.privSize=this.binaryBody!==null?this.binaryBody.byteLength:0;break;case i.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===i.Binary)throw new e.InvalidOperationError("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===i.Text)throw new e.InvalidOperationError("Not supported for text message");return this.privBody}get id(){return this.privId}}t.ConnectionMessage=r})(o2);var jS={};Object.defineProperty(jS,"__esModule",{value:!0});jS.ConnectionOpenResponse=void 0;class gG{constructor(e,n){this.privStatusCode=e,this.privReason=n}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}jS.ConnectionOpenResponse=gG;var WS={};Object.defineProperty(WS,"__esModule",{value:!0});WS.DeferralMap=void 0;class vG{constructor(){this.privMap={}}add(e,n){this.privMap[e]=n}getId(e){return this.privMap[e]}complete(e,n){try{this.privMap[e].resolve(n)}catch(i){this.privMap[e].reject(i)}finally{this.privMap[e]=void 0}}}WS.DeferralMap=vG;var Pu={};Object.defineProperty(Pu,"__esModule",{value:!0});Pu.SendingAgentContextMessageEvent=Pu.DialogEvent=void 0;const gM=rp;class cU extends gM.PlatformEvent{constructor(e,n=gM.EventType.Info){super(e,n)}}Pu.DialogEvent=cU;class yG extends cU{constructor(e){super("SendingAgentContextMessageEvent"),this.privAgentConfig=e}get agentConfig(){return this.privAgentConfig}}Pu.SendingAgentContextMessageEvent=yG;var GS={},w0={};Object.defineProperty(w0,"__esModule",{value:!0});w0.EventSource=void 0;const SG=Wi,xG=Ys;class CG{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new SG.ObjectDisposedError("EventSource");if(this.metadata)for(const n in this.metadata)n&&e.metadata&&(e.metadata[n]||(e.metadata[n]=this.metadata[n]));for(const n in this.privEventListeners)n&&this.privEventListeners[n]&&this.privEventListeners[n](e)}attach(e){const n=xG.createNoDashGuid();return this.privEventListeners[n]=e,{detach:()=>(delete this.privEventListeners[n],Promise.resolve())}}attachListener(e){return this.attach(n=>e.onEvent(n))}attachConsoleListener(e){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(n=>e.onEvent(n)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}}w0.EventSource=CG;Object.defineProperty(GS,"__esModule",{value:!0});GS.Events=void 0;const _G=Wi,wG=w0;class Wg{static setEventSource(e){if(!e)throw new _G.ArgumentNullError("eventSource");Wg.privInstance=e}static get instance(){return Wg.privInstance}}GS.Events=Wg;Wg.privInstance=new wG.EventSource;var uU={};Object.defineProperty(uU,"__esModule",{value:!0});var hU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionState=void 0,function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected"}(t.ConnectionState||(t.ConnectionState={}))})(hU);var dU={};Object.defineProperty(dU,"__esModule",{value:!0});var pU={};Object.defineProperty(pU,"__esModule",{value:!0});var fU={};Object.defineProperty(fU,"__esModule",{value:!0});var mU={};Object.defineProperty(mU,"__esModule",{value:!0});var gU={};Object.defineProperty(gU,"__esModule",{value:!0});var vU={};Object.defineProperty(vU,"__esModule",{value:!0});var yU={};Object.defineProperty(yU,"__esModule",{value:!0});var SU={};Object.defineProperty(SU,"__esModule",{value:!0});var E0={};Object.defineProperty(E0,"__esModule",{value:!0});E0.List=void 0;const EG=Wi;class _l{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(const n of e)this.privList.push(n)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,n){this.throwIfDisposed(),e===0?this.privList.unshift(n):e===this.privList.length?this.privList.push(n):this.privList.splice(e,0,n),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,n){this.throwIfDisposed();const i=this.privList.splice(e,n);return this.triggerSubscriptions(this.privRemoveSubscriptions),i}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[n]=e,{detach:()=>(delete this.privAddSubscriptions[n],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[n]=e,{detach:()=>(delete this.privRemoveSubscriptions[n],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[n]=e,{detach:()=>(delete this.privDisposedSubscriptions[n],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){const e=Array();return this.privList.forEach(n=>{e.push(n)}),e}any(e){return this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(e){this.throwIfDisposed();for(let n=0;n<this.length();n++)e(this.privList[n],n)}select(e){this.throwIfDisposed();const n=[];for(let i=0;i<this.privList.length;i++)n.push(e(this.privList[i],i));return new _l(n)}where(e){this.throwIfDisposed();const n=new _l;for(let i=0;i<this.privList.length;i++)e(this.privList[i],i)&&n.add(this.privList[i]);return n}orderBy(e){this.throwIfDisposed();const i=this.toArray().sort(e);return new _l(i)}orderByDesc(e){return this.throwIfDisposed(),this.orderBy((n,i)=>e(i,n))}clone(){return this.throwIfDisposed(),new _l(this.toArray())}concat(e){return this.throwIfDisposed(),new _l(this.privList.concat(e.toArray()))}concatArray(e){return this.throwIfDisposed(),new _l(this.privList.concat(e))}isDisposed(){return this.privList==null}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new EG.ObjectDisposedError("List",this.privDisposeReason)}triggerSubscriptions(e){if(e)for(const n in e)n&&e[n]()}}E0.List=_l;var a2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.marshalPromiseToCallbacks=t.Sink=t.Deferred=t.PromiseResultEventSource=t.PromiseResult=t.PromiseState=void 0;var e;(function(a){a[a.None=0]="None",a[a.Resolved=1]="Resolved",a[a.Rejected=2]="Rejected"})(e=t.PromiseState||(t.PromiseState={}));class n{constructor(l){this.throwIfError=()=>{if(this.isError)throw this.error},l.on(c=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=c)},c=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=c)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}}t.PromiseResult=n;class i{constructor(){this.setResult=l=>{this.privOnSetResult(l)},this.setError=l=>{this.privOnSetError(l)},this.on=(l,c)=>{this.privOnSetResult=l,this.privOnSetError=c}}}t.PromiseResultEventSource=i;class r{constructor(){this.resolve=l=>(this.privResolve(l),this),this.reject=l=>(this.privReject(l),this),this.privPromise=new Promise((l,c)=>{this.privResolve=l,this.privReject=c})}get promise(){return this.privPromise}}t.Deferred=r;class s{constructor(){this.privState=e.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new i,this.privPromiseResult=new n(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(l){if(this.privState!==e.None)throw new Error("'Cannot resolve a completed promise'");this.privState=e.Resolved,this.privPromiseResultEvents.setResult(l);for(let c=0;c<this.privSuccessHandlers.length;c++)this.executeSuccessCallback(l,this.privSuccessHandlers[c],this.privErrorHandlers[c]);this.detachHandlers()}reject(l){if(this.privState!==e.None)throw new Error("'Cannot reject a completed promise'");this.privState=e.Rejected,this.privPromiseResultEvents.setError(l);for(const c of this.privErrorHandlers)this.executeErrorCallback(l,c);this.detachHandlers()}on(l,c){l==null&&(l=()=>{}),this.privState===e.None?(this.privSuccessHandlers.push(l),this.privErrorHandlers.push(c)):(this.privState===e.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,l,c):this.privState===e.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,c),this.detachHandlers())}executeSuccessCallback(l,c,u){try{c(l)}catch(h){this.executeErrorCallback(`'Unhandled callback error: ${h}'`,u)}}executeErrorCallback(l,c){if(c)try{c(l)}catch(u){throw new Error(`'Unhandled callback error: ${u}. InnerError: ${l}'`)}else throw new Error(`'Unhandled error: ${l}'`)}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}}t.Sink=s;function o(a,l,c){a.then(u=>{try{l&&l(u)}catch(h){if(c)try{if(h instanceof Error){const d=h;c(d.name+": "+d.message)}else c(h)}catch{}}},u=>{if(c)try{if(u instanceof Error){const h=u;c(h.name+": "+h.message)}else c(u)}catch{}})}t.marshalPromiseToCallbacks=o})(a2);var R0={};Object.defineProperty(R0,"__esModule",{value:!0});R0.Queue=void 0;const T_=Wi,b_=E0,vM=a2;var vg;(function(t){t[t.Dequeue=0]="Dequeue",t[t.Peek=1]="Peek"})(vg||(vg={}));class RG{constructor(e){this.privPromiseStore=new b_.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new b_.List,this.privDetachables=[],this.privSubscribers=new b_.List,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(e){this.throwIfDispose(),this.enqueueFromPromise(new Promise(n=>n(e)))}enqueueFromPromise(e){this.throwIfDispose(),e.then(n=>{this.privList.add(n)},()=>{})}dequeue(){this.throwIfDispose();const e=new vM.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:vg.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();const e=new vM.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:vg.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return this.privSubscribers==null}async drainAndDispose(e,n){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=n,this.privIsDisposing=!0;const i=this.privSubscribers;if(i){for(;i.length()>0;)i.removeFirst().deferral.resolve(void 0);this.privSubscribers===i&&(this.privSubscribers=i)}for(const r of this.privDetachables)await r.detach();if(this.privPromiseStore.length()>0&&e){const r=[];return this.privPromiseStore.toArray().forEach(s=>{r.push(s)}),Promise.all(r).finally(()=>{this.privSubscribers=null,this.privList.forEach(s=>{e(s)}),this.privList=null}).then()}else this.privSubscribers=null,this.privList=null}}async dispose(e){await this.drainAndDispose(null,e)}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const e=this.privSubscribers,n=this.privList;if(e&&n){for(;n.length()>0&&e.length()>0&&!this.privIsDisposing;){const i=e.removeFirst();if(i.type===vg.Peek)i.deferral.resolve(n.first());else{const r=n.removeFirst();i.deferral.resolve(r)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===n&&(this.privList=n)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed())throw this.privDisposeReason?new T_.InvalidOperationError(this.privDisposeReason):new T_.ObjectDisposedError("Queue");if(this.privIsDisposing)throw new T_.InvalidOperationError("Queue disposing")}}R0.Queue=RG;var qS={};Object.defineProperty(qS,"__esModule",{value:!0});qS.RawWebsocketMessage=void 0;const xv=o2,Hp=Wi,TG=Ys;class bG{constructor(e,n,i){if(this.privPayload=null,!n)throw new Hp.ArgumentNullError("payload");if(e===xv.MessageType.Binary&&Object.getPrototypeOf(n).constructor.name!=="ArrayBuffer")throw new Hp.InvalidOperationError("Payload must be ArrayBuffer");if(e===xv.MessageType.Text&&typeof n!="string")throw new Hp.InvalidOperationError("Payload must be a string");this.privMessageType=e,this.privPayload=n,this.privId=i||TG.createNoDashGuid()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===xv.MessageType.Binary)throw new Hp.InvalidOperationError("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===xv.MessageType.Text)throw new Hp.InvalidOperationError("Not supported for text message");return this.privPayload}get id(){return this.privId}}qS.RawWebsocketMessage=bG;var XS={};Object.defineProperty(XS,"__esModule",{value:!0});XS.RiffPcmEncoder=void 0;class AG{constructor(e,n){this.privActualSampleRate=e,this.privDesiredSampleRate=n}encode(e){const n=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!n)return null;const i=n.length*2,r=new ArrayBuffer(i),s=new DataView(r);return this.floatTo16BitPCM(s,0,n),r}setString(e,n,i){for(let r=0;r<i.length;r++)e.setUint8(n+r,i.charCodeAt(r))}floatTo16BitPCM(e,n,i){for(let r=0;r<i.length;r++,n+=2){const s=Math.max(-1,Math.min(1,i[r]));e.setInt16(n,s<0?s*32768:s*32767,!0)}}downSampleAudioFrame(e,n,i){if(!e)return null;if(i===n||i>n)return e;const r=n/i,s=Math.round(e.length/r),o=new Float32Array(s);let a=0,l=0;for(;l<s;){const c=Math.round((l+1)*r);let u=0,h=0;for(;a<c&&a<e.length;)u+=e[a++],h++;o[l++]=u/h}return o}}XS.RiffPcmEncoder=AG;var KS={};Object.defineProperty(KS,"__esModule",{value:!0});KS.Stream=void 0;const yM=Wi,PG=Ys,SM=R0;class IG{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||PG.createNoDashGuid(),this.privReaderQueue=new SM.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch{}}read(){if(this.privIsReadEnded)throw new yM.InvalidOperationError("Stream read has already finished");return this.privReaderQueue.dequeue().then(async e=>((e===void 0||e.isEnd)&&await this.privReaderQueue.dispose("End of stream reached"),e))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new SM.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new yM.InvalidOperationError("Stream closed")}}KS.Stream=IG;var YS={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TranslationStatus=void 0,function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(t.TranslationStatus||(t.TranslationStatus={}))})(YS);var Vp={},xM;function MG(){if(xM)return Vp;xM=1,Object.defineProperty(Vp,"__esModule",{value:!0}),Vp.ChunkedArrayBufferStream=void 0;const t=ht();let e=class extends t.Stream{constructor(i,r){super(r),this.privTargetChunkSize=i,this.privNextBufferReadyBytes=0}writeStreamChunk(i){if(i.isEnd||this.privNextBufferReadyBytes===0&&i.buffer.byteLength===this.privTargetChunkSize){super.writeStreamChunk(i);return}let r=0;for(;r<i.buffer.byteLength;){this.privNextBufferToWrite===void 0&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=i.timeReceived);const s=Math.min(i.buffer.byteLength-r,this.privTargetChunkSize-this.privNextBufferReadyBytes),o=new Uint8Array(this.privNextBufferToWrite),a=new Uint8Array(i.buffer.slice(r,s+r));o.set(a,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=s,r+=s,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){this.privNextBufferReadyBytes!==0&&!this.isClosed&&super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}};return Vp.ChunkedArrayBufferStream=e,Vp}var xU={};Object.defineProperty(xU,"__esModule",{value:!0});var JS={};Object.defineProperty(JS,"__esModule",{value:!0});JS.Timeout=void 0;class or{static load(){const e=new Map([[0,()=>{}]]),n=new Map,r="data:text/javascript;base64,"+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`),s=new Worker(r);return s.addEventListener("message",({data:l})=>{if(or.isCallNotification(l)){const{params:{timerId:c}}=l,u=e.get(c);if(typeof u=="number"){const h=n.get(u);if(h===void 0||h!==c)throw new Error("The timer is in an undefined state.")}else if(typeof u<"u")u(),e.delete(c);else throw new Error("The timer is in an undefined state.")}else if(or.isClearResponse(l)){const{id:c}=l,u=n.get(c);if(u===void 0)throw new Error("The timer is in an undefined state.");n.delete(c),e.delete(u)}else{const{error:{message:c}}=l;throw new Error(c)}}),{clearTimeout:l=>{const c=Math.random();n.set(c,l),e.set(l,c),s.postMessage({id:c,method:"clear",params:{timerId:l}})},setTimeout:(l,c)=>{const u=Math.random();return e.set(u,l),s.postMessage({id:null,method:"set",params:{delay:c,now:performance.now(),timerId:u}}),u}}}static loadWorkerTimers(){return()=>(or.workerTimers!==null||(or.workerTimers=or.load()),or.workerTimers)}static isCallNotification(e){return e.method!==void 0&&e.method==="call"}static isClearResponse(e){return e.error===null&&typeof e.id=="number"}}JS.Timeout=or;or.workerTimers=null;or.clearTimeout=t=>or.timers().clearTimeout(t);or.setTimeout=(t,e)=>or.timers().setTimeout(t,e);or.timers=or.loadWorkerTimers();var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.OCSPCacheUpdateErrorEvent=Bt.OCSPResponseRetrievedEvent=Bt.OCSPCacheFetchErrorEvent=Bt.OCSPVerificationFailedEvent=Bt.OCSPCacheHitEvent=Bt.OCSPCacheEntryNeedsRefreshEvent=Bt.OCSPCacheEntryExpiredEvent=Bt.OCSPWSUpgradeStartedEvent=Bt.OCSPStapleReceivedEvent=Bt.OCSPCacheUpdateCompleteEvent=Bt.OCSPDiskCacheStoreEvent=Bt.OCSPMemoryCacheStoreEvent=Bt.OCSPCacheUpdateNeededEvent=Bt.OCSPDiskCacheHitEvent=Bt.OCSPCacheMissEvent=Bt.OCSPMemoryCacheHitEvent=Bt.OCSPEvent=void 0;const Xi=rp;class Ki extends Xi.PlatformEvent{constructor(e,n,i){super(e,n),this.privSignature=i}}Bt.OCSPEvent=Ki;class kG extends Ki{constructor(e){super("OCSPMemoryCacheHitEvent",Xi.EventType.Debug,e)}}Bt.OCSPMemoryCacheHitEvent=kG;class LG extends Ki{constructor(e){super("OCSPCacheMissEvent",Xi.EventType.Debug,e)}}Bt.OCSPCacheMissEvent=LG;class DG extends Ki{constructor(e){super("OCSPDiskCacheHitEvent",Xi.EventType.Debug,e)}}Bt.OCSPDiskCacheHitEvent=DG;class NG extends Ki{constructor(e){super("OCSPCacheUpdateNeededEvent",Xi.EventType.Debug,e)}}Bt.OCSPCacheUpdateNeededEvent=NG;class OG extends Ki{constructor(e){super("OCSPMemoryCacheStoreEvent",Xi.EventType.Debug,e)}}Bt.OCSPMemoryCacheStoreEvent=OG;class FG extends Ki{constructor(e){super("OCSPDiskCacheStoreEvent",Xi.EventType.Debug,e)}}Bt.OCSPDiskCacheStoreEvent=FG;class zG extends Ki{constructor(e){super("OCSPCacheUpdateCompleteEvent",Xi.EventType.Debug,e)}}Bt.OCSPCacheUpdateCompleteEvent=zG;class UG extends Ki{constructor(){super("OCSPStapleReceivedEvent",Xi.EventType.Debug,"")}}Bt.OCSPStapleReceivedEvent=UG;class BG extends Ki{constructor(e){super("OCSPWSUpgradeStartedEvent",Xi.EventType.Debug,e)}}Bt.OCSPWSUpgradeStartedEvent=BG;class $G extends Ki{constructor(e,n){super("OCSPCacheEntryExpiredEvent",Xi.EventType.Debug,e),this.privExpireTime=n}}Bt.OCSPCacheEntryExpiredEvent=$G;class HG extends Ki{constructor(e,n,i){super("OCSPCacheEntryNeedsRefreshEvent",Xi.EventType.Debug,e),this.privExpireTime=i,this.privStartTime=n}}Bt.OCSPCacheEntryNeedsRefreshEvent=HG;class VG extends Ki{constructor(e,n,i){super("OCSPCacheHitEvent",Xi.EventType.Debug,e),this.privExpireTime=i,this.privExpireTimeString=new Date(i).toLocaleDateString(),this.privStartTime=n,this.privStartTimeString=new Date(n).toLocaleTimeString()}}Bt.OCSPCacheHitEvent=VG;class jG extends Ki{constructor(e,n){super("OCSPVerificationFailedEvent",Xi.EventType.Debug,e),this.privError=n}}Bt.OCSPVerificationFailedEvent=jG;class WG extends Ki{constructor(e,n){super("OCSPCacheFetchErrorEvent",Xi.EventType.Debug,e),this.privError=n}}Bt.OCSPCacheFetchErrorEvent=WG;class GG extends Ki{constructor(e){super("OCSPResponseRetrievedEvent",Xi.EventType.Debug,e)}}Bt.OCSPResponseRetrievedEvent=GG;class qG extends Ki{constructor(e,n){super("OCSPCacheUpdateErrorEvent",Xi.EventType.Debug,e),this.privError=n}}Bt.OCSPCacheUpdateErrorEvent=qG;var jp={},CM;function XG(){if(CM)return jp;CM=1,Object.defineProperty(jp,"__esModule",{value:!0}),jp.BackgroundEvent=void 0;const t=ht();class e extends t.PlatformEvent{constructor(i){super("BackgroundEvent",t.EventType.Error),this.privError=i}get error(){return this.privError}}return jp.BackgroundEvent=e,jp}var _M;function ht(){return _M||(_M=1,function(t){var e=It&&It.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o),Object.defineProperty(r,a,{enumerable:!0,get:function(){return s[o]}})}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=It&&It.__exportStar||function(r,s){for(var o in r)o!=="default"&&!s.hasOwnProperty(o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(qn,t),n(ci,t),n(o2,t),n(jS,t),n(WS,t),n(Pu,t),n(Wi,t),n(GS,t),n(w0,t),n(Ys,t),n(uU,t),n(hU,t),n(dU,t),n(pU,t),n(fU,t),n(mU,t),n(gU,t),n(vU,t),n(yU,t),n(SU,t),n(E0,t),n(rp,t),n(a2,t),n(R0,t),n(qS,t),n(XS,t),n(KS,t);var i=YS;Object.defineProperty(t,"TranslationStatus",{enumerable:!0,get:function(){return i.TranslationStatus}}),n(MG(),t),n(xU,t),n(JS,t),n(Bt,t),n(XG(),t)}(C_)),C_}var Fi={};Object.defineProperty(Fi,"__esModule",{value:!0});Fi.HeaderNames=void 0;class Lo{}Fi.HeaderNames=Lo;Lo.AuthKey="Ocp-Apim-Subscription-Key";Lo.Authorization="Authorization";Lo.SpIDAuthKey="Apim-Subscription-Id";Lo.ConnectionId="X-ConnectionId";Lo.ContentType="Content-Type";Lo.CustomCommandsAppId="X-CommandsAppId";Lo.Path="Path";Lo.RequestId="X-RequestId";Lo.RequestStreamId="X-StreamId";Lo.RequestTimestamp="X-Timestamp";var op={};Object.defineProperty(op,"__esModule",{value:!0});op.AuthInfo=void 0;class KG{constructor(e,n){this.privHeaderName=e,this.privToken=n}get headerName(){return this.privHeaderName}get token(){return this.privToken}}op.AuthInfo=KG;Object.defineProperty(MS,"__esModule",{value:!0});MS.CognitiveSubscriptionKeyAuthentication=void 0;const YG=ht(),JG=Fi,QG=op;class ZG{constructor(e){if(!e)throw new YG.ArgumentNullError("subscriptionKey");this.privAuthInfo=new QG.AuthInfo(JG.HeaderNames.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}}MS.CognitiveSubscriptionKeyAuthentication=ZG;var QS={};Object.defineProperty(QS,"__esModule",{value:!0});QS.CognitiveTokenAuthentication=void 0;const wM=ht(),EM=op,RM=Fi;class Gg{constructor(e,n){if(!e)throw new wM.ArgumentNullError("fetchCallback");if(!n)throw new wM.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=n}fetch(e){return this.privFetchCallback(e).then(n=>new EM.AuthInfo(RM.HeaderNames.Authorization,n===void 0?void 0:Gg.privTokenPrefix+n))}fetchOnExpiry(e){return this.privFetchOnExpiryCallback(e).then(n=>new EM.AuthInfo(RM.HeaderNames.Authorization,n===void 0?void 0:Gg.privTokenPrefix+n))}}QS.CognitiveTokenAuthentication=Gg;Gg.privTokenPrefix="Bearer ";var CU={};Object.defineProperty(CU,"__esModule",{value:!0});var _U={};Object.defineProperty(_U,"__esModule",{value:!0});var Wp={},A_={},ZS={};const eq={},tq=Object.freeze(Object.defineProperty({__proto__:null,default:eq},Symbol.toStringTag,{value:"Module"})),Xu=g7(tq);var l2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.LogLevel=void 0;const e=ht();Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return e.EventType}})})(l2);var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.Contracts=void 0;class wl{static throwIfNullOrUndefined(e,n){if(e==null)throw new Error("throwIfNullOrUndefined:"+n)}static throwIfNull(e,n){if(e===null)throw new Error("throwIfNull:"+n)}static throwIfNullOrWhitespace(e,n){if(wl.throwIfNullOrUndefined(e,n),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+n)}static throwIfNullOrTooLong(e,n,i){if(wl.throwIfNullOrUndefined(e,n),(""+e).length>i)throw new Error("throwIfNullOrTooLong:"+n+" (more than "+i.toString()+" characters)")}static throwIfNullOrTooShort(e,n,i){if(wl.throwIfNullOrUndefined(e,n),(""+e).length<i)throw new Error("throwIfNullOrTooShort:"+n+" (less than "+i.toString()+" characters)")}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,n){if(wl.throwIfNullOrUndefined(e,n),e.length===0)throw new Error("throwIfArrayEmptyOrWhitespace:"+n);for(const i of e)wl.throwIfNullOrWhitespace(i,n)}static throwIfFileDoesNotExist(e,n){wl.throwIfNullOrWhitespace(e,n)}static throwIfNotUndefined(e,n){if(e!==void 0)throw new Error("throwIfNotUndefined:"+n)}}Ct.Contracts=wl;var nq=It&&It.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),iq=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),rq=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.hasOwnProperty.call(t,n)&&nq(e,t,n);return iq(e,t),e};Object.defineProperty(ZS,"__esModule",{value:!0});ZS.ConsoleLoggingListener=void 0;const TM=rq(Xu),Gp=l2,sq=Ct;class oq{constructor(e=Gp.LogLevel.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=e}set logPath(e){sq.Contracts.throwIfNullOrUndefined(TM.openSync,`
File System access not available`),this.privLogPath=e}set enableConsoleOutput(e){this.privEnableConsoleOutput=e}onEvent(e){if(e.eventType>=this.privLogLevelFilter){const n=this.toString(e);if(this.logCallback&&this.logCallback(n),this.privLogPath&&TM.writeFileSync(this.privLogPath,n+`
`,{flag:"a+"}),this.privEnableConsoleOutput)switch(e.eventType){case Gp.LogLevel.Debug:console.debug(n);break;case Gp.LogLevel.Info:console.info(n);break;case Gp.LogLevel.Warning:console.warn(n);break;case Gp.LogLevel.Error:console.error(n);break;default:console.log(n);break}}}toString(e){const n=[`${e.eventTime}`,`${e.name}`],i=e;for(const r in i)if(r&&e.hasOwnProperty(r)&&r!=="eventTime"&&r!=="eventType"&&r!=="eventId"&&r!=="name"&&r!=="constructor"){const s=i[r];let o="<NULL>";s!=null&&(typeof s=="number"||typeof s=="string"?o=s.toString():o=JSON.stringify(s)),n.push(`${r}: ${o}`)}return n.join(" | ")}}ZS.ConsoleLoggingListener=oq;var wU={};Object.defineProperty(wU,"__esModule",{value:!0});var P_={},vc={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioStreamFormatImpl=t.AudioStreamFormat=t.AudioFormatTag=void 0;var e;(function(r){r[r.PCM=1]="PCM",r[r.MuLaw=2]="MuLaw",r[r.Siren=3]="Siren",r[r.MP3=4]="MP3",r[r.SILKSkype=5]="SILKSkype",r[r.OGG_OPUS=6]="OGG_OPUS",r[r.WEBM_OPUS=7]="WEBM_OPUS",r[r.ALaw=8]="ALaw",r[r.FLAC=9]="FLAC",r[r.OPUS=10]="OPUS",r[r.AMR_WB=11]="AMR_WB",r[r.G722=12]="G722"})(e=t.AudioFormatTag||(t.AudioFormatTag={}));class n{static getDefaultInputFormat(){return i.getDefaultInputFormat()}static getWaveFormat(s,o,a,l){return new i(s,o,a,l)}static getWaveFormatPCM(s,o,a){return new i(s,o,a)}}t.AudioStreamFormat=n;class i extends n{constructor(s=16e3,o=16,a=1,l=e.PCM){super();let c=!0;switch(l){case e.PCM:this.formatTag=1;break;case e.ALaw:this.formatTag=6;break;case e.MuLaw:this.formatTag=7;break;default:c=!1}if(this.bitsPerSample=o,this.samplesPerSec=s,this.channels=a,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),c){this.privHeader=new ArrayBuffer(44);const u=new DataView(this.privHeader);this.setString(u,0,"RIFF"),u.setUint32(4,0,!0),this.setString(u,8,"WAVEfmt "),u.setUint32(16,16,!0),u.setUint16(20,this.formatTag,!0),u.setUint16(22,this.channels,!0),u.setUint32(24,this.samplesPerSec,!0),u.setUint32(28,this.avgBytesPerSec,!0),u.setUint16(32,this.channels*(this.bitsPerSample/8),!0),u.setUint16(34,this.bitsPerSample,!0),this.setString(u,36,"data"),u.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new i}static getAudioContext(s){const o=window.AudioContext||window.webkitAudioContext||!1;if(o)return s!==void 0&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new o({sampleRate:s}):new o;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(s,o,a){for(let l=0;l<a.length;l++)s.setUint8(o+l,a.charCodeAt(l))}}t.AudioStreamFormatImpl=i})(vc);var bM;function aq(){return bM||(bM=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.MicAudioSource=t.AudioWorkletSourceURLPropertyName=void 0;const e=Ve(),n=ht(),i=vc;t.AudioWorkletSourceURLPropertyName="MICROPHONE-WorkletSourceUrl";class r{constructor(o,a,l,c){this.privRecorder=o,this.deviceId=a,this.privStreams={},this.privOutputChunkSize=r.AUDIOFORMAT.avgBytesPerSec/10,this.privId=l||n.createNoDashGuid(),this.privEvents=new n.EventSource,this.privMediaStream=c||null,this.privIsClosing=!1}get format(){return Promise.resolve(r.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new n.Deferred;try{this.createAudioContext()}catch(l){if(l instanceof Error){const c=l;this.privInitializeDeferral.reject(c.name+": "+c.message)}else this.privInitializeDeferral.reject(l);return this.privInitializeDeferral.promise}const o=window.navigator;let a=o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia;if(o.mediaDevices&&(a=(l,c,u)=>{o.mediaDevices.getUserMedia(l).then(c).catch(u)}),a){const l=()=>{this.onEvent(new n.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):a({audio:this.deviceId?{deviceId:this.deviceId}:!0,video:!1},c=>{this.privMediaStream=c,this.onEvent(new n.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()},c=>{const u=`Error occurred during microphone initialization: ${c}`;this.privInitializeDeferral.reject(u),this.onEvent(new n.AudioSourceErrorEvent(this.privId,u))})};this.privContext.state==="suspended"?this.privContext.resume().then(l).catch(c=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${c}`)}):l()}else{const l="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(l),this.onEvent(new n.AudioSourceErrorEvent(l,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(o){return this.onEvent(new n.AudioStreamNodeAttachingEvent(this.privId,o)),this.listen(o).then(a=>(this.onEvent(new n.AudioStreamNodeAttachedEvent(this.privId,o)),{detach:async()=>(a.readEnded(),delete this.privStreams[o],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,o)),this.turnOff()),id:()=>o,read:()=>a.read()}))}detach(o){o&&this.privStreams[o]&&(this.privStreams[o].close(),delete this.privStreams[o],this.onEvent(new n.AudioStreamNodeDetachedEvent(this.privId,o)))}async turnOff(){for(const o in this.privStreams)if(o){const a=this.privStreams[o];a&&a.close()}this.onEvent(new n.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&(await this.privInitializeDeferral,this.privInitializeDeferral=null),await this.destroyAudioContext()}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(o=>({bitspersample:r.AUDIOFORMAT.bitsPerSample,channelcount:r.AUDIOFORMAT.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:o,samplerate:r.AUDIOFORMAT.samplesPerSec,type:e.type.Microphones}))}setProperty(o,a){if(o===t.AudioWorkletSourceURLPropertyName)this.privRecorder.setWorkletUrl(a);else throw new Error("Property '"+o+"' is not supported on Microphone.")}getMicrophoneLabel(){const o="microphone";if(this.privMicrophoneLabel!==void 0)return Promise.resolve(this.privMicrophoneLabel);if(this.privMediaStream===void 0||!this.privMediaStream.active)return Promise.resolve(o);this.privMicrophoneLabel=o;const a=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(a===void 0)return Promise.resolve(this.privMicrophoneLabel);const l=new n.Deferred;return navigator.mediaDevices.enumerateDevices().then(c=>{for(const u of c)if(u.deviceId===a){this.privMicrophoneLabel=u.label;break}l.resolve(this.privMicrophoneLabel)},()=>l.resolve(this.privMicrophoneLabel)),l.promise}async listen(o){await this.turnOn();const a=new n.ChunkedArrayBufferStream(this.privOutputChunkSize,o);this.privStreams[o]=a;try{this.privRecorder.record(this.privContext,this.privMediaStream,a)}catch(c){throw this.onEvent(new n.AudioStreamNodeErrorEvent(this.privId,o,c)),c}return a}onEvent(o){this.privEvents.onEvent(o),n.Events.instance.onEvent(o)}createAudioContext(){this.privContext||(this.privContext=i.AudioStreamFormatImpl.getAudioContext(r.AUDIOFORMAT.samplesPerSec))}async destroyAudioContext(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let o=!1;"close"in this.privContext&&(o=!0),o?this.privIsClosing||(this.privIsClosing=!0,await this.privContext.close(),this.privContext=null,this.privIsClosing=!1):this.privContext!==null&&this.privContext.state==="running"&&await this.privContext.suspend()}}t.MicAudioSource=r,r.AUDIOFORMAT=i.AudioStreamFormat.getDefaultInputFormat()}(P_)),P_}var qp={},AM;function lq(){if(AM)return qp;AM=1,Object.defineProperty(qp,"__esModule",{value:!0}),qp.FileAudioSource=void 0;const t=Ve(),e=ht(),n=vc;let i=class{constructor(s,o,a){this.privStreams={},this.privHeaderEnd=44,this.privId=a||e.createNoDashGuid(),this.privEvents=new e.EventSource,this.privSource=s,typeof window<"u"&&typeof Blob<"u"&&this.privSource instanceof Blob?this.privFilename=s.name:this.privFilename=o||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){const s=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new e.AudioSourceErrorEvent(s,"")),Promise.reject(s)}this.onEvent(new e.AudioSourceInitializingEvent(this.privId)),this.onEvent(new e.AudioSourceReadyEvent(this.privId))}id(){return this.privId}async attach(s){this.onEvent(new e.AudioStreamNodeAttachingEvent(this.privId,s));const o=await this.upload(s);return this.onEvent(new e.AudioStreamNodeAttachedEvent(this.privId,s)),Promise.resolve({detach:async()=>{o.readEnded(),delete this.privStreams[s],this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,s)),await this.turnOff()},id:()=>s,read:()=>o.read()})}detach(s){s&&this.privStreams[s]&&(this.privStreams[s].close(),delete this.privStreams[s],this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,s)))}turnOff(){for(const s in this.privStreams)if(s){const o=this.privStreams[s];o&&!o.isClosed&&o.close()}return this.onEvent(new e.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(s=>Promise.resolve({bitspersample:s.bitsPerSample,channelcount:s.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:s.samplesPerSec,type:t.type.File}))}readHeader(){const o=this.privSource.slice(0,4296),a=new e.Deferred,l=c=>{const u=new DataView(c),h=m=>String.fromCharCode(u.getUint8(m),u.getUint8(m+1),u.getUint8(m+2),u.getUint8(m+3));if(h(0)!=="RIFF"){a.reject("Invalid WAV header in file, RIFF was not found");return}if(h(8)!=="WAVE"||h(12)!=="fmt "){a.reject("Invalid WAV header in file, WAVEfmt was not found");return}const d=u.getInt32(16,!0),p=u.getUint16(22,!0),f=u.getUint32(24,!0),v=u.getUint16(34,!0);let g=36+Math.max(d-16,0);for(;h(g)!=="data";g+=2)if(g>4288){a.reject("Invalid WAV header in file, data block was not found");return}this.privHeaderEnd=g+8,a.resolve(n.AudioStreamFormat.getWaveFormatPCM(f,v,p))};if(typeof window<"u"&&typeof Blob<"u"&&o instanceof Blob){const c=new FileReader;c.onload=u=>{const h=u.target.result;l(h)},c.readAsArrayBuffer(o)}else{const c=o;l(c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength))}return a.promise}async upload(s){const o=a=>{const l=`Error occurred while processing '${this.privFilename}'. ${a}`;throw this.onEvent(new e.AudioStreamNodeErrorEvent(this.privId,s,l)),new Error(l)};try{await this.turnOn();const a=await this.privAudioFormatPromise,l=new e.ChunkedArrayBufferStream(a.avgBytesPerSec/10,s);this.privStreams[s]=l;const c=this.privSource.slice(this.privHeaderEnd),u=h=>{l.isClosed||(l.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()}),l.close())};if(typeof window<"u"&&typeof Blob<"u"&&c instanceof Blob){const h=new FileReader;h.onerror=d=>o(d.toString()),h.onload=d=>{const p=d.target.result;u(p)},h.readAsArrayBuffer(c)}else{const h=c;u(h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength))}return l}catch(a){o(a)}}onEvent(s){this.privEvents.onEvent(s),e.Events.instance.onEvent(s)}};return qp.FileAudioSource=i,qp}var ex={};Object.defineProperty(ex,"__esModule",{value:!0});ex.PcmRecorder=void 0;const cq=ht();class uq{constructor(e){this.privStopInputOnRelease=e}record(e,n,i){const s=new cq.RiffPcmEncoder(e.sampleRate,16e3),o=e.createMediaStreamSource(n),a=()=>{const c=(()=>{let u=0;try{return e.createScriptProcessor(u,1,1)}catch{u=2048;let d=e.sampleRate;for(;u<16384&&d>=32e3;)u<<=1,d>>=1;return e.createScriptProcessor(u,1,1)}})();c.onaudioprocess=u=>{const h=u.inputBuffer.getChannelData(0);if(i&&!i.isClosed){const d=s.encode(h);d&&i.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()})}},o.connect(c),c.connect(e.destination),this.privMediaResources={scriptProcessorNode:c,source:o,stream:n}},l=!!this.privSpeechProcessorScript&&this.privSpeechProcessorScript.toLowerCase()==="ignore";if(e.audioWorklet&&!l){if(!this.privSpeechProcessorScript){const c=`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`,u=new Blob([c],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(u)}e.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{const c=new AudioWorkletNode(e,"speech-processor");c.port.onmessage=u=>{const h=u.data;if(i&&!i.isClosed){const d=s.encode(h);d&&i.writeStreamChunk({buffer:d,isEnd:!1,timeReceived:Date.now()})}},o.connect(c),c.connect(e.destination),this.privMediaResources={scriptProcessorNode:c,source:o,stream:n}}).catch(()=>{a()})}else try{a()}catch(c){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${c}`)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(n=>n.stop()),this.privMediaResources.source=null))}setWorkletUrl(e){this.privSpeechProcessorScript=e}}ex.PcmRecorder=uq;var tx={},T0={},hq=It&&It.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),dq=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),EU=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.hasOwnProperty.call(t,n)&&hq(e,t,n);return dq(e,t),e},c2=It&&It.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(T0,"__esModule",{value:!0});T0.WebsocketMessageAdapter=void 0;const pq=EU(Xu),fq=EU(Xu),mq=c2(Xu),gq=c2(Xu),vq=c2(Xu),yq=Fi,Et=ht();class qg{constructor(e,n,i,r,s,o){if(!e)throw new Et.ArgumentNullError("uri");if(!i)throw new Et.ArgumentNullError("messageFormatter");this.proxyInfo=r,this.privConnectionEvents=new Et.EventSource,this.privConnectionId=n,this.privMessageFormatter=i,this.privConnectionState=Et.ConnectionState.None,this.privUri=e,this.privHeaders=s,this.privEnableCompression=o,this.privHeaders[yq.HeaderNames.ConnectionId]=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===Et.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new Et.Deferred,this.privCertificateValidatedDeferral=new Et.Deferred,this.privConnectionState=Et.ConnectionState.Connecting;try{if(typeof WebSocket<"u"&&!qg.forceNpmWebSocket)this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);else{const e={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression};this.privCertificateValidatedDeferral.resolve(),e.agent=this.getAgent();let i=new URL(this.privUri).protocol;(i==null?void 0:i.toLocaleLowerCase())==="wss:"?i="https:":(i==null?void 0:i.toLocaleLowerCase())==="ws:"&&(i="http:"),e.agent.protocol=i,this.privWebsocketClient=new vq.default(this.privUri,e)}this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new Et.Queue,this.privDisconnectDeferral=new Et.Deferred,this.privSendMessageQueue=new Et.Queue,this.processSendQueue().catch(e=>{Et.Events.instance.onEvent(new Et.BackgroundEvent(e))})}catch(e){return this.privConnectionEstablishDeferral.resolve(new Et.ConnectionOpenResponse(500,e)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new Et.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=Et.ConnectionState.Connected,this.onEvent(new Et.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new Et.ConnectionOpenResponse(200,""))},e=>{this.privConnectionEstablishDeferral.reject(e)})},this.privWebsocketClient.onerror=e=>{this.onEvent(new Et.ConnectionErrorEvent(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===Et.ConnectionState.Connecting?(this.privConnectionState=Et.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new Et.ConnectionOpenResponse(e.code,e.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=Et.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new Et.ConnectionClosedEvent(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch(n=>{Et.Events.instance.onEvent(new Et.BackgroundEvent(n))})},this.privWebsocketClient.onmessage=e=>{const n=new Date().toISOString();if(this.privConnectionState===Et.ConnectionState.Connected){const i=new Et.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(i.promise),e.data instanceof ArrayBuffer){const r=new Et.RawWebsocketMessage(Et.MessageType.Binary,e.data);this.privMessageFormatter.toConnectionMessage(r).then(s=>{this.onEvent(new Et.ConnectionMessageReceivedEvent(this.privConnectionId,n,s)),i.resolve(s)},s=>{i.reject(`Invalid binary message format. Error: ${s}`)})}else{const r=new Et.RawWebsocketMessage(Et.MessageType.Text,e.data);this.privMessageFormatter.toConnectionMessage(r).then(s=>{this.onEvent(new Et.ConnectionMessageReceivedEvent(this.privConnectionId,n,s)),i.resolve(s)},s=>{i.reject(`Invalid text message format. Error: ${s}`)})}}},this.privConnectionEstablishDeferral.promise}send(e){if(this.privConnectionState!==Et.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${Et.ConnectionState[this.privConnectionState]} state`);const n=new Et.Deferred,i=new Et.Deferred;return this.privSendMessageQueue.enqueueFromPromise(i.promise),this.privMessageFormatter.fromConnectionMessage(e).then(r=>{i.resolve({Message:e,RawWebsocketMessage:r,sendStatusDeferral:n})},r=>{i.reject(`Error formatting the message. ${r}`)}),n.promise}read(){return this.privConnectionState!==Et.ConnectionState.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(e){if(this.privWebsocketClient)this.privConnectionState!==Et.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client");else return Promise.resolve();return this.privDisconnectDeferral.promise}get events(){return this.privConnectionEvents}sendRawMessage(e){try{if(!e)return Promise.resolve();if(this.onEvent(new Et.ConnectionMessageSentEvent(this.privConnectionId,new Date().toISOString(),e.Message)),this.isWebsocketOpen)this.privWebsocketClient.send(e.RawWebsocketMessage.payload);else return Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+e.Message.id+" "+new Error().stack);return Promise.resolve()}catch(n){return Promise.reject(`websocket send error: ${n}`)}}async onClose(e,n){const i=`Connection closed. ${e}: ${n}`;this.privConnectionState=Et.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),await this.privReceivingMessageQueue.drainAndDispose(()=>{},i),await this.privSendMessageQueue.drainAndDispose(r=>{r.sendStatusDeferral.reject(i)},i)}async processSendQueue(){for(;;){const n=await this.privSendMessageQueue.dequeue();if(!n)return;try{await this.sendRawMessage(n),n.sendStatusDeferral.resolve()}catch(i){n.sendStatusDeferral.reject(i)}}}onEvent(e){this.privConnectionEvents.onEvent(e),Et.Events.instance.onEvent(e)}getAgent(){const e=new mq.default.Agent(this.createConnection);return this.proxyInfo!==void 0&&this.proxyInfo.HostName!==void 0&&this.proxyInfo.Port>0&&(e.proxyInfo=this.proxyInfo),e}static GetProxyAgent(e){const n={host:e.HostName,port:e.Port};return e.UserName?n.headers={"Proxy-Authentication":"Basic "+new Buffer(`${e.UserName}:${e.Password===void 0?"":e.Password}`).toString("base64")}:n.headers={},n.headers.requestOCSP="true",new gq.default(n)}createConnection(e,n){let i;if(n={...n,requestOCSP:!0,servername:n.host},this.proxyInfo){const s=qg.GetProxyAgent(this.proxyInfo);i=new Promise((o,a)=>{s.callback(e,n,(l,c)=>{l?a(l):o(c)})})}else n.secureEndpoint?i=Promise.resolve(fq.connect(n)):i=Promise.resolve(pq.connect(n));return i}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}}T0.WebsocketMessageAdapter=qg;qg.forceNpmWebSocket=!1;Object.defineProperty(tx,"__esModule",{value:!0});tx.WebsocketConnection=void 0;const I_=ht(),Sq=T0;class xq{constructor(e,n,i,r,s,o=!1,a){if(this.privIsDisposed=!1,!e)throw new I_.ArgumentNullError("uri");if(!r)throw new I_.ArgumentNullError("messageFormatter");this.privMessageFormatter=r;let l="",c=0;if(n){for(const u in n)if(u){l+=c===0&&e.indexOf("?")===-1?"?":"&";const h=encodeURIComponent(u);l+=h;let d=n[u];d&&(d=encodeURIComponent(d),l+=`=${d}`),c++}}if(i){for(const u in i)if(u){l+=c===0&&e.indexOf("?")===-1?"?":"&";const h=encodeURIComponent(i[u]);l+=`${u}=${h}`,c++}}this.privUri=e+l,this.privId=a||I_.createNoDashGuid(),this.privConnectionMessageAdapter=new Sq.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,s,i,o)}async dispose(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&await this.privConnectionMessageAdapter.close()}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}}tx.WebsocketConnection=xq;var nx={};Object.defineProperty(nx,"__esModule",{value:!0});nx.ReplayableAudioNode=void 0;class Cq{constructor(e,n){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=n}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&this.privBuffers.length!==0){const e=this.privReplayOffset-this.privBufferStartOffset;let n=Math.round(e*this.privBytesPerSecond*1e-7);n%2!==0&&n++;let i=0;for(;i<this.privBuffers.length&&n>=this.privBuffers[i].chunk.buffer.byteLength;)n-=this.privBuffers[i++].chunk.buffer.byteLength;if(i<this.privBuffers.length){const r=this.privBuffers[i].chunk.buffer.slice(n);return this.privReplayOffset+=r.byteLength/this.privBytesPerSecond*1e7,i===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:r,isEnd:!1,timeReceived:this.privBuffers[i].chunk.timeReceived})}}return this.privAudioNode.read().then(e=>(e&&e.buffer&&(this.privBuffers.push(new _q(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&this.privBuffers.length!==0&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(this.privBuffers===void 0||this.privBuffers.length===0)return;this.privLastShrinkOffset=e;const n=e-this.privBufferStartOffset;let i=Math.round(n*this.privBytesPerSecond*1e-7),r=0;for(;r<this.privBuffers.length&&i>=this.privBuffers[r].chunk.buffer.byteLength;)i-=this.privBuffers[r++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-i/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(r)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||this.privBuffers===void 0)return 0;for(const n of this.privBuffers){const i=n.byteOffset/this.privBytesPerSecond*1e7,r=i+n.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=i&&e<=r)return n.chunk.timeReceived}return 0}}nx.ReplayableAudioNode=Cq;class _q{constructor(e,n,i){this.chunk=e,this.serial=n,this.byteOffset=i}}var Xp={},M_={},ya={},b0={},wq=It&&It.__createBinding||(Object.create?function(t,e,n,i){i===void 0&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}),Eq=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Rq=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.hasOwnProperty.call(t,n)&&wq(e,t,n);return Eq(e,t),e};Object.defineProperty(b0,"__esModule",{value:!0});b0.AudioFileWriter=void 0;const Kp=Rq(Xu),k_=Ct;class Tq{constructor(e){k_.Contracts.throwIfNullOrUndefined(Kp.openSync,`
File System access not available, please use Push or PullAudioOutputStream`),this.privFd=Kp.openSync(e,"w")}set format(e){k_.Contracts.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=e;let n=0;this.privAudioFormat.hasHeader&&(n=this.privAudioFormat.header.byteLength),this.privFd!==void 0&&(this.privWriteStream=Kp.createWriteStream("",{fd:this.privFd,start:n,autoClose:!1}))}write(e){k_.Contracts.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),this.privWriteStream!==void 0&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){this.privFd!==void 0&&(this.privWriteStream.on("finish",()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),Kp.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),Kp.closeSync(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}}b0.AudioFileWriter=Tq;var ts={},PM;function RU(){if(PM)return ts;PM=1,Object.defineProperty(ts,"__esModule",{value:!0}),ts.PullAudioInputStreamImpl=ts.PullAudioInputStream=ts.PushAudioInputStreamImpl=ts.PushAudioInputStream=ts.AudioInputStream=void 0;const t=Ve(),e=ht(),n=Ys,i=me(),r=vc;let s=class{constructor(){}static createPushStream(h){return o.create(h)}static createPullStream(h,d){return l.create(h,d)}};ts.AudioInputStream=s;class o extends s{static create(h){return new a(h)}}ts.PushAudioInputStream=o;class a extends o{constructor(h){super(),h===void 0?this.privFormat=r.AudioStreamFormatImpl.getDefaultInputFormat():this.privFormat=h,this.privEvents=new e.EventSource,this.privId=n.createNoDashGuid(),this.privStream=new e.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(h){this.privStream.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new e.AudioSourceInitializingEvent(this.privId)),this.onEvent(new e.AudioSourceReadyEvent(this.privId))}async attach(h){this.onEvent(new e.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn();const d=this.privStream;return this.onEvent(new e.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:async()=>(this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>d.read()}}detach(h){this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:t.type.Stream})}onEvent(h){this.privEvents.onEvent(h),e.Events.instance.onEvent(h)}toBuffer(h){const d=Buffer.alloc(h.byteLength),p=new Uint8Array(h);for(let f=0;f<d.length;++f)d[f]=p[f];return d}}ts.PushAudioInputStreamImpl=a;class l extends s{constructor(){super()}static create(h,d){return new c(h,d)}}ts.PullAudioInputStream=l;class c extends l{constructor(h,d){super(),d===void 0?this.privFormat=i.AudioStreamFormat.getDefaultInputFormat():this.privFormat=d,this.privEvents=new e.EventSource,this.privId=n.createNoDashGuid(),this.privCallback=h,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new e.AudioSourceInitializingEvent(this.privId)),this.onEvent(new e.AudioSourceReadyEvent(this.privId))}async attach(h){return this.onEvent(new e.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn(),this.onEvent(new e.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:()=>(this.privCallback.close(),this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>{let d=0,p;for(;d<this.privBufferSize;){const f=new ArrayBuffer(this.privBufferSize-d),v=this.privCallback.read(f);if(p===void 0?p=f:new Int8Array(p).set(new Int8Array(f),d),v===0)break;d+=v}return Promise.resolve({buffer:p.slice(0,d),isEnd:this.privIsClosed||d===0,timeReceived:Date.now()})}}}detach(h){this.onEvent(new e.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:t.type.Stream})}onEvent(h){this.privEvents.onEvent(h),e.Events.instance.onEvent(h)}}return ts.PullAudioInputStreamImpl=c,ts}var Vi={},yc={},u2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechSynthesisOutputFormat=void 0,function(e){e[e.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",e[e.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",e[e.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",e[e.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",e[e.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",e[e.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",e[e.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",e[e.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",e[e.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",e[e.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",e[e.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",e[e.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",e[e.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",e[e.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",e[e.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",e[e.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",e[e.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",e[e.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",e[e.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",e[e.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",e[e.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",e[e.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",e[e.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",e[e.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",e[e.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",e[e.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",e[e.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",e[e.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",e[e.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",e[e.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",e[e.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",e[e.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",e[e.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",e[e.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",e[e.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",e[e.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",e[e.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm",e[e.AmrWb16000Hz=37]="AmrWb16000Hz",e[e.G72216Khz64Kbps=38]="G72216Khz64Kbps"}(t.SpeechSynthesisOutputFormat||(t.SpeechSynthesisOutputFormat={}))})(u2);Object.defineProperty(yc,"__esModule",{value:!0});yc.AudioOutputFormatImpl=void 0;const kt=u2,Rt=vc;class vt extends Rt.AudioStreamFormatImpl{constructor(e,n,i,r,s,o,a,l,c){super(i,o,n,e),this.formatTag=e,this.avgBytesPerSec=r,this.blockAlign=s,this.priAudioFormatString=a,this.priRequestAudioFormatString=l,this.priHasHeader=c}static fromSpeechSynthesisOutputFormat(e){return e===void 0?vt.getDefaultOutputFormat():vt.fromSpeechSynthesisOutputFormatString(vt.SpeechSynthesisOutputFormatToString[e])}static fromSpeechSynthesisOutputFormatString(e){switch(e){case"raw-8khz-8bit-mono-mulaw":return new vt(Rt.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,e,!1);case"riff-16khz-16kbps-mono-siren":return new vt(Rt.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new vt(Rt.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,e,!1);case"audio-16khz-32kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,16e3,4096,2,16,e,e,!1);case"audio-16khz-128kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,16e3,16384,2,16,e,e,!1);case"audio-16khz-64kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,16e3,8192,2,16,e,e,!1);case"audio-24khz-48kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,24e3,6144,2,16,e,e,!1);case"audio-24khz-96kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,24e3,12288,2,16,e,e,!1);case"audio-24khz-160kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,24e3,20480,2,16,e,e,!1);case"raw-16khz-16bit-mono-truesilk":return new vt(Rt.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,e,e,!1);case"riff-8khz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new vt(Rt.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,16e3,32e3,2,16,e,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new vt(Rt.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,e,e,!1);case"ogg-24khz-16bit-mono-opus":return new vt(Rt.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,e,e,!1);case"raw-48khz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,48e3,12288,2,16,e,e,!1);case"audio-48khz-192kbitrate-mono-mp3":return new vt(Rt.AudioFormatTag.MP3,1,48e3,24576,2,16,e,e,!1);case"ogg-48khz-16bit-mono-opus":return new vt(Rt.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,e,e,!1);case"webm-16khz-16bit-mono-opus":return new vt(Rt.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,e,e,!1);case"webm-24khz-16bit-mono-opus":return new vt(Rt.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,e,e,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new vt(Rt.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new vt(Rt.AudioFormatTag.OPUS,1,16e3,4e3,2,16,e,e,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new vt(Rt.AudioFormatTag.OPUS,1,24e3,6e3,2,16,e,e,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new vt(Rt.AudioFormatTag.OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-24khz-16bit-mono-flac":return new vt(Rt.AudioFormatTag.FLAC,1,24e3,24e3,2,16,e,e,!1);case"audio-48khz-16bit-mono-flac":return new vt(Rt.AudioFormatTag.FLAC,1,48e3,3e4,2,16,e,e,!1);case"raw-24khz-16bit-mono-truesilk":return new vt(Rt.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,e,e,!1);case"raw-8khz-8bit-mono-alaw":return new vt(Rt.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,e,!1);case"riff-8khz-8bit-mono-alaw":return new vt(Rt.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,22050,44100,2,16,e,e,!1);case"riff-22050hz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,22050,44100,2,16,e,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,44100,88200,2,16,e,e,!1);case"riff-44100hz-16bit-mono-pcm":return new vt(Rt.AudioFormatTag.PCM,1,44100,88200,2,16,e,"raw-44100hz-16bit-mono-pcm",!0);case"amr-wb-16000h":return new vt(Rt.AudioFormatTag.AMR_WB,1,16e3,3052,2,16,e,e,!1);case"g722-16khz-64kbps":return new vt(Rt.AudioFormatTag.G722,1,16e3,8e3,2,16,e,e,!1);case"riff-16khz-16bit-mono-pcm":default:return new vt(Rt.AudioFormatTag.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return vt.fromSpeechSynthesisOutputFormatString(typeof window<"u"?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){if(this.priHasHeader){const n=new DataView(this.privHeader);n.setUint32(4,e+this.privHeader.byteLength-8,!0),n.setUint32(40,e,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(e){if(!this.hasHeader)return e;this.updateHeader(e.byteLength);const n=new Uint8Array(e.byteLength+this.header.byteLength);return n.set(new Uint8Array(this.header),0),n.set(new Uint8Array(e),this.header.byteLength),n.buffer}}yc.AudioOutputFormatImpl=vt;vt.SpeechSynthesisOutputFormatToString={[kt.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[kt.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[kt.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[kt.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[kt.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[kt.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[kt.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[kt.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[kt.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[kt.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[kt.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[kt.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm",[kt.SpeechSynthesisOutputFormat.AmrWb16000Hz]:"amr-wb-16000hz",[kt.SpeechSynthesisOutputFormat.G72216Khz64Kbps]:"g722-16khz-64kbps"};Object.defineProperty(Vi,"__esModule",{value:!0});Vi.PushAudioOutputStreamImpl=Vi.PushAudioOutputStream=Vi.PullAudioOutputStreamImpl=Vi.PullAudioOutputStream=Vi.AudioOutputStream=void 0;const aR=ht(),bq=Ct,Aq=yc;class h2{constructor(){}static createPullStream(){return d2.create()}}Vi.AudioOutputStream=h2;class d2 extends h2{static create(){return new TU}}Vi.PullAudioOutputStream=d2;class TU extends d2{constructor(){super(),this.privId=aR.createNoDashGuid(),this.privStream=new aR.Stream}set format(e){e==null&&(this.privFormat=Aq.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}async read(e){const n=new Int8Array(e);let i=0;if(this.privLastChunkView!==void 0){if(this.privLastChunkView.length>e.byteLength)return n.set(this.privLastChunkView.slice(0,e.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(e.byteLength),Promise.resolve(e.byteLength);n.set(this.privLastChunkView),i=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;i<e.byteLength&&!this.privStream.isReadEnded;){const r=await this.privStream.read();if(r!==void 0&&!r.isEnd){let s;r.buffer.byteLength>e.byteLength-i?(s=r.buffer.slice(0,e.byteLength-i),this.privLastChunkView=new Int8Array(r.buffer.slice(e.byteLength-i))):s=r.buffer,n.set(new Int8Array(s),i),i+=s.byteLength}else this.privStream.readEnded()}return i}write(e){bq.Contracts.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}Vi.PullAudioOutputStreamImpl=TU;class bU extends h2{constructor(){super()}static create(e){return new AU(e)}}Vi.PushAudioOutputStream=bU;class AU extends bU{constructor(e){super(),this.privId=aR.createNoDashGuid(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}Vi.PushAudioOutputStreamImpl=AU;var IM;function IU(){if(IM)return ya;IM=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.AudioOutputConfigImpl=ya.AudioConfigImpl=ya.AudioConfig=void 0;const t=zi(),e=Ct,n=me(),i=b0,r=RU(),s=Vi;let o=class PU{static fromDefaultMicrophoneInput(){const u=new t.PcmRecorder(!0);return new a(new t.MicAudioSource(u))}static fromMicrophoneInput(u){const h=new t.PcmRecorder(!0);return new a(new t.MicAudioSource(h,u))}static fromWavFileInput(u,h="unnamedBuffer.wav"){return new a(new t.FileAudioSource(u,h))}static fromStreamInput(u){if(u instanceof n.PullAudioInputStreamCallback)return new a(new r.PullAudioInputStreamImpl(u));if(u instanceof n.AudioInputStream)return new a(u);if(typeof MediaStream<"u"&&u instanceof MediaStream){const h=new t.PcmRecorder(!1);return new a(new t.MicAudioSource(h,null,null,u))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new l(new n.SpeakerAudioDestination)}static fromSpeakerOutput(u){if(u===void 0)return PU.fromDefaultSpeakerOutput();if(u instanceof n.SpeakerAudioDestination)return new l(u);throw new Error("Not Supported Type")}static fromAudioFileOutput(u){return new l(new i.AudioFileWriter(u))}static fromStreamOutput(u){if(u instanceof n.PushAudioOutputStreamCallback)return new l(new s.PushAudioOutputStreamImpl(u));if(u instanceof n.PushAudioOutputStream)return new l(u);if(u instanceof n.PullAudioOutputStream)return new l(u);throw new Error("Not Supported Type")}};ya.AudioConfig=o;class a extends o{constructor(u){super(),this.privSource=u}get format(){return this.privSource.format}close(u,h){this.privSource.turnOff().then(()=>{u&&u()},d=>{h&&h(d)})}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(u){return this.privSource.attach(u)}detach(u){return this.privSource.detach(u)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(u,h){if(e.Contracts.throwIfNull(h,"value"),this.privSource.setProperty!==void 0)this.privSource.setProperty(u,h);else throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(u,h){if(this.privSource.getProperty!==void 0)return this.privSource.getProperty(u,h);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}ya.AudioConfigImpl=a;class l extends o{constructor(u){super(),this.privDestination=u}set format(u){this.privDestination.format=u}write(u){this.privDestination.write(u)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}return ya.AudioOutputConfigImpl=l,ya}var MU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationReason=void 0,function(e){e[e.Error=0]="Error",e[e.EndOfStream=1]="EndOfStream"}(t.CancellationReason||(t.CancellationReason={}))})(MU);var ix={};Object.defineProperty(ix,"__esModule",{value:!0});ix.PullAudioInputStreamCallback=void 0;class Pq{}ix.PullAudioInputStreamCallback=Pq;var rx={};Object.defineProperty(rx,"__esModule",{value:!0});rx.PushAudioOutputStreamCallback=void 0;class Iq{}rx.PushAudioOutputStreamCallback=Iq;var sx={};Object.defineProperty(sx,"__esModule",{value:!0});sx.KeywordRecognitionModel=void 0;const MM=Ct;class Mq{constructor(){this.privDisposed=!1}static fromFile(e){throw MM.Contracts.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")}static fromStream(e){throw MM.Contracts.throwIfNull(e,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}}sx.KeywordRecognitionModel=Mq;var ox={};Object.defineProperty(ox,"__esModule",{value:!0});ox.SessionEventArgs=void 0;class kq{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}ox.SessionEventArgs=kq;var Yp={},kM;function Lq(){if(kM)return Yp;kM=1,Object.defineProperty(Yp,"__esModule",{value:!0}),Yp.RecognitionEventArgs=void 0;const t=me();let e=class extends t.SessionEventArgs{constructor(i,r){super(r),this.privOffset=i}get offset(){return this.privOffset}};return Yp.RecognitionEventArgs=e,Yp}var kU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.OutputFormat=void 0,function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(t.OutputFormat||(t.OutputFormat={}))})(kU);var Jp={},LM;function Dq(){if(LM)return Jp;LM=1,Object.defineProperty(Jp,"__esModule",{value:!0}),Jp.IntentRecognitionEventArgs=void 0;const t=me();let e=class extends t.RecognitionEventArgs{constructor(i,r,s){super(r,s),this.privResult=i}get result(){return this.privResult}};return Jp.IntentRecognitionEventArgs=e,Jp}var ax={};Object.defineProperty(ax,"__esModule",{value:!0});ax.RecognitionResult=void 0;class Nq{constructor(e,n,i,r,s,o,a,l,c,u){this.privResultId=e,this.privReason=n,this.privText=i,this.privDuration=r,this.privOffset=s,this.privLanguage=o,this.privLanguageDetectionConfidence=a,this.privErrorDetails=l,this.privJson=c,this.privProperties=u}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}ax.RecognitionResult=Nq;var Qp={},DM;function Oq(){if(DM)return Qp;DM=1,Object.defineProperty(Qp,"__esModule",{value:!0}),Qp.SpeechRecognitionResult=void 0;const t=me();let e=class extends t.RecognitionResult{constructor(i,r,s,o,a,l,c,u,h,d,p){super(i,r,s,o,a,l,c,h,d,p),this.privSpeakerId=u}get speakerId(){return this.privSpeakerId}};return Qp.SpeechRecognitionResult=e,Qp}var Zp={},NM;function Fq(){if(NM)return Zp;NM=1,Object.defineProperty(Zp,"__esModule",{value:!0}),Zp.IntentRecognitionResult=void 0;const t=me();let e=class extends t.SpeechRecognitionResult{constructor(i,r,s,o,a,l,c,u,h,d,p){super(r,s,o,a,l,c,u,void 0,h,d,p),this.privIntentId=i}get intentId(){return this.privIntentId}};return Zp.IntentRecognitionResult=e,Zp}var Ad={};Object.defineProperty(Ad,"__esModule",{value:!0});Ad.LanguageUnderstandingModelImpl=Ad.LanguageUnderstandingModel=void 0;const ch=Ct;class LU{constructor(){}static fromEndpoint(e){ch.Contracts.throwIfNull(e,"uri"),ch.Contracts.throwIfNullOrWhitespace(e.hostname,"uri");const n=new Py,i=e.host.indexOf(".");if(i===-1)throw new Error("Could not determine region from endpoint");n.region=e.host.substr(0,i);const r=e.pathname.lastIndexOf("/")+1;if(r===-1)throw new Error("Could not determine appId from endpoint");if(n.appId=e.pathname.substr(r),n.subscriptionKey=e.searchParams.get("subscription-key"),n.subscriptionKey===void 0)throw new Error("Could not determine subscription key from endpoint");return n}static fromAppId(e){ch.Contracts.throwIfNullOrWhitespace(e,"appId");const n=new Py;return n.appId=e,n}static fromSubscription(e,n,i){ch.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),ch.Contracts.throwIfNullOrWhitespace(n,"appId"),ch.Contracts.throwIfNullOrWhitespace(i,"region");const r=new Py;return r.appId=n,r.region=i,r.subscriptionKey=e,r}}Ad.LanguageUnderstandingModel=LU;class Py extends LU{}Ad.LanguageUnderstandingModelImpl=Py;var Sa={},OM;function zq(){if(OM)return Sa;OM=1,Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.MeetingTranscriptionEventArgs=Sa.ConversationTranscriptionEventArgs=Sa.SpeechRecognitionEventArgs=void 0;const t=me();let e=class extends t.RecognitionEventArgs{constructor(s,o,a){super(o,a),this.privResult=s}get result(){return this.privResult}};Sa.SpeechRecognitionEventArgs=e;class n extends t.RecognitionEventArgs{constructor(s,o,a){super(o,a),this.privResult=s}get result(){return this.privResult}}Sa.ConversationTranscriptionEventArgs=n;class i extends e{}return Sa.MeetingTranscriptionEventArgs=i,Sa}var ef={},tf={},FM;function A0(){if(FM)return tf;FM=1,Object.defineProperty(tf,"__esModule",{value:!0}),tf.CancellationEventArgsBase=void 0;const t=me();let e=class extends t.RecognitionEventArgs{constructor(i,r,s,o,a){super(o,a),this.privReason=i,this.privErrorDetails=r,this.privErrorCode=s}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return tf.CancellationEventArgsBase=e,tf}var zM;function Uq(){if(zM)return ef;zM=1,Object.defineProperty(ef,"__esModule",{value:!0}),ef.SpeechRecognitionCanceledEventArgs=void 0;const t=A0();let e=class extends t.CancellationEventArgsBase{};return ef.SpeechRecognitionCanceledEventArgs=e,ef}var nf={},UM;function Bq(){if(UM)return nf;UM=1,Object.defineProperty(nf,"__esModule",{value:!0}),nf.TranslationRecognitionEventArgs=void 0;const t=me();let e=class extends t.RecognitionEventArgs{constructor(i,r,s){super(r,s),this.privResult=i}get result(){return this.privResult}};return nf.TranslationRecognitionEventArgs=e,nf}var rf={},BM;function $q(){if(BM)return rf;BM=1,Object.defineProperty(rf,"__esModule",{value:!0}),rf.TranslationSynthesisEventArgs=void 0;const t=me();let e=class extends t.SessionEventArgs{constructor(i,r){super(r),this.privResult=i}get result(){return this.privResult}};return rf.TranslationSynthesisEventArgs=e,rf}var sf={},$M;function NU(){if($M)return sf;$M=1,Object.defineProperty(sf,"__esModule",{value:!0}),sf.TranslationRecognitionResult=void 0;const t=me();let e=class DU extends t.SpeechRecognitionResult{constructor(i,r,s,o,a,l,c,u,h,d,p){super(r,s,o,a,l,c,u,void 0,h,d,p),this.privTranslations=i}static fromSpeechRecognitionResult(i){return new DU(void 0,i.resultId,i.reason,i.text,i.duration,i.offset,i.language,i.languageDetectionConfidence,i.errorDetails,i.json,i.properties)}get translations(){return this.privTranslations}};return sf.TranslationRecognitionResult=e,sf}var lx={};Object.defineProperty(lx,"__esModule",{value:!0});lx.TranslationSynthesisResult=void 0;class Hq{constructor(e,n){this.privReason=e,this.privAudio=n}get audio(){return this.privAudio}get reason(){return this.privReason}}lx.TranslationSynthesisResult=Hq;var OU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ResultReason=void 0,function(e){e[e.NoMatch=0]="NoMatch",e[e.Canceled=1]="Canceled",e[e.RecognizingSpeech=2]="RecognizingSpeech",e[e.RecognizedSpeech=3]="RecognizedSpeech",e[e.RecognizedKeyword=4]="RecognizedKeyword",e[e.RecognizingIntent=5]="RecognizingIntent",e[e.RecognizedIntent=6]="RecognizedIntent",e[e.TranslatingSpeech=7]="TranslatingSpeech",e[e.TranslatedSpeech=8]="TranslatedSpeech",e[e.SynthesizingAudio=9]="SynthesizingAudio",e[e.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",e[e.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",e[e.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",e[e.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",e[e.RecognizedSpeakers=14]="RecognizedSpeakers",e[e.RecognizedSpeaker=15]="RecognizedSpeaker",e[e.ResetVoiceProfile=16]="ResetVoiceProfile",e[e.DeletedVoiceProfile=17]="DeletedVoiceProfile",e[e.VoicesListRetrieved=18]="VoicesListRetrieved",e[e.TranslatingParticipantSpeech=19]="TranslatingParticipantSpeech",e[e.TranslatedParticipantSpeech=20]="TranslatedParticipantSpeech",e[e.TranslatedInstantMessage=21]="TranslatedInstantMessage",e[e.TranslatedParticipantInstantMessage=22]="TranslatedParticipantInstantMessage"}(t.ResultReason||(t.ResultReason={}))})(OU);var Rc={},HM;function Vq(){if(HM)return Rc;HM=1,Object.defineProperty(Rc,"__esModule",{value:!0}),Rc.SpeechConfigImpl=Rc.SpeechConfig=void 0;const t=Ve(),e=Ct,n=me();let i=class{constructor(){}static fromSubscription(o,a){e.Contracts.throwIfNullOrWhitespace(o,"subscriptionKey"),e.Contracts.throwIfNullOrWhitespace(a,"region");const l=new r;return l.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),l.setProperty(n.PropertyId.SpeechServiceConnection_IntentRegion,a),l.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),l}static fromEndpoint(o,a){e.Contracts.throwIfNull(o,"endpoint");const l=new r;return l.setProperty(n.PropertyId.SpeechServiceConnection_Endpoint,o.href),a!==void 0&&l.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),l}static fromHost(o,a){e.Contracts.throwIfNull(o,"hostName");const l=new r;return l.setProperty(n.PropertyId.SpeechServiceConnection_Host,o.protocol+"//"+o.hostname+(o.port===""?"":":"+o.port)),a!==void 0&&l.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),l}static fromAuthorizationToken(o,a){e.Contracts.throwIfNull(o,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(a,"region");const l=new r;return l.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),l.setProperty(n.PropertyId.SpeechServiceConnection_IntentRegion,a),l.authorizationToken=o,l}close(){}};Rc.SpeechConfig=i;class r extends i{constructor(){super(),this.privProperties=new n.PropertyCollection,this.speechRecognitionLanguage="en-US",this.outputFormat=n.OutputFormat.Simple}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o)}get speechRecognitionLanguage(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,o)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,o)}get outputFormat(){return n.OutputFormat[this.privProperties.getProperty(t.OutputFormatPropertyName,void 0)]}set outputFormat(o){this.privProperties.setProperty(t.OutputFormatPropertyName,n.OutputFormat[o])}get endpointId(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_EndpointId,o)}setProperty(o,a){e.Contracts.throwIfNull(a,"value"),this.privProperties.setProperty(o,a)}getProperty(o,a){return this.privProperties.getProperty(o,a)}setProxy(o,a,l,c){this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyHostName],o),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPort],a),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyUserName],l),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPassword],c)}setServiceProperty(o,a){const l=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));l[o]=a,this.privProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(l))}setProfanity(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceResponse_ProfanityOption,n.ProfanityOption[o])}enableAudioLogging(){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privProperties.setProperty(t.ForceDictationPropertyName,"true")}clone(){const o=new r;return o.privProperties=this.privProperties.clone(),o}get speechSynthesisLanguage(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage,o)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthVoice,o)}get speechSynthesisOutputFormat(){return n.SpeechSynthesisOutputFormat[this.privProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(o){this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,n.SpeechSynthesisOutputFormat[o])}}return Rc.SpeechConfigImpl=r,Rc}var Tc={},VM;function jq(){if(VM)return Tc;VM=1,Object.defineProperty(Tc,"__esModule",{value:!0}),Tc.SpeechTranslationConfigImpl=Tc.SpeechTranslationConfig=void 0;const t=Ve(),e=Ct,n=me();let i=class extends n.SpeechConfig{constructor(){super()}static fromSubscription(o,a){e.Contracts.throwIfNullOrWhitespace(o,"subscriptionKey"),e.Contracts.throwIfNullOrWhitespace(a,"region");const l=new r;return l.properties.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),l.properties.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),l}static fromAuthorizationToken(o,a){e.Contracts.throwIfNullOrWhitespace(o,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(a,"region");const l=new r;return l.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o),l.properties.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),l}static fromHost(o,a){e.Contracts.throwIfNull(o,"hostName");const l=new r;return l.setProperty(n.PropertyId.SpeechServiceConnection_Host,o.protocol+"//"+o.hostname+(o.port===""?"":":"+o.port)),a!==void 0&&l.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),l}static fromEndpoint(o,a){e.Contracts.throwIfNull(o,"endpoint"),e.Contracts.throwIfNull(a,"subscriptionKey");const l=new r;return l.properties.setProperty(n.PropertyId.SpeechServiceConnection_Endpoint,o.href),l.properties.setProperty(n.PropertyId.SpeechServiceConnection_Key,a),l}};Tc.SpeechTranslationConfig=i;class r extends i{constructor(){super(),this.privSpeechProperties=new n.PropertyCollection,this.outputFormat=n.OutputFormat.Simple}set authorizationToken(o){e.Contracts.throwIfNullOrWhitespace(o,"value"),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o)}set speechRecognitionLanguage(o){e.Contracts.throwIfNullOrWhitespace(o,"value"),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,o)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return n.OutputFormat[this.privSpeechProperties.getProperty(t.OutputFormatPropertyName,void 0)]}set outputFormat(o){this.privSpeechProperties.setProperty(t.OutputFormatPropertyName,n.OutputFormat[o])}get endpointId(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_EndpointId,o)}addTargetLanguage(o){e.Contracts.throwIfNullOrWhitespace(o,"value");const a=this.targetLanguages;a.includes(o)||(a.push(o),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,a.join(",")))}get targetLanguages(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(o){e.Contracts.throwIfNullOrWhitespace(o,"value"),this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_TranslationVoice,o)}get region(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_Region)}setProxy(o,a,l,c){this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyHostName],o),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPort],a),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyUserName],l),this.setProperty(n.PropertyId[n.PropertyId.SpeechServiceConnection_ProxyPassword],c)}getProperty(o,a){return this.privSpeechProperties.getProperty(o,a)}setProperty(o,a){this.privSpeechProperties.setProperty(o,a)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(o,a){const l=JSON.parse(this.privSpeechProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));l[o]=a,this.privSpeechProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(l))}setProfanity(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceResponse_ProfanityOption,n.ProfanityOption[o])}enableAudioLogging(){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(t.ForceDictationPropertyName,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthLanguage,o)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthVoice,o)}get speechSynthesisOutputFormat(){return n.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(o){this.privSpeechProperties.setProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,n.SpeechSynthesisOutputFormat[o])}}return Tc.SpeechTranslationConfigImpl=r,Tc}var of={},jM;function zU(){if(jM)return of;jM=1,Object.defineProperty(of,"__esModule",{value:!0}),of.PropertyCollection=void 0;const t=me();let e=class FU{constructor(){this.privKeys=[],this.privValues=[]}getProperty(i,r){let s;typeof i=="string"?s=i:s=t.PropertyId[i];for(let o=0;o<this.privKeys.length;o++)if(this.privKeys[o]===s)return this.privValues[o];if(r!==void 0)return String(r)}setProperty(i,r){let s;typeof i=="string"?s=i:s=t.PropertyId[i];for(let o=0;o<this.privKeys.length;o++)if(this.privKeys[o]===s){this.privValues[o]=r;return}this.privKeys.push(s),this.privValues.push(r)}clone(){const i=new FU;for(let r=0;r<this.privKeys.length;r++)i.privKeys.push(this.privKeys[r]),i.privValues.push(this.privValues[r]);return i}mergeTo(i){this.privKeys.forEach(r=>{if(i.getProperty(r,void 0)===void 0){const s=this.getProperty(r);i.setProperty(r,s)}})}get keys(){return this.privKeys}};return of.PropertyCollection=e,of}var cx={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyId=void 0,function(e){e[e.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",e[e.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",e[e.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",e[e.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",e[e.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",e[e.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",e[e.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",e[e.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",e[e.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",e[e.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",e[e.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",e[e.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",e[e.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",e[e.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",e[e.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",e[e.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",e[e.Speech_SessionId=16]="Speech_SessionId",e[e.SpeechServiceConnection_SynthLanguage=17]="SpeechServiceConnection_SynthLanguage",e[e.SpeechServiceConnection_SynthVoice=18]="SpeechServiceConnection_SynthVoice",e[e.SpeechServiceConnection_SynthOutputFormat=19]="SpeechServiceConnection_SynthOutputFormat",e[e.SpeechServiceConnection_AutoDetectSourceLanguages=20]="SpeechServiceConnection_AutoDetectSourceLanguages",e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]="SpeechServiceResponse_RequestDetailedResultTrueFalse",e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",e[e.SpeechServiceResponse_JsonResult=23]="SpeechServiceResponse_JsonResult",e[e.SpeechServiceResponse_JsonErrorDetails=24]="SpeechServiceResponse_JsonErrorDetails",e[e.CancellationDetails_Reason=25]="CancellationDetails_Reason",e[e.CancellationDetails_ReasonText=26]="CancellationDetails_ReasonText",e[e.CancellationDetails_ReasonDetailedText=27]="CancellationDetails_ReasonDetailedText",e[e.LanguageUnderstandingServiceResponse_JsonResult=28]="LanguageUnderstandingServiceResponse_JsonResult",e[e.SpeechServiceConnection_Url=29]="SpeechServiceConnection_Url",e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=30]="SpeechServiceConnection_InitialSilenceTimeoutMs",e[e.SpeechServiceConnection_EndSilenceTimeoutMs=31]="SpeechServiceConnection_EndSilenceTimeoutMs",e[e.Speech_SegmentationSilenceTimeoutMs=32]="Speech_SegmentationSilenceTimeoutMs",e[e.SpeechServiceConnection_EnableAudioLogging=33]="SpeechServiceConnection_EnableAudioLogging",e[e.SpeechServiceConnection_LanguageIdMode=34]="SpeechServiceConnection_LanguageIdMode",e[e.SpeechServiceConnection_RecognitionEndpointVersion=35]="SpeechServiceConnection_RecognitionEndpointVersion",e[e.SpeechServiceConnection_SpeakerIdMode=36]="SpeechServiceConnection_SpeakerIdMode",e[e.SpeechServiceResponse_ProfanityOption=37]="SpeechServiceResponse_ProfanityOption",e[e.SpeechServiceResponse_PostProcessingOption=38]="SpeechServiceResponse_PostProcessingOption",e[e.SpeechServiceResponse_RequestWordLevelTimestamps=39]="SpeechServiceResponse_RequestWordLevelTimestamps",e[e.SpeechServiceResponse_StablePartialResultThreshold=40]="SpeechServiceResponse_StablePartialResultThreshold",e[e.SpeechServiceResponse_OutputFormatOption=41]="SpeechServiceResponse_OutputFormatOption",e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=42]="SpeechServiceResponse_TranslationRequestStablePartialResult",e[e.SpeechServiceResponse_RequestWordBoundary=43]="SpeechServiceResponse_RequestWordBoundary",e[e.SpeechServiceResponse_RequestPunctuationBoundary=44]="SpeechServiceResponse_RequestPunctuationBoundary",e[e.SpeechServiceResponse_RequestSentenceBoundary=45]="SpeechServiceResponse_RequestSentenceBoundary",e[e.Conversation_ApplicationId=46]="Conversation_ApplicationId",e[e.Conversation_DialogType=47]="Conversation_DialogType",e[e.Conversation_Initial_Silence_Timeout=48]="Conversation_Initial_Silence_Timeout",e[e.Conversation_From_Id=49]="Conversation_From_Id",e[e.Conversation_Conversation_Id=50]="Conversation_Conversation_Id",e[e.Conversation_Custom_Voice_Deployment_Ids=51]="Conversation_Custom_Voice_Deployment_Ids",e[e.Conversation_Speech_Activity_Template=52]="Conversation_Speech_Activity_Template",e[e.Conversation_Request_Bot_Status_Messages=53]="Conversation_Request_Bot_Status_Messages",e[e.Conversation_Agent_Connection_Id=54]="Conversation_Agent_Connection_Id",e[e.SpeechServiceConnection_Host=55]="SpeechServiceConnection_Host",e[e.ConversationTranslator_Host=56]="ConversationTranslator_Host",e[e.ConversationTranslator_Name=57]="ConversationTranslator_Name",e[e.ConversationTranslator_CorrelationId=58]="ConversationTranslator_CorrelationId",e[e.ConversationTranslator_Token=59]="ConversationTranslator_Token",e[e.PronunciationAssessment_ReferenceText=60]="PronunciationAssessment_ReferenceText",e[e.PronunciationAssessment_GradingSystem=61]="PronunciationAssessment_GradingSystem",e[e.PronunciationAssessment_Granularity=62]="PronunciationAssessment_Granularity",e[e.PronunciationAssessment_EnableMiscue=63]="PronunciationAssessment_EnableMiscue",e[e.PronunciationAssessment_Json=64]="PronunciationAssessment_Json",e[e.PronunciationAssessment_Params=65]="PronunciationAssessment_Params",e[e.SpeakerRecognition_Api_Version=66]="SpeakerRecognition_Api_Version",e[e.WebWorkerLoadType=67]="WebWorkerLoadType",e[e.TalkingAvatarService_WebRTC_SDP=68]="TalkingAvatarService_WebRTC_SDP"}(t.PropertyId||(t.PropertyId={}))})(cx);var af={},WM;function Wq(){if(WM)return af;WM=1,Object.defineProperty(af,"__esModule",{value:!0}),af.Recognizer=void 0;const t=Ve(),e=ht(),n=Ct,i=me();let r=class UU{constructor(o,a,l){this.audioConfig=o!==void 0?o:i.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=a.clone(),this.privConnectionFactory=l,this.implCommonRecognizerSetup()}close(o,a){n.Contracts.throwIfDisposed(this.privDisposed),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}get internalData(){return this.privReco}async dispose(o){this.privDisposed||(this.privDisposed=!0,o&&this.privReco&&(await this.privReco.audioSource.turnOff(),await this.privReco.dispose()))}static get telemetryEnabled(){return t.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(o){t.ServiceRecognizerBase.telemetryDataEnabled=o}implCommonRecognizerSetup(){let o=typeof window<"u"?"Browser":"Node",a="unknown",l="unknown";typeof navigator<"u"&&(o=o+"/"+navigator.platform,a=navigator.userAgent,l=navigator.appVersion);const c=this.createRecognizerConfig(new t.SpeechServiceConfig(new t.Context(new t.OS(o,a,l))));this.privReco=this.createServiceRecognizer(UU.getAuthFromProperties(this.privProperties),this.privConnectionFactory,this.audioConfig,c)}async recognizeOnceAsyncImpl(o){n.Contracts.throwIfDisposed(this.privDisposed);const a=new e.Deferred;await this.implRecognizerStop(),await this.privReco.recognize(o,a.resolve,a.reject);const l=await a.promise;return await this.implRecognizerStop(),l}async startContinuousRecognitionAsyncImpl(o){n.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop(),await this.privReco.recognize(o,void 0,void 0)}async stopContinuousRecognitionAsyncImpl(){n.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop()}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}static getAuthFromProperties(o){const a=o.getProperty(i.PropertyId.SpeechServiceConnection_Key,void 0);return a&&a!==""?new t.CognitiveSubscriptionKeyAuthentication(a):new t.CognitiveTokenAuthentication(()=>{const c=o.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(c)},()=>{const c=o.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(c)})}};return af.Recognizer=r,af}var lf={},GM;function Gq(){if(GM)return lf;GM=1,Object.defineProperty(lf,"__esModule",{value:!0}),lf.SpeechRecognizer=void 0;const t=Ve(),e=ht(),n=Ct,i=me();let r=class BU extends i.Recognizer{constructor(o,a){const l=o;n.Contracts.throwIfNull(l,"speechConfig"),n.Contracts.throwIfNullOrWhitespace(l.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),super(a,l.properties,new t.SpeechConnectionFactory),this.privDisposedRecognizer=!1}static FromConfig(o,a,l){const c=o;return a.properties.mergeTo(c.properties),new BU(o,l)}get endpointId(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){n.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple])===i.OutputFormat[i.OutputFormat.Simple]?i.OutputFormat.Simple:i.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(o,a){e.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),o,a)}startContinuousRecognitionAsync(o,a){e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,a)}stopContinuousRecognitionAsync(o,a){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}startKeywordRecognitionAsync(o,a,l){n.Contracts.throwIfNull(o,"model"),l&&l("Not yet implemented.")}stopKeywordRecognitionAsync(o){o&&o()}close(o,a){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}async dispose(o){this.privDisposedRecognizer||(o&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(o))}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,a,l,c){const u=l;return new t.SpeechServiceRecognizer(o,a,u,c,this)}};return lf.SpeechRecognizer=r,lf}var cf={},qM;function qq(){if(qM)return cf;qM=1,Object.defineProperty(cf,"__esModule",{value:!0}),cf.IntentRecognizer=void 0;const t=Ve(),e=ht(),n=Ct,i=me();let r=class extends i.Recognizer{constructor(o,a){n.Contracts.throwIfNullOrUndefined(o,"speechConfig");const l=o;n.Contracts.throwIfNullOrUndefined(l,"speechConfig"),super(a,l.properties,new t.IntentConnectionFactory),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=l.properties,n.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}get properties(){return this.privProperties}recognizeOnceAsync(o,a){if(n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const l=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",l.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(l.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}e.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),o,a)}startContinuousRecognitionAsync(o,a){if(Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const l=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",l.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(l.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,a)}stopContinuousRecognitionAsync(o,a){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}startKeywordRecognitionAsync(o,a,l){n.Contracts.throwIfNull(o,"model"),l&&l("Not yet implemented.")}stopKeywordRecognitionAsync(o,a){if(o)try{o()}catch(l){a&&a(l)}}addIntent(o,a){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),n.Contracts.throwIfNullOrWhitespace(a,"intentId"),n.Contracts.throwIfNullOrWhitespace(o,"simplePhrase"),this.privAddedIntents.push([a,o])}addIntentWithLanguageModel(o,a,l){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),n.Contracts.throwIfNullOrWhitespace(o,"intentId"),n.Contracts.throwIfNull(a,"model");const c=a;n.Contracts.throwIfNullOrWhitespace(c.appId,"model.appId"),this.privAddedLmIntents[o]=new t.AddedLmIntent(c,l)}addAllIntents(o,a){n.Contracts.throwIfNull(o,"model");const l=o;n.Contracts.throwIfNullOrWhitespace(l.appId,"model.appId"),this.privUmbrellaIntent=new t.AddedLmIntent(l,a)}close(o,a){n.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,a,l,c){const u=l;return new t.IntentServiceRecognizer(o,a,u,c,this)}async dispose(o){this.privDisposedIntentRecognizer||o&&(this.privDisposedIntentRecognizer=!0,await super.dispose(o))}buildSpeechContext(){let o,a,l;const c=[];this.privUmbrellaIntent!==void 0&&(o=this.privUmbrellaIntent.modelImpl.appId,a=this.privUmbrellaIntent.modelImpl.region,l=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(const u of Object.keys(this.privAddedLmIntents)){const h=this.privAddedLmIntents[u];if(o===void 0)o=h.modelImpl.appId;else if(o!==h.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(a===void 0)a=h.modelImpl.region;else if(a!==h.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(l===void 0)l=h.modelImpl.subscriptionKey;else if(l!==h.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");const d="luis/"+o+"-PRODUCTION#"+u;c.push(d)}return{Intent:{id:o,key:l===void 0?this.privProperties.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_Key]):l,provider:"LUIS"},ReferenceGrammars:this.privUmbrellaIntent===void 0?c:["luis/"+o+"-PRODUCTION"]}}};return cf.IntentRecognizer=r,cf}var $U={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceProfileType=void 0,function(e){e[e.TextIndependentIdentification=0]="TextIndependentIdentification",e[e.TextDependentVerification=1]="TextDependentVerification",e[e.TextIndependentVerification=2]="TextIndependentVerification"}(t.VoiceProfileType||(t.VoiceProfileType={}))})($U);var uf={},hf={},bc={},XM;function HU(){if(XM)return bc;XM=1,Object.defineProperty(bc,"__esModule",{value:!0}),bc.ConnectionMessageImpl=bc.ConnectionMessage=void 0;const t=Fi,e=ht(),n=zU(),i=cx;let r=class{};bc.ConnectionMessage=r;class s{constructor(a){this.privConnectionMessage=a,this.privProperties=new n.PropertyCollection,this.privConnectionMessage.headers[t.HeaderNames.ConnectionId]&&this.privProperties.setProperty(i.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[t.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach(l=>{this.privProperties.setProperty(l,this.privConnectionMessage.headers[l])})}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find(a=>a.toLowerCase()==="path".toLowerCase())]}get isTextMessage(){return this.privConnectionMessage.messageType===e.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===e.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}}return bc.ConnectionMessageImpl=s,bc}var KM;function VU(){if(KM)return hf;KM=1,Object.defineProperty(hf,"__esModule",{value:!0}),hf.Connection=void 0;const t=Ve(),e=ht(),n=HU(),i=Ct,r=me();let s=class lR{static fromRecognizer(a){const l=a.internalData,c=new lR;return c.privInternalData=l,c.setupEvents(),c}static fromSynthesizer(a){const l=a.internalData,c=new lR;return c.privInternalData=l,c.setupEvents(),c}openConnection(a,l){e.marshalPromiseToCallbacks(this.privInternalData.connect(),a,l)}closeConnection(a,l){if(this.privInternalData instanceof t.SynthesisAdapterBase)throw new Error("Disconnecting a synthesizer's connection is currently not supported");e.marshalPromiseToCallbacks(this.privInternalData.disconnect(),a,l)}setMessageProperty(a,l,c){if(i.Contracts.throwIfNullOrWhitespace(l,"propertyName"),this.privInternalData instanceof t.ServiceRecognizerBase){if(a.toLowerCase()!=="speech.context")throw new Error("Only speech.context message property sets are currently supported for recognizer");this.privInternalData.speechContext.setSection(l,c)}else if(this.privInternalData instanceof t.SynthesisAdapterBase){if(a.toLowerCase()!=="synthesis.context")throw new Error("Only synthesis.context message property sets are currently supported for synthesizer");this.privInternalData.synthesisContext.setSection(l,c)}}sendMessageAsync(a,l,c,u){e.marshalPromiseToCallbacks(this.privInternalData.sendNetworkMessage(a,l),c,u)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach(a=>{a.name==="ConnectionEstablishedEvent"?this.connected&&this.connected(new r.ConnectionEventArgs(a.connectionId)):a.name==="ConnectionClosedEvent"?this.disconnected&&this.disconnected(new r.ConnectionEventArgs(a.connectionId)):a.name==="ConnectionMessageSentEvent"?this.messageSent&&this.messageSent(new r.ConnectionMessageEventArgs(new n.ConnectionMessageImpl(a.message))):a.name==="ConnectionMessageReceivedEvent"&&this.messageReceived&&this.messageReceived(new r.ConnectionMessageEventArgs(new n.ConnectionMessageImpl(a.message)))}),this.privServiceEventListener=this.privInternalData.serviceEvents.attach(a=>{this.receivedServiceMessage&&this.receivedServiceMessage(new r.ServiceEventArgs(a.jsonString,a.name))})}};return hf.Connection=s,hf}var YM;function Xq(){if(YM)return uf;YM=1,Object.defineProperty(uf,"__esModule",{value:!0}),uf.TranslationRecognizer=void 0;const t=Ve(),e=ht(),n=VU(),i=Ct,r=me();let s=class jU extends r.Recognizer{constructor(a,l,c){const u=a;i.Contracts.throwIfNull(u,"speechConfig"),super(l,u.properties,c||new t.TranslationConnectionFactory),this.privDisposedTranslationRecognizer=!1,this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&i.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice),r.PropertyId[r.PropertyId.SpeechServiceConnection_TranslationVoice]),i.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages),r.PropertyId[r.PropertyId.SpeechServiceConnection_TranslationToLanguages]),i.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage),r.PropertyId[r.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(a,l,c){const u=a;return l.properties.mergeTo(u.properties),new jU(a,c)}get speechRecognitionLanguage(){return i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(r.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(a){this.properties.setProperty(r.PropertyId.SpeechServiceAuthorization_Token,a)}recognizeOnceAsync(a,l){i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),e.marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),a,l)}startContinuousRecognitionAsync(a,l){e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),a,l)}stopContinuousRecognitionAsync(a,l){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),a,l)}removeTargetLanguage(a){if(i.Contracts.throwIfNullOrUndefined(a,"language to be removed"),this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0){const l=this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),c=l.indexOf(a);c>-1&&(l.splice(c,1),this.properties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,l.join(",")),this.updateLanguages(l))}}addTargetLanguage(a){i.Contracts.throwIfNullOrUndefined(a,"language to be added");let l=[];this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?(l=this.properties.getProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),l.includes(a)||(l.push(a),this.properties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,l.join(",")))):(this.properties.setProperty(r.PropertyId.SpeechServiceConnection_TranslationToLanguages,a),l=[a]),this.updateLanguages(l)}close(a,l){i.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),a,l)}onConnection(){}async dispose(a){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,a&&(await this.implRecognizerStop(),await super.dispose(a)))}createRecognizerConfig(a){return new t.RecognizerConfig(a,this.privProperties)}createServiceRecognizer(a,l,c,u){const h=c;return new t.TranslationServiceRecognizer(a,l,h,u,this)}updateLanguages(a){const l=n.Connection.fromRecognizer(this);l&&(l.setMessageProperty("speech.context","translationcontext",{to:a}),l.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:a})))}};return uf.TranslationRecognizer=s,uf}var df={},JM;function Kq(){if(JM)return df;JM=1,Object.defineProperty(df,"__esModule",{value:!0}),df.Translations=void 0;const t=me();let e=class{constructor(){this.privMap=new t.PropertyCollection}get languages(){return this.privMap.keys}get(i,r){return this.privMap.getProperty(i,r)}set(i,r){this.privMap.setProperty(i,r)}};return df.Translations=e,df}var WU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.NoMatchReason=void 0,function(e){e[e.NotRecognized=0]="NotRecognized",e[e.InitialSilenceTimeout=1]="InitialSilenceTimeout",e[e.InitialBabbleTimeout=2]="InitialBabbleTimeout"}(t.NoMatchReason||(t.NoMatchReason={}))})(WU);var pf={},QM;function Yq(){if(QM)return pf;QM=1,Object.defineProperty(pf,"__esModule",{value:!0}),pf.NoMatchDetails=void 0;const t=Ve(),e=me();let n=class GU{constructor(r){this.privReason=r}static fromResult(r){const s=t.SimpleSpeechPhrase.fromJSON(r.json);let o=e.NoMatchReason.NotRecognized;switch(s.RecognitionStatus){case t.RecognitionStatus.BabbleTimeout:o=e.NoMatchReason.InitialBabbleTimeout;break;case t.RecognitionStatus.InitialSilenceTimeout:o=e.NoMatchReason.InitialSilenceTimeout;break;default:o=e.NoMatchReason.NotRecognized;break}return new GU(o)}get reason(){return this.privReason}};return pf.NoMatchDetails=n,pf}var ux={};Object.defineProperty(ux,"__esModule",{value:!0});ux.TranslationRecognitionCanceledEventArgs=void 0;class Jq{constructor(e,n,i,r,s){this.privCancelReason=n,this.privErrorDetails=i,this.privResult=s,this.privSessionId=e,this.privErrorCode=r}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}ux.TranslationRecognitionCanceledEventArgs=Jq;var ff={},ZM;function Qq(){if(ZM)return ff;ZM=1,Object.defineProperty(ff,"__esModule",{value:!0}),ff.IntentRecognitionCanceledEventArgs=void 0;const t=me();let e=class extends t.IntentRecognitionEventArgs{constructor(i,r,s,o,a,l){super(o,a,l),this.privReason=i,this.privErrorDetails=r,this.privErrorCode=s}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return ff.IntentRecognitionCanceledEventArgs=e,ff}var P0={};Object.defineProperty(P0,"__esModule",{value:!0});P0.CancellationDetailsBase=void 0;class Zq{constructor(e,n,i){this.privReason=e,this.privErrorDetails=n,this.privErrorCode=i}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}}P0.CancellationDetailsBase=Zq;var mf={},e3;function eX(){if(e3)return mf;e3=1,Object.defineProperty(mf,"__esModule",{value:!0}),mf.CancellationDetails=void 0;const t=Ve(),e=P0,n=me();let i=class qU extends e.CancellationDetailsBase{constructor(s,o,a){super(s,o,a)}static fromResult(s){let o=n.CancellationReason.Error,a=n.CancellationErrorCode.NoError;if(s instanceof n.RecognitionResult&&s.json){const l=t.SimpleSpeechPhrase.fromJSON(s.json);o=t.EnumTranslation.implTranslateCancelResult(l.RecognitionStatus)}return s.properties&&(a=n.CancellationErrorCode[s.properties.getProperty(t.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.NoError])]),new qU(o,s.errorDetails||t.EnumTranslation.implTranslateErrorDetails(a),a)}};return mf.CancellationDetails=i,mf}var XU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationErrorCode=void 0,function(e){e[e.NoError=0]="NoError",e[e.AuthenticationFailure=1]="AuthenticationFailure",e[e.BadRequestParameters=2]="BadRequestParameters",e[e.TooManyRequests=3]="TooManyRequests",e[e.ConnectionFailure=4]="ConnectionFailure",e[e.ServiceTimeout=5]="ServiceTimeout",e[e.ServiceError=6]="ServiceError",e[e.RuntimeError=7]="RuntimeError",e[e.Forbidden=8]="Forbidden"}(t.CancellationErrorCode||(t.CancellationErrorCode={}))})(XU);var gf={},t3;function tX(){if(t3)return gf;t3=1,Object.defineProperty(gf,"__esModule",{value:!0}),gf.ConnectionEventArgs=void 0;const t=me();let e=class extends t.SessionEventArgs{};return gf.ConnectionEventArgs=e,gf}var vf={},n3;function nX(){if(n3)return vf;n3=1,Object.defineProperty(vf,"__esModule",{value:!0}),vf.ServiceEventArgs=void 0;const t=me();let e=class extends t.SessionEventArgs{constructor(i,r,s){super(s),this.privJsonResult=i,this.privEventName=r}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}};return vf.ServiceEventArgs=e,vf}var hx={};Object.defineProperty(hx,"__esModule",{value:!0});hx.PhraseListGrammar=void 0;class p2{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(e){const n=e.internalData;return new p2(n)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}}hx.PhraseListGrammar=p2;var Ac={},i3;function f2(){if(i3)return Ac;i3=1,Object.defineProperty(Ac,"__esModule",{value:!0}),Ac.DialogServiceConfigImpl=Ac.DialogServiceConfig=void 0;const t=Ct,e=me();let n=class{constructor(){}set applicationId(s){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}};Ac.DialogServiceConfig=n;class i extends n{constructor(){super(),this.privSpeechConfig=new e.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(s){t.Contracts.throwIfNullOrWhitespace(s,"value"),this.privSpeechConfig.speechRecognitionLanguage=s}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(s){this.privSpeechConfig.outputFormat=s}setProperty(s,o){this.privSpeechConfig.setProperty(s,o)}getProperty(s,o){return this.privSpeechConfig.getProperty(s)}setProxy(s,o,a,l){this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyHostName,s),this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyPort,`${o}`),a&&this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyUserName,a),l&&this.setProperty(e.PropertyId.SpeechServiceConnection_ProxyPassword,l)}setServiceProperty(s,o,a){this.privSpeechConfig.setServiceProperty(s,o)}close(){}}return Ac.DialogServiceConfigImpl=i,Ac}var yf={},r3;function iX(){if(r3)return yf;r3=1,Object.defineProperty(yf,"__esModule",{value:!0}),yf.BotFrameworkConfig=void 0;const t=Ct,e=f2(),n=me();let i=class extends e.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"subscription"),t.Contracts.throwIfNullOrWhitespace(o,"region");const l=new e.DialogServiceConfigImpl;return l.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),l.setProperty(n.PropertyId.SpeechServiceConnection_Key,s),l.setProperty(n.PropertyId.SpeechServiceConnection_Region,o),a&&l.setProperty(n.PropertyId.Conversation_ApplicationId,a),l}static fromAuthorizationToken(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(o,"region");const l=new e.DialogServiceConfigImpl;return l.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),l.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,s),l.setProperty(n.PropertyId.SpeechServiceConnection_Region,o),a&&l.setProperty(n.PropertyId.Conversation_ApplicationId,a),l}static fromHost(s,o,a){t.Contracts.throwIfNullOrUndefined(s,"host");const l=s instanceof URL?s:new URL(`wss://${s}.convai.speech.azure.us`);t.Contracts.throwIfNullOrUndefined(l,"resolvedHost");const c=new e.DialogServiceConfigImpl;return c.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),c.setProperty(n.PropertyId.SpeechServiceConnection_Host,l.toString()),o!==void 0&&c.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),c}static fromEndpoint(s,o){t.Contracts.throwIfNull(s,"endpoint");const a=new e.DialogServiceConfigImpl;return a.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.BotFramework),a.setProperty(n.PropertyId.SpeechServiceConnection_Endpoint,s.toString()),o!==void 0&&a.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),a}};return yf.BotFrameworkConfig=i,yf}var Sf={},s3;function rX(){if(s3)return Sf;s3=1,Object.defineProperty(Sf,"__esModule",{value:!0}),Sf.CustomCommandsConfig=void 0;const t=Ct,e=f2(),n=me();let i=class extends e.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"applicationId"),t.Contracts.throwIfNullOrWhitespace(o,"subscription"),t.Contracts.throwIfNullOrWhitespace(a,"region");const l=new e.DialogServiceConfigImpl;return l.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.CustomCommands),l.setProperty(n.PropertyId.Conversation_ApplicationId,s),l.setProperty(n.PropertyId.SpeechServiceConnection_Key,o),l.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),l}static fromAuthorizationToken(s,o,a){t.Contracts.throwIfNullOrWhitespace(s,"applicationId"),t.Contracts.throwIfNullOrWhitespace(o,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(a,"region");const l=new e.DialogServiceConfigImpl;return l.setProperty(n.PropertyId.Conversation_DialogType,e.DialogServiceConfig.DialogTypes.CustomCommands),l.setProperty(n.PropertyId.Conversation_ApplicationId,s),l.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o),l.setProperty(n.PropertyId.SpeechServiceConnection_Region,a),l}set applicationId(s){t.Contracts.throwIfNullOrWhitespace(s,"value"),this.setProperty(n.PropertyId.Conversation_ApplicationId,s)}get applicationId(){return this.getProperty(n.PropertyId.Conversation_ApplicationId)}};return Sf.CustomCommandsConfig=i,Sf}var xf={},Cf={},_f={},Do={};Object.defineProperty(Do,"__esModule",{value:!0});Do.QueryParameterNames=void 0;class Jn{}Do.QueryParameterNames=Jn;Jn.BotId="botid";Jn.CustomSpeechDeploymentId="cid";Jn.CustomVoiceDeploymentId="deploymentId";Jn.EnableAudioLogging="storeAudio";Jn.EnableLanguageId="lidEnabled";Jn.EnableWordLevelTimestamps="wordLevelTimestamps";Jn.EndSilenceTimeoutMs="endSilenceTimeoutMs";Jn.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs";Jn.Format="format";Jn.InitialSilenceTimeoutMs="initialSilenceTimeoutMs";Jn.Language="language";Jn.Profanity="profanity";Jn.RequestBotStatusMessages="enableBotMessageStatus";Jn.StableIntermediateThreshold="stableIntermediateThreshold";Jn.StableTranslation="stableTranslation";Jn.TestHooks="testhooks";Jn.Postprocessing="postprocessing";Jn.CtsMeetingId="meetingId";Jn.CtsDeviceId="deviceId";Jn.CtsIsParticipant="isParticipant";Jn.EnableAvatar="enableTalkingAvatar";var o3;function No(){if(o3)return _f;o3=1,Object.defineProperty(_f,"__esModule",{value:!0}),_f.ConnectionFactoryBase=void 0;const t=Ve(),e=me(),n=Do;let i=class{static getHostSuffix(s){if(s){if(s.toLowerCase().startsWith("china"))return".azure.cn";if(s.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(s,o,a){new Map([[e.PropertyId.Speech_SegmentationSilenceTimeoutMs,n.QueryParameterNames.SegmentationSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_EnableAudioLogging,n.QueryParameterNames.EnableAudioLogging],[e.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,n.QueryParameterNames.EndSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,n.QueryParameterNames.InitialSilenceTimeoutMs],[e.PropertyId.SpeechServiceResponse_PostProcessingOption,n.QueryParameterNames.Postprocessing],[e.PropertyId.SpeechServiceResponse_ProfanityOption,n.QueryParameterNames.Profanity],[e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,n.QueryParameterNames.EnableWordLevelTimestamps],[e.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,n.QueryParameterNames.StableIntermediateThreshold]]).forEach((u,h)=>{this.setUrlParameter(h,u,s,o,a)});const c=JSON.parse(s.parameters.getProperty(t.ServicePropertiesPropertyName,"{}"));Object.keys(c).forEach(u=>{o[u]=c[u]})}setUrlParameter(s,o,a,l,c){const u=a.parameters.getProperty(s,void 0);u&&(!c||c.search(o)===-1)&&(l[o]=u.toLocaleLowerCase())}};return _f.ConnectionFactoryBase=i,_f}var a3;function sX(){if(a3)return Cf;a3=1,Object.defineProperty(Cf,"__esModule",{value:!0}),Cf.DialogConnectionFactory=void 0;const t=zi(),e=Ve(),n=me(),i=No(),r=Ve(),s=Fi,o=Do;class a extends i.ConnectionFactoryBase{create(c,u,h){const d=c.parameters.getProperty(n.PropertyId.Conversation_ApplicationId,""),p=c.parameters.getProperty(n.PropertyId.Conversation_DialogType),f=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region),v=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),g=c.parameters.getProperty(n.PropertyId.Conversation_Request_Bot_Status_Messages,"true"),m={};m[s.HeaderNames.ConnectionId]=h,m[o.QueryParameterNames.Format]=c.parameters.getProperty(e.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple]).toLowerCase(),m[o.QueryParameterNames.Language]=v,m[o.QueryParameterNames.RequestBotStatusMessages]=g,d&&(m[o.QueryParameterNames.BotId]=d,p===n.DialogServiceConfig.DialogTypes.CustomCommands&&(m[s.HeaderNames.CustomCommandsAppId]=d));const y=p===n.DialogServiceConfig.DialogTypes.CustomCommands?"commands/":"",S=p===n.DialogServiceConfig.DialogTypes.CustomCommands?"v1":p===n.DialogServiceConfig.DialogTypes.BotFramework?"v3":"v0",x={};u.token!=null&&u.token!==""&&(x[u.headerName]=u.token);let w=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,"");if(!w){const E=i.ConnectionFactoryBase.getHostSuffix(f),T=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,`wss://${f}.${a.BaseUrl}${E}`);w=`${T.endsWith("/")?T:T+"/"}${y}${a.ApiKey}/${S}`}this.setCommonUrlParams(c,m,w);const C=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(w,m,x,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),C,h)}}return Cf.DialogConnectionFactory=a,a.ApiKey="api",a.BaseUrl="convai.speech",Cf}var l3;function oX(){if(l3)return xf;l3=1,Object.defineProperty(xf,"__esModule",{value:!0}),xf.DialogServiceConnector=void 0;const t=sX(),e=Ve(),n=ht(),i=Ct,r=me(),s=cx;let o=class extends r.Recognizer{constructor(l,c){const u=l;i.Contracts.throwIfNull(l,"dialogConfig"),super(c,u.properties,new t.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=u.properties.clone();const h=this.buildAgentConfig();this.privReco.agentConfig.set(h)}connect(l,c){n.marshalPromiseToCallbacks(this.privReco.connect(),l,c)}disconnect(l,c){n.marshalPromiseToCallbacks(this.privReco.disconnect(),l,c)}get authorizationToken(){return this.properties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(l){i.Contracts.throwIfNullOrWhitespace(l,"token"),this.properties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,l)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(s.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(l){this.properties.setProperty(s.PropertyId.Conversation_Speech_Activity_Template,l)}listenOnceAsync(l,c){if(this.isTurnComplete){i.Contracts.throwIfDisposed(this.privIsDisposed);const h=(async()=>{await this.privReco.connect(),await this.implRecognizerStop(),this.isTurnComplete=!1;const d=new n.Deferred;await this.privReco.recognize(e.RecognitionMode.Conversation,d.resolve,d.reject);const p=await d.promise;return await this.implRecognizerStop(),p})();h.catch(()=>{this.dispose(!0).catch(()=>{})}),n.marshalPromiseToCallbacks(h.finally(()=>{this.isTurnComplete=!0}),l,c)}}sendActivityAsync(l,c,u){n.marshalPromiseToCallbacks(this.privReco.sendMessage(l),c,u)}close(l,c){i.Contracts.throwIfDisposed(this.privIsDisposed),n.marshalPromiseToCallbacks(this.dispose(!0),l,c)}async dispose(l){this.privIsDisposed||l&&(this.privIsDisposed=!0,await this.implRecognizerStop(),await super.dispose(l))}createRecognizerConfig(l){return new e.RecognizerConfig(l,this.privProperties)}createServiceRecognizer(l,c,u,h){const d=u;return new e.DialogServiceAdapter(l,c,d,h,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(s.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(s.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(s.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}};return xf.DialogServiceConnector=o,xf}var dx={};Object.defineProperty(dx,"__esModule",{value:!0});dx.ActivityReceivedEventArgs=void 0;class aX{constructor(e,n){this.privActivity=e,this.privAudioStream=n}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}}dx.ActivityReceivedEventArgs=aX;var px={},fx={};Object.defineProperty(fx,"__esModule",{value:!0});fx.TurnStatusResponsePayload=void 0;class m2{constructor(e){this.privMessageStatusResponse=JSON.parse(e)}static fromJSON(e){return new m2(e)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}}fx.TurnStatusResponsePayload=m2;Object.defineProperty(px,"__esModule",{value:!0});px.TurnStatusReceivedEventArgs=void 0;const lX=fx;class cX{constructor(e){this.privTurnStatus=lX.TurnStatusResponsePayload.fromJSON(e)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}}px.TurnStatusReceivedEventArgs=cX;var KU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ServicePropertyChannel=void 0,function(e){e[e.UriQueryParameter=0]="UriQueryParameter"}(t.ServicePropertyChannel||(t.ServicePropertyChannel={}))})(KU);var YU={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProfanityOption=void 0,function(e){e[e.Masked=0]="Masked",e[e.Removed=1]="Removed",e[e.Raw=2]="Raw"}(t.ProfanityOption||(t.ProfanityOption={}))})(YU);var wf={},c3;function uX(){if(c3)return wf;c3=1,Object.defineProperty(wf,"__esModule",{value:!0}),wf.BaseAudioPlayer=void 0;const t=Wi,e=me(),n=vc;let i=class{constructor(s){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,s===void 0&&(s=e.AudioStreamFormat.getDefaultInputFormat()),this.init(s)}playAudioSample(s,o,a){try{this.ensureInitializedContext();const l=this.formatAudioData(s),c=new Float32Array(this.samples.length+l.length);c.set(this.samples,0),c.set(l,this.samples.length),this.samples=c,o&&o()}catch(l){a&&a(l)}}stopAudio(s,o){this.audioContext!==null&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then(()=>{s&&s()},a=>{o&&o(a)}),this.audioContext=null)}init(s){this.audioFormat=s,this.samples=new Float32Array}ensureInitializedContext(){if(this.audioContext===null){this.createAudioContext();const s=200;this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},s)}}createAudioContext(){this.audioContext=n.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(s){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(s),128);case 16:return this.formatArrayBuffer(new Int16Array(s),32768);case 32:return this.formatArrayBuffer(new Int32Array(s),2147483648);default:throw new t.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(s,o){const a=new Float32Array(s.length);for(let l=0;l<s.length;l++)a[l]=s[l]/o;return a}updateAudioBuffer(){if(this.samples.length===0)return;const s=this.audioFormat.channels,o=this.audioContext.createBufferSource(),a=this.samples.length/s,l=this.audioContext.createBuffer(s,a,this.audioFormat.samplesPerSec);for(let c=0;c<s;c++){let u=c;const h=l.getChannelData(c);for(let d=0;d<this.samples.length;d++,u+=s)h[d]=this.samples[u]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),o.buffer=l,o.connect(this.gainNode),o.start(this.startTime),this.startTime+=l.duration,this.samples=new Float32Array}async playAudio(s){this.audioContext===null&&this.createAudioContext();const o=this.audioContext.createBufferSource(),a=this.audioContext.destination;await this.audioContext.decodeAudioData(s,l=>{o.buffer=l,o.connect(a),o.start(0)})}};return wf.BaseAudioPlayer=i,wf}var mx={};Object.defineProperty(mx,"__esModule",{value:!0});mx.ConnectionMessageEventArgs=void 0;class hX{constructor(e){this.privConnectionMessage=e}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}}mx.ConnectionMessageEventArgs=hX;var gx={};Object.defineProperty(gx,"__esModule",{value:!0});gx.VoiceProfile=void 0;class dX{constructor(e,n){this.privId=e,this.privProfileType=n}get profileId(){return this.privId}get profileType(){return this.privProfileType}}gx.VoiceProfile=dX;var Pc={},u3;function pX(){if(u3)return Pc;u3=1,Object.defineProperty(Pc,"__esModule",{value:!0}),Pc.VoiceProfileEnrollmentCancellationDetails=Pc.VoiceProfileEnrollmentResult=void 0;const t=Ve(),e=me();let n=class cR{constructor(s,o,a){this.privReason=s,this.privProperties=new e.PropertyCollection,this.privReason!==e.ResultReason.Canceled?o&&(this.privDetails=JSON.parse(o),this.privDetails.enrollmentStatus.toLowerCase()==="enrolling"&&(this.privReason=e.ResultReason.EnrollingVoiceProfile)):(this.privErrorDetails=a,this.privProperties.setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[e.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get enrollmentsCount(){return this.privDetails.enrollmentsCount}get enrollmentsLength(){return this.privDetails.enrollmentsLength}get properties(){return this.privProperties}get enrollmentResultDetails(){return this.privDetails}get errorDetails(){return this.privErrorDetails}static FromIdentificationProfileList(s){const o=[];for(const a of s.value){const l=a.enrollmentStatus.toLowerCase()==="enrolling"?e.ResultReason.EnrollingVoiceProfile:a.enrollmentStatus.toLowerCase()==="enrolled"?e.ResultReason.EnrolledVoiceProfile:e.ResultReason.Canceled,c=new cR(l,null,null);c.privDetails=this.getIdentificationDetails(a),o.push(c)}return o}static FromVerificationProfileList(s){const o=[];for(const a of s.value){const l=a.enrollmentStatus.toLowerCase()==="enrolling"?e.ResultReason.EnrollingVoiceProfile:a.enrollmentStatus.toLowerCase()==="enrolled"?e.ResultReason.EnrolledVoiceProfile:e.ResultReason.Canceled,c=new cR(l,null,null);c.privDetails=this.getVerificationDetails(a),o.push(c)}return o}static getIdentificationDetails(s){return{audioLength:s.audioLength?parseFloat(s.audioLength):0,audioSpeechLength:s.audioSpeechLength?parseFloat(s.audioSpeechLength):0,enrollmentStatus:s.enrollmentStatus,enrollmentsCount:s.enrollmentsCount||0,enrollmentsLength:s.enrollmentsLength?parseFloat(s.enrollmentsLength):0,enrollmentsSpeechLength:s.enrollmentsSpeechLength?parseFloat(s.enrollmentsSpeechLength):0,profileId:s.profileId||s.identificationProfileId,remainingEnrollmentsSpeechLength:s.remainingEnrollmentsSpeechLength?parseFloat(s.remainingEnrollmentsSpeechLength):0}}static getVerificationDetails(s){return{audioLength:s.audioLength?parseFloat(s.audioLength):0,audioSpeechLength:s.audioSpeechLength?parseFloat(s.audioSpeechLength):0,enrollmentStatus:s.enrollmentStatus,enrollmentsCount:s.enrollmentsCount,enrollmentsLength:s.enrollmentsLength?parseFloat(s.enrollmentsLength):0,enrollmentsSpeechLength:s.enrollmentsSpeechLength?parseFloat(s.enrollmentsSpeechLength):0,profileId:s.profileId||s.verificationProfileId,remainingEnrollmentsCount:s.remainingEnrollments||s.remainingEnrollmentsCount,remainingEnrollmentsSpeechLength:s.remainingEnrollmentsSpeechLength?parseFloat(s.remainingEnrollmentsSpeechLength):0}}};Pc.VoiceProfileEnrollmentResult=n;class i extends e.CancellationDetailsBase{constructor(s,o,a){super(s,o,a)}static fromResult(s){const o=e.CancellationReason.Error;let a=e.CancellationErrorCode.NoError;return s.properties&&(a=e.CancellationErrorCode[s.properties.getProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[e.CancellationErrorCode.NoError])]),new i(o,s.errorDetails,a)}}return Pc.VoiceProfileEnrollmentCancellationDetails=i,Pc}var Ic={},h3;function fX(){if(h3)return Ic;h3=1,Object.defineProperty(Ic,"__esModule",{value:!0}),Ic.VoiceProfileCancellationDetails=Ic.VoiceProfileResult=void 0;const t=Ve(),e=Ct,n=me();let i=class{constructor(o,a){this.privReason=o,this.privProperties=new n.PropertyCollection,o===n.ResultReason.Canceled&&(e.Contracts.throwIfNullOrUndefined(a,"statusText"),this.privErrorDetails=a,this.privProperties.setProperty(t.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get properties(){return this.privProperties}get errorDetails(){return this.privErrorDetails}};Ic.VoiceProfileResult=i;class r extends n.CancellationDetailsBase{constructor(o,a,l){super(o,a,l)}static fromResult(o){const a=n.CancellationReason.Error;let l=n.CancellationErrorCode.NoError;return o.properties&&(l=n.CancellationErrorCode[o.properties.getProperty(t.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.NoError])]),new r(a,o.errorDetails,l)}}return Ic.VoiceProfileCancellationDetails=r,Ic}var Ef={},d3;function mX(){if(d3)return Ef;d3=1,Object.defineProperty(Ef,"__esModule",{value:!0}),Ef.VoiceProfilePhraseResult=void 0;const t=Ct,e=me();let n=class extends e.VoiceProfileResult{constructor(r,s,o,a){super(r,s),this.privPhrases=[],t.Contracts.throwIfNullOrUndefined(a,"phrase array"),this.privType=o,a&&a[0]&&(this.privPhrases=a)}get phrases(){return this.privPhrases}get type(){return this.privType}};return Ef.VoiceProfilePhraseResult=n,Ef}var Rf={},p3;function gX(){if(p3)return Rf;p3=1,Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.VoiceProfileClient=void 0;const t=Ve(),e=IU(),n=Ct,i=me();let r=class extends i.Recognizer{constructor(o){n.Contracts.throwIfNullOrUndefined(o,"speechConfig");const a=o;n.Contracts.throwIfNull(a,"speechConfig"),super(e.AudioConfig.fromStreamInput(i.AudioInputStream.createPushStream()),a.properties,new t.VoiceProfileConnectionFactory),this.privProperties=a.properties.clone(),this.privVoiceAdapter=this.privReco,this.privDisposedVoiceAdapter=!1}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){n.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}async createProfileAsync(o,a){const l=await this.privVoiceAdapter.createProfile(o,a);return new i.VoiceProfile(l[0],o)}async retrieveEnrollmentResultAsync(o){return this.privVoiceAdapter.retrieveEnrollmentResult(o)}async getAllProfilesAsync(o){return this.privVoiceAdapter.getAllProfiles(o)}async getActivationPhrasesAsync(o,a){return this.privVoiceAdapter.getActivationPhrases(o,a)}async enrollProfileAsync(o,a){const l=a;return n.Contracts.throwIfNullOrUndefined(l,"audioConfig"),this.audioConfig=a,this.privVoiceAdapter.SpeakerAudioSource=l,this.privVoiceAdapter.enrollProfile(o)}async deleteProfileAsync(o){return this.privVoiceAdapter.deleteProfile(o)}async resetProfileAsync(o){return this.privVoiceAdapter.resetProfile(o)}async close(){await this.dispose(!0)}createServiceRecognizer(o,a,l,c){const u=l;return new t.VoiceServiceRecognizer(o,a,u,c,this)}async dispose(o){this.privDisposedVoiceAdapter||(this.privDisposedVoiceAdapter=!0,o&&await super.dispose(o))}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.properties)}getResult(o,a){return new i.VoiceProfileResult(o.ok?a:i.ResultReason.Canceled,o.statusText)}};return Rf.VoiceProfileClient=r,Rf}var Tf={},f3;function vX(){if(f3)return Tf;f3=1,Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.SpeakerRecognizer=void 0;const t=Ve(),e=Ct,n=me();let i=class extends n.Recognizer{constructor(s,o){e.Contracts.throwIfNullOrUndefined(s,"speechConfig");const a=s;e.Contracts.throwIfNullOrUndefined(a,"speechConfig"),super(o,a.properties,new t.SpeakerRecognitionConnectionFactory),this.privAudioConfigImpl=o,e.Contracts.throwIfNull(this.privAudioConfigImpl,"audioConfig"),this.privDisposedSpeakerRecognizer=!1,this.privProperties=a.properties}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){e.Contracts.throwIfNullOrWhitespace(s,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,s)}get properties(){return this.privProperties}async recognizeOnceAsync(s){return e.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),this.recognizeSpeakerOnceAsyncImpl(s)}async close(){e.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.dispose(!0)}async recognizeSpeakerOnceAsyncImpl(s){e.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.implRecognizerStop();const o=await this.privReco.recognizeSpeaker(s);return await this.implRecognizerStop(),o}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}createRecognizerConfig(s){return new t.RecognizerConfig(s,this.privProperties)}createServiceRecognizer(s,o,a,l){const c=a;return new t.SpeakerServiceRecognizer(s,o,c,l,this)}async dispose(s){this.privDisposedSpeakerRecognizer||s&&(this.privDisposedSpeakerRecognizer=!0,await super.dispose(s))}};return Tf.SpeakerRecognizer=i,Tf}var bf={},m3;function yX(){if(m3)return bf;m3=1,Object.defineProperty(bf,"__esModule",{value:!0}),bf.SpeakerIdentificationModel=void 0;const t=Ct,e=me();let n=class JU{constructor(r){if(this.privVoiceProfiles=[],this.privProfileIds=[],t.Contracts.throwIfNullOrUndefined(r,"VoiceProfiles"),r.length===0)throw new Error("Empty Voice Profiles array");for(const s of r){if(s.profileType!==e.VoiceProfileType.TextIndependentIdentification)throw new Error("Identification model can only be created from Identification profile: "+s.profileId);this.privVoiceProfiles.push(s),this.privProfileIds.push(s.profileId)}}static fromProfiles(r){return new JU(r)}get voiceProfileIds(){return this.privProfileIds.join(",")}get profileIds(){return this.privProfileIds}get scenario(){return"TextIndependentIdentification"}};return bf.SpeakerIdentificationModel=n,bf}var Af={},g3;function SX(){if(g3)return Af;g3=1,Object.defineProperty(Af,"__esModule",{value:!0}),Af.SpeakerVerificationModel=void 0;const t=Ct,e=me();let n=class QU{constructor(r){if(t.Contracts.throwIfNullOrUndefined(r,"VoiceProfile"),r.profileType===e.VoiceProfileType.TextIndependentIdentification)throw new Error("Verification model cannot be created from Identification profile");this.privVoiceProfile=r}static fromProfile(r){return new QU(r)}get voiceProfile(){return this.privVoiceProfile}get profileIds(){return[this.voiceProfile.profileId]}get scenario(){return this.voiceProfile.profileType===e.VoiceProfileType.TextDependentVerification?"TextDependentVerification":"TextIndependentVerification"}};return Af.SpeakerVerificationModel=n,Af}var Pf={},g2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.LanguageIdMode=void 0,function(e){e[e.AtStart=0]="AtStart",e[e.Continuous=1]="Continuous"}(t.LanguageIdMode||(t.LanguageIdMode={}))})(g2);var v3;function xX(){if(v3)return Pf;v3=1,Object.defineProperty(Pf,"__esModule",{value:!0}),Pf.AutoDetectSourceLanguageConfig=void 0;const t=Ve(),e=Ct,n=me(),i=g2;let r=class Iy{constructor(){this.privProperties=new n.PropertyCollection,this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=i.LanguageIdMode.AtStart}static fromOpenRange(){const o=new Iy;return o.properties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,t.AutoDetectSourceLanguagesOpenRangeOptionName),o}static fromLanguages(o){e.Contracts.throwIfArrayEmptyOrWhitespace(o,"languages");const a=new Iy;return a.properties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,o.join()),a}static fromSourceLanguageConfigs(o){if(o.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");const a=new Iy,l=[];return o.forEach(c=>{if(l.push(c.language),c.endpointId!==void 0&&c.endpointId!==""){const u=c.language+n.PropertyId.SpeechServiceConnection_EndpointId.toString();a.properties.setProperty(u,c.endpointId)}}),a.properties.setProperty(n.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,l.join()),a}get properties(){return this.privProperties}set mode(o){o===i.LanguageIdMode.Continuous?(this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=o}};return Pf.AutoDetectSourceLanguageConfig=r,Pf}var vx={};Object.defineProperty(vx,"__esModule",{value:!0});vx.AutoDetectSourceLanguageResult=void 0;const y3=Ct;class C1{constructor(e,n){y3.Contracts.throwIfNullOrUndefined(e,"language"),y3.Contracts.throwIfNullOrUndefined(n,"languageDetectionConfidence"),this.privLanguage=e,this.privLanguageDetectionConfidence=n}static fromResult(e){return new C1(e.language,e.languageDetectionConfidence)}static fromConversationTranscriptionResult(e){return new C1(e.language,e.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}}vx.AutoDetectSourceLanguageResult=C1;var yx={};Object.defineProperty(yx,"__esModule",{value:!0});yx.SourceLanguageConfig=void 0;const CX=Ct;class v2{constructor(e,n){CX.Contracts.throwIfNullOrUndefined(e,"language"),this.privLanguage=e,this.privEndpointId=n}static fromLanguage(e,n){return new v2(e,n)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}}yx.SourceLanguageConfig=v2;var L_={},S3;function _X(){return S3||(S3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpeakerRecognitionCancellationDetails=t.SpeakerRecognitionResult=t.SpeakerRecognitionResultType=void 0;const e=Ve(),n=me();var i;(function(o){o[o.Verify=0]="Verify",o[o.Identify=1]="Identify"})(i=t.SpeakerRecognitionResultType||(t.SpeakerRecognitionResultType={}));class r{constructor(a,l=n.ResultReason.RecognizedSpeaker,c=n.CancellationErrorCode.NoError,u=""){this.privProperties=new n.PropertyCollection;const h=a.scenario==="TextIndependentIdentification"?i.Identify:i.Verify;this.privReason=l,this.privReason!==n.ResultReason.Canceled?h===i.Identify?(this.privProfileId=a.identificationResult.identifiedProfile.profileId,this.privScore=a.identificationResult.identifiedProfile.score,this.privReason=n.ResultReason.RecognizedSpeakers):(this.privScore=a.verificationResult.score,a.verificationResult.recognitionResult.toLowerCase()!=="accept"&&(this.privReason=n.ResultReason.NoMatch),a.verificationResult.profileId!==void 0&&a.verificationResult.profileId!==""&&(this.privProfileId=a.verificationResult.profileId)):(this.privErrorDetails=u,this.privProperties.setProperty(e.CancellationErrorCodePropertyName,n.CancellationErrorCode[c])),this.privProperties.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,JSON.stringify(a))}get properties(){return this.privProperties}get reason(){return this.privReason}get profileId(){return this.privProfileId}get errorDetails(){return this.privErrorDetails}get score(){return this.privScore}}t.SpeakerRecognitionResult=r;class s extends n.CancellationDetailsBase{constructor(a,l,c){super(a,l,c)}static fromResult(a){const l=n.CancellationReason.Error;let c=n.CancellationErrorCode.NoError;return a.properties&&(c=n.CancellationErrorCode[a.properties.getProperty(e.CancellationErrorCodePropertyName,n.CancellationErrorCode[n.CancellationErrorCode.NoError])]),new s(l,a.errorDetails,c)}}t.SpeakerRecognitionCancellationDetails=s}(L_)),L_}var D_={},Mc={},x3;function ZU(){if(x3)return Mc;x3=1,Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.ConversationImpl=Mc.Conversation=void 0;const t=Ve(),e=ht(),n=Ct,i=me();let r=class{constructor(){}static createConversationAsync(a,l,c,u){n.Contracts.throwIfNullOrUndefined(a,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrUndefined(a.region,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),!a.subscriptionKey&&!a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceAuthorization_Token])&&n.Contracts.throwIfNullOrUndefined(a.subscriptionKey,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));let h,d,p;return typeof l=="string"?(h=new s(a,l),e.marshalPromiseToCallbacks((async()=>{})(),c,u)):(h=new s(a),d=l,p=c,h.createConversationAsync(()=>{d&&d()},f=>{p&&p(f)})),h}};Mc.Conversation=r;class s extends r{constructor(a,l){if(super(),this.privErrors=t.ConversationConnectionConfig.restErrors,this.onConnected=h=>{var d;this.privIsConnected=!0;try{(d=this.privConversationTranslator)!=null&&d.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{var d;try{(d=this.privConversationTranslator)!=null&&d.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,d)=>{var p;try{(p=this.privConversationTranslator)!=null&&p.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,d)}catch{}},this.onParticipantUpdateCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.id);if(p!==void 0){switch(d.key){case t.ConversationTranslatorCommandTypes.changeNickname:p.displayName=d.value;break;case t.ConversationTranslatorCommandTypes.setUseTTS:p.isUsingTts=d.value;break;case t.ConversationTranslatorCommandTypes.setProfanityFiltering:p.profanity=d.value;break;case t.ConversationTranslatorCommandTypes.setMute:p.isMuted=d.value;break;case t.ConversationTranslatorCommandTypes.setTranslateToLanguages:p.translateToLanguages=d.value;break}this.privParticipants.addOrUpdateParticipant(p),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,[this.toParticipant(p)],d.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,d)=>{try{this.privParticipants.participants.forEach(p=>p.isMuted=p.isHost?!1:d.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,this.toParticipants(!1),d.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,d)=>{try{const p=this.privParticipants.addOrUpdateParticipant(d.participant);p!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,[this.toParticipant(p)],d.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.participant.id);p!==void 0&&(this.privParticipants.deleteParticipant(d.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.LeftConversation,[this.toParticipant(p)],d.sessionId)))}catch{}},this.onTranslationReceived=(h,d)=>{try{switch(d.command){case t.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,d)=>{var p;try{if(d.sessionToken!==void 0&&d.sessionToken!==null&&(this.privRoom.token=d.sessionToken),this.privParticipants.participants=[...d.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),d.sessionId)),this.me.isHost){const f=(p=this.privConversationTranslator)==null?void 0:p.properties.getProperty(i.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(h,d)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,d)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new i.PropertyCollection,this.privManager=new t.ConversationManager,a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])||a.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage],t.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),l)this.privConversationId=l;else{a.targetLanguages.length===0&&a.addTargetLanguage(this.privLanguage),a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceResponse_ProfanityOption])||a.setProfanity(i.ProfanityOption.Masked);let d=a.getProperty(i.PropertyId[i.PropertyId.ConversationTranslator_Name]);d==null&&(d="Host"),n.Contracts.throwIfNullOrTooLong(d,"nickname",50),n.Contracts.throwIfNullOrTooShort(d,"nickname",2),a.setProperty(i.PropertyId[i.PropertyId.ConversationTranslator_Name],d)}this.privConfig=a;const u=a;n.Contracts.throwIfNull(u,"speechConfig"),this.privProperties=u.properties.clone(),this.privIsConnected=!1,this.privParticipants=new t.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var a,l;return(a=this.privParticipants.me)!=null&&a.isHost?!1:(l=this.privParticipants.me)==null?void 0:l.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){const a=this.conversationId,l=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),c={};for(const h of t.ConversationConnectionConfig.transcriptionEventKeys){const d=this.properties.getProperty(h,"");d!==""&&(c[h]=d)}return{id:a,participants:l,conversationProperties:c}}get canSend(){var a;return this.privIsConnected&&!((a=this.privParticipants.me)!=null&&a.isMuted)}get canSendAsHost(){var a;return this.privIsConnected&&((a=this.privParticipants.me)==null?void 0:a.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"authorizationToken"),this.privToken=a}set conversationTranslator(a){this.privConversationTranslator=a}onToken(a){this.privConversationTranslator.onToken(a)}createConversationAsync(a,l){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),l),this.privManager.createOrJoin(this.privProperties,void 0,c=>{c||this.handleError(new Error(this.privErrors.permissionDeniedConnect),l),this.privRoom=c,this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}startConversationAsync(a,l){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),l),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=t.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}addParticipantAsync(a,l,c){n.Contracts.throwIfNullOrUndefined(a,"Participant"),e.marshalPromiseToCallbacks(this.addParticipantImplAsync(a),l,c)}joinConversationAsync(a,l,c,u,h){try{n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","conversationId")),n.Contracts.throwIfNullOrWhitespace(l,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,a,d=>{n.Contracts.throwIfNullOrUndefined(d,this.privErrors.permissionDeniedConnect),this.privRoom=d,this.privConfig.authorizationToken=d.cognitiveSpeechAuthToken,u&&u(d.cognitiveSpeechAuthToken)},d=>{this.handleError(d,h)})}catch(d){this.handleError(d,h)}}deleteConversationAsync(a,l){e.marshalPromiseToCallbacks(this.deleteConversationImplAsync(),a,l)}async deleteConversationImplAsync(){n.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),n.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endConversationAsync(a,l){e.marshalPromiseToCallbacks(this.endConversationImplAsync(),a,l)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}muteAllParticipantsAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}muteParticipantAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!0),()=>{this.handleCallback(l,c)},h=>{this.handleError(h,c)})}catch(u){this.handleError(u,c)}}removeParticipantAsync(a,l,c){try{if(n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&a.hasOwnProperty("id"))e.marshalPromiseToCallbacks(this.removeParticipantImplAsync(a),l,c);else{n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),c);let u="";typeof a=="string"?u=a:a.hasOwnProperty("id")?u=a.id:a.hasOwnProperty("userId")&&(u=a.userId),n.Contracts.throwIfNullOrWhitespace(u,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(d=>d.id===u)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(u),()=>{this.handleCallback(l,c)},d=>{this.handleError(d,c)})}}catch(u){this.handleError(u,c)}}unlockConversationAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}unmuteAllParticipantsAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}unmuteParticipantAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!1),()=>{this.handleCallback(l,c)},h=>{this.handleError(h,c)})}catch(u){this.handleError(u,c)}}sendTextMessageAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","message")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),a.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(a),()=>{this.handleCallback(l,c)},u=>{this.handleError(u,c)})}catch(u){this.handleError(u,c)}}setTranslatedLanguagesAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfArrayEmptyOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","languages")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(a),()=>{this.handleCallback(l,c)},u=>{this.handleError(u,c)})}catch(u){this.handleError(u,c)}}changeNicknameAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(a),()=>{this.handleCallback(l,c)},u=>{this.handleError(u,c)})}catch(u){this.handleError(u,c)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(a){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await a.enforceAudioGating(),this.privTranscriberRecognizer=a,this.privTranscriberRecognizer.conversation=this}getKeepAlive(){const a=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:a,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(a){if(this.privParticipants.addOrUpdateParticipant(a)!==void 0&&this.privTranscriberRecognizer){const c=this.conversationInfo;return c.participants=[a],this.privTranscriberRecognizer.pushConversationEvent(c,"join")}}removeParticipantImplAsync(a){this.privParticipants.deleteParticipant(a.id);const l=this.conversationInfo;return l.participants=[a],this.privTranscriberRecognizer.pushConversationEvent(l,"leave")}async close(a){var l;try{this.privIsConnected=!1,await((l=this.privConversationRecognizer)==null?void 0:l.close()),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(c){throw c}a&&this.dispose()}handleCallback(a,l){if(a){try{a()}catch(c){l&&l(c)}a=void 0}}handleError(a,l){if(l)if(a instanceof Error){const c=a;l(c.name+": "+c.message)}else l(a)}toParticipants(a){const l=this.privParticipants.participants.map(c=>this.toParticipant(c));return a?l:l.filter(c=>c.isHost===!1)}toParticipant(a){return new i.Participant(a.id,a.avatar,a.displayName,a.isHost,a.isMuted,a.isUsingTts,a.preferredLanguage,a.voice)}getMuteAllCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMuteCommand(a,l){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMute,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:l})}getLockCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getEjectCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.ejectParticipant,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getChangeNicknameCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"nickname"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.changeNickname,nickname:a,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMessageCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),n.Contracts.throwIfNullOrWhitespace(a,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:a,type:t.ConversationTranslatorMessageTypes.instantMessage})}}return Mc.ConversationImpl=s,Mc}var Sx={};Object.defineProperty(Sx,"__esModule",{value:!0});Sx.ConversationCommon=void 0;class wX{constructor(e){this.privAudioConfig=e}handleCallback(e,n){if(e){try{e()}catch(i){n&&n(i)}e=void 0}}handleError(e,n){if(n)if(e instanceof Error){const i=e;n(i.name+": "+i.message)}else n(e)}}Sx.ConversationCommon=wX;var If={},C3;function EX(){if(C3)return If;C3=1,Object.defineProperty(If,"__esModule",{value:!0}),If.ConversationExpirationEventArgs=void 0;const t=me();let e=class extends t.SessionEventArgs{constructor(i,r){super(r),this.privExpirationTime=i}get expirationTime(){return this.privExpirationTime}};return If.ConversationExpirationEventArgs=e,If}var Mf={},_3;function RX(){if(_3)return Mf;_3=1,Object.defineProperty(Mf,"__esModule",{value:!0}),Mf.ConversationParticipantsChangedEventArgs=void 0;const t=me();let e=class extends t.SessionEventArgs{constructor(i,r,s){super(s),this.privReason=i,this.privParticipant=r}get reason(){return this.privReason}get participants(){return this.privParticipant}};return Mf.ConversationParticipantsChangedEventArgs=e,Mf}var kf={},w3;function TX(){if(w3)return kf;w3=1,Object.defineProperty(kf,"__esModule",{value:!0}),kf.ConversationTranslationCanceledEventArgs=void 0;const t=A0();let e=class extends t.CancellationEventArgsBase{};return kf.ConversationTranslationCanceledEventArgs=e,kf}var Lf={},E3;function bX(){if(E3)return Lf;E3=1,Object.defineProperty(Lf,"__esModule",{value:!0}),Lf.ConversationTranslationEventArgs=void 0;const t=me();let e=class extends t.RecognitionEventArgs{constructor(i,r,s){super(r,s),this.privResult=i}get result(){return this.privResult}};return Lf.ConversationTranslationEventArgs=e,Lf}var Df={},R3;function AX(){if(R3)return Df;R3=1,Object.defineProperty(Df,"__esModule",{value:!0}),Df.ConversationTranslationResult=void 0;const t=NU();let e=class extends t.TranslationRecognitionResult{constructor(i,r,s,o,a,l,c,u,h,d,p){super(r,o,a,l,c,u,void 0,void 0,h,d,p),this.privId=i,this.privOrigLang=s}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}};return Df.ConversationTranslationResult=e,Df}var N_={},Nf={},I0={};Object.defineProperty(I0,"__esModule",{value:!0});I0.StringUtils=void 0;class PX{static formatString(e,n){if(!e)return"";if(!n)return e;let i="",r="";const s=l=>{i+=l},o=l=>{r+=l};let a=s;for(let l=0;l<e.length;l++){const c=e[l],u=l+1<e.length?e[l+1]:"";switch(c){case"{":u==="{"?(a("{"),l++):a=o;break;case"}":u==="}"?(a("}"),l++):(n.hasOwnProperty(r)&&(i+=n[r]),a=s,r="");break;default:a(c);break}}return i}}I0.StringUtils=PX;var T3;function IX(){if(T3)return Nf;T3=1,Object.defineProperty(Nf,"__esModule",{value:!0}),Nf.ConversationTranslatorConnectionFactory=void 0;const t=zi(),e=I0,n=Ct,i=me(),r=Fi,s=Do,o=No(),a=Ve();let l=class eB extends o.ConnectionFactoryBase{constructor(u){super(),n.Contracts.throwIfNullOrUndefined(u,"convGetter"),this.privConvGetter=u}create(u,h,d){const p=u.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase()==="TRUE",f=this.privConvGetter().room,v=f.cognitiveSpeechRegion||u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region,""),g={hostSuffix:o.ConnectionFactoryBase.getHostSuffix(v),path:eB.CTS_VIRT_MIC_PATH,region:encodeURIComponent(v)};g[s.QueryParameterNames.Language]=encodeURIComponent(u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,"")),g[s.QueryParameterNames.CtsMeetingId]=encodeURIComponent(f.roomId),g[s.QueryParameterNames.CtsDeviceId]=encodeURIComponent(f.participantId),g[s.QueryParameterNames.CtsIsParticipant]=f.isHost?"":"&"+s.QueryParameterNames.CtsIsParticipant;let m="";const y={},S={};if(p){m=u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint),m||(m="wss://"+u.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"),m=e.StringUtils.formatString(m,g);const w=new URL(m);w.searchParams.forEach((E,T)=>{y[T]=E}),new a.TranscriberConnectionFactory().setQueryParams(y,u,m),y[s.QueryParameterNames.CtsMeetingId]=g[s.QueryParameterNames.CtsMeetingId],y[s.QueryParameterNames.CtsDeviceId]=g[s.QueryParameterNames.CtsDeviceId],f.isHost||(y[s.QueryParameterNames.CtsIsParticipant]=""),s.QueryParameterNames.Format in y||(y[s.QueryParameterNames.Format]="simple"),w.searchParams.forEach((E,T)=>{w.searchParams.set(T,y[T]),delete y[T]}),m=w.toString()}else{const w=new a.TranslationConnectionFactory;m=w.getEndpointUrl(u,!0),m=e.StringUtils.formatString(m,g),w.setQueryParams(y,u,m)}S[r.HeaderNames.ConnectionId]=d,S[t.RestConfigBase.configParams.token]=f.token,h.token&&(S[h.headerName]=h.token);const x=u.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase()==="TRUE";return new t.WebsocketConnection(m,y,S,new a.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(u),x,d)}};return Nf.ConversationTranslatorConnectionFactory=l,l.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio",Nf}var b3;function MX(){return b3||(b3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationTranslator=t.SpeechState=void 0;const e=Ve(),n=IX(),i=ht(),r=Ct,s=me(),o=ZU(),a=y2();var l;(function(h){h[h.Inactive=0]="Inactive",h[h.Connecting=1]="Connecting",h[h.Connected=2]="Connected"})(l=t.SpeechState||(t.SpeechState={}));class c extends s.TranslationRecognizer{constructor(d,p,f,v){super(d,p,new n.ConversationTranslatorConnectionFactory(v)),this.privSpeechState=l.Inactive,f&&(this.privTranslator=f,this.sessionStarted=()=>{this.privSpeechState=l.Connected},this.sessionStopped=()=>{this.privSpeechState=l.Inactive},this.recognizing=(g,m)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,m)},this.recognized=async(g,m)=>{var y;(y=m.result)!=null&&y.errorDetails?(await this.cancelSpeech(),this.fireCancelEvent(m.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,m)},this.canceled=async()=>{if(this.privSpeechState!==l.Inactive)try{await this.cancelSpeech()}catch{this.privSpeechState=l.Inactive}})}get state(){return this.privSpeechState}set state(d){this.privSpeechState=d}set authentication(d){this.privReco.authentication=d}onConnection(){this.privSpeechState=l.Connected}async onCancelSpeech(){this.privSpeechState=l.Inactive,await this.cancelSpeech()}fireCancelEvent(d){try{if(this.privTranslator.canceled){const p=new a.ConversationTranslationCanceledEventArgs(s.CancellationReason.Error,d,s.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,p)}}catch{}}async cancelSpeech(){var d;try{this.stopContinuousRecognitionAsync(),await((d=this.privReco)==null?void 0:d.disconnect()),this.privSpeechState=l.Inactive}catch{}}}class u extends a.ConversationCommon{constructor(d){super(d),this.privErrors=e.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new s.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){var d;return(d=this.privConversation)==null?void 0:d.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===l.Connected||this.privCTRecognizer.state===l.Connecting||this.privConversation.isMutedByHost)}onToken(d){this.privCTRecognizer.authentication=d}setServiceProperty(d,p){const f=JSON.parse(this.privProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));f[d]=p,this.privProperties.setProperty(e.ServicePropertiesPropertyName,JSON.stringify(f))}joinConversationAsync(d,p,f,v,g){try{if(typeof d=="string"){r.Contracts.throwIfNullOrUndefined(d,this.privErrors.invalidArgs.replace("{arg}","conversation id")),r.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),g);let m=f;(m==null||m==="")&&(m=e.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=s.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(s.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(m),this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_RecoLanguage],m),this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.ConversationTranslator_Name],p);const y=[s.PropertyId.SpeechServiceConnection_Host,s.PropertyId.ConversationTranslator_Host,s.PropertyId.SpeechServiceConnection_Endpoint,s.PropertyId.SpeechServiceConnection_ProxyHostName,s.PropertyId.SpeechServiceConnection_ProxyPassword,s.PropertyId.SpeechServiceConnection_ProxyPort,s.PropertyId.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(const x of y){const w=this.privProperties.getProperty(x);if(w){const C=typeof x=="string"?x:s.PropertyId[x];this.privSpeechTranslationConfig.setProperty(C,w)}}const S=JSON.parse(this.privProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));for(const x of Object.keys(S))this.privSpeechTranslationConfig.setServiceProperty(x,S[x],s.ServicePropertyChannel.UriQueryParameter);this.privConversation=new o.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(d,p,m,x=>{x||this.handleError(new Error(this.privErrors.permissionDeniedConnect),g),this.privSpeechTranslationConfig.authorizationToken=x,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync(()=>{this.handleCallback(v,g)},w=>{this.handleError(w,g)})},x=>{this.handleError(x,g)})}else typeof d=="object"?(r.Contracts.throwIfNullOrUndefined(d,this.privErrors.invalidArgs.replace("{arg}","conversation id")),r.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(s.PropertyId.ConversationTranslator_Name,p),this.privConversation=d,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,r.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),r.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=d.config,this.handleCallback(f,v)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),v)}catch(m){this.handleError(m,typeof f=="string"?g:v)}}leaveConversationAsync(d,p){i.marshalPromiseToCallbacks((async()=>{await this.cancelSpeech(),await this.privConversation.endConversationImplAsync(),await this.privConversation.deleteConversationImplAsync(),this.dispose()})(),d,p)}sendTextMessageAsync(d,p,f){try{r.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),r.Contracts.throwIfNullOrWhitespace(d,this.privErrors.invalidArgs.replace("{arg}",d)),this.privConversation.sendTextMessageAsync(d,p,f)}catch(v){this.handleError(v,f)}}startTranscribingAsync(d,p){i.marshalPromiseToCallbacks((async()=>{try{r.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),r.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privCTRecognizer===void 0&&await this.connectTranslatorRecognizer(),r.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),p),await this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(f){throw this.privIsSpeaking=!1,await this.cancelSpeech(),f}})(),d,p)}stopTranscribingAsync(d,p){i.marshalPromiseToCallbacks((async()=>{try{if(!this.privIsSpeaking){await this.cancelSpeech();return}this.privIsSpeaking=!1,await new Promise((f,v)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(f,v)})}catch{await this.cancelSpeech()}})(),d,p)}isDisposed(){return this.privIsDisposed}dispose(d,p,f){i.marshalPromiseToCallbacks((async()=>{this.isDisposed&&!this.privIsSpeaking||(await this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})(),p,f)}async cancelSpeech(){var d;try{this.privIsSpeaking=!1,await((d=this.privCTRecognizer)==null?void 0:d.onCancelSpeech()),this.privCTRecognizer=void 0}catch{}}async connectTranslatorRecognizer(){try{this.privAudioConfig===void 0&&(this.privAudioConfig=s.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Key],"");const d=()=>this.privConversation;this.privCTRecognizer=new c(this.privSpeechTranslationConfig,this.privAudioConfig,this,d)}catch(d){throw await this.cancelSpeech(),d}}startContinuousRecognition(){return new Promise((d,p)=>{this.privCTRecognizer.startContinuousRecognitionAsync(d,p)})}}t.ConversationTranslator=u}(N_)),N_}var Of={},A3;function kX(){if(A3)return Of;A3=1,Object.defineProperty(Of,"__esModule",{value:!0}),Of.ConversationTranscriber=void 0;const t=Ve(),e=ht(),n=Ct,i=me();let r=class tB extends i.Recognizer{constructor(o,a){const l=o;n.Contracts.throwIfNull(l,"speechConfig"),n.Contracts.throwIfNullOrWhitespace(l.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),super(a,l.properties,new t.ConversationTranscriberConnectionFactory),this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privDisposedRecognizer=!1}static FromConfig(o,a,l){const c=o;return a.properties.mergeTo(c.properties),new tB(o,l)}get endpointId(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){n.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,o)}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple])===i.OutputFormat[i.OutputFormat.Simple]?i.OutputFormat.Simple:i.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(o,a){e.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,a)}stopTranscribingAsync(o,a){e.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}close(o,a){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),o,a)}async dispose(o){this.privDisposedRecognizer||(o&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(o))}createRecognizerConfig(o){return new t.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,a,l,c){const u=l;return c.isSpeakerDiarizationEnabled=!0,new t.ConversationTranscriptionServiceRecognizer(o,a,u,c,this)}};return Of.ConversationTranscriber=r,Of}var kc={},P3;function LX(){if(P3)return kc;P3=1,Object.defineProperty(kc,"__esModule",{value:!0}),kc.Participant=kc.User=void 0;const t=me();class e{constructor(r){this.privUserId=r}get userId(){return this.privUserId}}kc.User=e;class n{constructor(r,s,o,a,l,c,u,h){this.privId=r,this.privAvatar=s,this.privDisplayName=o,this.privIsHost=a,this.privIsMuted=l,this.privIsUsingTts=c,this.privPreferredLanguage=u,this.privVoice=h,this.privProperties=new t.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(r,s,o){return new n(r,"",r,!1,!1,!1,s,o)}}return kc.Participant=n,kc}var nB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantChangedReason=void 0,function(e){e[e.JoinedConversation=0]="JoinedConversation",e[e.LeftConversation=1]="LeftConversation",e[e.Updated=2]="Updated"}(t.ParticipantChangedReason||(t.ParticipantChangedReason={}))})(nB);var Lc={},I3;function DX(){if(I3)return Lc;I3=1,Object.defineProperty(Lc,"__esModule",{value:!0}),Lc.MeetingImpl=Lc.Meeting=void 0;const t=Ve(),e=ht(),n=Ct,i=me();let r=class{constructor(){}static createMeetingAsync(a,l,c,u){if(n.Contracts.throwIfNullOrUndefined(a,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrUndefined(a.region,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),n.Contracts.throwIfNull(l,"meetingId"),l.length===0)throw new Error("meetingId cannot be empty");!a.subscriptionKey&&!a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceAuthorization_Token])&&n.Contracts.throwIfNullOrUndefined(a.subscriptionKey,t.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));const h=new s(a,l);return e.marshalPromiseToCallbacks((async()=>{})(),c,u),h}};Lc.Meeting=r;class s extends r{constructor(a,l){super(),this.privErrors=t.ConversationConnectionConfig.restErrors,this.onConnected=h=>{var d;this.privIsConnected=!0;try{(d=this.privConversationTranslator)!=null&&d.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{var d;try{(d=this.privConversationTranslator)!=null&&d.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,d)=>{var p;try{(p=this.privConversationTranslator)!=null&&p.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,d)}catch{}},this.onParticipantUpdateCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.id);if(p!==void 0){switch(d.key){case t.ConversationTranslatorCommandTypes.changeNickname:p.displayName=d.value;break;case t.ConversationTranslatorCommandTypes.setUseTTS:p.isUsingTts=d.value;break;case t.ConversationTranslatorCommandTypes.setProfanityFiltering:p.profanity=d.value;break;case t.ConversationTranslatorCommandTypes.setMute:p.isMuted=d.value;break;case t.ConversationTranslatorCommandTypes.setTranslateToLanguages:p.translateToLanguages=d.value;break}this.privParticipants.addOrUpdateParticipant(p),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,[this.toParticipant(p)],d.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,d)=>{try{this.privParticipants.participants.forEach(p=>p.isMuted=p.isHost?!1:d.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.Updated,this.toParticipants(!1),d.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,d)=>{try{const p=this.privParticipants.addOrUpdateParticipant(d.participant);p!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,[this.toParticipant(p)],d.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,d)=>{try{const p=this.privParticipants.getParticipant(d.participant.id);p!==void 0&&(this.privParticipants.deleteParticipant(d.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.LeftConversation,[this.toParticipant(p)],d.sessionId)))}catch{}},this.onTranslationReceived=(h,d)=>{try{switch(d.command){case t.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break;case t.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new i.ConversationTranslationEventArgs(d.payload,void 0,d.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,d)=>{var p;try{if(d.sessionToken!==void 0&&d.sessionToken!==null&&(this.privRoom.token=d.sessionToken),this.privParticipants.participants=[...d.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new i.ConversationParticipantsChangedEventArgs(i.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),d.sessionId)),this.me.isHost){const f=(p=this.privConversationTranslator)==null?void 0:p.properties.getProperty(i.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(h,d)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,d)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new i.PropertyCollection,this.privManager=new t.ConversationManager,a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])||a.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage],t.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=a.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=l,this.privConfig=a;const u=a;n.Contracts.throwIfNull(u,"speechConfig"),this.privProperties=u.properties.clone(),this.privIsConnected=!1,this.privParticipants=new t.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var a,l;return(a=this.privParticipants.me)!=null&&a.isHost?!1:(l=this.privParticipants.me)==null?void 0:l.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){const a=this.meetingId,l=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),c={};for(const h of t.ConversationConnectionConfig.transcriptionEventKeys){const d=this.properties.getProperty(h,"");d!==""&&(c[h]=d)}return{id:a,participants:l,meetingProperties:c}}get canSend(){var a;return this.privIsConnected&&!((a=this.privParticipants.me)!=null&&a.isMuted)}get canSendAsHost(){var a;return this.privIsConnected&&((a=this.privParticipants.me)==null?void 0:a.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"authorizationToken"),this.privToken=a}createMeetingAsync(a,l){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),l),this.privManager.createOrJoin(this.privProperties,void 0,c=>{c||this.handleError(new Error(this.privErrors.permissionDeniedConnect),l),this.privRoom=c,this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}startMeetingAsync(a,l){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),l),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}addParticipantAsync(a,l,c){n.Contracts.throwIfNullOrUndefined(a,"Participant"),e.marshalPromiseToCallbacks(this.addParticipantImplAsync(a),l,c)}joinMeetingAsync(a,l,c,u,h){try{n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","conversationId")),n.Contracts.throwIfNullOrWhitespace(l,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,a,d=>{n.Contracts.throwIfNullOrUndefined(d,this.privErrors.permissionDeniedConnect),this.privRoom=d,this.privConfig.authorizationToken=d.cognitiveSpeechAuthToken,u&&u(d.cognitiveSpeechAuthToken)},d=>{this.handleError(d,h)})}catch(d){this.handleError(d,h)}}deleteMeetingAsync(a,l){e.marshalPromiseToCallbacks(this.deleteMeetingImplAsync(),a,l)}async deleteMeetingImplAsync(){n.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),n.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endMeetingAsync(a,l){e.marshalPromiseToCallbacks(this.endMeetingImplAsync(),a,l)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}muteAllParticipantsAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}muteParticipantAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!0),()=>{this.handleCallback(l,c)},h=>{this.handleError(h,c)})}catch(u){this.handleError(u,c)}}removeParticipantAsync(a,l,c){try{if(n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&a.hasOwnProperty("id"))e.marshalPromiseToCallbacks(this.removeParticipantImplAsync(a),l,c);else{n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),c);let u="";typeof a=="string"?u=a:a.hasOwnProperty("id")?u=a.id:a.hasOwnProperty("userId")&&(u=a.userId),n.Contracts.throwIfNullOrWhitespace(u,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(d=>d.id===u)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(u),()=>{this.handleCallback(l,c)},d=>{this.handleError(d,c)})}}catch(u){this.handleError(u,c)}}unlockMeetingAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}unmuteAllParticipantsAsync(a,l){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),l),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(a,l)},c=>{this.handleError(c,l)})}catch(c){this.handleError(c,l)}}unmuteParticipantAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","userId")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==a&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(a)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(a,!1),()=>{this.handleCallback(l,c)},h=>{this.handleError(h,c)})}catch(u){this.handleError(u,c)}}sendTextMessageAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","message")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),a.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(a),()=>{this.handleCallback(l,c)},u=>{this.handleError(u,c)})}catch(u){this.handleError(u,c)}}setTranslatedLanguagesAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfArrayEmptyOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","languages")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(a),()=>{this.handleCallback(l,c)},u=>{this.handleError(u,c)})}catch(u){this.handleError(u,c)}}changeNicknameAsync(a,l,c){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),n.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","nickname")),n.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(a),()=>{this.handleCallback(l,c)},u=>{this.handleError(u,c)})}catch(u){this.handleError(u,c)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(a){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await a.enforceAudioGating(),this.privTranscriberRecognizer=a,this.privTranscriberRecognizer.meeting=this}getKeepAlive(){const a=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:a,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(a){if(this.privParticipants.addOrUpdateParticipant(a)!==void 0&&this.privTranscriberRecognizer){const c=this.meetingInfo;return c.participants=[a],this.privTranscriberRecognizer.pushMeetingEvent(c,"join")}}removeParticipantImplAsync(a){this.privParticipants.deleteParticipant(a.id);const l=this.meetingInfo;return l.participants=[a],this.privTranscriberRecognizer.pushMeetingEvent(l,"leave")}async close(a){var l;try{this.privIsConnected=!1,await((l=this.privConversationRecognizer)==null?void 0:l.close()),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(c){throw c}a&&this.dispose()}handleCallback(a,l){if(a){try{a()}catch(c){l&&l(c)}a=void 0}}handleError(a,l){if(l)if(a instanceof Error){const c=a;l(c.name+": "+c.message)}else l(a)}toParticipants(a){const l=this.privParticipants.participants.map(c=>this.toParticipant(c));return a?l:l.filter(c=>c.isHost===!1)}toParticipant(a){return new i.Participant(a.id,a.avatar,a.displayName,a.isHost,a.isMuted,a.isUsingTts,a.preferredLanguage,a.voice)}getMuteAllCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingd"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMuteCommand(a,l){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setMute,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:l})}getLockCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getEjectCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(a,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.ejectParticipant,participantId:a,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getChangeNicknameCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(a,"nickname"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:t.ConversationTranslatorCommandTypes.changeNickname,nickname:a,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:t.ConversationTranslatorMessageTypes.participantCommand,value:a})}getMessageCommand(a){return n.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),n.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),n.Contracts.throwIfNullOrWhitespace(a,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:a,type:t.ConversationTranslatorMessageTypes.instantMessage})}}return Lc.MeetingImpl=s,Lc}var Ff={},M3;function NX(){if(M3)return Ff;M3=1,Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.MeetingTranscriptionCanceledEventArgs=void 0;const t=A0();class e extends t.CancellationEventArgsBase{}return Ff.MeetingTranscriptionCanceledEventArgs=e,Ff}var zf={},k3;function OX(){if(k3)return zf;k3=1,Object.defineProperty(zf,"__esModule",{value:!0}),zf.MeetingTranscriber=void 0;const t=Ve(),e=ht(),n=Ct,i=me(),r=y2();let s=class{constructor(a){this.privAudioConfig=a,this.privProperties=new i.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return i.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,a)}joinMeetingAsync(a,l,c){const u=a;n.Contracts.throwIfNullOrUndefined(r.MeetingImpl,"Meeting"),this.privRecognizer=new t.TranscriberRecognizer(a.config,this.privAudioConfig),n.Contracts.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectMeetingCallbacks(this),e.marshalPromiseToCallbacks(u.connectTranscriberRecognizer(this.privRecognizer),l,c)}startTranscribingAsync(a,l){this.privRecognizer.startContinuousRecognitionAsync(a,l)}stopTranscribingAsync(a,l){this.privRecognizer.stopContinuousRecognitionAsync(a,l)}leaveMeetingAsync(a,l){this.privRecognizer.disconnectCallbacks(),e.marshalPromiseToCallbacks((async()=>{})(),a,l)}close(a,l){n.Contracts.throwIfDisposed(this.privDisposedRecognizer),e.marshalPromiseToCallbacks(this.dispose(!0),a,l)}async dispose(a){this.privDisposedRecognizer||(this.privRecognizer&&(await this.privRecognizer.close(),this.privRecognizer=void 0),a&&(this.privDisposedRecognizer=!0))}};return zf.MeetingTranscriber=s,zf}var Uf={},L3;function FX(){if(L3)return Uf;L3=1,Object.defineProperty(Uf,"__esModule",{value:!0}),Uf.ConversationTranscriptionResult=void 0;const t=me();let e=class extends t.RecognitionResult{constructor(i,r,s,o,a,l,c,u,h,d,p){super(i,r,s,o,a,l,c,h,d,p),this.privSpeakerId=u}get speakerId(){return this.privSpeakerId}};return Uf.ConversationTranscriptionResult=e,Uf}var D3;function y2(){return D3||(D3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ZU();Object.defineProperty(t,"Conversation",{enumerable:!0,get:function(){return e.Conversation}}),Object.defineProperty(t,"ConversationImpl",{enumerable:!0,get:function(){return e.ConversationImpl}});var n=Sx;Object.defineProperty(t,"ConversationCommon",{enumerable:!0,get:function(){return n.ConversationCommon}});var i=EX();Object.defineProperty(t,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return i.ConversationExpirationEventArgs}});var r=RX();Object.defineProperty(t,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return r.ConversationParticipantsChangedEventArgs}});var s=TX();Object.defineProperty(t,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return s.ConversationTranslationCanceledEventArgs}});var o=bX();Object.defineProperty(t,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return o.ConversationTranslationEventArgs}});var a=AX();Object.defineProperty(t,"ConversationTranslationResult",{enumerable:!0,get:function(){return a.ConversationTranslationResult}});var l=MX();Object.defineProperty(t,"ConversationTranslator",{enumerable:!0,get:function(){return l.ConversationTranslator}});var c=kX();Object.defineProperty(t,"ConversationTranscriber",{enumerable:!0,get:function(){return c.ConversationTranscriber}});var u=LX();Object.defineProperty(t,"Participant",{enumerable:!0,get:function(){return u.Participant}}),Object.defineProperty(t,"User",{enumerable:!0,get:function(){return u.User}});var h=nB;Object.defineProperty(t,"ParticipantChangedReason",{enumerable:!0,get:function(){return h.ParticipantChangedReason}});var d=DX();Object.defineProperty(t,"Meeting",{enumerable:!0,get:function(){return d.Meeting}}),Object.defineProperty(t,"MeetingImpl",{enumerable:!0,get:function(){return d.MeetingImpl}});var p=NX();Object.defineProperty(t,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return p.MeetingTranscriptionCanceledEventArgs}});var f=OX();Object.defineProperty(t,"MeetingTranscriber",{enumerable:!0,get:function(){return f.MeetingTranscriber}});var v=FX();Object.defineProperty(t,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return v.ConversationTranscriptionResult}})}(D_)),D_}var Dc={},N3;function S2(){if(N3)return Dc;N3=1,Object.defineProperty(Dc,"__esModule",{value:!0}),Dc.SynthesisRequest=Dc.Synthesizer=void 0;const t=Ve(),e=ht(),n=Ct,i=me();let r=class iB{constructor(a){const l=a;n.Contracts.throwIfNull(l,"speechConfig"),this.privProperties=l.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new e.Queue}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(a){n.Contracts.throwIfNullOrWhitespace(a,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,a)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===t.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(a){const l={"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-AvaMultilingualNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"};let c=this.properties.getProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage,"en-US"),u=this.properties.getProperty(i.PropertyId.SpeechServiceConnection_SynthVoice,""),h=iB.XMLEncode(a);return this.autoDetectSourceLanguage?c="en-US":u=u||l[c],u&&(h=`<voice name='${u}'>${h}</voice>`),h=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${c}'>${h}</speak>`,h}async dispose(a){this.privDisposed||(a&&this.privAdapter&&await this.privAdapter.dispose(),this.privDisposed=!0)}async adapterSpeak(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;const a=await this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(a.text,a.isSSML,a.requestId,a.cb,a.err,a.dataStream)}}createSynthesizerConfig(a){return new t.SynthesizerConfig(a,this.privProperties)}implCommonSynthesizeSetup(){let a=typeof window<"u"?"Browser":"Node",l="unknown",c="unknown";typeof navigator<"u"&&(a=a+"/"+navigator.platform,l=navigator.userAgent,c=navigator.appVersion);const u=this.createSynthesizerConfig(new t.SpeechServiceConfig(new t.Context(new t.OS(a,l,c)))),h=this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Key,void 0),d=h&&h!==""?new t.CognitiveSubscriptionKeyAuthentication(h):new t.CognitiveTokenAuthentication(()=>{const p=this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(p)},()=>{const p=this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(p)});this.privAdapter=this.createSynthesisAdapter(d,this.privConnectionFactory,u),this.privRestAdapter=this.createRestSynthesisAdapter(d,u)}static XMLEncode(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};Dc.Synthesizer=r;class s{constructor(a,l,c,u,h,d){this.requestId=a,this.text=l,this.isSSML=c,this.cb=u,this.err=h,this.dataStream=d}}return Dc.SynthesisRequest=s,Dc}var Bf={},O3;function zX(){if(O3)return Bf;O3=1,Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.SpeechSynthesizer=void 0;const t=Ve(),e=ht(),n=b0,i=yc,r=Vi,s=Ct,o=me(),a=S2();let l=class rB extends o.Synthesizer{constructor(u,h){super(u),h!==null&&(h===void 0?this.audioConfig=typeof window>"u"?void 0:o.AudioConfig.fromDefaultSpeakerOutput():this.audioConfig=h),this.privConnectionFactory=new t.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(u,h,d){const p=u;return h.properties.mergeTo(p.properties),new rB(u,d)}speakTextAsync(u,h,d,p){this.speakImpl(u,!1,h,d,p)}speakSsmlAsync(u,h,d,p){this.speakImpl(u,!0,h,d,p)}async getVoicesAsync(u=""){return this.getVoices(u)}close(u,h){s.Contracts.throwIfDisposed(this.privDisposed),e.marshalPromiseToCallbacks(this.dispose(!0),u,h)}get internalData(){return this.privAdapter}createSynthesisAdapter(u,h,d){return new t.SpeechSynthesisAdapter(u,h,d,this,this.audioConfig)}createRestSynthesisAdapter(u,h){return new t.SynthesisRestAdapter(h,u)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(o.SpeechSynthesisOutputFormat[this.properties.getProperty(o.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(u,h,d,p,f){try{s.Contracts.throwIfDisposed(this.privDisposed);const v=e.createNoDashGuid();let g;f instanceof o.PushAudioOutputStreamCallback?g=new r.PushAudioOutputStreamImpl(f):f instanceof o.PullAudioOutputStream?g=f:f!==void 0?g=new n.AudioFileWriter(f):g=void 0,this.synthesisRequestQueue.enqueue(new a.SynthesisRequest(v,u,h,m=>{if(this.privSynthesizing=!1,d)try{d(m)}catch(y){p&&p(y)}d=void 0,this.adapterSpeak().catch(()=>{})},m=>{p&&p(m)},g)),this.adapterSpeak().catch(()=>{})}catch(v){if(p)if(v instanceof Error){const g=v;p(g.name+": "+g.message)}else p(v);this.dispose(!0).catch(()=>{})}}async getVoices(u){const h=e.createNoDashGuid(),d=await this.privRestAdapter.getVoicesList(h);if(d.ok&&Array.isArray(d.json)){let p=d.json;return u&&u.length>0&&(p=p.filter(f=>!!f.Locale&&f.Locale.toLowerCase()===u.toLowerCase())),new o.SynthesisVoicesResult(h,p,void 0)}else return new o.SynthesisVoicesResult(h,void 0,`Error: ${d.status}: ${d.statusText}`)}};return Bf.SpeechSynthesizer=l,Bf}var xx={};Object.defineProperty(xx,"__esModule",{value:!0});xx.SynthesisResult=void 0;class UX{constructor(e,n,i,r){this.privResultId=e,this.privReason=n,this.privErrorDetails=i,this.privProperties=r}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}}xx.SynthesisResult=UX;var $f={},F3;function BX(){if(F3)return $f;F3=1,Object.defineProperty($f,"__esModule",{value:!0}),$f.SpeechSynthesisResult=void 0;const t=me();let e=class extends t.SynthesisResult{constructor(i,r,s,o,a,l){super(i,r,o,a),this.privAudioData=s,this.privAudioDuration=l}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}};return $f.SpeechSynthesisResult=e,$f}var Cx={};Object.defineProperty(Cx,"__esModule",{value:!0});Cx.SpeechSynthesisEventArgs=void 0;class $X{constructor(e){this.privResult=e}get result(){return this.privResult}}Cx.SpeechSynthesisEventArgs=$X;var _x={};Object.defineProperty(_x,"__esModule",{value:!0});_x.SpeechSynthesisWordBoundaryEventArgs=void 0;class HX{constructor(e,n,i,r,s,o){this.privAudioOffset=e,this.privDuration=n,this.privText=i,this.privWordLength=r,this.privTextOffset=s,this.privBoundaryType=o}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}}_x.SpeechSynthesisWordBoundaryEventArgs=HX;var wx={};Object.defineProperty(wx,"__esModule",{value:!0});wx.SpeechSynthesisBookmarkEventArgs=void 0;class VX{constructor(e,n){this.privAudioOffset=e,this.privText=n}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}}wx.SpeechSynthesisBookmarkEventArgs=VX;var Ex={};Object.defineProperty(Ex,"__esModule",{value:!0});Ex.SpeechSynthesisVisemeEventArgs=void 0;class jX{constructor(e,n,i){this.privAudioOffset=e,this.privVisemeId=n,this.privAnimation=i}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}}Ex.SpeechSynthesisVisemeEventArgs=jX;var sB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechSynthesisBoundaryType=void 0,function(e){e.Word="WordBoundary",e.Punctuation="PunctuationBoundary",e.Sentence="SentenceBoundary"}(t.SpeechSynthesisBoundaryType||(t.SpeechSynthesisBoundaryType={}))})(sB);var Hf={},z3;function WX(){if(z3)return Hf;z3=1,Object.defineProperty(Hf,"__esModule",{value:!0}),Hf.SynthesisVoicesResult=void 0;const t=me();let e=class extends t.SynthesisResult{constructor(i,r,s){if(Array.isArray(r)){super(i,t.ResultReason.VoicesListRetrieved,void 0,new t.PropertyCollection),this.privVoices=[];for(const o of r)this.privVoices.push(new t.VoiceInfo(o))}else super(i,t.ResultReason.Canceled,s||"Error information unavailable",new t.PropertyCollection)}get voices(){return this.privVoices}};return Hf.SynthesisVoicesResult=e,Hf}var oB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceInfo=t.SynthesisVoiceType=t.SynthesisVoiceGender=void 0;var e;(function(s){s[s.Unknown=0]="Unknown",s[s.Female=1]="Female",s[s.Male=2]="Male",s[s.Neutral=3]="Neutral"})(e=t.SynthesisVoiceGender||(t.SynthesisVoiceGender={}));var n;(function(s){s[s.OnlineNeural=1]="OnlineNeural",s[s.OnlineStandard=2]="OnlineStandard",s[s.OfflineNeural=3]="OfflineNeural",s[s.OfflineStandard=4]="OfflineStandard"})(n=t.SynthesisVoiceType||(t.SynthesisVoiceType={}));const i={[e[e.Neutral]]:e.Neutral,[e[e.Male]]:e.Male,[e[e.Female]]:e.Female};class r{constructor(o){if(this.privStyleList=[],o){if(this.privName=o.Name,this.privLocale=o.Locale,this.privShortName=o.ShortName,this.privLocaleName=o.LocaleName,this.privDisplayName=o.DisplayName,this.privLocalName=o.LocalName,this.privVoiceType=o.VoiceType.endsWith("Standard")?n.OnlineStandard:n.OnlineNeural,this.privGender=i[o.Gender]||e.Unknown,o.StyleList&&Array.isArray(o.StyleList))for(const a of o.StyleList)this.privStyleList.push(a);this.privSampleRateHertz=o.SampleRateHertz,this.privStatus=o.Status,o.ExtendedPropertyMap&&(this.privExtendedPropertyMap=o.ExtendedPropertyMap),this.privWordsPerMinute=o.WordsPerMinute,Array.isArray(o.SecondaryLocaleList)&&(this.privSecondaryLocaleList=[...o.SecondaryLocaleList]),Array.isArray(o.RolePlayList)&&(this.privRolePlayList=[...o.RolePlayList])}}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get sampleRateHertz(){return this.privSampleRateHertz}get status(){return this.privStatus}get extendedPropertyMap(){return this.privExtendedPropertyMap}get wordsPerMinute(){return this.privWordsPerMinute}get secondaryLocaleList(){return this.privSecondaryLocaleList}get rolePlayList(){return this.privRolePlayList}}t.VoiceInfo=r})(oB);var Rx={};Object.defineProperty(Rx,"__esModule",{value:!0});Rx.SpeakerAudioDestination=void 0;const Nc=ht(),GX=Vi,Ur=vc,qX=60*30,U3={[Ur.AudioFormatTag.PCM]:"audio/wav",[Ur.AudioFormatTag.MuLaw]:"audio/x-wav",[Ur.AudioFormatTag.MP3]:"audio/mpeg",[Ur.AudioFormatTag.OGG_OPUS]:"audio/ogg",[Ur.AudioFormatTag.WEBM_OPUS]:"audio/webm; codecs=opus",[Ur.AudioFormatTag.ALaw]:"audio/x-wav",[Ur.AudioFormatTag.FLAC]:"audio/flac",[Ur.AudioFormatTag.AMR_WB]:"audio/amr-wb",[Ur.AudioFormatTag.G722]:"audio/G722"};class XX{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||Nc.createNoDashGuid(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,n,i){this.privAudioBuffer!==void 0?(this.privAudioBuffer.push(e),this.updateSourceBuffer().then(()=>{n&&n()},r=>{i&&i(r)})):this.privAudioOutputStream!==void 0&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength)}close(e,n){if(this.privIsClosed=!0,this.privSourceBuffer!==void 0)this.handleSourceBufferUpdateEnd().then(()=>{e&&e()},i=>{n&&n(i)});else if(this.privAudioOutputStream!==void 0&&typeof window<"u")if((this.privFormat.formatTag===Ur.AudioFormatTag.PCM||this.privFormat.formatTag===Ur.AudioFormatTag.MuLaw||this.privFormat.formatTag===Ur.AudioFormatTag.ALaw)&&this.privFormat.hasHeader===!1)console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else{let i=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(i).then(()=>{i=this.privFormat.addHeader(i);const r=new Blob([i],{type:U3[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(r),this.notifyPlayback().then(()=>{e&&e()},s=>{n&&n(s)})},r=>{n&&n(r)})}else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if(typeof AudioContext<"u"||typeof window<"u"&&typeof window.webkitAudioContext<"u"){this.privFormat=e;const n=U3[this.privFormat.formatTag];n===void 0?console.warn(`Unknown mimeType for format ${Ur.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):typeof MediaSource<"u"&&MediaSource.isTypeSupported(n)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=qX,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(n),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(i=>{Nc.Events.instance.onEvent(new Nc.BackgroundEvent(i))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(i=>{Nc.Events.instance.onEvent(new Nc.BackgroundEvent(i))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(i=>{Nc.Events.instance.onEvent(new Nc.BackgroundEvent(i))})):(console.warn(`Format ${Ur.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new GX.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){var e;return((e=this.privAudio)==null?void 0:e.volume)??-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return this.privAudio!==void 0?this.privAudio.currentTime:-1}pause(){!this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,n){this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.play().then(()=>{e&&e()},i=>{n&&n(i)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}async updateSourceBuffer(){if(this.privAudioBuffer!==void 0&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;const e=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(e)}catch{this.privAudioBuffer.unshift(e),console.log("buffer filled, pausing addition of binaries until space is made");return}await this.notifyPlayback()}else this.canEndStream()&&await this.handleSourceBufferUpdateEnd()}async handleSourceBufferUpdateEnd(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),await this.notifyPlayback())}async notifyPlayback(){!this.privPlaybackStarted&&this.privAudio!==void 0&&(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||await this.privAudio.play())}canEndStream(){return this.isClosed&&this.privSourceBuffer!==void 0&&this.privAudioBuffer.length===0&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&this.privMediaSource.readyState==="open"}sourceBufferAvailable(){return this.privSourceBuffer!==void 0&&!this.privSourceBuffer.updating}}Rx.SpeakerAudioDestination=XX;var Vf={},B3;function KX(){if(B3)return Vf;B3=1,Object.defineProperty(Vf,"__esModule",{value:!0}),Vf.ConversationTranscriptionCanceledEventArgs=void 0;const t=A0();let e=class extends t.CancellationEventArgsBase{};return Vf.ConversationTranscriptionCanceledEventArgs=e,Vf}var jf={},$3;function YX(){if($3)return jf;$3=1,Object.defineProperty(jf,"__esModule",{value:!0}),jf.MeetingTranscriptionCanceledEventArgs=void 0;const t=A0();let e=class extends t.CancellationEventArgsBase{};return jf.MeetingTranscriptionCanceledEventArgs=e,jf}var aB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PronunciationAssessmentGradingSystem=void 0,function(e){e[e.FivePoint=1]="FivePoint",e[e.HundredMark=2]="HundredMark"}(t.PronunciationAssessmentGradingSystem||(t.PronunciationAssessmentGradingSystem={}))})(aB);var lB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PronunciationAssessmentGranularity=void 0,function(e){e[e.Phoneme=1]="Phoneme",e[e.Word=2]="Word",e[e.FullText=3]="FullText"}(t.PronunciationAssessmentGranularity||(t.PronunciationAssessmentGranularity={}))})(lB);var Wf={},H3;function JX(){if(H3)return Wf;H3=1,Object.defineProperty(Wf,"__esModule",{value:!0}),Wf.PronunciationAssessmentConfig=void 0;const t=Ct,e=me();let n=class cB{constructor(r,s=e.PronunciationAssessmentGradingSystem.FivePoint,o=e.PronunciationAssessmentGranularity.Phoneme,a=!1){t.Contracts.throwIfNullOrUndefined(r,"referenceText"),this.privProperties=new e.PropertyCollection,this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_ReferenceText,r),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_GradingSystem,e.PronunciationAssessmentGradingSystem[s]),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_Granularity,e.PronunciationAssessmentGranularity[o]),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,String(a))}static fromJSON(r){t.Contracts.throwIfNullOrUndefined(r,"json");const s=new cB("");return s.privProperties=new e.PropertyCollection,s.properties.setProperty(e.PropertyId.PronunciationAssessment_Json,r),s}toJSON(){return this.updateJson(),this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Params)}applyTo(r){this.updateJson();const s=r.internalData;s.expectContentAssessmentResponse=!!this.privContentAssessmentTopic,s.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(e.PropertyId.PronunciationAssessment_Params),this.privContentAssessmentTopic,s.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(e.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(r){t.Contracts.throwIfNullOrWhitespace(r,"referenceText"),this.properties.setProperty(e.PropertyId.PronunciationAssessment_ReferenceText,r)}set phonemeAlphabet(r){t.Contracts.throwIfNullOrWhitespace(r,"phonemeAlphabet"),this.privPhonemeAlphabet=r}set enableMiscue(r){const s=r?"true":"false";this.properties.setProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,s)}get enableMiscue(){return this.properties.getProperty(e.PropertyId.PronunciationAssessment_EnableMiscue,"false").toLowerCase()==="true"}set nbestPhonemeCount(r){this.privNBestPhonemeCount=r}set enableProsodyAssessment(r){this.privEnableProsodyAssessment=r}enableContentAssessmentWithTopic(r){this.privContentAssessmentTopic=r}get properties(){return this.privProperties}updateJson(){const r=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Json,"{}"),s=JSON.parse(r),o=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_ReferenceText);o&&(s.referenceText=o);const a=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_GradingSystem);a&&(s.gradingSystem=a);const l=this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_Granularity);l&&(s.granularity=l),this.privPhonemeAlphabet&&(s.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(s.nbestPhonemeCount=this.privNBestPhonemeCount),s.enableProsodyAssessment=this.privEnableProsodyAssessment,s.dimension="Comprehensive",this.privProperties.getProperty(e.PropertyId.PronunciationAssessment_EnableMiscue)&&(s.enableMiscue=this.enableMiscue),this.privProperties.setProperty(e.PropertyId.PronunciationAssessment_Params,JSON.stringify(s))}};return Wf.PronunciationAssessmentConfig=n,Wf}var Oc={},V3;function QX(){if(V3)return Oc;V3=1,Object.defineProperty(Oc,"__esModule",{value:!0}),Oc.PronunciationAssessmentResult=Oc.ContentAssessmentResult=void 0;const t=Ct,e=me();class n{constructor(s){this.privPronJson=s}get grammarScore(){return this.privPronJson.ContentAssessment.GrammarScore}get vocabularyScore(){return this.privPronJson.ContentAssessment.VocabularyScore}get topicScore(){return this.privPronJson.ContentAssessment.TopicScore}}Oc.ContentAssessmentResult=n;let i=class uB{constructor(s){const o=JSON.parse(s);t.Contracts.throwIfNullOrUndefined(o.NBest[0],"NBest"),this.privPronJson=o.NBest[0]}static fromResult(s){t.Contracts.throwIfNullOrUndefined(s,"result");const o=s.properties.getProperty(e.PropertyId.SpeechServiceResponse_JsonResult);return t.Contracts.throwIfNullOrUndefined(o,"json"),new uB(o)}get detailResult(){return this.privPronJson}get accuracyScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.AccuracyScore}get pronunciationScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.PronScore}get completenessScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.CompletenessScore}get fluencyScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.FluencyScore}get prosodyScore(){var s;return(s=this.detailResult.PronunciationAssessment)==null?void 0:s.ProsodyScore}get contentAssessmentResult(){if(this.detailResult.ContentAssessment!==void 0)return new n(this.detailResult)}};return Oc.PronunciationAssessmentResult=i,Oc}var Gf={},j3;function ZX(){if(j3)return Gf;j3=1,Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.AvatarConfig=void 0;const t=Ct,e=me();let n=class{constructor(r,s,o){this.privCustomized=!1,t.Contracts.throwIfNullOrWhitespace(r,"character"),this.character=r,this.style=s,o===void 0&&(o=new e.AvatarVideoFormat),this.videoFormat=o}get customized(){return this.privCustomized}set customized(r){this.privCustomized=r}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(r){this.privBackgroundColor=r}get backgroundImage(){return this.privBackgroundImage}set backgroundImage(r){this.privBackgroundImage=r}get remoteIceServers(){return this.privRemoteIceServers}set remoteIceServers(r){this.privRemoteIceServers=r}};return Gf.AvatarConfig=n,Gf}var hB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AvatarEventArgs=t.AvatarEventTypes=void 0,function(n){n.SwitchedToSpeaking="SwitchedToSpeaking",n.SwitchedToIdle="SwitchedToIdle",n.SessionClosed="SessionClosed"}(t.AvatarEventTypes||(t.AvatarEventTypes={}));class e{constructor(i,r){this.privOffset=i,this.privDescription=r}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}}t.AvatarEventArgs=e})(hB);var qf={},Xf={},W3;function dB(){if(W3)return Xf;W3=1,Object.defineProperty(Xf,"__esModule",{value:!0}),Xf.SpeechSynthesisConnectionFactory=void 0;const t=zi(),e=me(),n=No(),i=Ve(),r=Fi,s=Do;let o=class{constructor(){this.synthesisUri="/cognitiveservices/websocket/v1"}create(l,c,u){let h=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,void 0),p=n.ConnectionFactoryBase.getHostSuffix(d),f=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),v=f===void 0?"tts":"voice",g=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+d+"."+v+".speech"+p),m={},y={};c.token!==void 0&&c.token!==""&&(y[c.headerName]=c.token),y[r.HeaderNames.ConnectionId]=u,f!==void 0&&f!==""&&(!h||h.search(s.QueryParameterNames.CustomVoiceDeploymentId)===-1)&&(m[s.QueryParameterNames.CustomVoiceDeploymentId]=f),l.avatarEnabled&&(!h||h.search(s.QueryParameterNames.EnableAvatar)===-1)&&(m[s.QueryParameterNames.EnableAvatar]="true"),h||(h=g+this.synthesisUri),l.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,h);const S=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(h,m,y,new i.WebsocketMessageFormatter,t.ProxyInfo.fromParameters(l.parameters),S,u)}};return Xf.SpeechSynthesisConnectionFactory=o,Xf}var G3;function eK(){if(G3)return qf;G3=1,Object.defineProperty(qf,"__esModule",{value:!0}),qf.AvatarSynthesizer=void 0;const t=dB(),e=Ve(),n=ht(),i=yc,r=me(),s=Ct,o=S2();let a=class extends r.Synthesizer{constructor(c,u){super(c),s.Contracts.throwIfNullOrUndefined(u,"avatarConfig"),this.privConnectionFactory=new t.SpeechSynthesisConnectionFactory,this.privAvatarConfig=u,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(r.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}async startAvatarAsync(c){s.Contracts.throwIfNullOrUndefined(c,"peerConnection"),this.privIceServers=c.getConfiguration().iceServers,s.Contracts.throwIfNullOrUndefined(this.privIceServers,"Ice servers must be set.");const u=new n.Deferred;c.onicegatheringstatechange=()=>{n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering state: "+c.iceGatheringState,n.EventType.Debug)),c.iceGatheringState==="complete"&&(n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering complete.",n.EventType.Info)),u.resolve())},c.onicecandidate=v=>{v.candidate?n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice candidate: "+v.candidate.candidate,n.EventType.Debug)):(n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice candidate: complete",n.EventType.Debug)),u.resolve())},setTimeout(()=>{c.iceGatheringState!=="complete"&&(n.Events.instance.onEvent(new n.PlatformEvent("peer connection: ice gathering timeout.",n.EventType.Warning)),u.resolve())},2e3);const h=await c.createOffer();await c.setLocalDescription(h),await u.promise,n.Events.instance.onEvent(new n.PlatformEvent("peer connection: got local SDP.",n.EventType.Info)),this.privProperties.setProperty(r.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(c.localDescription));const d=await this.speak("",!1);if(d.reason!==r.ResultReason.SynthesizingAudioCompleted)return new r.SynthesisResult(d.resultId,d.reason,d.errorDetails,d.properties);const p=atob(d.properties.getProperty(r.PropertyId.TalkingAvatarService_WebRTC_SDP)),f=new RTCSessionDescription(JSON.parse(p));return await c.setRemoteDescription(f),new r.SynthesisResult(d.resultId,d.reason,void 0,d.properties)}async speakTextAsync(c){const u=await this.speak(c,!1);return new r.SynthesisResult(u.resultId,u.reason,u.errorDetails,u.properties)}async speakSsmlAsync(c){const u=await this.speak(c,!0);return new r.SynthesisResult(u.resultId,u.reason,u.errorDetails,u.properties)}async stopSpeakingAsync(){for(;this.synthesisRequestQueue.length()>0;)(await this.synthesisRequestQueue.dequeue()).err("Synthesis is canceled by user.");return this.privAdapter.stopSpeaking()}async stopAvatarAsync(){return s.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)}async close(){if(!this.privDisposed)return this.dispose(!0)}get iceServers(){return this.privIceServers}createSynthesisAdapter(c,u,h){return new e.AvatarSynthesisAdapter(c,u,h,this,this.privAvatarConfig)}createRestSynthesisAdapter(c,u){}createSynthesizerConfig(c){const u=super.createSynthesizerConfig(c);return u.avatarEnabled=!0,u}async speak(c,u){const h=n.createNoDashGuid(),d=new n.Deferred;return this.synthesisRequestQueue.enqueue(new o.SynthesisRequest(h,c,u,p=>{d.resolve(p),this.privSynthesizing=!1,this.adapterSpeak()},p=>{d.reject(p),this.privSynthesizing=!1})),this.adapterSpeak(),d.promise}};return qf.AvatarSynthesizer=a,qf}var Pd={};Object.defineProperty(Pd,"__esModule",{value:!0});Pd.AvatarVideoFormat=Pd.Coordinate=void 0;class tK{constructor(e,n){this.x=e,this.y=n}}Pd.Coordinate=tK;class nK{constructor(e="H264",n=2e6,i=1920,r=1080){this.codec=e,this.bitrate=n,this.width=i,this.height=r}setCropRange(e,n){this.cropRange={bottomRight:n,topLeft:e}}}Pd.AvatarVideoFormat=nK;var Kf={},q3;function iK(){if(q3)return Kf;q3=1,Object.defineProperty(Kf,"__esModule",{value:!0}),Kf.AvatarWebRTCConnectionResult=void 0;const t=me();let e=class extends t.SynthesisResult{constructor(i,r,s,o,a){super(r,s,o,a),this.privSDPAnswer=i}get SDPAnswer(){return this.privSDPAnswer}};return Kf.AvatarWebRTCConnectionResult=e,Kf}var Yf={},X3;function rK(){if(X3)return Yf;X3=1,Object.defineProperty(Yf,"__esModule",{value:!0}),Yf.Diagnostics=void 0;const t=zi(),e=ht();let n=class{static SetLoggingLevel(r){this.privListener=new t.ConsoleLoggingListener(r),e.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(r){if(typeof window>"u")this.privListener&&(this.privListener.logPath=r);else throw new Error("File system logging not available in browser.")}static set onLogOutput(r){this.privListener&&(this.privListener.logCallback=r)}};return Yf.Diagnostics=n,n.privListener=void 0,Yf}var K3;function me(){return K3||(K3=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=IU();Object.defineProperty(t,"AudioConfig",{enumerable:!0,get:function(){return e.AudioConfig}});var n=vc;Object.defineProperty(t,"AudioStreamFormat",{enumerable:!0,get:function(){return n.AudioStreamFormat}}),Object.defineProperty(t,"AudioFormatTag",{enumerable:!0,get:function(){return n.AudioFormatTag}});var i=RU();Object.defineProperty(t,"AudioInputStream",{enumerable:!0,get:function(){return i.AudioInputStream}}),Object.defineProperty(t,"PullAudioInputStream",{enumerable:!0,get:function(){return i.PullAudioInputStream}}),Object.defineProperty(t,"PushAudioInputStream",{enumerable:!0,get:function(){return i.PushAudioInputStream}});var r=Vi;Object.defineProperty(t,"AudioOutputStream",{enumerable:!0,get:function(){return r.AudioOutputStream}}),Object.defineProperty(t,"PullAudioOutputStream",{enumerable:!0,get:function(){return r.PullAudioOutputStream}}),Object.defineProperty(t,"PushAudioOutputStream",{enumerable:!0,get:function(){return r.PushAudioOutputStream}});var s=MU;Object.defineProperty(t,"CancellationReason",{enumerable:!0,get:function(){return s.CancellationReason}});var o=ix;Object.defineProperty(t,"PullAudioInputStreamCallback",{enumerable:!0,get:function(){return o.PullAudioInputStreamCallback}});var a=rx;Object.defineProperty(t,"PushAudioOutputStreamCallback",{enumerable:!0,get:function(){return a.PushAudioOutputStreamCallback}});var l=sx;Object.defineProperty(t,"KeywordRecognitionModel",{enumerable:!0,get:function(){return l.KeywordRecognitionModel}});var c=ox;Object.defineProperty(t,"SessionEventArgs",{enumerable:!0,get:function(){return c.SessionEventArgs}});var u=Lq();Object.defineProperty(t,"RecognitionEventArgs",{enumerable:!0,get:function(){return u.RecognitionEventArgs}});var h=kU;Object.defineProperty(t,"OutputFormat",{enumerable:!0,get:function(){return h.OutputFormat}});var d=Dq();Object.defineProperty(t,"IntentRecognitionEventArgs",{enumerable:!0,get:function(){return d.IntentRecognitionEventArgs}});var p=ax;Object.defineProperty(t,"RecognitionResult",{enumerable:!0,get:function(){return p.RecognitionResult}});var f=Oq();Object.defineProperty(t,"SpeechRecognitionResult",{enumerable:!0,get:function(){return f.SpeechRecognitionResult}});var v=Fq();Object.defineProperty(t,"IntentRecognitionResult",{enumerable:!0,get:function(){return v.IntentRecognitionResult}});var g=Ad;Object.defineProperty(t,"LanguageUnderstandingModel",{enumerable:!0,get:function(){return g.LanguageUnderstandingModel}});var m=zq();Object.defineProperty(t,"SpeechRecognitionEventArgs",{enumerable:!0,get:function(){return m.SpeechRecognitionEventArgs}}),Object.defineProperty(t,"ConversationTranscriptionEventArgs",{enumerable:!0,get:function(){return m.ConversationTranscriptionEventArgs}}),Object.defineProperty(t,"MeetingTranscriptionEventArgs",{enumerable:!0,get:function(){return m.MeetingTranscriptionEventArgs}});var y=Uq();Object.defineProperty(t,"SpeechRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return y.SpeechRecognitionCanceledEventArgs}});var S=Bq();Object.defineProperty(t,"TranslationRecognitionEventArgs",{enumerable:!0,get:function(){return S.TranslationRecognitionEventArgs}});var x=$q();Object.defineProperty(t,"TranslationSynthesisEventArgs",{enumerable:!0,get:function(){return x.TranslationSynthesisEventArgs}});var w=NU();Object.defineProperty(t,"TranslationRecognitionResult",{enumerable:!0,get:function(){return w.TranslationRecognitionResult}});var C=lx;Object.defineProperty(t,"TranslationSynthesisResult",{enumerable:!0,get:function(){return C.TranslationSynthesisResult}});var E=OU;Object.defineProperty(t,"ResultReason",{enumerable:!0,get:function(){return E.ResultReason}});var T=Vq();Object.defineProperty(t,"SpeechConfig",{enumerable:!0,get:function(){return T.SpeechConfig}}),Object.defineProperty(t,"SpeechConfigImpl",{enumerable:!0,get:function(){return T.SpeechConfigImpl}});var M=jq();Object.defineProperty(t,"SpeechTranslationConfig",{enumerable:!0,get:function(){return M.SpeechTranslationConfig}}),Object.defineProperty(t,"SpeechTranslationConfigImpl",{enumerable:!0,get:function(){return M.SpeechTranslationConfigImpl}});var _=zU();Object.defineProperty(t,"PropertyCollection",{enumerable:!0,get:function(){return _.PropertyCollection}});var R=cx;Object.defineProperty(t,"PropertyId",{enumerable:!0,get:function(){return R.PropertyId}});var L=Wq();Object.defineProperty(t,"Recognizer",{enumerable:!0,get:function(){return L.Recognizer}});var z=Gq();Object.defineProperty(t,"SpeechRecognizer",{enumerable:!0,get:function(){return z.SpeechRecognizer}});var G=qq();Object.defineProperty(t,"IntentRecognizer",{enumerable:!0,get:function(){return G.IntentRecognizer}});var $=$U;Object.defineProperty(t,"VoiceProfileType",{enumerable:!0,get:function(){return $.VoiceProfileType}});var H=Xq();Object.defineProperty(t,"TranslationRecognizer",{enumerable:!0,get:function(){return H.TranslationRecognizer}});var q=Kq();Object.defineProperty(t,"Translations",{enumerable:!0,get:function(){return q.Translations}});var D=WU;Object.defineProperty(t,"NoMatchReason",{enumerable:!0,get:function(){return D.NoMatchReason}});var Z=Yq();Object.defineProperty(t,"NoMatchDetails",{enumerable:!0,get:function(){return Z.NoMatchDetails}});var P=ux;Object.defineProperty(t,"TranslationRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return P.TranslationRecognitionCanceledEventArgs}});var le=Qq();Object.defineProperty(t,"IntentRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return le.IntentRecognitionCanceledEventArgs}});var Se=P0;Object.defineProperty(t,"CancellationDetailsBase",{enumerable:!0,get:function(){return Se.CancellationDetailsBase}});var k=eX();Object.defineProperty(t,"CancellationDetails",{enumerable:!0,get:function(){return k.CancellationDetails}});var J=XU;Object.defineProperty(t,"CancellationErrorCode",{enumerable:!0,get:function(){return J.CancellationErrorCode}});var oe=tX();Object.defineProperty(t,"ConnectionEventArgs",{enumerable:!0,get:function(){return oe.ConnectionEventArgs}});var pe=nX();Object.defineProperty(t,"ServiceEventArgs",{enumerable:!0,get:function(){return pe.ServiceEventArgs}});var ye=VU();Object.defineProperty(t,"Connection",{enumerable:!0,get:function(){return ye.Connection}});var nt=hx;Object.defineProperty(t,"PhraseListGrammar",{enumerable:!0,get:function(){return nt.PhraseListGrammar}});var Je=f2();Object.defineProperty(t,"DialogServiceConfig",{enumerable:!0,get:function(){return Je.DialogServiceConfig}});var _t=iX();Object.defineProperty(t,"BotFrameworkConfig",{enumerable:!0,get:function(){return _t.BotFrameworkConfig}});var at=rX();Object.defineProperty(t,"CustomCommandsConfig",{enumerable:!0,get:function(){return at.CustomCommandsConfig}});var yt=oX();Object.defineProperty(t,"DialogServiceConnector",{enumerable:!0,get:function(){return yt.DialogServiceConnector}});var U=dx;Object.defineProperty(t,"ActivityReceivedEventArgs",{enumerable:!0,get:function(){return U.ActivityReceivedEventArgs}});var di=px;Object.defineProperty(t,"TurnStatusReceivedEventArgs",{enumerable:!0,get:function(){return di.TurnStatusReceivedEventArgs}});var St=KU;Object.defineProperty(t,"ServicePropertyChannel",{enumerable:!0,get:function(){return St.ServicePropertyChannel}});var Mt=YU;Object.defineProperty(t,"ProfanityOption",{enumerable:!0,get:function(){return Mt.ProfanityOption}});var ct=uX();Object.defineProperty(t,"BaseAudioPlayer",{enumerable:!0,get:function(){return ct.BaseAudioPlayer}});var Zt=mx;Object.defineProperty(t,"ConnectionMessageEventArgs",{enumerable:!0,get:function(){return Zt.ConnectionMessageEventArgs}});var dt=HU();Object.defineProperty(t,"ConnectionMessage",{enumerable:!0,get:function(){return dt.ConnectionMessage}});var I=gx;Object.defineProperty(t,"VoiceProfile",{enumerable:!0,get:function(){return I.VoiceProfile}});var b=pX();Object.defineProperty(t,"VoiceProfileEnrollmentResult",{enumerable:!0,get:function(){return b.VoiceProfileEnrollmentResult}}),Object.defineProperty(t,"VoiceProfileEnrollmentCancellationDetails",{enumerable:!0,get:function(){return b.VoiceProfileEnrollmentCancellationDetails}});var Y=fX();Object.defineProperty(t,"VoiceProfileResult",{enumerable:!0,get:function(){return Y.VoiceProfileResult}}),Object.defineProperty(t,"VoiceProfileCancellationDetails",{enumerable:!0,get:function(){return Y.VoiceProfileCancellationDetails}});var ie=mX();Object.defineProperty(t,"VoiceProfilePhraseResult",{enumerable:!0,get:function(){return ie.VoiceProfilePhraseResult}});var de=gX();Object.defineProperty(t,"VoiceProfileClient",{enumerable:!0,get:function(){return de.VoiceProfileClient}});var ae=vX();Object.defineProperty(t,"SpeakerRecognizer",{enumerable:!0,get:function(){return ae.SpeakerRecognizer}});var V=yX();Object.defineProperty(t,"SpeakerIdentificationModel",{enumerable:!0,get:function(){return V.SpeakerIdentificationModel}});var K=SX();Object.defineProperty(t,"SpeakerVerificationModel",{enumerable:!0,get:function(){return K.SpeakerVerificationModel}});var re=xX();Object.defineProperty(t,"AutoDetectSourceLanguageConfig",{enumerable:!0,get:function(){return re.AutoDetectSourceLanguageConfig}});var Ie=vx;Object.defineProperty(t,"AutoDetectSourceLanguageResult",{enumerable:!0,get:function(){return Ie.AutoDetectSourceLanguageResult}});var se=yx;Object.defineProperty(t,"SourceLanguageConfig",{enumerable:!0,get:function(){return se.SourceLanguageConfig}});var xe=_X();Object.defineProperty(t,"SpeakerRecognitionResult",{enumerable:!0,get:function(){return xe.SpeakerRecognitionResult}}),Object.defineProperty(t,"SpeakerRecognitionResultType",{enumerable:!0,get:function(){return xe.SpeakerRecognitionResultType}}),Object.defineProperty(t,"SpeakerRecognitionCancellationDetails",{enumerable:!0,get:function(){return xe.SpeakerRecognitionCancellationDetails}});var Te=y2();Object.defineProperty(t,"Conversation",{enumerable:!0,get:function(){return Te.Conversation}}),Object.defineProperty(t,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return Te.ConversationExpirationEventArgs}}),Object.defineProperty(t,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return Te.ConversationParticipantsChangedEventArgs}}),Object.defineProperty(t,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return Te.ConversationTranslationCanceledEventArgs}}),Object.defineProperty(t,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return Te.ConversationTranslationEventArgs}}),Object.defineProperty(t,"ConversationTranslationResult",{enumerable:!0,get:function(){return Te.ConversationTranslationResult}}),Object.defineProperty(t,"ConversationTranslator",{enumerable:!0,get:function(){return Te.ConversationTranslator}}),Object.defineProperty(t,"ConversationTranscriber",{enumerable:!0,get:function(){return Te.ConversationTranscriber}}),Object.defineProperty(t,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return Te.ConversationTranscriptionResult}}),Object.defineProperty(t,"Meeting",{enumerable:!0,get:function(){return Te.Meeting}}),Object.defineProperty(t,"MeetingTranscriber",{enumerable:!0,get:function(){return Te.MeetingTranscriber}}),Object.defineProperty(t,"Participant",{enumerable:!0,get:function(){return Te.Participant}}),Object.defineProperty(t,"ParticipantChangedReason",{enumerable:!0,get:function(){return Te.ParticipantChangedReason}}),Object.defineProperty(t,"User",{enumerable:!0,get:function(){return Te.User}});var Qe=S2();Object.defineProperty(t,"Synthesizer",{enumerable:!0,get:function(){return Qe.Synthesizer}});var Ae=u2;Object.defineProperty(t,"SpeechSynthesisOutputFormat",{enumerable:!0,get:function(){return Ae.SpeechSynthesisOutputFormat}});var wt=zX();Object.defineProperty(t,"SpeechSynthesizer",{enumerable:!0,get:function(){return wt.SpeechSynthesizer}});var Ze=xx;Object.defineProperty(t,"SynthesisResult",{enumerable:!0,get:function(){return Ze.SynthesisResult}});var Dt=BX();Object.defineProperty(t,"SpeechSynthesisResult",{enumerable:!0,get:function(){return Dt.SpeechSynthesisResult}});var B=Cx;Object.defineProperty(t,"SpeechSynthesisEventArgs",{enumerable:!0,get:function(){return B.SpeechSynthesisEventArgs}});var ke=_x;Object.defineProperty(t,"SpeechSynthesisWordBoundaryEventArgs",{enumerable:!0,get:function(){return ke.SpeechSynthesisWordBoundaryEventArgs}});var ne=wx;Object.defineProperty(t,"SpeechSynthesisBookmarkEventArgs",{enumerable:!0,get:function(){return ne.SpeechSynthesisBookmarkEventArgs}});var ce=Ex;Object.defineProperty(t,"SpeechSynthesisVisemeEventArgs",{enumerable:!0,get:function(){return ce.SpeechSynthesisVisemeEventArgs}});var Me=sB;Object.defineProperty(t,"SpeechSynthesisBoundaryType",{enumerable:!0,get:function(){return Me.SpeechSynthesisBoundaryType}});var Le=WX();Object.defineProperty(t,"SynthesisVoicesResult",{enumerable:!0,get:function(){return Le.SynthesisVoicesResult}});var Ft=oB;Object.defineProperty(t,"VoiceInfo",{enumerable:!0,get:function(){return Ft.VoiceInfo}});var bn=Rx;Object.defineProperty(t,"SpeakerAudioDestination",{enumerable:!0,get:function(){return bn.SpeakerAudioDestination}});var Qn=KX();Object.defineProperty(t,"ConversationTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Qn.ConversationTranscriptionCanceledEventArgs}});var Nt=YX();Object.defineProperty(t,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Nt.MeetingTranscriptionCanceledEventArgs}});var Ti=aB;Object.defineProperty(t,"PronunciationAssessmentGradingSystem",{enumerable:!0,get:function(){return Ti.PronunciationAssessmentGradingSystem}});var Zr=lB;Object.defineProperty(t,"PronunciationAssessmentGranularity",{enumerable:!0,get:function(){return Zr.PronunciationAssessmentGranularity}});var O=JX();Object.defineProperty(t,"PronunciationAssessmentConfig",{enumerable:!0,get:function(){return O.PronunciationAssessmentConfig}});var W=QX();Object.defineProperty(t,"PronunciationAssessmentResult",{enumerable:!0,get:function(){return W.PronunciationAssessmentResult}});var te=g2;Object.defineProperty(t,"LanguageIdMode",{enumerable:!0,get:function(){return te.LanguageIdMode}});var ue=ZX();Object.defineProperty(t,"AvatarConfig",{enumerable:!0,get:function(){return ue.AvatarConfig}});var De=hB;Object.defineProperty(t,"AvatarEventArgs",{enumerable:!0,get:function(){return De.AvatarEventArgs}});var et=eK();Object.defineProperty(t,"AvatarSynthesizer",{enumerable:!0,get:function(){return et.AvatarSynthesizer}});var ut=Pd;Object.defineProperty(t,"AvatarVideoFormat",{enumerable:!0,get:function(){return ut.AvatarVideoFormat}}),Object.defineProperty(t,"Coordinate",{enumerable:!0,get:function(){return ut.Coordinate}});var Fe=iK();Object.defineProperty(t,"AvatarWebRTCConnectionResult",{enumerable:!0,get:function(){return Fe.AvatarWebRTCConnectionResult}});var Oe=rK();Object.defineProperty(t,"Diagnostics",{enumerable:!0,get:function(){return Oe.Diagnostics}});var Ne=l2;Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return Ne.LogLevel}})}(M_)),M_}var Y3;function sK(){if(Y3)return Xp;Y3=1,Object.defineProperty(Xp,"__esModule",{value:!0}),Xp.ProxyInfo=void 0;const t=me();let e=class pB{constructor(i,r,s,o){this.privProxyHostName=i,this.privProxyPort=r,this.privProxyUserName=s,this.privProxyPassword=o}static fromParameters(i){return new pB(i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyPort),10),i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyUserName),i.getProperty(t.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(i){return this.fromParameters(i.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}};return Xp.ProxyInfo=e,Xp}var fB={};const oK=new Set(["json","buffer","string"]);var aK=t=>(...e)=>{const n=new Set;let i,r,s,o="";return e.forEach(a=>{if(typeof a=="string")if(a.toUpperCase()===a)if(i){const l=`Can't set method to ${a}, already set to ${i}.`;throw new Error(l)}else i=a;else if(a.startsWith("http:")||a.startsWith("https:"))o=a;else if(oK.has(a))r=a;else throw new Error(`Unknown encoding, ${a}`);else if(typeof a=="number")n.add(a);else if(typeof a=="object")if(Array.isArray(a)||a instanceof Set)a.forEach(l=>n.add(l));else{if(s)throw new Error("Cannot set headers twice.");s=a}else throw new Error(`Unknown type: ${typeof a}`)}),i||(i="GET"),n.size===0&&n.add(200),t(n,i,r,s,o)};const lK=aK;class x2 extends Error{constructor(e,...n){super(...n),Error.captureStackTrace&&Error.captureStackTrace(this,x2),this.name="StatusError",this.message=e.statusMessage,this.statusCode=e.status,this.res=e,this.json=e.json.bind(e),this.text=e.text.bind(e),this.arrayBuffer=e.arrayBuffer.bind(e);let i;Object.defineProperty(this,"responseBody",{get:()=>(i||(i=this.arrayBuffer()),i)}),this.headers={};for(const[s,o]of e.headers.entries())this.headers[s.toLowerCase()]=o}}const cK=(t,e,n,i,r)=>async(s,o,a={})=>{s=r+(s||"");let l=new URL(s);if(i||(i={}),l.username&&(i.Authorization="Basic "+btoa(l.username+":"+l.password),l=new URL(l.protocol+"//"+l.host+l.pathname+l.search)),l.protocol!=="https:"&&l.protocol!=="http:")throw new Error(`Unknown protocol, ${l.protocol}`);if(o&&!(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="string"))if(typeof o=="object")o=JSON.stringify(o),i["Content-Type"]="application/json";else throw new Error("Unknown body type.");a=new Headers({...i||{},...a});const c=await fetch(l,{method:e,headers:a,body:o});if(c.statusCode=c.status,!t.has(c.status))throw new x2(c);return n==="json"?c.json():n==="buffer"?c.arrayBuffer():n==="string"?c.text():c};var uK=lK(cK);(function(t){var e=It&&It.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0}),t.RestMessageAdapter=t.RestRequestType=void 0;const n=e(uK),i=ht();var r;(function(o){o.Get="GET",o.Post="POST",o.Delete="DELETE",o.File="file"})(r=t.RestRequestType||(t.RestRequestType={}));class s{constructor(a){if(!a)throw new i.ArgumentNullError("configParams");this.privHeaders=a.headers,this.privIgnoreCache=a.ignoreCache}static extractHeaderValue(a,l){let c="";try{const u=l.trim().split(/[\r\n]+/),h={};u.forEach(d=>{const p=d.split(": "),f=p.shift().toLowerCase(),v=p.join(": ");h[f]=v}),c=h[a.toLowerCase()]}catch{}return c}set options(a){this.privHeaders=a.headers,this.privIgnoreCache=a.ignoreCache}setHeaders(a,l){this.privHeaders[a]=l}request(a,l,c={},u=null){const h=new i.Deferred,d=a===r.File?"POST":a,p=(v,g={})=>{const m=v;return{data:JSON.stringify(g),headers:JSON.stringify(v.headers),json:g,ok:v.statusCode>=200&&v.statusCode<300,status:v.statusCode,statusText:g.error?g.error.message:m.statusText?m.statusText:m.statusMessage}},f=v=>{const g=n.default(l,d,this.privHeaders,200,201,202,204,400,401,402,403,404),m=this.queryParams(c)===""?"":`?${this.queryParams(c)}`;g(m,v).then(async y=>{if(a===r.Delete||y.statusCode===204)h.resolve(p(y));else try{const S=await y.json();h.resolve(p(y,S))}catch{h.resolve(p(y))}}).catch(y=>{h.reject(y)})};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),a===r.Post&&u&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),f(u),h.promise}queryParams(a={}){return Object.keys(a).map(l=>encodeURIComponent(l)+"="+encodeURIComponent(a[l])).join("&")}}t.RestMessageAdapter=s})(fB);var M0={};Object.defineProperty(M0,"__esModule",{value:!0});M0.RestConfigBase=void 0;class ql{static get requestOptions(){return ql.privDefaultRequestOptions}static get configParams(){return ql.privDefaultParams}static get restErrors(){return ql.privRestErrors}}M0.RestConfigBase=ql;ql.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4};ql.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."};ql.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"};var J3;function zi(){return J3||(J3=1,function(t){var e=It&&It.__createBinding||(Object.create?function(i,r,s,o){o===void 0&&(o=s),Object.defineProperty(i,o,{enumerable:!0,get:function(){return r[s]}})}:function(i,r,s,o){o===void 0&&(o=s),i[o]=r[s]}),n=It&&It.__exportStar||function(i,r){for(var s in i)s!=="default"&&!r.hasOwnProperty(s)&&e(r,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(ZS,t),n(wU,t),n(aq(),t),n(lq(),t),n(ex,t),n(tx,t),n(T0,t),n(nx,t),n(sK(),t),n(fB,t),n(M0,t)}(A_)),A_}var Q3;function hK(){if(Q3)return Wp;Q3=1,Object.defineProperty(Wp,"__esModule",{value:!0}),Wp.IntentConnectionFactory=void 0;const t=zi(),e=me(),n=No(),i=Ve(),r=Fi;let s=class extends n.ConnectionFactoryBase{create(a,l,c){let u=a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint);if(!u){const f=a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_IntentRegion),v=n.ConnectionFactoryBase.getHostSuffix(f);u=a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+f+".sr.speech"+v)+"/speech/recognition/interactive/cognitiveservices/v1"}const h={format:"simple",language:a.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(a,h,u);const d={};l.token!==void 0&&l.token!==""&&(d[l.headerName]=l.token),d[r.HeaderNames.ConnectionId]=c,a.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,u);const p=a.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(u,h,d,new i.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(a),p,c)}getSpeechRegionFromIntentRegion(a){switch(a){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return a}}};return Wp.IntentConnectionFactory=s,Wp}var Fc={},Z3;function dK(){if(Z3)return Fc;Z3=1,Object.defineProperty(Fc,"__esModule",{value:!0}),Fc.VoiceProfileConnectionFactory=Fc.SpeakerRecognitionConnectionFactory=void 0;const t=zi(),e=me(),n=No(),i=Ve(),r=Fi;class s extends n.ConnectionFactoryBase{create(c,u,h,d){let p=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint);if(!p){const m=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region),y=n.ConnectionFactoryBase.getHostSuffix(m),S=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,`wss://${m}.spr-frontend.speech${y}`),x=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_SpeakerIdMode,"TextIndependentIdentification");p=`${S}/speaker/ws/${this.scenarioToPath(x)}/${h}`}const f={format:"simple",language:c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(c,f,p);const v={};u.token!==void 0&&u.token!==""&&(v[u.headerName]=u.token),v[r.HeaderNames.ConnectionId]=d,v[r.HeaderNames.SpIDAuthKey]=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Key),c.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,p);const g=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(p,f,v,new i.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),g,d)}scenarioToPath(c){switch(c){case"TextIndependentVerification":case"2":return"verification/text-independent";case"TextDependentVerification":case"1":return"verification/text-dependent";default:return"identification/text-independent"}}}let o=class extends s{create(c,u,h){return super.create(c,u,"recognition",h)}};Fc.SpeakerRecognitionConnectionFactory=o;class a extends s{create(c,u,h){return super.create(c,u,"profile",h)}}return Fc.VoiceProfileConnectionFactory=a,Fc}var Tx={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecognitionEndedEvent=t.RecognitionCompletionStatus=t.RecognitionStartedEvent=t.ConnectingToServiceEvent=t.ListeningStartedEvent=t.RecognitionTriggeredEvent=t.SpeechRecognitionEvent=void 0;const e=ht();class n extends e.PlatformEvent{constructor(u,h,d,p=e.EventType.Info){super(u,p),this.privRequestId=h,this.privSessionId=d}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}t.SpeechRecognitionEvent=n;class i extends n{constructor(u,h,d,p){super("RecognitionTriggeredEvent",u,h),this.privAudioSourceId=d,this.privAudioNodeId=p}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}t.RecognitionTriggeredEvent=i;class r extends n{constructor(u,h,d,p){super("ListeningStartedEvent",u,h),this.privAudioSourceId=d,this.privAudioNodeId=p}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}t.ListeningStartedEvent=r;class s extends n{constructor(u,h,d){super("ConnectingToServiceEvent",u,d),this.privAuthFetchEventid=h}get authFetchEventid(){return this.privAuthFetchEventid}}t.ConnectingToServiceEvent=s;class o extends n{constructor(u,h,d,p,f){super("RecognitionStartedEvent",u,f),this.privAudioSourceId=h,this.privAudioNodeId=d,this.privAuthFetchEventId=p}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}t.RecognitionStartedEvent=o;var a;(function(c){c[c.Success=0]="Success",c[c.AudioSourceError=1]="AudioSourceError",c[c.AudioSourceTimeout=2]="AudioSourceTimeout",c[c.AuthTokenFetchError=3]="AuthTokenFetchError",c[c.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",c[c.UnAuthorized=5]="UnAuthorized",c[c.ConnectTimeout=6]="ConnectTimeout",c[c.ConnectError=7]="ConnectError",c[c.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",c[c.UnknownError=9]="UnknownError"})(a=t.RecognitionCompletionStatus||(t.RecognitionCompletionStatus={}));class l extends n{constructor(u,h,d,p,f,v,g,m){super("RecognitionEndedEvent",u,f,g===a.Success?e.EventType.Info:e.EventType.Error),this.privAudioSourceId=h,this.privAudioNodeId=d,this.privAuthFetchEventId=p,this.privStatus=g,this.privError=m,this.privServiceTag=v}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}}t.RecognitionEndedEvent=l})(Tx);var Jf={},tl={};Object.defineProperty(tl,"__esModule",{value:!0});tl.SpeechConnectionMessage=void 0;const O_=ht(),xa=Fi;class C2 extends O_.ConnectionMessage{constructor(e,n,i,r,s,o,a,l){if(!n)throw new O_.ArgumentNullError("path");if(!i)throw new O_.ArgumentNullError("requestId");const c={};if(c[xa.HeaderNames.Path]=n,c[xa.HeaderNames.RequestId]=i,c[xa.HeaderNames.RequestTimestamp]=new Date().toISOString(),r&&(c[xa.HeaderNames.ContentType]=r),o&&(c[xa.HeaderNames.RequestStreamId]=o),a)for(const u in a)u&&(c[u]=a[u]);l?super(e,s,c,l):super(e,s,c),this.privPath=n,this.privRequestId=i,this.privContentType=r,this.privStreamId=o,this.privAdditionalHeaders=a}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(e){let n=null,i=null,r=null,s=null;const o={};if(e.headers)for(const a in e.headers)a&&(a.toLowerCase()===xa.HeaderNames.Path.toLowerCase()?n=e.headers[a]:a.toLowerCase()===xa.HeaderNames.RequestId.toLowerCase()?i=e.headers[a]:a.toLowerCase()===xa.HeaderNames.ContentType.toLowerCase()?r=e.headers[a]:a.toLowerCase()===xa.HeaderNames.RequestStreamId.toLowerCase()?s=e.headers[a]:o[a]=e.headers[a]);return new C2(e.messageType,n,i,r,e.body,s,o,e.id)}}tl.SpeechConnectionMessage=C2;var ek;function pK(){if(ek)return Jf;ek=1,Object.defineProperty(Jf,"__esModule",{value:!0}),Jf.ServiceRecognizerBase=void 0;const t=zi(),e=ht(),n=me(),i=Ve(),r=tl;let s=class Qm{constructor(a,l,c,u,h){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.privExpectContentAssessmentResponse=!1,this.recognizeOverride=void 0,this.recognizeSpeaker=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!a)throw new e.ArgumentNullError("authentication");if(!l)throw new e.ArgumentNullError("connectionFactory");if(!c)throw new e.ArgumentNullError("audioSource");if(!u)throw new e.ArgumentNullError("recognizerConfig");this.privEnableSpeakerId=u.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=a,this.privConnectionFactory=l,this.privAudioSource=c,this.privRecognizerConfig=u,this.privIsDisposed=!1,this.privRecognizer=h,this.privRequestSession=new i.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new e.EventSource,this.privServiceEvents=new e.EventSource,this.privDynamicGrammar=new i.DynamicGrammarBuilder,this.privSpeechContext=new i.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new i.AgentConfig,this.privRecognizerConfig.parameters.getProperty(n.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?this.privSetTimeout=e.Timeout.setTimeout:(typeof window<"u"&&(this.privSetTimeout=window.setTimeout.bind(window)),typeof globalThis<"u"&&(this.privSetTimeout=globalThis.setTimeout.bind(globalThis))),this.connectionEvents.attach(p=>{if(p.name==="ConnectionClosedEvent"){const f=p;(f.statusCode===1003||f.statusCode===1007||f.statusCode===1002||f.statusCode===4e3||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(n.CancellationReason.Error,f.statusCode===1007?n.CancellationErrorCode.BadRequestParameters:n.CancellationErrorCode.ConnectionFailure,`${f.reason} websocket error code: ${f.statusCode}`)}}),this.privEnableSpeakerId&&(this.privDiarizationSessionId=e.createNoDashGuid()),this.setLanguageIdJson(),this.setOutputDetailLevelJson()}setTranslationJson(){const a=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(a!==void 0){const l=a.split(","),c=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),u=c!==void 0?"Synthesize":"None";if(this.privSpeechContext.setSection("translation",{onSuccess:{action:u},output:{interimResults:{mode:"Always"}},targetLanguages:l}),c!==void 0){const h={};for(const d of l)h[d]=c;this.privSpeechContext.setSection("synthesis",{defaultVoices:h})}}}setSpeechSegmentationTimeoutJson(){const a=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0);if(a!==void 0){const l=this.recognitionMode===i.RecognitionMode.Conversation?"CONVERSATION":this.recognitionMode===i.RecognitionMode.Dictation?"DICTATION":"INTERACTIVE",c=parseInt(a,10),u=this.privSpeechContext.getSection("phraseDetection");u.mode=l,u[l]={segmentation:{mode:"Custom",segmentationSilenceTimeoutMs:c}},this.privSpeechContext.setSection("phraseDetection",u)}}setLanguageIdJson(){const a=this.privSpeechContext.getSection("phraseDetection");if(this.privRecognizerConfig.autoDetectSourceLanguages!==void 0){const c=this.privRecognizerConfig.autoDetectSourceLanguages.split(",");let u;this.privRecognizerConfig.languageIdMode==="Continuous"?u="DetectContinuous":u="DetectAtAudioStart",this.privSpeechContext.setSection("languageId",{Priority:"PrioritizeLatency",languages:c,mode:u,onSuccess:{action:"Recognize"},onUnknown:{action:"None"}}),this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"Auto"},phraseResults:{resultType:"Always"}});const h=this.privRecognizerConfig.sourceLanguageModels;h!==void 0&&(a.customModels=h,a.onInterim={action:"None"},a.onSuccess={action:"None"})}this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0&&(a.onInterim={action:"Translate"},a.onSuccess={action:"Translate"},this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"None"},phraseResults:{resultType:"None"}})),this.privSpeechContext.setSection("phraseDetection",a)}setOutputDetailLevelJson(){this.privEnableSpeakerId&&(this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true"?this.privSpeechContext.setWordLevelTimings():this.privRecognizerConfig.parameters.getProperty(i.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple]).toLowerCase()===n.OutputFormat[n.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat())}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(a){this.privRecognizerConfig.parameters.setProperty(n.PropertyId.ConversationTranslator_Token,a)}set voiceProfileType(a){this.privRecognizerConfig.parameters.setProperty(n.PropertyId.SpeechServiceConnection_SpeakerIdMode,a)}set authentication(a){this.privAuthentication=a}isDisposed(){return this.privIsDisposed}async dispose(a){if(this.privIsDisposed=!0,this.privConnectionConfigurationPromise!==void 0)try{await(await this.privConnectionConfigurationPromise).dispose(a)}catch{return}}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}async recognize(a,l,c){if(this.recognizeOverride!==void 0){await this.recognizeOverride(a,l,c);return}this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=a,this.setSpeechSegmentationTimeoutJson(),this.setTranslationJson(),this.privSuccessCallback=l,this.privErrorCallback=c,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);const u=this.connectImpl();let h;try{const f=await this.audioSource.attach(this.privRequestSession.audioNodeId),v=await this.audioSource.format,g=await this.audioSource.deviceInfo;this.privIsLiveAudio=g.type&&g.type===i.type.Microphones,h=new t.ReplayableAudioNode(f,v.avgBytesPerSec),await this.privRequestSession.onAudioSourceAttachCompleted(h,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:g}}catch(f){throw await this.privRequestSession.onStopRecognizing(),f}try{await u}catch(f){await this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,f);return}const d=new n.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,d),this.receiveMessage(),this.sendAudio(h).catch(async f=>{await this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,f)})}async stopRecognizing(){if(this.privRequestSession.isRecognizing)try{await this.audioSource.turnOff(),await this.sendFinalAudio(),await this.privRequestSession.onStopRecognizing(),await this.privRequestSession.turnCompletionPromise}finally{await this.privRequestSession.dispose()}}async connect(){return await this.connectImpl(),Promise.resolve()}connectAsync(a,l){this.connectImpl().then(()=>{try{a&&a()}catch(c){l&&l(c)}},c=>{try{l&&l(c)}catch{}})}async disconnect(){if(await this.cancelRecognitionLocal(n.CancellationReason.Error,n.CancellationErrorCode.NoError,"Disconnecting"),this.disconnectOverride!==void 0&&await this.disconnectOverride(),this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose()}catch{}this.privConnectionPromise=void 0}sendMessage(a){}async sendNetworkMessage(a,l){const c=typeof l=="string"?e.MessageType.Text:e.MessageType.Binary,u=typeof l=="string"?"application/json":"";return(await this.fetchConnection()).send(new r.SpeechConnectionMessage(c,a,this.privRequestSession.requestId,u,l))}set activityTemplate(a){this.privActivityTemplate=a}get activityTemplate(){return this.privActivityTemplate}set expectContentAssessmentResponse(a){this.privExpectContentAssessmentResponse=a}async sendTelemetryData(){const a=this.privRequestSession.getTelemetry();if(Qm.telemetryDataEnabled!==!0||this.privIsDisposed||a===null)return;if(Qm.telemetryData)try{Qm.telemetryData(a)}catch{}await(await this.fetchConnection()).send(new r.SpeechConnectionMessage(e.MessageType.Text,"telemetry",this.privRequestSession.requestId,"application/json",a))}async cancelRecognitionLocal(a,l,c){this.privRequestSession.isRecognizing&&(await this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,a,l,c))}async receiveMessage(){try{if(this.privIsDisposed)return;let a=await this.fetchConnection();const l=await a.read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(!l)return this.receiveMessage();this.privServiceHasSentMessage=!0;const c=r.SpeechConnectionMessage.fromConnectionMessage(l);if(c.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(c.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const u=i.SpeechDetected.fromJSON(c.textBody),h=new n.RecognitionEventArgs(u.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,h);break;case"speech.enddetected":let d;c.textBody.length>0?d=c.textBody:d="{ Offset: 0 }";const p=i.SpeechDetected.fromJSON(d),f=new n.RecognitionEventArgs(p.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,f);break;case"turn.end":await this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,await this.cancelRecognitionLocal(n.CancellationReason.EndOfStream,n.CancellationErrorCode.NoError,void 0));const v=new n.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing){this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,v);return}else a=await this.fetchConnection(),await this.sendPrePayloadJSON(a);break;default:await this.processTypeSpecificMessages(c)||this.privServiceEvents&&this.serviceEvents.onEvent(new e.ServiceEvent(c.path.toLowerCase(),c.textBody))}return this.receiveMessage()}catch{return null}}updateSpeakerDiarizationAudioOffset(){const l=this.privRequestSession.recognitionBytesSent/this.privAverageBytesPerMs;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(l)}sendSpeechContext(a,l){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();const c=this.speechContext.toJSON();if(l&&this.privRequestSession.onSpeechContext(),c)return a.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speech.context",this.privRequestSession.requestId,"application/json",c))}noOp(){}async sendPrePayloadJSON(a,l=!0){if(this.sendPrePayloadJSONOverride!==void 0)return this.sendPrePayloadJSONOverride(a);await this.sendSpeechContext(a,l),await this.sendWaveHeader(a)}async sendWaveHeader(a){const l=await this.audioSource.format;return a.send(new r.SpeechConnectionMessage(e.MessageType.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",l.header))}connectImpl(){return this.privConnectionPromise!==void 0?this.privConnectionPromise.then(a=>a.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl())):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),this.postConnectImplOverride!==void 0?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(a,l,c){if(l.onSpeechContext(),Qm.telemetryDataEnabled!==!0){const h={context:{system:JSON.parse(c).context.system}};c=JSON.stringify(h)}if(this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()==="true"){const u=JSON.parse(c);u.context.DisableReferenceChannel="True",u.context.MicSpec="1_0_0",c=JSON.stringify(u)}if(c)return a.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speech.config",l.requestId,"application/json",c))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(a=>a.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async sendAudio(a){const l=await this.audioSource.format;this.privAverageBytesPerMs=l.avgBytesPerSec/1e3;let c=Date.now();const u=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),h=l.avgBytesPerSec/1e3*parseInt(u,10),d=this.privRequestSession.recogNumber,p=async()=>{if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===d){const f=await this.fetchConnection(),v=await a.read();if(this.privRequestSession.isSpeechEnded)return;let g,m;if(!v||v.isEnd?(g=null,m=0):(g=v.buffer,this.privRequestSession.onAudioSent(g.byteLength),h>=this.privRequestSession.bytesSent?m=0:m=Math.max(0,c-Date.now())),m!==0&&await this.delay(m),g!==null&&(c=Date.now()+g.byteLength*1e3/(l.avgBytesPerSec*2)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===d)if(f.send(new r.SpeechConnectionMessage(e.MessageType.Binary,"audio",this.privRequestSession.requestId,null,g)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),v!=null&&v.isEnd)this.privIsLiveAudio||this.privRequestSession.onSpeechEnded();else return p()}};return p()}async retryableConnect(){let a=!1;this.privAuthFetchEventId=e.createNoDashGuid();const l=this.privRequestSession.sessionId;this.privConnectionId=l!==void 0?l:e.createNoDashGuid(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let c=0,u="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){const d=await(a?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId));await this.privRequestSession.onAuthCompleted(!1);const p=this.privConnectionFactory.create(this.privRecognizerConfig,d,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(p.events),p.events.attach(v=>{this.connectionEvents.onEvent(v)});const f=await p.open();if(f.statusCode===200)return await this.privRequestSession.onConnectionEstablishCompleted(f.statusCode),Promise.resolve(p);f.statusCode===1006&&(a=!0),c=f.statusCode,u=f.reason,this.privRequestSession.onRetryConnection()}return await this.privRequestSession.onConnectionEstablishCompleted(c,u),Promise.reject(`Unable to contact server. StatusCode: ${c}, ${this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${u}`)}delay(a){return new Promise(l=>this.privSetTimeout(l,a))}writeBufferToConsole(a){let l="Buffer Size: ";if(a===null)l+="null";else{const c=new Uint8Array(a);l+=`${a.byteLength}\r
`;for(let u=0;u<a.byteLength;u++)l+=c[u].toString(16).padStart(2,"0")+" ",(u+1)%16===0&&(console.info(l),l="")}console.info(l)}async sendFinalAudio(){await(await this.fetchConnection()).send(new r.SpeechConnectionMessage(e.MessageType.Binary,"audio",this.privRequestSession.requestId,null,null))}async configureConnection(){const a=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(a):(await this.sendSpeechServiceConfig(a,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendPrePayloadJSON(a,!1),a)}};return Jf.ServiceRecognizerBase=s,s.telemetryDataEnabled=!0,Jf}var Qf={},tk;function fK(){if(tk)return Qf;tk=1,Object.defineProperty(Qf,"__esModule",{value:!0}),Qf.ConversationServiceRecognizer=void 0;const t=me(),e=Ve();let n=class extends e.ServiceRecognizerBase{constructor(r,s,o,a,l){super(r,s,o,a,l),this.handleSpeechPhraseMessage=async c=>this.handleSpeechPhrase(c),this.handleSpeechHypothesisMessage=c=>this.handleSpeechHypothesis(c)}processTypeSpecificMessages(r){}handleRecognizedCallback(r,s,o){}handleRecognizingCallback(r,s,o){}async processSpeechMessages(r){let s=!1;switch(r.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(r.textBody),s=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&await this.handleSpeechPhraseMessage(r.textBody),s=!0;break}return s}cancelRecognition(r,s,o,a,l){}async handleSpeechPhrase(r){const s=e.SimpleSpeechPhrase.fromJSON(r),o=e.EnumTranslation.implTranslateRecognitionResult(s.RecognitionStatus);let a;const l=new t.PropertyCollection;l.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r);const c=s.Offset+this.privRequestSession.currentTurnAudioOffset;let u=c;if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+s.Offset+s.Duration),t.ResultReason.Canceled===o){const h=e.EnumTranslation.implTranslateCancelResult(s.RecognitionStatus),d=e.EnumTranslation.implTranslateCancelErrorCode(s.RecognitionStatus);await this.cancelRecognitionLocal(h,d,e.EnumTranslation.implTranslateErrorDetails(d))}else if(!(this.privRequestSession.isSpeechEnded&&o===t.ResultReason.NoMatch&&s.RecognitionStatus!==e.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(e.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])a=new t.SpeechRecognitionResult(this.privRequestSession.requestId,o,s.DisplayText,s.Duration,c,s.Language,s.LanguageDetectionConfidence,s.SpeakerId,void 0,r,l);else{const h=e.DetailedSpeechPhrase.fromJSON(r),d=h.Offset+this.privRequestSession.currentTurnAudioOffset,p=h.getJsonWithCorrectedOffsets(d);a=new t.SpeechRecognitionResult(this.privRequestSession.requestId,o,h.Text,h.Duration,d,h.Language,h.LanguageDetectionConfidence,h.SpeakerId,void 0,p,l),u=a.offset}this.handleRecognizedCallback(a,u,this.privRequestSession.sessionId)}}handleSpeechHypothesis(r){const s=e.SpeechHypothesis.fromJSON(r),o=s.Offset+this.privRequestSession.currentTurnAudioOffset,a=new t.PropertyCollection;a.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r);const l=new t.SpeechRecognitionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,s.Text,s.Duration,o,s.Language,s.LanguageDetectionConfidence,s.SpeakerId,void 0,r,a);this.privRequestSession.onHypothesis(o),this.handleRecognizingCallback(l,s.Duration,this.privRequestSession.sessionId)}};return Qf.ConversationServiceRecognizer=n,Qf}var F_={},nk;function mK(){return nk||(nk=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerConfig=t.SpeechResultFormat=t.RecognitionMode=void 0;const e=me(),n=Ve();var i;(function(s){s[s.Interactive=0]="Interactive",s[s.Conversation=1]="Conversation",s[s.Dictation=2]="Dictation"})(i=t.RecognitionMode||(t.RecognitionMode={})),function(s){s[s.Simple=0]="Simple",s[s.Detailed=1]="Detailed"}(t.SpeechResultFormat||(t.SpeechResultFormat={}));class r{constructor(o,a){this.privSpeechServiceConfig=o||new n.SpeechServiceConfig(new n.Context(null)),this.privParameters=a,this.privMaxRetryCount=parseInt(a.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=a.getProperty(e.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(o){this.privRecognitionMode=o,this.privRecognitionActivityTimeout=o===i.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=i[o]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==i.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(e.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,void 0)}get sourceLanguageModels(){const o=[];let a=!1;if(this.autoDetectSourceLanguages!==void 0)for(const l of this.autoDetectSourceLanguages.split(",")){const c=l+e.PropertyId.SpeechServiceConnection_EndpointId.toString(),u=this.parameters.getProperty(c,void 0);u!==void 0?(o.push({language:l,endpoint:u}),a=!0):o.push({language:l,endpoint:""})}return a?o:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(o){this.privEnableSpeakerId=o}}t.RecognizerConfig=r}(F_)),F_}var mB={};Object.defineProperty(mB,"__esModule",{value:!0});var bx={};Object.defineProperty(bx,"__esModule",{value:!0});bx.WebsocketMessageFormatter=void 0;const As=ht(),ik=`\r
`;class gK{toConnectionMessage(e){const n=new As.Deferred;try{if(e.messageType===As.MessageType.Text){const i=e.textContent;let r={},s=null;if(i){const o=i.split(`\r
\r
`);o&&o.length>0&&(r=this.parseHeaders(o[0]),o.length>1&&(s=o[1]))}n.resolve(new As.ConnectionMessage(e.messageType,s,r,e.id))}else if(e.messageType===As.MessageType.Binary){const i=e.binaryContent;let r={},s=null;if(!i||i.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const o=new DataView(i),a=o.getInt16(0);if(i.byteLength<a+2)throw new Error("Invalid binary message format. Header content missing.");let l="";for(let c=0;c<a;c++)l+=String.fromCharCode(o.getInt8(c+2));r=this.parseHeaders(l),i.byteLength>a+2&&(s=i.slice(2+a)),n.resolve(new As.ConnectionMessage(e.messageType,s,r,e.id))}}catch(i){n.reject(`Error formatting the message. Error: ${i}`)}return n.promise}fromConnectionMessage(e){const n=new As.Deferred;try{if(e.messageType===As.MessageType.Text){const i=`${this.makeHeaders(e)}${ik}${e.textBody?e.textBody:""}`;n.resolve(new As.RawWebsocketMessage(As.MessageType.Text,i,e.id))}else if(e.messageType===As.MessageType.Binary){const i=this.makeHeaders(e),r=e.binaryBody,s=this.stringToArrayBuffer(i),o=new Int8Array(s),a=o.byteLength,l=new Int8Array(2+a+(r?r.byteLength:0));if(l[0]=a>>8&255,l[1]=a&255,l.set(o,2),r){const u=new Int8Array(r);l.set(u,2+a)}const c=l.buffer;n.resolve(new As.RawWebsocketMessage(As.MessageType.Binary,c,e.id))}}catch(i){n.reject(`Error formatting the message. ${i}`)}return n.promise}makeHeaders(e){let n="";if(e.headers)for(const i in e.headers)i&&(n+=`${i}: ${e.headers[i]}${ik}`);return n}parseHeaders(e){const n={};if(e){const i=e.match(/[^\r\n]+/g);if(n){for(const r of i)if(r){const s=r.indexOf(":"),o=s>0?r.substr(0,s).trim().toLowerCase():r,a=s>0&&r.length>s+1?r.substr(s+1).trim():"";n[o]=a}}}return n}stringToArrayBuffer(e){const n=new ArrayBuffer(e.length),i=new DataView(n);for(let r=0;r<e.length;r++)i.setUint8(r,e.charCodeAt(r));return n}}bx.WebsocketMessageFormatter=gK;var Zf={},rk;function vK(){if(rk)return Zf;rk=1,Object.defineProperty(Zf,"__esModule",{value:!0}),Zf.SpeechConnectionFactory=void 0;const t=zi(),e=Ve(),n=me(),i=No(),r=Ve(),s=Fi,o=Do;let a=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/speech/universal/v"}create(c,u,h){let d=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0);const p=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region,void 0),f=i.ConnectionFactoryBase.getHostSuffix(p),v=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,"wss://"+p+".stt.speech"+f),g={},m=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId,void 0),y=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(m?(!d||d.search(o.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(g[o.QueryParameterNames.CustomSpeechDeploymentId]=m):y&&(!d||d.search(o.QueryParameterNames.Language)===-1)&&(g[o.QueryParameterNames.Language]=y),(!d||d.search(o.QueryParameterNames.Format)===-1)&&(g[o.QueryParameterNames.Format]=c.parameters.getProperty(e.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple]).toLowerCase()),c.autoDetectSourceLanguages!==void 0&&(g[o.QueryParameterNames.EnableLanguageId]="true"),this.setCommonUrlParams(c,g,d),!d)switch(c.recognitionMode){case r.RecognitionMode.Conversation:c.parameters.getProperty(e.ForceDictationPropertyName,"false")==="true"?d=v+this.dictationRelativeUri:c.recognitionEndpointVersion!==void 0&&parseInt(c.recognitionEndpointVersion,10)>1?d=`${v}${this.universalUri}${c.recognitionEndpointVersion}`:d=v+this.conversationRelativeUri;break;case r.RecognitionMode.Dictation:d=v+this.dictationRelativeUri;break;default:c.recognitionEndpointVersion!==void 0&&parseInt(c.recognitionEndpointVersion,10)>1?d=`${v}${this.universalUri}${c.recognitionEndpointVersion}`:d=v+this.interactiveRelativeUri;break}const S={};u.token!==void 0&&u.token!==""&&(S[u.headerName]=u.token),S[s.HeaderNames.ConnectionId]=h;const x=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",w=new t.WebsocketConnection(d,g,S,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),x,h),C=w.uri;return c.parameters.setProperty(n.PropertyId.SpeechServiceConnection_Url,C),w}};return Zf.SpeechConnectionFactory=a,Zf}var em={},sk;function yK(){if(sk)return em;sk=1,Object.defineProperty(em,"__esModule",{value:!0}),em.ConversationTranscriberConnectionFactory=void 0;const t=zi(),e=me(),n=Ve(),i=No(),r=Ve(),s=Fi,o=Do;let a=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/speech/universal/v2"}create(c,u,h){let d=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const p=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,void 0),f=i.ConnectionFactoryBase.getHostSuffix(p),v=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,"wss://"+p+".stt.speech"+f),g={},m=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),y=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);m?(!d||d.search(o.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(g[o.QueryParameterNames.CustomSpeechDeploymentId]=m):y&&(!d||d.search(o.QueryParameterNames.Language)===-1)&&(g[o.QueryParameterNames.Language]=y),c.autoDetectSourceLanguages!==void 0&&(g[o.QueryParameterNames.EnableLanguageId]="true"),this.setV2UrlParams(c,g,d),d||(d=`${v}${this.universalUri}`);const S={};u.token!==void 0&&u.token!==""&&(S[u.headerName]=u.token),S[s.HeaderNames.ConnectionId]=h;const x=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",w=new t.WebsocketConnection(d,g,S,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),x,h),C=w.uri;return c.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,C),w}setV2UrlParams(c,u,h){new Map([[e.PropertyId.Speech_SegmentationSilenceTimeoutMs,o.QueryParameterNames.SegmentationSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_EnableAudioLogging,o.QueryParameterNames.EnableAudioLogging],[e.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,o.QueryParameterNames.EndSilenceTimeoutMs],[e.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,o.QueryParameterNames.InitialSilenceTimeoutMs],[e.PropertyId.SpeechServiceResponse_PostProcessingOption,o.QueryParameterNames.Postprocessing],[e.PropertyId.SpeechServiceResponse_ProfanityOption,o.QueryParameterNames.Profanity],[e.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,o.QueryParameterNames.StableIntermediateThreshold]]).forEach((f,v)=>{this.setUrlParameter(v,f,c,u,h)});const p=JSON.parse(c.parameters.getProperty(n.ServicePropertiesPropertyName,"{}"));Object.keys(p).forEach(f=>{u[f]=p[f]})}};return em.ConversationTranscriberConnectionFactory=a,em}var tm={},ok;function SK(){if(ok)return tm;ok=1,Object.defineProperty(tm,"__esModule",{value:!0}),tm.TranscriberConnectionFactory=void 0;const t=zi(),e=me(),n=No(),i=Ve(),r=Fi,s=Do;let o=class extends n.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(l,c,u){let h=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,"centralus"),p=n.ConnectionFactoryBase.getHostSuffix(d),f="wss://transcribe."+d+".cts.speech"+p+this.multiaudioRelativeUri,v=l.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,f),g={};this.setQueryParams(g,l,h),h||(h=v);const m={};c.token!==void 0&&c.token!==""&&(m[c.headerName]=c.token),m[r.HeaderNames.ConnectionId]=u,l.parameters.setProperty(e.PropertyId.SpeechServiceConnection_Url,h);const y=l.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(h,g,m,new i.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(l),y,u)}setQueryParams(l,c,u){const h=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_EndpointId,void 0),d=c.parameters.getProperty(e.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);h&&!(s.QueryParameterNames.CustomSpeechDeploymentId in l)&&(l[s.QueryParameterNames.CustomSpeechDeploymentId]=h),d&&!(s.QueryParameterNames.Language in l)&&(l[s.QueryParameterNames.Language]=d);const p=c.parameters.getProperty(e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true",f=c.parameters.getProperty(i.OutputFormatPropertyName,e.OutputFormat[e.OutputFormat.Simple])!==e.OutputFormat[e.OutputFormat.Simple];(p||f)&&(l[s.QueryParameterNames.Format]=e.OutputFormat[e.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(c,l,u)}};return tm.TranscriberConnectionFactory=o,tm}var nm={},ak;function xK(){if(ak)return nm;ak=1,Object.defineProperty(nm,"__esModule",{value:!0}),nm.TranslationConnectionFactory=void 0;const t=zi(),e=I0,n=me(),i=No(),r=Ve(),s=Fi,o=Do;let a=class extends i.ConnectionFactoryBase{create(c,u,h){const d=this.getEndpointUrl(c),p={};c.autoDetectSourceLanguages!==void 0&&(p[o.QueryParameterNames.EnableLanguageId]="true"),this.setQueryParams(p,c,d);const f={};u.token!==void 0&&u.token!==""&&(f[u.headerName]=u.token),f[s.HeaderNames.ConnectionId]=h,c.parameters.setProperty(n.PropertyId.SpeechServiceConnection_Url,d);const v=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(d,p,f,new r.WebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),v,h)}getEndpointUrl(c,u){const h=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Region),d=i.ConnectionFactoryBase.getHostSuffix(h);let p=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Endpoint,void 0);return p||(c.autoDetectSourceLanguages!==void 0?p=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+d)+"/speech/universal/v2":p=c.parameters.getProperty(n.PropertyId.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+d)+"/speech/translation/cognitiveservices/v1"),u===!0?p:e.StringUtils.formatString(p,{region:h})}setQueryParams(c,u,h){c.from=u.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage),c.to=u.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationToLanguages),c.scenario=u.recognitionMode===r.RecognitionMode.Interactive?"interactive":u.recognitionMode===r.RecognitionMode.Conversation?"conversation":"",this.setCommonUrlParams(u,c,h),this.setUrlParameter(n.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,o.QueryParameterNames.StableTranslation,u,c,h);const d=u.parameters.getProperty(n.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);d!==void 0&&(c.voice=d,c.features="texttospeech")}};return nm.TranslationConnectionFactory=a,nm}var im={},lk;function CK(){if(lk)return im;lk=1,Object.defineProperty(im,"__esModule",{value:!0}),im.EnumTranslation=void 0;const t=me(),e=Ve();let n=class{static implTranslateRecognitionResult(r,s=!1){let o=t.ResultReason.Canceled;switch(r){case e.RecognitionStatus.Success:o=t.ResultReason.RecognizedSpeech;break;case e.RecognitionStatus.EndOfDictation:o=s?t.ResultReason.RecognizedSpeech:t.ResultReason.NoMatch;break;case e.RecognitionStatus.NoMatch:case e.RecognitionStatus.InitialSilenceTimeout:case e.RecognitionStatus.BabbleTimeout:o=t.ResultReason.NoMatch;break;case e.RecognitionStatus.Error:case e.RecognitionStatus.BadRequest:case e.RecognitionStatus.Forbidden:default:o=t.ResultReason.Canceled;break}return o}static implTranslateCancelResult(r){let s=t.CancellationReason.EndOfStream;switch(r){case e.RecognitionStatus.Success:case e.RecognitionStatus.EndOfDictation:case e.RecognitionStatus.NoMatch:s=t.CancellationReason.EndOfStream;break;case e.RecognitionStatus.InitialSilenceTimeout:case e.RecognitionStatus.BabbleTimeout:case e.RecognitionStatus.Error:case e.RecognitionStatus.BadRequest:case e.RecognitionStatus.Forbidden:default:s=t.CancellationReason.Error;break}return s}static implTranslateCancelErrorCode(r){let s=t.CancellationErrorCode.NoError;switch(r){case e.RecognitionStatus.Error:s=t.CancellationErrorCode.ServiceError;break;case e.RecognitionStatus.TooManyRequests:s=t.CancellationErrorCode.TooManyRequests;break;case e.RecognitionStatus.BadRequest:s=t.CancellationErrorCode.BadRequestParameters;break;case e.RecognitionStatus.Forbidden:s=t.CancellationErrorCode.Forbidden;break;default:s=t.CancellationErrorCode.NoError;break}return s}static implTranslateErrorDetails(r){let s="The speech service encountered an internal error and could not continue.";switch(r){case t.CancellationErrorCode.Forbidden:s="The recognizer is using a free subscription that ran out of quota.";break;case t.CancellationErrorCode.BadRequestParameters:s="Invalid parameter or unsupported audio format in the request.";break;case t.CancellationErrorCode.TooManyRequests:s="The number of parallel requests exceeded the number of allowed concurrent transcriptions.";break}return s}};return im.EnumTranslation=n,im}var gB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecognitionStatus=t.SynthesisStatus=void 0,function(e){e[e.Success=0]="Success",e[e.SynthesisEnd=1]="SynthesisEnd",e[e.Error=2]="Error"}(t.SynthesisStatus||(t.SynthesisStatus={})),function(e){e[e.Success=0]="Success",e[e.NoMatch=1]="NoMatch",e[e.InitialSilenceTimeout=2]="InitialSilenceTimeout",e[e.BabbleTimeout=3]="BabbleTimeout",e[e.Error=4]="Error",e[e.EndOfDictation=5]="EndOfDictation",e[e.TooManyRequests=6]="TooManyRequests",e[e.BadRequest=7]="BadRequest",e[e.Forbidden=8]="Forbidden"}(t.RecognitionStatus||(t.RecognitionStatus={}))})(gB);var rm={},ck;function _K(){if(ck)return rm;ck=1,Object.defineProperty(rm,"__esModule",{value:!0}),rm.TranslationSynthesisEnd=void 0;const t=Ve();let e=class vB{constructor(i){this.privSynthesisEnd=JSON.parse(i),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=t.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=t.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(i){return new vB(i)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}};return rm.TranslationSynthesisEnd=e,rm}var Ax={};Object.defineProperty(Ax,"__esModule",{value:!0});Ax.TranslationHypothesis=void 0;const wK=Ct,EK=YS;class _1{constructor(e){this.privTranslationHypothesis=e,this.privTranslationHypothesis.Translation.TranslationStatus=EK.TranslationStatus[this.privTranslationHypothesis.Translation.TranslationStatus]}static fromJSON(e){return new _1(JSON.parse(e))}static fromTranslationResponse(e){wK.Contracts.throwIfNullOrUndefined(e,"translationHypothesis");const n=e.SpeechHypothesis;return e.SpeechHypothesis=void 0,n.Translation=e,new _1(n)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){var e;return(e=this.privTranslationHypothesis.PrimaryLanguage)==null?void 0:e.Language}}Ax.TranslationHypothesis=_1;var sm={},uk;function RK(){if(uk)return sm;uk=1,Object.defineProperty(sm,"__esModule",{value:!0}),sm.TranslationPhrase=void 0;const t=Ct,e=Ve(),n=YS;let i=class uR{constructor(s){this.privTranslationPhrase=s,this.privTranslationPhrase.RecognitionStatus=e.RecognitionStatus[this.privTranslationPhrase.RecognitionStatus],this.privTranslationPhrase.Translation!==void 0&&(this.privTranslationPhrase.Translation.TranslationStatus=n.TranslationStatus[this.privTranslationPhrase.Translation.TranslationStatus])}static fromJSON(s){return new uR(JSON.parse(s))}static fromTranslationResponse(s){t.Contracts.throwIfNullOrUndefined(s,"translationResponse");const o=s.SpeechPhrase;return s.SpeechPhrase=void 0,o.Translation=s,o.Text=o.DisplayText,new uR(o)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){var s;return(s=this.privTranslationPhrase.PrimaryLanguage)==null?void 0:s.Language}get Confidence(){var s;return(s=this.privTranslationPhrase.PrimaryLanguage)==null?void 0:s.Confidence}get Translation(){return this.privTranslationPhrase.Translation}};return sm.TranslationPhrase=i,sm}var om={},hk;function TK(){if(hk)return om;hk=1,Object.defineProperty(om,"__esModule",{value:!0}),om.TranslationServiceRecognizer=void 0;const t=ht(),e=me(),n=Ve();let i=class extends n.ConversationServiceRecognizer{constructor(s,o,a,l,c){super(s,o,a,l,c),this.privTranslationRecognizer=c,this.connectionEvents.attach(u=>{u.name==="ConnectionEstablishedEvent"&&this.privTranslationRecognizer.onConnection()})}async processTypeSpecificMessages(s){const o=new e.PropertyCollection;let a=await this.processSpeechMessages(s);if(a)return!0;const l=async u=>{if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+u.Offset+u.Duration),u.RecognitionStatus===n.RecognitionStatus.Success){const h=this.fireEventForResult(u,o);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,h)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(h.result)}catch(d){this.privErrorCallback&&this.privErrorCallback(d)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{const h=n.EnumTranslation.implTranslateRecognitionResult(u.RecognitionStatus),d=new e.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,h,u.Text,u.Duration,this.privRequestSession.currentTurnAudioOffset+u.Offset,u.Language,u.Confidence,void 0,s.textBody,o);if(h===e.ResultReason.Canceled){const p=n.EnumTranslation.implTranslateCancelResult(u.RecognitionStatus),f=n.EnumTranslation.implTranslateCancelErrorCode(u.RecognitionStatus);await this.cancelRecognitionLocal(p,f,n.EnumTranslation.implTranslateErrorDetails(f))}else{if(!(this.privRequestSession.isSpeechEnded&&h===e.ResultReason.NoMatch&&u.RecognitionStatus!==n.RecognitionStatus.InitialSilenceTimeout)){const p=new e.TranslationRecognitionEventArgs(d,d.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,p)}catch{}}if(this.privSuccessCallback){try{this.privSuccessCallback(d)}catch(p){this.privErrorCallback&&this.privErrorCallback(p)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}a=!0}},c=(u,h)=>{const d=this.fireEventForResult(u,h);if(this.privRequestSession.onHypothesis(this.privRequestSession.currentTurnAudioOffset+d.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,d)}catch{}a=!0};switch(s.messageType===t.MessageType.Text&&o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,s.textBody),s.path.toLowerCase()){case"translation.hypothesis":c(n.TranslationHypothesis.fromJSON(s.textBody),o);break;case"translation.response":const u=JSON.parse(s.textBody);if(u.SpeechPhrase)await l(n.TranslationPhrase.fromTranslationResponse(u));else{const d=JSON.parse(s.textBody);d.SpeechHypothesis&&c(n.TranslationHypothesis.fromTranslationResponse(d),o)}break;case"translation.phrase":await l(n.TranslationPhrase.fromJSON(s.textBody));break;case"translation.synthesis":this.sendSynthesisAudio(s.binaryBody,this.privRequestSession.sessionId),a=!0;break;case"audio.end":case"translation.synthesis.end":const h=n.TranslationSynthesisEnd.fromJSON(s.textBody);switch(h.SynthesisStatus){case n.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){const d=new e.TranslationSynthesisResult(e.ResultReason.Canceled,void 0),p=new e.TranslationSynthesisEventArgs(d,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,p)}catch{}}if(this.privTranslationRecognizer.canceled){const d=new e.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,e.CancellationReason.Error,h.FailureReason,e.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,d)}catch{}}break;case n.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId);break}a=!0;break}return a}cancelRecognition(s,o,a,l,c){const u=new e.PropertyCollection;if(u.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[l]),this.privTranslationRecognizer.canceled){const h=new e.TranslationRecognitionCanceledEventArgs(s,a,c,l,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new e.TranslationRecognitionResult(void 0,o,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,c,void 0,u);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}handleRecognizingCallback(s,o,a){try{const l=new e.TranslationRecognitionEventArgs(e.TranslationRecognitionResult.fromSpeechRecognitionResult(s),o,a);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,l)}catch{}}handleRecognizedCallback(s,o,a){try{const l=new e.TranslationRecognitionEventArgs(e.TranslationRecognitionResult.fromSpeechRecognitionResult(s),o,a);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,l)}catch{}}fireEventForResult(s,o){let a;if(s.Translation.Translations!==void 0){a=new e.Translations;for(const f of s.Translation.Translations)a.set(f.Language,f.Text||f.DisplayText)}let l,c;s instanceof n.TranslationPhrase?(s.Translation&&s.Translation.TranslationStatus===t.TranslationStatus.Success?l=e.ResultReason.TranslatedSpeech:l=e.ResultReason.RecognizedSpeech,c=s.Confidence):l=e.ResultReason.TranslatingSpeech;const u=s.Language,h=s.Offset+this.privRequestSession.currentTurnAudioOffset,d=new e.TranslationRecognitionResult(a,this.privRequestSession.requestId,l,s.Text,s.Duration,h,u,c,s.Translation.FailureReason,JSON.stringify(s),o);return new e.TranslationRecognitionEventArgs(d,h,this.privRequestSession.sessionId)}sendSynthesisAudio(s,o){const a=s===void 0?e.ResultReason.SynthesizingAudioCompleted:e.ResultReason.SynthesizingAudio,l=new e.TranslationSynthesisResult(a,s),c=new e.TranslationSynthesisEventArgs(l,o);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,c)}catch{}}};return om.TranslationServiceRecognizer=i,om}var Px={};Object.defineProperty(Px,"__esModule",{value:!0});Px.SpeechDetected=void 0;class _2{constructor(e){this.privSpeechStartDetected=JSON.parse(e)}static fromJSON(e){return new _2(e)}get Offset(){return this.privSpeechStartDetected.Offset}}Px.SpeechDetected=_2;var Ix={};Object.defineProperty(Ix,"__esModule",{value:!0});Ix.SpeechHypothesis=void 0;class w2{constructor(e){this.privSpeechHypothesis=JSON.parse(e)}static fromJSON(e){return new w2(e)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}}Ix.SpeechHypothesis=w2;var Mx={};Object.defineProperty(Mx,"__esModule",{value:!0});Mx.SpeechKeyword=void 0;class E2{constructor(e){this.privSpeechKeyword=JSON.parse(e)}static fromJSON(e){return new E2(e)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}}Mx.SpeechKeyword=E2;var am={},dk;function bK(){if(dk)return am;dk=1,Object.defineProperty(am,"__esModule",{value:!0}),am.SpeechServiceRecognizer=void 0;const t=me(),e=Ve();let n=class extends e.ServiceRecognizerBase{constructor(r,s,o,a,l){super(r,s,o,a,l),this.privSpeechRecognizer=l}async processTypeSpecificMessages(r){let s;const o=new t.PropertyCollection;o.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r.textBody);let a=!1;switch(r.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const l=e.SpeechHypothesis.fromJSON(r.textBody),c=l.Offset+this.privRequestSession.currentTurnAudioOffset;s=new t.SpeechRecognitionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,l.Text,l.Duration,c,l.Language,l.LanguageDetectionConfidence,void 0,void 0,r.textBody,o),this.privRequestSession.onHypothesis(c);const u=new t.SpeechRecognitionEventArgs(s,l.Duration,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,u)}catch{}a=!0;break;case"speech.phrase":const h=e.SimpleSpeechPhrase.fromJSON(r.textBody),d=e.EnumTranslation.implTranslateRecognitionResult(h.RecognitionStatus,this.privExpectContentAssessmentResponse);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+h.Offset+h.Duration),t.ResultReason.Canceled===d){const p=e.EnumTranslation.implTranslateCancelResult(h.RecognitionStatus),f=e.EnumTranslation.implTranslateCancelErrorCode(h.RecognitionStatus);await this.cancelRecognitionLocal(p,f,e.EnumTranslation.implTranslateErrorDetails(f))}else{if(!(this.privRequestSession.isSpeechEnded&&d===t.ResultReason.NoMatch&&h.RecognitionStatus!==e.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(e.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])s=new t.SpeechRecognitionResult(this.privRequestSession.requestId,d,h.DisplayText,h.Duration,h.Offset+this.privRequestSession.currentTurnAudioOffset,h.Language,h.LanguageDetectionConfidence,void 0,void 0,r.textBody,o);else{const f=e.DetailedSpeechPhrase.fromJSON(r.textBody),v=f.Offset+this.privRequestSession.currentTurnAudioOffset,g=f.getJsonWithCorrectedOffsets(v);s=new t.SpeechRecognitionResult(this.privRequestSession.requestId,d,f.RecognitionStatus===e.RecognitionStatus.Success?f.NBest[0].Display:void 0,f.Duration,v,f.Language,f.LanguageDetectionConfidence,void 0,void 0,g,o)}const p=new t.SpeechRecognitionEventArgs(s,s.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,p)}catch{}}if(this.privSuccessCallback){try{this.privSuccessCallback(s)}catch(p){this.privErrorCallback&&this.privErrorCallback(p)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}a=!0;break}return a}cancelRecognition(r,s,o,a,l){const c=new t.PropertyCollection;if(c.setProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[a]),this.privSpeechRecognizer.canceled){const u=new t.SpeechRecognitionCanceledEventArgs(o,l,a,void 0,r);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,u)}catch{}}if(this.privSuccessCallback){const u=new t.SpeechRecognitionResult(s,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,l,void 0,c);try{this.privSuccessCallback(u),this.privSuccessCallback=void 0}catch{}}}};return am.SpeechServiceRecognizer=n,am}var lm={},pk;function AK(){if(pk)return lm;pk=1,Object.defineProperty(lm,"__esModule",{value:!0}),lm.ConversationTranscriptionServiceRecognizer=void 0;const t=me(),e=Ve();let n=class extends e.ServiceRecognizerBase{constructor(r,s,o,a,l){super(r,s,o,a,l),this.privConversationTranscriber=l,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){const r=this.privSpeechContext.getSection("phraseDetection");r.mode="Conversation";const s={};s.mode="Anonymous",s.audioSessionId=this.privDiarizationSessionId,s.audioOffsetMs=0,r.speakerDiarization=s,this.privSpeechContext.setSection("phraseDetection",r)}}async processTypeSpecificMessages(r){let s;const o=new t.PropertyCollection;o.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,r.textBody);let a=!1;switch(r.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const l=e.SpeechHypothesis.fromJSON(r.textBody),c=l.Offset+this.privRequestSession.currentTurnAudioOffset;s=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,t.ResultReason.RecognizingSpeech,l.Text,l.Duration,c,l.Language,l.LanguageDetectionConfidence,void 0,void 0,r.textBody,o),this.privRequestSession.onHypothesis(c);const u=new t.ConversationTranscriptionEventArgs(s,l.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,u)}catch{}a=!0;break;case"speech.phrase":const h=e.SimpleSpeechPhrase.fromJSON(r.textBody),d=e.EnumTranslation.implTranslateRecognitionResult(h.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+h.Offset+h.Duration),t.ResultReason.Canceled===d){const p=e.EnumTranslation.implTranslateCancelResult(h.RecognitionStatus),f=e.EnumTranslation.implTranslateCancelErrorCode(h.RecognitionStatus);await this.cancelRecognitionLocal(p,f,e.EnumTranslation.implTranslateErrorDetails(f))}else if(!(this.privRequestSession.isSpeechEnded&&d===t.ResultReason.NoMatch&&h.RecognitionStatus!==e.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(e.OutputFormatPropertyName)===t.OutputFormat[t.OutputFormat.Simple])s=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,d,h.DisplayText,h.Duration,h.Offset+this.privRequestSession.currentTurnAudioOffset,h.Language,h.LanguageDetectionConfidence,h.SpeakerId,void 0,r.textBody,o);else{const f=e.DetailedSpeechPhrase.fromJSON(r.textBody),v=f.Offset+this.privRequestSession.currentTurnAudioOffset,g=f.getJsonWithCorrectedOffsets(v);s=new t.ConversationTranscriptionResult(this.privRequestSession.requestId,d,f.RecognitionStatus===e.RecognitionStatus.Success?f.NBest[0].Display:void 0,f.Duration,v,f.Language,f.LanguageDetectionConfidence,h.SpeakerId,void 0,g,o)}const p=new t.ConversationTranscriptionEventArgs(s,s.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,p)}catch{}}a=!0;break}return a}cancelRecognition(r,s,o,a,l){if(new t.PropertyCollection().setProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[a]),this.privConversationTranscriber.canceled){const u=new t.ConversationTranscriptionCanceledEventArgs(o,l,a,void 0,r);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,u)}catch{}}}};return lm.ConversationTranscriptionServiceRecognizer=n,lm}var cm={},fk;function PK(){if(fk)return cm;fk=1,Object.defineProperty(cm,"__esModule",{value:!0}),cm.TranscriptionServiceRecognizer=void 0;const t=ht(),e=me(),n=Ve(),i=tl;let r=class extends n.ConversationServiceRecognizer{constructor(o,a,l,c,u){super(o,a,l,c,u),this.privTranscriberRecognizer=u,this.sendPrePayloadJSONOverride=h=>this.sendTranscriptionStartJSON(h),this.privRecognizerConfig.parameters.getProperty(e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)==="true"&&this.privSpeechContext.setWordLevelTimings()}async sendSpeechEventAsync(o,a){if(this.privRequestSession.isRecognizing){const l=await this.fetchConnection();await this.sendSpeechEvent(l,this.createSpeechEventPayload(o,a))}}async sendMeetingSpeechEventAsync(o,a){if(this.privRequestSession.isRecognizing){const l=await this.fetchConnection();await this.sendSpeechEvent(l,this.createMeetingSpeechEventPayload(o,a))}}processTypeSpecificMessages(o){return this.processSpeechMessages(o)}handleRecognizedCallback(o,a,l){try{const c=new e.SpeechRecognitionEventArgs(o,a,l);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,c),this.privSuccessCallback){try{this.privSuccessCallback(o)}catch(u){this.privErrorCallback&&this.privErrorCallback(u)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch{}}handleRecognizingCallback(o,a,l){try{const c=new e.SpeechRecognitionEventArgs(o,a,l);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,c)}catch{}}cancelRecognition(o,a,l,c,u){const h=new e.PropertyCollection;if(h.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[c]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){const d=new e.MeetingTranscriptionCanceledEventArgs(l,u,c,void 0,o);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,d)}catch{}}}else if(this.privTranscriberRecognizer.canceled){const d=new e.ConversationTranscriptionCanceledEventArgs(l,u,c,void 0,o);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,d)}catch{}}if(this.privSuccessCallback){const d=new e.SpeechRecognitionResult(a,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,u,void 0,h);try{this.privSuccessCallback(d),this.privSuccessCallback=void 0}catch{}}}async sendTranscriptionStartJSON(o){if(await this.sendSpeechContext(o,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){const a=this.privTranscriberRecognizer.getMeetingInfo(),l=this.createMeetingSpeechEventPayload(a,"start");await this.sendSpeechEvent(o,l)}else{const a=this.privTranscriberRecognizer.getConversationInfo(),l=this.createSpeechEventPayload(a,"start");await this.sendSpeechEvent(o,l)}await this.sendWaveHeader(o)}sendSpeechEvent(o,a){const l=JSON.stringify(a);if(l)return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"speech.event",this.privRequestSession.requestId,"application/json",l))}createSpeechEventPayload(o,a){const l={id:"meeting",name:a,meeting:o.conversationProperties};return l.meeting.id=o.id,l.meeting.attendees=o.participants,l}createMeetingSpeechEventPayload(o,a){const l={id:"meeting",name:a,meeting:o.meetingProperties};return l.meeting.id=o.id,l.meeting.attendees=o.participants,l}};return cm.TranscriptionServiceRecognizer=r,cm}var um={},mk;function IK(){if(mk)return um;mk=1,Object.defineProperty(um,"__esModule",{value:!0}),um.DetailedSpeechPhrase=void 0;const t=Ve();let e=class yB{constructor(i){this.privDetailedSpeechPhrase=JSON.parse(i),this.privDetailedSpeechPhrase.RecognitionStatus=t.RecognitionStatus[this.privDetailedSpeechPhrase.RecognitionStatus]}static fromJSON(i){return new yB(i)}getJsonWithCorrectedOffsets(i){if(this.privDetailedSpeechPhrase.NBest){let r;for(const s of this.privDetailedSpeechPhrase.NBest)if(s.Words&&s.Words[0]){r=s.Words[0].Offset;break}if(r&&r<i){const s=i-r;for(const o of this.privDetailedSpeechPhrase.NBest){if(o.Words)for(const a of o.Words)a.Offset+=s;if(o.DisplayWords)for(const a of o.DisplayWords)a.Offset+=s}}}return JSON.stringify(this.privDetailedSpeechPhrase)}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}};return um.DetailedSpeechPhrase=e,um}var hm={},gk;function MK(){if(gk)return hm;gk=1,Object.defineProperty(hm,"__esModule",{value:!0}),hm.SimpleSpeechPhrase=void 0;const t=Ve();let e=class SB{constructor(i){this.privSimpleSpeechPhrase=JSON.parse(i),this.privSimpleSpeechPhrase.RecognitionStatus=t.RecognitionStatus[this.privSimpleSpeechPhrase.RecognitionStatus]}static fromJSON(i){return new SB(i)}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}};return hm.SimpleSpeechPhrase=e,hm}var kx={};Object.defineProperty(kx,"__esModule",{value:!0});kx.AddedLmIntent=void 0;class kK{constructor(e,n){this.modelImpl=e,this.intentName=n}}kx.AddedLmIntent=kK;var dm={},vk;function LK(){if(vk)return dm;vk=1,Object.defineProperty(dm,"__esModule",{value:!0}),dm.IntentServiceRecognizer=void 0;const t=ht(),e=me(),n=Ve();let i=class extends n.ServiceRecognizerBase{constructor(s,o,a,l,c){super(s,o,a,l,c),this.privIntentRecognizer=c,this.privIntentDataSent=!1}setIntents(s,o){this.privAddedLmIntents=s,this.privUmbrellaIntent=o,this.privIntentDataSent=!0}processTypeSpecificMessages(s){let o,a,l=!1;const c=new e.PropertyCollection;switch(s.messageType===t.MessageType.Text&&c.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,s.textBody),s.path.toLowerCase()){case"speech.hypothesis":const h=n.SpeechHypothesis.fromJSON(s.textBody);if(o=new e.IntentRecognitionResult(void 0,this.privRequestSession.requestId,e.ResultReason.RecognizingIntent,h.Text,h.Duration,h.Offset+this.privRequestSession.currentTurnAudioOffset,h.Language,h.LanguageDetectionConfidence,void 0,s.textBody,c),this.privRequestSession.onHypothesis(o.offset),a=new e.IntentRecognitionEventArgs(o,h.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,a)}catch{}l=!0;break;case"speech.phrase":const d=n.SimpleSpeechPhrase.fromJSON(s.textBody);o=new e.IntentRecognitionResult(void 0,this.privRequestSession.requestId,n.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus),d.DisplayText,d.Duration,d.Offset+this.privRequestSession.currentTurnAudioOffset,d.Language,d.LanguageDetectionConfidence,void 0,s.textBody,c),a=new e.IntentRecognitionEventArgs(o,o.offset,this.privRequestSession.sessionId);const p=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,a)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(o)}catch(v){this.privErrorCallback&&this.privErrorCallback(v)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};this.privIntentDataSent===!1||e.ResultReason.NoMatch===a.result.reason?(this.privRequestSession.onPhraseRecognized(a.offset+a.result.duration),p()):this.privPendingIntentArgs=a,l=!0;break;case"response":if(a=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,a===void 0){if(s.textBody==="")return;a=new e.IntentRecognitionEventArgs(new e.IntentRecognitionResult,0,this.privRequestSession.sessionId)}const f=n.IntentResponse.fromJSON(s.textBody);if(f!==null&&f.topScoringIntent&&f.topScoringIntent.intent){let v=this.privAddedLmIntents[f.topScoringIntent.intent];if(this.privUmbrellaIntent!==void 0&&(v=this.privUmbrellaIntent),v){const g=v===void 0||v.intentName===void 0?f.topScoringIntent.intent:v.intentName;let m=a.result.reason;g!==void 0&&(m=e.ResultReason.RecognizedIntent);const y=a.result.properties!==void 0?a.result.properties:new e.PropertyCollection;y.setProperty(e.PropertyId.LanguageUnderstandingServiceResponse_JsonResult,s.textBody),a=new e.IntentRecognitionEventArgs(new e.IntentRecognitionResult(g,a.result.resultId,m,a.result.text,a.result.duration,a.result.offset,void 0,void 0,a.result.errorDetails,a.result.json,y),a.offset,a.sessionId)}}if(this.privRequestSession.onPhraseRecognized(a.offset+a.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,a)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(a.result)}catch(v){this.privErrorCallback&&this.privErrorCallback(v)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}l=!0;break}const u=new t.Deferred;return u.resolve(l),u.promise}cancelRecognition(s,o,a,l,c){const u=new e.PropertyCollection;if(u.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[l]),this.privIntentRecognizer.canceled){const h=new e.IntentRecognitionCanceledEventArgs(a,c,l,void 0,void 0,s);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new e.IntentRecognitionResult(void 0,o,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,c,void 0,u);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}};return dm.IntentServiceRecognizer=i,dm}var Lx={};Object.defineProperty(Lx,"__esModule",{value:!0});Lx.IntentResponse=void 0;class R2{constructor(e){e===""?this.privIntentResponse={}:this.privIntentResponse=JSON.parse(e)}static fromJSON(e){return new R2(e)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}}Lx.IntentResponse=R2;var xB={};Object.defineProperty(xB,"__esModule",{value:!0});var Dx={},Nx={};Object.defineProperty(Nx,"__esModule",{value:!0});Nx.ServiceTelemetryListener=void 0;const Ca=ht(),yk=Tx;class DK{constructor(e,n,i){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=n,this.privAudioNodeId=i,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){this.privIsDisposed||(e instanceof yk.RecognitionTriggeredEvent&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof Ca.AudioStreamNodeAttachingEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof Ca.AudioStreamNodeAttachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof Ca.AudioSourceErrorEvent&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof Ca.AudioStreamNodeErrorEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof Ca.AudioStreamNodeDetachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof yk.ConnectingToServiceEvent&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof Ca.ConnectionStartEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof Ca.ConnectionEstablishedEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof Ca.ConnectionEstablishErrorEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof Ca.ConnectionMessageReceivedEvent&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array),this.privReceivedMessages[e.message.headers.path].length<50&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)))}getTelemetry(){const e=new Array;this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const n={Metrics:e,ReceivedMessages:this.privReceivedMessages},i=JSON.stringify(n);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],i}get hasTelemetry(){return Object.keys(this.privReceivedMessages).length!==0||this.privListeningTriggerMetric!==null||this.privMicMetric!==null||this.privConnectionEstablishMetric!==null||this.privPhraseLatencies.length!==0||this.privHypothesisLatencies.length!==0}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}}}Nx.ServiceTelemetryListener=DK;Object.defineProperty(Dx,"__esModule",{value:!0});Dx.RequestSession=void 0;const uh=ht(),Cv=Tx,NK=Nx;class OK{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=uh.createNoDashGuid(),this.privAudioNodeId=uh.createNoDashGuid(),this.privTurnDeferral=new uh.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new NK.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new Cv.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}async onAudioSourceAttachCompleted(e,n){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,n?await this.onComplete():this.onEvent(new Cv.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onPreConnectionStart(e,n){this.privAuthFetchEventId=e,this.privSessionId=n,this.onEvent(new Cv.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}async onAuthCompleted(e){e&&await this.onComplete()}async onConnectionEstablishCompleted(e,n){if(e===200){this.onEvent(new Cv.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0;return}else e===403&&await this.onComplete()}async onServiceTurnEndResponse(e){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(await this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}onSpeechContext(){this.privRequestId=uh.createNoDashGuid()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new uh.Deferred}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e,this.privRecognitionBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)await e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}async onStopRecognizing(){await this.onComplete()}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),uh.Events.instance.onEvent(e)}async onComplete(){this.privIsRecognizing&&(this.privIsRecognizing=!1,await this.detachAudioNode())}async detachAudioNode(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&await this.privAudioNode.detach())}}Dx.RequestSession=OK;var Ox={};Object.defineProperty(Ox,"__esModule",{value:!0});Ox.SpeechContext=void 0;class FK{constructor(e){this.privContext={},this.privDynamicGrammar=e}getSection(e){return this.privContext[e]||{}}setSection(e,n){this.privContext[e]=n}setPronunciationAssessmentParams(e,n,i=!1){this.privContext.phraseDetection===void 0&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment===void 0&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e),i&&(this.privContext.phraseDetection.mode="Conversation"),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push("PronunciationAssessment"),this.privContext.phraseOutput.detailed.options.indexOf("SNR")===-1&&this.privContext.phraseOutput.detailed.options.push("SNR"),n&&(this.privContext.phraseDetection.enrichment.contentAssessment={topic:n},this.privContext.phraseOutput.detailed.options.push("ContentAssessment"))}setDetailedOutputFormat(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed"}setWordLevelTimings(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed",this.privContext.phraseOutput.detailed.options.indexOf("WordTimings")===-1&&this.privContext.phraseOutput.detailed.options.push("WordTimings")}setSpeakerDiarizationAudioOffsetMs(e){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=e}toJSON(){const e=this.privDynamicGrammar.generateGrammarObject();return this.setSection("dgi",e),JSON.stringify(this.privContext)}}Ox.SpeechContext=FK;var Fx={};Object.defineProperty(Fx,"__esModule",{value:!0});Fx.DynamicGrammarBuilder=void 0;class zK{addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}generateGrammarObject(){if(this.privGrammars===void 0&&this.privPhrases===void 0)return;const e={};if(e.ReferenceGrammars=this.privGrammars,this.privPhrases!==void 0&&this.privPhrases.length!==0){const n=[];this.privPhrases.forEach(i=>{n.push({Text:i})}),e.Groups=[{Type:"Generic",Items:n}]}return e}}Fx.DynamicGrammarBuilder=zK;var CB={};Object.defineProperty(CB,"__esModule",{value:!0});var pm={},zx={},Ux={},T2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDataStreamType=t.ActivityPayloadResponse=void 0;class e{constructor(i){this.privActivityResponse=JSON.parse(i)}static fromJSON(i){return new e(i)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}t.ActivityPayloadResponse=e,function(n){n[n.None=0]="None",n[n.TextToSpeechAudio=1]="TextToSpeechAudio"}(t.MessageDataStreamType||(t.MessageDataStreamType={}))})(T2);Object.defineProperty(Ux,"__esModule",{value:!0});Ux.DialogServiceTurnState=void 0;const UK=yc,BK=Vi,$K=T2;class HK{constructor(e,n){this.privRequestId=n,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e,n){return e.messageDataStreamType===$K.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=BK.AudioOutputStream.createPullStream(),this.privAudioStream.format=n!==void 0?n:UK.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){this.privAudioStream!==null&&!this.privAudioStream.isClosed&&this.privAudioStream.close()}complete(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}}Ux.DialogServiceTurnState=HK;Object.defineProperty(zx,"__esModule",{value:!0});zx.DialogServiceTurnStateManager=void 0;const Sk=Wi,VK=Ux;class jK{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new Sk.InvalidOperationError("Service error: There is already a turn with id:"+e);const n=new VK.DialogServiceTurnState(this,e);return this.privTurnMap.set(e,n),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new Sk.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+e);const n=this.privTurnMap.get(e);return n.complete(),this.privTurnMap.delete(e),n}}zx.DialogServiceTurnStateManager=jK;var xk;function WK(){if(xk)return pm;xk=1,Object.defineProperty(pm,"__esModule",{value:!0}),pm.DialogServiceAdapter=void 0;const t=zi(),e=Pu,n=ht(),i=yc,r=me(),s=zx,o=Ve(),a=T2,l=tl;let c=class extends o.ServiceRecognizerBase{constructor(h,d,p,f,v){super(h,d,p,f,v),this.privEvents=new n.EventSource,this.privDialogServiceConnector=v,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new s.DialogServiceTurnStateManager,this.recognizeOverride=(g,m,y)=>this.listenOnce(g,m,y),this.postConnectImplOverride=g=>this.dialogConnectImpl(g),this.configConnectionOverride=g=>this.configConnection(g),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=p,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach(g=>{g.name==="ConnectionClosedEvent"&&(this.terminateMessageLoop=!0)})}async sendMessage(h){const d=n.createGuid(),p=n.createNoDashGuid(),f={context:{interactionId:d},messagePayload:JSON.parse(h),version:.5},v=JSON.stringify(f);await(await this.fetchConnection()).send(new l.SpeechConnectionMessage(n.MessageType.Text,"agent",p,"application/json",v))}async privDisconnect(){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1}processTypeSpecificMessages(h){const d=new r.PropertyCollection;h.messageType===n.MessageType.Text&&d.setProperty(r.PropertyId.SpeechServiceResponse_JsonResult,h.textBody);let p,f;switch(h.path.toLowerCase()){case"speech.phrase":const g=o.SimpleSpeechPhrase.fromJSON(h.textBody);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+g.Offset+g.Duration),g.RecognitionStatus!==o.RecognitionStatus.TooManyRequests&&g.RecognitionStatus!==o.RecognitionStatus.Error){const C=this.fireEventForResult(g,d);if(this.privLastResult=C.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,C)}catch{}}f=!0;break;case"speech.hypothesis":const m=o.SpeechHypothesis.fromJSON(h.textBody),y=m.Offset+this.privRequestSession.currentTurnAudioOffset;p=new r.SpeechRecognitionResult(this.privRequestSession.requestId,r.ResultReason.RecognizingSpeech,m.Text,m.Duration,y,m.Language,m.LanguageDetectionConfidence,void 0,void 0,h.textBody,d),this.privRequestSession.onHypothesis(y);const S=new r.SpeechRecognitionEventArgs(p,m.Duration,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,S)}catch{}f=!0;break;case"speech.keyword":const x=o.SpeechKeyword.fromJSON(h.textBody);p=new r.SpeechRecognitionResult(this.privRequestSession.requestId,x.Status==="Accepted"?r.ResultReason.RecognizedKeyword:r.ResultReason.NoMatch,x.Text,x.Duration,x.Offset,void 0,void 0,void 0,void 0,h.textBody,d),x.Status!=="Accepted"&&(this.privLastResult=p);const w=new r.SpeechRecognitionEventArgs(p,p.duration,p.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,w)}catch{}f=!0;break;case"audio":{const C=h.requestId.toUpperCase(),E=this.privTurnStateManager.GetTurn(C);try{h.binaryBody?E.audioStream.write(h.binaryBody):E.endAudioStream()}catch{}}f=!0;break;case"response":this.handleResponseMessage(h),f=!0;break}const v=new n.Deferred;return v.resolve(f),v.promise}async cancelRecognition(h,d,p,f,v){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&await this.privRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){const g=new r.PropertyCollection;g.setProperty(o.CancellationErrorCodePropertyName,r.CancellationErrorCode[f]);const m=new r.SpeechRecognitionCanceledEventArgs(p,v,f,void 0,h);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,m)}catch{}if(this.privSuccessCallback){const y=new r.SpeechRecognitionResult(void 0,r.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,v,void 0,g);try{this.privSuccessCallback(y),this.privSuccessCallback=void 0}catch{}}}}async listenOnce(h,d,p){this.privRecognizerConfig.recognitionMode=h,this.privSuccessCallback=d,this.privErrorCallback=p,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(r.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const f=this.connectImpl(),v=this.sendPreAudioMessages(),g=await this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),m=await this.privDialogAudioSource.format,y=await this.privDialogAudioSource.deviceInfo,S=new t.ReplayableAudioNode(g,m.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(S,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:y};try{await f,await v}catch(C){return await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.ConnectionFailure,C),Promise.resolve()}const x=new r.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,x),this.sendAudio(S).then(()=>{},async C=>{await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.RuntimeError,C)})}dialogConnectImpl(h){return this.privConnectionLoop=this.startMessageLoop(),h}receiveDialogMessageOverride(){const h=new n.Deferred,d=async()=>{try{const p=this.isDisposed(),f=!this.isDisposed()&&this.terminateMessageLoop;if(p||f){h.resolve(void 0);return}const g=await(await this.fetchConnection()).read();if(!g)return d();const m=l.SpeechConnectionMessage.fromConnectionMessage(g);switch(m.path.toLowerCase()){case"turn.start":{const T=m.requestId.toUpperCase(),M=this.privRequestSession.requestId.toUpperCase();T!==M?this.privTurnStateManager.StartTurn(T):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const S=o.SpeechDetected.fromJSON(m.textBody),x=new r.RecognitionEventArgs(S.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,x);break;case"speech.enddetected":let w;m.textBody.length>0?w=m.textBody:w="{ Offset: 0 }";const C=o.SpeechDetected.fromJSON(w);this.privRequestSession.onServiceRecognized(C.Offset+this.privRequestSession.currentTurnAudioOffset);const E=new r.RecognitionEventArgs(C.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,E);break;case"turn.end":{const T=m.requestId.toUpperCase(),M=this.privRequestSession.requestId.toUpperCase();if(T!==M)this.privTurnStateManager.CompleteTurn(T);else{const _=new r.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(!1),(!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,_),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(R){this.privErrorCallback&&this.privErrorCallback(R)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{await this.processTypeSpecificMessages(m)||this.serviceEvents&&this.serviceEvents.onEvent(new n.ServiceEvent(m.path.toLowerCase(),m.textBody))}catch{}}return d()}catch{this.terminateMessageLoop=!0,h.resolve()}};return d().catch(p=>{n.Events.instance.onEvent(new n.BackgroundEvent(p))}),h.promise}async startMessageLoop(){this.terminateMessageLoop=!1;try{await this.receiveDialogMessageOverride()}catch(h){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,r.CancellationReason.Error,r.CancellationErrorCode.RuntimeError,h)}return Promise.resolve()}async configConnection(h){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(await this.sendSpeechServiceConfig(h,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendAgentConfig(h),h)}async sendPreAudioMessages(){const h=await this.fetchConnection();this.addKeywordContextData(),await this.sendSpeechContext(h,!0),await this.sendAgentContext(h),await this.sendWaveHeader(h)}sendAgentConfig(h){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(r.PropertyId.Conversation_DialogType)===r.DialogServiceConfig.DialogTypes.CustomCommands){const p=this.agentConfig.get();p.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(r.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(p)}this.onEvent(new e.SendingAgentContextMessageEvent(this.agentConfig));const d=this.agentConfig.toJsonString();return this.agentConfigSent=!0,h.send(new l.SpeechConnectionMessage(n.MessageType.Text,"agent.config",this.privRequestSession.requestId,"application/json",d))}}sendAgentContext(h){const d=n.createGuid(),p=this.privDialogServiceConnector.properties.getProperty(r.PropertyId.Conversation_Speech_Activity_Template),v=JSON.stringify({channelData:"",context:{interactionId:d},messagePayload:typeof p===void 0?void 0:p,version:.5});return h.send(new l.SpeechConnectionMessage(n.MessageType.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",v))}fireEventForResult(h,d){const p=o.EnumTranslation.implTranslateRecognitionResult(h.RecognitionStatus),f=h.Offset+this.privRequestSession.currentTurnAudioOffset,v=new r.SpeechRecognitionResult(this.privRequestSession.requestId,p,h.DisplayText,h.Duration,f,h.Language,h.LanguageDetectionConfidence,void 0,void 0,JSON.stringify(h),d);return new r.SpeechRecognitionEventArgs(v,f,this.privRequestSession.sessionId)}handleResponseMessage(h){const d=JSON.parse(h.textBody);switch(d.messageType.toLowerCase()){case"message":const p=h.requestId.toUpperCase(),f=a.ActivityPayloadResponse.fromJSON(h.textBody),v=this.privTurnStateManager.GetTurn(p);if(f.conversationId){const y=this.agentConfig.get();y.botInfo.conversationId=f.conversationId,this.agentConfig.set(y)}const g=v.processActivityPayload(f,i.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(r.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),m=new r.ActivityReceivedEventArgs(f.messagePayload,g);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,m)}catch{}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new r.TurnStatusReceivedEventArgs(h.textBody))}catch{}break;default:n.Events.instance.onEvent(new n.BackgroundEvent(`Unexpected response of type ${d.messageType}. Ignoring.`));break}}onEvent(h){this.privEvents.onEvent(h),n.Events.instance.onEvent(h)}addKeywordContextData(){const h=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(h===void 0)return;const d=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),p=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),f=h.split(";"),v=d===void 0?[]:d.split(";"),g=p===void 0?[]:p.split(";"),m=[];for(let y=0;y<f.length;y++){const S={};S.text=f[y],y<v.length&&(S.offset=Number(v[y])),y<g.length&&(S.duration=Number(g[y])),m.push(S)}this.speechContext.setSection("invocationSource","VoiceActivationWithKeyword"),this.speechContext.setSection("keywordDetection",[{clientDetectedKeywords:m,onReject:{action:"EndOfTurn"},type:"startTrigger"}])}};return pm.DialogServiceAdapter=c,pm}var Bx={};Object.defineProperty(Bx,"__esModule",{value:!0});Bx.AgentConfig=void 0;class GK{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}Bx.AgentConfig=GK;var z_={},fm={},ap={};Object.defineProperty(ap,"__esModule",{value:!0});ap.ConversationConnectionConfig=void 0;const qK=M0;class ar extends qK.RestConfigBase{static get host(){return ar.privHost}static get apiVersion(){return ar.privApiVersion}static get clientAppId(){return ar.privClientAppId}static get defaultLanguageCode(){return ar.privDefaultLanguageCode}static get restPath(){return ar.privRestPath}static get webSocketPath(){return ar.privWebSocketPath}static get transcriptionEventKeys(){return ar.privTranscriptionEventKeys}}ap.ConversationConnectionConfig=ar;ar.privHost="dev.microsofttranslator.com";ar.privRestPath="/capito/room";ar.privApiVersion="2.0";ar.privDefaultLanguageCode="en-US";ar.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15";ar.privWebSocketPath="/capito/translate";ar.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"];var Ck;function XK(){if(Ck)return fm;Ck=1,Object.defineProperty(fm,"__esModule",{value:!0}),fm.ConversationManager=void 0;const t=zi(),e=Ct,n=me(),i=ap;let r=class{constructor(){this.privRequestParams=i.ConversationConnectionConfig.configParams,this.privErrors=i.ConversationConnectionConfig.restErrors,this.privHost=i.ConversationConnectionConfig.host,this.privApiVersion=i.ConversationConnectionConfig.apiVersion,this.privRestPath=i.ConversationConnectionConfig.restPath,this.privRestAdapter=new t.RestMessageAdapter({})}createOrJoin(o,a,l,c){try{e.Contracts.throwIfNullOrUndefined(o,"args");const u=o.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,i.ConversationConnectionConfig.defaultLanguageCode),h=o.getProperty(n.PropertyId.ConversationTranslator_Name,"conversation_host"),d=o.getProperty(n.PropertyId.ConversationTranslator_Host,this.privHost),p=o.getProperty(n.PropertyId.ConversationTranslator_CorrelationId),f=o.getProperty(n.PropertyId.SpeechServiceConnection_Key),v=o.getProperty(n.PropertyId.SpeechServiceConnection_Region),g=o.getProperty(n.PropertyId.SpeechServiceAuthorization_Token);e.Contracts.throwIfNullOrWhitespace(u,"languageCode"),e.Contracts.throwIfNullOrWhitespace(h,"nickname"),e.Contracts.throwIfNullOrWhitespace(d,"endpointHost");const m={};m[this.privRequestParams.apiVersion]=this.privApiVersion,m[this.privRequestParams.languageCode]=u,m[this.privRequestParams.nickname]=h;const y={};p&&(y[this.privRequestParams.correlationId]=p),y[this.privRequestParams.clientAppId]=i.ConversationConnectionConfig.clientAppId,a!==void 0?m[this.privRequestParams.roomId]=a:(e.Contracts.throwIfNullOrUndefined(v,this.privErrors.authInvalidSubscriptionRegion),y[this.privRequestParams.subscriptionRegion]=v,f?y[this.privRequestParams.subscriptionKey]=f:g?y[this.privRequestParams.authorization]=`Bearer ${g}`:e.Contracts.throwIfNullOrUndefined(f,this.privErrors.authInvalidSubscriptionKey));const S={};S.headers=y,this.privRestAdapter.options=S;const x=`https://${d}${this.privRestPath}`;this.privRestAdapter.request(t.RestRequestType.Post,x,m,null).then(w=>{const C=t.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,w.headers);if(!w.ok){if(c){let T=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",w.status.toString()),M;try{M=JSON.parse(w.data),T+=` [${M.error.code}: ${M.error.message}]`}catch{T+=` [${w.data}]`}C&&(T+=` ${C}`),c(T)}return}const E=JSON.parse(w.data);if(E&&(E.requestId=C),l){try{l(E)}catch(T){c&&c(T)}l=void 0}}).catch(()=>{})}catch(u){if(c)if(u instanceof Error){const h=u;c(h.name+": "+h.message)}else c(u)}}leave(o,a){return new Promise((l,c)=>{try{e.Contracts.throwIfNullOrUndefined(o,this.privErrors.invalidArgs.replace("{arg}","config")),e.Contracts.throwIfNullOrWhitespace(a,this.privErrors.invalidArgs.replace("{arg}","token"));const u=o.getProperty(n.PropertyId.ConversationTranslator_Host,this.privHost),h=o.getProperty(n.PropertyId.ConversationTranslator_CorrelationId),d={};d[this.privRequestParams.apiVersion]=this.privApiVersion,d[this.privRequestParams.sessionToken]=a;const p={};h&&(p[this.privRequestParams.correlationId]=h);const f={};f.headers=p,this.privRestAdapter.options=f;const v=`https://${u}${this.privRestPath}`;this.privRestAdapter.request(t.RestRequestType.Delete,v,d,null).then(g=>{g.ok,l()}).catch(()=>{})}catch(u){if(u instanceof Error){const h=u;c(h.name+": "+h.message)}else c(u)}})}};return fm.ConversationManager=r,fm}var zc={},mm={},$x={},k0={};Object.defineProperty(k0,"__esModule",{value:!0});k0.ConversationConnectionMessage=void 0;const KK=ht();class YK extends KK.ConnectionMessage{constructor(e,n,i,r){super(e,n,i,r);const s=JSON.parse(this.textBody);s.type!==void 0&&(this.privConversationMessageType=s.type)}get conversationMessageType(){return this.privConversationMessageType}}k0.ConversationConnectionMessage=YK;Object.defineProperty($x,"__esModule",{value:!0});$x.ConversationWebsocketMessageFormatter=void 0;const Uc=ht(),_k=k0;class JK{toConnectionMessage(e){const n=new Uc.Deferred;try{if(e.messageType===Uc.MessageType.Text){const i=new _k.ConversationConnectionMessage(e.messageType,e.textContent,{},e.id);n.resolve(i)}else e.messageType===Uc.MessageType.Binary&&n.resolve(new _k.ConversationConnectionMessage(e.messageType,e.binaryContent,void 0,e.id))}catch(i){n.reject(`Error formatting the message. Error: ${i}`)}return n.promise}fromConnectionMessage(e){const n=new Uc.Deferred;try{if(e.messageType===Uc.MessageType.Text){const i=`${e.textBody?e.textBody:""}`;n.resolve(new Uc.RawWebsocketMessage(Uc.MessageType.Text,i,e.id))}}catch(i){n.reject(`Error formatting the message. ${i}`)}return n.promise}}$x.ConversationWebsocketMessageFormatter=JK;var wk;function QK(){if(wk)return mm;wk=1,Object.defineProperty(mm,"__esModule",{value:!0}),mm.ConversationConnectionFactory=void 0;const t=zi(),e=ht(),n=Ct,i=me(),r=No(),s=ap,o=$x;let a=class extends r.ConnectionFactoryBase{create(c,u,h){const d=c.parameters.getProperty(i.PropertyId.ConversationTranslator_Host,s.ConversationConnectionConfig.host),p=c.parameters.getProperty(i.PropertyId.ConversationTranslator_CorrelationId,e.createGuid()),f=`wss://${d}${s.ConversationConnectionConfig.webSocketPath}`,v=c.parameters.getProperty(i.PropertyId.ConversationTranslator_Token,void 0);n.Contracts.throwIfNullOrUndefined(v,"token");const g={};g[s.ConversationConnectionConfig.configParams.apiVersion]=s.ConversationConnectionConfig.apiVersion,g[s.ConversationConnectionConfig.configParams.token]=v,g[s.ConversationConnectionConfig.configParams.correlationId]=p;const m=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new t.WebsocketConnection(f,g,{},new o.ConversationWebsocketMessageFormatter,t.ProxyInfo.fromRecognizerConfig(c),m,h)}};return mm.ConversationConnectionFactory=a,mm}var gm={},Hx={};Object.defineProperty(Hx,"__esModule",{value:!0});Hx.ConversationRequestSession=void 0;const U_=ht();class ZK{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=e,this.privRequestId=U_.createNoDashGuid(),this.privRequestCompletionDeferral=new U_.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(e,n){this.privSessionId=n}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){e!==200&&e===403&&this.onComplete()}onServiceTurnEndResponse(e){e?this.privRequestId=U_.createNoDashGuid():this.onComplete()}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)await e.detach()}}onComplete(){}}Hx.ConversationRequestSession=ZK;var yr={},Ek;function _B(){if(Ek)return yr;Ek=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.ConversationReceivedTranslationEventArgs=yr.ParticipantsListEventArgs=yr.ParticipantAttributeEventArgs=yr.ParticipantEventArgs=yr.LockRoomEventArgs=yr.MuteAllEventArgs=void 0;const t=me();class e extends t.SessionEventArgs{constructor(l,c){super(c),this.privIsMuted=l}get isMuted(){return this.privIsMuted}}yr.MuteAllEventArgs=e;class n extends t.SessionEventArgs{constructor(l,c){super(c),this.privIsLocked=l}get isMuted(){return this.privIsLocked}}yr.LockRoomEventArgs=n;class i extends t.SessionEventArgs{constructor(l,c){super(c),this.privParticipant=l}get participant(){return this.privParticipant}}yr.ParticipantEventArgs=i;class r extends t.SessionEventArgs{constructor(l,c,u,h){super(h),this.privKey=c,this.privValue=u,this.privParticipantId=l}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}yr.ParticipantAttributeEventArgs=r;class s extends t.SessionEventArgs{constructor(l,c,u,h,d,p,f,v,g){super(g),this.privRoomId=l,this.privSessionToken=c,this.privTranslateTo=u,this.privProfanityFilter=h,this.privRoomProfanityFilter=d,this.privIsRoomLocked=p,this.privIsRoomLocked=f,this.privParticipants=v}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}yr.ParticipantsListEventArgs=s;class o{constructor(l,c,u){this.privPayload=c,this.privCommand=l,this.privSessionId=u}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}return yr.ConversationReceivedTranslationEventArgs=o,yr}var Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.ConversationTranslatorCommandTypes=Ha.ConversationTranslatorMessageTypes=Ha.InternalParticipants=void 0;class eY{constructor(e=[],n){this.participants=e,this.meId=n}addOrUpdateParticipant(e){if(e===void 0)return;const n=this.getParticipantIndex(e.id);return n>-1?this.participants.splice(n,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex(n=>n.id===e)}getParticipant(e){return this.participants.find(n=>n.id===e)}deleteParticipant(e){this.participants=this.participants.filter(n=>n.id!==e)}get host(){return this.participants.find(e=>e.isHost===!0)}get me(){return this.getParticipant(this.meId)}}Ha.InternalParticipants=eY;Ha.ConversationTranslatorMessageTypes={command:"command",final:"final",info:"info",instantMessage:"instant_message",keepAlive:"keep_alive",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"};Ha.ConversationTranslatorCommandTypes={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"};var wB={},Vx={};Object.defineProperty(Vx,"__esModule",{value:!0});Vx.CommandResponsePayload=void 0;const tY=t=>JSON.parse(t);class b2{constructor(e){this.privCommandResponse=tY(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(e){return new b2(e)}}Vx.CommandResponsePayload=b2;var Id={};Object.defineProperty(Id,"__esModule",{value:!0});Id.ParticipantPayloadResponse=Id.ParticipantsListPayloadResponse=void 0;const nY=t=>JSON.parse(t),iY=t=>JSON.parse(t);class A2{constructor(e){this.privParticipantsPayloadResponse=nY(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(e){return new A2(e)}}Id.ParticipantsListPayloadResponse=A2;class P2{constructor(e){this.privParticipantPayloadResponse=iY(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(e){return new P2(e)}}Id.ParticipantPayloadResponse=P2;var Md={};Object.defineProperty(Md,"__esModule",{value:!0});Md.TextResponsePayload=Md.SpeechResponsePayload=void 0;const rY=t=>JSON.parse(t),sY=t=>JSON.parse(t);class I2{constructor(e){this.privSpeechResponse=rY(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return this.privSpeechResponse.type==="final"}static fromJSON(e){return new I2(e)}}Md.SpeechResponsePayload=I2;class M2{constructor(e){this.privTextResponse=sY(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(e){return new M2(e)}}Md.TextResponsePayload=M2;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Vx;Object.defineProperty(t,"CommandResponsePayload",{enumerable:!0,get:function(){return e.CommandResponsePayload}});var n=Id;Object.defineProperty(t,"ParticipantsListPayloadResponse",{enumerable:!0,get:function(){return n.ParticipantsListPayloadResponse}}),Object.defineProperty(t,"ParticipantPayloadResponse",{enumerable:!0,get:function(){return n.ParticipantPayloadResponse}});var i=Md;Object.defineProperty(t,"SpeechResponsePayload",{enumerable:!0,get:function(){return i.SpeechResponsePayload}}),Object.defineProperty(t,"TextResponsePayload",{enumerable:!0,get:function(){return i.TextResponsePayload}})})(wB);var Rk;function oY(){if(Rk)return gm;Rk=1,Object.defineProperty(gm,"__esModule",{value:!0}),gm.ConversationServiceAdapter=void 0;const t=ht(),e=me(),n=Ve(),i=k0,r=Hx,s=_B(),o=Ha,a=wB;let l=class extends n.ServiceRecognizerBase{constructor(u,h,d,p,f){super(u,h,d,p,f),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=f,this.privConversationAuthentication=u,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=v=>this.conversationConnectImpl(v),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new r.ConversationRequestSession(t.createNoDashGuid()),this.privConversationConnectionFactory=h,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}async dispose(u){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise!==void 0&&await(await this.privConnectionConfigPromise).dispose(u),await super.dispose(u)}async sendMessage(u){return(await this.fetchConnection()).send(new i.ConversationConnectionMessage(t.MessageType.Text,u))}async sendMessageAsync(u){await(await this.fetchConnection()).send(new i.ConversationConnectionMessage(t.MessageType.Text,u))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,e.CancellationReason.Error,e.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}async processTypeSpecificMessages(){return!0}cancelRecognition(u,h,d,p,f){this.terminateMessageLoop=!0;const v=new e.ConversationTranslationCanceledEventArgs(d,f,p,void 0,u);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,v)}catch{}}async conversationConnectImpl(u){return this.privConnectionLoop=this.startMessageLoop(),u}async receiveConversationMessageOverride(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();const u=new t.Deferred;try{const d=await(await this.fetchConnection()).read();if(this.isDisposed()||this.terminateMessageLoop)return u.resolve(),Promise.resolve();if(!d)return this.receiveConversationMessageOverride();const p=this.privConversationRequestSession.sessionId,f=d.conversationMessageType.toLowerCase();let v=!1;try{switch(f){case"info":case"participant_command":case"command":const g=a.CommandResponsePayload.fromJSON(d.textBody);switch(g.command.toLowerCase()){case"participantlist":const C=a.ParticipantsListPayloadResponse.fromJSON(d.textBody),E=C.participants.map(z=>({avatar:z.avatar,displayName:z.nickname,id:z.participantId,isHost:z.ishost,isMuted:z.ismuted,isUsingTts:z.usetts,preferredLanguage:z.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new s.ParticipantsListEventArgs(C.roomid,C.token,C.translateTo,C.profanityFilter,C.roomProfanityFilter,C.roomLocked,C.muteAll,E,p));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setTranslateToLanguages,g.value,p));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setProfanityFiltering,g.value,p));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setMute,g.value,p));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new s.MuteAllEventArgs(g.value,p));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new e.ConversationExpirationEventArgs(g.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.setUseTTS,g.value,p));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new s.LockRoomEventArgs(g.value,p));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new s.ParticipantAttributeEventArgs(g.participantId,o.ConversationTranslatorCommandTypes.changeNickname,g.value,p));break;case"joinsession":const T=a.ParticipantPayloadResponse.fromJSON(d.textBody),M={avatar:T.avatar,displayName:T.nickname,id:T.participantId,isHost:T.ishost,isMuted:T.ismuted,isUsingTts:T.usetts,preferredLanguage:T.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new s.ParticipantEventArgs(M,p));break;case"leavesession":const _={id:g.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new s.ParticipantEventArgs(_,p));break;case"disconnectsession":const R={id:g.participantId};break;case"token":const L=new n.CognitiveTokenAuthentication(()=>{const z=g.token;return Promise.resolve(z)},()=>{const z=g.token;return Promise.resolve(z)});this.authentication=L,this.privConversationServiceConnector.onToken(L);break;default:break}break;case"partial":case"final":const m=a.SpeechResponsePayload.fromJSON(d.textBody),y=f==="final"?e.ResultReason.TranslatedParticipantSpeech:e.ResultReason.TranslatingParticipantSpeech,S=new e.ConversationTranslationResult(m.participantId,this.getTranslations(m.translations),m.language,m.id,y,m.recognition,void 0,void 0,d.textBody,void 0);m.isFinal?((S.text!==void 0&&S.text.length>0||m.id===this.privLastPartialUtteranceId)&&(v=!0),v&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new s.ConversationReceivedTranslationEventArgs(o.ConversationTranslatorMessageTypes.final,S,p))):S.text!==void 0&&(this.privLastPartialUtteranceId=m.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new s.ConversationReceivedTranslationEventArgs(o.ConversationTranslatorMessageTypes.partial,S,p)));break;case"translated_message":const x=a.TextResponsePayload.fromJSON(d.textBody),w=new e.ConversationTranslationResult(x.participantId,this.getTranslations(x.translations),x.language,void 0,void 0,x.originalText,void 0,void 0,void 0,d.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new s.ConversationReceivedTranslationEventArgs(o.ConversationTranslatorMessageTypes.instantMessage,w,p));break;default:break}}catch{}return this.receiveConversationMessageOverride()}catch{this.terminateMessageLoop=!0}return u.promise}async startMessageLoop(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;const u=this.receiveConversationMessageOverride();try{return await u}catch(h){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",e.CancellationReason.Error,e.CancellationErrorCode.RuntimeError,h),null}}configConnection(){return this.isDisposed()?Promise.resolve(void 0):this.privConnectionConfigPromise!==void 0?this.privConnectionConfigPromise.then(u=>u.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise,()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection())):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then(u=>u),this.privConnectionConfigPromise)}getTranslations(u){let h;if(u!==void 0){h=new e.Translations;for(const d of u)h.set(d.lang,d.translation)}return h}};return gm.ConversationServiceAdapter=l,gm}var Tk;function aY(){if(Tk)return zc;Tk=1,Object.defineProperty(zc,"__esModule",{value:!0}),zc.ConversationTranslatorRecognizer=zc.ConversationRecognizerFactory=void 0;const t=Ve(),e=ht(),n=Ct,i=me(),r=QK(),s=oY();class o{static fromConfig(c,u,h){return new a(c,u,h)}}zc.ConversationRecognizerFactory=o;let a=class extends i.Recognizer{constructor(c,u,h){const d=u;n.Contracts.throwIfNull(d,"speechConfig");const p=c;n.Contracts.throwIfNull(p,"conversationImpl"),super(h,d.properties,new r.ConversationConnectionFactory),this.privConversation=p,this.privIsDisposed=!1,this.privProperties=d.properties.clone(),this.privConnection=i.Connection.fromRecognizer(this),this.privProperties.getProperty(i.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?(this.privSetTimeout=e.Timeout.setTimeout,this.privClearTimeout=e.Timeout.clearTimeout):typeof window<"u"?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(c){this.privConnection.connected=c}set disconnected(c){this.privConnection.disconnected=c}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(c,u,h){try{n.Contracts.throwIfDisposed(this.privIsDisposed),n.Contracts.throwIfNullOrWhitespace(c,"token"),this.privReco.conversationTranslatorToken=c,this.resetConversationTimeout(),this.privReco.connectAsync(u,h)}catch(d){if(h)if(d instanceof Error){const p=d;h(p.name+": "+p.message)}else h(d)}}disconnect(c,u){try{n.Contracts.throwIfDisposed(this.privIsDisposed),this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then(()=>{c&&c()},h=>{u&&u(h)})}catch(h){if(u)if(h instanceof Error){const d=h;u(d.name+": "+d.message)}else u(h);this.dispose(!0).catch(d=>{e.Events.instance.onEvent(new e.BackgroundEvent(d))})}}sendRequest(c,u,h){try{n.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(c,u,h)}catch(d){if(h)if(d instanceof Error){const p=d;h(p.name+": "+p.message)}else h(d);this.dispose(!0).catch(p=>{e.Events.instance.onEvent(new e.BackgroundEvent(p))})}}onToken(c){this.privConversation.onToken(c)}async close(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,await this.dispose(!0))}async dispose(c){this.privIsDisposed||c&&(this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),await super.dispose(c))}createRecognizerConfig(c){return new t.RecognizerConfig(c,this.privProperties)}createServiceRecognizer(c,u,h,d){const p=h;return new s.ConversationServiceAdapter(c,u,p,d,this)}sendMessage(c,u,h){const d=this.privReco;((f,v,g)=>{f!==void 0?f.then(()=>{try{v&&v()}catch(m){g&&g(`'Unhandled error on promise callback: ${m}'`)}},m=>{try{g&&g(m)}catch{}}):g&&g("Null promise")})(d.sendMessageAsync(c),u,h),this.resetConversationTimeout()}resetConversationTimeout(){this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout(()=>{this.sendRequest(this.privConversation.getKeepAlive())},6e4)}};return zc.ConversationTranslatorRecognizer=a,zc}var vm={},bk;function lY(){if(bk)return vm;bk=1,Object.defineProperty(vm,"__esModule",{value:!0}),vm.TranscriberRecognizer=void 0;const t=ht(),e=Ct,n=me(),i=Ve();let r=class extends n.Recognizer{constructor(o,a){const l=o;e.Contracts.throwIfNull(l,"speechTranslationConfig");const c=a;e.Contracts.throwIfNull(c,"audioConfigImpl"),e.Contracts.throwIfNullOrWhitespace(l.speechRecognitionLanguage,n.PropertyId[n.PropertyId.SpeechServiceConnection_RecoLanguage]),super(a,l.properties,new i.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return e.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){e.Contracts.throwIfNullOrWhitespace(o,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,o)}set conversation(o){e.Contracts.throwIfNullOrUndefined(o,"Conversation"),this.isMeetingRecognizer=!1,this.privConversation=o}getConversationInfo(){return e.Contracts.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}set meeting(o){e.Contracts.throwIfNullOrUndefined(o,"Meeting"),this.isMeetingRecognizer=!0,this.privMeeting=o}getMeetingInfo(){return e.Contracts.throwIfNullOrUndefined(this.privMeeting,"Meeting"),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(o,a){t.marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(i.RecognitionMode.Conversation),o,a)}stopContinuousRecognitionAsync(o,a){t.marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(),o,a)}async close(){this.privDisposedRecognizer||await this.dispose(!0)}async pushConversationEvent(o,a){const l=this.privReco;e.Contracts.throwIfNullOrUndefined(l,"serviceRecognizer"),await l.sendSpeechEventAsync(o,a)}async pushMeetingEvent(o,a){const l=this.privReco;e.Contracts.throwIfNullOrUndefined(l,"serviceRecognizer"),await l.sendMeetingSpeechEventAsync(o,a)}async enforceAudioGating(){const l=(await this.audioConfig.format).channels;if(l===1){if(this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()!=="true")throw new Error("Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(l!==8)throw new Error(`Unsupported audio configuration: Detected ${l}-channel audio`)}connectMeetingCallbacks(o){this.isMeetingRecognizer=!0,this.canceled=(a,l)=>{o.canceled&&o.canceled(o,l)},this.recognizing=(a,l)=>{o.transcribing&&o.transcribing(o,l)},this.recognized=(a,l)=>{o.transcribed&&o.transcribed(o,l)},this.sessionStarted=(a,l)=>{o.sessionStarted&&o.sessionStarted(o,l)},this.sessionStopped=(a,l)=>{o.sessionStopped&&o.sessionStopped(o,l)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}async dispose(o){this.privDisposedRecognizer||(o&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(o))}createRecognizerConfig(o){return new i.RecognizerConfig(o,this.properties)}createServiceRecognizer(o,a,l,c){const u=l;return new i.TranscriptionServiceRecognizer(o,a,u,c,this)}};return vm.TranscriberRecognizer=r,vm}var Ak;function cY(){return Ak||(Ak=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=XK();Object.defineProperty(t,"ConversationManager",{enumerable:!0,get:function(){return e.ConversationManager}});var n=ap;Object.defineProperty(t,"ConversationConnectionConfig",{enumerable:!0,get:function(){return n.ConversationConnectionConfig}});var i=aY();Object.defineProperty(t,"ConversationRecognizerFactory",{enumerable:!0,get:function(){return i.ConversationRecognizerFactory}});var r=lY();Object.defineProperty(t,"TranscriberRecognizer",{enumerable:!0,get:function(){return r.TranscriberRecognizer}});var s=_B();Object.defineProperty(t,"ConversationReceivedTranslationEventArgs",{enumerable:!0,get:function(){return s.ConversationReceivedTranslationEventArgs}}),Object.defineProperty(t,"LockRoomEventArgs",{enumerable:!0,get:function(){return s.LockRoomEventArgs}}),Object.defineProperty(t,"MuteAllEventArgs",{enumerable:!0,get:function(){return s.MuteAllEventArgs}}),Object.defineProperty(t,"ParticipantAttributeEventArgs",{enumerable:!0,get:function(){return s.ParticipantAttributeEventArgs}}),Object.defineProperty(t,"ParticipantEventArgs",{enumerable:!0,get:function(){return s.ParticipantEventArgs}}),Object.defineProperty(t,"ParticipantsListEventArgs",{enumerable:!0,get:function(){return s.ParticipantsListEventArgs}});var o=Ha;Object.defineProperty(t,"ConversationTranslatorCommandTypes",{enumerable:!0,get:function(){return o.ConversationTranslatorCommandTypes}}),Object.defineProperty(t,"ConversationTranslatorMessageTypes",{enumerable:!0,get:function(){return o.ConversationTranslatorMessageTypes}}),Object.defineProperty(t,"InternalParticipants",{enumerable:!0,get:function(){return o.InternalParticipants}})}(z_)),z_}var k2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SynthesisAudioMetadata=t.MetadataType=void 0,function(n){n.WordBoundary="WordBoundary",n.Bookmark="Bookmark",n.Viseme="Viseme",n.SentenceBoundary="SentenceBoundary",n.SessionEnd="SessionEnd",n.AvatarSignal="TalkingAvatarSignal"}(t.MetadataType||(t.MetadataType={}));class e{constructor(i){this.privSynthesisAudioMetadata=JSON.parse(i)}static fromJSON(i){return new e(i)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}t.SynthesisAudioMetadata=e})(k2);var ym={},ta={};Object.defineProperty(ta,"__esModule",{value:!0});ta.SynthesisStartedEvent=ta.ConnectingToSynthesisServiceEvent=ta.SynthesisTriggeredEvent=ta.SpeechSynthesisEvent=void 0;const Pk=ht();class jx extends Pk.PlatformEvent{constructor(e,n,i=Pk.EventType.Info){super(e,i),this.privRequestId=n}get requestId(){return this.privRequestId}}ta.SpeechSynthesisEvent=jx;class uY extends jx{constructor(e,n,i){super("SynthesisTriggeredEvent",e),this.privSessionAudioDestinationId=n,this.privTurnAudioDestinationId=i}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}ta.SynthesisTriggeredEvent=uY;class hY extends jx{constructor(e,n){super("ConnectingToSynthesisServiceEvent",e),this.privAuthFetchEventId=n}get authFetchEventId(){return this.privAuthFetchEventId}}ta.ConnectingToSynthesisServiceEvent=hY;class dY extends jx{constructor(e,n){super("SynthesisStartedEvent",e),this.privAuthFetchEventId=n}get authFetchEventId(){return this.privAuthFetchEventId}}ta.SynthesisStartedEvent=dY;var Ik;function pY(){if(Ik)return ym;Ik=1,Object.defineProperty(ym,"__esModule",{value:!0}),ym.SynthesisTurn=void 0;const t=ht(),e=Vi,n=me(),i=k2,r=ta;let s=class hR{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=t.createNoDashGuid(),this.privTurnDeferral=new t.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(a){this.privStreamId=a}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(a){this.privAudioOutputFormat=a}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){const a=new n.PropertyCollection;return a.setProperty(n.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),a}}async getAllReceivedAudio(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(await this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}async getAllReceivedAudioWithHeader(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){const a=await this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(a),this.privReceivedAudioWithHeader}else return this.getAllReceivedAudio()}startNewSynthesis(a,l,c,u){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=a,this.privRawText=l,this.privIsSSML=c,this.privAudioOutputStream=new e.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",this.privWebRTCSDP="",u!==void 0&&(this.privTurnAudioDestination=u,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new r.SynthesisTriggeredEvent(this.requestId,void 0,u===void 0?void 0:u.id()))}onPreConnectionStart(a){this.privAuthFetchEventId=a,this.onEvent(new r.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(a){a&&this.onComplete()}onConnectionEstablishCompleted(a){if(a===200){this.onEvent(new r.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0;return}else a===403&&this.onComplete()}onServiceResponseMessage(a){const l=JSON.parse(a);this.streamId=l.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(a){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new t.Deferred;const l=JSON.parse(a);l.webrtc&&(this.privWebRTCSDP=l.webrtc.connectionString)}onAudioChunkReceived(a){this.isSynthesizing&&(this.privAudioOutputStream.write(a),this.privBytesReceived+=a.byteLength,this.privTurnAudioDestination!==void 0&&this.privTurnAudioDestination.write(a))}onTextBoundaryEvent(a){this.updateTextOffset(a.Data.text.Text,a.Type)}onVisemeMetadataReceived(a){a.Data.AnimationChunk!==void 0&&(this.privPartialVisemeAnimation+=a.Data.AnimationChunk)}onSessionEnd(a){this.privAudioDuration=a.Data.Offset}async constructSynthesisResult(){const a=await this.getAllReceivedAudioWithHeader();return new n.SpeechSynthesisResult(this.requestId,n.ResultReason.SynthesizingAudioCompleted,a,void 0,this.extraProperties,this.audioDuration)}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){const a=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",a}onEvent(a){t.Events.instance.onEvent(a)}static isXmlTag(a){return a.length>=2&&a[0]==="<"&&a[a.length-1]===">"}updateTextOffset(a,l){l===i.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(a,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+a.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!hR.isXmlTag(a)&&this.updateTextOffset(a,l))):(this.privSentenceOffset=this.privRawText.indexOf(a,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+a.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!hR.isXmlTag(a)&&this.updateTextOffset(a,l)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,this.privTurnAudioDestination!==void 0&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}async readAllAudioFromStream(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{await this.privAudioOutputStream.read(this.privReceivedAudio)}catch{this.privReceivedAudio=new ArrayBuffer(0)}}}withinXmlTag(a){return this.privRawText.indexOf("<",a+1)>this.privRawText.indexOf(">",a+1)}};return ym.SynthesisTurn=s,ym}var Sm={},Mk;function fY(){if(Mk)return Sm;Mk=1,Object.defineProperty(Sm,"__esModule",{value:!0}),Sm.SynthesisAdapterBase=void 0;const t=ht(),e=me(),n=Ve(),i=tl;let r=class{constructor(o,a,l,c){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!o)throw new t.ArgumentNullError("authentication");if(!a)throw new t.ArgumentNullError("connectionFactory");if(!l)throw new t.ArgumentNullError("synthesizerConfig");this.privAuthentication=o,this.privConnectionFactory=a,this.privSynthesizerConfig=l,this.privIsDisposed=!1,this.privSessionAudioDestination=c,this.privSynthesisTurn=new n.SynthesisTurn,this.privConnectionEvents=new t.EventSource,this.privServiceEvents=new t.EventSource,this.privSynthesisContext=new n.SynthesisContext,this.privAgentConfig=new n.AgentConfig,this.connectionEvents.attach(u=>{if(u.name==="ConnectionClosedEvent"){const h=u;h.statusCode!==1e3&&this.cancelSynthesisLocal(e.CancellationReason.Error,h.statusCode===1007?e.CancellationErrorCode.BadRequestParameters:e.CancellationErrorCode.ConnectionFailure,`${h.reason} websocket error code: ${h.statusCode}`)}})}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(o){this.privActivityTemplate=o}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(o){this.privAudioOutputFormat=o,this.privSynthesisTurn.audioOutputFormat=o,this.privSessionAudioDestination!==void 0&&(this.privSessionAudioDestination.format=o),this.synthesisContext!==void 0&&(this.synthesisContext.audioOutputFormat=o)}isDisposed(){return this.privIsDisposed}async dispose(o){this.privIsDisposed=!0,this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.close(),this.privConnectionConfigurationPromise!==void 0&&await(await this.privConnectionConfigurationPromise).dispose(o)}async connect(){await this.connectImpl()}async sendNetworkMessage(o,a){const l=typeof a=="string"?t.MessageType.Text:t.MessageType.Binary,c=typeof a=="string"?"application/json":"";return(await this.fetchConnection()).send(new i.SpeechConnectionMessage(l,o,this.privSynthesisTurn.requestId,c,a))}async Speak(o,a,l,c,u,h){let d;if(a?d=o:d=this.privSynthesizer.buildSsml(o),this.speakOverride!==void 0)return this.speakOverride(d,l,c,u);this.privSuccessCallback=c,this.privErrorCallback=u,this.privSynthesisTurn.startNewSynthesis(l,o,a,h);try{await this.connectImpl();const p=await this.fetchConnection();await this.sendSynthesisContext(p),await this.sendSsmlMessage(p,d,l),this.onSynthesisStarted(l),this.receiveMessage()}catch(p){return this.cancelSynthesisLocal(e.CancellationReason.Error,e.CancellationErrorCode.ConnectionFailure,p),Promise.reject(p)}}async stopSpeaking(){return await this.connectImpl(),(await this.fetchConnection()).send(new i.SpeechConnectionMessage(t.MessageType.Text,"synthesis.control",this.privSynthesisTurn.requestId,"application/json",JSON.stringify({action:"stop"})))}cancelSynthesis(o,a,l,c){const u=new e.PropertyCollection;u.setProperty(n.CancellationErrorCodePropertyName,e.CancellationErrorCode[l]);const h=new e.SpeechSynthesisResult(o,e.ResultReason.Canceled,void 0,c,u);if(this.onSynthesisCancelled(h),this.privSuccessCallback)try{this.privSuccessCallback(h)}catch{}}cancelSynthesisLocal(o,a,l){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,o,a,l))}processTypeSpecificMessages(o){return!0}async receiveMessage(){try{const a=await(await this.fetchConnection()).read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!a)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;const l=i.SpeechConnectionMessage.fromConnectionMessage(a);if(l.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(l.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse(l.textBody);break;case"response":this.privSynthesisTurn.onServiceResponseMessage(l.textBody);break;case"audio":this.privSynthesisTurn.streamId.toLowerCase()===l.streamId.toLowerCase()&&l.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(l.binaryBody),this.onSynthesizing(l.binaryBody),this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.write(l.binaryBody));break;case"audio.metadata":const c=n.SynthesisAudioMetadata.fromJSON(l.textBody).Metadata;for(const h of c)switch(h.Type){case n.MetadataType.WordBoundary:case n.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(h);const d=new e.SpeechSynthesisWordBoundaryEventArgs(h.Data.Offset,h.Data.Duration,h.Data.text.Text,h.Data.text.Length,h.Type===n.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,h.Data.text.BoundaryType);this.onWordBoundary(d);break;case n.MetadataType.Bookmark:const p=new e.SpeechSynthesisBookmarkEventArgs(h.Data.Offset,h.Data.Bookmark);this.onBookmarkReached(p);break;case n.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(h),h.Data.IsLastAnimation){const f=new e.SpeechSynthesisVisemeEventArgs(h.Data.Offset,h.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(f)}break;case n.MetadataType.AvatarSignal:this.onAvatarEvent(h);break;case n.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(h);break}break;case"turn.end":this.privSynthesisTurn.onServiceTurnEndResponse();let u;try{u=await this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(u)}catch(h){this.privErrorCallback&&this.privErrorCallback(h)}this.onSynthesisCompleted(u);break;default:this.processTypeSpecificMessages(l)||this.privServiceEvents&&this.serviceEvents.onEvent(new t.ServiceEvent(l.path.toLowerCase(),l.textBody))}return this.receiveMessage()}catch{}}sendSynthesisContext(o){this.setSynthesisContextSynthesisSection();const a=this.synthesisContext.toJSON();if(a)return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",a))}setSpeechConfigSynthesisSection(){}connectImpl(o=!1){if(this.privConnectionPromise!=null)return this.privConnectionPromise.then(l=>l.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()));this.privAuthFetchEventId=t.createNoDashGuid(),this.privConnectionId=t.createNoDashGuid(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);const a=o?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=a.then(async l=>{this.privSynthesisTurn.onAuthCompleted(!1);const c=this.privConnectionFactory.create(this.privSynthesizerConfig,l,this.privConnectionId);c.events.attach(h=>{this.connectionEvents.onEvent(h)});const u=await c.open();return u.statusCode===200?(this.privSynthesisTurn.onConnectionEstablishCompleted(u.statusCode),Promise.resolve(c)):u.statusCode===403&&!o?this.connectImpl(!0):(this.privSynthesisTurn.onConnectionEstablishCompleted(u.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${u.statusCode},
                    ${this.privSynthesizerConfig.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Url)} Reason: ${u.reason}`))},l=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(l)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise}sendSpeechServiceConfig(o,a){if(a)return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",a))}sendSsmlMessage(o,a,l){return o.send(new i.SpeechConnectionMessage(t.MessageType.Text,"ssml",l,"application/ssml+xml",a))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(o=>o.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async configureConnection(){const o=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(o):(this.setSpeechConfigSynthesisSection(),await this.sendSpeechServiceConfig(o,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),o)}onAvatarEvent(o){}onSynthesisStarted(o){}onSynthesizing(o){}onSynthesisCancelled(o){}onSynthesisCompleted(o){}onWordBoundary(o){}onVisemeReceived(o){}onBookmarkReached(o){}};return Sm.SynthesisAdapterBase=r,r.telemetryDataEnabled=!0,Sm}var xm={},kk;function mY(){if(kk)return xm;kk=1,Object.defineProperty(xm,"__esModule",{value:!0}),xm.AvatarSynthesisAdapter=void 0;const t=me(),e=Ve();let n=class extends e.SynthesisAdapterBase{constructor(r,s,o,a,l){super(r,s,o,void 0),this.privAvatarSynthesizer=a,this.privSynthesizer=a,this.privAvatarConfig=l}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){var r,s,o,a,l,c,u,h,d,p,f,v,g,m,y,S,x;this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:(r=this.privAvatarConfig.videoFormat)==null?void 0:r.bitrate,codec:(s=this.privAvatarConfig.videoFormat)==null?void 0:s.codec,crop:{bottomRight:{x:(l=(a=(o=this.privAvatarConfig.videoFormat)==null?void 0:o.cropRange)==null?void 0:a.bottomRight)==null?void 0:l.x,y:(h=(u=(c=this.privAvatarConfig.videoFormat)==null?void 0:c.cropRange)==null?void 0:u.bottomRight)==null?void 0:h.y},topLeft:{x:(f=(p=(d=this.privAvatarConfig.videoFormat)==null?void 0:d.cropRange)==null?void 0:p.topLeft)==null?void 0:f.x,y:(m=(g=(v=this.privAvatarConfig.videoFormat)==null?void 0:v.cropRange)==null?void 0:g.topLeft)==null?void 0:m.y}},resolution:{height:(y=this.privAvatarConfig.videoFormat)==null?void 0:y.height,width:(S=this.privAvatarConfig.videoFormat)==null?void 0:S.width}},protocol:{name:"WebRTC",webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(t.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarConfig.remoteIceServers??this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor,image:{url:(x=this.privAvatarConfig.backgroundImage)==null?void 0:x.toString()}},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,style:this.privAvatarConfig.style}}}onAvatarEvent(r){if(this.privAvatarSynthesizer.avatarEventReceived){const s=new t.AvatarEventArgs(r.Data.Offset,r.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,s)}catch{}}}};return xm.AvatarSynthesisAdapter=n,xm}var Cm={},Lk;function gY(){if(Lk)return Cm;Lk=1,Object.defineProperty(Cm,"__esModule",{value:!0}),Cm.SpeechSynthesisAdapter=void 0;const t=me(),e=Ve();let n=class extends e.SynthesisAdapterBase{constructor(r,s,o,a,l){super(r,s,o,l),this.privSpeechSynthesizer=a,this.privSynthesizer=a}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(r){const s=new t.SpeechSynthesisEventArgs(new t.SpeechSynthesisResult(r,t.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,s)}onSynthesizing(r){if(this.privSpeechSynthesizer.synthesizing)try{const s=this.privSynthesisTurn.audioOutputFormat.addHeader(r),o=new t.SpeechSynthesisEventArgs(new t.SpeechSynthesisResult(this.privSynthesisTurn.requestId,t.ResultReason.SynthesizingAudio,s));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,o)}catch{}}onSynthesisCancelled(r){if(this.privSpeechSynthesizer.SynthesisCanceled){const s=new t.SpeechSynthesisEventArgs(r);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,s)}catch{}}}onSynthesisCompleted(r){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new t.SpeechSynthesisEventArgs(r))}catch{}}onWordBoundary(r){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,r)}catch{}}onVisemeReceived(r){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,r)}catch{}}onBookmarkReached(r){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,r)}catch{}}};return Cm.SpeechSynthesisAdapter=n,Cm}var _m={},Dk;function vY(){if(Dk)return _m;Dk=1,Object.defineProperty(_m,"__esModule",{value:!0}),_m.SynthesisRestAdapter=void 0;const t=zi(),e=me(),n=No(),i=Fi;let r=class{constructor(o,a){let l=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!l){const u=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Region,"westus"),h=n.ConnectionFactoryBase.getHostSuffix(u);l=o.parameters.getProperty(e.PropertyId.SpeechServiceConnection_Host,`https://${u}.tts.speech${h}`)}this.privUri=`${l}/cognitiveservices/voices/list`;const c=t.RestConfigBase.requestOptions;this.privRestAdapter=new t.RestMessageAdapter(c),this.privAuthentication=a}getVoicesList(o){return this.privRestAdapter.setHeaders(i.HeaderNames.ConnectionId,o),this.privAuthentication.fetch(o).then(a=>(this.privRestAdapter.setHeaders(a.headerName,a.token),this.privRestAdapter.request(t.RestRequestType.Get,this.privUri)))}};return _m.SynthesisRestAdapter=r,_m}var B_={},Nk;function yY(){return Nk||(Nk=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SynthesizerConfig=t.SynthesisServiceType=void 0;const e=Ve();var n;(function(r){r[r.Standard=0]="Standard",r[r.Custom=1]="Custom"})(n=t.SynthesisServiceType||(t.SynthesisServiceType={}));class i{constructor(s,o){this.privSynthesisServiceType=n.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=s||new e.SpeechServiceConfig(new e.Context(null)),this.privParameters=o}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(s){this.privSynthesisServiceType=s}set synthesisVideoSection(s){this.privSpeechServiceConfig.Context.synthesis={video:s}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}}t.SynthesizerConfig=i}(B_)),B_}var wm={},Ok;function SY(){if(Ok)return wm;Ok=1,Object.defineProperty(wm,"__esModule",{value:!0}),wm.SynthesisContext=void 0;const t=me();let e=class{constructor(){this.privContext={}}setSection(i,r){this.privContext[i]=r}set audioOutputFormat(i){this.privAudioOutputFormat=i}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(i){const r=this.buildSynthesisContext(i);this.setSection("synthesis",r)}buildSynthesisContext(i){return{audio:{metadataOptions:{bookmarkEnabled:!!(i!=null&&i.bookmarkReached),punctuationBoundaryEnabled:i==null?void 0:i.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!(i!=null&&i.wordBoundary)),sentenceBoundaryEnabled:i==null?void 0:i.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!(i!=null&&i.visemeReceived),wordBoundaryEnabled:i==null?void 0:i.properties.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!(i!=null&&i.wordBoundary))},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:i==null?void 0:i.autoDetectSourceLanguage}}}};return wm.SynthesisContext=e,wm}var Em={},Fk;function xY(){if(Fk)return Em;Fk=1,Object.defineProperty(Em,"__esModule",{value:!0}),Em.SpeakerRecognitionConfig=void 0;const t=Ve();let e=class{constructor(i,r){this.privContext=i||new t.Context(null),this.privParameters=r}get parameters(){return this.privParameters}get Context(){return this.privContext}};return Em.SpeakerRecognitionConfig=e,Em}var Rm={},zk;function CY(){if(zk)return Rm;zk=1,Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.SpeakerServiceRecognizer=void 0;const t=zi(),e=ht(),n=me(),i=Ve(),r=tl;let s=class extends i.ServiceRecognizerBase{constructor(a,l,c,u,h){super(a,l,c,u,h),this.privSpeakerRecognizer=h,this.privSpeakerAudioSource=c,this.recognizeSpeaker=d=>this.recognizeSpeakerOnce(d),this.sendPrePayloadJSONOverride=()=>this.noOp()}processTypeSpecificMessages(a){let l=!1;const c=new n.PropertyCollection;switch(a.messageType===e.MessageType.Text&&c.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,a.textBody),a.path.toLowerCase()){case"speaker.response":const h=JSON.parse(a.textBody);let d;h.status.statusCode.toLowerCase()!=="success"?d=new n.SpeakerRecognitionResult(h,n.ResultReason.Canceled,n.CancellationErrorCode.ServiceError,h.status.reason):d=new n.SpeakerRecognitionResult(h,n.ResultReason.RecognizedSpeaker),this.privResultDeferral&&this.privResultDeferral.resolve(d),l=!0;break}const u=new e.Deferred;return u.resolve(l),u.promise}cancelRecognition(a,l,c,u,h){if(new n.PropertyCollection().setProperty(i.CancellationErrorCodePropertyName,n.CancellationErrorCode[u]),this.privResultDeferral){const p=new n.SpeakerRecognitionResult({scenario:this.privSpeakerModel.scenario,status:{statusCode:h,reason:h}},n.ResultReason.Canceled,u,h);try{this.privResultDeferral.resolve(p)}catch(f){this.privResultDeferral.reject(f)}}}async recognizeSpeakerOnce(a){this.privSpeakerModel=a,this.voiceProfileType=a.scenario,this.privResultDeferral||(this.privResultDeferral=new e.Deferred),this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(n.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const l=this.connectImpl(),c=this.sendPreAudioMessages(this.extractSpeakerContext(a)),u=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),h=await this.privSpeakerAudioSource.format,d=await this.privSpeakerAudioSource.deviceInfo,p=new t.ReplayableAudioNode(u,h.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(p,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:d};try{await l,await c}catch(g){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,g)}const f=new n.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,f),this.receiveMessage(),this.sendAudio(p).then(()=>{},g=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,g)}),this.privResultDeferral.promise}async sendPreAudioMessages(a){const l=await this.fetchConnection();await this.sendSpeakerRecognition(l,a)}async sendSpeakerRecognition(a,l){const c=JSON.stringify(l);return a.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speaker.context",this.privRequestSession.requestId,"application/json; charset=utf-8",c))}extractSpeakerContext(a){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:a.profileIds,scenario:a.scenario}}};return Rm.SpeakerServiceRecognizer=s,Rm}var Tm={},Uk;function _Y(){if(Uk)return Tm;Uk=1,Object.defineProperty(Tm,"__esModule",{value:!0}),Tm.VoiceServiceRecognizer=void 0;const t=zi(),e=ht(),n=me(),i=Ve(),r=tl;let s=class extends i.ServiceRecognizerBase{constructor(a,l,c,u,h){super(a,l,c,u,h),this.privDeferralMap=new e.DeferralMap,this.privSpeakerAudioSource=c,this.sendPrePayloadJSONOverride=()=>this.noOp()}set SpeakerAudioSource(a){this.privSpeakerAudioSource=a}processTypeSpecificMessages(a){let l=!1;const c=new n.PropertyCollection;switch(a.messageType===e.MessageType.Text&&c.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,a.textBody),a.path.toLowerCase()){case"speaker.profiles":const h=JSON.parse(a.textBody);switch(h.operation.toLowerCase()){case"create":this.handleCreateResponse(h,a.requestId);break;case"delete":case"reset":this.handleResultResponse(h,a.requestId);break;case"fetch":const v=JSON.parse(a.textBody);this.handleFetchResponse(v,a.requestId);break}l=!0;break;case"speaker.phrases":const d=JSON.parse(a.textBody);this.handlePhrasesResponse(d,a.requestId),l=!0;break;case"speaker.profile.enrollment":const p=JSON.parse(a.textBody),f=new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(p.enrollment?p.enrollment.enrollmentStatus:p.status.statusCode),p.enrollment?JSON.stringify(p.enrollment):void 0,p.status.reason);this.privDeferralMap.getId(a.requestId)&&this.privDeferralMap.complete(a.requestId,f),this.privRequestSession.onSpeechEnded(),l=!0;break}const u=new e.Deferred;return u.resolve(l),u.promise}cancelRecognition(a,l,c,u,h){new n.PropertyCollection().setProperty(i.CancellationErrorCodePropertyName,n.CancellationErrorCode[u]);const p=new n.VoiceProfileEnrollmentResult(n.ResultReason.Canceled,h,h);this.privDeferralMap.getId(l)&&this.privDeferralMap.complete(l,p)}async createProfile(a,l){this.voiceProfileType=a.toString();const c=this.connectImpl();try{const u=new e.Deferred;return await c,await this.sendCreateProfile(u,a,l),this.receiveMessage(),u.promise}catch(u){throw u}}async resetProfile(a){return this.voiceProfileType=a.profileType.toString(),this.sendCommonRequest("reset",a.profileType,a)}async deleteProfile(a){return this.voiceProfileType=a.profileType.toString(),this.sendCommonRequest("delete",a.profileType,a)}async retrieveEnrollmentResult(a){return this.voiceProfileType=a.profileType.toString(),this.privExpectedProfileId=a.profileId,this.sendCommonRequest("fetch",a.profileType,a)}async getAllProfiles(a){return this.voiceProfileType=a.toString(),this.sendCommonRequest("fetch",a)}async getActivationPhrases(a,l){this.voiceProfileType=a.toString();const c=this.connectImpl();try{const u=new e.Deferred;return await c,await this.sendPhrasesRequest(u,a,l),this.receiveMessage(),u.promise}catch(u){throw u}}async enrollProfile(a){this.voiceProfileType=a.profileType.toString();const l=new e.Deferred;this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(n.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const c=this.connectImpl(),u=this.sendPreAudioMessages(a,l),h=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),d=await this.privSpeakerAudioSource.format,p=await this.privSpeakerAudioSource.deviceInfo,f=new t.ReplayableAudioNode(h,d.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(f,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:p};try{await c,await u}catch(m){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,m)}const v=new n.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,v),this.receiveMessage(),this.sendAudio(f).then(()=>{},m=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,m)}),l.promise}async sendPreAudioMessages(a,l){const c=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,l),await this.sendBaseRequest(c,"enroll",this.scenarioFrom(a.profileType),a)}async sendPhrasesRequest(a,l,c){const u=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,a);const h=this.scenarioFrom(l),d={locale:c,scenario:h};return u.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speaker.profile.phrases",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(d)))}async sendCreateProfile(a,l,c){const u=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,a);const h=l===n.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":l===n.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification",d={locale:c,number:"1",scenario:h};return u.send(new r.SpeechConnectionMessage(e.MessageType.Text,"speaker.profile.create",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(d)))}async sendCommonRequest(a,l,c=void 0){const u=this.connectImpl();try{const h=new e.Deferred;this.privRequestSession.onSpeechContext(),await u;const d=await this.fetchConnection();return this.privDeferralMap.add(this.privRequestSession.requestId,h),await this.sendBaseRequest(d,a,this.scenarioFrom(l),c),this.receiveMessage(),h.promise}catch(h){throw h}}async sendBaseRequest(a,l,c,u){const h={scenario:c};return u?h.profileIds=[u.profileId]:h.maxPageSize=-1,a.send(new r.SpeechConnectionMessage(e.MessageType.Text,`speaker.profile.${l}`,this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(h)))}extractSpeakerContext(a){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:a.profileIds,scenario:a.scenario}}handlePhrasesResponse(a,l){if(this.privDeferralMap.getId(l))if(a.status.statusCode.toLowerCase()!=="success"){const c=n.ResultReason.Canceled,u=new n.VoiceProfilePhraseResult(c,a.status.statusCode,a.passPhraseType,[]);this.privDeferralMap.complete(l,u)}else if(a.phrases&&a.phrases.length>0){const c=n.ResultReason.EnrollingVoiceProfile,u=new n.VoiceProfilePhraseResult(c,a.status.statusCode,a.passPhraseType,a.phrases);this.privDeferralMap.complete(l,u)}else throw new Error("Voice Profile get activation phrases failed, no phrases received");else throw new Error(`Voice Profile get activation phrases request for requestID ${l} not found`)}handleCreateResponse(a,l){if(a.profiles&&a.profiles.length>0)if(this.privDeferralMap.getId(l)){const c=a.profiles.map(u=>u.profileId);this.privDeferralMap.complete(l,c)}else throw new Error(`Voice Profile create request for requestID ${l} not found`);else throw new Error("Voice Profile create failed, no profile id received")}handleResultResponse(a,l){if(this.privDeferralMap.getId(l)){const c=a.operation.toLowerCase()==="delete"?n.ResultReason.DeletedVoiceProfile:n.ResultReason.ResetVoiceProfile,u=a.status.statusCode.toLowerCase()==="success"?c:n.ResultReason.Canceled,h=new n.VoiceProfileResult(u,`statusCode: ${a.status.statusCode}, errorDetails: ${a.status.reason}`);this.privDeferralMap.complete(l,h)}else throw new Error(`Voice Profile create request for requestID ${l} not found`)}handleFetchResponse(a,l){if(this.privDeferralMap.getId(l)&&a.profiles[0]){if(this.privExpectedProfileId&&a.profiles.length===1&&a.profiles[0].profileId===this.privExpectedProfileId){this.privExpectedProfileId=void 0;const c=a.profiles[0],u=new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(c.enrollmentStatus),JSON.stringify(c),a.status.reason);this.privDeferralMap.complete(l,u)}else if(a.profiles.length>0){const c=a.profiles,u=[];for(const h of c)u.push(new n.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(h.enrollmentStatus),JSON.stringify(h),a.status.reason));this.privDeferralMap.complete(l,u)}}else throw new Error(`Voice Profile fetch request for requestID ${l} not found`)}enrollmentReasonFrom(a){switch(a.toLowerCase()){case"enrolled":return n.ResultReason.EnrolledVoiceProfile;case"invalidlocale":case"invalidphrase":case"invalidaudioformat":case"invalidscenario":case"invalidprofilecount":case"invalidoperation":case"audiotooshort":case"audiotoolong":case"toomanyenrollments":case"storageconflict":case"profilenotfound":case"incompatibleprofiles":case"incompleteenrollment":return n.ResultReason.Canceled;default:return n.ResultReason.EnrollingVoiceProfile}}scenarioFrom(a){return a===n.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":a===n.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification"}};return Tm.VoiceServiceRecognizer=s,Tm}var EB={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.type=t.connectivity=t.Device=t.OS=t.System=t.Context=t.SpeechServiceConfig=void 0;class e{constructor(a){this.context=a}serialize(){return JSON.stringify(this,(a,l)=>{if(l&&typeof l=="object"&&!Array.isArray(l)){const c={};for(const u in l)Object.hasOwnProperty.call(l,u)&&(c[u&&u.charAt(0).toLowerCase()+u.substring(1)]=l[u]);return c}return l})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(a){this.recognition=a.toLowerCase()}}t.SpeechServiceConfig=e;class n{constructor(a){this.system=new i,this.os=a}}t.Context=n;class i{constructor(){const a="1.40.0";this.name="SpeechSDK",this.version=a,this.build="JavaScript",this.lang="JavaScript"}}t.System=i;class r{constructor(a,l,c){this.platform=a,this.name=l,this.version=c}}t.OS=r;class s{constructor(a,l,c){this.manufacturer=a,this.model=l,this.version=c}}t.Device=s,function(o){o.Bluetooth="Bluetooth",o.Wired="Wired",o.WiFi="WiFi",o.Cellular="Cellular",o.InBuilt="InBuilt",o.Unknown="Unknown"}(t.connectivity||(t.connectivity={})),function(o){o.Phone="Phone",o.Speaker="Speaker",o.Car="Car",o.Headset="Headset",o.Thermostat="Thermostat",o.Microphones="Microphones",o.Deskphone="Deskphone",o.RemoteControl="RemoteControl",o.Unknown="Unknown",o.File="File",o.Stream="Stream"}(t.type||(t.type={}))})(EB);var Bk;function Ve(){return Bk||(Bk=1,function(t){var e=It&&It.__createBinding||(Object.create?function(s,o,a,l){l===void 0&&(l=a),Object.defineProperty(s,l,{enumerable:!0,get:function(){return o[a]}})}:function(s,o,a,l){l===void 0&&(l=a),s[l]=o[a]}),n=It&&It.__exportStar||function(s,o){for(var a in s)a!=="default"&&!o.hasOwnProperty(a)&&e(o,s,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDetectSourceLanguagesOpenRangeOptionName=t.ForceDictationPropertyName=t.ServicePropertiesPropertyName=t.CancellationErrorCodePropertyName=t.OutputFormatPropertyName=void 0,n(MS,t),n(QS,t),n(op,t),n(CU,t),n(_U,t),n(hK(),t),n(dK(),t),n(Tx,t),n(pK(),t),n(fK(),t),n(mK(),t),n(mB,t),n(bx,t),n(vK(),t),n(yK(),t),n(SK(),t),n(xK(),t),n(dB(),t),n(CK(),t),n(gB,t),n(_K(),t),n(Ax,t),n(RK(),t),n(TK(),t),n(Px,t),n(Ix,t),n(Mx,t),n(bK(),t),n(AK(),t),n(PK(),t),n(IK(),t),n(MK(),t),n(kx,t),n(LK(),t),n(Lx,t),n(xB,t),n(Dx,t),n(Ox,t),n(Fx,t),n(CB,t),n(WK(),t),n(Bx,t),n(cY(),t),n(k2,t),n(pY(),t),n(fY(),t);var i=mY();Object.defineProperty(t,"AvatarSynthesisAdapter",{enumerable:!0,get:function(){return i.AvatarSynthesisAdapter}});var r=gY();Object.defineProperty(t,"SpeechSynthesisAdapter",{enumerable:!0,get:function(){return r.SpeechSynthesisAdapter}}),n(vY(),t),n(yY(),t),n(SY(),t),n(xY(),t),n(CY(),t),n(_Y(),t),n(EB,t),t.OutputFormatPropertyName="OutputFormat",t.CancellationErrorCodePropertyName="CancellationErrorCode",t.ServicePropertiesPropertyName="ServiceProperties",t.ForceDictationPropertyName="ForceDictation",t.AutoDetectSourceLanguagesOpenRangeOptionName="OpenRange"}(x_)),x_}(function(t){var e=It&&It.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o),Object.defineProperty(r,a,{enumerable:!0,get:function(){return s[o]}})}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),n=It&&It.__exportStar||function(r,s){for(var o in r)o!=="default"&&!s.hasOwnProperty(o)&&e(s,r,o)};Object.defineProperty(t,"__esModule",{value:!0});const i=Ve();new i.AgentConfig,n(me(),t)})(Jm);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const L2="169",ld={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Xh={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},wY=0,$k=1,EY=2,RB=1,RY=2,Aa=3,Ka=0,Tr=1,Zo=2,Xl=0,cd=1,Hk=2,Vk=3,jk=4,TY=5,eu=100,bY=101,AY=102,PY=103,IY=104,MY=200,kY=201,LY=202,DY=203,dR=204,pR=205,NY=206,OY=207,FY=208,zY=209,UY=210,BY=211,$Y=212,HY=213,VY=214,fR=0,mR=1,gR=2,kd=3,vR=4,yR=5,SR=6,xR=7,Wx=0,jY=1,WY=2,Kl=0,GY=1,qY=2,XY=3,TB=4,KY=5,YY=6,JY=7,Wk="attached",QY="detached",bB=300,Ld=301,Dd=302,w1=303,CR=304,Gx=306,ic=1e3,na=1001,E1=1002,Er=1003,AB=1004,Zm=1005,ds=1006,My=1007,za=1008,Ya=1009,PB=1010,IB=1011,Xg=1012,D2=1013,Iu=1014,Ro=1015,L0=1016,N2=1017,O2=1018,Nd=1020,MB=35902,kB=1021,LB=1022,Bs=1023,DB=1024,NB=1025,ud=1026,Od=1027,F2=1028,z2=1029,OB=1030,U2=1031,B2=1033,ky=33776,Ly=33777,Dy=33778,Ny=33779,_R=35840,wR=35841,ER=35842,RR=35843,TR=36196,bR=37492,AR=37496,PR=37808,IR=37809,MR=37810,kR=37811,LR=37812,DR=37813,NR=37814,OR=37815,FR=37816,zR=37817,UR=37818,BR=37819,$R=37820,HR=37821,Oy=36492,VR=36494,jR=36495,FB=36283,WR=36284,GR=36285,qR=36286,ZY=2200,zB=2201,eJ=2202,Kg=2300,Yg=2301,$_=2302,Kh=2400,Yh=2401,R1=2402,$2=2500,tJ=2501,nJ=0,UB=1,XR=2,iJ=3200,rJ=3201,qx=0,sJ=1,Al="",on="srgb",qi="srgb-linear",H2="display-p3",Xx="display-p3-linear",T1="linear",Pn="srgb",b1="rec709",A1="p3",hh=7680,Gk=519,oJ=512,aJ=513,lJ=514,BB=515,cJ=516,uJ=517,hJ=518,dJ=519,KR=35044,qk="300 es",Ua=2e3,P1=2001;class Sc{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const ir=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Xk=1234567;const yg=Math.PI/180,Fd=180/Math.PI;function Ao(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ir[t&255]+ir[t>>8&255]+ir[t>>16&255]+ir[t>>24&255]+"-"+ir[e&255]+ir[e>>8&255]+"-"+ir[e>>16&15|64]+ir[e>>24&255]+"-"+ir[n&63|128]+ir[n>>8&255]+"-"+ir[n>>16&255]+ir[n>>24&255]+ir[i&255]+ir[i>>8&255]+ir[i>>16&255]+ir[i>>24&255]).toLowerCase()}function yi(t,e,n){return Math.max(e,Math.min(n,t))}function V2(t,e){return(t%e+e)%e}function pJ(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)}function fJ(t,e,n){return t!==e?(n-t)/(e-t):0}function Sg(t,e,n){return(1-n)*t+n*e}function mJ(t,e,n,i){return Sg(t,e,1-Math.exp(-n*i))}function gJ(t,e=1){return e-Math.abs(V2(t,e*2)-e)}function vJ(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function yJ(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function SJ(t,e){return t+Math.floor(Math.random()*(e-t+1))}function xJ(t,e){return t+Math.random()*(e-t)}function CJ(t){return t*(.5-Math.random())}function _J(t){t!==void 0&&(Xk=t);let e=Xk+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function wJ(t){return t*yg}function EJ(t){return t*Fd}function RJ(t){return(t&t-1)===0&&t!==0}function TJ(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function bJ(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function AJ(t,e,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+i)/2),u=o((e+i)/2),h=s((e-i)/2),d=o((e-i)/2),p=s((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":t.set(a*u,l*h,l*d,a*c);break;case"YZY":t.set(l*d,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*d,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function _o(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function sn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const Hi={DEG2RAD:yg,RAD2DEG:Fd,generateUUID:Ao,clamp:yi,euclideanModulo:V2,mapLinear:pJ,inverseLerp:fJ,lerp:Sg,damp:mJ,pingpong:gJ,smoothstep:vJ,smootherstep:yJ,randInt:SJ,randFloat:xJ,randFloatSpread:CJ,seededRandom:_J,degToRad:wJ,radToDeg:EJ,isPowerOfTwo:RJ,ceilPowerOfTwo:TJ,floorPowerOfTwo:bJ,setQuaternionFromProperEuler:AJ,normalize:sn,denormalize:_o};class mt{constructor(e=0,n=0){mt.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,i=this.y,r=e.elements;return this.x=r[0]*n+r[3]*i+r[6],this.y=r[1]*n+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(yi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const i=Math.cos(n),r=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class bt{constructor(e,n,i,r,s,o,a,l,c){bt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,o,a,l,c)}set(e,n,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=n,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],h=i[7],d=i[2],p=i[5],f=i[8],v=r[0],g=r[3],m=r[6],y=r[1],S=r[4],x=r[7],w=r[2],C=r[5],E=r[8];return s[0]=o*v+a*y+l*w,s[3]=o*g+a*S+l*C,s[6]=o*m+a*x+l*E,s[1]=c*v+u*y+h*w,s[4]=c*g+u*S+h*C,s[7]=c*m+u*x+h*E,s[2]=d*v+p*y+f*w,s[5]=d*g+p*S+f*C,s[8]=d*m+p*x+f*E,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return n*o*u-n*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=a*l-u*s,p=c*s-o*l,f=n*h+i*d+r*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/f;return e[0]=h*v,e[1]=(r*c-u*i)*v,e[2]=(a*i-r*o)*v,e[3]=d*v,e[4]=(u*n-r*l)*v,e[5]=(r*s-a*n)*v,e[6]=p*v,e[7]=(i*l-c*n)*v,e[8]=(o*n-i*s)*v,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(H_.makeScale(e,n)),this}rotate(e){return this.premultiply(H_.makeRotation(-e)),this}translate(e,n){return this.premultiply(H_.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<9;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const H_=new bt;function $B(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function Jg(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function PJ(){const t=Jg("canvas");return t.style.display="block",t}const Kk={};function Fy(t){t in Kk||(Kk[t]=!0,console.warn(t))}function IJ(t,e,n){return new Promise(function(i,r){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}}setTimeout(s,n)})}function MJ(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function kJ(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Yk=new bt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Jk=new bt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),bm={[qi]:{transfer:T1,primaries:b1,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t,fromReference:t=>t},[on]:{transfer:Pn,primaries:b1,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Xx]:{transfer:T1,primaries:A1,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.applyMatrix3(Jk),fromReference:t=>t.applyMatrix3(Yk)},[H2]:{transfer:Pn,primaries:A1,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.convertSRGBToLinear().applyMatrix3(Jk),fromReference:t=>t.applyMatrix3(Yk).convertLinearToSRGB()}},LJ=new Set([qi,Xx]),Pt={enabled:!0,_workingColorSpace:qi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!LJ.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(this.enabled===!1||e===n||!e||!n)return t;const i=bm[e].toReference,r=bm[n].fromReference;return r(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return bm[t].primaries},getTransfer:function(t){return t===Al?T1:bm[t].transfer},getLuminanceCoefficients:function(t,e=this._workingColorSpace){return t.fromArray(bm[e].luminanceCoefficients)}};function hd(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function V_(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let dh;class DJ{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{dh===void 0&&(dh=Jg("canvas")),dh.width=e.width,dh.height=e.height;const i=dh.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=dh}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=Jg("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=hd(s[o]/255)*255;return i.putImageData(r,0,0),n}else if(e.data){const n=e.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(hd(n[i]/255)*255):n[i]=hd(n[i]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let NJ=0;class HB{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:NJ++}),this.uuid=Ao(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(j_(r[o].image)):s.push(j_(r[o]))}else s=j_(r);i.url=s}return n||(e.images[this.uuid]=i),i}}function j_(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?DJ.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let OJ=0;class wi extends Sc{constructor(e=wi.DEFAULT_IMAGE,n=wi.DEFAULT_MAPPING,i=na,r=na,s=ds,o=za,a=Bs,l=Ya,c=wi.DEFAULT_ANISOTROPY,u=Al){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:OJ++}),this.uuid=Ao(),this.name="",this.source=new HB(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new mt(0,0),this.repeat=new mt(1,1),this.center=new mt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==bB)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ic:e.x=e.x-Math.floor(e.x);break;case na:e.x=e.x<0?0:1;break;case E1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ic:e.y=e.y-Math.floor(e.y);break;case na:e.y=e.y<0?0:1;break;case E1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}wi.DEFAULT_IMAGE=null;wi.DEFAULT_MAPPING=bB;wi.DEFAULT_ANISOTROPY=1;class Wt{constructor(e=0,n=0,i=0,r=1){Wt.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,i,r){return this.x=e,this.y=n,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*n+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*n+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*n+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*n+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,i,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],p=l[5],f=l[9],v=l[2],g=l[6],m=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-v)<.01&&Math.abs(f-g)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+v)<.1&&Math.abs(f+g)<.1&&Math.abs(c+p+m-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const S=(c+1)/2,x=(p+1)/2,w=(m+1)/2,C=(u+d)/4,E=(h+v)/4,T=(f+g)/4;return S>x&&S>w?S<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(S),r=C/i,s=E/i):x>w?x<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),i=C/r,s=T/r):w<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),i=E/s,r=T/s),this.set(i,r,s,n),this}let y=Math.sqrt((g-f)*(g-f)+(h-v)*(h-v)+(d-u)*(d-u));return Math.abs(y)<.001&&(y=1),this.x=(g-f)/y,this.y=(h-v)/y,this.z=(d-u)/y,this.w=Math.acos((c+p+m-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this.w=e.w+(n.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class FJ extends Sc{constructor(e=1,n=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new Wt(0,0,e,n),this.scissorTest=!1,this.viewport=new Wt(0,0,e,n);const r={width:e,height:n,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ds,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new wi(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,n,i=1){if(this.width!==e||this.height!==n||this.depth!==i){this.width=e,this.height=n,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=n,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new HB(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Mu extends FJ{constructor(e=1,n=1,i={}){super(e,n,i),this.isWebGLRenderTarget=!0}}class VB extends wi{constructor(e=null,n=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=Er,this.minFilter=Er,this.wrapR=na,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class zJ extends wi{constructor(e=null,n=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=Er,this.minFilter=Er,this.wrapR=na,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class qt{constructor(e=0,n=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}static slerpFlat(e,n,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],h=i[r+3];const d=s[o+0],p=s[o+1],f=s[o+2],v=s[o+3];if(a===0){e[n+0]=l,e[n+1]=c,e[n+2]=u,e[n+3]=h;return}if(a===1){e[n+0]=d,e[n+1]=p,e[n+2]=f,e[n+3]=v;return}if(h!==v||l!==d||c!==p||u!==f){let g=1-a;const m=l*d+c*p+u*f+h*v,y=m>=0?1:-1,S=1-m*m;if(S>Number.EPSILON){const w=Math.sqrt(S),C=Math.atan2(w,m*y);g=Math.sin(g*C)/w,a=Math.sin(a*C)/w}const x=a*y;if(l=l*g+d*x,c=c*g+p*x,u=u*g+f*x,h=h*g+v*x,g===1-a){const w=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=w,c*=w,u*=w,h*=w}}e[n]=l,e[n+1]=c,e[n+2]=u,e[n+3]=h}static multiplyQuaternionsFlat(e,n,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],h=s[o],d=s[o+1],p=s[o+2],f=s[o+3];return e[n]=a*f+u*h+l*p-c*d,e[n+1]=l*f+u*d+c*h-a*p,e[n+2]=c*f+u*p+a*d-l*h,e[n+3]=u*f-a*h-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,r){return this._x=e,this._y=n,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),h=a(s/2),d=l(i/2),p=l(r/2),f=l(s/2);switch(o){case"XYZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"YXZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"ZXY":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"ZYX":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"YZX":this._x=d*u*h+c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h-d*p*f;break;case"XZY":this._x=d*u*h-c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const i=n/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,i=n[0],r=n[4],s=n[8],o=n[1],a=n[5],l=n[9],c=n[2],u=n[6],h=n[10],d=i+a+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(o-r)*p}else if(i>a&&i>h){const p=2*Math.sqrt(1+i-a-h);this._w=(u-l)/p,this._x=.25*p,this._y=(r+o)/p,this._z=(s+c)/p}else if(a>h){const p=2*Math.sqrt(1+a-i-h);this._w=(s-c)/p,this._x=(r+o)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-i-a);this._w=(o-r)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yi(this.dot(e),-1,1)))}rotateTowards(e,n){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,n/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const i=e._x,r=e._y,s=e._z,o=e._w,a=n._x,l=n._y,c=n._z,u=n._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-n;return this._w=p*o+n*this._w,this._x=p*i+n*this._x,this._y=p*r+n*this._y,this._z=p*s+n*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-n)*u)/c,d=Math.sin(n*u)/c;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,n,i){return this.copy(e).slerp(n,i)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,n=0,i=0){N.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(Qk.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(Qk.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[3]*i+s[6]*r,this.y=s[1]*n+s[4]*i+s[7]*r,this.z=s[2]*n+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*n+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*n+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*n+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*n+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const n=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*i),u=2*(a*n-s*r),h=2*(s*i-o*n);return this.x=n+l*c+o*h-a*u,this.y=i+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[4]*i+s[8]*r,this.y=s[1]*n+s[5]*i+s[9]*r,this.z=s[2]*n+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const i=e.x,r=e.y,s=e.z,o=n.x,a=n.y,l=n.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return W_.copy(this).projectOnVector(e),this.sub(W_)}reflect(e){return this.sub(W_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(yi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return n*n+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){const r=Math.sin(n)*e;return this.x=r*Math.sin(i),this.y=Math.cos(n)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=r,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,i=Math.sqrt(1-n*n);return this.x=i*Math.cos(e),this.y=n,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const W_=new N,Qk=new qt;class ha{constructor(e=new N(1/0,1/0,1/0),n=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n+=3)this.expandByPoint(lo.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,i=e.count;n<i;n++)this.expandByPoint(lo.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=lo.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,lo):lo.fromBufferAttribute(s,o),lo.applyMatrix4(e.matrixWorld),this.expandByPoint(lo);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),_v.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),_v.copy(i.boundingBox)),_v.applyMatrix4(e.matrixWorld),this.union(_v)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,lo),lo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,i;return e.normal.x>0?(n=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),n<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Am),wv.subVectors(this.max,Am),ph.subVectors(e.a,Am),fh.subVectors(e.b,Am),mh.subVectors(e.c,Am),ll.subVectors(fh,ph),cl.subVectors(mh,fh),Bc.subVectors(ph,mh);let n=[0,-ll.z,ll.y,0,-cl.z,cl.y,0,-Bc.z,Bc.y,ll.z,0,-ll.x,cl.z,0,-cl.x,Bc.z,0,-Bc.x,-ll.y,ll.x,0,-cl.y,cl.x,0,-Bc.y,Bc.x,0];return!G_(n,ph,fh,mh,wv)||(n=[1,0,0,0,1,0,0,0,1],!G_(n,ph,fh,mh,wv))?!1:(Ev.crossVectors(ll,cl),n=[Ev.x,Ev.y,Ev.z],G_(n,ph,fh,mh,wv))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,lo).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(lo).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_a),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _a=[new N,new N,new N,new N,new N,new N,new N,new N],lo=new N,_v=new ha,ph=new N,fh=new N,mh=new N,ll=new N,cl=new N,Bc=new N,Am=new N,wv=new N,Ev=new N,$c=new N;function G_(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){$c.fromArray(t,s);const a=r.x*Math.abs($c.x)+r.y*Math.abs($c.y)+r.z*Math.abs($c.z),l=e.dot($c),c=n.dot($c),u=i.dot($c);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const UJ=new ha,Pm=new N,q_=new N;class da{constructor(e=new N,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const i=this.center;n!==void 0?i.copy(n):UJ.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const i=this.center.distanceToSquared(e);return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Pm.subVectors(e,this.center);const n=Pm.lengthSq();if(n>this.radius*this.radius){const i=Math.sqrt(n),r=(i-this.radius)*.5;this.center.addScaledVector(Pm,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(q_.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Pm.copy(e.center).add(q_)),this.expandByPoint(Pm.copy(e.center).sub(q_))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const wa=new N,X_=new N,Rv=new N,ul=new N,K_=new N,Tv=new N,Y_=new N;class lp{constructor(e=new N,n=new N(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,wa)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=wa.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(wa.copy(this.origin).addScaledVector(this.direction,n),wa.distanceToSquared(e))}distanceSqToSegment(e,n,i,r){X_.copy(e).add(n).multiplyScalar(.5),Rv.copy(n).sub(e).normalize(),ul.copy(this.origin).sub(X_);const s=e.distanceTo(n)*.5,o=-this.direction.dot(Rv),a=ul.dot(this.direction),l=-ul.dot(Rv),c=ul.lengthSq(),u=Math.abs(1-o*o);let h,d,p,f;if(u>0)if(h=o*l-a,d=o*a-l,f=s*u,h>=0)if(d>=-f)if(d<=f){const v=1/u;h*=v,d*=v,p=h*(h+o*d+2*a)+d*(o*h+d+2*l)+c}else d=s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*l)+c;else d<=-f?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c):d<=f?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(X_).addScaledVector(Rv,d),p}intersectSphere(e,n){wa.subVectors(e.center,this.origin);const i=wa.dot(this.direction),r=wa.dot(wa)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/n;return i>=0?i:null}intersectPlane(e,n){const i=this.distanceToPlane(e);return i===null?null:this.at(i,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let i,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,n)}intersectsBox(e){return this.intersectBox(e,wa)!==null}intersectTriangle(e,n,i,r,s){K_.subVectors(n,e),Tv.subVectors(i,e),Y_.crossVectors(K_,Tv);let o=this.direction.dot(Y_),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;ul.subVectors(this.origin,e);const l=a*this.direction.dot(Tv.crossVectors(ul,Tv));if(l<0)return null;const c=a*this.direction.dot(K_.cross(ul));if(c<0||l+c>o)return null;const u=-a*ul.dot(Y_);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class je{constructor(e,n,i,r,s,o,a,l,c,u,h,d,p,f,v,g){je.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,o,a,l,c,u,h,d,p,f,v,g)}set(e,n,i,r,s,o,a,l,c,u,h,d,p,f,v,g){const m=this.elements;return m[0]=e,m[4]=n,m[8]=i,m[12]=r,m[1]=s,m[5]=o,m[9]=a,m[13]=l,m[2]=c,m[6]=u,m[10]=h,m[14]=d,m[3]=p,m[7]=f,m[11]=v,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new je().fromArray(this.elements)}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){const n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,i=e.elements,r=1/gh.setFromMatrixColumn(e,0).length(),s=1/gh.setFromMatrixColumn(e,1).length(),o=1/gh.setFromMatrixColumn(e,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=0,n[4]=i[4]*s,n[5]=i[5]*s,n[6]=i[6]*s,n[7]=0,n[8]=i[8]*o,n[9]=i[9]*o,n[10]=i[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,p=o*h,f=a*u,v=a*h;n[0]=l*u,n[4]=-l*h,n[8]=c,n[1]=p+f*c,n[5]=d-v*c,n[9]=-a*l,n[2]=v-d*c,n[6]=f+p*c,n[10]=o*l}else if(e.order==="YXZ"){const d=l*u,p=l*h,f=c*u,v=c*h;n[0]=d+v*a,n[4]=f*a-p,n[8]=o*c,n[1]=o*h,n[5]=o*u,n[9]=-a,n[2]=p*a-f,n[6]=v+d*a,n[10]=o*l}else if(e.order==="ZXY"){const d=l*u,p=l*h,f=c*u,v=c*h;n[0]=d-v*a,n[4]=-o*h,n[8]=f+p*a,n[1]=p+f*a,n[5]=o*u,n[9]=v-d*a,n[2]=-o*c,n[6]=a,n[10]=o*l}else if(e.order==="ZYX"){const d=o*u,p=o*h,f=a*u,v=a*h;n[0]=l*u,n[4]=f*c-p,n[8]=d*c+v,n[1]=l*h,n[5]=v*c+d,n[9]=p*c-f,n[2]=-c,n[6]=a*l,n[10]=o*l}else if(e.order==="YZX"){const d=o*l,p=o*c,f=a*l,v=a*c;n[0]=l*u,n[4]=v-d*h,n[8]=f*h+p,n[1]=h,n[5]=o*u,n[9]=-a*u,n[2]=-c*u,n[6]=p*h+f,n[10]=d-v*h}else if(e.order==="XZY"){const d=o*l,p=o*c,f=a*l,v=a*c;n[0]=l*u,n[4]=-h,n[8]=c*u,n[1]=d*h+v,n[5]=o*u,n[9]=p*h-f,n[2]=f*h-p,n[6]=a*u,n[10]=v*h+d}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(BJ,e,$J)}lookAt(e,n,i){const r=this.elements;return ns.subVectors(e,n),ns.lengthSq()===0&&(ns.z=1),ns.normalize(),hl.crossVectors(i,ns),hl.lengthSq()===0&&(Math.abs(i.z)===1?ns.x+=1e-4:ns.z+=1e-4,ns.normalize(),hl.crossVectors(i,ns)),hl.normalize(),bv.crossVectors(ns,hl),r[0]=hl.x,r[4]=bv.x,r[8]=ns.x,r[1]=hl.y,r[5]=bv.y,r[9]=ns.y,r[2]=hl.z,r[6]=bv.z,r[10]=ns.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],h=i[5],d=i[9],p=i[13],f=i[2],v=i[6],g=i[10],m=i[14],y=i[3],S=i[7],x=i[11],w=i[15],C=r[0],E=r[4],T=r[8],M=r[12],_=r[1],R=r[5],L=r[9],z=r[13],G=r[2],$=r[6],H=r[10],q=r[14],D=r[3],Z=r[7],P=r[11],le=r[15];return s[0]=o*C+a*_+l*G+c*D,s[4]=o*E+a*R+l*$+c*Z,s[8]=o*T+a*L+l*H+c*P,s[12]=o*M+a*z+l*q+c*le,s[1]=u*C+h*_+d*G+p*D,s[5]=u*E+h*R+d*$+p*Z,s[9]=u*T+h*L+d*H+p*P,s[13]=u*M+h*z+d*q+p*le,s[2]=f*C+v*_+g*G+m*D,s[6]=f*E+v*R+g*$+m*Z,s[10]=f*T+v*L+g*H+m*P,s[14]=f*M+v*z+g*q+m*le,s[3]=y*C+S*_+x*G+w*D,s[7]=y*E+S*R+x*$+w*Z,s[11]=y*T+S*L+x*H+w*P,s[15]=y*M+S*z+x*q+w*le,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],p=e[14],f=e[3],v=e[7],g=e[11],m=e[15];return f*(+s*l*h-r*c*h-s*a*d+i*c*d+r*a*p-i*l*p)+v*(+n*l*p-n*c*d+s*o*d-r*o*p+r*c*u-s*l*u)+g*(+n*c*h-n*a*p-s*o*h+i*o*p+s*a*u-i*c*u)+m*(-r*a*u-n*l*h+n*a*d+r*o*h-i*o*d+i*l*u)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=n,r[14]=i),this}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],v=e[13],g=e[14],m=e[15],y=h*g*c-v*d*c+v*l*p-a*g*p-h*l*m+a*d*m,S=f*d*c-u*g*c-f*l*p+o*g*p+u*l*m-o*d*m,x=u*v*c-f*h*c+f*a*p-o*v*p-u*a*m+o*h*m,w=f*h*l-u*v*l-f*a*d+o*v*d+u*a*g-o*h*g,C=n*y+i*S+r*x+s*w;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/C;return e[0]=y*E,e[1]=(v*d*s-h*g*s-v*r*p+i*g*p+h*r*m-i*d*m)*E,e[2]=(a*g*s-v*l*s+v*r*c-i*g*c-a*r*m+i*l*m)*E,e[3]=(h*l*s-a*d*s-h*r*c+i*d*c+a*r*p-i*l*p)*E,e[4]=S*E,e[5]=(u*g*s-f*d*s+f*r*p-n*g*p-u*r*m+n*d*m)*E,e[6]=(f*l*s-o*g*s-f*r*c+n*g*c+o*r*m-n*l*m)*E,e[7]=(o*d*s-u*l*s+u*r*c-n*d*c-o*r*p+n*l*p)*E,e[8]=x*E,e[9]=(f*h*s-u*v*s-f*i*p+n*v*p+u*i*m-n*h*m)*E,e[10]=(o*v*s-f*a*s+f*i*c-n*v*c-o*i*m+n*a*m)*E,e[11]=(u*a*s-o*h*s-u*i*c+n*h*c+o*i*p-n*a*p)*E,e[12]=w*E,e[13]=(u*v*r-f*h*r+f*i*d-n*v*d-u*i*g+n*h*g)*E,e[14]=(f*a*r-o*v*r-f*i*l+n*v*l+o*i*g-n*a*g)*E,e[15]=(o*h*r-u*a*r+u*i*l-n*h*l-o*i*d+n*a*d)*E,this}scale(e){const n=this.elements,i=e.x,r=e.y,s=e.z;return n[0]*=i,n[4]*=r,n[8]*=s,n[1]*=i,n[5]*=r,n[9]*=s,n[2]*=i,n[6]*=r,n[10]*=s,n[3]*=i,n[7]*=r,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,r))}makeTranslation(e,n,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const i=Math.cos(n),r=Math.sin(n),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,n,r,1,0,0,0,0,1),this}compose(e,n,i){const r=this.elements,s=n._x,o=n._y,a=n._z,l=n._w,c=s+s,u=o+o,h=a+a,d=s*c,p=s*u,f=s*h,v=o*u,g=o*h,m=a*h,y=l*c,S=l*u,x=l*h,w=i.x,C=i.y,E=i.z;return r[0]=(1-(v+m))*w,r[1]=(p+x)*w,r[2]=(f-S)*w,r[3]=0,r[4]=(p-x)*C,r[5]=(1-(d+m))*C,r[6]=(g+y)*C,r[7]=0,r[8]=(f+S)*E,r[9]=(g-y)*E,r[10]=(1-(d+v))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,n,i){const r=this.elements;let s=gh.set(r[0],r[1],r[2]).length();const o=gh.set(r[4],r[5],r[6]).length(),a=gh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],co.copy(this);const c=1/s,u=1/o,h=1/a;return co.elements[0]*=c,co.elements[1]*=c,co.elements[2]*=c,co.elements[4]*=u,co.elements[5]*=u,co.elements[6]*=u,co.elements[8]*=h,co.elements[9]*=h,co.elements[10]*=h,n.setFromRotationMatrix(co),i.x=s,i.y=o,i.z=a,this}makePerspective(e,n,i,r,s,o,a=Ua){const l=this.elements,c=2*s/(n-e),u=2*s/(i-r),h=(n+e)/(n-e),d=(i+r)/(i-r);let p,f;if(a===Ua)p=-(o+s)/(o-s),f=-2*o*s/(o-s);else if(a===P1)p=-o/(o-s),f=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,n,i,r,s,o,a=Ua){const l=this.elements,c=1/(n-e),u=1/(i-r),h=1/(o-s),d=(n+e)*c,p=(i+r)*u;let f,v;if(a===Ua)f=(o+s)*h,v=-2*h;else if(a===P1)f=s*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=v,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<16;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}const gh=new N,co=new je,BJ=new N(0,0,0),$J=new N(1,1,1),hl=new N,bv=new N,ns=new N,Zk=new je,eL=new qt;class fn{constructor(e=0,n=0,i=0,r=fn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,r=this._order){return this._x=e,this._y=n,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],p=r[10];switch(n){case"XYZ":this._y=Math.asin(yi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-yi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(yi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-yi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(yi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-yi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return Zk.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Zk,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return eL.setFromEuler(this),this.setFromQuaternion(eL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}fn.DEFAULT_ORDER="XYZ";class j2{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let HJ=0;const tL=new N,vh=new qt,Ea=new je,Av=new N,Im=new N,VJ=new N,jJ=new qt,nL=new N(1,0,0),iL=new N(0,1,0),rL=new N(0,0,1),sL={type:"added"},WJ={type:"removed"},yh={type:"childadded",child:null},J_={type:"childremoved",child:null};class Sn extends Sc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:HJ++}),this.uuid=Ao(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sn.DEFAULT_UP.clone();const e=new N,n=new fn,i=new qt,r=new N(1,1,1);function s(){i.setFromEuler(n,!1)}function o(){n.setFromQuaternion(i,void 0,!1)}n._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new je},normalMatrix:{value:new bt}}),this.matrix=new je,this.matrixWorld=new je,this.matrixAutoUpdate=Sn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Sn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new j2,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return vh.setFromAxisAngle(e,n),this.quaternion.multiply(vh),this}rotateOnWorldAxis(e,n){return vh.setFromAxisAngle(e,n),this.quaternion.premultiply(vh),this}rotateX(e){return this.rotateOnAxis(nL,e)}rotateY(e){return this.rotateOnAxis(iL,e)}rotateZ(e){return this.rotateOnAxis(rL,e)}translateOnAxis(e,n){return tL.copy(e).applyQuaternion(this.quaternion),this.position.add(tL.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(nL,e)}translateY(e){return this.translateOnAxis(iL,e)}translateZ(e){return this.translateOnAxis(rL,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ea.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?Av.copy(e):Av.set(e,n,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Im.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ea.lookAt(Im,Av,this.up):Ea.lookAt(Av,Im,this.up),this.quaternion.setFromRotationMatrix(Ea),r&&(Ea.extractRotation(r.matrixWorld),vh.setFromRotationMatrix(Ea),this.quaternion.premultiply(vh.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(sL),yh.child=e,this.dispatchEvent(yh),yh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(WJ),J_.child=e,this.dispatchEvent(J_),J_.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ea.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ea.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ea),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(sL),yh.child=e,this.dispatchEvent(yh),yh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,n);if(o!==void 0)return o}}getObjectsByProperty(e,n,i=[]){this[e]===n&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,n,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Im,e,VJ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Im,jJ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].updateMatrixWorld(e)}updateWorldMatrix(e,n){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(n){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),p=o(e.animations),f=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),h.length>0&&(i.shapes=h),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),f.length>0&&(i.nodes=f)}return i.object=r,i;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Sn.DEFAULT_UP=new N(0,1,0);Sn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Sn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const uo=new N,Ra=new N,Q_=new N,Ta=new N,Sh=new N,xh=new N,oL=new N,Z_=new N,ew=new N,tw=new N,nw=new Wt,iw=new Wt,rw=new Wt;class wo{constructor(e=new N,n=new N,i=new N){this.a=e,this.b=n,this.c=i}static getNormal(e,n,i,r){r.subVectors(i,n),uo.subVectors(e,n),r.cross(uo);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,n,i,r,s){uo.subVectors(r,n),Ra.subVectors(i,n),Q_.subVectors(e,n);const o=uo.dot(uo),a=uo.dot(Ra),l=uo.dot(Q_),c=Ra.dot(Ra),u=Ra.dot(Q_),h=o*c-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(c*l-a*u)*d,f=(o*u-a*l)*d;return s.set(1-p-f,f,p)}static containsPoint(e,n,i,r){return this.getBarycoord(e,n,i,r,Ta)===null?!1:Ta.x>=0&&Ta.y>=0&&Ta.x+Ta.y<=1}static getInterpolation(e,n,i,r,s,o,a,l){return this.getBarycoord(e,n,i,r,Ta)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Ta.x),l.addScaledVector(o,Ta.y),l.addScaledVector(a,Ta.z),l)}static getInterpolatedAttribute(e,n,i,r,s,o){return nw.setScalar(0),iw.setScalar(0),rw.setScalar(0),nw.fromBufferAttribute(e,n),iw.fromBufferAttribute(e,i),rw.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(nw,s.x),o.addScaledVector(iw,s.y),o.addScaledVector(rw,s.z),o}static isFrontFacing(e,n,i,r){return uo.subVectors(i,n),Ra.subVectors(e,n),uo.cross(Ra).dot(r)<0}set(e,n,i){return this.a.copy(e),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(e,n,i,r){return this.a.copy(e[n]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,n,i,r){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return uo.subVectors(this.c,this.b),Ra.subVectors(this.a,this.b),uo.cross(Ra).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return wo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return wo.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,i,r,s){return wo.getInterpolation(e,this.a,this.b,this.c,n,i,r,s)}containsPoint(e){return wo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return wo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const i=this.a,r=this.b,s=this.c;let o,a;Sh.subVectors(r,i),xh.subVectors(s,i),Z_.subVectors(e,i);const l=Sh.dot(Z_),c=xh.dot(Z_);if(l<=0&&c<=0)return n.copy(i);ew.subVectors(e,r);const u=Sh.dot(ew),h=xh.dot(ew);if(u>=0&&h<=u)return n.copy(r);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return o=l/(l-u),n.copy(i).addScaledVector(Sh,o);tw.subVectors(e,s);const p=Sh.dot(tw),f=xh.dot(tw);if(f>=0&&p<=f)return n.copy(s);const v=p*c-l*f;if(v<=0&&c>=0&&f<=0)return a=c/(c-f),n.copy(i).addScaledVector(xh,a);const g=u*f-p*h;if(g<=0&&h-u>=0&&p-f>=0)return oL.subVectors(s,r),a=(h-u)/(h-u+(p-f)),n.copy(r).addScaledVector(oL,a);const m=1/(g+v+d);return o=v*m,a=d*m,n.copy(i).addScaledVector(Sh,o).addScaledVector(xh,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const jB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},dl={h:0,s:0,l:0},Pv={h:0,s:0,l:0};function sw(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class Ge{constructor(e,n,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,i)}set(e,n,i){if(n===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,n,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=on){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Pt.toWorkingColorSpace(this,n),this}setRGB(e,n,i,r=Pt.workingColorSpace){return this.r=e,this.g=n,this.b=i,Pt.toWorkingColorSpace(this,r),this}setHSL(e,n,i,r=Pt.workingColorSpace){if(e=V2(e,1),n=yi(n,0,1),i=yi(i,0,1),n===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+n):i+n-i*n,o=2*i-s;this.r=sw(o,s,e+1/3),this.g=sw(o,s,e),this.b=sw(o,s,e-1/3)}return Pt.toWorkingColorSpace(this,r),this}setStyle(e,n=on){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=on){const i=jB[e.toLowerCase()];return i!==void 0?this.setHex(i,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=hd(e.r),this.g=hd(e.g),this.b=hd(e.b),this}copyLinearToSRGB(e){return this.r=V_(e.r),this.g=V_(e.g),this.b=V_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=on){return Pt.fromWorkingColorSpace(rr.copy(this),e),Math.round(yi(rr.r*255,0,255))*65536+Math.round(yi(rr.g*255,0,255))*256+Math.round(yi(rr.b*255,0,255))}getHexString(e=on){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Pt.workingColorSpace){Pt.fromWorkingColorSpace(rr.copy(this),n);const i=rr.r,r=rr.g,s=rr.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case i:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-i)/h+2;break;case s:l=(i-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,n=Pt.workingColorSpace){return Pt.fromWorkingColorSpace(rr.copy(this),n),e.r=rr.r,e.g=rr.g,e.b=rr.b,e}getStyle(e=on){Pt.fromWorkingColorSpace(rr.copy(this),e);const n=rr.r,i=rr.g,r=rr.b;return e!==on?`color(${e} ${n.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,n,i){return this.getHSL(dl),this.setHSL(dl.h+e,dl.s+n,dl.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,i){return this.r=e.r+(n.r-e.r)*i,this.g=e.g+(n.g-e.g)*i,this.b=e.b+(n.b-e.b)*i,this}lerpHSL(e,n){this.getHSL(dl),e.getHSL(Pv);const i=Sg(dl.h,Pv.h,n),r=Sg(dl.s,Pv.s,n),s=Sg(dl.l,Pv.l,n);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*n+s[3]*i+s[6]*r,this.g=s[1]*n+s[4]*i+s[7]*r,this.b=s[2]*n+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const rr=new Ge;Ge.NAMES=jB;let GJ=0;class qs extends Sc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:GJ++}),this.uuid=Ao(),this.name="",this.type="Material",this.blending=cd,this.side=Ka,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=dR,this.blendDst=pR,this.blendEquation=eu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ge(0,0,0),this.blendAlpha=0,this.depthFunc=kd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Gk,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hh,this.stencilZFail=hh,this.stencilZPass=hh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const i=e[n];if(i===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const r=this[n];if(r===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==cd&&(i.blending=this.blending),this.side!==Ka&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==dR&&(i.blendSrc=this.blendSrc),this.blendDst!==pR&&(i.blendDst=this.blendDst),this.blendEquation!==eu&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==kd&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Gk&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hh&&(i.stencilFail=this.stencilFail),this.stencilZFail!==hh&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==hh&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(n){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let i=null;if(n!==null){const r=n.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=n[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Dl extends qs{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.combine=Wx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const oi=new N,Iv=new mt;class br{constructor(e,n,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=i,this.usage=KR,this.updateRanges=[],this.gpuType=Ro,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,i){e*=this.itemSize,i*=n.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=n.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)Iv.fromBufferAttribute(this,n),Iv.applyMatrix3(e),this.setXY(n,Iv.x,Iv.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.applyMatrix3(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}applyMatrix4(e){for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.applyMatrix4(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.applyNormalMatrix(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)oi.fromBufferAttribute(this,n),oi.transformDirection(e),this.setXYZ(n,oi.x,oi.y,oi.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let i=this.array[e*this.itemSize+n];return this.normalized&&(i=_o(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=sn(i,this.array)),this.array[e*this.itemSize+n]=i,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=_o(n,this.array)),n}setX(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=_o(n,this.array)),n}setY(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=_o(n,this.array)),n}setZ(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=_o(n,this.array)),n}setW(e,n){return this.normalized&&(n=sn(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array)),this.array[e+0]=n,this.array[e+1]=i,this}setXYZ(e,n,i,r){return e*=this.itemSize,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,n,i,r,s){return e*=this.itemSize,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array),s=sn(s,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==KR&&(e.usage=this.usage),e}}class W2 extends br{constructor(e,n,i){super(new Uint16Array(e),n,i)}}class WB extends br{constructor(e,n,i){super(new Uint32Array(e),n,i)}}class wr extends br{constructor(e,n,i){super(new Float32Array(e),n,i)}}let qJ=0;const Ps=new je,ow=new Sn,Ch=new N,is=new ha,Mm=new ha,bi=new N;class ys extends Sc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qJ++}),this.uuid=Ao(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($B(e)?WB:W2)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,i=0){this.groups.push({start:e,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new bt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ps.makeRotationFromQuaternion(e),this.applyMatrix4(Ps),this}rotateX(e){return Ps.makeRotationX(e),this.applyMatrix4(Ps),this}rotateY(e){return Ps.makeRotationY(e),this.applyMatrix4(Ps),this}rotateZ(e){return Ps.makeRotationZ(e),this.applyMatrix4(Ps),this}translate(e,n,i){return Ps.makeTranslation(e,n,i),this.applyMatrix4(Ps),this}scale(e,n,i){return Ps.makeScale(e,n,i),this.applyMatrix4(Ps),this}lookAt(e){return ow.lookAt(e),ow.updateMatrix(),this.applyMatrix4(ow.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ch).negate(),this.translate(Ch.x,Ch.y,Ch.z),this}setFromPoints(e){const n=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];n.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new wr(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ha);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let i=0,r=n.length;i<r;i++){const s=n[i];is.setFromBufferAttribute(s),this.morphTargetsRelative?(bi.addVectors(this.boundingBox.min,is.min),this.boundingBox.expandByPoint(bi),bi.addVectors(this.boundingBox.max,is.max),this.boundingBox.expandByPoint(bi)):(this.boundingBox.expandByPoint(is.min),this.boundingBox.expandByPoint(is.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new da);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new N,1/0);return}if(e){const i=this.boundingSphere.center;if(is.setFromBufferAttribute(e),n)for(let s=0,o=n.length;s<o;s++){const a=n[s];Mm.setFromBufferAttribute(a),this.morphTargetsRelative?(bi.addVectors(is.min,Mm.min),is.expandByPoint(bi),bi.addVectors(is.max,Mm.max),is.expandByPoint(bi)):(is.expandByPoint(Mm.min),is.expandByPoint(Mm.max))}is.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)bi.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(bi));if(n)for(let s=0,o=n.length;s<o;s++){const a=n[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)bi.fromBufferAttribute(a,c),l&&(Ch.fromBufferAttribute(e,c),bi.add(Ch)),r=Math.max(r,i.distanceToSquared(bi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=n.position,r=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new br(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let T=0;T<i.count;T++)a[T]=new N,l[T]=new N;const c=new N,u=new N,h=new N,d=new mt,p=new mt,f=new mt,v=new N,g=new N;function m(T,M,_){c.fromBufferAttribute(i,T),u.fromBufferAttribute(i,M),h.fromBufferAttribute(i,_),d.fromBufferAttribute(s,T),p.fromBufferAttribute(s,M),f.fromBufferAttribute(s,_),u.sub(c),h.sub(c),p.sub(d),f.sub(d);const R=1/(p.x*f.y-f.x*p.y);isFinite(R)&&(v.copy(u).multiplyScalar(f.y).addScaledVector(h,-p.y).multiplyScalar(R),g.copy(h).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(R),a[T].add(v),a[M].add(v),a[_].add(v),l[T].add(g),l[M].add(g),l[_].add(g))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let T=0,M=y.length;T<M;++T){const _=y[T],R=_.start,L=_.count;for(let z=R,G=R+L;z<G;z+=3)m(e.getX(z+0),e.getX(z+1),e.getX(z+2))}const S=new N,x=new N,w=new N,C=new N;function E(T){w.fromBufferAttribute(r,T),C.copy(w);const M=a[T];S.copy(M),S.sub(w.multiplyScalar(w.dot(M))).normalize(),x.crossVectors(C,M);const R=x.dot(l[T])<0?-1:1;o.setXYZW(T,S.x,S.y,S.z,R)}for(let T=0,M=y.length;T<M;++T){const _=y[T],R=_.start,L=_.count;for(let z=R,G=R+L;z<G;z+=3)E(e.getX(z+0)),E(e.getX(z+1)),E(e.getX(z+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new br(new Float32Array(n.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const r=new N,s=new N,o=new N,a=new N,l=new N,c=new N,u=new N,h=new N;if(e)for(let d=0,p=e.count;d<p;d+=3){const f=e.getX(d+0),v=e.getX(d+1),g=e.getX(d+2);r.fromBufferAttribute(n,f),s.fromBufferAttribute(n,v),o.fromBufferAttribute(n,g),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,v),c.fromBufferAttribute(i,g),a.add(u),l.add(u),c.add(u),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(v,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z)}else for(let d=0,p=n.count;d<p;d+=3)r.fromBufferAttribute(n,d+0),s.fromBufferAttribute(n,d+1),o.fromBufferAttribute(n,d+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),i.setXYZ(d+0,u.x,u.y,u.z),i.setXYZ(d+1,u.x,u.y,u.z),i.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,i=e.count;n<i;n++)bi.fromBufferAttribute(e,n),bi.normalize(),e.setXYZ(n,bi.x,bi.y,bi.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,d=new c.constructor(l.length*u);let p=0,f=0;for(let v=0,g=l.length;v<g;v++){a.isInterleavedBufferAttribute?p=l[v]*a.data.stride+a.offset:p=l[v]*u;for(let m=0;m<u;m++)d[f++]=c[p++]}return new br(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new ys,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);n.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const d=c[u],p=e(d,i);l.push(p)}n.morphAttributes[a]=l}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];n.addGroup(c.start,c.count,c.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h];u.push(p.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(n));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(n))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(n));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const aL=new je,Hc=new lp,Mv=new da,lL=new N,kv=new N,Lv=new N,Dv=new N,aw=new N,Nv=new N,cL=new N,Ov=new N;class gn extends Sn{constructor(e=new ys,n=new Dl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,n){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;n.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){Nv.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(aw.fromBufferAttribute(h,e),o?Nv.addScaledVector(aw,u):Nv.addScaledVector(aw.sub(n),u))}n.add(Nv)}return n}raycast(e,n){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Mv.copy(i.boundingSphere),Mv.applyMatrix4(s),Hc.copy(e.ray).recast(e.near),!(Mv.containsPoint(Hc.origin)===!1&&(Hc.intersectSphere(Mv,lL)===null||Hc.origin.distanceToSquared(lL)>(e.far-e.near)**2))&&(aL.copy(s).invert(),Hc.copy(e.ray).applyMatrix4(aL),!(i.boundingBox!==null&&Hc.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,n,Hc)))}_computeIntersections(e,n,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(a!==null)if(Array.isArray(o))for(let f=0,v=d.length;f<v;f++){const g=d[f],m=o[g.materialIndex],y=Math.max(g.start,p.start),S=Math.min(a.count,Math.min(g.start+g.count,p.start+p.count));for(let x=y,w=S;x<w;x+=3){const C=a.getX(x),E=a.getX(x+1),T=a.getX(x+2);r=Fv(this,m,e,i,c,u,h,C,E,T),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,n.push(r))}}else{const f=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let g=f,m=v;g<m;g+=3){const y=a.getX(g),S=a.getX(g+1),x=a.getX(g+2);r=Fv(this,o,e,i,c,u,h,y,S,x),r&&(r.faceIndex=Math.floor(g/3),n.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let f=0,v=d.length;f<v;f++){const g=d[f],m=o[g.materialIndex],y=Math.max(g.start,p.start),S=Math.min(l.count,Math.min(g.start+g.count,p.start+p.count));for(let x=y,w=S;x<w;x+=3){const C=x,E=x+1,T=x+2;r=Fv(this,m,e,i,c,u,h,C,E,T),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,n.push(r))}}else{const f=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let g=f,m=v;g<m;g+=3){const y=g,S=g+1,x=g+2;r=Fv(this,o,e,i,c,u,h,y,S,x),r&&(r.faceIndex=Math.floor(g/3),n.push(r))}}}}function XJ(t,e,n,i,r,s,o,a){let l;if(e.side===Tr?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===Ka,a),l===null)return null;Ov.copy(a),Ov.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(Ov);return c<n.near||c>n.far?null:{distance:c,point:Ov.clone(),object:t}}function Fv(t,e,n,i,r,s,o,a,l,c){t.getVertexPosition(a,kv),t.getVertexPosition(l,Lv),t.getVertexPosition(c,Dv);const u=XJ(t,e,n,i,kv,Lv,Dv,cL);if(u){const h=new N;wo.getBarycoord(cL,kv,Lv,Dv,h),r&&(u.uv=wo.getInterpolatedAttribute(r,a,l,c,h,new mt)),s&&(u.uv1=wo.getInterpolatedAttribute(s,a,l,c,h,new mt)),o&&(u.normal=wo.getInterpolatedAttribute(o,a,l,c,h,new N),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new N,materialIndex:0};wo.getNormal(kv,Lv,Dv,d.normal),u.face=d,u.barycoord=h}return u}class cp extends ys{constructor(e=1,n=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let d=0,p=0;f("z","y","x",-1,-1,i,n,e,o,s,0),f("z","y","x",1,-1,i,n,-e,o,s,1),f("x","z","y",1,1,e,i,n,r,o,2),f("x","z","y",1,-1,e,i,-n,r,o,3),f("x","y","z",1,-1,e,n,i,r,s,4),f("x","y","z",-1,-1,e,n,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new wr(c,3)),this.setAttribute("normal",new wr(u,3)),this.setAttribute("uv",new wr(h,2));function f(v,g,m,y,S,x,w,C,E,T,M){const _=x/E,R=w/T,L=x/2,z=w/2,G=C/2,$=E+1,H=T+1;let q=0,D=0;const Z=new N;for(let P=0;P<H;P++){const le=P*R-z;for(let Se=0;Se<$;Se++){const k=Se*_-L;Z[v]=k*y,Z[g]=le*S,Z[m]=G,c.push(Z.x,Z.y,Z.z),Z[v]=0,Z[g]=0,Z[m]=C>0?1:-1,u.push(Z.x,Z.y,Z.z),h.push(Se/E),h.push(1-P/T),q+=1}}for(let P=0;P<T;P++)for(let le=0;le<E;le++){const Se=d+le+$*P,k=d+le+$*(P+1),J=d+(le+1)+$*(P+1),oe=d+(le+1)+$*P;l.push(Se,k,oe),l.push(k,J,oe),D+=6}a.addGroup(p,D,M),p+=D,d+=q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function zd(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function xr(t){const e={};for(let n=0;n<t.length;n++){const i=zd(t[n]);for(const r in i)e[r]=i[r]}return e}function KJ(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function GB(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Pt.workingColorSpace}const YJ={clone:zd,merge:xr};var JJ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,QJ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class rc extends qs{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=JJ,this.fragmentShader=QJ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zd(e.uniforms),this.uniformsGroups=KJ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?n.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?n.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[r]={type:"m4",value:o.toArray()}:n.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}class qB extends Sn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new je,this.projectionMatrix=new je,this.projectionMatrixInverse=new je,this.coordinateSystem=Ua}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const pl=new N,uL=new mt,hL=new mt;class cr extends qB{constructor(e=50,n=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=Fd*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(yg*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Fd*2*Math.atan(Math.tan(yg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,i){pl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(pl.x,pl.y).multiplyScalar(-e/pl.z),pl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(pl.x,pl.y).multiplyScalar(-e/pl.z)}getViewSize(e,n){return this.getViewBounds(e,uL,hL),n.subVectors(hL,uL)}setViewOffset(e,n,i,r,s,o){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(yg*.5*this.fov)/this.zoom,i=2*n,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,n-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,n,n-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const _h=-90,wh=1;class ZJ extends Sn{constructor(e,n,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new cr(_h,wh,e,n);r.layers=this.layers,this.add(r);const s=new cr(_h,wh,e,n);s.layers=this.layers,this.add(s);const o=new cr(_h,wh,e,n);o.layers=this.layers,this.add(o);const a=new cr(_h,wh,e,n);a.layers=this.layers,this.add(a);const l=new cr(_h,wh,e,n);l.layers=this.layers,this.add(l);const c=new cr(_h,wh,e,n);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[i,r,s,o,a,l]=n;for(const c of n)this.remove(c);if(e===Ua)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===P1)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of n)this.add(c),c.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(n,s),e.setRenderTarget(i,1,r),e.render(n,o),e.setRenderTarget(i,2,r),e.render(n,a),e.setRenderTarget(i,3,r),e.render(n,l),e.setRenderTarget(i,4,r),e.render(n,c),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,r),e.render(n,u),e.setRenderTarget(h,d,p),e.xr.enabled=f,i.texture.needsPMREMUpdate=!0}}class XB extends wi{constructor(e,n,i,r,s,o,a,l,c,u){e=e!==void 0?e:[],n=n!==void 0?n:Ld,super(e,n,i,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class eQ extends Mu{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new XB(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:ds}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new cp(5,5,5),s=new rc({name:"CubemapFromEquirect",uniforms:zd(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Tr,blending:Xl});s.uniforms.tEquirect.value=n;const o=new gn(r,s),a=n.minFilter;return n.minFilter===za&&(n.minFilter=ds),new ZJ(1,10,this).update(e,o),n.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,n,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(n,i,r);e.setRenderTarget(s)}}const lw=new N,tQ=new N,nQ=new bt;class El{constructor(e=new N(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,i,r){return this.normal.set(e,n,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,i){const r=lw.subVectors(i,n).cross(tQ.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const i=e.delta(lw),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:n.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return n<0&&i>0||i<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const i=n||nQ.getNormalMatrix(e),r=this.coplanarPoint(lw).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Vc=new da,zv=new N;class G2{constructor(e=new El,n=new El,i=new El,r=new El,s=new El,o=new El){this.planes=[e,n,i,r,s,o]}set(e,n,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,n=Ua){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],p=r[8],f=r[9],v=r[10],g=r[11],m=r[12],y=r[13],S=r[14],x=r[15];if(i[0].setComponents(l-s,d-c,g-p,x-m).normalize(),i[1].setComponents(l+s,d+c,g+p,x+m).normalize(),i[2].setComponents(l+o,d+u,g+f,x+y).normalize(),i[3].setComponents(l-o,d-u,g-f,x-y).normalize(),i[4].setComponents(l-a,d-h,g-v,x-S).normalize(),n===Ua)i[5].setComponents(l+a,d+h,g+v,x+S).normalize();else if(n===P1)i[5].setComponents(a,h,v,S).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Vc.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Vc.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Vc)}intersectsSprite(e){return Vc.center.set(0,0,0),Vc.radius=.7071067811865476,Vc.applyMatrix4(e.matrixWorld),this.intersectsSphere(Vc)}intersectsSphere(e){const n=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const n=this.planes;for(let i=0;i<6;i++){const r=n[i];if(zv.x=r.normal.x>0?e.max.x:e.min.x,zv.y=r.normal.y>0?e.max.y:e.min.y,zv.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(zv)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function KB(){let t=null,e=!1,n=null,i=null;function r(s,o){n(s,o),i=t.requestAnimationFrame(r)}return{start:function(){e!==!0&&n!==null&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function iQ(t){const e=new WeakMap;function n(a,l){const c=a.array,u=a.usage,h=c.byteLength,d=t.createBuffer();t.bindBuffer(l,d),t.bufferData(l,c,u),a.onUploadCallback();let p;if(c instanceof Float32Array)p=t.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?p=t.HALF_FLOAT:p=t.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=t.SHORT;else if(c instanceof Uint32Array)p=t.UNSIGNED_INT;else if(c instanceof Int32Array)p=t.INT;else if(c instanceof Int8Array)p=t.BYTE;else if(c instanceof Uint8Array)p=t.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:h}}function i(a,l,c){const u=l.array,h=l.updateRanges;if(t.bindBuffer(c,a),h.length===0)t.bufferSubData(c,0,u);else{h.sort((p,f)=>p.start-f.start);let d=0;for(let p=1;p<h.length;p++){const f=h[d],v=h[p];v.start<=f.start+f.count+1?f.count=Math.max(f.count,v.start+v.count-f.start):(++d,h[d]=v)}h.length=d+1;for(let p=0,f=h.length;p<f;p++){const v=h[p];t.bufferSubData(c,v.start*u.BYTES_PER_ELEMENT,u,v.start,v.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(t.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,n(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:r,remove:s,update:o}}class Kx extends ys{constructor(e=1,n=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:i,heightSegments:r};const s=e/2,o=n/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,h=e/a,d=n/l,p=[],f=[],v=[],g=[];for(let m=0;m<u;m++){const y=m*d-o;for(let S=0;S<c;S++){const x=S*h-s;f.push(x,-y,0),v.push(0,0,1),g.push(S/a),g.push(1-m/l)}}for(let m=0;m<l;m++)for(let y=0;y<a;y++){const S=y+c*m,x=y+c*(m+1),w=y+1+c*(m+1),C=y+1+c*m;p.push(S,x,C),p.push(x,w,C)}this.setIndex(p),this.setAttribute("position",new wr(f,3)),this.setAttribute("normal",new wr(v,3)),this.setAttribute("uv",new wr(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Kx(e.width,e.height,e.widthSegments,e.heightSegments)}}var rQ=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,sQ=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,oQ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,aQ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,lQ=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,cQ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,uQ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,hQ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,dQ=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,pQ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,fQ=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,mQ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,gQ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,vQ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,yQ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,SQ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,xQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,CQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,_Q=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,wQ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,EQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,RQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,TQ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,bQ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,AQ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,PQ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,IQ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,MQ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,kQ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,LQ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,DQ="gl_FragColor = linearToOutputTexel( gl_FragColor );",NQ=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,OQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,FQ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,zQ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,UQ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,BQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,$Q=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,HQ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,VQ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,jQ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,WQ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,GQ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,qQ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,XQ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,KQ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,YQ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,JQ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,QQ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ZQ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,eZ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,tZ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,nZ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,iZ=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,rZ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,sZ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,oZ=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,aZ=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,lZ=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,cZ=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,uZ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,hZ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,dZ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,pZ=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fZ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,mZ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,gZ=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,vZ=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,yZ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,SZ=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,xZ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,CZ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,_Z=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,wZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,EZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,RZ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,TZ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,bZ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,AZ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,PZ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,IZ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,MZ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,kZ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,LZ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,DZ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,NZ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,OZ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,FZ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,zZ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,UZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,BZ=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,$Z=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,HZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,VZ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,jZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,WZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,GZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,qZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,XZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,KZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,YZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,JZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,QZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,ZZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,eee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,tee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,nee=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const iee=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,ree=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,see=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,oee=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aee=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,lee=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cee=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,uee=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,hee=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,dee=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,pee=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fee=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mee=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,gee=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vee=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,yee=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,See=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xee=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cee=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,_ee=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wee=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Eee=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Ree=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Tee=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bee=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Aee=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Pee=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Iee=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mee=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,kee=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Lee=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Dee=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Nee=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Oee=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,At={alphahash_fragment:rQ,alphahash_pars_fragment:sQ,alphamap_fragment:oQ,alphamap_pars_fragment:aQ,alphatest_fragment:lQ,alphatest_pars_fragment:cQ,aomap_fragment:uQ,aomap_pars_fragment:hQ,batching_pars_vertex:dQ,batching_vertex:pQ,begin_vertex:fQ,beginnormal_vertex:mQ,bsdfs:gQ,iridescence_fragment:vQ,bumpmap_pars_fragment:yQ,clipping_planes_fragment:SQ,clipping_planes_pars_fragment:xQ,clipping_planes_pars_vertex:CQ,clipping_planes_vertex:_Q,color_fragment:wQ,color_pars_fragment:EQ,color_pars_vertex:RQ,color_vertex:TQ,common:bQ,cube_uv_reflection_fragment:AQ,defaultnormal_vertex:PQ,displacementmap_pars_vertex:IQ,displacementmap_vertex:MQ,emissivemap_fragment:kQ,emissivemap_pars_fragment:LQ,colorspace_fragment:DQ,colorspace_pars_fragment:NQ,envmap_fragment:OQ,envmap_common_pars_fragment:FQ,envmap_pars_fragment:zQ,envmap_pars_vertex:UQ,envmap_physical_pars_fragment:YQ,envmap_vertex:BQ,fog_vertex:$Q,fog_pars_vertex:HQ,fog_fragment:VQ,fog_pars_fragment:jQ,gradientmap_pars_fragment:WQ,lightmap_pars_fragment:GQ,lights_lambert_fragment:qQ,lights_lambert_pars_fragment:XQ,lights_pars_begin:KQ,lights_toon_fragment:JQ,lights_toon_pars_fragment:QQ,lights_phong_fragment:ZQ,lights_phong_pars_fragment:eZ,lights_physical_fragment:tZ,lights_physical_pars_fragment:nZ,lights_fragment_begin:iZ,lights_fragment_maps:rZ,lights_fragment_end:sZ,logdepthbuf_fragment:oZ,logdepthbuf_pars_fragment:aZ,logdepthbuf_pars_vertex:lZ,logdepthbuf_vertex:cZ,map_fragment:uZ,map_pars_fragment:hZ,map_particle_fragment:dZ,map_particle_pars_fragment:pZ,metalnessmap_fragment:fZ,metalnessmap_pars_fragment:mZ,morphinstance_vertex:gZ,morphcolor_vertex:vZ,morphnormal_vertex:yZ,morphtarget_pars_vertex:SZ,morphtarget_vertex:xZ,normal_fragment_begin:CZ,normal_fragment_maps:_Z,normal_pars_fragment:wZ,normal_pars_vertex:EZ,normal_vertex:RZ,normalmap_pars_fragment:TZ,clearcoat_normal_fragment_begin:bZ,clearcoat_normal_fragment_maps:AZ,clearcoat_pars_fragment:PZ,iridescence_pars_fragment:IZ,opaque_fragment:MZ,packing:kZ,premultiplied_alpha_fragment:LZ,project_vertex:DZ,dithering_fragment:NZ,dithering_pars_fragment:OZ,roughnessmap_fragment:FZ,roughnessmap_pars_fragment:zZ,shadowmap_pars_fragment:UZ,shadowmap_pars_vertex:BZ,shadowmap_vertex:$Z,shadowmask_pars_fragment:HZ,skinbase_vertex:VZ,skinning_pars_vertex:jZ,skinning_vertex:WZ,skinnormal_vertex:GZ,specularmap_fragment:qZ,specularmap_pars_fragment:XZ,tonemapping_fragment:KZ,tonemapping_pars_fragment:YZ,transmission_fragment:JZ,transmission_pars_fragment:QZ,uv_pars_fragment:ZZ,uv_pars_vertex:eee,uv_vertex:tee,worldpos_vertex:nee,background_vert:iee,background_frag:ree,backgroundCube_vert:see,backgroundCube_frag:oee,cube_vert:aee,cube_frag:lee,depth_vert:cee,depth_frag:uee,distanceRGBA_vert:hee,distanceRGBA_frag:dee,equirect_vert:pee,equirect_frag:fee,linedashed_vert:mee,linedashed_frag:gee,meshbasic_vert:vee,meshbasic_frag:yee,meshlambert_vert:See,meshlambert_frag:xee,meshmatcap_vert:Cee,meshmatcap_frag:_ee,meshnormal_vert:wee,meshnormal_frag:Eee,meshphong_vert:Ree,meshphong_frag:Tee,meshphysical_vert:bee,meshphysical_frag:Aee,meshtoon_vert:Pee,meshtoon_frag:Iee,points_vert:Mee,points_frag:kee,shadow_vert:Lee,shadow_frag:Dee,sprite_vert:Nee,sprite_frag:Oee},be={common:{diffuse:{value:new Ge(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new bt},alphaMap:{value:null},alphaMapTransform:{value:new bt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new bt}},envmap:{envMap:{value:null},envMapRotation:{value:new bt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new bt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new bt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new bt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new bt},normalScale:{value:new mt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new bt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new bt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new bt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new bt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ge(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ge(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new bt},alphaTest:{value:0},uvTransform:{value:new bt}},sprite:{diffuse:{value:new Ge(16777215)},opacity:{value:1},center:{value:new mt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new bt},alphaMap:{value:null},alphaMapTransform:{value:new bt},alphaTest:{value:0}}},Yo={basic:{uniforms:xr([be.common,be.specularmap,be.envmap,be.aomap,be.lightmap,be.fog]),vertexShader:At.meshbasic_vert,fragmentShader:At.meshbasic_frag},lambert:{uniforms:xr([be.common,be.specularmap,be.envmap,be.aomap,be.lightmap,be.emissivemap,be.bumpmap,be.normalmap,be.displacementmap,be.fog,be.lights,{emissive:{value:new Ge(0)}}]),vertexShader:At.meshlambert_vert,fragmentShader:At.meshlambert_frag},phong:{uniforms:xr([be.common,be.specularmap,be.envmap,be.aomap,be.lightmap,be.emissivemap,be.bumpmap,be.normalmap,be.displacementmap,be.fog,be.lights,{emissive:{value:new Ge(0)},specular:{value:new Ge(1118481)},shininess:{value:30}}]),vertexShader:At.meshphong_vert,fragmentShader:At.meshphong_frag},standard:{uniforms:xr([be.common,be.envmap,be.aomap,be.lightmap,be.emissivemap,be.bumpmap,be.normalmap,be.displacementmap,be.roughnessmap,be.metalnessmap,be.fog,be.lights,{emissive:{value:new Ge(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:At.meshphysical_vert,fragmentShader:At.meshphysical_frag},toon:{uniforms:xr([be.common,be.aomap,be.lightmap,be.emissivemap,be.bumpmap,be.normalmap,be.displacementmap,be.gradientmap,be.fog,be.lights,{emissive:{value:new Ge(0)}}]),vertexShader:At.meshtoon_vert,fragmentShader:At.meshtoon_frag},matcap:{uniforms:xr([be.common,be.bumpmap,be.normalmap,be.displacementmap,be.fog,{matcap:{value:null}}]),vertexShader:At.meshmatcap_vert,fragmentShader:At.meshmatcap_frag},points:{uniforms:xr([be.points,be.fog]),vertexShader:At.points_vert,fragmentShader:At.points_frag},dashed:{uniforms:xr([be.common,be.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:At.linedashed_vert,fragmentShader:At.linedashed_frag},depth:{uniforms:xr([be.common,be.displacementmap]),vertexShader:At.depth_vert,fragmentShader:At.depth_frag},normal:{uniforms:xr([be.common,be.bumpmap,be.normalmap,be.displacementmap,{opacity:{value:1}}]),vertexShader:At.meshnormal_vert,fragmentShader:At.meshnormal_frag},sprite:{uniforms:xr([be.sprite,be.fog]),vertexShader:At.sprite_vert,fragmentShader:At.sprite_frag},background:{uniforms:{uvTransform:{value:new bt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:At.background_vert,fragmentShader:At.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new bt}},vertexShader:At.backgroundCube_vert,fragmentShader:At.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:At.cube_vert,fragmentShader:At.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:At.equirect_vert,fragmentShader:At.equirect_frag},distanceRGBA:{uniforms:xr([be.common,be.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:At.distanceRGBA_vert,fragmentShader:At.distanceRGBA_frag},shadow:{uniforms:xr([be.lights,be.fog,{color:{value:new Ge(0)},opacity:{value:1}}]),vertexShader:At.shadow_vert,fragmentShader:At.shadow_frag}};Yo.physical={uniforms:xr([Yo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new bt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new bt},clearcoatNormalScale:{value:new mt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new bt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new bt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new bt},sheen:{value:0},sheenColor:{value:new Ge(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new bt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new bt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new bt},transmissionSamplerSize:{value:new mt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new bt},attenuationDistance:{value:0},attenuationColor:{value:new Ge(0)},specularColor:{value:new Ge(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new bt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new bt},anisotropyVector:{value:new mt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new bt}}]),vertexShader:At.meshphysical_vert,fragmentShader:At.meshphysical_frag};const Uv={r:0,b:0,g:0},jc=new fn,Fee=new je;function zee(t,e,n,i,r,s,o){const a=new Ge(0);let l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(y){let S=y.isScene===!0?y.background:null;return S&&S.isTexture&&(S=(y.backgroundBlurriness>0?n:e).get(S)),S}function v(y){let S=!1;const x=f(y);x===null?m(a,l):x&&x.isColor&&(m(x,1),S=!0);const w=t.xr.getEnvironmentBlendMode();w==="additive"?i.buffers.color.setClear(0,0,0,1,o):w==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(t.autoClear||S)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function g(y,S){const x=f(S);x&&(x.isCubeTexture||x.mapping===Gx)?(u===void 0&&(u=new gn(new cp(1,1,1),new rc({name:"BackgroundCubeMaterial",uniforms:zd(Yo.backgroundCube.uniforms),vertexShader:Yo.backgroundCube.vertexShader,fragmentShader:Yo.backgroundCube.fragmentShader,side:Tr,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,C,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),jc.copy(S.backgroundRotation),jc.x*=-1,jc.y*=-1,jc.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(jc.y*=-1,jc.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=S.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Fee.makeRotationFromEuler(jc)),u.material.toneMapped=Pt.getTransfer(x.colorSpace)!==Pn,(h!==x||d!==x.version||p!==t.toneMapping)&&(u.material.needsUpdate=!0,h=x,d=x.version,p=t.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new gn(new Kx(2,2),new rc({name:"BackgroundMaterial",uniforms:zd(Yo.background.uniforms),vertexShader:Yo.background.vertexShader,fragmentShader:Yo.background.fragmentShader,side:Ka,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,c.material.toneMapped=Pt.getTransfer(x.colorSpace)!==Pn,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||d!==x.version||p!==t.toneMapping)&&(c.material.needsUpdate=!0,h=x,d=x.version,p=t.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null))}function m(y,S){y.getRGB(Uv,GB(t)),i.buffers.color.setClear(Uv.r,Uv.g,Uv.b,S,o)}return{getClearColor:function(){return a},setClearColor:function(y,S=1){a.set(y),l=S,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,m(a,l)},render:v,addToRenderList:g}}function Uee(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=d(null);let s=r,o=!1;function a(_,R,L,z,G){let $=!1;const H=h(z,L,R);s!==H&&(s=H,c(s.object)),$=p(_,z,L,G),$&&f(_,z,L,G),G!==null&&e.update(G,t.ELEMENT_ARRAY_BUFFER),($||o)&&(o=!1,x(_,R,L,z),G!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(G).buffer))}function l(){return t.createVertexArray()}function c(_){return t.bindVertexArray(_)}function u(_){return t.deleteVertexArray(_)}function h(_,R,L){const z=L.wireframe===!0;let G=i[_.id];G===void 0&&(G={},i[_.id]=G);let $=G[R.id];$===void 0&&($={},G[R.id]=$);let H=$[z];return H===void 0&&(H=d(l()),$[z]=H),H}function d(_){const R=[],L=[],z=[];for(let G=0;G<n;G++)R[G]=0,L[G]=0,z[G]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:L,attributeDivisors:z,object:_,attributes:{},index:null}}function p(_,R,L,z){const G=s.attributes,$=R.attributes;let H=0;const q=L.getAttributes();for(const D in q)if(q[D].location>=0){const P=G[D];let le=$[D];if(le===void 0&&(D==="instanceMatrix"&&_.instanceMatrix&&(le=_.instanceMatrix),D==="instanceColor"&&_.instanceColor&&(le=_.instanceColor)),P===void 0||P.attribute!==le||le&&P.data!==le.data)return!0;H++}return s.attributesNum!==H||s.index!==z}function f(_,R,L,z){const G={},$=R.attributes;let H=0;const q=L.getAttributes();for(const D in q)if(q[D].location>=0){let P=$[D];P===void 0&&(D==="instanceMatrix"&&_.instanceMatrix&&(P=_.instanceMatrix),D==="instanceColor"&&_.instanceColor&&(P=_.instanceColor));const le={};le.attribute=P,P&&P.data&&(le.data=P.data),G[D]=le,H++}s.attributes=G,s.attributesNum=H,s.index=z}function v(){const _=s.newAttributes;for(let R=0,L=_.length;R<L;R++)_[R]=0}function g(_){m(_,0)}function m(_,R){const L=s.newAttributes,z=s.enabledAttributes,G=s.attributeDivisors;L[_]=1,z[_]===0&&(t.enableVertexAttribArray(_),z[_]=1),G[_]!==R&&(t.vertexAttribDivisor(_,R),G[_]=R)}function y(){const _=s.newAttributes,R=s.enabledAttributes;for(let L=0,z=R.length;L<z;L++)R[L]!==_[L]&&(t.disableVertexAttribArray(L),R[L]=0)}function S(_,R,L,z,G,$,H){H===!0?t.vertexAttribIPointer(_,R,L,G,$):t.vertexAttribPointer(_,R,L,z,G,$)}function x(_,R,L,z){v();const G=z.attributes,$=L.getAttributes(),H=R.defaultAttributeValues;for(const q in $){const D=$[q];if(D.location>=0){let Z=G[q];if(Z===void 0&&(q==="instanceMatrix"&&_.instanceMatrix&&(Z=_.instanceMatrix),q==="instanceColor"&&_.instanceColor&&(Z=_.instanceColor)),Z!==void 0){const P=Z.normalized,le=Z.itemSize,Se=e.get(Z);if(Se===void 0)continue;const k=Se.buffer,J=Se.type,oe=Se.bytesPerElement,pe=J===t.INT||J===t.UNSIGNED_INT||Z.gpuType===D2;if(Z.isInterleavedBufferAttribute){const ye=Z.data,nt=ye.stride,Je=Z.offset;if(ye.isInstancedInterleavedBuffer){for(let _t=0;_t<D.locationSize;_t++)m(D.location+_t,ye.meshPerAttribute);_.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=ye.meshPerAttribute*ye.count)}else for(let _t=0;_t<D.locationSize;_t++)g(D.location+_t);t.bindBuffer(t.ARRAY_BUFFER,k);for(let _t=0;_t<D.locationSize;_t++)S(D.location+_t,le/D.locationSize,J,P,nt*oe,(Je+le/D.locationSize*_t)*oe,pe)}else{if(Z.isInstancedBufferAttribute){for(let ye=0;ye<D.locationSize;ye++)m(D.location+ye,Z.meshPerAttribute);_.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(let ye=0;ye<D.locationSize;ye++)g(D.location+ye);t.bindBuffer(t.ARRAY_BUFFER,k);for(let ye=0;ye<D.locationSize;ye++)S(D.location+ye,le/D.locationSize,J,P,le*oe,le/D.locationSize*ye*oe,pe)}}else if(H!==void 0){const P=H[q];if(P!==void 0)switch(P.length){case 2:t.vertexAttrib2fv(D.location,P);break;case 3:t.vertexAttrib3fv(D.location,P);break;case 4:t.vertexAttrib4fv(D.location,P);break;default:t.vertexAttrib1fv(D.location,P)}}}}y()}function w(){T();for(const _ in i){const R=i[_];for(const L in R){const z=R[L];for(const G in z)u(z[G].object),delete z[G];delete R[L]}delete i[_]}}function C(_){if(i[_.id]===void 0)return;const R=i[_.id];for(const L in R){const z=R[L];for(const G in z)u(z[G].object),delete z[G];delete R[L]}delete i[_.id]}function E(_){for(const R in i){const L=i[R];if(L[_.id]===void 0)continue;const z=L[_.id];for(const G in z)u(z[G].object),delete z[G];delete L[_.id]}}function T(){M(),o=!0,s!==r&&(s=r,c(s.object))}function M(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:T,resetDefaultState:M,dispose:w,releaseStatesOfGeometry:C,releaseStatesOfProgram:E,initAttributes:v,enableAttribute:g,disableUnusedAttributes:y}}function Bee(t,e,n){let i;function r(c){i=c}function s(c,u){t.drawArrays(i,c,u),n.update(u,i,1)}function o(c,u,h){h!==0&&(t.drawArraysInstanced(i,c,u,h),n.update(u,i,h))}function a(c,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,u,0,h);let p=0;for(let f=0;f<h;f++)p+=u[f];n.update(p,i,1)}function l(c,u,h,d){if(h===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let f=0;f<c.length;f++)o(c[f],u[f],d[f]);else{p.multiDrawArraysInstancedWEBGL(i,c,0,u,0,d,0,h);let f=0;for(let v=0;v<h;v++)f+=u[v];for(let v=0;v<d.length;v++)n.update(f,i,d[v])}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function $ee(t,e,n,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const E=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(E){return!(E!==Bs&&i.convert(E)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(E){const T=E===L0&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(E!==Ya&&i.convert(E)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&E!==Ro&&!T)}function l(E){if(E==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";E="mediump"}return E==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=n.precision!==void 0?n.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=n.logarithmicDepthBuffer===!0,d=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(d===!0){const E=e.get("EXT_clip_control");E.clipControlEXT(E.LOWER_LEFT_EXT,E.ZERO_TO_ONE_EXT)}const p=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),f=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=t.getParameter(t.MAX_TEXTURE_SIZE),g=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),m=t.getParameter(t.MAX_VERTEX_ATTRIBS),y=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),S=t.getParameter(t.MAX_VARYING_VECTORS),x=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),w=f>0,C=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:p,maxVertexTextures:f,maxTextureSize:v,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:y,maxVaryings:S,maxFragmentUniforms:x,vertexTextures:w,maxSamples:C}}function Hee(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new El,a=new bt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||i!==0||r;return r=d,i=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){n=u(h,d,0)},this.setState=function(h,d,p){const f=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,m=t.get(h);if(!r||f===null||f.length===0||s&&!g)s?u(null):c();else{const y=s?0:i,S=y*4;let x=m.clippingState||null;l.value=x,x=u(f,d,S,p);for(let w=0;w!==S;++w)x[w]=n[w];m.clippingState=x,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(h,d,p,f){const v=h!==null?h.length:0;let g=null;if(v!==0){if(g=l.value,f!==!0||g===null){const m=p+v*4,y=d.matrixWorldInverse;a.getNormalMatrix(y),(g===null||g.length<m)&&(g=new Float32Array(m));for(let S=0,x=p;S!==v;++S,x+=4)o.copy(h[S]).applyMatrix4(y,a),o.normal.toArray(g,x),g[x+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,g}}function Vee(t){let e=new WeakMap;function n(o,a){return a===w1?o.mapping=Ld:a===CR&&(o.mapping=Dd),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===w1||a===CR)if(e.has(o)){const l=e.get(o).texture;return n(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new eQ(l.height);return c.fromEquirectangularTexture(t,o),e.set(o,c),o.addEventListener("dispose",r),n(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class q2 extends qB{constructor(e=-1,n=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+n,l=r-n;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const Jh=4,dL=[.125,.215,.35,.446,.526,.582],tu=20,cw=new q2,pL=new Ge;let uw=null,hw=0,dw=0,pw=!1;const Jc=(1+Math.sqrt(5))/2,Eh=1/Jc,fL=[new N(-Jc,Eh,0),new N(Jc,Eh,0),new N(-Eh,0,Jc),new N(Eh,0,Jc),new N(0,Jc,-Eh),new N(0,Jc,Eh),new N(-1,1,-1),new N(1,1,-1),new N(-1,1,1),new N(1,1,1)];class YR{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,i=.1,r=100){uw=this._renderer.getRenderTarget(),hw=this._renderer.getActiveCubeFace(),dw=this._renderer.getActiveMipmapLevel(),pw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),n>0&&this._blur(s,0,0,n),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=vL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=gL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(uw,hw,dw),this._renderer.xr.enabled=pw,e.scissorTest=!1,Bv(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Ld||e.mapping===Dd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),uw=this._renderer.getRenderTarget(),hw=this._renderer.getActiveCubeFace(),dw=this._renderer.getActiveMipmapLevel(),pw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=n||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,i={magFilter:ds,minFilter:ds,generateMipmaps:!1,type:L0,format:Bs,colorSpace:qi,depthBuffer:!1},r=mL(e,n,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=mL(e,n,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=jee(s)),this._blurMaterial=Wee(s,e,n)}return r}_compileMaterial(e){const n=new gn(this._lodPlanes[0],e);this._renderer.compile(n,cw)}_sceneToCubeUV(e,n,i,r){const a=new cr(90,1,n,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(pL),u.toneMapping=Kl,u.autoClear=!1;const p=new Dl({name:"PMREM.Background",side:Tr,depthWrite:!1,depthTest:!1}),f=new gn(new cp,p);let v=!1;const g=e.background;g?g.isColor&&(p.color.copy(g),e.background=null,v=!0):(p.color.copy(pL),v=!0);for(let m=0;m<6;m++){const y=m%3;y===0?(a.up.set(0,l[m],0),a.lookAt(c[m],0,0)):y===1?(a.up.set(0,0,l[m]),a.lookAt(0,c[m],0)):(a.up.set(0,l[m],0),a.lookAt(0,0,c[m]));const S=this._cubeSize;Bv(r,y*S,m>2?S:0,S,S),u.setRenderTarget(r),v&&u.render(f,a),u.render(e,a)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=g}_textureToCubeUV(e,n){const i=this._renderer,r=e.mapping===Ld||e.mapping===Dd;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=vL()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=gL());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new gn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Bv(n,0,0,3*l,2*l),i.setRenderTarget(n),i.render(o,cw)}_applyPMREM(e){const n=this._renderer,i=n.autoClear;n.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=fL[(r-s-1)%fL.length];this._blur(e,s-1,s,o,a)}n.autoClear=i}_blur(e,n,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,n,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,n,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new gn(this._lodPlanes[r],c),d=c.uniforms,p=this._sizeLods[i]-1,f=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*tu-1),v=s/f,g=isFinite(s)?1+Math.floor(u*v):tu;g>tu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${tu}`);const m=[];let y=0;for(let E=0;E<tu;++E){const T=E/v,M=Math.exp(-T*T/2);m.push(M),E===0?y+=M:E<g&&(y+=2*M)}for(let E=0;E<m.length;E++)m[E]=m[E]/y;d.envMap.value=e.texture,d.samples.value=g,d.weights.value=m,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:S}=this;d.dTheta.value=f,d.mipInt.value=S-i;const x=this._sizeLods[r],w=3*x*(r>S-Jh?r-S+Jh:0),C=4*(this._cubeSize-x);Bv(n,w,C,3*x,2*x),l.setRenderTarget(n),l.render(h,cw)}}function jee(t){const e=[],n=[],i=[];let r=t;const s=t-Jh+1+dL.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);n.push(a);let l=1/a;o>t-Jh?l=dL[o-t+Jh-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,v=3,g=2,m=1,y=new Float32Array(v*f*p),S=new Float32Array(g*f*p),x=new Float32Array(m*f*p);for(let C=0;C<p;C++){const E=C%3*2/3-1,T=C>2?0:-1,M=[E,T,0,E+2/3,T,0,E+2/3,T+1,0,E,T,0,E+2/3,T+1,0,E,T+1,0];y.set(M,v*f*C),S.set(d,g*f*C);const _=[C,C,C,C,C,C];x.set(_,m*f*C)}const w=new ys;w.setAttribute("position",new br(y,v)),w.setAttribute("uv",new br(S,g)),w.setAttribute("faceIndex",new br(x,m)),e.push(w),r>Jh&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}function mL(t,e,n){const i=new Mu(t,e,n);return i.texture.mapping=Gx,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Bv(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Wee(t,e,n){const i=new Float32Array(tu),r=new N(0,1,0);return new rc({name:"SphericalGaussianBlur",defines:{n:tu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:X2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Xl,depthTest:!1,depthWrite:!1})}function gL(){return new rc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:X2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Xl,depthTest:!1,depthWrite:!1})}function vL(){return new rc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:X2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Xl,depthTest:!1,depthWrite:!1})}function X2(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Gee(t){let e=new WeakMap,n=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===w1||l===CR,u=l===Ld||l===Dd;if(c||u){let h=e.get(a);const d=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return n===null&&(n=new YR(t)),h=c?n.fromEquirectangular(a,h):n.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const p=a.image;return c&&p&&p.height>0||u&&p&&r(p)?(n===null&&(n=new YR(t)),h=c?n.fromEquirectangular(a):n.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:i,dispose:o}}function qee(t){const e={};function n(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(i)}return e[i]=r,r}return{has:function(i){return n(i)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(i){const r=n(i);return r===null&&Fy("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function Xee(t,e,n,i){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const f in d.attributes)e.remove(d.attributes[f]);for(const f in d.morphAttributes){const v=d.morphAttributes[f];for(let g=0,m=v.length;g<m;g++)e.remove(v[g])}d.removeEventListener("dispose",o),delete r[d.id];const p=s.get(d);p&&(e.remove(p),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,n.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,n.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)e.update(d[f],t.ARRAY_BUFFER);const p=h.morphAttributes;for(const f in p){const v=p[f];for(let g=0,m=v.length;g<m;g++)e.update(v[g],t.ARRAY_BUFFER)}}function c(h){const d=[],p=h.index,f=h.attributes.position;let v=0;if(p!==null){const y=p.array;v=p.version;for(let S=0,x=y.length;S<x;S+=3){const w=y[S+0],C=y[S+1],E=y[S+2];d.push(w,C,C,E,E,w)}}else if(f!==void 0){const y=f.array;v=f.version;for(let S=0,x=y.length/3-1;S<x;S+=3){const w=S+0,C=S+1,E=S+2;d.push(w,C,C,E,E,w)}}else return;const g=new($B(d)?WB:W2)(d,1);g.version=v;const m=s.get(h);m&&e.remove(m),s.set(h,g)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function Kee(t,e,n){let i;function r(d){i=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function l(d,p){t.drawElements(i,p,s,d*o),n.update(p,i,1)}function c(d,p,f){f!==0&&(t.drawElementsInstanced(i,p,s,d*o,f),n.update(p,i,f))}function u(d,p,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,p,0,s,d,0,f);let g=0;for(let m=0;m<f;m++)g+=p[m];n.update(g,i,1)}function h(d,p,f,v){if(f===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let m=0;m<d.length;m++)c(d[m]/o,p[m],v[m]);else{g.multiDrawElementsInstancedWEBGL(i,p,0,s,d,0,v,0,f);let m=0;for(let y=0;y<f;y++)m+=p[y];for(let y=0;y<v.length;y++)n.update(m,i,v[y])}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function Yee(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(n.calls++,o){case t.TRIANGLES:n.triangles+=a*(s/3);break;case t.LINES:n.lines+=a*(s/2);break;case t.LINE_STRIP:n.lines+=a*(s-1);break;case t.LINE_LOOP:n.lines+=a*s;break;case t.POINTS:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:r,update:i}}function Jee(t,e,n){const i=new WeakMap,r=new Wt;function s(o,a,l){const c=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let d=i.get(a);if(d===void 0||d.count!==h){let _=function(){T.dispose(),i.delete(a),a.removeEventListener("dispose",_)};var p=_;d!==void 0&&d.texture.dispose();const f=a.morphAttributes.position!==void 0,v=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,m=a.morphAttributes.position||[],y=a.morphAttributes.normal||[],S=a.morphAttributes.color||[];let x=0;f===!0&&(x=1),v===!0&&(x=2),g===!0&&(x=3);let w=a.attributes.position.count*x,C=1;w>e.maxTextureSize&&(C=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const E=new Float32Array(w*C*4*h),T=new VB(E,w,C,h);T.type=Ro,T.needsUpdate=!0;const M=x*4;for(let R=0;R<h;R++){const L=m[R],z=y[R],G=S[R],$=w*C*4*R;for(let H=0;H<L.count;H++){const q=H*M;f===!0&&(r.fromBufferAttribute(L,H),E[$+q+0]=r.x,E[$+q+1]=r.y,E[$+q+2]=r.z,E[$+q+3]=0),v===!0&&(r.fromBufferAttribute(z,H),E[$+q+4]=r.x,E[$+q+5]=r.y,E[$+q+6]=r.z,E[$+q+7]=0),g===!0&&(r.fromBufferAttribute(G,H),E[$+q+8]=r.x,E[$+q+9]=r.y,E[$+q+10]=r.z,E[$+q+11]=G.itemSize===4?r.w:1)}}d={count:h,texture:T,size:new mt(w,C)},i.set(a,d),a.addEventListener("dispose",_)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(t,"morphTexture",o.morphTexture,n);else{let f=0;for(let g=0;g<c.length;g++)f+=c[g];const v=a.morphTargetsRelative?1:1-f;l.getUniforms().setValue(t,"morphTargetBaseInfluence",v),l.getUniforms().setValue(t,"morphTargetInfluences",c)}l.getUniforms().setValue(t,"morphTargetsTexture",d.texture,n),l.getUniforms().setValue(t,"morphTargetsTextureSize",d.size)}return{update:s}}function Qee(t,e,n,i){let r=new WeakMap;function s(l){const c=i.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(n.update(l.instanceMatrix,t.ARRAY_BUFFER),l.instanceColor!==null&&n.update(l.instanceColor,t.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),n.remove(c.instanceMatrix),c.instanceColor!==null&&n.remove(c.instanceColor)}return{update:s,dispose:o}}class YB extends wi{constructor(e,n,i,r,s,o,a,l,c,u=ud){if(u!==ud&&u!==Od)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===ud&&(i=Iu),i===void 0&&u===Od&&(i=Nd),super(null,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=a!==void 0?a:Er,this.minFilter=l!==void 0?l:Er,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}const JB=new wi,yL=new YB(1,1),QB=new VB,ZB=new zJ,e5=new XB,SL=[],xL=[],CL=new Float32Array(16),_L=new Float32Array(9),wL=new Float32Array(4);function up(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=SL[r];if(s===void 0&&(s=new Float32Array(r),SL[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function Ei(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Ri(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Yx(t,e){let n=xL[e];n===void 0&&(n=new Int32Array(e),xL[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Zee(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function ete(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ei(n,e))return;t.uniform2fv(this.addr,e),Ri(n,e)}}function tte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ei(n,e))return;t.uniform3fv(this.addr,e),Ri(n,e)}}function nte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ei(n,e))return;t.uniform4fv(this.addr,e),Ri(n,e)}}function ite(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ei(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ri(n,e)}else{if(Ei(n,i))return;wL.set(i),t.uniformMatrix2fv(this.addr,!1,wL),Ri(n,i)}}function rte(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ei(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ri(n,e)}else{if(Ei(n,i))return;_L.set(i),t.uniformMatrix3fv(this.addr,!1,_L),Ri(n,i)}}function ste(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ei(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ri(n,e)}else{if(Ei(n,i))return;CL.set(i),t.uniformMatrix4fv(this.addr,!1,CL),Ri(n,i)}}function ote(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function ate(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ei(n,e))return;t.uniform2iv(this.addr,e),Ri(n,e)}}function lte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ei(n,e))return;t.uniform3iv(this.addr,e),Ri(n,e)}}function cte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ei(n,e))return;t.uniform4iv(this.addr,e),Ri(n,e)}}function ute(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function hte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ei(n,e))return;t.uniform2uiv(this.addr,e),Ri(n,e)}}function dte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ei(n,e))return;t.uniform3uiv(this.addr,e),Ri(n,e)}}function pte(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ei(n,e))return;t.uniform4uiv(this.addr,e),Ri(n,e)}}function fte(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);let s;this.type===t.SAMPLER_2D_SHADOW?(yL.compareFunction=BB,s=yL):s=JB,n.setTexture2D(e||s,r)}function mte(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||ZB,r)}function gte(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||e5,r)}function vte(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||QB,r)}function yte(t){switch(t){case 5126:return Zee;case 35664:return ete;case 35665:return tte;case 35666:return nte;case 35674:return ite;case 35675:return rte;case 35676:return ste;case 5124:case 35670:return ote;case 35667:case 35671:return ate;case 35668:case 35672:return lte;case 35669:case 35673:return cte;case 5125:return ute;case 36294:return hte;case 36295:return dte;case 36296:return pte;case 35678:case 36198:case 36298:case 36306:case 35682:return fte;case 35679:case 36299:case 36307:return mte;case 35680:case 36300:case 36308:case 36293:return gte;case 36289:case 36303:case 36311:case 36292:return vte}}function Ste(t,e){t.uniform1fv(this.addr,e)}function xte(t,e){const n=up(e,this.size,2);t.uniform2fv(this.addr,n)}function Cte(t,e){const n=up(e,this.size,3);t.uniform3fv(this.addr,n)}function _te(t,e){const n=up(e,this.size,4);t.uniform4fv(this.addr,n)}function wte(t,e){const n=up(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Ete(t,e){const n=up(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Rte(t,e){const n=up(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Tte(t,e){t.uniform1iv(this.addr,e)}function bte(t,e){t.uniform2iv(this.addr,e)}function Ate(t,e){t.uniform3iv(this.addr,e)}function Pte(t,e){t.uniform4iv(this.addr,e)}function Ite(t,e){t.uniform1uiv(this.addr,e)}function Mte(t,e){t.uniform2uiv(this.addr,e)}function kte(t,e){t.uniform3uiv(this.addr,e)}function Lte(t,e){t.uniform4uiv(this.addr,e)}function Dte(t,e,n){const i=this.cache,r=e.length,s=Yx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTexture2D(e[o]||JB,s[o])}function Nte(t,e,n){const i=this.cache,r=e.length,s=Yx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTexture3D(e[o]||ZB,s[o])}function Ote(t,e,n){const i=this.cache,r=e.length,s=Yx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTextureCube(e[o]||e5,s[o])}function Fte(t,e,n){const i=this.cache,r=e.length,s=Yx(n,r);Ei(i,s)||(t.uniform1iv(this.addr,s),Ri(i,s));for(let o=0;o!==r;++o)n.setTexture2DArray(e[o]||QB,s[o])}function zte(t){switch(t){case 5126:return Ste;case 35664:return xte;case 35665:return Cte;case 35666:return _te;case 35674:return wte;case 35675:return Ete;case 35676:return Rte;case 5124:case 35670:return Tte;case 35667:case 35671:return bte;case 35668:case 35672:return Ate;case 35669:case 35673:return Pte;case 5125:return Ite;case 36294:return Mte;case 36295:return kte;case 36296:return Lte;case 35678:case 36198:case 36298:case 36306:case 35682:return Dte;case 35679:case 36299:case 36307:return Nte;case 35680:case 36300:case 36308:case 36293:return Ote;case 36289:case 36303:case 36311:case 36292:return Fte}}class Ute{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.setValue=yte(n.type)}}class Bte{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=zte(n.type)}}class $te{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,n[a.id],i)}}}const fw=/(\w+)(\])?(\[|\.)?/g;function EL(t,e){t.seq.push(e),t.map[e.id]=e}function Hte(t,e,n){const i=t.name,r=i.length;for(fw.lastIndex=0;;){const s=fw.exec(i),o=fw.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){EL(n,c===void 0?new Ute(a,t,e):new Bte(a,t,e));break}else{let h=n.map[a];h===void 0&&(h=new $te(a),EL(n,h)),n=h}}}class zy{constructor(e,n){this.seq=[],this.map={};const i=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(n,r),o=e.getUniformLocation(n,s.name);Hte(s,o,this)}}setValue(e,n,i,r){const s=this.map[n];s!==void 0&&s.setValue(e,i,r)}setOptional(e,n,i){const r=n[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,n,i,r){for(let s=0,o=n.length;s!==o;++s){const a=n[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,n){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in n&&i.push(o)}return i}}function RL(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}const Vte=37297;let jte=0;function Wte(t,e){const n=t.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${n[o]}`)}return i.join(`
`)}function Gte(t){const e=Pt.getPrimaries(Pt.workingColorSpace),n=Pt.getPrimaries(t);let i;switch(e===n?i="":e===A1&&n===b1?i="LinearDisplayP3ToLinearSRGB":e===b1&&n===A1&&(i="LinearSRGBToLinearDisplayP3"),t){case qi:case Xx:return[i,"LinearTransferOETF"];case on:case H2:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[i,"LinearTransferOETF"]}}function TL(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+r+`

`+Wte(t.getShaderSource(e),o)}else return r}function qte(t,e){const n=Gte(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function Xte(t,e){let n;switch(e){case GY:n="Linear";break;case qY:n="Reinhard";break;case XY:n="Cineon";break;case TB:n="ACESFilmic";break;case YY:n="AgX";break;case JY:n="Neutral";break;case KY:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const $v=new N;function Kte(){Pt.getLuminanceCoefficients($v);const t=$v.x.toFixed(4),e=$v.y.toFixed(4),n=$v.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Yte(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(eg).join(`
`)}function Jte(t){const e=[];for(const n in t){const i=t[n];i!==!1&&e.push("#define "+n+" "+i)}return e.join(`
`)}function Qte(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=t.getActiveAttrib(e,r),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),n[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}function eg(t){return t!==""}function bL(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function AL(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Zte=/^[ \t]*#include +<([\w\d./]+)>/gm;function JR(t){return t.replace(Zte,tne)}const ene=new Map;function tne(t,e){let n=At[e];if(n===void 0){const i=ene.get(e);if(i!==void 0)n=At[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return JR(n)}const nne=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function PL(t){return t.replace(nne,ine)}function ine(t,e,n,i){let r="";for(let s=parseInt(e);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function IL(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function rne(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===RB?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===RY?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Aa&&(e="SHADOWMAP_TYPE_VSM"),e}function sne(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Ld:case Dd:e="ENVMAP_TYPE_CUBE";break;case Gx:e="ENVMAP_TYPE_CUBE_UV";break}return e}function one(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Dd:e="ENVMAP_MODE_REFRACTION";break}return e}function ane(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Wx:e="ENVMAP_BLENDING_MULTIPLY";break;case jY:e="ENVMAP_BLENDING_MIX";break;case WY:e="ENVMAP_BLENDING_ADD";break}return e}function lne(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:i,maxMip:n}}function cne(t,e,n,i){const r=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=rne(n),c=sne(n),u=one(n),h=ane(n),d=lne(n),p=Yte(n),f=Jte(s),v=r.createProgram();let g,m,y=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(eg).join(`
`),g.length>0&&(g+=`
`),m=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(eg).join(`
`),m.length>0&&(m+=`
`)):(g=[IL(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(eg).join(`
`),m=[IL(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Kl?"#define TONE_MAPPING":"",n.toneMapping!==Kl?At.tonemapping_pars_fragment:"",n.toneMapping!==Kl?Xte("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",At.colorspace_pars_fragment,qte("linearToOutputTexel",n.outputColorSpace),Kte(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(eg).join(`
`)),o=JR(o),o=bL(o,n),o=AL(o,n),a=JR(a),a=bL(a,n),a=AL(a,n),o=PL(o),a=PL(a),n.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,m=["#define varying in",n.glslVersion===qk?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===qk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const S=y+g+o,x=y+m+a,w=RL(r,r.VERTEX_SHADER,S),C=RL(r,r.FRAGMENT_SHADER,x);r.attachShader(v,w),r.attachShader(v,C),n.index0AttributeName!==void 0?r.bindAttribLocation(v,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v);function E(R){if(t.debug.checkShaderErrors){const L=r.getProgramInfoLog(v).trim(),z=r.getShaderInfoLog(w).trim(),G=r.getShaderInfoLog(C).trim();let $=!0,H=!0;if(r.getProgramParameter(v,r.LINK_STATUS)===!1)if($=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(r,v,w,C);else{const q=TL(r,w,"vertex"),D=TL(r,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+L+`
`+q+`
`+D)}else L!==""?console.warn("THREE.WebGLProgram: Program Info Log:",L):(z===""||G==="")&&(H=!1);H&&(R.diagnostics={runnable:$,programLog:L,vertexShader:{log:z,prefix:g},fragmentShader:{log:G,prefix:m}})}r.deleteShader(w),r.deleteShader(C),T=new zy(r,v),M=Qte(r,v)}let T;this.getUniforms=function(){return T===void 0&&E(this),T};let M;this.getAttributes=function(){return M===void 0&&E(this),M};let _=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return _===!1&&(_=r.getProgramParameter(v,Vte)),_},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=jte++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=C,this}let une=0;class hne{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(n),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const i of n)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let i=n.get(e);return i===void 0&&(i=new Set,n.set(e,i)),i}_getShaderStage(e){const n=this.shaderCache;let i=n.get(e);return i===void 0&&(i=new dne(e),n.set(e,i)),i}}class dne{constructor(e){this.id=une++,this.code=e,this.usedTimes=0}}function pne(t,e,n,i,r,s,o){const a=new j2,l=new hne,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.reverseDepthBuffer,p=r.vertexTextures;let f=r.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(_){return c.add(_),_===0?"uv":`uv${_}`}function m(_,R,L,z,G){const $=z.fog,H=G.geometry,q=_.isMeshStandardMaterial?z.environment:null,D=(_.isMeshStandardMaterial?n:e).get(_.envMap||q),Z=D&&D.mapping===Gx?D.image.height:null,P=v[_.type];_.precision!==null&&(f=r.getMaxPrecision(_.precision),f!==_.precision&&console.warn("THREE.WebGLProgram.getParameters:",_.precision,"not supported, using",f,"instead."));const le=H.morphAttributes.position||H.morphAttributes.normal||H.morphAttributes.color,Se=le!==void 0?le.length:0;let k=0;H.morphAttributes.position!==void 0&&(k=1),H.morphAttributes.normal!==void 0&&(k=2),H.morphAttributes.color!==void 0&&(k=3);let J,oe,pe,ye;if(P){const Ti=Yo[P];J=Ti.vertexShader,oe=Ti.fragmentShader}else J=_.vertexShader,oe=_.fragmentShader,l.update(_),pe=l.getVertexShaderID(_),ye=l.getFragmentShaderID(_);const nt=t.getRenderTarget(),Je=G.isInstancedMesh===!0,_t=G.isBatchedMesh===!0,at=!!_.map,yt=!!_.matcap,U=!!D,di=!!_.aoMap,St=!!_.lightMap,Mt=!!_.bumpMap,ct=!!_.normalMap,Zt=!!_.displacementMap,dt=!!_.emissiveMap,I=!!_.metalnessMap,b=!!_.roughnessMap,Y=_.anisotropy>0,ie=_.clearcoat>0,de=_.dispersion>0,ae=_.iridescence>0,V=_.sheen>0,K=_.transmission>0,re=Y&&!!_.anisotropyMap,Ie=ie&&!!_.clearcoatMap,se=ie&&!!_.clearcoatNormalMap,xe=ie&&!!_.clearcoatRoughnessMap,Te=ae&&!!_.iridescenceMap,Qe=ae&&!!_.iridescenceThicknessMap,Ae=V&&!!_.sheenColorMap,wt=V&&!!_.sheenRoughnessMap,Ze=!!_.specularMap,Dt=!!_.specularColorMap,B=!!_.specularIntensityMap,ke=K&&!!_.transmissionMap,ne=K&&!!_.thicknessMap,ce=!!_.gradientMap,Me=!!_.alphaMap,Le=_.alphaTest>0,Ft=!!_.alphaHash,bn=!!_.extensions;let Qn=Kl;_.toneMapped&&(nt===null||nt.isXRRenderTarget===!0)&&(Qn=t.toneMapping);const Nt={shaderID:P,shaderType:_.type,shaderName:_.name,vertexShader:J,fragmentShader:oe,defines:_.defines,customVertexShaderID:pe,customFragmentShaderID:ye,isRawShaderMaterial:_.isRawShaderMaterial===!0,glslVersion:_.glslVersion,precision:f,batching:_t,batchingColor:_t&&G._colorsTexture!==null,instancing:Je,instancingColor:Je&&G.instanceColor!==null,instancingMorph:Je&&G.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:nt===null?t.outputColorSpace:nt.isXRRenderTarget===!0?nt.texture.colorSpace:qi,alphaToCoverage:!!_.alphaToCoverage,map:at,matcap:yt,envMap:U,envMapMode:U&&D.mapping,envMapCubeUVHeight:Z,aoMap:di,lightMap:St,bumpMap:Mt,normalMap:ct,displacementMap:p&&Zt,emissiveMap:dt,normalMapObjectSpace:ct&&_.normalMapType===sJ,normalMapTangentSpace:ct&&_.normalMapType===qx,metalnessMap:I,roughnessMap:b,anisotropy:Y,anisotropyMap:re,clearcoat:ie,clearcoatMap:Ie,clearcoatNormalMap:se,clearcoatRoughnessMap:xe,dispersion:de,iridescence:ae,iridescenceMap:Te,iridescenceThicknessMap:Qe,sheen:V,sheenColorMap:Ae,sheenRoughnessMap:wt,specularMap:Ze,specularColorMap:Dt,specularIntensityMap:B,transmission:K,transmissionMap:ke,thicknessMap:ne,gradientMap:ce,opaque:_.transparent===!1&&_.blending===cd&&_.alphaToCoverage===!1,alphaMap:Me,alphaTest:Le,alphaHash:Ft,combine:_.combine,mapUv:at&&g(_.map.channel),aoMapUv:di&&g(_.aoMap.channel),lightMapUv:St&&g(_.lightMap.channel),bumpMapUv:Mt&&g(_.bumpMap.channel),normalMapUv:ct&&g(_.normalMap.channel),displacementMapUv:Zt&&g(_.displacementMap.channel),emissiveMapUv:dt&&g(_.emissiveMap.channel),metalnessMapUv:I&&g(_.metalnessMap.channel),roughnessMapUv:b&&g(_.roughnessMap.channel),anisotropyMapUv:re&&g(_.anisotropyMap.channel),clearcoatMapUv:Ie&&g(_.clearcoatMap.channel),clearcoatNormalMapUv:se&&g(_.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:xe&&g(_.clearcoatRoughnessMap.channel),iridescenceMapUv:Te&&g(_.iridescenceMap.channel),iridescenceThicknessMapUv:Qe&&g(_.iridescenceThicknessMap.channel),sheenColorMapUv:Ae&&g(_.sheenColorMap.channel),sheenRoughnessMapUv:wt&&g(_.sheenRoughnessMap.channel),specularMapUv:Ze&&g(_.specularMap.channel),specularColorMapUv:Dt&&g(_.specularColorMap.channel),specularIntensityMapUv:B&&g(_.specularIntensityMap.channel),transmissionMapUv:ke&&g(_.transmissionMap.channel),thicknessMapUv:ne&&g(_.thicknessMap.channel),alphaMapUv:Me&&g(_.alphaMap.channel),vertexTangents:!!H.attributes.tangent&&(ct||Y),vertexColors:_.vertexColors,vertexAlphas:_.vertexColors===!0&&!!H.attributes.color&&H.attributes.color.itemSize===4,pointsUvs:G.isPoints===!0&&!!H.attributes.uv&&(at||Me),fog:!!$,useFog:_.fog===!0,fogExp2:!!$&&$.isFogExp2,flatShading:_.flatShading===!0,sizeAttenuation:_.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:d,skinning:G.isSkinnedMesh===!0,morphTargets:H.morphAttributes.position!==void 0,morphNormals:H.morphAttributes.normal!==void 0,morphColors:H.morphAttributes.color!==void 0,morphTargetsCount:Se,morphTextureStride:k,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:_.dithering,shadowMapEnabled:t.shadowMap.enabled&&L.length>0,shadowMapType:t.shadowMap.type,toneMapping:Qn,decodeVideoTexture:at&&_.map.isVideoTexture===!0&&Pt.getTransfer(_.map.colorSpace)===Pn,premultipliedAlpha:_.premultipliedAlpha,doubleSided:_.side===Zo,flipSided:_.side===Tr,useDepthPacking:_.depthPacking>=0,depthPacking:_.depthPacking||0,index0AttributeName:_.index0AttributeName,extensionClipCullDistance:bn&&_.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(bn&&_.extensions.multiDraw===!0||_t)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:_.customProgramCacheKey()};return Nt.vertexUv1s=c.has(1),Nt.vertexUv2s=c.has(2),Nt.vertexUv3s=c.has(3),c.clear(),Nt}function y(_){const R=[];if(_.shaderID?R.push(_.shaderID):(R.push(_.customVertexShaderID),R.push(_.customFragmentShaderID)),_.defines!==void 0)for(const L in _.defines)R.push(L),R.push(_.defines[L]);return _.isRawShaderMaterial===!1&&(S(R,_),x(R,_),R.push(t.outputColorSpace)),R.push(_.customProgramCacheKey),R.join()}function S(_,R){_.push(R.precision),_.push(R.outputColorSpace),_.push(R.envMapMode),_.push(R.envMapCubeUVHeight),_.push(R.mapUv),_.push(R.alphaMapUv),_.push(R.lightMapUv),_.push(R.aoMapUv),_.push(R.bumpMapUv),_.push(R.normalMapUv),_.push(R.displacementMapUv),_.push(R.emissiveMapUv),_.push(R.metalnessMapUv),_.push(R.roughnessMapUv),_.push(R.anisotropyMapUv),_.push(R.clearcoatMapUv),_.push(R.clearcoatNormalMapUv),_.push(R.clearcoatRoughnessMapUv),_.push(R.iridescenceMapUv),_.push(R.iridescenceThicknessMapUv),_.push(R.sheenColorMapUv),_.push(R.sheenRoughnessMapUv),_.push(R.specularMapUv),_.push(R.specularColorMapUv),_.push(R.specularIntensityMapUv),_.push(R.transmissionMapUv),_.push(R.thicknessMapUv),_.push(R.combine),_.push(R.fogExp2),_.push(R.sizeAttenuation),_.push(R.morphTargetsCount),_.push(R.morphAttributeCount),_.push(R.numDirLights),_.push(R.numPointLights),_.push(R.numSpotLights),_.push(R.numSpotLightMaps),_.push(R.numHemiLights),_.push(R.numRectAreaLights),_.push(R.numDirLightShadows),_.push(R.numPointLightShadows),_.push(R.numSpotLightShadows),_.push(R.numSpotLightShadowsWithMaps),_.push(R.numLightProbes),_.push(R.shadowMapType),_.push(R.toneMapping),_.push(R.numClippingPlanes),_.push(R.numClipIntersection),_.push(R.depthPacking)}function x(_,R){a.disableAll(),R.supportsVertexTextures&&a.enable(0),R.instancing&&a.enable(1),R.instancingColor&&a.enable(2),R.instancingMorph&&a.enable(3),R.matcap&&a.enable(4),R.envMap&&a.enable(5),R.normalMapObjectSpace&&a.enable(6),R.normalMapTangentSpace&&a.enable(7),R.clearcoat&&a.enable(8),R.iridescence&&a.enable(9),R.alphaTest&&a.enable(10),R.vertexColors&&a.enable(11),R.vertexAlphas&&a.enable(12),R.vertexUv1s&&a.enable(13),R.vertexUv2s&&a.enable(14),R.vertexUv3s&&a.enable(15),R.vertexTangents&&a.enable(16),R.anisotropy&&a.enable(17),R.alphaHash&&a.enable(18),R.batching&&a.enable(19),R.dispersion&&a.enable(20),R.batchingColor&&a.enable(21),_.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.reverseDepthBuffer&&a.enable(4),R.skinning&&a.enable(5),R.morphTargets&&a.enable(6),R.morphNormals&&a.enable(7),R.morphColors&&a.enable(8),R.premultipliedAlpha&&a.enable(9),R.shadowMapEnabled&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),R.decodeVideoTexture&&a.enable(19),R.alphaToCoverage&&a.enable(20),_.push(a.mask)}function w(_){const R=v[_.type];let L;if(R){const z=Yo[R];L=YJ.clone(z.uniforms)}else L=_.uniforms;return L}function C(_,R){let L;for(let z=0,G=u.length;z<G;z++){const $=u[z];if($.cacheKey===R){L=$,++L.usedTimes;break}}return L===void 0&&(L=new cne(t,R,_,s),u.push(L)),L}function E(_){if(--_.usedTimes===0){const R=u.indexOf(_);u[R]=u[u.length-1],u.pop(),_.destroy()}}function T(_){l.remove(_)}function M(){l.dispose()}return{getParameters:m,getProgramCacheKey:y,getUniforms:w,acquireProgram:C,releaseProgram:E,releaseShaderCache:T,programs:u,dispose:M}}function fne(){let t=new WeakMap;function e(o){return t.has(o)}function n(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function i(o){t.delete(o)}function r(o,a,l){t.get(o)[a]=l}function s(){t=new WeakMap}return{has:e,get:n,remove:i,update:r,dispose:s}}function mne(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ML(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function kL(){const t=[];let e=0;const n=[],i=[],r=[];function s(){e=0,n.length=0,i.length=0,r.length=0}function o(h,d,p,f,v,g){let m=t[e];return m===void 0?(m={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:v,group:g},t[e]=m):(m.id=h.id,m.object=h,m.geometry=d,m.material=p,m.groupOrder=f,m.renderOrder=h.renderOrder,m.z=v,m.group=g),e++,m}function a(h,d,p,f,v,g){const m=o(h,d,p,f,v,g);p.transmission>0?i.push(m):p.transparent===!0?r.push(m):n.push(m)}function l(h,d,p,f,v,g){const m=o(h,d,p,f,v,g);p.transmission>0?i.unshift(m):p.transparent===!0?r.unshift(m):n.unshift(m)}function c(h,d){n.length>1&&n.sort(h||mne),i.length>1&&i.sort(d||ML),r.length>1&&r.sort(d||ML)}function u(){for(let h=e,d=t.length;h<d;h++){const p=t[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:n,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function gne(){let t=new WeakMap;function e(i,r){const s=t.get(i);let o;return s===void 0?(o=new kL,t.set(i,[o])):r>=s.length?(o=new kL,s.push(o)):o=s[r],o}function n(){t=new WeakMap}return{get:e,dispose:n}}function vne(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new N,color:new Ge};break;case"SpotLight":n={position:new N,direction:new N,color:new Ge,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new N,color:new Ge,distance:0,decay:0};break;case"HemisphereLight":n={direction:new N,skyColor:new Ge,groundColor:new Ge};break;case"RectAreaLight":n={color:new Ge,position:new N,halfWidth:new N,halfHeight:new N};break}return t[e.id]=n,n}}}function yne(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let Sne=0;function xne(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Cne(t){const e=new vne,n=yne(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new N);const r=new N,s=new je,o=new je;function a(c){let u=0,h=0,d=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let p=0,f=0,v=0,g=0,m=0,y=0,S=0,x=0,w=0,C=0,E=0;c.sort(xne);for(let M=0,_=c.length;M<_;M++){const R=c[M],L=R.color,z=R.intensity,G=R.distance,$=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)u+=L.r*z,h+=L.g*z,d+=L.b*z;else if(R.isLightProbe){for(let H=0;H<9;H++)i.probe[H].addScaledVector(R.sh.coefficients[H],z);E++}else if(R.isDirectionalLight){const H=e.get(R);if(H.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const q=R.shadow,D=n.get(R);D.shadowIntensity=q.intensity,D.shadowBias=q.bias,D.shadowNormalBias=q.normalBias,D.shadowRadius=q.radius,D.shadowMapSize=q.mapSize,i.directionalShadow[p]=D,i.directionalShadowMap[p]=$,i.directionalShadowMatrix[p]=R.shadow.matrix,y++}i.directional[p]=H,p++}else if(R.isSpotLight){const H=e.get(R);H.position.setFromMatrixPosition(R.matrixWorld),H.color.copy(L).multiplyScalar(z),H.distance=G,H.coneCos=Math.cos(R.angle),H.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),H.decay=R.decay,i.spot[v]=H;const q=R.shadow;if(R.map&&(i.spotLightMap[w]=R.map,w++,q.updateMatrices(R),R.castShadow&&C++),i.spotLightMatrix[v]=q.matrix,R.castShadow){const D=n.get(R);D.shadowIntensity=q.intensity,D.shadowBias=q.bias,D.shadowNormalBias=q.normalBias,D.shadowRadius=q.radius,D.shadowMapSize=q.mapSize,i.spotShadow[v]=D,i.spotShadowMap[v]=$,x++}v++}else if(R.isRectAreaLight){const H=e.get(R);H.color.copy(L).multiplyScalar(z),H.halfWidth.set(R.width*.5,0,0),H.halfHeight.set(0,R.height*.5,0),i.rectArea[g]=H,g++}else if(R.isPointLight){const H=e.get(R);if(H.color.copy(R.color).multiplyScalar(R.intensity),H.distance=R.distance,H.decay=R.decay,R.castShadow){const q=R.shadow,D=n.get(R);D.shadowIntensity=q.intensity,D.shadowBias=q.bias,D.shadowNormalBias=q.normalBias,D.shadowRadius=q.radius,D.shadowMapSize=q.mapSize,D.shadowCameraNear=q.camera.near,D.shadowCameraFar=q.camera.far,i.pointShadow[f]=D,i.pointShadowMap[f]=$,i.pointShadowMatrix[f]=R.shadow.matrix,S++}i.point[f]=H,f++}else if(R.isHemisphereLight){const H=e.get(R);H.skyColor.copy(R.color).multiplyScalar(z),H.groundColor.copy(R.groundColor).multiplyScalar(z),i.hemi[m]=H,m++}}g>0&&(t.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=be.LTC_FLOAT_1,i.rectAreaLTC2=be.LTC_FLOAT_2):(i.rectAreaLTC1=be.LTC_HALF_1,i.rectAreaLTC2=be.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=h,i.ambient[2]=d;const T=i.hash;(T.directionalLength!==p||T.pointLength!==f||T.spotLength!==v||T.rectAreaLength!==g||T.hemiLength!==m||T.numDirectionalShadows!==y||T.numPointShadows!==S||T.numSpotShadows!==x||T.numSpotMaps!==w||T.numLightProbes!==E)&&(i.directional.length=p,i.spot.length=v,i.rectArea.length=g,i.point.length=f,i.hemi.length=m,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=S,i.pointShadowMap.length=S,i.spotShadow.length=x,i.spotShadowMap.length=x,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=S,i.spotLightMatrix.length=x+w-C,i.spotLightMap.length=w,i.numSpotLightShadowsWithMaps=C,i.numLightProbes=E,T.directionalLength=p,T.pointLength=f,T.spotLength=v,T.rectAreaLength=g,T.hemiLength=m,T.numDirectionalShadows=y,T.numPointShadows=S,T.numSpotShadows=x,T.numSpotMaps=w,T.numLightProbes=E,i.version=Sne++)}function l(c,u){let h=0,d=0,p=0,f=0,v=0;const g=u.matrixWorldInverse;for(let m=0,y=c.length;m<y;m++){const S=c[m];if(S.isDirectionalLight){const x=i.directional[h];x.direction.setFromMatrixPosition(S.matrixWorld),r.setFromMatrixPosition(S.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),h++}else if(S.isSpotLight){const x=i.spot[p];x.position.setFromMatrixPosition(S.matrixWorld),x.position.applyMatrix4(g),x.direction.setFromMatrixPosition(S.matrixWorld),r.setFromMatrixPosition(S.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),p++}else if(S.isRectAreaLight){const x=i.rectArea[f];x.position.setFromMatrixPosition(S.matrixWorld),x.position.applyMatrix4(g),o.identity(),s.copy(S.matrixWorld),s.premultiply(g),o.extractRotation(s),x.halfWidth.set(S.width*.5,0,0),x.halfHeight.set(0,S.height*.5,0),x.halfWidth.applyMatrix4(o),x.halfHeight.applyMatrix4(o),f++}else if(S.isPointLight){const x=i.point[d];x.position.setFromMatrixPosition(S.matrixWorld),x.position.applyMatrix4(g),d++}else if(S.isHemisphereLight){const x=i.hemi[v];x.direction.setFromMatrixPosition(S.matrixWorld),x.direction.transformDirection(g),v++}}}return{setup:a,setupView:l,state:i}}function LL(t){const e=new Cne(t),n=[],i=[];function r(u){c.camera=u,n.length=0,i.length=0}function s(u){n.push(u)}function o(u){i.push(u)}function a(){e.setup(n)}function l(u){e.setupView(n,u)}const c={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function _ne(t){let e=new WeakMap;function n(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new LL(t),e.set(r,[a])):s>=o.length?(a=new LL(t),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:n,dispose:i}}class wne extends qs{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=iJ,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Ene extends qs{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Rne=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Tne=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function bne(t,e,n){let i=new G2;const r=new mt,s=new mt,o=new Wt,a=new wne({depthPacking:rJ}),l=new Ene,c={},u=n.maxTextureSize,h={[Ka]:Tr,[Tr]:Ka,[Zo]:Zo},d=new rc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mt},radius:{value:4}},vertexShader:Rne,fragmentShader:Tne}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new ys;f.setAttribute("position",new br(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new gn(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=RB;let m=this.type;this.render=function(C,E,T){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||C.length===0)return;const M=t.getRenderTarget(),_=t.getActiveCubeFace(),R=t.getActiveMipmapLevel(),L=t.state;L.setBlending(Xl),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);const z=m!==Aa&&this.type===Aa,G=m===Aa&&this.type!==Aa;for(let $=0,H=C.length;$<H;$++){const q=C[$],D=q.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",q,"has no shadow.");continue}if(D.autoUpdate===!1&&D.needsUpdate===!1)continue;r.copy(D.mapSize);const Z=D.getFrameExtents();if(r.multiply(Z),s.copy(D.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/Z.x),r.x=s.x*Z.x,D.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/Z.y),r.y=s.y*Z.y,D.mapSize.y=s.y)),D.map===null||z===!0||G===!0){const le=this.type!==Aa?{minFilter:Er,magFilter:Er}:{};D.map!==null&&D.map.dispose(),D.map=new Mu(r.x,r.y,le),D.map.texture.name=q.name+".shadowMap",D.camera.updateProjectionMatrix()}t.setRenderTarget(D.map),t.clear();const P=D.getViewportCount();for(let le=0;le<P;le++){const Se=D.getViewport(le);o.set(s.x*Se.x,s.y*Se.y,s.x*Se.z,s.y*Se.w),L.viewport(o),D.updateMatrices(q,le),i=D.getFrustum(),x(E,T,D.camera,q,this.type)}D.isPointLightShadow!==!0&&this.type===Aa&&y(D,T),D.needsUpdate=!1}m=this.type,g.needsUpdate=!1,t.setRenderTarget(M,_,R)};function y(C,E){const T=e.update(v);d.defines.VSM_SAMPLES!==C.blurSamples&&(d.defines.VSM_SAMPLES=C.blurSamples,p.defines.VSM_SAMPLES=C.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new Mu(r.x,r.y)),d.uniforms.shadow_pass.value=C.map.texture,d.uniforms.resolution.value=C.mapSize,d.uniforms.radius.value=C.radius,t.setRenderTarget(C.mapPass),t.clear(),t.renderBufferDirect(E,null,T,d,v,null),p.uniforms.shadow_pass.value=C.mapPass.texture,p.uniforms.resolution.value=C.mapSize,p.uniforms.radius.value=C.radius,t.setRenderTarget(C.map),t.clear(),t.renderBufferDirect(E,null,T,p,v,null)}function S(C,E,T,M){let _=null;const R=T.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(R!==void 0)_=R;else if(_=T.isPointLight===!0?l:a,t.localClippingEnabled&&E.clipShadows===!0&&Array.isArray(E.clippingPlanes)&&E.clippingPlanes.length!==0||E.displacementMap&&E.displacementScale!==0||E.alphaMap&&E.alphaTest>0||E.map&&E.alphaTest>0){const L=_.uuid,z=E.uuid;let G=c[L];G===void 0&&(G={},c[L]=G);let $=G[z];$===void 0&&($=_.clone(),G[z]=$,E.addEventListener("dispose",w)),_=$}if(_.visible=E.visible,_.wireframe=E.wireframe,M===Aa?_.side=E.shadowSide!==null?E.shadowSide:E.side:_.side=E.shadowSide!==null?E.shadowSide:h[E.side],_.alphaMap=E.alphaMap,_.alphaTest=E.alphaTest,_.map=E.map,_.clipShadows=E.clipShadows,_.clippingPlanes=E.clippingPlanes,_.clipIntersection=E.clipIntersection,_.displacementMap=E.displacementMap,_.displacementScale=E.displacementScale,_.displacementBias=E.displacementBias,_.wireframeLinewidth=E.wireframeLinewidth,_.linewidth=E.linewidth,T.isPointLight===!0&&_.isMeshDistanceMaterial===!0){const L=t.properties.get(_);L.light=T}return _}function x(C,E,T,M,_){if(C.visible===!1)return;if(C.layers.test(E.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&_===Aa)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,C.matrixWorld);const z=e.update(C),G=C.material;if(Array.isArray(G)){const $=z.groups;for(let H=0,q=$.length;H<q;H++){const D=$[H],Z=G[D.materialIndex];if(Z&&Z.visible){const P=S(C,Z,M,_);C.onBeforeShadow(t,C,E,T,z,P,D),t.renderBufferDirect(T,null,z,P,C,D),C.onAfterShadow(t,C,E,T,z,P,D)}}}else if(G.visible){const $=S(C,G,M,_);C.onBeforeShadow(t,C,E,T,z,$,null),t.renderBufferDirect(T,null,z,$,C,null),C.onAfterShadow(t,C,E,T,z,$,null)}}const L=C.children;for(let z=0,G=L.length;z<G;z++)x(L[z],E,T,M,_)}function w(C){C.target.removeEventListener("dispose",w);for(const T in c){const M=c[T],_=C.target.uuid;_ in M&&(M[_].dispose(),delete M[_])}}}const Ane={[fR]:mR,[gR]:SR,[vR]:xR,[kd]:yR,[mR]:fR,[SR]:gR,[xR]:vR,[yR]:kd};function Pne(t){function e(){let B=!1;const ke=new Wt;let ne=null;const ce=new Wt(0,0,0,0);return{setMask:function(Me){ne!==Me&&!B&&(t.colorMask(Me,Me,Me,Me),ne=Me)},setLocked:function(Me){B=Me},setClear:function(Me,Le,Ft,bn,Qn){Qn===!0&&(Me*=bn,Le*=bn,Ft*=bn),ke.set(Me,Le,Ft,bn),ce.equals(ke)===!1&&(t.clearColor(Me,Le,Ft,bn),ce.copy(ke))},reset:function(){B=!1,ne=null,ce.set(-1,0,0,0)}}}function n(){let B=!1,ke=!1,ne=null,ce=null,Me=null;return{setReversed:function(Le){ke=Le},setTest:function(Le){Le?pe(t.DEPTH_TEST):ye(t.DEPTH_TEST)},setMask:function(Le){ne!==Le&&!B&&(t.depthMask(Le),ne=Le)},setFunc:function(Le){if(ke&&(Le=Ane[Le]),ce!==Le){switch(Le){case fR:t.depthFunc(t.NEVER);break;case mR:t.depthFunc(t.ALWAYS);break;case gR:t.depthFunc(t.LESS);break;case kd:t.depthFunc(t.LEQUAL);break;case vR:t.depthFunc(t.EQUAL);break;case yR:t.depthFunc(t.GEQUAL);break;case SR:t.depthFunc(t.GREATER);break;case xR:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}ce=Le}},setLocked:function(Le){B=Le},setClear:function(Le){Me!==Le&&(t.clearDepth(Le),Me=Le)},reset:function(){B=!1,ne=null,ce=null,Me=null}}}function i(){let B=!1,ke=null,ne=null,ce=null,Me=null,Le=null,Ft=null,bn=null,Qn=null;return{setTest:function(Nt){B||(Nt?pe(t.STENCIL_TEST):ye(t.STENCIL_TEST))},setMask:function(Nt){ke!==Nt&&!B&&(t.stencilMask(Nt),ke=Nt)},setFunc:function(Nt,Ti,Zr){(ne!==Nt||ce!==Ti||Me!==Zr)&&(t.stencilFunc(Nt,Ti,Zr),ne=Nt,ce=Ti,Me=Zr)},setOp:function(Nt,Ti,Zr){(Le!==Nt||Ft!==Ti||bn!==Zr)&&(t.stencilOp(Nt,Ti,Zr),Le=Nt,Ft=Ti,bn=Zr)},setLocked:function(Nt){B=Nt},setClear:function(Nt){Qn!==Nt&&(t.clearStencil(Nt),Qn=Nt)},reset:function(){B=!1,ke=null,ne=null,ce=null,Me=null,Le=null,Ft=null,bn=null,Qn=null}}}const r=new e,s=new n,o=new i,a=new WeakMap,l=new WeakMap;let c={},u={},h=new WeakMap,d=[],p=null,f=!1,v=null,g=null,m=null,y=null,S=null,x=null,w=null,C=new Ge(0,0,0),E=0,T=!1,M=null,_=null,R=null,L=null,z=null;const G=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let $=!1,H=0;const q=t.getParameter(t.VERSION);q.indexOf("WebGL")!==-1?(H=parseFloat(/^WebGL (\d)/.exec(q)[1]),$=H>=1):q.indexOf("OpenGL ES")!==-1&&(H=parseFloat(/^OpenGL ES (\d)/.exec(q)[1]),$=H>=2);let D=null,Z={};const P=t.getParameter(t.SCISSOR_BOX),le=t.getParameter(t.VIEWPORT),Se=new Wt().fromArray(P),k=new Wt().fromArray(le);function J(B,ke,ne,ce){const Me=new Uint8Array(4),Le=t.createTexture();t.bindTexture(B,Le),t.texParameteri(B,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(B,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Ft=0;Ft<ne;Ft++)B===t.TEXTURE_3D||B===t.TEXTURE_2D_ARRAY?t.texImage3D(ke,0,t.RGBA,1,1,ce,0,t.RGBA,t.UNSIGNED_BYTE,Me):t.texImage2D(ke+Ft,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Me);return Le}const oe={};oe[t.TEXTURE_2D]=J(t.TEXTURE_2D,t.TEXTURE_2D,1),oe[t.TEXTURE_CUBE_MAP]=J(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),oe[t.TEXTURE_2D_ARRAY]=J(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),oe[t.TEXTURE_3D]=J(t.TEXTURE_3D,t.TEXTURE_3D,1,1),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),pe(t.DEPTH_TEST),s.setFunc(kd),St(!1),Mt($k),pe(t.CULL_FACE),U(Xl);function pe(B){c[B]!==!0&&(t.enable(B),c[B]=!0)}function ye(B){c[B]!==!1&&(t.disable(B),c[B]=!1)}function nt(B,ke){return u[B]!==ke?(t.bindFramebuffer(B,ke),u[B]=ke,B===t.DRAW_FRAMEBUFFER&&(u[t.FRAMEBUFFER]=ke),B===t.FRAMEBUFFER&&(u[t.DRAW_FRAMEBUFFER]=ke),!0):!1}function Je(B,ke){let ne=d,ce=!1;if(B){ne=h.get(ke),ne===void 0&&(ne=[],h.set(ke,ne));const Me=B.textures;if(ne.length!==Me.length||ne[0]!==t.COLOR_ATTACHMENT0){for(let Le=0,Ft=Me.length;Le<Ft;Le++)ne[Le]=t.COLOR_ATTACHMENT0+Le;ne.length=Me.length,ce=!0}}else ne[0]!==t.BACK&&(ne[0]=t.BACK,ce=!0);ce&&t.drawBuffers(ne)}function _t(B){return p!==B?(t.useProgram(B),p=B,!0):!1}const at={[eu]:t.FUNC_ADD,[bY]:t.FUNC_SUBTRACT,[AY]:t.FUNC_REVERSE_SUBTRACT};at[PY]=t.MIN,at[IY]=t.MAX;const yt={[MY]:t.ZERO,[kY]:t.ONE,[LY]:t.SRC_COLOR,[dR]:t.SRC_ALPHA,[UY]:t.SRC_ALPHA_SATURATE,[FY]:t.DST_COLOR,[NY]:t.DST_ALPHA,[DY]:t.ONE_MINUS_SRC_COLOR,[pR]:t.ONE_MINUS_SRC_ALPHA,[zY]:t.ONE_MINUS_DST_COLOR,[OY]:t.ONE_MINUS_DST_ALPHA,[BY]:t.CONSTANT_COLOR,[$Y]:t.ONE_MINUS_CONSTANT_COLOR,[HY]:t.CONSTANT_ALPHA,[VY]:t.ONE_MINUS_CONSTANT_ALPHA};function U(B,ke,ne,ce,Me,Le,Ft,bn,Qn,Nt){if(B===Xl){f===!0&&(ye(t.BLEND),f=!1);return}if(f===!1&&(pe(t.BLEND),f=!0),B!==TY){if(B!==v||Nt!==T){if((g!==eu||S!==eu)&&(t.blendEquation(t.FUNC_ADD),g=eu,S=eu),Nt)switch(B){case cd:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Hk:t.blendFunc(t.ONE,t.ONE);break;case Vk:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case jk:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",B);break}else switch(B){case cd:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Hk:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case Vk:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case jk:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",B);break}m=null,y=null,x=null,w=null,C.set(0,0,0),E=0,v=B,T=Nt}return}Me=Me||ke,Le=Le||ne,Ft=Ft||ce,(ke!==g||Me!==S)&&(t.blendEquationSeparate(at[ke],at[Me]),g=ke,S=Me),(ne!==m||ce!==y||Le!==x||Ft!==w)&&(t.blendFuncSeparate(yt[ne],yt[ce],yt[Le],yt[Ft]),m=ne,y=ce,x=Le,w=Ft),(bn.equals(C)===!1||Qn!==E)&&(t.blendColor(bn.r,bn.g,bn.b,Qn),C.copy(bn),E=Qn),v=B,T=!1}function di(B,ke){B.side===Zo?ye(t.CULL_FACE):pe(t.CULL_FACE);let ne=B.side===Tr;ke&&(ne=!ne),St(ne),B.blending===cd&&B.transparent===!1?U(Xl):U(B.blending,B.blendEquation,B.blendSrc,B.blendDst,B.blendEquationAlpha,B.blendSrcAlpha,B.blendDstAlpha,B.blendColor,B.blendAlpha,B.premultipliedAlpha),s.setFunc(B.depthFunc),s.setTest(B.depthTest),s.setMask(B.depthWrite),r.setMask(B.colorWrite);const ce=B.stencilWrite;o.setTest(ce),ce&&(o.setMask(B.stencilWriteMask),o.setFunc(B.stencilFunc,B.stencilRef,B.stencilFuncMask),o.setOp(B.stencilFail,B.stencilZFail,B.stencilZPass)),Zt(B.polygonOffset,B.polygonOffsetFactor,B.polygonOffsetUnits),B.alphaToCoverage===!0?pe(t.SAMPLE_ALPHA_TO_COVERAGE):ye(t.SAMPLE_ALPHA_TO_COVERAGE)}function St(B){M!==B&&(B?t.frontFace(t.CW):t.frontFace(t.CCW),M=B)}function Mt(B){B!==wY?(pe(t.CULL_FACE),B!==_&&(B===$k?t.cullFace(t.BACK):B===EY?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):ye(t.CULL_FACE),_=B}function ct(B){B!==R&&($&&t.lineWidth(B),R=B)}function Zt(B,ke,ne){B?(pe(t.POLYGON_OFFSET_FILL),(L!==ke||z!==ne)&&(t.polygonOffset(ke,ne),L=ke,z=ne)):ye(t.POLYGON_OFFSET_FILL)}function dt(B){B?pe(t.SCISSOR_TEST):ye(t.SCISSOR_TEST)}function I(B){B===void 0&&(B=t.TEXTURE0+G-1),D!==B&&(t.activeTexture(B),D=B)}function b(B,ke,ne){ne===void 0&&(D===null?ne=t.TEXTURE0+G-1:ne=D);let ce=Z[ne];ce===void 0&&(ce={type:void 0,texture:void 0},Z[ne]=ce),(ce.type!==B||ce.texture!==ke)&&(D!==ne&&(t.activeTexture(ne),D=ne),t.bindTexture(B,ke||oe[B]),ce.type=B,ce.texture=ke)}function Y(){const B=Z[D];B!==void 0&&B.type!==void 0&&(t.bindTexture(B.type,null),B.type=void 0,B.texture=void 0)}function ie(){try{t.compressedTexImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function de(){try{t.compressedTexImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function ae(){try{t.texSubImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function V(){try{t.texSubImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function K(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function re(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Ie(){try{t.texStorage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function se(){try{t.texStorage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function xe(){try{t.texImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Te(){try{t.texImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Qe(B){Se.equals(B)===!1&&(t.scissor(B.x,B.y,B.z,B.w),Se.copy(B))}function Ae(B){k.equals(B)===!1&&(t.viewport(B.x,B.y,B.z,B.w),k.copy(B))}function wt(B,ke){let ne=l.get(ke);ne===void 0&&(ne=new WeakMap,l.set(ke,ne));let ce=ne.get(B);ce===void 0&&(ce=t.getUniformBlockIndex(ke,B.name),ne.set(B,ce))}function Ze(B,ke){const ce=l.get(ke).get(B);a.get(ke)!==ce&&(t.uniformBlockBinding(ke,ce,B.__bindingPointIndex),a.set(ke,ce))}function Dt(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},D=null,Z={},u={},h=new WeakMap,d=[],p=null,f=!1,v=null,g=null,m=null,y=null,S=null,x=null,w=null,C=new Ge(0,0,0),E=0,T=!1,M=null,_=null,R=null,L=null,z=null,Se.set(0,0,t.canvas.width,t.canvas.height),k.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),o.reset()}return{buffers:{color:r,depth:s,stencil:o},enable:pe,disable:ye,bindFramebuffer:nt,drawBuffers:Je,useProgram:_t,setBlending:U,setMaterial:di,setFlipSided:St,setCullFace:Mt,setLineWidth:ct,setPolygonOffset:Zt,setScissorTest:dt,activeTexture:I,bindTexture:b,unbindTexture:Y,compressedTexImage2D:ie,compressedTexImage3D:de,texImage2D:xe,texImage3D:Te,updateUBOMapping:wt,uniformBlockBinding:Ze,texStorage2D:Ie,texStorage3D:se,texSubImage2D:ae,texSubImage3D:V,compressedTexSubImage2D:K,compressedTexSubImage3D:re,scissor:Qe,viewport:Ae,reset:Dt}}function DL(t,e,n,i){const r=Ine(i);switch(n){case kB:return t*e;case DB:return t*e;case NB:return t*e*2;case F2:return t*e/r.components*r.byteLength;case z2:return t*e/r.components*r.byteLength;case OB:return t*e*2/r.components*r.byteLength;case U2:return t*e*2/r.components*r.byteLength;case LB:return t*e*3/r.components*r.byteLength;case Bs:return t*e*4/r.components*r.byteLength;case B2:return t*e*4/r.components*r.byteLength;case ky:case Ly:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Dy:case Ny:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case wR:case RR:return Math.max(t,16)*Math.max(e,8)/4;case _R:case ER:return Math.max(t,8)*Math.max(e,8)/2;case TR:case bR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case AR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case PR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case IR:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case MR:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case kR:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case LR:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case DR:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case NR:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case OR:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case FR:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case zR:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case UR:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case BR:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case $R:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case HR:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case Oy:case VR:case jR:return Math.ceil(t/4)*Math.ceil(e/4)*16;case FB:case WR:return Math.ceil(t/4)*Math.ceil(e/4)*8;case GR:case qR:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Ine(t){switch(t){case Ya:case PB:return{byteLength:1,components:1};case Xg:case IB:case L0:return{byteLength:2,components:1};case N2:case O2:return{byteLength:2,components:4};case Iu:case D2:case Ro:return{byteLength:4,components:1};case MB:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}function Mne(t,e,n,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new mt,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(I,b){return p?new OffscreenCanvas(I,b):Jg("canvas")}function v(I,b,Y){let ie=1;const de=dt(I);if((de.width>Y||de.height>Y)&&(ie=Y/Math.max(de.width,de.height)),ie<1)if(typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&I instanceof ImageBitmap||typeof VideoFrame<"u"&&I instanceof VideoFrame){const ae=Math.floor(ie*de.width),V=Math.floor(ie*de.height);h===void 0&&(h=f(ae,V));const K=b?f(ae,V):h;return K.width=ae,K.height=V,K.getContext("2d").drawImage(I,0,0,ae,V),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+de.width+"x"+de.height+") to ("+ae+"x"+V+")."),K}else return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+de.width+"x"+de.height+")."),I;return I}function g(I){return I.generateMipmaps&&I.minFilter!==Er&&I.minFilter!==ds}function m(I){t.generateMipmap(I)}function y(I,b,Y,ie,de=!1){if(I!==null){if(t[I]!==void 0)return t[I];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+I+"'")}let ae=b;if(b===t.RED&&(Y===t.FLOAT&&(ae=t.R32F),Y===t.HALF_FLOAT&&(ae=t.R16F),Y===t.UNSIGNED_BYTE&&(ae=t.R8)),b===t.RED_INTEGER&&(Y===t.UNSIGNED_BYTE&&(ae=t.R8UI),Y===t.UNSIGNED_SHORT&&(ae=t.R16UI),Y===t.UNSIGNED_INT&&(ae=t.R32UI),Y===t.BYTE&&(ae=t.R8I),Y===t.SHORT&&(ae=t.R16I),Y===t.INT&&(ae=t.R32I)),b===t.RG&&(Y===t.FLOAT&&(ae=t.RG32F),Y===t.HALF_FLOAT&&(ae=t.RG16F),Y===t.UNSIGNED_BYTE&&(ae=t.RG8)),b===t.RG_INTEGER&&(Y===t.UNSIGNED_BYTE&&(ae=t.RG8UI),Y===t.UNSIGNED_SHORT&&(ae=t.RG16UI),Y===t.UNSIGNED_INT&&(ae=t.RG32UI),Y===t.BYTE&&(ae=t.RG8I),Y===t.SHORT&&(ae=t.RG16I),Y===t.INT&&(ae=t.RG32I)),b===t.RGB_INTEGER&&(Y===t.UNSIGNED_BYTE&&(ae=t.RGB8UI),Y===t.UNSIGNED_SHORT&&(ae=t.RGB16UI),Y===t.UNSIGNED_INT&&(ae=t.RGB32UI),Y===t.BYTE&&(ae=t.RGB8I),Y===t.SHORT&&(ae=t.RGB16I),Y===t.INT&&(ae=t.RGB32I)),b===t.RGBA_INTEGER&&(Y===t.UNSIGNED_BYTE&&(ae=t.RGBA8UI),Y===t.UNSIGNED_SHORT&&(ae=t.RGBA16UI),Y===t.UNSIGNED_INT&&(ae=t.RGBA32UI),Y===t.BYTE&&(ae=t.RGBA8I),Y===t.SHORT&&(ae=t.RGBA16I),Y===t.INT&&(ae=t.RGBA32I)),b===t.RGB&&Y===t.UNSIGNED_INT_5_9_9_9_REV&&(ae=t.RGB9_E5),b===t.RGBA){const V=de?T1:Pt.getTransfer(ie);Y===t.FLOAT&&(ae=t.RGBA32F),Y===t.HALF_FLOAT&&(ae=t.RGBA16F),Y===t.UNSIGNED_BYTE&&(ae=V===Pn?t.SRGB8_ALPHA8:t.RGBA8),Y===t.UNSIGNED_SHORT_4_4_4_4&&(ae=t.RGBA4),Y===t.UNSIGNED_SHORT_5_5_5_1&&(ae=t.RGB5_A1)}return(ae===t.R16F||ae===t.R32F||ae===t.RG16F||ae===t.RG32F||ae===t.RGBA16F||ae===t.RGBA32F)&&e.get("EXT_color_buffer_float"),ae}function S(I,b){let Y;return I?b===null||b===Iu||b===Nd?Y=t.DEPTH24_STENCIL8:b===Ro?Y=t.DEPTH32F_STENCIL8:b===Xg&&(Y=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):b===null||b===Iu||b===Nd?Y=t.DEPTH_COMPONENT24:b===Ro?Y=t.DEPTH_COMPONENT32F:b===Xg&&(Y=t.DEPTH_COMPONENT16),Y}function x(I,b){return g(I)===!0||I.isFramebufferTexture&&I.minFilter!==Er&&I.minFilter!==ds?Math.log2(Math.max(b.width,b.height))+1:I.mipmaps!==void 0&&I.mipmaps.length>0?I.mipmaps.length:I.isCompressedTexture&&Array.isArray(I.image)?b.mipmaps.length:1}function w(I){const b=I.target;b.removeEventListener("dispose",w),E(b),b.isVideoTexture&&u.delete(b)}function C(I){const b=I.target;b.removeEventListener("dispose",C),M(b)}function E(I){const b=i.get(I);if(b.__webglInit===void 0)return;const Y=I.source,ie=d.get(Y);if(ie){const de=ie[b.__cacheKey];de.usedTimes--,de.usedTimes===0&&T(I),Object.keys(ie).length===0&&d.delete(Y)}i.remove(I)}function T(I){const b=i.get(I);t.deleteTexture(b.__webglTexture);const Y=I.source,ie=d.get(Y);delete ie[b.__cacheKey],o.memory.textures--}function M(I){const b=i.get(I);if(I.depthTexture&&I.depthTexture.dispose(),I.isWebGLCubeRenderTarget)for(let ie=0;ie<6;ie++){if(Array.isArray(b.__webglFramebuffer[ie]))for(let de=0;de<b.__webglFramebuffer[ie].length;de++)t.deleteFramebuffer(b.__webglFramebuffer[ie][de]);else t.deleteFramebuffer(b.__webglFramebuffer[ie]);b.__webglDepthbuffer&&t.deleteRenderbuffer(b.__webglDepthbuffer[ie])}else{if(Array.isArray(b.__webglFramebuffer))for(let ie=0;ie<b.__webglFramebuffer.length;ie++)t.deleteFramebuffer(b.__webglFramebuffer[ie]);else t.deleteFramebuffer(b.__webglFramebuffer);if(b.__webglDepthbuffer&&t.deleteRenderbuffer(b.__webglDepthbuffer),b.__webglMultisampledFramebuffer&&t.deleteFramebuffer(b.__webglMultisampledFramebuffer),b.__webglColorRenderbuffer)for(let ie=0;ie<b.__webglColorRenderbuffer.length;ie++)b.__webglColorRenderbuffer[ie]&&t.deleteRenderbuffer(b.__webglColorRenderbuffer[ie]);b.__webglDepthRenderbuffer&&t.deleteRenderbuffer(b.__webglDepthRenderbuffer)}const Y=I.textures;for(let ie=0,de=Y.length;ie<de;ie++){const ae=i.get(Y[ie]);ae.__webglTexture&&(t.deleteTexture(ae.__webglTexture),o.memory.textures--),i.remove(Y[ie])}i.remove(I)}let _=0;function R(){_=0}function L(){const I=_;return I>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+r.maxTextures),_+=1,I}function z(I){const b=[];return b.push(I.wrapS),b.push(I.wrapT),b.push(I.wrapR||0),b.push(I.magFilter),b.push(I.minFilter),b.push(I.anisotropy),b.push(I.internalFormat),b.push(I.format),b.push(I.type),b.push(I.generateMipmaps),b.push(I.premultiplyAlpha),b.push(I.flipY),b.push(I.unpackAlignment),b.push(I.colorSpace),b.join()}function G(I,b){const Y=i.get(I);if(I.isVideoTexture&&ct(I),I.isRenderTargetTexture===!1&&I.version>0&&Y.__version!==I.version){const ie=I.image;if(ie===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ie.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{k(Y,I,b);return}}n.bindTexture(t.TEXTURE_2D,Y.__webglTexture,t.TEXTURE0+b)}function $(I,b){const Y=i.get(I);if(I.version>0&&Y.__version!==I.version){k(Y,I,b);return}n.bindTexture(t.TEXTURE_2D_ARRAY,Y.__webglTexture,t.TEXTURE0+b)}function H(I,b){const Y=i.get(I);if(I.version>0&&Y.__version!==I.version){k(Y,I,b);return}n.bindTexture(t.TEXTURE_3D,Y.__webglTexture,t.TEXTURE0+b)}function q(I,b){const Y=i.get(I);if(I.version>0&&Y.__version!==I.version){J(Y,I,b);return}n.bindTexture(t.TEXTURE_CUBE_MAP,Y.__webglTexture,t.TEXTURE0+b)}const D={[ic]:t.REPEAT,[na]:t.CLAMP_TO_EDGE,[E1]:t.MIRRORED_REPEAT},Z={[Er]:t.NEAREST,[AB]:t.NEAREST_MIPMAP_NEAREST,[Zm]:t.NEAREST_MIPMAP_LINEAR,[ds]:t.LINEAR,[My]:t.LINEAR_MIPMAP_NEAREST,[za]:t.LINEAR_MIPMAP_LINEAR},P={[oJ]:t.NEVER,[dJ]:t.ALWAYS,[aJ]:t.LESS,[BB]:t.LEQUAL,[lJ]:t.EQUAL,[hJ]:t.GEQUAL,[cJ]:t.GREATER,[uJ]:t.NOTEQUAL};function le(I,b){if(b.type===Ro&&e.has("OES_texture_float_linear")===!1&&(b.magFilter===ds||b.magFilter===My||b.magFilter===Zm||b.magFilter===za||b.minFilter===ds||b.minFilter===My||b.minFilter===Zm||b.minFilter===za)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(I,t.TEXTURE_WRAP_S,D[b.wrapS]),t.texParameteri(I,t.TEXTURE_WRAP_T,D[b.wrapT]),(I===t.TEXTURE_3D||I===t.TEXTURE_2D_ARRAY)&&t.texParameteri(I,t.TEXTURE_WRAP_R,D[b.wrapR]),t.texParameteri(I,t.TEXTURE_MAG_FILTER,Z[b.magFilter]),t.texParameteri(I,t.TEXTURE_MIN_FILTER,Z[b.minFilter]),b.compareFunction&&(t.texParameteri(I,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(I,t.TEXTURE_COMPARE_FUNC,P[b.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(b.magFilter===Er||b.minFilter!==Zm&&b.minFilter!==za||b.type===Ro&&e.has("OES_texture_float_linear")===!1)return;if(b.anisotropy>1||i.get(b).__currentAnisotropy){const Y=e.get("EXT_texture_filter_anisotropic");t.texParameterf(I,Y.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,r.getMaxAnisotropy())),i.get(b).__currentAnisotropy=b.anisotropy}}}function Se(I,b){let Y=!1;I.__webglInit===void 0&&(I.__webglInit=!0,b.addEventListener("dispose",w));const ie=b.source;let de=d.get(ie);de===void 0&&(de={},d.set(ie,de));const ae=z(b);if(ae!==I.__cacheKey){de[ae]===void 0&&(de[ae]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,Y=!0),de[ae].usedTimes++;const V=de[I.__cacheKey];V!==void 0&&(de[I.__cacheKey].usedTimes--,V.usedTimes===0&&T(b)),I.__cacheKey=ae,I.__webglTexture=de[ae].texture}return Y}function k(I,b,Y){let ie=t.TEXTURE_2D;(b.isDataArrayTexture||b.isCompressedArrayTexture)&&(ie=t.TEXTURE_2D_ARRAY),b.isData3DTexture&&(ie=t.TEXTURE_3D);const de=Se(I,b),ae=b.source;n.bindTexture(ie,I.__webglTexture,t.TEXTURE0+Y);const V=i.get(ae);if(ae.version!==V.__version||de===!0){n.activeTexture(t.TEXTURE0+Y);const K=Pt.getPrimaries(Pt.workingColorSpace),re=b.colorSpace===Al?null:Pt.getPrimaries(b.colorSpace),Ie=b.colorSpace===Al||K===re?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,b.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,b.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ie);let se=v(b.image,!1,r.maxTextureSize);se=Zt(b,se);const xe=s.convert(b.format,b.colorSpace),Te=s.convert(b.type);let Qe=y(b.internalFormat,xe,Te,b.colorSpace,b.isVideoTexture);le(ie,b);let Ae;const wt=b.mipmaps,Ze=b.isVideoTexture!==!0,Dt=V.__version===void 0||de===!0,B=ae.dataReady,ke=x(b,se);if(b.isDepthTexture)Qe=S(b.format===Od,b.type),Dt&&(Ze?n.texStorage2D(t.TEXTURE_2D,1,Qe,se.width,se.height):n.texImage2D(t.TEXTURE_2D,0,Qe,se.width,se.height,0,xe,Te,null));else if(b.isDataTexture)if(wt.length>0){Ze&&Dt&&n.texStorage2D(t.TEXTURE_2D,ke,Qe,wt[0].width,wt[0].height);for(let ne=0,ce=wt.length;ne<ce;ne++)Ae=wt[ne],Ze?B&&n.texSubImage2D(t.TEXTURE_2D,ne,0,0,Ae.width,Ae.height,xe,Te,Ae.data):n.texImage2D(t.TEXTURE_2D,ne,Qe,Ae.width,Ae.height,0,xe,Te,Ae.data);b.generateMipmaps=!1}else Ze?(Dt&&n.texStorage2D(t.TEXTURE_2D,ke,Qe,se.width,se.height),B&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,se.width,se.height,xe,Te,se.data)):n.texImage2D(t.TEXTURE_2D,0,Qe,se.width,se.height,0,xe,Te,se.data);else if(b.isCompressedTexture)if(b.isCompressedArrayTexture){Ze&&Dt&&n.texStorage3D(t.TEXTURE_2D_ARRAY,ke,Qe,wt[0].width,wt[0].height,se.depth);for(let ne=0,ce=wt.length;ne<ce;ne++)if(Ae=wt[ne],b.format!==Bs)if(xe!==null)if(Ze){if(B)if(b.layerUpdates.size>0){const Me=DL(Ae.width,Ae.height,b.format,b.type);for(const Le of b.layerUpdates){const Ft=Ae.data.subarray(Le*Me/Ae.data.BYTES_PER_ELEMENT,(Le+1)*Me/Ae.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ne,0,0,Le,Ae.width,Ae.height,1,xe,Ft,0,0)}b.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ne,0,0,0,Ae.width,Ae.height,se.depth,xe,Ae.data,0,0)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,ne,Qe,Ae.width,Ae.height,se.depth,0,Ae.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ze?B&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,ne,0,0,0,Ae.width,Ae.height,se.depth,xe,Te,Ae.data):n.texImage3D(t.TEXTURE_2D_ARRAY,ne,Qe,Ae.width,Ae.height,se.depth,0,xe,Te,Ae.data)}else{Ze&&Dt&&n.texStorage2D(t.TEXTURE_2D,ke,Qe,wt[0].width,wt[0].height);for(let ne=0,ce=wt.length;ne<ce;ne++)Ae=wt[ne],b.format!==Bs?xe!==null?Ze?B&&n.compressedTexSubImage2D(t.TEXTURE_2D,ne,0,0,Ae.width,Ae.height,xe,Ae.data):n.compressedTexImage2D(t.TEXTURE_2D,ne,Qe,Ae.width,Ae.height,0,Ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ze?B&&n.texSubImage2D(t.TEXTURE_2D,ne,0,0,Ae.width,Ae.height,xe,Te,Ae.data):n.texImage2D(t.TEXTURE_2D,ne,Qe,Ae.width,Ae.height,0,xe,Te,Ae.data)}else if(b.isDataArrayTexture)if(Ze){if(Dt&&n.texStorage3D(t.TEXTURE_2D_ARRAY,ke,Qe,se.width,se.height,se.depth),B)if(b.layerUpdates.size>0){const ne=DL(se.width,se.height,b.format,b.type);for(const ce of b.layerUpdates){const Me=se.data.subarray(ce*ne/se.data.BYTES_PER_ELEMENT,(ce+1)*ne/se.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,ce,se.width,se.height,1,xe,Te,Me)}b.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,se.width,se.height,se.depth,xe,Te,se.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Qe,se.width,se.height,se.depth,0,xe,Te,se.data);else if(b.isData3DTexture)Ze?(Dt&&n.texStorage3D(t.TEXTURE_3D,ke,Qe,se.width,se.height,se.depth),B&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,se.width,se.height,se.depth,xe,Te,se.data)):n.texImage3D(t.TEXTURE_3D,0,Qe,se.width,se.height,se.depth,0,xe,Te,se.data);else if(b.isFramebufferTexture){if(Dt)if(Ze)n.texStorage2D(t.TEXTURE_2D,ke,Qe,se.width,se.height);else{let ne=se.width,ce=se.height;for(let Me=0;Me<ke;Me++)n.texImage2D(t.TEXTURE_2D,Me,Qe,ne,ce,0,xe,Te,null),ne>>=1,ce>>=1}}else if(wt.length>0){if(Ze&&Dt){const ne=dt(wt[0]);n.texStorage2D(t.TEXTURE_2D,ke,Qe,ne.width,ne.height)}for(let ne=0,ce=wt.length;ne<ce;ne++)Ae=wt[ne],Ze?B&&n.texSubImage2D(t.TEXTURE_2D,ne,0,0,xe,Te,Ae):n.texImage2D(t.TEXTURE_2D,ne,Qe,xe,Te,Ae);b.generateMipmaps=!1}else if(Ze){if(Dt){const ne=dt(se);n.texStorage2D(t.TEXTURE_2D,ke,Qe,ne.width,ne.height)}B&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,xe,Te,se)}else n.texImage2D(t.TEXTURE_2D,0,Qe,xe,Te,se);g(b)&&m(ie),V.__version=ae.version,b.onUpdate&&b.onUpdate(b)}I.__version=b.version}function J(I,b,Y){if(b.image.length!==6)return;const ie=Se(I,b),de=b.source;n.bindTexture(t.TEXTURE_CUBE_MAP,I.__webglTexture,t.TEXTURE0+Y);const ae=i.get(de);if(de.version!==ae.__version||ie===!0){n.activeTexture(t.TEXTURE0+Y);const V=Pt.getPrimaries(Pt.workingColorSpace),K=b.colorSpace===Al?null:Pt.getPrimaries(b.colorSpace),re=b.colorSpace===Al||V===K?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,b.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,b.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,re);const Ie=b.isCompressedTexture||b.image[0].isCompressedTexture,se=b.image[0]&&b.image[0].isDataTexture,xe=[];for(let ce=0;ce<6;ce++)!Ie&&!se?xe[ce]=v(b.image[ce],!0,r.maxCubemapSize):xe[ce]=se?b.image[ce].image:b.image[ce],xe[ce]=Zt(b,xe[ce]);const Te=xe[0],Qe=s.convert(b.format,b.colorSpace),Ae=s.convert(b.type),wt=y(b.internalFormat,Qe,Ae,b.colorSpace),Ze=b.isVideoTexture!==!0,Dt=ae.__version===void 0||ie===!0,B=de.dataReady;let ke=x(b,Te);le(t.TEXTURE_CUBE_MAP,b);let ne;if(Ie){Ze&&Dt&&n.texStorage2D(t.TEXTURE_CUBE_MAP,ke,wt,Te.width,Te.height);for(let ce=0;ce<6;ce++){ne=xe[ce].mipmaps;for(let Me=0;Me<ne.length;Me++){const Le=ne[Me];b.format!==Bs?Qe!==null?Ze?B&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,0,0,Le.width,Le.height,Qe,Le.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,wt,Le.width,Le.height,0,Le.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ze?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,0,0,Le.width,Le.height,Qe,Ae,Le.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me,wt,Le.width,Le.height,0,Qe,Ae,Le.data)}}}else{if(ne=b.mipmaps,Ze&&Dt){ne.length>0&&ke++;const ce=dt(xe[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,ke,wt,ce.width,ce.height)}for(let ce=0;ce<6;ce++)if(se){Ze?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,0,0,xe[ce].width,xe[ce].height,Qe,Ae,xe[ce].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,wt,xe[ce].width,xe[ce].height,0,Qe,Ae,xe[ce].data);for(let Me=0;Me<ne.length;Me++){const Ft=ne[Me].image[ce].image;Ze?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,0,0,Ft.width,Ft.height,Qe,Ae,Ft.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,wt,Ft.width,Ft.height,0,Qe,Ae,Ft.data)}}else{Ze?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,0,0,Qe,Ae,xe[ce]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,wt,Qe,Ae,xe[ce]);for(let Me=0;Me<ne.length;Me++){const Le=ne[Me];Ze?B&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,0,0,Qe,Ae,Le.image[ce]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ce,Me+1,wt,Qe,Ae,Le.image[ce])}}}g(b)&&m(t.TEXTURE_CUBE_MAP),ae.__version=de.version,b.onUpdate&&b.onUpdate(b)}I.__version=b.version}function oe(I,b,Y,ie,de,ae){const V=s.convert(Y.format,Y.colorSpace),K=s.convert(Y.type),re=y(Y.internalFormat,V,K,Y.colorSpace);if(!i.get(b).__hasExternalTextures){const se=Math.max(1,b.width>>ae),xe=Math.max(1,b.height>>ae);de===t.TEXTURE_3D||de===t.TEXTURE_2D_ARRAY?n.texImage3D(de,ae,re,se,xe,b.depth,0,V,K,null):n.texImage2D(de,ae,re,se,xe,0,V,K,null)}n.bindFramebuffer(t.FRAMEBUFFER,I),Mt(b)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,ie,de,i.get(Y).__webglTexture,0,St(b)):(de===t.TEXTURE_2D||de>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&de<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,ie,de,i.get(Y).__webglTexture,ae),n.bindFramebuffer(t.FRAMEBUFFER,null)}function pe(I,b,Y){if(t.bindRenderbuffer(t.RENDERBUFFER,I),b.depthBuffer){const ie=b.depthTexture,de=ie&&ie.isDepthTexture?ie.type:null,ae=S(b.stencilBuffer,de),V=b.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,K=St(b);Mt(b)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,K,ae,b.width,b.height):Y?t.renderbufferStorageMultisample(t.RENDERBUFFER,K,ae,b.width,b.height):t.renderbufferStorage(t.RENDERBUFFER,ae,b.width,b.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,V,t.RENDERBUFFER,I)}else{const ie=b.textures;for(let de=0;de<ie.length;de++){const ae=ie[de],V=s.convert(ae.format,ae.colorSpace),K=s.convert(ae.type),re=y(ae.internalFormat,V,K,ae.colorSpace),Ie=St(b);Y&&Mt(b)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ie,re,b.width,b.height):Mt(b)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ie,re,b.width,b.height):t.renderbufferStorage(t.RENDERBUFFER,re,b.width,b.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function ye(I,b){if(b&&b.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,I),!(b.depthTexture&&b.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(b.depthTexture).__webglTexture||b.depthTexture.image.width!==b.width||b.depthTexture.image.height!==b.height)&&(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0),G(b.depthTexture,0);const ie=i.get(b.depthTexture).__webglTexture,de=St(b);if(b.depthTexture.format===ud)Mt(b)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,ie,0,de):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,ie,0);else if(b.depthTexture.format===Od)Mt(b)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,ie,0,de):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,ie,0);else throw new Error("Unknown depthTexture format")}function nt(I){const b=i.get(I),Y=I.isWebGLCubeRenderTarget===!0;if(b.__boundDepthTexture!==I.depthTexture){const ie=I.depthTexture;if(b.__depthDisposeCallback&&b.__depthDisposeCallback(),ie){const de=()=>{delete b.__boundDepthTexture,delete b.__depthDisposeCallback,ie.removeEventListener("dispose",de)};ie.addEventListener("dispose",de),b.__depthDisposeCallback=de}b.__boundDepthTexture=ie}if(I.depthTexture&&!b.__autoAllocateDepthBuffer){if(Y)throw new Error("target.depthTexture not supported in Cube render targets");ye(b.__webglFramebuffer,I)}else if(Y){b.__webglDepthbuffer=[];for(let ie=0;ie<6;ie++)if(n.bindFramebuffer(t.FRAMEBUFFER,b.__webglFramebuffer[ie]),b.__webglDepthbuffer[ie]===void 0)b.__webglDepthbuffer[ie]=t.createRenderbuffer(),pe(b.__webglDepthbuffer[ie],I,!1);else{const de=I.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,ae=b.__webglDepthbuffer[ie];t.bindRenderbuffer(t.RENDERBUFFER,ae),t.framebufferRenderbuffer(t.FRAMEBUFFER,de,t.RENDERBUFFER,ae)}}else if(n.bindFramebuffer(t.FRAMEBUFFER,b.__webglFramebuffer),b.__webglDepthbuffer===void 0)b.__webglDepthbuffer=t.createRenderbuffer(),pe(b.__webglDepthbuffer,I,!1);else{const ie=I.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,de=b.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,de),t.framebufferRenderbuffer(t.FRAMEBUFFER,ie,t.RENDERBUFFER,de)}n.bindFramebuffer(t.FRAMEBUFFER,null)}function Je(I,b,Y){const ie=i.get(I);b!==void 0&&oe(ie.__webglFramebuffer,I,I.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),Y!==void 0&&nt(I)}function _t(I){const b=I.texture,Y=i.get(I),ie=i.get(b);I.addEventListener("dispose",C);const de=I.textures,ae=I.isWebGLCubeRenderTarget===!0,V=de.length>1;if(V||(ie.__webglTexture===void 0&&(ie.__webglTexture=t.createTexture()),ie.__version=b.version,o.memory.textures++),ae){Y.__webglFramebuffer=[];for(let K=0;K<6;K++)if(b.mipmaps&&b.mipmaps.length>0){Y.__webglFramebuffer[K]=[];for(let re=0;re<b.mipmaps.length;re++)Y.__webglFramebuffer[K][re]=t.createFramebuffer()}else Y.__webglFramebuffer[K]=t.createFramebuffer()}else{if(b.mipmaps&&b.mipmaps.length>0){Y.__webglFramebuffer=[];for(let K=0;K<b.mipmaps.length;K++)Y.__webglFramebuffer[K]=t.createFramebuffer()}else Y.__webglFramebuffer=t.createFramebuffer();if(V)for(let K=0,re=de.length;K<re;K++){const Ie=i.get(de[K]);Ie.__webglTexture===void 0&&(Ie.__webglTexture=t.createTexture(),o.memory.textures++)}if(I.samples>0&&Mt(I)===!1){Y.__webglMultisampledFramebuffer=t.createFramebuffer(),Y.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,Y.__webglMultisampledFramebuffer);for(let K=0;K<de.length;K++){const re=de[K];Y.__webglColorRenderbuffer[K]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,Y.__webglColorRenderbuffer[K]);const Ie=s.convert(re.format,re.colorSpace),se=s.convert(re.type),xe=y(re.internalFormat,Ie,se,re.colorSpace,I.isXRRenderTarget===!0),Te=St(I);t.renderbufferStorageMultisample(t.RENDERBUFFER,Te,xe,I.width,I.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+K,t.RENDERBUFFER,Y.__webglColorRenderbuffer[K])}t.bindRenderbuffer(t.RENDERBUFFER,null),I.depthBuffer&&(Y.__webglDepthRenderbuffer=t.createRenderbuffer(),pe(Y.__webglDepthRenderbuffer,I,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(ae){n.bindTexture(t.TEXTURE_CUBE_MAP,ie.__webglTexture),le(t.TEXTURE_CUBE_MAP,b);for(let K=0;K<6;K++)if(b.mipmaps&&b.mipmaps.length>0)for(let re=0;re<b.mipmaps.length;re++)oe(Y.__webglFramebuffer[K][re],I,b,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+K,re);else oe(Y.__webglFramebuffer[K],I,b,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+K,0);g(b)&&m(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(V){for(let K=0,re=de.length;K<re;K++){const Ie=de[K],se=i.get(Ie);n.bindTexture(t.TEXTURE_2D,se.__webglTexture),le(t.TEXTURE_2D,Ie),oe(Y.__webglFramebuffer,I,Ie,t.COLOR_ATTACHMENT0+K,t.TEXTURE_2D,0),g(Ie)&&m(t.TEXTURE_2D)}n.unbindTexture()}else{let K=t.TEXTURE_2D;if((I.isWebGL3DRenderTarget||I.isWebGLArrayRenderTarget)&&(K=I.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(K,ie.__webglTexture),le(K,b),b.mipmaps&&b.mipmaps.length>0)for(let re=0;re<b.mipmaps.length;re++)oe(Y.__webglFramebuffer[re],I,b,t.COLOR_ATTACHMENT0,K,re);else oe(Y.__webglFramebuffer,I,b,t.COLOR_ATTACHMENT0,K,0);g(b)&&m(K),n.unbindTexture()}I.depthBuffer&&nt(I)}function at(I){const b=I.textures;for(let Y=0,ie=b.length;Y<ie;Y++){const de=b[Y];if(g(de)){const ae=I.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,V=i.get(de).__webglTexture;n.bindTexture(ae,V),m(ae),n.unbindTexture()}}}const yt=[],U=[];function di(I){if(I.samples>0){if(Mt(I)===!1){const b=I.textures,Y=I.width,ie=I.height;let de=t.COLOR_BUFFER_BIT;const ae=I.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,V=i.get(I),K=b.length>1;if(K)for(let re=0;re<b.length;re++)n.bindFramebuffer(t.FRAMEBUFFER,V.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+re,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,V.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+re,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,V.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,V.__webglFramebuffer);for(let re=0;re<b.length;re++){if(I.resolveDepthBuffer&&(I.depthBuffer&&(de|=t.DEPTH_BUFFER_BIT),I.stencilBuffer&&I.resolveStencilBuffer&&(de|=t.STENCIL_BUFFER_BIT)),K){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,V.__webglColorRenderbuffer[re]);const Ie=i.get(b[re]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Ie,0)}t.blitFramebuffer(0,0,Y,ie,0,0,Y,ie,de,t.NEAREST),l===!0&&(yt.length=0,U.length=0,yt.push(t.COLOR_ATTACHMENT0+re),I.depthBuffer&&I.resolveDepthBuffer===!1&&(yt.push(ae),U.push(ae),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,U)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,yt))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),K)for(let re=0;re<b.length;re++){n.bindFramebuffer(t.FRAMEBUFFER,V.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+re,t.RENDERBUFFER,V.__webglColorRenderbuffer[re]);const Ie=i.get(b[re]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,V.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+re,t.TEXTURE_2D,Ie,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,V.__webglMultisampledFramebuffer)}else if(I.depthBuffer&&I.resolveDepthBuffer===!1&&l){const b=I.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[b])}}}function St(I){return Math.min(r.maxSamples,I.samples)}function Mt(I){const b=i.get(I);return I.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&b.__useRenderToTexture!==!1}function ct(I){const b=o.render.frame;u.get(I)!==b&&(u.set(I,b),I.update())}function Zt(I,b){const Y=I.colorSpace,ie=I.format,de=I.type;return I.isCompressedTexture===!0||I.isVideoTexture===!0||Y!==qi&&Y!==Al&&(Pt.getTransfer(Y)===Pn?(ie!==Bs||de!==Ya)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Y)),b}function dt(I){return typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement?(c.width=I.naturalWidth||I.width,c.height=I.naturalHeight||I.height):typeof VideoFrame<"u"&&I instanceof VideoFrame?(c.width=I.displayWidth,c.height=I.displayHeight):(c.width=I.width,c.height=I.height),c}this.allocateTextureUnit=L,this.resetTextureUnits=R,this.setTexture2D=G,this.setTexture2DArray=$,this.setTexture3D=H,this.setTextureCube=q,this.rebindTextures=Je,this.setupRenderTarget=_t,this.updateRenderTargetMipmap=at,this.updateMultisampleRenderTarget=di,this.setupDepthRenderbuffer=nt,this.setupFrameBufferTexture=oe,this.useMultisampledRTT=Mt}function kne(t,e){function n(i,r=Al){let s;const o=Pt.getTransfer(r);if(i===Ya)return t.UNSIGNED_BYTE;if(i===N2)return t.UNSIGNED_SHORT_4_4_4_4;if(i===O2)return t.UNSIGNED_SHORT_5_5_5_1;if(i===MB)return t.UNSIGNED_INT_5_9_9_9_REV;if(i===PB)return t.BYTE;if(i===IB)return t.SHORT;if(i===Xg)return t.UNSIGNED_SHORT;if(i===D2)return t.INT;if(i===Iu)return t.UNSIGNED_INT;if(i===Ro)return t.FLOAT;if(i===L0)return t.HALF_FLOAT;if(i===kB)return t.ALPHA;if(i===LB)return t.RGB;if(i===Bs)return t.RGBA;if(i===DB)return t.LUMINANCE;if(i===NB)return t.LUMINANCE_ALPHA;if(i===ud)return t.DEPTH_COMPONENT;if(i===Od)return t.DEPTH_STENCIL;if(i===F2)return t.RED;if(i===z2)return t.RED_INTEGER;if(i===OB)return t.RG;if(i===U2)return t.RG_INTEGER;if(i===B2)return t.RGBA_INTEGER;if(i===ky||i===Ly||i===Dy||i===Ny)if(o===Pn)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===ky)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Ly)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Dy)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Ny)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===ky)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Ly)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Dy)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Ny)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===_R||i===wR||i===ER||i===RR)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===_R)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===wR)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===ER)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===RR)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===TR||i===bR||i===AR)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===TR||i===bR)return o===Pn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===AR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===PR||i===IR||i===MR||i===kR||i===LR||i===DR||i===NR||i===OR||i===FR||i===zR||i===UR||i===BR||i===$R||i===HR)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===PR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===IR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===MR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===kR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===LR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===DR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===NR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===OR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===FR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===zR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===UR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===BR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===$R)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===HR)return o===Pn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Oy||i===VR||i===jR)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Oy)return o===Pn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===VR)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===jR)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===FB||i===WR||i===GR||i===qR)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===Oy)return s.COMPRESSED_RED_RGTC1_EXT;if(i===WR)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===GR)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===qR)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Nd?t.UNSIGNED_INT_24_8:t[i]!==void 0?t[i]:null}return{convert:n}}class Lne extends cr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Ba extends Sn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Dne={type:"move"};class mw{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ba,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ba,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ba,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const i of e.hand.values())this._getHandJoint(n,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const v of e.hand.values()){const g=n.getJointPose(v,i),m=this._getHandJoint(c,v);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=g!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,f=.005;c.inputState.pinching&&d>p+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=n.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Dne)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const i=new Ba;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[n.jointName]=i,e.add(i)}return e.joints[n.jointName]}}const Nne=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,One=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Fne{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,i){if(this.texture===null){const r=new wi,s=e.properties.get(r);s.__webglTexture=n.texture,(n.depthNear!=i.depthNear||n.depthFar!=i.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,i=new rc({vertexShader:Nne,fragmentShader:One,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new gn(new Kx(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class zne extends Sc{constructor(e,n){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,d=null,p=null,f=null;const v=new Fne,g=n.getContextAttributes();let m=null,y=null;const S=[],x=[],w=new mt;let C=null;const E=new cr;E.layers.enable(1),E.viewport=new Wt;const T=new cr;T.layers.enable(2),T.viewport=new Wt;const M=[E,T],_=new Lne;_.layers.enable(1),_.layers.enable(2);let R=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(J){let oe=S[J];return oe===void 0&&(oe=new mw,S[J]=oe),oe.getTargetRaySpace()},this.getControllerGrip=function(J){let oe=S[J];return oe===void 0&&(oe=new mw,S[J]=oe),oe.getGripSpace()},this.getHand=function(J){let oe=S[J];return oe===void 0&&(oe=new mw,S[J]=oe),oe.getHandSpace()};function z(J){const oe=x.indexOf(J.inputSource);if(oe===-1)return;const pe=S[oe];pe!==void 0&&(pe.update(J.inputSource,J.frame,c||o),pe.dispatchEvent({type:J.type,data:J.inputSource}))}function G(){r.removeEventListener("select",z),r.removeEventListener("selectstart",z),r.removeEventListener("selectend",z),r.removeEventListener("squeeze",z),r.removeEventListener("squeezestart",z),r.removeEventListener("squeezeend",z),r.removeEventListener("end",G),r.removeEventListener("inputsourceschange",$);for(let J=0;J<S.length;J++){const oe=x[J];oe!==null&&(x[J]=null,S[J].disconnect(oe))}R=null,L=null,v.reset(),e.setRenderTarget(m),p=null,d=null,h=null,r=null,y=null,k.stop(),i.isPresenting=!1,e.setPixelRatio(C),e.setSize(w.width,w.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(J){s=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(J){a=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(J){c=J},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(J){if(r=J,r!==null){if(m=e.getRenderTarget(),r.addEventListener("select",z),r.addEventListener("selectstart",z),r.addEventListener("selectend",z),r.addEventListener("squeeze",z),r.addEventListener("squeezestart",z),r.addEventListener("squeezeend",z),r.addEventListener("end",G),r.addEventListener("inputsourceschange",$),g.xrCompatible!==!0&&await n.makeXRCompatible(),C=e.getPixelRatio(),e.getSize(w),r.renderState.layers===void 0){const oe={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(r,n,oe),r.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),y=new Mu(p.framebufferWidth,p.framebufferHeight,{format:Bs,type:Ya,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}else{let oe=null,pe=null,ye=null;g.depth&&(ye=g.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,oe=g.stencil?Od:ud,pe=g.stencil?Nd:Iu);const nt={colorFormat:n.RGBA8,depthFormat:ye,scaleFactor:s};h=new XRWebGLBinding(r,n),d=h.createProjectionLayer(nt),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),y=new Mu(d.textureWidth,d.textureHeight,{format:Bs,type:Ya,depthTexture:new YB(d.textureWidth,d.textureHeight,pe,void 0,void 0,void 0,void 0,void 0,void 0,oe),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),k.setContext(r),k.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function $(J){for(let oe=0;oe<J.removed.length;oe++){const pe=J.removed[oe],ye=x.indexOf(pe);ye>=0&&(x[ye]=null,S[ye].disconnect(pe))}for(let oe=0;oe<J.added.length;oe++){const pe=J.added[oe];let ye=x.indexOf(pe);if(ye===-1){for(let Je=0;Je<S.length;Je++)if(Je>=x.length){x.push(pe),ye=Je;break}else if(x[Je]===null){x[Je]=pe,ye=Je;break}if(ye===-1)break}const nt=S[ye];nt&&nt.connect(pe)}}const H=new N,q=new N;function D(J,oe,pe){H.setFromMatrixPosition(oe.matrixWorld),q.setFromMatrixPosition(pe.matrixWorld);const ye=H.distanceTo(q),nt=oe.projectionMatrix.elements,Je=pe.projectionMatrix.elements,_t=nt[14]/(nt[10]-1),at=nt[14]/(nt[10]+1),yt=(nt[9]+1)/nt[5],U=(nt[9]-1)/nt[5],di=(nt[8]-1)/nt[0],St=(Je[8]+1)/Je[0],Mt=_t*di,ct=_t*St,Zt=ye/(-di+St),dt=Zt*-di;if(oe.matrixWorld.decompose(J.position,J.quaternion,J.scale),J.translateX(dt),J.translateZ(Zt),J.matrixWorld.compose(J.position,J.quaternion,J.scale),J.matrixWorldInverse.copy(J.matrixWorld).invert(),nt[10]===-1)J.projectionMatrix.copy(oe.projectionMatrix),J.projectionMatrixInverse.copy(oe.projectionMatrixInverse);else{const I=_t+Zt,b=at+Zt,Y=Mt-dt,ie=ct+(ye-dt),de=yt*at/b*I,ae=U*at/b*I;J.projectionMatrix.makePerspective(Y,ie,de,ae,I,b),J.projectionMatrixInverse.copy(J.projectionMatrix).invert()}}function Z(J,oe){oe===null?J.matrixWorld.copy(J.matrix):J.matrixWorld.multiplyMatrices(oe.matrixWorld,J.matrix),J.matrixWorldInverse.copy(J.matrixWorld).invert()}this.updateCamera=function(J){if(r===null)return;let oe=J.near,pe=J.far;v.texture!==null&&(v.depthNear>0&&(oe=v.depthNear),v.depthFar>0&&(pe=v.depthFar)),_.near=T.near=E.near=oe,_.far=T.far=E.far=pe,(R!==_.near||L!==_.far)&&(r.updateRenderState({depthNear:_.near,depthFar:_.far}),R=_.near,L=_.far);const ye=J.parent,nt=_.cameras;Z(_,ye);for(let Je=0;Je<nt.length;Je++)Z(nt[Je],ye);nt.length===2?D(_,E,T):_.projectionMatrix.copy(E.projectionMatrix),P(J,_,ye)};function P(J,oe,pe){pe===null?J.matrix.copy(oe.matrixWorld):(J.matrix.copy(pe.matrixWorld),J.matrix.invert(),J.matrix.multiply(oe.matrixWorld)),J.matrix.decompose(J.position,J.quaternion,J.scale),J.updateMatrixWorld(!0),J.projectionMatrix.copy(oe.projectionMatrix),J.projectionMatrixInverse.copy(oe.projectionMatrixInverse),J.isPerspectiveCamera&&(J.fov=Fd*2*Math.atan(1/J.projectionMatrix.elements[5]),J.zoom=1)}this.getCamera=function(){return _},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(J){l=J,d!==null&&(d.fixedFoveation=J),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=J)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(_)};let le=null;function Se(J,oe){if(u=oe.getViewerPose(c||o),f=oe,u!==null){const pe=u.views;p!==null&&(e.setRenderTargetFramebuffer(y,p.framebuffer),e.setRenderTarget(y));let ye=!1;pe.length!==_.cameras.length&&(_.cameras.length=0,ye=!0);for(let Je=0;Je<pe.length;Je++){const _t=pe[Je];let at=null;if(p!==null)at=p.getViewport(_t);else{const U=h.getViewSubImage(d,_t);at=U.viewport,Je===0&&(e.setRenderTargetTextures(y,U.colorTexture,d.ignoreDepthValues?void 0:U.depthStencilTexture),e.setRenderTarget(y))}let yt=M[Je];yt===void 0&&(yt=new cr,yt.layers.enable(Je),yt.viewport=new Wt,M[Je]=yt),yt.matrix.fromArray(_t.transform.matrix),yt.matrix.decompose(yt.position,yt.quaternion,yt.scale),yt.projectionMatrix.fromArray(_t.projectionMatrix),yt.projectionMatrixInverse.copy(yt.projectionMatrix).invert(),yt.viewport.set(at.x,at.y,at.width,at.height),Je===0&&(_.matrix.copy(yt.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale)),ye===!0&&_.cameras.push(yt)}const nt=r.enabledFeatures;if(nt&&nt.includes("depth-sensing")){const Je=h.getDepthInformation(pe[0]);Je&&Je.isValid&&Je.texture&&v.init(e,Je,r.renderState)}}for(let pe=0;pe<S.length;pe++){const ye=x[pe],nt=S[pe];ye!==null&&nt!==void 0&&nt.update(ye,oe,c||o)}le&&le(J,oe),oe.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:oe}),f=null}const k=new KB;k.setAnimationLoop(Se),this.setAnimationLoop=function(J){le=J},this.dispose=function(){}}}const Wc=new fn,Une=new je;function Bne(t,e){function n(g,m){g.matrixAutoUpdate===!0&&g.updateMatrix(),m.value.copy(g.matrix)}function i(g,m){m.color.getRGB(g.fogColor.value,GB(t)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function r(g,m,y,S,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),h(g,m)):m.isMeshPhongMaterial?(s(g,m),u(g,m)):m.isMeshStandardMaterial?(s(g,m),d(g,m),m.isMeshPhysicalMaterial&&p(g,m,x)):m.isMeshMatcapMaterial?(s(g,m),f(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),v(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(o(g,m),m.isLineDashedMaterial&&a(g,m)):m.isPointsMaterial?l(g,m,y,S):m.isSpriteMaterial?c(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,n(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,n(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,n(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,m.side===Tr&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,n(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),m.side===Tr&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,n(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,n(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,n(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const y=e.get(m),S=y.envMap,x=y.envMapRotation;S&&(g.envMap.value=S,Wc.copy(x),Wc.x*=-1,Wc.y*=-1,Wc.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(Wc.y*=-1,Wc.z*=-1),g.envMapRotation.value.setFromMatrix4(Une.makeRotationFromEuler(Wc)),g.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap&&(g.lightMap.value=m.lightMap,g.lightMapIntensity.value=m.lightMapIntensity,n(m.lightMap,g.lightMapTransform)),m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,n(m.aoMap,g.aoMapTransform))}function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,n(m.map,g.mapTransform))}function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function l(g,m,y,S){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*y,g.scale.value=S*.5,m.map&&(g.map.value=m.map,n(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,n(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function c(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,n(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,n(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function h(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function d(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,n(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,n(m.roughnessMap,g.roughnessMapTransform)),m.envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function p(g,m,y){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,n(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,n(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,n(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,n(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,n(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===Tr&&g.clearcoatNormalScale.value.negate())),m.dispersion>0&&(g.dispersion.value=m.dispersion),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,n(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,n(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,n(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,n(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,n(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,n(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,n(m.specularIntensityMap,g.specularIntensityMapTransform))}function f(g,m){m.matcap&&(g.matcap.value=m.matcap)}function v(g,m){const y=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function $ne(t,e,n,i){let r={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(y,S){const x=S.program;i.uniformBlockBinding(y,x)}function c(y,S){let x=r[y.id];x===void 0&&(f(y),x=u(y),r[y.id]=x,y.addEventListener("dispose",g));const w=S.program;i.updateUBOMapping(y,w);const C=e.render.frame;s[y.id]!==C&&(d(y),s[y.id]=C)}function u(y){const S=h();y.__bindingPointIndex=S;const x=t.createBuffer(),w=y.__size,C=y.usage;return t.bindBuffer(t.UNIFORM_BUFFER,x),t.bufferData(t.UNIFORM_BUFFER,w,C),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,S,x),x}function h(){for(let y=0;y<a;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const S=r[y.id],x=y.uniforms,w=y.__cache;t.bindBuffer(t.UNIFORM_BUFFER,S);for(let C=0,E=x.length;C<E;C++){const T=Array.isArray(x[C])?x[C]:[x[C]];for(let M=0,_=T.length;M<_;M++){const R=T[M];if(p(R,C,M,w)===!0){const L=R.__offset,z=Array.isArray(R.value)?R.value:[R.value];let G=0;for(let $=0;$<z.length;$++){const H=z[$],q=v(H);typeof H=="number"||typeof H=="boolean"?(R.__data[0]=H,t.bufferSubData(t.UNIFORM_BUFFER,L+G,R.__data)):H.isMatrix3?(R.__data[0]=H.elements[0],R.__data[1]=H.elements[1],R.__data[2]=H.elements[2],R.__data[3]=0,R.__data[4]=H.elements[3],R.__data[5]=H.elements[4],R.__data[6]=H.elements[5],R.__data[7]=0,R.__data[8]=H.elements[6],R.__data[9]=H.elements[7],R.__data[10]=H.elements[8],R.__data[11]=0):(H.toArray(R.__data,G),G+=q.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,L,R.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function p(y,S,x,w){const C=y.value,E=S+"_"+x;if(w[E]===void 0)return typeof C=="number"||typeof C=="boolean"?w[E]=C:w[E]=C.clone(),!0;{const T=w[E];if(typeof C=="number"||typeof C=="boolean"){if(T!==C)return w[E]=C,!0}else if(T.equals(C)===!1)return T.copy(C),!0}return!1}function f(y){const S=y.uniforms;let x=0;const w=16;for(let E=0,T=S.length;E<T;E++){const M=Array.isArray(S[E])?S[E]:[S[E]];for(let _=0,R=M.length;_<R;_++){const L=M[_],z=Array.isArray(L.value)?L.value:[L.value];for(let G=0,$=z.length;G<$;G++){const H=z[G],q=v(H),D=x%w,Z=D%q.boundary,P=D+Z;x+=Z,P!==0&&w-P<q.storage&&(x+=w-P),L.__data=new Float32Array(q.storage/Float32Array.BYTES_PER_ELEMENT),L.__offset=x,x+=q.storage}}}const C=x%w;return C>0&&(x+=w-C),y.__size=x,y.__cache={},this}function v(y){const S={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(S.boundary=4,S.storage=4):y.isVector2?(S.boundary=8,S.storage=8):y.isVector3||y.isColor?(S.boundary=16,S.storage=12):y.isVector4?(S.boundary=16,S.storage=16):y.isMatrix3?(S.boundary=48,S.storage=48):y.isMatrix4?(S.boundary=64,S.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),S}function g(y){const S=y.target;S.removeEventListener("dispose",g);const x=o.indexOf(S.__bindingPointIndex);o.splice(x,1),t.deleteBuffer(r[S.id]),delete r[S.id],delete s[S.id]}function m(){for(const y in r)t.deleteBuffer(r[y]);o=[],r={},s={}}return{bind:l,update:c,dispose:m}}class Hne{constructor(e={}){const{canvas:n=PJ(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let d;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=i.getContextAttributes().alpha}else d=o;const p=new Uint32Array(4),f=new Int32Array(4);let v=null,g=null;const m=[],y=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=on,this.toneMapping=Kl,this.toneMappingExposure=1;const S=this;let x=!1,w=0,C=0,E=null,T=-1,M=null;const _=new Wt,R=new Wt;let L=null;const z=new Ge(0);let G=0,$=n.width,H=n.height,q=1,D=null,Z=null;const P=new Wt(0,0,$,H),le=new Wt(0,0,$,H);let Se=!1;const k=new G2;let J=!1,oe=!1;const pe=new je,ye=new je,nt=new N,Je=new Wt,_t={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let at=!1;function yt(){return E===null?q:1}let U=i;function di(A,F){return n.getContext(A,F)}try{const A={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${L2}`),n.addEventListener("webglcontextlost",ce,!1),n.addEventListener("webglcontextrestored",Me,!1),n.addEventListener("webglcontextcreationerror",Le,!1),U===null){const F="webgl2";if(U=di(F,A),U===null)throw di(F)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(A){throw console.error("THREE.WebGLRenderer: "+A.message),A}let St,Mt,ct,Zt,dt,I,b,Y,ie,de,ae,V,K,re,Ie,se,xe,Te,Qe,Ae,wt,Ze,Dt,B;function ke(){St=new qee(U),St.init(),Ze=new kne(U,St),Mt=new $ee(U,St,e,Ze),ct=new Pne(U),Mt.reverseDepthBuffer&&ct.buffers.depth.setReversed(!0),Zt=new Yee(U),dt=new fne,I=new Mne(U,St,ct,dt,Mt,Ze,Zt),b=new Vee(S),Y=new Gee(S),ie=new iQ(U),Dt=new Uee(U,ie),de=new Xee(U,ie,Zt,Dt),ae=new Qee(U,de,ie,Zt),Qe=new Jee(U,Mt,I),se=new Hee(dt),V=new pne(S,b,Y,St,Mt,Dt,se),K=new Bne(S,dt),re=new gne,Ie=new _ne(St),Te=new zee(S,b,Y,ct,ae,d,l),xe=new bne(S,ae,Mt),B=new $ne(U,Zt,Mt,ct),Ae=new Bee(U,St,Zt),wt=new Kee(U,St,Zt),Zt.programs=V.programs,S.capabilities=Mt,S.extensions=St,S.properties=dt,S.renderLists=re,S.shadowMap=xe,S.state=ct,S.info=Zt}ke();const ne=new zne(S,U);this.xr=ne,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const A=St.get("WEBGL_lose_context");A&&A.loseContext()},this.forceContextRestore=function(){const A=St.get("WEBGL_lose_context");A&&A.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(A){A!==void 0&&(q=A,this.setSize($,H,!1))},this.getSize=function(A){return A.set($,H)},this.setSize=function(A,F,X=!0){if(ne.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}$=A,H=F,n.width=Math.floor(A*q),n.height=Math.floor(F*q),X===!0&&(n.style.width=A+"px",n.style.height=F+"px"),this.setViewport(0,0,A,F)},this.getDrawingBufferSize=function(A){return A.set($*q,H*q).floor()},this.setDrawingBufferSize=function(A,F,X){$=A,H=F,q=X,n.width=Math.floor(A*X),n.height=Math.floor(F*X),this.setViewport(0,0,A,F)},this.getCurrentViewport=function(A){return A.copy(_)},this.getViewport=function(A){return A.copy(P)},this.setViewport=function(A,F,X,ee){A.isVector4?P.set(A.x,A.y,A.z,A.w):P.set(A,F,X,ee),ct.viewport(_.copy(P).multiplyScalar(q).round())},this.getScissor=function(A){return A.copy(le)},this.setScissor=function(A,F,X,ee){A.isVector4?le.set(A.x,A.y,A.z,A.w):le.set(A,F,X,ee),ct.scissor(R.copy(le).multiplyScalar(q).round())},this.getScissorTest=function(){return Se},this.setScissorTest=function(A){ct.setScissorTest(Se=A)},this.setOpaqueSort=function(A){D=A},this.setTransparentSort=function(A){Z=A},this.getClearColor=function(A){return A.copy(Te.getClearColor())},this.setClearColor=function(){Te.setClearColor.apply(Te,arguments)},this.getClearAlpha=function(){return Te.getClearAlpha()},this.setClearAlpha=function(){Te.setClearAlpha.apply(Te,arguments)},this.clear=function(A=!0,F=!0,X=!0){let ee=0;if(A){let j=!1;if(E!==null){const fe=E.texture.format;j=fe===B2||fe===U2||fe===z2}if(j){const fe=E.texture.type,_e=fe===Ya||fe===Iu||fe===Xg||fe===Nd||fe===N2||fe===O2,$e=Te.getClearColor(),He=Te.getClearAlpha(),ot=$e.r,pt=$e.g,Ke=$e.b;_e?(p[0]=ot,p[1]=pt,p[2]=Ke,p[3]=He,U.clearBufferuiv(U.COLOR,0,p)):(f[0]=ot,f[1]=pt,f[2]=Ke,f[3]=He,U.clearBufferiv(U.COLOR,0,f))}else ee|=U.COLOR_BUFFER_BIT}F&&(ee|=U.DEPTH_BUFFER_BIT,U.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),X&&(ee|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(ee)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",ce,!1),n.removeEventListener("webglcontextrestored",Me,!1),n.removeEventListener("webglcontextcreationerror",Le,!1),re.dispose(),Ie.dispose(),dt.dispose(),b.dispose(),Y.dispose(),ae.dispose(),Dt.dispose(),B.dispose(),V.dispose(),ne.dispose(),ne.removeEventListener("sessionstart",O),ne.removeEventListener("sessionend",W),te.stop()};function ce(A){A.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Me(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const A=Zt.autoReset,F=xe.enabled,X=xe.autoUpdate,ee=xe.needsUpdate,j=xe.type;ke(),Zt.autoReset=A,xe.enabled=F,xe.autoUpdate=X,xe.needsUpdate=ee,xe.type=j}function Le(A){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",A.statusMessage)}function Ft(A){const F=A.target;F.removeEventListener("dispose",Ft),bn(F)}function bn(A){Qn(A),dt.remove(A)}function Qn(A){const F=dt.get(A).programs;F!==void 0&&(F.forEach(function(X){V.releaseProgram(X)}),A.isShaderMaterial&&V.releaseShaderCache(A))}this.renderBufferDirect=function(A,F,X,ee,j,fe){F===null&&(F=_t);const _e=j.isMesh&&j.matrixWorld.determinant()<0,$e=Ot(A,F,X,ee,j);ct.setMaterial(ee,_e);let He=X.index,ot=1;if(ee.wireframe===!0){if(He=de.getWireframeAttribute(X),He===void 0)return;ot=2}const pt=X.drawRange,Ke=X.attributes.position;let qe=pt.start*ot,gt=(pt.start+pt.count)*ot;fe!==null&&(qe=Math.max(qe,fe.start*ot),gt=Math.min(gt,(fe.start+fe.count)*ot)),He!==null?(qe=Math.max(qe,0),gt=Math.min(gt,He.count)):Ke!=null&&(qe=Math.max(qe,0),gt=Math.min(gt,Ke.count));const rn=gt-qe;if(rn<0||rn===1/0)return;Dt.setup(j,ee,$e,X,He);let fi,ft=Ae;if(He!==null&&(fi=ie.get(He),ft=wt,ft.setIndex(fi)),j.isMesh)ee.wireframe===!0?(ct.setLineWidth(ee.wireframeLinewidth*yt()),ft.setMode(U.LINES)):ft.setMode(U.TRIANGLES);else if(j.isLine){let Xe=ee.linewidth;Xe===void 0&&(Xe=1),ct.setLineWidth(Xe*yt()),j.isLineSegments?ft.setMode(U.LINES):j.isLineLoop?ft.setMode(U.LINE_LOOP):ft.setMode(U.LINE_STRIP)}else j.isPoints?ft.setMode(U.POINTS):j.isSprite&&ft.setMode(U.TRIANGLES);if(j.isBatchedMesh)if(j._multiDrawInstances!==null)ft.renderMultiDrawInstances(j._multiDrawStarts,j._multiDrawCounts,j._multiDrawCount,j._multiDrawInstances);else if(St.get("WEBGL_multi_draw"))ft.renderMultiDraw(j._multiDrawStarts,j._multiDrawCounts,j._multiDrawCount);else{const Xe=j._multiDrawStarts,si=j._multiDrawCounts,en=j._multiDrawCount,oo=He?ie.get(He).bytesPerElement:1,ah=dt.get(ee).currentProgram.getUniforms();for(let es=0;es<en;es++)ah.setValue(U,"_gl_DrawID",es),ft.render(Xe[es]/oo,si[es])}else if(j.isInstancedMesh)ft.renderInstances(qe,rn,j.count);else if(X.isInstancedBufferGeometry){const Xe=X._maxInstanceCount!==void 0?X._maxInstanceCount:1/0,si=Math.min(X.instanceCount,Xe);ft.renderInstances(qe,rn,si)}else ft.render(qe,rn)};function Nt(A,F,X){A.transparent===!0&&A.side===Zo&&A.forceSinglePass===!1?(A.side=Tr,A.needsUpdate=!0,Oe(A,F,X),A.side=Ka,A.needsUpdate=!0,Oe(A,F,X),A.side=Zo):Oe(A,F,X)}this.compile=function(A,F,X=null){X===null&&(X=A),g=Ie.get(X),g.init(F),y.push(g),X.traverseVisible(function(j){j.isLight&&j.layers.test(F.layers)&&(g.pushLight(j),j.castShadow&&g.pushShadow(j))}),A!==X&&A.traverseVisible(function(j){j.isLight&&j.layers.test(F.layers)&&(g.pushLight(j),j.castShadow&&g.pushShadow(j))}),g.setupLights();const ee=new Set;return A.traverse(function(j){if(!(j.isMesh||j.isPoints||j.isLine||j.isSprite))return;const fe=j.material;if(fe)if(Array.isArray(fe))for(let _e=0;_e<fe.length;_e++){const $e=fe[_e];Nt($e,X,j),ee.add($e)}else Nt(fe,X,j),ee.add(fe)}),y.pop(),g=null,ee},this.compileAsync=function(A,F,X=null){const ee=this.compile(A,F,X);return new Promise(j=>{function fe(){if(ee.forEach(function(_e){dt.get(_e).currentProgram.isReady()&&ee.delete(_e)}),ee.size===0){j(A);return}setTimeout(fe,10)}St.get("KHR_parallel_shader_compile")!==null?fe():setTimeout(fe,10)})};let Ti=null;function Zr(A){Ti&&Ti(A)}function O(){te.stop()}function W(){te.start()}const te=new KB;te.setAnimationLoop(Zr),typeof self<"u"&&te.setContext(self),this.setAnimationLoop=function(A){Ti=A,ne.setAnimationLoop(A),A===null?te.stop():te.start()},ne.addEventListener("sessionstart",O),ne.addEventListener("sessionend",W),this.render=function(A,F){if(F!==void 0&&F.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(x===!0)return;if(A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),F.parent===null&&F.matrixWorldAutoUpdate===!0&&F.updateMatrixWorld(),ne.enabled===!0&&ne.isPresenting===!0&&(ne.cameraAutoUpdate===!0&&ne.updateCamera(F),F=ne.getCamera()),A.isScene===!0&&A.onBeforeRender(S,A,F,E),g=Ie.get(A,y.length),g.init(F),y.push(g),ye.multiplyMatrices(F.projectionMatrix,F.matrixWorldInverse),k.setFromProjectionMatrix(ye),oe=this.localClippingEnabled,J=se.init(this.clippingPlanes,oe),v=re.get(A,m.length),v.init(),m.push(v),ne.enabled===!0&&ne.isPresenting===!0){const fe=S.xr.getDepthSensingMesh();fe!==null&&ue(fe,F,-1/0,S.sortObjects)}ue(A,F,0,S.sortObjects),v.finish(),S.sortObjects===!0&&v.sort(D,Z),at=ne.enabled===!1||ne.isPresenting===!1||ne.hasDepthSensing()===!1,at&&Te.addToRenderList(v,A),this.info.render.frame++,J===!0&&se.beginShadows();const X=g.state.shadowsArray;xe.render(X,A,F),J===!0&&se.endShadows(),this.info.autoReset===!0&&this.info.reset();const ee=v.opaque,j=v.transmissive;if(g.setupLights(),F.isArrayCamera){const fe=F.cameras;if(j.length>0)for(let _e=0,$e=fe.length;_e<$e;_e++){const He=fe[_e];et(ee,j,A,He)}at&&Te.render(A);for(let _e=0,$e=fe.length;_e<$e;_e++){const He=fe[_e];De(v,A,He,He.viewport)}}else j.length>0&&et(ee,j,A,F),at&&Te.render(A),De(v,A,F);E!==null&&(I.updateMultisampleRenderTarget(E),I.updateRenderTargetMipmap(E)),A.isScene===!0&&A.onAfterRender(S,A,F),Dt.resetDefaultState(),T=-1,M=null,y.pop(),y.length>0?(g=y[y.length-1],J===!0&&se.setGlobalState(S.clippingPlanes,g.state.camera)):g=null,m.pop(),m.length>0?v=m[m.length-1]:v=null};function ue(A,F,X,ee){if(A.visible===!1)return;if(A.layers.test(F.layers)){if(A.isGroup)X=A.renderOrder;else if(A.isLOD)A.autoUpdate===!0&&A.update(F);else if(A.isLight)g.pushLight(A),A.castShadow&&g.pushShadow(A);else if(A.isSprite){if(!A.frustumCulled||k.intersectsSprite(A)){ee&&Je.setFromMatrixPosition(A.matrixWorld).applyMatrix4(ye);const _e=ae.update(A),$e=A.material;$e.visible&&v.push(A,_e,$e,X,Je.z,null)}}else if((A.isMesh||A.isLine||A.isPoints)&&(!A.frustumCulled||k.intersectsObject(A))){const _e=ae.update(A),$e=A.material;if(ee&&(A.boundingSphere!==void 0?(A.boundingSphere===null&&A.computeBoundingSphere(),Je.copy(A.boundingSphere.center)):(_e.boundingSphere===null&&_e.computeBoundingSphere(),Je.copy(_e.boundingSphere.center)),Je.applyMatrix4(A.matrixWorld).applyMatrix4(ye)),Array.isArray($e)){const He=_e.groups;for(let ot=0,pt=He.length;ot<pt;ot++){const Ke=He[ot],qe=$e[Ke.materialIndex];qe&&qe.visible&&v.push(A,_e,qe,X,Je.z,Ke)}}else $e.visible&&v.push(A,_e,$e,X,Je.z,null)}}const fe=A.children;for(let _e=0,$e=fe.length;_e<$e;_e++)ue(fe[_e],F,X,ee)}function De(A,F,X,ee){const j=A.opaque,fe=A.transmissive,_e=A.transparent;g.setupLightsView(X),J===!0&&se.setGlobalState(S.clippingPlanes,X),ee&&ct.viewport(_.copy(ee)),j.length>0&&ut(j,F,X),fe.length>0&&ut(fe,F,X),_e.length>0&&ut(_e,F,X),ct.buffers.depth.setTest(!0),ct.buffers.depth.setMask(!0),ct.buffers.color.setMask(!0),ct.setPolygonOffset(!1)}function et(A,F,X,ee){if((X.isScene===!0?X.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[ee.id]===void 0&&(g.state.transmissionRenderTarget[ee.id]=new Mu(1,1,{generateMipmaps:!0,type:St.has("EXT_color_buffer_half_float")||St.has("EXT_color_buffer_float")?L0:Ya,minFilter:za,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Pt.workingColorSpace}));const fe=g.state.transmissionRenderTarget[ee.id],_e=ee.viewport||_;fe.setSize(_e.z,_e.w);const $e=S.getRenderTarget();S.setRenderTarget(fe),S.getClearColor(z),G=S.getClearAlpha(),G<1&&S.setClearColor(16777215,.5),S.clear(),at&&Te.render(X);const He=S.toneMapping;S.toneMapping=Kl;const ot=ee.viewport;if(ee.viewport!==void 0&&(ee.viewport=void 0),g.setupLightsView(ee),J===!0&&se.setGlobalState(S.clippingPlanes,ee),ut(A,X,ee),I.updateMultisampleRenderTarget(fe),I.updateRenderTargetMipmap(fe),St.has("WEBGL_multisampled_render_to_texture")===!1){let pt=!1;for(let Ke=0,qe=F.length;Ke<qe;Ke++){const gt=F[Ke],rn=gt.object,fi=gt.geometry,ft=gt.material,Xe=gt.group;if(ft.side===Zo&&rn.layers.test(ee.layers)){const si=ft.side;ft.side=Tr,ft.needsUpdate=!0,Fe(rn,X,ee,fi,ft,Xe),ft.side=si,ft.needsUpdate=!0,pt=!0}}pt===!0&&(I.updateMultisampleRenderTarget(fe),I.updateRenderTargetMipmap(fe))}S.setRenderTarget($e),S.setClearColor(z,G),ot!==void 0&&(ee.viewport=ot),S.toneMapping=He}function ut(A,F,X){const ee=F.isScene===!0?F.overrideMaterial:null;for(let j=0,fe=A.length;j<fe;j++){const _e=A[j],$e=_e.object,He=_e.geometry,ot=ee===null?_e.material:ee,pt=_e.group;$e.layers.test(X.layers)&&Fe($e,F,X,He,ot,pt)}}function Fe(A,F,X,ee,j,fe){A.onBeforeRender(S,F,X,ee,j,fe),A.modelViewMatrix.multiplyMatrices(X.matrixWorldInverse,A.matrixWorld),A.normalMatrix.getNormalMatrix(A.modelViewMatrix),j.onBeforeRender(S,F,X,ee,A,fe),j.transparent===!0&&j.side===Zo&&j.forceSinglePass===!1?(j.side=Tr,j.needsUpdate=!0,S.renderBufferDirect(X,F,ee,j,A,fe),j.side=Ka,j.needsUpdate=!0,S.renderBufferDirect(X,F,ee,j,A,fe),j.side=Zo):S.renderBufferDirect(X,F,ee,j,A,fe),A.onAfterRender(S,F,X,ee,j,fe)}function Oe(A,F,X){F.isScene!==!0&&(F=_t);const ee=dt.get(A),j=g.state.lights,fe=g.state.shadowsArray,_e=j.state.version,$e=V.getParameters(A,j.state,fe,F,X),He=V.getProgramCacheKey($e);let ot=ee.programs;ee.environment=A.isMeshStandardMaterial?F.environment:null,ee.fog=F.fog,ee.envMap=(A.isMeshStandardMaterial?Y:b).get(A.envMap||ee.environment),ee.envMapRotation=ee.environment!==null&&A.envMap===null?F.environmentRotation:A.envMapRotation,ot===void 0&&(A.addEventListener("dispose",Ft),ot=new Map,ee.programs=ot);let pt=ot.get(He);if(pt!==void 0){if(ee.currentProgram===pt&&ee.lightsStateVersion===_e)return it(A,$e),pt}else $e.uniforms=V.getUniforms(A),A.onBeforeCompile($e,S),pt=V.acquireProgram($e,He),ot.set(He,pt),ee.uniforms=$e.uniforms;const Ke=ee.uniforms;return(!A.isShaderMaterial&&!A.isRawShaderMaterial||A.clipping===!0)&&(Ke.clippingPlanes=se.uniform),it(A,$e),ee.needsLights=pi(A),ee.lightsStateVersion=_e,ee.needsLights&&(Ke.ambientLightColor.value=j.state.ambient,Ke.lightProbe.value=j.state.probe,Ke.directionalLights.value=j.state.directional,Ke.directionalLightShadows.value=j.state.directionalShadow,Ke.spotLights.value=j.state.spot,Ke.spotLightShadows.value=j.state.spotShadow,Ke.rectAreaLights.value=j.state.rectArea,Ke.ltc_1.value=j.state.rectAreaLTC1,Ke.ltc_2.value=j.state.rectAreaLTC2,Ke.pointLights.value=j.state.point,Ke.pointLightShadows.value=j.state.pointShadow,Ke.hemisphereLights.value=j.state.hemi,Ke.directionalShadowMap.value=j.state.directionalShadowMap,Ke.directionalShadowMatrix.value=j.state.directionalShadowMatrix,Ke.spotShadowMap.value=j.state.spotShadowMap,Ke.spotLightMatrix.value=j.state.spotLightMatrix,Ke.spotLightMap.value=j.state.spotLightMap,Ke.pointShadowMap.value=j.state.pointShadowMap,Ke.pointShadowMatrix.value=j.state.pointShadowMatrix),ee.currentProgram=pt,ee.uniformsList=null,pt}function Ne(A){if(A.uniformsList===null){const F=A.currentProgram.getUniforms();A.uniformsList=zy.seqWithValue(F.seq,A.uniforms)}return A.uniformsList}function it(A,F){const X=dt.get(A);X.outputColorSpace=F.outputColorSpace,X.batching=F.batching,X.batchingColor=F.batchingColor,X.instancing=F.instancing,X.instancingColor=F.instancingColor,X.instancingMorph=F.instancingMorph,X.skinning=F.skinning,X.morphTargets=F.morphTargets,X.morphNormals=F.morphNormals,X.morphColors=F.morphColors,X.morphTargetsCount=F.morphTargetsCount,X.numClippingPlanes=F.numClippingPlanes,X.numIntersection=F.numClipIntersection,X.vertexAlphas=F.vertexAlphas,X.vertexTangents=F.vertexTangents,X.toneMapping=F.toneMapping}function Ot(A,F,X,ee,j){F.isScene!==!0&&(F=_t),I.resetTextureUnits();const fe=F.fog,_e=ee.isMeshStandardMaterial?F.environment:null,$e=E===null?S.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:qi,He=(ee.isMeshStandardMaterial?Y:b).get(ee.envMap||_e),ot=ee.vertexColors===!0&&!!X.attributes.color&&X.attributes.color.itemSize===4,pt=!!X.attributes.tangent&&(!!ee.normalMap||ee.anisotropy>0),Ke=!!X.morphAttributes.position,qe=!!X.morphAttributes.normal,gt=!!X.morphAttributes.color;let rn=Kl;ee.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(rn=S.toneMapping);const fi=X.morphAttributes.position||X.morphAttributes.normal||X.morphAttributes.color,ft=fi!==void 0?fi.length:0,Xe=dt.get(ee),si=g.state.lights;if(J===!0&&(oe===!0||A!==M)){const bs=A===M&&ee.id===T;se.setState(ee,A,bs)}let en=!1;ee.version===Xe.__version?(Xe.needsLights&&Xe.lightsStateVersion!==si.state.version||Xe.outputColorSpace!==$e||j.isBatchedMesh&&Xe.batching===!1||!j.isBatchedMesh&&Xe.batching===!0||j.isBatchedMesh&&Xe.batchingColor===!0&&j.colorTexture===null||j.isBatchedMesh&&Xe.batchingColor===!1&&j.colorTexture!==null||j.isInstancedMesh&&Xe.instancing===!1||!j.isInstancedMesh&&Xe.instancing===!0||j.isSkinnedMesh&&Xe.skinning===!1||!j.isSkinnedMesh&&Xe.skinning===!0||j.isInstancedMesh&&Xe.instancingColor===!0&&j.instanceColor===null||j.isInstancedMesh&&Xe.instancingColor===!1&&j.instanceColor!==null||j.isInstancedMesh&&Xe.instancingMorph===!0&&j.morphTexture===null||j.isInstancedMesh&&Xe.instancingMorph===!1&&j.morphTexture!==null||Xe.envMap!==He||ee.fog===!0&&Xe.fog!==fe||Xe.numClippingPlanes!==void 0&&(Xe.numClippingPlanes!==se.numPlanes||Xe.numIntersection!==se.numIntersection)||Xe.vertexAlphas!==ot||Xe.vertexTangents!==pt||Xe.morphTargets!==Ke||Xe.morphNormals!==qe||Xe.morphColors!==gt||Xe.toneMapping!==rn||Xe.morphTargetsCount!==ft)&&(en=!0):(en=!0,Xe.__version=ee.version);let oo=Xe.currentProgram;en===!0&&(oo=Oe(ee,F,j));let ah=!1,es=!1,WC=!1;const Zn=oo.getUniforms(),ol=Xe.uniforms;if(ct.useProgram(oo.program)&&(ah=!0,es=!0,WC=!0),ee.id!==T&&(T=ee.id,es=!0),ah||M!==A){Mt.reverseDepthBuffer?(pe.copy(A.projectionMatrix),MJ(pe),kJ(pe),Zn.setValue(U,"projectionMatrix",pe)):Zn.setValue(U,"projectionMatrix",A.projectionMatrix),Zn.setValue(U,"viewMatrix",A.matrixWorldInverse);const bs=Zn.map.cameraPosition;bs!==void 0&&bs.setValue(U,nt.setFromMatrixPosition(A.matrixWorld)),Mt.logarithmicDepthBuffer&&Zn.setValue(U,"logDepthBufFC",2/(Math.log(A.far+1)/Math.LN2)),(ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshLambertMaterial||ee.isMeshBasicMaterial||ee.isMeshStandardMaterial||ee.isShaderMaterial)&&Zn.setValue(U,"isOrthographic",A.isOrthographicCamera===!0),M!==A&&(M=A,es=!0,WC=!0)}if(j.isSkinnedMesh){Zn.setOptional(U,j,"bindMatrix"),Zn.setOptional(U,j,"bindMatrixInverse");const bs=j.skeleton;bs&&(bs.boneTexture===null&&bs.computeBoneTexture(),Zn.setValue(U,"boneTexture",bs.boneTexture,I))}j.isBatchedMesh&&(Zn.setOptional(U,j,"batchingTexture"),Zn.setValue(U,"batchingTexture",j._matricesTexture,I),Zn.setOptional(U,j,"batchingIdTexture"),Zn.setValue(U,"batchingIdTexture",j._indirectTexture,I),Zn.setOptional(U,j,"batchingColorTexture"),j._colorsTexture!==null&&Zn.setValue(U,"batchingColorTexture",j._colorsTexture,I));const GC=X.morphAttributes;if((GC.position!==void 0||GC.normal!==void 0||GC.color!==void 0)&&Qe.update(j,X,oo),(es||Xe.receiveShadow!==j.receiveShadow)&&(Xe.receiveShadow=j.receiveShadow,Zn.setValue(U,"receiveShadow",j.receiveShadow)),ee.isMeshGouraudMaterial&&ee.envMap!==null&&(ol.envMap.value=He,ol.flipEnvMap.value=He.isCubeTexture&&He.isRenderTargetTexture===!1?-1:1),ee.isMeshStandardMaterial&&ee.envMap===null&&F.environment!==null&&(ol.envMapIntensity.value=F.environmentIntensity),es&&(Zn.setValue(U,"toneMappingExposure",S.toneMappingExposure),Xe.needsLights&&Vt(ol,WC),fe&&ee.fog===!0&&K.refreshFogUniforms(ol,fe),K.refreshMaterialUniforms(ol,ee,q,H,g.state.transmissionRenderTarget[A.id]),zy.upload(U,Ne(Xe),ol,I)),ee.isShaderMaterial&&ee.uniformsNeedUpdate===!0&&(zy.upload(U,Ne(Xe),ol,I),ee.uniformsNeedUpdate=!1),ee.isSpriteMaterial&&Zn.setValue(U,"center",j.center),Zn.setValue(U,"modelViewMatrix",j.modelViewMatrix),Zn.setValue(U,"normalMatrix",j.normalMatrix),Zn.setValue(U,"modelMatrix",j.matrixWorld),ee.isShaderMaterial||ee.isRawShaderMaterial){const bs=ee.uniformsGroups;for(let qC=0,m7=bs.length;qC<m7;qC++){const rI=bs[qC];B.update(rI,oo),B.bind(rI,oo)}}return oo}function Vt(A,F){A.ambientLightColor.needsUpdate=F,A.lightProbe.needsUpdate=F,A.directionalLights.needsUpdate=F,A.directionalLightShadows.needsUpdate=F,A.pointLights.needsUpdate=F,A.pointLightShadows.needsUpdate=F,A.spotLights.needsUpdate=F,A.spotLightShadows.needsUpdate=F,A.rectAreaLights.needsUpdate=F,A.hemisphereLights.needsUpdate=F}function pi(A){return A.isMeshLambertMaterial||A.isMeshToonMaterial||A.isMeshPhongMaterial||A.isMeshStandardMaterial||A.isShadowMaterial||A.isShaderMaterial&&A.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(A,F,X){dt.get(A.texture).__webglTexture=F,dt.get(A.depthTexture).__webglTexture=X;const ee=dt.get(A);ee.__hasExternalTextures=!0,ee.__autoAllocateDepthBuffer=X===void 0,ee.__autoAllocateDepthBuffer||St.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ee.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(A,F){const X=dt.get(A);X.__webglFramebuffer=F,X.__useDefaultFramebuffer=F===void 0},this.setRenderTarget=function(A,F=0,X=0){E=A,w=F,C=X;let ee=!0,j=null,fe=!1,_e=!1;if(A){const He=dt.get(A);if(He.__useDefaultFramebuffer!==void 0)ct.bindFramebuffer(U.FRAMEBUFFER,null),ee=!1;else if(He.__webglFramebuffer===void 0)I.setupRenderTarget(A);else if(He.__hasExternalTextures)I.rebindTextures(A,dt.get(A.texture).__webglTexture,dt.get(A.depthTexture).__webglTexture);else if(A.depthBuffer){const Ke=A.depthTexture;if(He.__boundDepthTexture!==Ke){if(Ke!==null&&dt.has(Ke)&&(A.width!==Ke.image.width||A.height!==Ke.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");I.setupDepthRenderbuffer(A)}}const ot=A.texture;(ot.isData3DTexture||ot.isDataArrayTexture||ot.isCompressedArrayTexture)&&(_e=!0);const pt=dt.get(A).__webglFramebuffer;A.isWebGLCubeRenderTarget?(Array.isArray(pt[F])?j=pt[F][X]:j=pt[F],fe=!0):A.samples>0&&I.useMultisampledRTT(A)===!1?j=dt.get(A).__webglMultisampledFramebuffer:Array.isArray(pt)?j=pt[X]:j=pt,_.copy(A.viewport),R.copy(A.scissor),L=A.scissorTest}else _.copy(P).multiplyScalar(q).floor(),R.copy(le).multiplyScalar(q).floor(),L=Se;if(ct.bindFramebuffer(U.FRAMEBUFFER,j)&&ee&&ct.drawBuffers(A,j),ct.viewport(_),ct.scissor(R),ct.setScissorTest(L),fe){const He=dt.get(A.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+F,He.__webglTexture,X)}else if(_e){const He=dt.get(A.texture),ot=F||0;U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,He.__webglTexture,X||0,ot)}T=-1},this.readRenderTargetPixels=function(A,F,X,ee,j,fe,_e){if(!(A&&A.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let $e=dt.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&_e!==void 0&&($e=$e[_e]),$e){ct.bindFramebuffer(U.FRAMEBUFFER,$e);try{const He=A.texture,ot=He.format,pt=He.type;if(!Mt.textureFormatReadable(ot)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Mt.textureTypeReadable(pt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}F>=0&&F<=A.width-ee&&X>=0&&X<=A.height-j&&U.readPixels(F,X,ee,j,Ze.convert(ot),Ze.convert(pt),fe)}finally{const He=E!==null?dt.get(E).__webglFramebuffer:null;ct.bindFramebuffer(U.FRAMEBUFFER,He)}}},this.readRenderTargetPixelsAsync=async function(A,F,X,ee,j,fe,_e){if(!(A&&A.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let $e=dt.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&_e!==void 0&&($e=$e[_e]),$e){const He=A.texture,ot=He.format,pt=He.type;if(!Mt.textureFormatReadable(ot))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Mt.textureTypeReadable(pt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(F>=0&&F<=A.width-ee&&X>=0&&X<=A.height-j){ct.bindFramebuffer(U.FRAMEBUFFER,$e);const Ke=U.createBuffer();U.bindBuffer(U.PIXEL_PACK_BUFFER,Ke),U.bufferData(U.PIXEL_PACK_BUFFER,fe.byteLength,U.STREAM_READ),U.readPixels(F,X,ee,j,Ze.convert(ot),Ze.convert(pt),0);const qe=E!==null?dt.get(E).__webglFramebuffer:null;ct.bindFramebuffer(U.FRAMEBUFFER,qe);const gt=U.fenceSync(U.SYNC_GPU_COMMANDS_COMPLETE,0);return U.flush(),await IJ(U,gt,4),U.bindBuffer(U.PIXEL_PACK_BUFFER,Ke),U.getBufferSubData(U.PIXEL_PACK_BUFFER,0,fe),U.deleteBuffer(Ke),U.deleteSync(gt),fe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(A,F=null,X=0){A.isTexture!==!0&&(Fy("WebGLRenderer: copyFramebufferToTexture function signature has changed."),F=arguments[0]||null,A=arguments[1]);const ee=Math.pow(2,-X),j=Math.floor(A.image.width*ee),fe=Math.floor(A.image.height*ee),_e=F!==null?F.x:0,$e=F!==null?F.y:0;I.setTexture2D(A,0),U.copyTexSubImage2D(U.TEXTURE_2D,X,0,0,_e,$e,j,fe),ct.unbindTexture()},this.copyTextureToTexture=function(A,F,X=null,ee=null,j=0){A.isTexture!==!0&&(Fy("WebGLRenderer: copyTextureToTexture function signature has changed."),ee=arguments[0]||null,A=arguments[1],F=arguments[2],j=arguments[3]||0,X=null);let fe,_e,$e,He,ot,pt;X!==null?(fe=X.max.x-X.min.x,_e=X.max.y-X.min.y,$e=X.min.x,He=X.min.y):(fe=A.image.width,_e=A.image.height,$e=0,He=0),ee!==null?(ot=ee.x,pt=ee.y):(ot=0,pt=0);const Ke=Ze.convert(F.format),qe=Ze.convert(F.type);I.setTexture2D(F,0),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,F.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,F.unpackAlignment);const gt=U.getParameter(U.UNPACK_ROW_LENGTH),rn=U.getParameter(U.UNPACK_IMAGE_HEIGHT),fi=U.getParameter(U.UNPACK_SKIP_PIXELS),ft=U.getParameter(U.UNPACK_SKIP_ROWS),Xe=U.getParameter(U.UNPACK_SKIP_IMAGES),si=A.isCompressedTexture?A.mipmaps[j]:A.image;U.pixelStorei(U.UNPACK_ROW_LENGTH,si.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,si.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,$e),U.pixelStorei(U.UNPACK_SKIP_ROWS,He),A.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,j,ot,pt,fe,_e,Ke,qe,si.data):A.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,j,ot,pt,si.width,si.height,Ke,si.data):U.texSubImage2D(U.TEXTURE_2D,j,ot,pt,fe,_e,Ke,qe,si),U.pixelStorei(U.UNPACK_ROW_LENGTH,gt),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,rn),U.pixelStorei(U.UNPACK_SKIP_PIXELS,fi),U.pixelStorei(U.UNPACK_SKIP_ROWS,ft),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Xe),j===0&&F.generateMipmaps&&U.generateMipmap(U.TEXTURE_2D),ct.unbindTexture()},this.copyTextureToTexture3D=function(A,F,X=null,ee=null,j=0){A.isTexture!==!0&&(Fy("WebGLRenderer: copyTextureToTexture3D function signature has changed."),X=arguments[0]||null,ee=arguments[1]||null,A=arguments[2],F=arguments[3],j=arguments[4]||0);let fe,_e,$e,He,ot,pt,Ke,qe,gt;const rn=A.isCompressedTexture?A.mipmaps[j]:A.image;X!==null?(fe=X.max.x-X.min.x,_e=X.max.y-X.min.y,$e=X.max.z-X.min.z,He=X.min.x,ot=X.min.y,pt=X.min.z):(fe=rn.width,_e=rn.height,$e=rn.depth,He=0,ot=0,pt=0),ee!==null?(Ke=ee.x,qe=ee.y,gt=ee.z):(Ke=0,qe=0,gt=0);const fi=Ze.convert(F.format),ft=Ze.convert(F.type);let Xe;if(F.isData3DTexture)I.setTexture3D(F,0),Xe=U.TEXTURE_3D;else if(F.isDataArrayTexture||F.isCompressedArrayTexture)I.setTexture2DArray(F,0),Xe=U.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,F.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,F.unpackAlignment);const si=U.getParameter(U.UNPACK_ROW_LENGTH),en=U.getParameter(U.UNPACK_IMAGE_HEIGHT),oo=U.getParameter(U.UNPACK_SKIP_PIXELS),ah=U.getParameter(U.UNPACK_SKIP_ROWS),es=U.getParameter(U.UNPACK_SKIP_IMAGES);U.pixelStorei(U.UNPACK_ROW_LENGTH,rn.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,rn.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,He),U.pixelStorei(U.UNPACK_SKIP_ROWS,ot),U.pixelStorei(U.UNPACK_SKIP_IMAGES,pt),A.isDataTexture||A.isData3DTexture?U.texSubImage3D(Xe,j,Ke,qe,gt,fe,_e,$e,fi,ft,rn.data):F.isCompressedArrayTexture?U.compressedTexSubImage3D(Xe,j,Ke,qe,gt,fe,_e,$e,fi,rn.data):U.texSubImage3D(Xe,j,Ke,qe,gt,fe,_e,$e,fi,ft,rn),U.pixelStorei(U.UNPACK_ROW_LENGTH,si),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,en),U.pixelStorei(U.UNPACK_SKIP_PIXELS,oo),U.pixelStorei(U.UNPACK_SKIP_ROWS,ah),U.pixelStorei(U.UNPACK_SKIP_IMAGES,es),j===0&&F.generateMipmaps&&U.generateMipmap(Xe),ct.unbindTexture()},this.initRenderTarget=function(A){dt.get(A).__webglFramebuffer===void 0&&I.setupRenderTarget(A)},this.initTexture=function(A){A.isCubeTexture?I.setTextureCube(A,0):A.isData3DTexture?I.setTexture3D(A,0):A.isDataArrayTexture||A.isCompressedArrayTexture?I.setTexture2DArray(A,0):I.setTexture2D(A,0),ct.unbindTexture()},this.resetState=function(){w=0,C=0,E=null,ct.reset(),Dt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ua}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=e===H2?"display-p3":"srgb",n.unpackColorSpace=Pt.workingColorSpace===Xx?"display-p3":"srgb"}}class t5 extends Sn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new fn,this.environmentIntensity=1,this.environmentRotation=new fn,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class Vne{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=KR,this.updateRanges=[],this.version=0,this.uuid=Ao()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,i){e*=this.stride,i*=n.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=n.array[i+r];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ao()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(n,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ao()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Sr=new N;class K2{constructor(e,n,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,i=this.data.count;n<i;n++)Sr.fromBufferAttribute(this,n),Sr.applyMatrix4(e),this.setXYZ(n,Sr.x,Sr.y,Sr.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)Sr.fromBufferAttribute(this,n),Sr.applyNormalMatrix(e),this.setXYZ(n,Sr.x,Sr.y,Sr.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)Sr.fromBufferAttribute(this,n),Sr.transformDirection(e),this.setXYZ(n,Sr.x,Sr.y,Sr.z);return this}getComponent(e,n){let i=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(i=_o(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=sn(i,this.array)),this.data.array[e*this.data.stride+this.offset+n]=i,this}setX(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=sn(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=_o(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=_o(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=_o(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=_o(n,this.array)),n}setXY(e,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this}setXYZ(e,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,n,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(n=sn(n,this.array),i=sn(i,this.array),r=sn(r,this.array),s=sn(s,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[r+s])}return new br(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new K2(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const NL=new N,OL=new Wt,FL=new Wt,jne=new N,zL=new je,Hv=new N,gw=new da,UL=new je,vw=new lp;class Y2 extends gn{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Wk,this.bindMatrix=new je,this.bindMatrixInverse=new je,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ha),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)this.getVertexPosition(i,Hv),this.boundingBox.expandByPoint(Hv)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new da),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)this.getVertexPosition(i,Hv),this.boundingSphere.expandByPoint(Hv)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),gw.copy(this.boundingSphere),gw.applyMatrix4(r),e.ray.intersectsSphere(gw)!==!1&&(UL.copy(r).invert(),vw.copy(e.ray).applyMatrix4(UL),!(this.boundingBox!==null&&vw.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,vw)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Wt,n=this.geometry.attributes.skinWeight;for(let i=0,r=n.count;i<r;i++){e.fromBufferAttribute(n,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),n.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Wk?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===QY?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const i=this.skeleton,r=this.geometry;OL.fromBufferAttribute(r.attributes.skinIndex,e),FL.fromBufferAttribute(r.attributes.skinWeight,e),NL.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let s=0;s<4;s++){const o=FL.getComponent(s);if(o!==0){const a=OL.getComponent(s);zL.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),n.addScaledVector(jne.copy(NL).applyMatrix4(zL),o)}}return n.applyMatrix4(this.bindMatrixInverse)}}class Qg extends Sn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class n5 extends wi{constructor(e=null,n=1,i=1,r,s,o,a,l,c=Er,u=Er,h,d){super(null,o,a,l,c,u,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:n,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const BL=new je,Wne=new je;class D0{constructor(e=[],n=[]){this.uuid=Ao(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new je)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const i=new je;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,n=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:Wne;BL.multiplyMatrices(a,n[s]),BL.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new D0(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const i=new n5(n,e,e,Bs,Ro);return i.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=i,this}getBoneByName(e){for(let n=0,i=this.bones.length;n<i;n++){const r=this.bones[n];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=n[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new Qg),this.bones.push(o),this.boneInverses.push(new je().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,i=this.boneInverses;for(let r=0,s=n.length;r<s;r++){const o=n[r];e.bones.push(o.uuid);const a=i[r];e.boneInverses.push(a.toArray())}return e}}class QR extends br{constructor(e,n,i,r=1){super(e,n,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Rh=new je,$L=new je,Vv=[],HL=new ha,Gne=new je,km=new gn,Lm=new da;class qne extends gn{constructor(e,n,i){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new QR(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,Gne)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new ha),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,Rh),HL.copy(e.boundingBox).applyMatrix4(Rh),this.boundingBox.union(HL)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new da),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,Rh),Lm.copy(e.boundingSphere).applyMatrix4(Rh),this.boundingSphere.union(Lm)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const i=n.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,o=e*s+1;for(let a=0;a<i.length;a++)i[a]=r[o+a]}raycast(e,n){const i=this.matrixWorld,r=this.count;if(km.geometry=this.geometry,km.material=this.material,km.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Lm.copy(this.boundingSphere),Lm.applyMatrix4(i),e.ray.intersectsSphere(Lm)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Rh),$L.multiplyMatrices(i,Rh),km.matrixWorld=$L,km.raycast(e,Vv);for(let o=0,a=Vv.length;o<a;o++){const l=Vv[o];l.instanceId=s,l.object=this,n.push(l)}Vv.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new QR(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const i=n.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new n5(new Float32Array(r*this.count),r,this.count,F2,Ro));const s=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=r*e;s[l]=a,s.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class J2 extends qs{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ge(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const I1=new N,M1=new N,VL=new je,Dm=new lp,jv=new da,yw=new N,jL=new N;class Jx extends Sn{constructor(e=new ys,n=new J2){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[0];for(let r=1,s=n.count;r<s;r++)I1.fromBufferAttribute(n,r-1),M1.fromBufferAttribute(n,r),i[r]=i[r-1],i[r]+=I1.distanceTo(M1);e.setAttribute("lineDistance",new wr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),jv.copy(i.boundingSphere),jv.applyMatrix4(r),jv.radius+=s,e.ray.intersectsSphere(jv)===!1)return;VL.copy(r).invert(),Dm.copy(e.ray).applyMatrix4(VL);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,u=i.index,d=i.attributes.position;if(u!==null){const p=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let v=p,g=f-1;v<g;v+=c){const m=u.getX(v),y=u.getX(v+1),S=Wv(this,e,Dm,l,m,y);S&&n.push(S)}if(this.isLineLoop){const v=u.getX(f-1),g=u.getX(p),m=Wv(this,e,Dm,l,v,g);m&&n.push(m)}}else{const p=Math.max(0,o.start),f=Math.min(d.count,o.start+o.count);for(let v=p,g=f-1;v<g;v+=c){const m=Wv(this,e,Dm,l,v,v+1);m&&n.push(m)}if(this.isLineLoop){const v=Wv(this,e,Dm,l,f-1,p);v&&n.push(v)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Wv(t,e,n,i,r,s){const o=t.geometry.attributes.position;if(I1.fromBufferAttribute(o,r),M1.fromBufferAttribute(o,s),n.distanceSqToSegment(I1,M1,yw,jL)>i)return;yw.applyMatrix4(t.matrixWorld);const l=e.ray.origin.distanceTo(yw);if(!(l<e.near||l>e.far))return{distance:l,point:jL.clone().applyMatrix4(t.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:t}}const WL=new N,GL=new N;class Xne extends Jx{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[];for(let r=0,s=n.count;r<s;r+=2)WL.fromBufferAttribute(n,r),GL.fromBufferAttribute(n,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+WL.distanceTo(GL);e.setAttribute("lineDistance",new wr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Kne extends Jx{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class i5 extends qs{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ge(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const qL=new je,ZR=new lp,Gv=new da,qv=new N;class Yne extends Sn{constructor(e=new ys,n=new i5){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Gv.copy(i.boundingSphere),Gv.applyMatrix4(r),Gv.radius+=s,e.ray.intersectsSphere(Gv)===!1)return;qL.copy(r).invert(),ZR.copy(e.ray).applyMatrix4(qL);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,h=i.attributes.position;if(c!==null){const d=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let f=d,v=p;f<v;f++){const g=c.getX(f);qv.fromBufferAttribute(h,g),XL(qv,g,l,r,e,n,this)}}else{const d=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let f=d,v=p;f<v;f++)qv.fromBufferAttribute(h,f),XL(qv,f,l,r,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function XL(t,e,n,i,r,s,o){const a=ZR.distanceSqToPoint(t);if(a<n){const l=new N;ZR.closestPointToPoint(t,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class Jne{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){const i=this.getUtoTmapping(e);return this.getPoint(i,n)}getPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return n}getSpacedPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPointAt(i/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let i,r=this.getPoint(0),s=0;n.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),n.push(s),r=i;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){const i=this.getLengths();let r=0;const s=i.length;let o;n?o=n:o=e*i[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=i[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,i[r]===o)return r/(s-1);const u=i[r],d=i[r+1]-u,p=(o-u)/d;return(r+p)/(s-1)}getTangent(e,n){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=n||(o.isVector2?new mt:new N);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,n){const i=this.getUtoTmapping(e);return this.getTangent(i,n)}computeFrenetFrames(e,n){const i=new N,r=[],s=[],o=[],a=new N,l=new je;for(let p=0;p<=e;p++){const f=p/e;r[p]=this.getTangentAt(f,new N)}s[0]=new N,o[0]=new N;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=c&&(c=u,i.set(1,0,0)),h<=c&&(c=h,i.set(0,1,0)),d<=c&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let p=1;p<=e;p++){if(s[p]=s[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(r[p-1],r[p]),a.length()>Number.EPSILON){a.normalize();const f=Math.acos(yi(r[p-1].dot(r[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(a,f))}o[p].crossVectors(r[p],s[p])}if(n===!0){let p=Math.acos(yi(s[0].dot(s[e]),-1,1));p/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(p=-p);for(let f=1;f<=e;f++)s[f].applyMatrix4(l.makeRotationAxis(r[f],p*f)),o[f].crossVectors(r[f],s[f])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}const Qne={triangulate:function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=r5(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,d,p;if(i&&(s=iie(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(let f=n;f<r;f+=n)h=t[f],d=t[f+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=p!==0?32767/p:0}return Zg(s,o,n,a,l,p,0),o}};function r5(t,e,n,i,r){let s,o;if(r===fie(t,e,n,i)>0)for(s=e;s<n;s+=i)o=KL(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=KL(s,t[s],t[s+1],o);return o&&Qx(o,o.next)&&(t0(o),o=o.next),o}function ku(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(Qx(n,n.next)||$n(n.prev,n,n.next)===0)){if(t0(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Zg(t,e,n,i,r,s,o){if(!t)return;!o&&s&&lie(t,i,r,s);let a=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?eie(t,i,r,s):Zne(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),t0(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=tie(ku(t),e,n),Zg(t,e,n,i,r,s,2)):o===2&&nie(t,e,n,i,r,s):Zg(ku(t),e,n,i,r,s,1);break}}}function Zne(t){const e=t.prev,n=t,i=t.next;if($n(e,n,i)>=0)return!1;const r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Qh(r,a,s,l,o,c,f.x,f.y)&&$n(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function eie(t,e,n,i){const r=t.prev,s=t,o=t.next;if($n(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,d=o.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,v=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,m=eT(p,f,e,n,i),y=eT(v,g,e,n,i);let S=t.prevZ,x=t.nextZ;for(;S&&S.z>=m&&x&&x.z<=y;){if(S.x>=p&&S.x<=v&&S.y>=f&&S.y<=g&&S!==r&&S!==o&&Qh(a,u,l,h,c,d,S.x,S.y)&&$n(S.prev,S,S.next)>=0||(S=S.prevZ,x.x>=p&&x.x<=v&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Qh(a,u,l,h,c,d,x.x,x.y)&&$n(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;S&&S.z>=m;){if(S.x>=p&&S.x<=v&&S.y>=f&&S.y<=g&&S!==r&&S!==o&&Qh(a,u,l,h,c,d,S.x,S.y)&&$n(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=v&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Qh(a,u,l,h,c,d,x.x,x.y)&&$n(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function tie(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Qx(r,s)&&s5(r,i,i.next,s)&&e0(r,s)&&e0(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),t0(i),t0(i.next),i=t=s),i=i.next}while(i!==t);return ku(i)}function nie(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&hie(o,a)){let l=o5(o,a);o=ku(o,o.next),l=ku(l,l.next),Zg(o,e,n,i,r,s,0),Zg(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function iie(t,e,n,i){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=r5(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(uie(c));for(r.sort(rie),s=0;s<r.length;s++)n=sie(r[s],n);return n}function rie(t,e){return t.x-e.x}function sie(t,e){const n=oie(t,e);if(!n)return e;const i=o5(n,t);return ku(i,i.next),ku(n,n.next)}function oie(t,e){let n=e,i=-1/0,r;const s=t.x,o=t.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const d=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(d<=s&&d>i&&(i=d,r=n.x<n.next.x?n:n.next,d===s))return r}n=n.next}while(n!==e);if(!r)return null;const a=r,l=r.x,c=r.y;let u=1/0,h;n=r;do s>=n.x&&n.x>=l&&s!==n.x&&Qh(o<c?s:i,o,l,c,o<c?i:s,o,n.x,n.y)&&(h=Math.abs(o-n.y)/(s-n.x),e0(n,t)&&(h<u||h===u&&(n.x>r.x||n.x===r.x&&aie(r,n)))&&(r=n,u=h)),n=n.next;while(n!==a);return r}function aie(t,e){return $n(t.prev,t,e.prev)<0&&$n(e.next,t,t.next)<0}function lie(t,e,n,i){let r=t;do r.z===0&&(r.z=eT(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,cie(r)}function cie(t){let e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function eT(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function uie(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Qh(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function hie(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!die(t,e)&&(e0(t,e)&&e0(e,t)&&pie(t,e)&&($n(t.prev,t,e.prev)||$n(t,e.prev,e))||Qx(t,e)&&$n(t.prev,t,t.next)>0&&$n(e.prev,e,e.next)>0)}function $n(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Qx(t,e){return t.x===e.x&&t.y===e.y}function s5(t,e,n,i){const r=Kv($n(t,e,n)),s=Kv($n(t,e,i)),o=Kv($n(n,i,t)),a=Kv($n(n,i,e));return!!(r!==s&&o!==a||r===0&&Xv(t,n,e)||s===0&&Xv(t,i,e)||o===0&&Xv(n,t,i)||a===0&&Xv(n,e,i))}function Xv(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Kv(t){return t>0?1:t<0?-1:0}function die(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&s5(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function e0(t,e){return $n(t.prev,t,t.next)<0?$n(t,e,t.next)>=0&&$n(t,t.prev,e)>=0:$n(t,e,t.prev)<0||$n(t,t.next,e)<0}function pie(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function o5(t,e){const n=new tT(t.i,t.x,t.y),i=new tT(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function KL(t,e,n,i){const r=new tT(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function t0(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function tT(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fie(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}class Q2{static area(e){const n=e.length;let i=0;for(let r=n-1,s=0;s<n;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return Q2.area(e)<0}static triangulateShape(e,n){const i=[],r=[],s=[];YL(e),JL(i,e);let o=e.length;n.forEach(YL);for(let l=0;l<n.length;l++)r.push(o),o+=n[l].length,JL(i,n[l]);const a=Qne.triangulate(i,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function YL(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function JL(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class n0 extends qs{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ge(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qx,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pa extends n0{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ge(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ge(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ge(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Sw extends qs{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ge(16777215),this.specular=new Ge(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qx,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.combine=Wx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class mie extends qs{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qx,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fn,this.combine=Wx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function Yv(t,e,n){return!t||!n&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function gie(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function vie(t){function e(r,s){return t[r]-t[s]}const n=t.length,i=new Array(n);for(let r=0;r!==n;++r)i[r]=r;return i.sort(e),i}function QL(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const a=n[s]*e;for(let l=0;l!==e;++l)r[o++]=t[a+l]}return r}function a5(t,e,n,i){let r=1,s=t[0];for(;s!==void 0&&s[i]===void 0;)s=t[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),n.push.apply(n,o)),s=t[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),n.push(o)),s=t[r++];while(s!==void 0)}class N0{constructor(e,n,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let i=this._cachedIndex,r=n[i],s=n[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break i;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=n[++i],e<r)break t}o=n.length;break n}if(!(e>=s)){const a=n[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=n[--i-1],e>=s)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<n[a]?o=a:i=a+1}if(r=n[i],s=n[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)n[o]=i[s+o];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class yie extends N0{constructor(e,n,i,r){super(e,n,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Kh,endingEnd:Kh}}intervalChanged_(e,n,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Yh:s=e,a=2*n-i;break;case R1:s=r.length-2,a=n+r[s]-r[s+1];break;default:s=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Yh:o=e,l=2*i-n;break;case R1:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=n}const c=(i-n)*.5,u=this.valueSize;this._weightPrev=c/(n-a),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(i-n)/(r-n),v=f*f,g=v*f,m=-d*g+2*d*v-d*f,y=(1+d)*g+(-1.5-2*d)*v+(-.5+d)*f+1,S=(-1-p)*g+(1.5+p)*v+.5*f,x=p*g-p*v;for(let w=0;w!==a;++w)s[w]=m*o[u+w]+y*o[c+w]+S*o[l+w]+x*o[h+w];return s}}class l5 extends N0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-n)/(r-n),h=1-u;for(let d=0;d!==a;++d)s[d]=o[c+d]*h+o[l+d]*u;return s}}class Sie extends N0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class fa{constructor(e,n,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Yv(n,this.TimeBufferType),this.values=Yv(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let i;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:Yv(e.times,Array),values:Yv(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Sie(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new l5(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new yie(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case Kg:n=this.InterpolantFactoryMethodDiscrete;break;case Yg:n=this.InterpolantFactoryMethodLinear;break;case $_:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Kg;case this.InterpolantFactoryMethodLinear:return Yg;case this.InterpolantFactoryMethodSmooth:return $_}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let i=0,r=n.length;i!==r;++i)n[i]*=e}return this}trim(e,n){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;o!==-1&&i[o]>n;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&gie(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===$_,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const h=a*i,d=h-i,p=h+i;for(let f=0;f!==i;++f){const v=n[h+f];if(v!==n[d+f]||v!==n[p+f]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const h=a*i,d=o*i;for(let p=0;p!==i;++p)n[d+p]=n[h+p]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)n[l+c]=n[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=n.slice(0,o*i)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),i=this.constructor,r=new i(this.name,e,n);return r.createInterpolant=this.createInterpolant,r}}fa.prototype.TimeBufferType=Float32Array;fa.prototype.ValueBufferType=Float32Array;fa.prototype.DefaultInterpolation=Yg;class hp extends fa{constructor(e,n,i){super(e,n,i)}}hp.prototype.ValueTypeName="bool";hp.prototype.ValueBufferType=Array;hp.prototype.DefaultInterpolation=Kg;hp.prototype.InterpolantFactoryMethodLinear=void 0;hp.prototype.InterpolantFactoryMethodSmooth=void 0;class c5 extends fa{}c5.prototype.ValueTypeName="color";class Lu extends fa{}Lu.prototype.ValueTypeName="number";class xie extends N0{constructor(e,n,i,r){super(e,n,i,r)}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-n)/(r-n);let c=e*a;for(let u=c+a;c!==u;c+=4)qt.slerpFlat(s,0,o,c-a,o,c,l);return s}}class sc extends fa{InterpolantFactoryMethodLinear(e){return new xie(this.times,this.values,this.getValueSize(),e)}}sc.prototype.ValueTypeName="quaternion";sc.prototype.InterpolantFactoryMethodSmooth=void 0;class dp extends fa{constructor(e,n,i){super(e,n,i)}}dp.prototype.ValueTypeName="string";dp.prototype.ValueBufferType=Array;dp.prototype.DefaultInterpolation=Kg;dp.prototype.InterpolantFactoryMethodLinear=void 0;dp.prototype.InterpolantFactoryMethodSmooth=void 0;class Du extends fa{}Du.prototype.ValueTypeName="vector";class k1{constructor(e="",n=-1,i=[],r=$2){this.name=e,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=Ao(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)n.push(_ie(i[o]).scale(r));const s=new this(e.name,e.duration,n,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const n=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)n.push(fa.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,n,i,r){const s=n.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=vie(l);l=QL(l,1,u),c=QL(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new Lu(".morphTargetInfluences["+n[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,n){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===n)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,n,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=r[h];d||(r[h]=d=[]),d.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],n,i));return o}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,d,p,f,v){if(p.length!==0){const g=[],m=[];a5(p,g,m,f),g.length!==0&&v.push(new h(d,g,m))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let v=0;v<d[f].morphTargets.length;v++)p[d[f].morphTargets[v]]=-1;for(const v in p){const g=[],m=[];for(let y=0;y!==d[f].morphTargets.length;++y){const S=d[f];g.push(S.time),m.push(S.morphTarget===v?1:0)}r.push(new Lu(".morphTargetInfluence["+v+"]",g,m))}l=p.length*o}else{const p=".bones["+n[h].name+"]";i(Du,p+".position",d,"pos",r),i(sc,p+".quaternion",d,"rot",r),i(Du,p+".scale",d,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let n=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];n=Math.max(n,s.times[s.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Cie(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Lu;case"vector":case"vector2":case"vector3":case"vector4":return Du;case"color":return c5;case"quaternion":return sc;case"bool":case"boolean":return hp;case"string":return dp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function _ie(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Cie(t.type);if(t.times===void 0){const n=[],i=[];a5(t.keys,n,i,"value"),t.times=n,t.values=i}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Nl={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class wie{constructor(e,n,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=i,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const p=c[h],f=c[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return f}return null}}}const Eie=new wie;class Ja{constructor(e){this.manager=e!==void 0?e:Eie,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const i=this;return new Promise(function(r,s){i.load(e,r,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ja.DEFAULT_MATERIAL_NAME="__DEFAULT";const ba={};class Rie extends Error{constructor(e,n){super(e),this.response=n}}class Z2 extends Ja{constructor(e){super(e)}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Nl.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(s),this.manager.itemEnd(e)},0),s;if(ba[e]!==void 0){ba[e].push({onLoad:n,onProgress:i,onError:r});return}ba[e]=[],ba[e].push({onLoad:n,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=ba[e],h=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let v=0;const g=new ReadableStream({start(m){y();function y(){h.read().then(({done:S,value:x})=>{if(S)m.close();else{v+=x.byteLength;const w=new ProgressEvent("progress",{lengthComputable:f,loaded:v,total:p});for(let C=0,E=u.length;C<E;C++){const T=u[C];T.onProgress&&T.onProgress(w)}m.enqueue(x),y()}},S=>{m.error(S)})}}});return new Response(g)}else throw new Rie(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(f=>p.decode(f))}}}).then(c=>{Nl.add(e,c);const u=ba[e];delete ba[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=ba[e];if(u===void 0)throw this.manager.itemError(e),c;delete ba[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Tie extends Ja{constructor(e){super(e)}load(e,n,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Nl.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a=Jg("img");function l(){u(),Nl.add(e,this),n&&n(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class u5 extends Ja{constructor(e){super(e)}load(e,n,i,r){const s=new wi,o=new Tie(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,n!==void 0&&n(s)},i,r),s}}class Zx extends Sn{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new Ge(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(n.object.target=this.target.uuid),n}}const xw=new je,ZL=new N,eD=new N;class eA{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mt(512,512),this.map=null,this.mapPass=null,this.matrix=new je,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new G2,this._frameExtents=new mt(1,1),this._viewportCount=1,this._viewports=[new Wt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,i=this.matrix;ZL.setFromMatrixPosition(e.matrixWorld),n.position.copy(ZL),eD.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(eD),n.updateMatrixWorld(),xw.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xw),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(xw)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class bie extends eA{constructor(){super(new cr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,i=Fd*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||n.far;(i!==n.fov||r!==n.aspect||s!==n.far)&&(n.fov=i,n.aspect=r,n.far=s,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class tA extends Zx{constructor(e,n,i=0,r=Math.PI/3,s=0,o=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Sn.DEFAULT_UP),this.updateMatrix(),this.target=new Sn,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new bie}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const tD=new je,Nm=new N,Cw=new N;class Aie extends eA{constructor(){super(new cr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mt(4,2),this._viewportCount=6,this._viewports=[new Wt(2,1,1,1),new Wt(0,1,1,1),new Wt(3,1,1,1),new Wt(1,1,1,1),new Wt(3,0,1,1),new Wt(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,n=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Nm.setFromMatrixPosition(e.matrixWorld),i.position.copy(Nm),Cw.copy(i.position),Cw.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(Cw),i.updateMatrixWorld(),r.makeTranslation(-Nm.x,-Nm.y,-Nm.z),tD.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tD)}}class L1 extends Zx{constructor(e,n,i=0,r=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Aie}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Pie extends eA{constructor(){super(new q2(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class nA extends Zx{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Sn.DEFAULT_UP),this.updateMatrix(),this.target=new Sn,this.shadow=new Pie}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class h5 extends Zx{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class dd{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let i=0,r=e.length;i<r;i++)n+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class Iie extends Ja{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Nl.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{n&&n(c),s.manager.itemEnd(e)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Nl.add(e,c),n&&n(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),Nl.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Nl.add(e,l),s.manager.itemStart(e)}}class Mie{constructor(e,n,i){this.binding=e,this.valueSize=i;let r,s,o;switch(n){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const i=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)i[s+a]=i[a];o=n}else{o+=n;const a=n/o;this._mixBufferRegion(i,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const n=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,i=this.buffer,r=e*n+n,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=n*this._origIndex;this._mixBufferRegion(i,r,l,1-s,n)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*n,1,n);for(let l=n,c=n+n;l!==c;++l)if(i[l]!==i[l+n]){a.setValue(i,r);break}}saveOriginalState(){const e=this.binding,n=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(n,r);for(let s=i,o=r;s!==o;++s)n[s]=n[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let i=e;i<n;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[n+i]=this.buffer[e+i]}_select(e,n,i,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[n+o]=e[i+o]}_slerp(e,n,i,r){qt.slerpFlat(e,n,e,n,e,i,r)}_slerpAdditive(e,n,i,r,s){const o=this._workIndex*s;qt.multiplyQuaternionsFlat(e,o,e,n,e,i),qt.slerpFlat(e,n,e,n,e,o,r)}_lerp(e,n,i,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=n+a;e[l]=e[l]*o+e[i+a]*r}}_lerpAdditive(e,n,i,r,s){for(let o=0;o!==s;++o){const a=n+o;e[a]=e[a]+e[i+o]*r}}}const iA="\\[\\]\\.:\\/",kie=new RegExp("["+iA+"]","g"),rA="[^"+iA+"]",Lie="[^"+iA.replace("\\.","")+"]",Die=/((?:WC+[\/:])*)/.source.replace("WC",rA),Nie=/(WCOD+)?/.source.replace("WCOD",Lie),Oie=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rA),Fie=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rA),zie=new RegExp("^"+Die+Nie+Oie+Fie+"$"),Uie=["material","materials","bones","map"];class Bie{constructor(e,n,i){const r=i||Xt.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,r)}getValue(e,n){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,n)}setValue(e,n){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].unbind()}}class Xt{constructor(e,n,i){this.path=n,this.parsedPath=i||Xt.parseTrackName(n),this.node=Xt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,i){return e&&e.isAnimationObjectGroup?new Xt.Composite(e,n,i):new Xt(e,n,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(kie,"")}static parseTrackName(e){const n=zie.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);Uie.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(n);if(i!==void 0)return i}if(e.children){const i=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===n||a.uuid===n)return a;const l=i(a.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[n++]=i[r]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,i=n.objectName,r=n.propertyName;let s=n.propertyIndex;if(e||(e=Xt.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=n.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Xt.Composite=Bie;Xt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Xt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Xt.prototype.GetterByBindingType=[Xt.prototype._getValue_direct,Xt.prototype._getValue_array,Xt.prototype._getValue_arrayElement,Xt.prototype._getValue_toArray];Xt.prototype.SetterByBindingTypeAndVersioning=[[Xt.prototype._setValue_direct,Xt.prototype._setValue_direct_setNeedsUpdate,Xt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_array,Xt.prototype._setValue_array_setNeedsUpdate,Xt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_arrayElement,Xt.prototype._setValue_arrayElement_setNeedsUpdate,Xt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_fromArray,Xt.prototype._setValue_fromArray_setNeedsUpdate,Xt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class $ie{constructor(e,n,i=null,r=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=i,this.blendMode=r;const s=n.tracks,o=s.length,a=new Array(o),l={endingStart:Kh,endingEnd:Kh};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=zB,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,i){if(e.fadeOut(n),this.fadeIn(n),i){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,n),this.warp(a,1,n)}return this}crossFadeTo(e,n,i){return e.crossFadeFrom(this,n,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,i){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+i,c[0]=e/o,c[1]=n/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?n=0:(this._startTime=null,n=i*l)}n*=this._updateTimeScale(e);const o=this._updateTime(n),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case tJ:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case $2:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,a)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];n*=r,e>i.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===eJ;if(e===0)return s===-1?r:o&&(s&1)===1?n-r:r;if(i===ZY){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=n)r=n;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=n||r<0){const a=Math.floor(r/n);r-=n*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?n:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return n-r}return r}_setEndings(e,n,i){const r=this._interpolantSettings;i?(r.endingStart=Yh,r.endingEnd=Yh):(e?r.endingStart=this.zeroSlopeAtStart?Yh:Kh:r.endingStart=R1,n?r.endingEnd=this.zeroSlopeAtEnd?Yh:Kh:r.endingEnd=R1)}_scheduleFading(e,n,i){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=n,a[1]=s+e,l[1]=i,this}}const Hie=new Float32Array(1);class Vie extends Sc{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=r[h],p=d.name;let f=u[p];if(f!==void 0)++f.referenceCount,o[h]=f;else{if(f=o[h],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const v=n&&n._propertyBindings[h].binding.parsedPath;f=new Mie(Xt.create(i,p,v),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),o[h]=f}a[h].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,i){const r=this._actions,s=this._actionsByClip;let o=s[n];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[n]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const n=this._actions,i=n[n.length-1],r=e._cacheIndex;i._cacheIndex=r,n[r]=i,n.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let i=0,r=n.length;i!==r;++i){const s=n[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const n=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_takeBackAction(e){const n=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_addInactiveBinding(e,n,i){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[n];o===void 0&&(o={},r[n]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const n=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,a=o[r],l=n[n.length-1],c=e._cacheIndex;l._cacheIndex=c,n[c]=l,n.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const n=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_takeBackBinding(e){const n=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=n[r];e._cacheIndex=r,n[r]=e,s._cacheIndex=i,n[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let i=e[n];return i===void 0&&(i=new l5(new Float32Array(2),new Float32Array(2),1,Hie),i.__cacheIndex=n,e[n]=i),i}_takeBackControlInterpolant(e){const n=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=n[r];e.__cacheIndex=r,n[r]=e,s.__cacheIndex=i,n[i]=s}clipAction(e,n,i){const r=n||this._root,s=r.uuid;let o=typeof e=="string"?k1.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=$2),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===i)return h;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new $ie(this,o,n,i);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,n){const i=n||this._root,r=i.uuid,s=typeof e=="string"?k1.findByName(i,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let i=n-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const n=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)n[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,h=n[n.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,n[u]=h,n.pop(),this._removeInactiveBindingsForAction(c)}delete r[i]}}uncacheRoot(e){const n=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[n];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[n];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,n){const i=this.existingAction(e,n);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}const nD=new je;class jie{constructor(e,n,i=0,r=1/0){this.ray=new lp(e,n),this.near=i,this.far=r,this.camera=null,this.layers=new j2,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return nD.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(nD),this}intersectObject(e,n=!0,i=[]){return nT(e,this,i,n),i.sort(iD),i}intersectObjects(e,n=!0,i=[]){for(let r=0,s=e.length;r<s;r++)nT(e[r],this,i,n);return i.sort(iD),i}}function iD(t,e){return t.distance-e.distance}function nT(t,e,n,i){let r=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(r=!1),r===!0&&i===!0){const s=t.children;for(let o=0,a=s.length;o<a;o++)nT(s[o],e,n,!0)}}class D1{constructor(e=1,n=0,i=0){return this.radius=e,this.phi=n,this.theta=i,this}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+n*n+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(yi(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Wie extends Sc{constructor(e,n=null){super(),this.object=e,this.domElement=n,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:L2}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=L2);const rD={type:"change"},sA={type:"start"},d5={type:"end"},Jv=new lp,sD=new El,Gie=Math.cos(70*Hi.DEG2RAD),mi=new N,Dr=2*Math.PI,mn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_w=1e-6;class qie extends Wie{constructor(e,n=null){super(e,n),this.state=mn.NONE,this.enabled=!0,this.target=new N,this.cursor=new N,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ld.ROTATE,MIDDLE:ld.DOLLY,RIGHT:ld.PAN},this.touches={ONE:Xh.ROTATE,TWO:Xh.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new N,this._lastQuaternion=new qt,this._lastTargetPosition=new N,this._quat=new qt().setFromUnitVectors(e.up,new N(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new D1,this._sphericalDelta=new D1,this._scale=1,this._panOffset=new N,this._rotateStart=new mt,this._rotateEnd=new mt,this._rotateDelta=new mt,this._panStart=new mt,this._panEnd=new mt,this._panDelta=new mt,this._dollyStart=new mt,this._dollyEnd=new mt,this._dollyDelta=new mt,this._dollyDirection=new N,this._mouse=new mt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Kie.bind(this),this._onPointerDown=Xie.bind(this),this._onPointerUp=Yie.bind(this),this._onContextMenu=ire.bind(this),this._onMouseWheel=Zie.bind(this),this._onKeyDown=ere.bind(this),this._onTouchStart=tre.bind(this),this._onTouchMove=nre.bind(this),this._onMouseDown=Jie.bind(this),this._onMouseMove=Qie.bind(this),this._interceptControlDown=rre.bind(this),this._interceptControlUp=sre.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(rD),this.update(),this.state=mn.NONE}update(e=null){const n=this.object.position;mi.copy(n).sub(this.target),mi.applyQuaternion(this._quat),this._spherical.setFromVector3(mi),this.autoRotate&&this.state===mn.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Dr:i>Math.PI&&(i-=Dr),r<-Math.PI?r+=Dr:r>Math.PI&&(r-=Dr),i<=r?this._spherical.theta=Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(mi.setFromSpherical(this._spherical),mi.applyQuaternion(this._quatInverse),n.copy(this.target).add(mi),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=mi.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const a=new N(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const c=new N(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=mi.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Jv.origin.copy(this.object.position),Jv.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Jv.direction))<Gie?this.object.lookAt(this.target):(sD.setFromNormalAndCoplanarPoint(this.object.up,this.target),Jv.intersectPlane(sD,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>_w||8*(1-this._lastQuaternion.dot(this.object.quaternion))>_w||this._lastTargetPosition.distanceToSquared(this.target)>_w?(this.dispatchEvent(rD),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Dr/60*this.autoRotateSpeed*e:Dr/60/60*this.autoRotateSpeed}_getZoomScale(e){const n=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,n){mi.setFromMatrixColumn(n,0),mi.multiplyScalar(-e),this._panOffset.add(mi)}_panUp(e,n){this.screenSpacePanning===!0?mi.setFromMatrixColumn(n,1):(mi.setFromMatrixColumn(n,0),mi.crossVectors(this.object.up,mi)),mi.multiplyScalar(e),this._panOffset.add(mi)}_pan(e,n){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;mi.copy(r).sub(this.target);let s=mi.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*n*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=e-i.left,s=n-i.top,o=i.width,a=i.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(Dr*this._rotateDelta.x/n.clientHeight),this._rotateUp(Dr*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let n=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Dr*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._panStart.set(i,r)}}_handleTouchStartDolly(e){const n=this._getSecondPointerPosition(e),i=e.pageX-n.x,r=e.pageY-n.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(Dr*this._rotateDelta.x/n.clientHeight),this._rotateUp(Dr*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const n=this._getSecondPointerPosition(e),i=e.pageX-n.x,r=e.pageY-n.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+n.x)*.5,a=(e.pageY+n.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(e){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId)return!0;return!1}_trackPointer(e){let n=this._pointerPositions[e.pointerId];n===void 0&&(n=new mt,this._pointerPositions[e.pointerId]=n),n.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const n=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(e){const n=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(n){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function Xie(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function Kie(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function Yie(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(d5),this.state=mn.NONE;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y});break}}function Jie(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ld.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=mn.DOLLY;break;case ld.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=mn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=mn.ROTATE}break;case ld.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=mn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=mn.PAN}break;default:this.state=mn.NONE}this.state!==mn.NONE&&this.dispatchEvent(sA)}function Qie(t){switch(this.state){case mn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case mn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case mn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function Zie(t){this.enabled===!1||this.enableZoom===!1||this.state!==mn.NONE||(t.preventDefault(),this.dispatchEvent(sA),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(d5))}function ere(t){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(t)}function tre(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Xh.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=mn.TOUCH_ROTATE;break;case Xh.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=mn.TOUCH_PAN;break;default:this.state=mn.NONE}break;case 2:switch(this.touches.TWO){case Xh.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=mn.TOUCH_DOLLY_PAN;break;case Xh.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=mn.TOUCH_DOLLY_ROTATE;break;default:this.state=mn.NONE}break;default:this.state=mn.NONE}this.state!==mn.NONE&&this.dispatchEvent(sA)}function nre(t){switch(this._trackPointer(t),this.state){case mn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case mn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case mn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case mn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=mn.NONE}}function ire(t){this.enabled!==!1&&t.preventDefault()}function rre(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function sre(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function oD(t,e){if(e===nJ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===XR||e===UB){let n=t.getIndex();if(n===null){const o=[],a=t.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);t.setIndex(o),n=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const i=n.count-2,r=[];if(e===XR)for(let o=1;o<=i;o++)r.push(n.getX(0)),r.push(n.getX(o)),r.push(n.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(r.push(n.getX(o)),r.push(n.getX(o+1)),r.push(n.getX(o+2))):(r.push(n.getX(o+2)),r.push(n.getX(o+1)),r.push(n.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class ore extends Ja{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new hre(n)}),this.register(function(n){return new dre(n)}),this.register(function(n){return new Cre(n)}),this.register(function(n){return new _re(n)}),this.register(function(n){return new wre(n)}),this.register(function(n){return new fre(n)}),this.register(function(n){return new mre(n)}),this.register(function(n){return new gre(n)}),this.register(function(n){return new vre(n)}),this.register(function(n){return new ure(n)}),this.register(function(n){return new yre(n)}),this.register(function(n){return new pre(n)}),this.register(function(n){return new xre(n)}),this.register(function(n){return new Sre(n)}),this.register(function(n){return new lre(n)}),this.register(function(n){return new Ere(n)}),this.register(function(n){return new Rre(n)})}load(e,n,i,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=dd.extractUrlBase(e);o=dd.resolveURL(c,this.path)}else o=dd.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new Z2(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){n(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,i,r){let s;const o={},a={},l=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===p5){try{o[zt.KHR_BINARY_GLTF]=new Tre(e)}catch(h){r&&r(h);return}s=JSON.parse(o[zt.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Ure(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const h=this.pluginCallbacks[u](c);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[h.name]=h,o[h.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const h=s.extensionsUsed[u],d=s.extensionsRequired||[];switch(h){case zt.KHR_MATERIALS_UNLIT:o[h]=new cre;break;case zt.KHR_DRACO_MESH_COMPRESSION:o[h]=new bre(s,this.dracoLoader);break;case zt.KHR_TEXTURE_TRANSFORM:o[h]=new Are;break;case zt.KHR_MESH_QUANTIZATION:o[h]=new Pre;break;default:d.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,r)}parseAsync(e,n){const i=this;return new Promise(function(r,s){i.parse(e,n,r,s)})}}function are(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const zt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class lre{constructor(e){this.parser=e,this.name=zt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let i=0,r=n.length;i<r;i++){const s=n[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const n=this.parser,i="light:"+e;let r=n.cache.get(i);if(r)return r;const s=n.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new Ge(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],qi);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new nA(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new L1(u),c.distance=h;break;case"spot":c=new tA(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Ia(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=n.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),n.cache.add(i,r),r}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(n.cache,a,l)})}}class cre{constructor(){this.name=zt.KHR_MATERIALS_UNLIT}getMaterialType(){return Dl}extendParams(e,n,i){const r=[];e.color=new Ge(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],qi),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,on))}return Promise.all(r)}}class ure{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(n.emissiveIntensity=s),Promise.resolve()}}class hre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(n.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new mt(a,a)}return Promise.all(s)}}class dre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class pre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(n.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(n,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(n.iridescenceIOR=o.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(n,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class fre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new Ge(0,0,0),n.sheenRoughness=0,n.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;n.sheenColor.setRGB(a[0],a[1],a[2],qi)}return o.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(n,"sheenColorMap",o.sheenColorTexture,on)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(n,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class mre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(n.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(n,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class gre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];n.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(n,"thicknessMap",o.thicknessTexture)),n.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return n.attenuationColor=new Ge().setRGB(a[0],a[1],a[2],qi),Promise.all(s)}}class vre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class yre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];n.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(n,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return n.specularColor=new Ge().setRGB(a[0],a[1],a[2],qi),o.specularColorTexture!==void 0&&s.push(i.assignTexture(n,"specularColorMap",o.specularColorTexture,on)),Promise.all(s)}}class Sre{constructor(e){this.parser=e,this.name=zt.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return n.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(i.assignTexture(n,"bumpMap",o.bumpTexture)),Promise.all(s)}}class xre{constructor(e){this.parser=e,this.name=zt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:pa}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(n.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(n.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(n,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class Cre{constructor(e){this.parser=e,this.name=zt.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=n.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,s.source,o)}}class _re{constructor(e){this.parser=e,this.name=zt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class wre{constructor(e){this.parser=e,this.name=zt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Ere{constructor(e){this.name=zt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,i=n.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,u=r.count,h=r.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,d,r.mode,r.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(p),u,h,d,r.mode,r.filter),p})})}else return null}}class Rre{constructor(e){this.name=zt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,i=n.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=n.meshes[i.mesh];for(const c of r.primitives)if(c.mode!==Ls.TRIANGLES&&c.mode!==Ls.TRIANGLE_STRIP&&c.mode!==Ls.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],d=c[0].count,p=[];for(const f of h){const v=new je,g=new N,m=new qt,y=new N(1,1,1),S=new qne(f.geometry,f.material,d);for(let x=0;x<d;x++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,x),l.ROTATION&&m.fromBufferAttribute(l.ROTATION,x),l.SCALE&&y.fromBufferAttribute(l.SCALE,x),S.setMatrixAt(x,v.compose(g,m,y));for(const x in l)if(x==="_COLOR_0"){const w=l[x];S.instanceColor=new QR(w.array,w.itemSize,w.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&f.geometry.setAttribute(x,l[x]);Sn.prototype.copy.call(S,f),this.parser.assignFinalMaterial(S),p.push(S)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const p5="glTF",Om=12,aD={JSON:1313821514,BIN:5130562};class Tre{constructor(e){this.name=zt.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Om),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==p5)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Om,s=new DataView(e,Om);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,l===aD.JSON){const c=new Uint8Array(e,Om+o,a);this.content=i.decode(c)}else if(l===aD.BIN){const c=Om+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class bre{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=zt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const h=iT[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=iT[u]||u.toLowerCase();if(o[u]!==void 0){const d=i.accessors[e.attributes[u]],p=pd[d.componentType];c[h]=p.name,l[h]=d.normalized===!0}}return n.getDependency("bufferView",s).then(function(u){return new Promise(function(h,d){r.decodeDracoFile(u,function(p){for(const f in p.attributes){const v=p.attributes[f],g=l[f];g!==void 0&&(v.normalized=g)}h(p)},a,c,qi,d)})})}}class Are{constructor(){this.name=zt.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class Pre{constructor(){this.name=zt.KHR_MESH_QUANTIZATION}}class f5 extends N0{constructor(e,n,i,r){super(e,n,i,r)}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)n[o]=i[s+o];return n}interpolate_(e,n,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=r-n,h=(i-n)/u,d=h*h,p=d*h,f=e*c,v=f-c,g=-2*p+3*d,m=p-d,y=1-g,S=m-d+h;for(let x=0;x!==a;x++){const w=o[v+x+a],C=o[v+x+l]*u,E=o[f+x+a],T=o[f+x]*u;s[x]=y*w+S*C+g*E+m*T}return s}}const Ire=new qt;class Mre extends f5{interpolate_(e,n,i,r){const s=super.interpolate_(e,n,i,r);return Ire.fromArray(s).normalize().toArray(s),s}}const Ls={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},pd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lD={9728:Er,9729:ds,9984:AB,9985:My,9986:Zm,9987:za},cD={33071:na,33648:E1,10497:ic},ww={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iT={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},kre={CUBICSPLINE:void 0,LINEAR:Yg,STEP:Kg},Ew={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Lre(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new n0({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ka})),t.DefaultMaterial}function Gc(t,e,n){for(const i in n.extensions)t[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function Ia(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Dre(t,e,n){let i=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(i=!0),h.NORMAL!==void 0&&(r=!0),h.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(i){const d=h.POSITION!==void 0?n.getDependency("accessor",h.POSITION):t.attributes.position;o.push(d)}if(r){const d=h.NORMAL!==void 0?n.getDependency("accessor",h.NORMAL):t.attributes.normal;a.push(d)}if(s){const d=h.COLOR_0!==void 0?n.getDependency("accessor",h.COLOR_0):t.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],d=c[2];return i&&(t.morphAttributes.position=u),r&&(t.morphAttributes.normal=h),s&&(t.morphAttributes.color=d),t.morphTargetsRelative=!0,t})}function Nre(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let i=0,r=n.length;i<r;i++)t.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ore(t){let e;const n=t.extensions&&t.extensions[zt.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+Rw(n.attributes):e=t.indices+":"+Rw(t.attributes)+":"+t.mode,t.targets!==void 0)for(let i=0,r=t.targets.length;i<r;i++)e+=":"+Rw(t.targets[i]);return e}function Rw(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function rT(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Fre(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const zre=new je;class Ure{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new are,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=-1,s=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);r=i&&l?parseInt(l[1],10):-1,s=a.indexOf("Firefox")>-1,o=s?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&r<17||s&&o<98?this.textureLoader=new u5(this.options.manager):this.textureLoader=new Iie(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Z2(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};return Gc(s,a,r),Ia(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=n.length;r<s;r++){const o=n[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,i){if(e.refs[n]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(i,r),r.name+="_instance_"+e.uses[n]++,r}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let i=0;i<n.length;i++){const r=e(n[i]);if(r)return r}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const i=[];for(let r=0;r<n.length;r++){const s=e(n[r]);s&&i.push(s)}return i}getDependency(e,n){const i=e+":"+n;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(n);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":r=this.loadAccessor(n);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":r=this.loadBuffer(n);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":r=this.loadSkin(n);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":r=this.loadCamera(n);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,n)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(i,r)}return r}getDependencies(e){let n=this.cache.get(e);if(!n){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(r.map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],i=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[zt.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(dd.resolveURL(n.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(i){const r=n.byteLength||0,s=n.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const n=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=ww[r.type],a=pd[r.componentType],l=r.normalized===!0,c=new a(r.count*o);return Promise.resolve(new br(c,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=ww[r.type],c=pd[r.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,d=r.byteOffset||0,p=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,f=r.normalized===!0;let v,g;if(p&&p!==h){const m=Math.floor(d/p),y="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count;let S=n.cache.get(y);S||(v=new c(a,m*p,r.count*p/u),S=new Vne(v,p/u),n.cache.add(y,S)),g=new K2(S,l,d%p/u,f)}else a===null?v=new c(r.count*l):v=new c(a,d,r.count*l),g=new br(v,l,f);if(r.sparse!==void 0){const m=ww.SCALAR,y=pd[r.sparse.indices.componentType],S=r.sparse.indices.byteOffset||0,x=r.sparse.values.byteOffset||0,w=new y(o[1],S,r.sparse.count*m),C=new c(o[2],x,r.sparse.count*l);a!==null&&(g=new br(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let E=0,T=w.length;E<T;E++){const M=w[E];if(g.setX(M,C[E*l]),l>=2&&g.setY(M,C[E*l+1]),l>=3&&g.setZ(M,C[E*l+2]),l>=4&&g.setW(M,C[E*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=f}return g})}loadTexture(e){const n=this.json,i=this.options,s=n.textures[e].source,o=n.images[s];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,n,i){const r=this,s=this.json,o=s.textures[e],a=s.images[n],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(n,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const d=(s.samplers||{})[o.sampler]||{};return u.magFilter=lD[d.magFilter]||ds,u.minFilter=lD[d.minFilter]||za,u.wrapS=cD[d.wrapS]||ic,u.wrapT=cD[d.wrapT]||ic,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,n){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(h){c=!0;const d=new Blob([h],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(d,p){let f=d;n.isImageBitmapLoader===!0&&(f=function(v){const g=new wi(v);g.needsUpdate=!0,d(g)}),n.load(dd.resolveURL(h,s.path),f,void 0,p)})}).then(function(h){return c===!0&&a.revokeObjectURL(l),Ia(h,o),h.userData.mimeType=o.mimeType||Fre(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,n,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),s.extensions[zt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[zt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[zt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(o.colorSpace=r),e[n]=o,o})}assignFinalMaterial(e){const n=e.geometry;let i=e.material;const r=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,o=n.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new i5,qs.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new J2,qs.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return n0}loadMaterial(e){const n=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[zt.KHR_MATERIALS_UNLIT]){const h=r[zt.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),c.push(h.extendParams(a,s,n))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new Ge(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],qi),a.opacity=d[3]}h.baseColorTexture!==void 0&&c.push(n.assignTexture(a,"map",h.baseColorTexture,on)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(n.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(n.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Zo);const u=s.alphaMode||Ew.OPAQUE;if(u===Ew.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Ew.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==Dl&&(c.push(n.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new mt(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&o!==Dl&&(c.push(n.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==Dl){const h=s.emissiveFactor;a.emissive=new Ge().setRGB(h[0],h[1],h[2],qi)}return s.emissiveTexture!==void 0&&o!==Dl&&c.push(n.assignTexture(a,"emissiveMap",s.emissiveTexture,on)),Promise.all(c).then(function(){const h=new o(a);return s.name&&(h.name=s.name),Ia(h,s),n.associations.set(h,{materials:e}),s.extensions&&Gc(r,h,s),h})}createUniqueName(e){const n=Xt.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[zt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(l){return uD(l,a,n)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=Ore(c),h=r[u];if(h)o.push(h.promise);else{let d;c.extensions&&c.extensions[zt.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=uD(new ys,c,n),r[u]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const n=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?Lre(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(n.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let p=0,f=u.length;p<f;p++){const v=u[p],g=o[p];let m;const y=c[p];if(g.mode===Ls.TRIANGLES||g.mode===Ls.TRIANGLE_STRIP||g.mode===Ls.TRIANGLE_FAN||g.mode===void 0)m=s.isSkinnedMesh===!0?new Y2(v,y):new gn(v,y),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),g.mode===Ls.TRIANGLE_STRIP?m.geometry=oD(m.geometry,UB):g.mode===Ls.TRIANGLE_FAN&&(m.geometry=oD(m.geometry,XR));else if(g.mode===Ls.LINES)m=new Xne(v,y);else if(g.mode===Ls.LINE_STRIP)m=new Jx(v,y);else if(g.mode===Ls.LINE_LOOP)m=new Kne(v,y);else if(g.mode===Ls.POINTS)m=new Yne(v,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(m.geometry.morphAttributes).length>0&&Nre(m,s),m.name=n.createUniqueName(s.name||"mesh_"+e),Ia(m,s),g.extensions&&Gc(r,m,g),n.assignFinalMaterial(m),h.push(m)}for(let p=0,f=h.length;p<f;p++)n.associations.set(h[p],{meshes:e,primitives:p});if(h.length===1)return s.extensions&&Gc(r,h[0],s),h[0];const d=new Ba;s.extensions&&Gc(r,d,s),n.associations.set(d,{meshes:e});for(let p=0,f=h.length;p<f;p++)d.add(h[p]);return d})}loadCamera(e){let n;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?n=new cr(Hi.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(n=new q2(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(n.name=this.createUniqueName(i.name)),Ia(n,i),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],i=[];for(let r=0,s=n.joints.length;r<s;r++)i.push(this._loadNodeShallow(n.joints[r]));return n.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",n.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const h=o[c];if(h){a.push(h);const d=new je;s!==null&&d.fromArray(s.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[c])}return new D0(a,l)})}loadAnimation(e){const n=this.json,i=this,r=n.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];for(let h=0,d=r.channels.length;h<d;h++){const p=r.channels[h],f=r.samplers[p.sampler],v=p.target,g=v.node,m=r.parameters!==void 0?r.parameters[f.input]:f.input,y=r.parameters!==void 0?r.parameters[f.output]:f.output;v.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",m)),l.push(this.getDependency("accessor",y)),c.push(f),u.push(v))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const d=h[0],p=h[1],f=h[2],v=h[3],g=h[4],m=[];for(let y=0,S=d.length;y<S;y++){const x=d[y],w=p[y],C=f[y],E=v[y],T=g[y];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const M=i._createAnimationTracks(x,w,C,E,T);if(M)for(let _=0;_<M.length;_++)m.push(M[_])}return new k1(s,void 0,m)})}createNodeMesh(e){const n=this.json,i=this,r=n.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const n=this.json,i=this,r=n.nodes[e],s=i._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(i.getDependency("node",a[c]));const l=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],h=c[1],d=c[2];d!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(d,zre)});for(let p=0,f=h.length;p<f;p++)u.add(h[p]);return u})}_loadNodeShallow(e){const n=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=n.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new Qg:c.length>1?u=new Ba:c.length===1?u=c[0]:u=new Sn,u!==c[0])for(let h=0,d=c.length;h<d;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=o),Ia(u,s),s.extensions&&Gc(i,u,s),s.matrix!==void 0){const h=new je;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const n=this.extensions,i=this.json.scenes[e],r=this,s=new Ba;i.name&&(s.name=r.createUniqueName(i.name)),Ia(s,i),i.extensions&&Gc(n,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[d,p]of r.associations)(d instanceof qs||d instanceof wi)&&h.set(d,p);return u.traverse(d=>{const p=r.associations.get(d);p!=null&&h.set(d,p)}),h};return r.associations=c(s),s})}_createAnimationTracks(e,n,i,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];fl[s.path]===fl.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(fl[s.path]){case fl.weights:c=Lu;break;case fl.rotation:c=sc;break;case fl.position:case fl.scale:c=Du;break;default:switch(i.itemSize){case 1:c=Lu;break;case 2:case 3:default:c=Du;break}break}const u=r.interpolation!==void 0?kre[r.interpolation]:Yg,h=this._getArrayFromAccessor(i);for(let d=0,p=l.length;d<p;d++){const f=new c(l[d]+"."+fl[s.path],n.array,h,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),o.push(f)}return o}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const i=rT(n.constructor),r=new Float32Array(n.length);for(let s=0,o=n.length;s<o;s++)r[s]=n[s]*i;n=r}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const r=this instanceof sc?Mre:f5;return new r(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Bre(t,e,n){const i=e.attributes,r=new ha;if(i.POSITION!==void 0){const a=n.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(r.set(new N(l[0],l[1],l[2]),new N(c[0],c[1],c[2])),a.normalized){const u=rT(pd[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new N,l=new N;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const d=n.json.accessors[h.POSITION],p=d.min,f=d.max;if(p!==void 0&&f!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(f[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(f[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(f[2]))),d.normalized){const v=rT(pd[d.componentType]);l.multiplyScalar(v)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}t.boundingBox=r;const o=new da;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=o}function uD(t,e,n){const i=e.attributes,r=[];function s(o,a){return n.getDependency("accessor",o).then(function(l){t.setAttribute(a,l)})}for(const o in i){const a=iT[o]||o.toLowerCase();a in t.attributes||r.push(s(i[o],a))}if(e.indices!==void 0&&!t.index){const o=n.getDependency("accessor",e.indices).then(function(a){t.setIndex(a)});r.push(o)}return Pt.workingColorSpace!==qi&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Pt.workingColorSpace}" not supported.`),Ia(t,e),Bre(t,e,n),Promise.all(r).then(function(){return e.targets!==void 0?Dre(t,e.targets,n):t})}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var zs=Uint8Array,Zh=Uint16Array,$re=Int32Array,m5=new zs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),g5=new zs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hre=new zs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),v5=function(t,e){for(var n=new Zh(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];for(var r=new $re(n[30]),i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return{b:n,r}},y5=v5(m5,2),S5=y5.b,Vre=y5.r;S5[28]=258,Vre[258]=28;var jre=v5(g5,0),Wre=jre.b,sT=new Zh(32768);for(var In=0;In<32768;++In){var ml=(In&43690)>>1|(In&21845)<<1;ml=(ml&52428)>>2|(ml&13107)<<2,ml=(ml&61680)>>4|(ml&3855)<<4,sT[In]=((ml&65280)>>8|(ml&255)<<8)>>1}var xg=function(t,e,n){for(var i=t.length,r=0,s=new Zh(e);r<i;++r)t[r]&&++s[t[r]-1];var o=new Zh(e);for(r=1;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;if(n){a=new Zh(1<<e);var l=15-e;for(r=0;r<i;++r)if(t[r])for(var c=r<<4|t[r],u=e-t[r],h=o[t[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)a[sT[h]>>l]=c}else for(a=new Zh(i),r=0;r<i;++r)t[r]&&(a[r]=sT[o[t[r]-1]++]>>15-t[r]);return a},O0=new zs(288);for(var In=0;In<144;++In)O0[In]=8;for(var In=144;In<256;++In)O0[In]=9;for(var In=256;In<280;++In)O0[In]=7;for(var In=280;In<288;++In)O0[In]=8;var x5=new zs(32);for(var In=0;In<32;++In)x5[In]=5;var Gre=xg(O0,9,1),qre=xg(x5,5,1),Tw=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ho=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&n},bw=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},Xre=function(t){return(t+7)/8|0},Kre=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new zs(t.subarray(e,n))},Yre=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],fo=function(t,e,n){var i=new Error(e||Yre[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,fo),!n)throw i;return i},Jre=function(t,e,n,i){var r=t.length,s=0;if(!r||e.f&&!e.l)return n||new zs(0);var o=!n,a=o||e.i!=2,l=e.i;o&&(n=new zs(r*3));var c=function(at){var yt=n.length;if(at>yt){var U=new zs(Math.max(yt*2,at));U.set(n),n=U}},u=e.f||0,h=e.p||0,d=e.b||0,p=e.l,f=e.d,v=e.m,g=e.n,m=r*8;do{if(!p){u=ho(t,h,1);var y=ho(t,h+1,3);if(h+=3,y)if(y==1)p=Gre,f=qre,v=9,g=5;else if(y==2){var C=ho(t,h,31)+257,E=ho(t,h+10,15)+4,T=C+ho(t,h+5,31)+1;h+=14;for(var M=new zs(T),_=new zs(19),R=0;R<E;++R)_[Hre[R]]=ho(t,h+R*3,7);h+=E*3;for(var L=Tw(_),z=(1<<L)-1,G=xg(_,L,1),R=0;R<T;){var $=G[ho(t,h,z)];h+=$&15;var S=$>>4;if(S<16)M[R++]=S;else{var H=0,q=0;for(S==16?(q=3+ho(t,h,3),h+=2,H=M[R-1]):S==17?(q=3+ho(t,h,7),h+=3):S==18&&(q=11+ho(t,h,127),h+=7);q--;)M[R++]=H}}var D=M.subarray(0,C),Z=M.subarray(C);v=Tw(D),g=Tw(Z),p=xg(D,v,1),f=xg(Z,g,1)}else fo(1);else{var S=Xre(h)+4,x=t[S-4]|t[S-3]<<8,w=S+x;if(w>r){l&&fo(0);break}a&&c(d+x),n.set(t.subarray(S,w),d),e.b=d+=x,e.p=h=w*8,e.f=u;continue}if(h>m){l&&fo(0);break}}a&&c(d+131072);for(var P=(1<<v)-1,le=(1<<g)-1,Se=h;;Se=h){var H=p[bw(t,h)&P],k=H>>4;if(h+=H&15,h>m){l&&fo(0);break}if(H||fo(2),k<256)n[d++]=k;else if(k==256){Se=h,p=null;break}else{var J=k-254;if(k>264){var R=k-257,oe=m5[R];J=ho(t,h,(1<<oe)-1)+S5[R],h+=oe}var pe=f[bw(t,h)&le],ye=pe>>4;pe||fo(3),h+=pe&15;var Z=Wre[ye];if(ye>3){var oe=g5[ye];Z+=bw(t,h)&(1<<oe)-1,h+=oe}if(h>m){l&&fo(0);break}a&&c(d+131072);var nt=d+J;if(d<Z){var Je=s-Z,_t=Math.min(Z,nt);for(Je+d<0&&fo(3);d<_t;++d)n[d]=i[Je+d]}for(;d<nt;++d)n[d]=n[d-Z]}}e.l=p,e.p=Se,e.b=d,e.f=u,p&&(u=1,e.m=v,e.d=f,e.n=g)}while(!u);return d!=n.length&&o?Kre(n,0,d):n.subarray(0,d)},Qre=new zs(0),Zre=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&fo(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&fo(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function ese(t,e){return Jre(t.subarray(Zre(t,e),-4),{i:2},e,e)}var tse=typeof TextDecoder<"u"&&new TextDecoder,nse=0;try{tse.decode(Qre,{stream:!0}),nse=1}catch{}function C5(t,e,n){const i=n.length-t-1;if(e>=n[i])return i-1;if(e<=n[t])return t;let r=t,s=i,o=Math.floor((r+s)/2);for(;e<n[o]||e>=n[o+1];)e<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function ise(t,e,n,i){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=e-i[t+1-a],o[a]=i[t+a]-e;let l=0;for(let c=0;c<a;++c){const u=o[c+1],h=s[a-c],d=r[c]/(u+h);r[c]=l+u*d,l=h*d}r[a]=l}return r}function rse(t,e,n,i){const r=C5(t,i,e),s=ise(r,i,t,e),o=new Wt(0,0,0,0);for(let a=0;a<=t;++a){const l=n[r-t+a],c=s[a],u=l.w*c;o.x+=l.x*u,o.y+=l.y*u,o.z+=l.z*u,o.w+=l.w*c}return o}function sse(t,e,n,i,r){const s=[];for(let h=0;h<=n;++h)s[h]=0;const o=[];for(let h=0;h<=i;++h)o[h]=s.slice(0);const a=[];for(let h=0;h<=n;++h)a[h]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let h=1;h<=n;++h){l[h]=e-r[t+1-h],c[h]=r[t+h]-e;let d=0;for(let p=0;p<h;++p){const f=c[p+1],v=l[h-p];a[h][p]=f+v;const g=a[p][h-1]/a[h][p];a[p][h]=d+f*g,d=v*g}a[h][h]=d}for(let h=0;h<=n;++h)o[0][h]=a[h][n];for(let h=0;h<=n;++h){let d=0,p=1;const f=[];for(let v=0;v<=n;++v)f[v]=s.slice(0);f[0][0]=1;for(let v=1;v<=i;++v){let g=0;const m=h-v,y=n-v;h>=v&&(f[p][0]=f[d][0]/a[y+1][m],g=f[p][0]*a[m][y]);const S=m>=-1?1:-m,x=h-1<=y?v-1:n-h;for(let C=S;C<=x;++C)f[p][C]=(f[d][C]-f[d][C-1])/a[y+1][m+C],g+=f[p][C]*a[m+C][y];h<=y&&(f[p][v]=-f[d][v-1]/a[y+1][h],g+=f[p][v]*a[h][y]),o[v][h]=g;const w=d;d=p,p=w}}let u=n;for(let h=1;h<=i;++h){for(let d=0;d<=n;++d)o[h][d]*=u;u*=n-h}return o}function ose(t,e,n,i,r){const s=r<t?r:t,o=[],a=C5(t,i,e),l=sse(a,i,t,s,e),c=[];for(let u=0;u<n.length;++u){const h=n[u].clone(),d=h.w;h.x*=d,h.y*=d,h.z*=d,c[u]=h}for(let u=0;u<=s;++u){const h=c[a-t].clone().multiplyScalar(l[u][0]);for(let d=1;d<=t;++d)h.add(c[a-t+d].clone().multiplyScalar(l[u][d]));o[u]=h}for(let u=s+1;u<=r+1;++u)o[u]=new Wt(0,0,0);return o}function ase(t,e){let n=1;for(let r=2;r<=t;++r)n*=r;let i=1;for(let r=2;r<=e;++r)i*=r;for(let r=2;r<=t-e;++r)i*=r;return n/i}function lse(t){const e=t.length,n=[],i=[];for(let s=0;s<e;++s){const o=t[s];n[s]=new N(o.x,o.y,o.z),i[s]=o.w}const r=[];for(let s=0;s<e;++s){const o=n[s].clone();for(let a=1;a<=s;++a)o.sub(r[s-a].clone().multiplyScalar(ase(s,a)*i[a]));r[s]=o.divideScalar(i[0])}return r}function cse(t,e,n,i,r){const s=ose(t,e,n,i,r);return lse(s)}class use extends Jne{constructor(e,n,i,r,s){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Wt(a.x,a.y,a.z,a.w)}}getPoint(e,n=new N){const i=n,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=rse(this.degree,this.knots,this.controlPoints,r);return s.w!==1&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,n=new N){const i=n,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=cse(this.degree,this.knots,this.controlPoints,r,1);return i.copy(s[1]).normalize(),i}}let Lt,ei,Cr;class hD extends Ja{constructor(e){super(e)}load(e,n,i,r){const s=this,o=s.path===""?dd.extractUrlBase(e):s.path,a=new Z2(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(l){try{n(s.parse(l,o))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},i,r)}parse(e,n){if(gse(e))Lt=new mse().parse(e);else{const r=E5(e);if(!vse(r))throw new Error("THREE.FBXLoader: Unknown format.");if(pD(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+pD(r));Lt=new fse().parse(r)}const i=new u5(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new hse(i,this.manager).parse(Lt)}}class hse{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){ei=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),i=this.parseMaterials(n),r=this.parseDeformers(),s=new dse().parse(r);return this.parseScene(r,s,i),Cr}parseConnections(){const e=new Map;return"Connections"in Lt&&Lt.Connections.connections.forEach(function(i){const r=i[0],s=i[1],o=i[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const l={ID:r,relationship:o};e.get(s).children.push(l)}),e}parseImages(){const e={},n={};if("Video"in Lt.Objects){const i=Lt.Objects.Video;for(const r in i){const s=i[r],o=parseInt(r);if(e[o]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,l=typeof s.Content=="string"&&s.Content!=="";if(a||l){const c=this.parseImage(i[r]);n[s.RelativeFilename||s.Filename]=c}}}}for(const i in e){const r=e[i];n[r]!==void 0?e[i]=n[r]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const n=e.Content,i=e.RelativeFilename||e.Filename,r=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof n=="string")return"data:"+s+";base64,"+n;{const o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const n=new Map;if("Texture"in Lt.Objects){const i=Lt.Objects.Texture;for(const r in i){const s=this.parseTexture(i[r],e);n.set(parseInt(r),s)}}return n}parseTexture(e,n){const i=this.loadTexture(e,n);i.ID=e.id,i.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(i.wrapS=o===0?ic:na,i.wrapT=a===0?ic:na,"Scaling"in e){const l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(e,n){const i=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),r=e.FileName.split(".").pop().toLowerCase(),s=i.has(r)?this.manager.getHandler(`.${r}`):this.textureLoader;if(!s)return console.warn(`FBXLoader: ${r.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new wi;const o=s.path;o||s.setPath(this.textureLoader.path);const a=ei.get(e.id).children;let l;a!==void 0&&a.length>0&&n[a[0].ID]!==void 0&&(l=n[a[0].ID],(l.indexOf("blob:")===0||l.indexOf("data:")===0)&&s.setPath(void 0));const c=s.load(l);return s.setPath(o),c}parseMaterials(e){const n=new Map;if("Material"in Lt.Objects){const i=Lt.Objects.Material;for(const r in i){const s=this.parseMaterial(i[r],e);s!==null&&n.set(parseInt(r),s)}}return n}parseMaterial(e,n){const i=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!ei.has(i))return null;const o=this.parseParameters(e,n,i);let a;switch(s.toLowerCase()){case"phong":a=new Sw;break;case"lambert":a=new mie;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new Sw;break}return a.setValues(o),a.name=r,a}parseParameters(e,n,i){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=Pt.toWorkingColorSpace(new Ge().fromArray(e.Diffuse.value),on):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=Pt.toWorkingColorSpace(new Ge().fromArray(e.DiffuseColor.value),on)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=Pt.toWorkingColorSpace(new Ge().fromArray(e.Emissive.value),on):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=Pt.toWorkingColorSpace(new Ge().fromArray(e.EmissiveColor.value),on)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=Pt.toWorkingColorSpace(new Ge().fromArray(e.Specular.value),on):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=Pt.toWorkingColorSpace(new Ge().fromArray(e.SpecularColor.value),on));const s=this;return ei.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(n,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(n,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(n,o.ID),r.map!==void 0&&(r.map.colorSpace=on);break;case"DisplacementColor":r.displacementMap=s.getTexture(n,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(n,o.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=on);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(n,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(n,o.ID),r.envMap!==void 0&&(r.envMap.mapping=w1,r.envMap.colorSpace=on);break;case"SpecularColor":r.specularMap=s.getTexture(n,o.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=on);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(n,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,n){return"LayeredTexture"in Lt.Objects&&n in Lt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=ei.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in Lt.Objects){const i=Lt.Objects.Deformer;for(const r in i){const s=i[r],o=ei.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(o,i),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[r]=a}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const i=[];return e.children.forEach(function(r){const s=n[r.ID];if(s.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new je().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,n){const i=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=n[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=ei.get(parseInt(s.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,n,i){Cr=new Ba;const r=this.parseModels(e.skeletons,n,i),s=Lt.Objects.Model,o=this;r.forEach(function(l){const c=s[l.ID];o.setLookAtProperties(l,c),ei.get(l.ID).parents.forEach(function(h){const d=r.get(h.ID);d!==void 0&&d.add(l)}),l.parent===null&&Cr.add(l)}),this.bindSkeleton(e.skeletons,n,r),this.addGlobalSceneSettings(),Cr.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=w5(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new pse().parse();Cr.children.length===1&&Cr.children[0].isGroup&&(Cr.children[0].animations=a,Cr=Cr.children[0]),Cr.animations=a}parseModels(e,n,i){const r=new Map,s=Lt.Objects.Model;for(const o in s){const a=parseInt(o),l=s[o],c=ei.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,n,i);break;case"NurbsCurve":u=this.createCurve(c,n);break;case"LimbNode":case"Root":u=new Qg;break;case"Null":default:u=new Ba;break}u.name=l.attrName?Xt.sanitizeNodeName(l.attrName):"",u.userData.originalName=l.attrName,u.ID=a}this.getTransformData(u,l),r.set(a,u)}return r}buildSkeleton(e,n,i,r){let s=null;return e.parents.forEach(function(o){for(const a in n){const l=n[a];l.rawBones.forEach(function(c,u){if(c.ID===o.ID){const h=s;s=new Qg,s.matrixWorld.copy(c.transformLink),s.name=r?Xt.sanitizeNodeName(r):"",s.userData.originalName=r,s.ID=i,l.bones[u]=s,h!==null&&s.add(h)}})}}),s}createCamera(e){let n,i;if(e.children.forEach(function(r){const s=Lt.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)n=new Sn;else{let r=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(r=1);let s=1;i.NearPlane!==void 0&&(s=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const c=a/l;let u=45;i.FieldOfView!==void 0&&(u=i.FieldOfView.value);const h=i.FocalLength?i.FocalLength.value:null;switch(r){case 0:n=new cr(u,c,s,o),h!==null&&n.setFocalLength(h);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),n=new Sn;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),n=new Sn;break}}return n}createLight(e){let n,i;if(e.children.forEach(function(r){const s=Lt.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)n=new Sn;else{let r;i.LightType===void 0?r=0:r=i.LightType.value;let s=16777215;i.Color!==void 0&&(s=Pt.toWorkingColorSpace(new Ge().fromArray(i.Color.value),on));let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(r){case 0:n=new L1(s,o,a,l);break;case 1:n=new nA(s,o);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=Hi.degToRad(i.InnerAngle.value));let u=0;i.OuterAngle!==void 0&&(u=Hi.degToRad(i.OuterAngle.value),u=Math.max(u,1)),n=new tA(s,o,a,c,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),n=new L1(s,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(n.castShadow=!0)}return n}createMesh(e,n,i){let r,s=null,o=null;const a=[];return e.children.forEach(function(l){n.has(l.ID)&&(s=n.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Sw({name:Ja.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(l){l.vertexColors=!0}),s.FBX_Deformer?(r=new Y2(s,o),r.normalizeSkinWeights()):r=new gn(s,o),r}createCurve(e,n){const i=e.children.reduce(function(s,o){return n.has(o.ID)&&(s=n.get(o.ID)),s},null),r=new J2({name:Ja.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Jx(i,r)}getTransformData(e,n){const i={};"InheritType"in n&&(i.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?i.eulerOrder=i0(n.RotationOrder.value):i.eulerOrder=i0(0),"Lcl_Translation"in n&&(i.translation=n.Lcl_Translation.value),"PreRotation"in n&&(i.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(i.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(i.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(i.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(i.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(i.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(i.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(i.rotationPivot=n.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,n){"LookAtProperty"in n&&ei.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=Lt.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Cr.add(e.target)):e.lookAt(new N().fromArray(o))}}})}bindSkeleton(e,n,i){const r=this.parsePoseNodes();for(const s in e){const o=e[s];ei.get(parseInt(o.ID)).parents.forEach(function(l){if(n.has(l.ID)){const c=l.ID;ei.get(c).parents.forEach(function(h){i.has(h.ID)&&i.get(h.ID).bind(new D0(o.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Lt.Objects){const n=Lt.Objects.Pose;for(const i in n)if(n[i].attrType==="BindPose"&&n[i].NbPoseNodes>0){const r=n[i].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new je().fromArray(s.Matrix.a)}):e[r.Node]=new je().fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Lt){if("AmbientColor"in Lt.GlobalSettings){const e=Lt.GlobalSettings.AmbientColor.value,n=e[0],i=e[1],r=e[2];if(n!==0||i!==0||r!==0){const s=new Ge().setRGB(n,i,r,on);Cr.add(new h5(s,1))}}"UnitScaleFactor"in Lt.GlobalSettings&&(Cr.userData.unitScaleFactor=Lt.GlobalSettings.UnitScaleFactor.value)}}}class dse{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in Lt.Objects){const i=Lt.Objects.Geometry;for(const r in i){const s=ei.get(parseInt(r)),o=this.parseGeometry(s,i[r],e);n.set(parseInt(r),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,i){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,i);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,i){const r=i.skeletons,s=[],o=e.parents.map(function(h){return Lt.Objects.Model[h.ID]});if(o.length===0)return;const a=e.children.reduce(function(h,d){return r[d.ID]!==void 0&&(h=r[d.ID]),h},null);e.children.forEach(function(h){i.morphTargets[h.ID]!==void 0&&s.push(i.morphTargets[h.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=i0(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const u=w5(c);return this.genGeometry(n,a,s,u)}genGeometry(e,n,i,r){const s=new ys;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,n),a=this.genBuffers(o),l=new wr(a.vertex,3);if(l.applyMatrix4(r),s.setAttribute("position",l),a.colors.length>0&&s.setAttribute("color",new wr(a.colors,3)),n&&(s.setAttribute("skinIndex",new W2(a.weightsIndices,4)),s.setAttribute("skinWeight",new wr(a.vertexWeights,4)),s.FBX_Deformer=n),a.normal.length>0){const c=new bt().getNormalMatrix(r),u=new wr(a.normal,3);u.applyNormalMatrix(c),s.setAttribute("normal",u)}if(a.uvs.forEach(function(c,u){const h=u===0?"uv":`uv${u}`;s.setAttribute(h,new wr(a.uvs[u],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(h,d){h!==c&&(s.addGroup(u,d-u,c),c=h,u=d)}),s.groups.length>0){const h=s.groups[s.groups.length-1],d=h.start+h.count;d!==a.materialIndex.length&&s.addGroup(d,a.materialIndex.length-d,c)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,i,r),s}parseGeoNode(e,n){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return i.weightTable={},n!==null&&(i.skeleton=n,n.rawBones.forEach(function(r,s){r.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:s,weight:r.weights[a]})})})),i}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,r=0,s=!1,o=[],a=[],l=[],c=[],u=[],h=[];const d=this;return e.vertexIndices.forEach(function(p,f){let v,g=!1;p<0&&(p=p^-1,g=!0);let m=[],y=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const S=Qv(f,i,p,e.color);l.push(S[0],S[1],S[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(S){y.push(S.weight),m.push(S.id)}),y.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const S=[0,0,0,0],x=[0,0,0,0];y.forEach(function(w,C){let E=w,T=m[C];x.forEach(function(M,_,R){if(E>M){R[_]=E,E=M;const L=S[_];S[_]=T,T=L}})}),m=S,y=x}for(;y.length<4;)y.push(0),m.push(0);for(let S=0;S<4;++S)u.push(y[S]),h.push(m[S])}if(e.normal){const S=Qv(f,i,p,e.normal);a.push(S[0],S[1],S[2])}e.material&&e.material.mappingType!=="AllSame"&&(v=Qv(f,i,p,e.material)[0],v<0&&(d.negativeMaterialIndices=!0,v=0)),e.uv&&e.uv.forEach(function(S,x){const w=Qv(f,i,p,S);c[x]===void 0&&(c[x]=[]),c[x].push(w[0]),c[x].push(w[1])}),r++,g&&(d.genFace(n,e,o,v,a,l,c,u,h,r),i++,r=0,o=[],a=[],l=[],c=[],u=[],h=[])}),n}getNormalNewell(e){const n=new N(0,0,0);for(let i=0;i<e.length;i++){const r=e[i],s=e[(i+1)%e.length];n.x+=(r.y-s.y)*(r.z+s.z),n.y+=(r.z-s.z)*(r.x+s.x),n.z+=(r.x-s.x)*(r.y+s.y)}return n.normalize(),n}getNormalTangentAndBitangent(e){const n=this.getNormalNewell(e),r=(Math.abs(n.z)>.5?new N(0,1,0):new N(0,0,1)).cross(n).normalize(),s=n.clone().cross(r).normalize();return{normal:n,tangent:r,bitangent:s}}flattenVertex(e,n,i){return new mt(e.dot(n),e.dot(i))}genFace(e,n,i,r,s,o,a,l,c,u){let h;if(u>3){const d=[],p=n.baseVertexPositions||n.vertexPositions;for(let m=0;m<i.length;m+=3)d.push(new N(p[i[m]],p[i[m+1]],p[i[m+2]]));const{tangent:f,bitangent:v}=this.getNormalTangentAndBitangent(d),g=[];for(const m of d)g.push(this.flattenVertex(m,f,v));h=Q2.triangulateShape(g,[])}else h=[[0,1,2]];for(const[d,p,f]of h)e.vertex.push(n.vertexPositions[i[d*3]]),e.vertex.push(n.vertexPositions[i[d*3+1]]),e.vertex.push(n.vertexPositions[i[d*3+2]]),e.vertex.push(n.vertexPositions[i[p*3]]),e.vertex.push(n.vertexPositions[i[p*3+1]]),e.vertex.push(n.vertexPositions[i[p*3+2]]),e.vertex.push(n.vertexPositions[i[f*3]]),e.vertex.push(n.vertexPositions[i[f*3+1]]),e.vertex.push(n.vertexPositions[i[f*3+2]]),n.skeleton&&(e.vertexWeights.push(l[d*4]),e.vertexWeights.push(l[d*4+1]),e.vertexWeights.push(l[d*4+2]),e.vertexWeights.push(l[d*4+3]),e.vertexWeights.push(l[p*4]),e.vertexWeights.push(l[p*4+1]),e.vertexWeights.push(l[p*4+2]),e.vertexWeights.push(l[p*4+3]),e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3]),e.weightsIndices.push(c[p*4]),e.weightsIndices.push(c[p*4+1]),e.weightsIndices.push(c[p*4+2]),e.weightsIndices.push(c[p*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3])),n.color&&(e.colors.push(o[d*3]),e.colors.push(o[d*3+1]),e.colors.push(o[d*3+2]),e.colors.push(o[p*3]),e.colors.push(o[p*3+1]),e.colors.push(o[p*3+2]),e.colors.push(o[f*3]),e.colors.push(o[f*3+1]),e.colors.push(o[f*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),n.normal&&(e.normal.push(s[d*3]),e.normal.push(s[d*3+1]),e.normal.push(s[d*3+2]),e.normal.push(s[p*3]),e.normal.push(s[p*3+1]),e.normal.push(s[p*3+2]),e.normal.push(s[f*3]),e.normal.push(s[f*3+1]),e.normal.push(s[f*3+2])),n.uv&&n.uv.forEach(function(v,g){e.uvs[g]===void 0&&(e.uvs[g]=[]),e.uvs[g].push(a[g][d*2]),e.uvs[g].push(a[g][d*2+1]),e.uvs[g].push(a[g][p*2]),e.uvs[g].push(a[g][p*2+1]),e.uvs[g].push(a[g][f*2]),e.uvs[g].push(a[g][f*2+1])})}addMorphTargets(e,n,i,r){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=Lt.Objects.Geometry[a.geoID];l!==void 0&&s.genMorphGeometry(e,n,l,r,a.name)})})}genMorphGeometry(e,n,i,r,s){const o=n.Vertices!==void 0?n.Vertices.a:[],a=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],l=i.Vertices!==void 0?i.Vertices.a:[],c=i.Indexes!==void 0?i.Indexes.a:[],u=e.attributes.position.count*3,h=new Float32Array(u);for(let v=0;v<c.length;v++){const g=c[v]*3;h[g]=l[v*3],h[g+1]=l[v*3+1],h[g+2]=l[v*3+2]}const d={vertexIndices:a,vertexPositions:h,baseVertexPositions:o},p=this.genBuffers(d),f=new wr(p.vertex,3);f.name=s||i.attrName,f.applyMatrix4(r),e.morphAttributes.position.push(f)}parseNormals(e){const n=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Normals.a;let s=[];return i==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:n,referenceType:i}}parseUVs(e){const n=e.MappingInformationType,i=e.ReferenceInformationType,r=e.UV.a;let s=[];return i==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:n,referenceType:i}}parseVertexColors(e){const n=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Colors.a;let s=[];i==="IndexToDirect"&&(s=e.ColorIndex.a);for(let o=0,a=new Ge;o<r.length;o+=4)a.fromArray(r,o),Pt.toWorkingColorSpace(a,on),a.toArray(r,o);return{dataSize:4,buffer:r,indices:s,mappingType:n,referenceType:i}}parseMaterialIndices(e){const n=e.MappingInformationType,i=e.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:n,referenceType:i}}parseNurbsGeometry(e){const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ys;const i=n-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let h=0,d=o.length;h<d;h+=4)s.push(new Wt().fromArray(o,h));let a,l;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=i,l=r.length-1-a;for(let h=0;h<i;++h)s.push(s[h])}const u=new use(i,r,s,a,l).getPoints(s.length*12);return new ys().setFromPoints(u)}}class pse{parse(){const e=[],n=this.parseClips();if(n!==void 0)for(const i in n){const r=n[i],s=this.addClip(r);e.push(s)}return e}parseClips(){if(Lt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=Lt.Objects.AnimationCurveNode,n=new Map;for(const i in e){const r=e[i];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};n.set(s.id,s)}}return n}parseAnimationCurves(e){const n=Lt.Objects.AnimationCurve;for(const i in n){const r={id:n[i].id,times:n[i].KeyTime.a.map(yse),values:n[i].KeyValueFloat.a},s=ei.get(r.id);if(s!==void 0){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const n=Lt.Objects.AnimationLayer,i=new Map;for(const r in n){const s=[],o=ei.get(parseInt(r));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const u=e.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(s[c]===void 0){const h=ei.get(l.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(h!==void 0){const d=Lt.Objects.Model[h.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:d.attrName?Xt.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Cr.traverse(function(f){f.ID===d.id&&(p.transform=f.matrix,f.userData.transformData&&(p.eulerOrder=f.userData.transformData.eulerOrder))}),p.transform||(p.transform=new je),"PreRotation"in d&&(p.preRotation=d.PreRotation.value),"PostRotation"in d&&(p.postRotation=d.PostRotation.value),s[c]=p}}s[c]&&(s[c][u.attr]=u)}else if(u.curves.morph!==void 0){if(s[c]===void 0){const h=ei.get(l.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,d=ei.get(h).parents[0].ID,p=ei.get(d).parents[0].ID,f=ei.get(p).parents[0].ID,v=Lt.Objects.Model[f],g={modelName:v.attrName?Xt.sanitizeNodeName(v.attrName):"",morphName:Lt.Objects.Deformer[h].attrName};s[c]=g}s[c][u.attr]=u}}}),i.set(parseInt(r),s))}return i}parseAnimStacks(e){const n=Lt.Objects.AnimationStack,i={};for(const r in n){const s=ei.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);i[r]={name:n[r].attrName,layer:o}}return i}addClip(e){let n=[];const i=this;return e.layer.forEach(function(r){n=n.concat(i.generateTracks(r))}),new k1(e.name,-1,n)}generateTracks(e){const n=[];let i=new N,r=new N;if(e.transform&&e.transform.decompose(i,new qt,r),i=i.toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");s!==void 0&&n.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&n.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");s!==void 0&&n.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&n.push(s)}return n}generateVectorTrack(e,n,i,r){const s=this.getTimesForAllAxes(n),o=this.getKeyframeTrackValues(s,n,i);return new Du(e+"."+r,s,o)}generateRotationTrack(e,n,i,r,s){let o,a;if(n.x!==void 0&&n.y!==void 0&&n.z!==void 0){const d=this.interpolateRotations(n.x,n.y,n.z,s);o=d[0],a=d[1]}const l=i0(0);i!==void 0&&(i=i.map(Hi.degToRad),i.push(l),i=new fn().fromArray(i),i=new qt().setFromEuler(i)),r!==void 0&&(r=r.map(Hi.degToRad),r.push(l),r=new fn().fromArray(r),r=new qt().setFromEuler(r).invert());const c=new qt,u=new fn,h=[];if(!a||!o)return new sc(e+".quaternion",[0],[0]);for(let d=0;d<a.length;d+=3)u.set(a[d],a[d+1],a[d+2],s),c.setFromEuler(u),i!==void 0&&c.premultiply(i),r!==void 0&&c.multiply(r),d>2&&new qt().fromArray(h,(d-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(h,d/3*4);return new sc(e+".quaternion",o,h)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,i=n.values.map(function(s){return s/100}),r=Cr.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Lu(e.modelName+".morphTargetInfluences["+r+"]",n.times,i)}getTimesForAllAxes(e){let n=[];if(e.x!==void 0&&(n=n.concat(e.x.times)),e.y!==void 0&&(n=n.concat(e.y.times)),e.z!==void 0&&(n=n.concat(e.z.times)),n=n.sort(function(i,r){return i-r}),n.length>1){let i=1,r=n[0];for(let s=1;s<n.length;s++){const o=n[s];o!==r&&(n[i]=o,r=o,i++)}n=n.slice(0,i)}return n}getKeyframeTrackValues(e,n,i){const r=i,s=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(n.x&&(o=n.x.times.indexOf(c)),n.y&&(a=n.y.times.indexOf(c)),n.z&&(l=n.z.times.indexOf(c)),o!==-1){const u=n.x.values[o];s.push(u),r[0]=u}else s.push(r[0]);if(a!==-1){const u=n.y.values[a];s.push(u),r[1]=u}else s.push(r[1]);if(l!==-1){const u=n.z.values[l];s.push(u),r[2]=u}else s.push(r[2])}),s}interpolateRotations(e,n,i,r){const s=[],o=[];s.push(e.times[0]),o.push(Hi.degToRad(e.values[0])),o.push(Hi.degToRad(n.values[0])),o.push(Hi.degToRad(i.values[0]));for(let a=1;a<e.values.length;a++){const l=[e.values[a-1],n.values[a-1],i.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(Hi.degToRad),u=[e.values[a],n.values[a],i.values[a]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const h=u.map(Hi.degToRad),d=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],p=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const v=Math.max(...p)/180,g=new fn(...c,r),m=new fn(...h,r),y=new qt().setFromEuler(g),S=new qt().setFromEuler(m);y.dot(S)&&S.set(-S.x,-S.y,-S.z,-S.w);const x=e.times[a-1],w=e.times[a]-x,C=new qt,E=new fn;for(let T=0;T<1;T+=1/v)C.copy(y.clone().slerp(S.clone(),T)),s.push(x+T*w),E.setFromQuaternion(C,r),o.push(E.x),o.push(E.y),o.push(E.z)}else s.push(e.times[a]),o.push(Hi.degToRad(e.values[a])),o.push(Hi.degToRad(n.values[a])),o.push(Hi.degToRad(i.values[a]))}return[s,o]}}class fse{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new _5,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,i=e.split(/[\r\n]+/);return i.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const l=r.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),c=r.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=r.match("^\\t{"+(n.currentIndent-1)+"}}");l?n.parseNodeBegin(r,l):c?n.parseNodeProperty(r,c,i[++s]):u?n.popStack():r.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,n){const i=n[1].trim().replace(/^"/,"").replace(/"$/,""),r=n[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:i},o=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,s):i in a?(i==="PoseNode"?a.PoseNode.push(s):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=s)):typeof o.id=="number"?(a[i]={},a[i][o.id]=s):i!=="Properties70"&&(i==="PoseNode"?a[i]=[s]:a[i]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let n=e[0];e[0]!==""&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let i="",r="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:n,name:i,type:r}}parseNodeProperty(e,n,i){let r=n[1].replace(/^"/,"").replace(/"$/,"").trim(),s=n[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const l=s.split(",").slice(1),c=parseInt(l[0]),u=parseInt(l[1]);let h=s.split(",").slice(3);h=h.map(function(d){return d.trim().replace(/^"/,"")}),r="connections",s=[c,u],xse(s,h),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):r!=="a"?o[r]=s:o.a=s,this.setCurrentProp(o,r),r==="a"&&s.slice(-1)!==","&&(o.a=Pw(s))}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,e.slice(-1)!==","&&(n.a=Pw(n.a))}parseNodeSpecialProperty(e,n,i){const r=i.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],a=r[2],l=r[3];let c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Pw(c);break}this.getPrevNode()[s]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),s)}}class mse{parse(e){const n=new dD(e);n.skip(23);const i=n.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const r=new _5;for(;!this.endOfContent(n);){const s=this.parseNode(n,i);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const i={},r=n>=7500?e.getUint64():e.getUint32(),s=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(r===0)return null;const l=[];for(let d=0;d<s;d++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",u=l.length>1?l[1]:"",h=l.length>2?l[2]:"";for(i.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const d=this.parseNode(e,n);d!==null&&this.parseSubNode(a,i,d)}return i.propertyList=l,typeof c=="number"&&(i.id=c),u!==""&&(i.attrName=u),h!==""&&(i.attrType=h),a!==""&&(i.name=a),i}parseSubNode(e,n,i){if(i.singleProperty===!0){const r=i.propertyList[0];Array.isArray(r)?(n[i.name]=i,i.a=r):n[i.name]=r}else if(e==="Connections"&&i.name==="C"){const r=[];i.propertyList.forEach(function(s,o){o!==0&&r.push(s)}),n.connections===void 0&&(n.connections=[]),n.connections.push(r)}else if(i.name==="Properties70")Object.keys(i).forEach(function(s){n[s]=i[s]});else if(e==="Properties70"&&i.name==="P"){let r=i.propertyList[0],s=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],n[r]={type:s,type2:o,flag:a,value:l}}else n[i.name]===void 0?typeof i.id=="number"?(n[i.name]={},n[i.name][i.id]=i):n[i.name]=i:i.name==="PoseNode"?(Array.isArray(n[i.name])||(n[i.name]=[n[i.name]]),n[i.name].push(i)):n[i.name][i.id]===void 0&&(n[i.name][i.id]=i)}parseProperty(e){const n=e.getString(1);let i;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(n){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=ese(new Uint8Array(e.getArrayBuffer(o))),l=new dD(a.buffer);switch(n){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class dD{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=n!==void 0?n:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const n=[];for(let i=0;i<e;i++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n&2147483648?(n=~n&4294967295,e=~e&4294967295,e===4294967295&&(n=n+1&4294967295),e=e+1&4294967295,-(n*4294967296+e)):n*4294967296+e}getInt64Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let i=0;i<e;i++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){const n=this.offset;let i=new Uint8Array(this.dv.buffer,n,e);this.skip(e);const r=i.indexOf(0);return r>=0&&(i=new Uint8Array(this.dv.buffer,n,r)),this._textDecoder.decode(i)}}class _5{add(e,n){this[e]=n}}function gse(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===E5(t,0,e.length)}function vse(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(r){const s=t[r-1];return t=t.slice(n+r),n++,s}for(let r=0;r<e.length;++r)if(i(1)===e[r])return!1;return!0}function pD(t){const e=/FBXVersion: (\d+)/,n=t.match(e);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function yse(t){return t/46186158e3}const Sse=[];function Qv(t,e,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=t;break;case"ByPolygon":r=e;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return Cse(Sse,i.buffer,s,o)}const Aw=new fn,Th=new N;function w5(t){const e=new je,n=new je,i=new je,r=new je,s=new je,o=new je,a=new je,l=new je,c=new je,u=new je,h=new je,d=new je,p=t.inheritType?t.inheritType:0;t.translation&&e.setPosition(Th.fromArray(t.translation));const f=i0(0);if(t.preRotation){const R=t.preRotation.map(Hi.degToRad);R.push(f),n.makeRotationFromEuler(Aw.fromArray(R))}if(t.rotation){const R=t.rotation.map(Hi.degToRad);R.push(t.eulerOrder||f),i.makeRotationFromEuler(Aw.fromArray(R))}if(t.postRotation){const R=t.postRotation.map(Hi.degToRad);R.push(f),r.makeRotationFromEuler(Aw.fromArray(R)),r.invert()}t.scale&&s.scale(Th.fromArray(t.scale)),t.scalingOffset&&a.setPosition(Th.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(Th.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(Th.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(Th.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h.copy(t.parentMatrix),u.copy(t.parentMatrixWorld));const v=n.clone().multiply(i).multiply(r),g=new je;g.extractRotation(u);const m=new je;m.copyPosition(u);const y=m.clone().invert().multiply(u),S=g.clone().invert().multiply(y),x=s,w=new je;if(p===0)w.copy(g).multiply(v).multiply(S).multiply(x);else if(p===1)w.copy(g).multiply(S).multiply(v).multiply(x);else{const L=new je().scale(new N().setFromMatrixScale(h)).clone().invert(),z=S.clone().multiply(L);w.copy(g).multiply(v).multiply(z).multiply(x)}const C=c.clone().invert(),E=o.clone().invert();let T=e.clone().multiply(l).multiply(c).multiply(n).multiply(i).multiply(r).multiply(C).multiply(a).multiply(o).multiply(s).multiply(E);const M=new je().copyPosition(T),_=u.clone().multiply(M);return d.copyPosition(_),T=d.clone().multiply(w),T.premultiply(u.invert()),T}function i0(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return t===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function Pw(t){return t.split(",").map(function(n){return parseFloat(n)})}function E5(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=t.byteLength),new TextDecoder().decode(new Uint8Array(t,e,n))}function xse(t,e){for(let n=0,i=t.length,r=e.length;n<r;n++,i++)t[i]=e[n]}function Cse(t,e,n,i){for(let r=n,s=0;r<i;r++,s++)t[s]=e[r];return t}class _se extends t5{constructor(){super();const e=new cp;e.deleteAttribute("uv");const n=new n0({side:Tr}),i=new n0,r=new L1(16777215,900,28,2);r.position.set(.418,16.199,.3),this.add(r);const s=new gn(e,n);s.position.set(-.757,13.219,.717),s.scale.set(31.713,28.305,28.591),this.add(s);const o=new gn(e,i);o.position.set(-10.906,2.009,1.846),o.rotation.set(0,-.195,0),o.scale.set(2.328,7.905,4.651),this.add(o);const a=new gn(e,i);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);const l=new gn(e,i);l.position.set(6.167,.857,7.803),l.rotation.set(0,.561,0),l.scale.set(3.927,6.285,3.687),this.add(l);const c=new gn(e,i);c.position.set(-2.017,.018,6.124),c.rotation.set(0,.333,0),c.scale.set(2.002,4.566,2.064),this.add(c);const u=new gn(e,i);u.position.set(2.291,-.756,-2.621),u.rotation.set(0,-.286,0),u.scale.set(1.546,1.552,1.496),this.add(u);const h=new gn(e,i);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const d=new gn(e,bh(50));d.position.set(-16.116,14.37,8.208),d.scale.set(.1,2.428,2.739),this.add(d);const p=new gn(e,bh(50));p.position.set(-16.109,18.021,-8.207),p.scale.set(.1,2.425,2.751),this.add(p);const f=new gn(e,bh(17));f.position.set(14.904,12.198,-1.832),f.scale.set(.15,4.265,6.331),this.add(f);const v=new gn(e,bh(43));v.position.set(-.462,8.89,14.52),v.scale.set(4.38,5.441,.088),this.add(v);const g=new gn(e,bh(20));g.position.set(3.235,11.486,-12.541),g.scale.set(2.5,2,.1),this.add(g);const m=new gn(e,bh(100));m.position.set(0,20,0),m.scale.set(1,.1,1),this.add(m)}dispose(){const e=new Set;this.traverse(n=>{n.isMesh&&(e.add(n.geometry),e.add(n.material))});for(const n of e)n.dispose()}}function bh(t){const e=new Dl;return e.color.setScalar(t),e}var Cg=function(){var t=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),i(++t%e.children.length)},!1);function n(u){return e.appendChild(u.dom),u}function i(u){for(var h=0;h<e.children.length;h++)e.children[h].style.display=h===u?"block":"none";t=u}var r=(performance||Date).now(),s=r,o=0,a=n(new Cg.Panel("FPS","#0ff","#002")),l=n(new Cg.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new Cg.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:n,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){o++;var u=(performance||Date).now();if(l.update(u-r,200),u>=s+1e3&&(a.update(o*1e3/(u-s),100),s=u,o=0,c)){var h=performance.memory;c.update(h.usedJSHeapSize/1048576,h.jsHeapSizeLimit/1048576)}return u},update:function(){r=this.end()},domElement:e,setMode:i}};Cg.Panel=function(t,e,n){var i=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,u=2*o,h=3*o,d=15*o,p=74*o,f=30*o,v=document.createElement("canvas");v.width=a,v.height=l,v.style.cssText="width:80px;height:48px";var g=v.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(t,c,u),g.fillRect(h,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,p,f),{dom:v,update:function(m,y){i=Math.min(i,m),r=Math.max(r,m),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=e,g.fillText(s(m)+" "+t+" ("+s(i)+"-"+s(r)+")",c,u),g.drawImage(v,h+o,d,p-o,f,h,d,p-o,f),g.fillRect(h+p-o,d,o,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+p-o,d,o,s((1-m/y)*f))}}};class wse{constructor(e,n=null){this.nodeAvatar=e,this.opt={jwtGet:null,ttsEndpoint:null,ttsApikey:null,ttsTrimStart:0,ttsTrimEnd:400,ttsLang:"fi-FI",ttsVoice:"fi-FI-Standard-A",ttsRate:.95,ttsPitch:0,ttsVolume:0,lipsyncLang:"fi",lipsyncModules:["fi","en","lt"],pcmSampleRate:22050,modelRoot:"Armature",modelPixelRatio:1,modelFPS:30,modelMovementFactor:1,cameraView:"full",cameraDistance:0,cameraX:0,cameraY:0,cameraRotateX:0,cameraRotateY:0,cameraRotateEnable:!0,cameraPanEnable:!1,cameraZoomEnable:!1,lightAmbientColor:16777215,lightAmbientIntensity:2,lightDirectColor:8947882,lightDirectIntensity:30,lightDirectPhi:1,lightDirectTheta:2,lightSpotIntensity:0,lightSpotColor:3377407,lightSpotPhi:.1,lightSpotTheta:4,lightSpotDispersion:1,avatarMood:"neutral",avatarMute:!1,markedOptions:{mangle:!1,headerIds:!1,breaks:!0},statsNode:null,statsStyle:null},Object.assign(this.opt,n||{}),this.opt.statsNode&&(this.stats=new Cg,this.opt.statsStyle&&(this.stats.dom.style.cssText=this.opt.statsStyle),this.opt.statsNode.appendChild(this.stats.dom)),this.poseTemplates={side:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.003,y:-.017,z:.1},"Spine.rotation":{x:-.103,y:-.002,z:-.063},"Spine1.rotation":{x:.042,y:-.02,z:-.069},"Spine2.rotation":{x:.131,y:-.012,z:-.065},"Neck.rotation":{x:.027,y:.006,z:0},"Head.rotation":{x:.077,y:-.065,z:0},"LeftShoulder.rotation":{x:1.599,y:.084,z:-1.77},"LeftArm.rotation":{x:1.364,y:.052,z:-.044},"LeftForeArm.rotation":{x:.002,y:-.007,z:.331},"LeftHand.rotation":{x:.104,y:-.067,z:-.174},"LeftHandThumb1.rotation":{x:.231,y:.258,z:.355},"LeftHandThumb2.rotation":{x:-.106,y:-.339,z:-.454},"LeftHandThumb3.rotation":{x:-.02,y:-.142,z:-.004},"LeftHandIndex1.rotation":{x:.148,y:.032,z:-.069},"LeftHandIndex2.rotation":{x:.326,y:-.049,z:-.029},"LeftHandIndex3.rotation":{x:.247,y:-.053,z:-.073},"LeftHandMiddle1.rotation":{x:.238,y:-.057,z:-.089},"LeftHandMiddle2.rotation":{x:.469,y:-.036,z:-.081},"LeftHandMiddle3.rotation":{x:.206,y:-.015,z:-.017},"LeftHandRing1.rotation":{x:.187,y:-.118,z:-.157},"LeftHandRing2.rotation":{x:.579,y:.02,z:-.097},"LeftHandRing3.rotation":{x:.272,y:.021,z:-.063},"LeftHandPinky1.rotation":{x:.405,y:-.182,z:-.138},"LeftHandPinky2.rotation":{x:.613,y:.128,z:-.144},"LeftHandPinky3.rotation":{x:.268,y:.094,z:-.081},"RightShoulder.rotation":{x:1.541,y:.192,z:1.775},"RightArm.rotation":{x:1.273,y:-.352,z:-.067},"RightForeArm.rotation":{x:-.011,y:-.031,z:-.357},"RightHand.rotation":{x:-.008,y:.312,z:-.028},"RightHandThumb1.rotation":{x:.23,y:-.258,z:-.355},"RightHandThumb2.rotation":{x:-.107,y:.339,z:.454},"RightHandThumb3.rotation":{x:-.02,y:.142,z:.004},"RightHandIndex1.rotation":{x:.148,y:-.031,z:.069},"RightHandIndex2.rotation":{x:.326,y:.049,z:.029},"RightHandIndex3.rotation":{x:.247,y:.053,z:.073},"RightHandMiddle1.rotation":{x:.237,y:.057,z:.089},"RightHandMiddle2.rotation":{x:.469,y:.036,z:.081},"RightHandMiddle3.rotation":{x:.206,y:.015,z:.017},"RightHandRing1.rotation":{x:.204,y:.086,z:.135},"RightHandRing2.rotation":{x:.579,y:-.02,z:.098},"RightHandRing3.rotation":{x:.272,y:-.021,z:.063},"RightHandPinky1.rotation":{x:.404,y:.182,z:.137},"RightHandPinky2.rotation":{x:.613,y:-.128,z:.144},"RightHandPinky3.rotation":{x:.268,y:-.094,z:.081},"LeftUpLeg.rotation":{x:.096,y:.209,z:2.983},"LeftLeg.rotation":{x:-.053,y:.042,z:-.017},"LeftFoot.rotation":{x:1.091,y:.15,z:.026},"LeftToeBase.rotation":{x:.469,y:-.07,z:-.015},"RightUpLeg.rotation":{x:-.307,y:-.219,z:2.912},"RightLeg.rotation":{x:-.359,y:.164,z:.015},"RightFoot.rotation":{x:1.035,y:.11,z:.005},"RightToeBase.rotation":{x:.467,y:.07,z:.015}}},hip:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.036,y:.09,z:.135},"Spine.rotation":{x:.076,y:-.035,z:.01},"Spine1.rotation":{x:-.096,y:.013,z:-.094},"Spine2.rotation":{x:-.014,y:.002,z:-.097},"Neck.rotation":{x:.034,y:-.051,z:-.075},"Head.rotation":{x:.298,y:-.1,z:.154},"LeftShoulder.rotation":{x:1.694,y:.011,z:-1.68},"LeftArm.rotation":{x:1.343,y:.177,z:-.153},"LeftForeArm.rotation":{x:-.049,y:.134,z:.351},"LeftHand.rotation":{x:.057,y:-.189,z:-.026},"LeftHandThumb1.rotation":{x:.368,y:-.066,z:.438},"LeftHandThumb2.rotation":{x:-.156,y:.029,z:-.369},"LeftHandThumb3.rotation":{x:.034,y:-.009,z:.016},"LeftHandIndex1.rotation":{x:.157,y:-.002,z:-.171},"LeftHandIndex2.rotation":{x:.099,y:0,z:0},"LeftHandIndex3.rotation":{x:.1,y:0,z:0},"LeftHandMiddle1.rotation":{x:.222,y:-.019,z:-.16},"LeftHandMiddle2.rotation":{x:.142,y:0,z:0},"LeftHandMiddle3.rotation":{x:.141,y:0,z:0},"LeftHandRing1.rotation":{x:.333,y:-.039,z:-.174},"LeftHandRing2.rotation":{x:.214,y:0,z:0},"LeftHandRing3.rotation":{x:.213,y:0,z:0},"LeftHandPinky1.rotation":{x:.483,y:-.069,z:-.189},"LeftHandPinky2.rotation":{x:.312,y:0,z:0},"LeftHandPinky3.rotation":{x:.309,y:0,z:0},"RightShoulder.rotation":{x:1.597,y:.012,z:1.816},"RightArm.rotation":{x:.618,y:-1.274,z:-.266},"RightForeArm.rotation":{x:-.395,y:-.097,z:-1.342},"RightHand.rotation":{x:-.816,y:-.057,z:-.976},"RightHandThumb1.rotation":{x:.42,y:.23,z:-1.172},"RightHandThumb2.rotation":{x:-.027,y:.361,z:.122},"RightHandThumb3.rotation":{x:.076,y:.125,z:-.371},"RightHandIndex1.rotation":{x:-.158,y:-.045,z:.033},"RightHandIndex2.rotation":{x:.391,y:.051,z:.025},"RightHandIndex3.rotation":{x:.317,y:.058,z:.07},"RightHandMiddle1.rotation":{x:.486,y:.066,z:.014},"RightHandMiddle2.rotation":{x:.718,y:.055,z:.07},"RightHandMiddle3.rotation":{x:.453,y:.019,z:.013},"RightHandRing1.rotation":{x:.591,y:.241,z:.11},"RightHandRing2.rotation":{x:1.014,y:.023,z:.097},"RightHandRing3.rotation":{x:.708,y:.008,z:.066},"RightHandPinky1.rotation":{x:1.02,y:.305,z:.051},"RightHandPinky2.rotation":{x:1.187,y:-.028,z:.191},"RightHandPinky3.rotation":{x:.872,y:-.031,z:.121},"LeftUpLeg.rotation":{x:-.095,y:-.058,z:-3.338},"LeftLeg.rotation":{x:-.366,y:.287,z:-.021},"LeftFoot.rotation":{x:1.131,y:.21,z:.176},"LeftToeBase.rotation":{x:.739,y:-.068,z:-.001},"RightUpLeg.rotation":{x:-.502,y:.362,z:3.153},"RightLeg.rotation":{x:-1.002,y:.109,z:.008},"RightFoot.rotation":{x:.626,y:-.097,z:-.194},"RightToeBase.rotation":{x:1.33,y:.288,z:-.078}}},turn:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.07,y:-.604,z:-.004},"Spine.rotation":{x:-.007,y:.003,z:.071},"Spine1.rotation":{x:-.053,y:.024,z:-.06},"Spine2.rotation":{x:.074,y:.013,z:-.068},"Neck.rotation":{x:.03,y:.186,z:-.077},"Head.rotation":{x:.045,y:.243,z:-.086},"LeftShoulder.rotation":{x:1.717,y:-.085,z:-1.761},"LeftArm.rotation":{x:1.314,y:.07,z:-.057},"LeftForeArm.rotation":{x:-.151,y:.714,z:.302},"LeftHand.rotation":{x:-.069,y:.003,z:-.118},"LeftHandThumb1.rotation":{x:.23,y:.258,z:.354},"LeftHandThumb2.rotation":{x:-.107,y:-.338,z:-.455},"LeftHandThumb3.rotation":{x:-.015,y:-.142,z:.002},"LeftHandIndex1.rotation":{x:.145,y:.032,z:-.069},"LeftHandIndex2.rotation":{x:.323,y:-.049,z:-.028},"LeftHandIndex3.rotation":{x:.249,y:-.053,z:-.074},"LeftHandMiddle1.rotation":{x:.235,y:-.057,z:-.088},"LeftHandMiddle2.rotation":{x:.468,y:-.036,z:-.081},"LeftHandMiddle3.rotation":{x:.203,y:-.015,z:-.017},"LeftHandRing1.rotation":{x:.185,y:-.118,z:-.157},"LeftHandRing2.rotation":{x:.578,y:.02,z:-.097},"LeftHandRing3.rotation":{x:.27,y:.021,z:-.063},"LeftHandPinky1.rotation":{x:.404,y:-.182,z:-.138},"LeftHandPinky2.rotation":{x:.612,y:.128,z:-.144},"LeftHandPinky3.rotation":{x:.267,y:.094,z:-.081},"RightShoulder.rotation":{x:1.605,y:.17,z:1.625},"RightArm.rotation":{x:1.574,y:-.655,z:.388},"RightForeArm.rotation":{x:-.36,y:-.849,z:-.465},"RightHand.rotation":{x:.114,y:.416,z:-.069},"RightHandThumb1.rotation":{x:.486,y:.009,z:-.492},"RightHandThumb2.rotation":{x:-.073,y:-.01,z:.284},"RightHandThumb3.rotation":{x:-.054,y:-.006,z:.209},"RightHandIndex1.rotation":{x:.245,y:-.014,z:.052},"RightHandIndex2.rotation":{x:.155,y:0,z:0},"RightHandIndex3.rotation":{x:.153,y:0,z:0},"RightHandMiddle1.rotation":{x:.238,y:.004,z:.028},"RightHandMiddle2.rotation":{x:.15,y:0,z:0},"RightHandMiddle3.rotation":{x:.149,y:0,z:0},"RightHandRing1.rotation":{x:.267,y:.012,z:.007},"RightHandRing2.rotation":{x:.169,y:0,z:0},"RightHandRing3.rotation":{x:.167,y:0,z:0},"RightHandPinky1.rotation":{x:.304,y:.018,z:-.021},"RightHandPinky2.rotation":{x:.192,y:0,z:0},"RightHandPinky3.rotation":{x:.19,y:0,z:0},"LeftUpLeg.rotation":{x:-.001,y:-.058,z:-3.238},"LeftLeg.rotation":{x:-.29,y:.058,z:-.021},"LeftFoot.rotation":{x:1.288,y:.168,z:.183},"LeftToeBase.rotation":{x:.363,y:-.09,z:-.01},"RightUpLeg.rotation":{x:-.1,y:.36,z:3.062},"RightLeg.rotation":{x:-.67,y:-.304,z:.043},"RightFoot.rotation":{x:1.195,y:-.159,z:-.294},"RightToeBase.rotation":{x:.737,y:.164,z:-.002}}},bend:{bend:!0,standing:!0,props:{"Hips.position":{x:-.007,y:.943,z:-.001},"Hips.rotation":{x:1.488,y:-.633,z:1.435},"Spine.rotation":{x:-.126,y:.007,z:-.057},"Spine1.rotation":{x:-.134,y:.009,z:.01},"Spine2.rotation":{x:-.019,y:0,z:-.002},"Neck.rotation":{x:-.159,y:.572,z:-.108},"Head.rotation":{x:-.064,y:.716,z:-.257},"RightShoulder.rotation":{x:1.625,y:-.043,z:1.382},"RightArm.rotation":{x:.746,y:-.96,z:-1.009},"RightForeArm.rotation":{x:-.199,y:-.528,z:-.38},"RightHand.rotation":{x:-.261,y:-.043,z:-.027},"RightHandThumb1.rotation":{x:.172,y:-.138,z:-.445},"RightHandThumb2.rotation":{x:-.158,y:.327,z:.545},"RightHandThumb3.rotation":{x:-.062,y:.138,z:.152},"RightHandIndex1.rotation":{x:.328,y:-.005,z:.132},"RightHandIndex2.rotation":{x:.303,y:.049,z:.028},"RightHandIndex3.rotation":{x:.241,y:.046,z:.077},"RightHandMiddle1.rotation":{x:.309,y:.074,z:.089},"RightHandMiddle2.rotation":{x:.392,y:.036,z:.081},"RightHandMiddle3.rotation":{x:.199,y:.014,z:.019},"RightHandRing1.rotation":{x:.239,y:.143,z:.091},"RightHandRing2.rotation":{x:.275,y:-.02,z:.097},"RightHandRing3.rotation":{x:.248,y:-.023,z:.061},"RightHandPinky1.rotation":{x:.211,y:.154,z:.029},"RightHandPinky2.rotation":{x:.348,y:-.128,z:.144},"RightHandPinky3.rotation":{x:.21,y:-.091,z:.065},"LeftShoulder.rotation":{x:1.626,y:-.027,z:-1.367},"LeftArm.rotation":{x:1.048,y:.737,z:.712},"LeftForeArm.rotation":{x:-.508,y:.879,z:.625},"LeftHand.rotation":{x:.06,y:-.243,z:-.079},"LeftHandThumb1.rotation":{x:.187,y:-.072,z:.346},"LeftHandThumb2.rotation":{x:-.066,y:.008,z:-.256},"LeftHandThumb3.rotation":{x:-.085,y:.014,z:-.334},"LeftHandIndex1.rotation":{x:-.1,y:.016,z:-.058},"LeftHandIndex2.rotation":{x:.334,y:0,z:0},"LeftHandIndex3.rotation":{x:.281,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.056,y:0,z:0},"LeftHandMiddle2.rotation":{x:.258,y:0,z:0},"LeftHandMiddle3.rotation":{x:.26,y:0,z:0},"LeftHandRing1.rotation":{x:-.067,y:-.002,z:.008},"LeftHandRing2.rotation":{x:.259,y:0,z:0},"LeftHandRing3.rotation":{x:.276,y:0,z:0},"LeftHandPinky1.rotation":{x:-.128,y:-.007,z:.042},"LeftHandPinky2.rotation":{x:.227,y:0,z:0},"LeftHandPinky3.rotation":{x:.145,y:0,z:0},"RightUpLeg.rotation":{x:-1.507,y:.2,z:-3.043},"RightLeg.rotation":{x:-.689,y:-.124,z:.017},"RightFoot.rotation":{x:.909,y:.008,z:-.093},"RightToeBase.rotation":{x:.842,y:.075,z:-.008},"LeftUpLeg.rotation":{x:-1.449,y:-.2,z:3.018},"LeftLeg.rotation":{x:-.74,y:-.115,z:-.008},"LeftFoot.rotation":{x:1.048,y:-.058,z:.117},"LeftToeBase.rotation":{x:.807,y:-.067,z:.003}}},back:{standing:!0,props:{"Hips.position":{x:0,y:1,z:0},"Hips.rotation":{x:-.732,y:-1.463,z:-.637},"Spine.rotation":{x:-.171,y:.106,z:.157},"Spine1.rotation":{x:-.044,y:.138,z:-.059},"Spine2.rotation":{x:.082,y:.133,z:-.074},"Neck.rotation":{x:.39,y:.591,z:-.248},"Head.rotation":{x:-.001,y:.596,z:-.057},"LeftShoulder.rotation":{x:1.676,y:.007,z:-1.892},"LeftArm.rotation":{x:-5.566,y:1.188,z:-.173},"LeftForeArm.rotation":{x:-.673,y:-.105,z:1.702},"LeftHand.rotation":{x:-.469,y:-.739,z:.003},"LeftHandThumb1.rotation":{x:.876,y:.274,z:.793},"LeftHandThumb2.rotation":{x:.161,y:-.23,z:-.172},"LeftHandThumb3.rotation":{x:.078,y:.027,z:.156},"LeftHandIndex1.rotation":{x:-.085,y:-.002,z:.009},"LeftHandIndex2.rotation":{x:.176,y:0,z:-.002},"LeftHandIndex3.rotation":{x:-.036,y:.001,z:-.035},"LeftHandMiddle1.rotation":{x:.015,y:.144,z:-.076},"LeftHandMiddle2.rotation":{x:.378,y:-.007,z:-.077},"LeftHandMiddle3.rotation":{x:-.141,y:-.001,z:.031},"LeftHandRing1.rotation":{x:.039,y:.02,z:-.2},"LeftHandRing2.rotation":{x:.25,y:-.002,z:-.073},"LeftHandRing3.rotation":{x:.236,y:.006,z:-.075},"LeftHandPinky1.rotation":{x:.172,y:-.033,z:-.275},"LeftHandPinky2.rotation":{x:.216,y:.043,z:-.054},"LeftHandPinky3.rotation":{x:.325,y:.078,z:-.13},"RightShoulder.rotation":{x:2.015,y:-.168,z:1.706},"RightArm.rotation":{x:.203,y:-1.258,z:-.782},"RightForeArm.rotation":{x:-.658,y:-.133,z:-1.401},"RightHand.rotation":{x:-1.504,y:.375,z:-.005},"RightHandThumb1.rotation":{x:.413,y:-.158,z:-1.121},"RightHandThumb2.rotation":{x:-.142,y:-.008,z:.209},"RightHandThumb3.rotation":{x:-.091,y:.021,z:.142},"RightHandIndex1.rotation":{x:-.167,y:.014,z:-.072},"RightHandIndex2.rotation":{x:.474,y:.009,z:.051},"RightHandIndex3.rotation":{x:.115,y:.006,z:.047},"RightHandMiddle1.rotation":{x:.385,y:.019,z:.144},"RightHandMiddle2.rotation":{x:.559,y:.035,z:.101},"RightHandMiddle3.rotation":{x:.229,y:0,z:.027},"RightHandRing1.rotation":{x:.48,y:.026,z:.23},"RightHandRing2.rotation":{x:.772,y:.038,z:.109},"RightHandRing3.rotation":{x:.622,y:.039,z:.106},"RightHandPinky1.rotation":{x:.767,y:.288,z:.353},"RightHandPinky2.rotation":{x:.886,y:.049,z:.122},"RightHandPinky3.rotation":{x:.662,y:.044,z:.113},"LeftUpLeg.rotation":{x:-.206,y:-.268,z:-3.343},"LeftLeg.rotation":{x:-.333,y:.757,z:-.043},"LeftFoot.rotation":{x:1.049,y:.167,z:.287},"LeftToeBase.rotation":{x:.672,y:-.069,z:-.004},"RightUpLeg.rotation":{x:.055,y:-.226,z:3.037},"RightLeg.rotation":{x:-.559,y:.39,z:-.001},"RightFoot.rotation":{x:1.2,y:.133,z:.085},"RightToeBase.rotation":{x:.92,y:.093,z:-.013}}},straight:{standing:!0,props:{"Hips.position":{x:0,y:.989,z:.001},"Hips.rotation":{x:.047,y:.007,z:-.007},"Spine.rotation":{x:-.143,y:-.007,z:.005},"Spine1.rotation":{x:-.043,y:-.014,z:.012},"Spine2.rotation":{x:.072,y:-.013,z:.013},"Neck.rotation":{x:.048,y:-.003,z:.012},"Head.rotation":{x:.05,y:-.02,z:-.017},"LeftShoulder.rotation":{x:1.62,y:-.166,z:-1.605},"LeftArm.rotation":{x:1.275,y:.544,z:-.092},"LeftForeArm.rotation":{x:0,y:0,z:.302},"LeftHand.rotation":{x:-.225,y:-.154,z:.11},"LeftHandThumb1.rotation":{x:.435,y:-.044,z:.457},"LeftHandThumb2.rotation":{x:-.028,y:.002,z:-.246},"LeftHandThumb3.rotation":{x:-.236,y:-.025,z:.113},"LeftHandIndex1.rotation":{x:.218,y:.008,z:-.081},"LeftHandIndex2.rotation":{x:.165,y:-.001,z:-.017},"LeftHandIndex3.rotation":{x:.165,y:-.001,z:-.017},"LeftHandMiddle1.rotation":{x:.235,y:-.011,z:-.065},"LeftHandMiddle2.rotation":{x:.182,y:-.002,z:-.019},"LeftHandMiddle3.rotation":{x:.182,y:-.002,z:-.019},"LeftHandRing1.rotation":{x:.316,y:-.017,z:.008},"LeftHandRing2.rotation":{x:.253,y:-.003,z:-.026},"LeftHandRing3.rotation":{x:.255,y:-.003,z:-.026},"LeftHandPinky1.rotation":{x:.336,y:-.062,z:.088},"LeftHandPinky2.rotation":{x:.276,y:-.004,z:-.028},"LeftHandPinky3.rotation":{x:.276,y:-.004,z:-.028},"RightShoulder.rotation":{x:1.615,y:.064,z:1.53},"RightArm.rotation":{x:1.313,y:-.424,z:.131},"RightForeArm.rotation":{x:0,y:0,z:-.317},"RightHand.rotation":{x:-.158,y:-.639,z:-.196},"RightHandThumb1.rotation":{x:.44,y:.048,z:-.549},"RightHandThumb2.rotation":{x:-.056,y:-.008,z:.274},"RightHandThumb3.rotation":{x:-.258,y:.031,z:-.095},"RightHandIndex1.rotation":{x:.169,y:-.011,z:.105},"RightHandIndex2.rotation":{x:.134,y:.001,z:.011},"RightHandIndex3.rotation":{x:.134,y:.001,z:.011},"RightHandMiddle1.rotation":{x:.288,y:.014,z:.092},"RightHandMiddle2.rotation":{x:.248,y:.003,z:.02},"RightHandMiddle3.rotation":{x:.249,y:.003,z:.02},"RightHandRing1.rotation":{x:.369,y:.019,z:.006},"RightHandRing2.rotation":{x:.321,y:.004,z:.026},"RightHandRing3.rotation":{x:.323,y:.004,z:.026},"RightHandPinky1.rotation":{x:.468,y:.085,z:-.03},"RightHandPinky2.rotation":{x:.427,y:.007,z:.034},"RightHandPinky3.rotation":{x:.142,y:.001,z:.012},"LeftUpLeg.rotation":{x:-.077,y:-.058,z:3.126},"LeftLeg.rotation":{x:-.252,y:.001,z:-.018},"LeftFoot.rotation":{x:1.315,y:-.064,z:.315},"LeftToeBase.rotation":{x:.577,y:-.07,z:-.009},"RightUpLeg.rotation":{x:-.083,y:-.032,z:3.124},"RightLeg.rotation":{x:-.272,y:-.003,z:.021},"RightFoot.rotation":{x:1.342,y:.076,z:-.222},"RightToeBase.rotation":{x:.44,y:.069,z:.016}}},wide:{standing:!0,props:{"Hips.position":{x:0,y:1.017,z:.016},"Hips.rotation":{x:.064,y:-.048,z:.059},"Spine.rotation":{x:-.123,y:0,z:-.018},"Spine1.rotation":{x:.014,y:.003,z:-.006},"Spine2.rotation":{x:.04,y:.003,z:-.007},"Neck.rotation":{x:.101,y:.007,z:-.035},"Head.rotation":{x:-.091,y:-.049,z:.105},"RightShoulder.rotation":{x:1.831,y:.017,z:1.731},"RightArm.rotation":{x:-1.673,y:-1.102,z:-3.132},"RightForeArm.rotation":{x:.265,y:.23,z:-.824},"RightHand.rotation":{x:-.52,y:.345,z:-.061},"RightHandThumb1.rotation":{x:.291,y:.056,z:-.428},"RightHandThumb2.rotation":{x:.025,y:.005,z:.166},"RightHandThumb3.rotation":{x:-.089,y:.009,z:.068},"RightHandIndex1.rotation":{x:.392,y:-.015,z:.11},"RightHandIndex2.rotation":{x:.391,y:.001,z:.004},"RightHandIndex3.rotation":{x:.326,y:0,z:.003},"RightHandMiddle1.rotation":{x:.285,y:.068,z:.081},"RightHandMiddle2.rotation":{x:.519,y:.004,z:.011},"RightHandMiddle3.rotation":{x:.252,y:0,z:.001},"RightHandRing1.rotation":{x:.207,y:.133,z:.146},"RightHandRing2.rotation":{x:.597,y:.004,z:.004},"RightHandRing3.rotation":{x:.292,y:.002,z:.012},"RightHandPinky1.rotation":{x:.338,y:.182,z:.136},"RightHandPinky2.rotation":{x:.533,y:.002,z:.004},"RightHandPinky3.rotation":{x:.194,y:0,z:.002},"LeftShoulder.rotation":{x:1.83,y:-.063,z:-1.808},"LeftArm.rotation":{x:-1.907,y:1.228,z:-2.959},"LeftForeArm.rotation":{x:-.159,y:.268,z:.572},"LeftHand.rotation":{x:.069,y:-.498,z:-.025},"LeftHandThumb1.rotation":{x:.738,y:.123,z:.178},"LeftHandThumb2.rotation":{x:-.26,y:.028,z:-.477},"LeftHandThumb3.rotation":{x:-.448,y:.093,z:-.661},"LeftHandIndex1.rotation":{x:1.064,y:.005,z:-.13},"LeftHandIndex2.rotation":{x:1.55,y:-.143,z:-.136},"LeftHandIndex3.rotation":{x:.722,y:-.076,z:-.127},"LeftHandMiddle1.rotation":{x:1.095,y:-.091,z:.006},"LeftHandMiddle2.rotation":{x:1.493,y:-.174,z:-.151},"LeftHandMiddle3.rotation":{x:.651,y:-.031,z:-.087},"LeftHandRing1.rotation":{x:1.083,y:-.224,z:.072},"LeftHandRing2.rotation":{x:1.145,y:-.107,z:-.195},"LeftHandRing3.rotation":{x:1.208,y:-.134,z:-.158},"LeftHandPinky1.rotation":{x:.964,y:-.383,z:.128},"LeftHandPinky2.rotation":{x:1.457,y:-.146,z:-.159},"LeftHandPinky3.rotation":{x:1.019,y:-.102,z:-.141},"RightUpLeg.rotation":{x:-.221,y:-.233,z:2.87},"RightLeg.rotation":{x:-.339,y:-.043,z:-.041},"RightFoot.rotation":{x:1.081,y:.177,z:.114},"RightToeBase.rotation":{x:.775,y:0,z:0},"LeftUpLeg.rotation":{x:-.185,y:.184,z:3.131},"LeftLeg.rotation":{x:-.408,y:.129,z:.02},"LeftFoot.rotation":{x:1.167,y:-.002,z:-.007},"LeftToeBase.rotation":{x:.723,y:0,z:0}}},oneknee:{kneeling:!0,props:{"Hips.position":{x:-.005,y:.415,z:-.017},"Hips.rotation":{x:-.25,y:.04,z:-.238},"Spine.rotation":{x:.037,y:.043,z:.047},"Spine1.rotation":{x:.317,y:.103,z:.066},"Spine2.rotation":{x:.433,y:.109,z:.054},"Neck.rotation":{x:-.156,y:-.092,z:.059},"Head.rotation":{x:-.398,y:-.032,z:.018},"RightShoulder.rotation":{x:1.546,y:.119,z:1.528},"RightArm.rotation":{x:.896,y:-.247,z:-.512},"RightForeArm.rotation":{x:.007,y:0,z:-1.622},"RightHand.rotation":{x:1.139,y:-.853,z:.874},"RightHandThumb1.rotation":{x:.176,y:.107,z:-.311},"RightHandThumb2.rotation":{x:-.047,y:-.003,z:.12},"RightHandThumb3.rotation":{x:0,y:0,z:0},"RightHandIndex1.rotation":{x:.186,y:.005,z:.125},"RightHandIndex2.rotation":{x:.454,y:.005,z:.015},"RightHandIndex3.rotation":{x:0,y:0,z:0},"RightHandMiddle1.rotation":{x:.444,y:.035,z:.127},"RightHandMiddle2.rotation":{x:.403,y:-.006,z:-.04},"RightHandMiddle3.rotation":{x:0,y:0,z:0},"RightHandRing1.rotation":{x:.543,y:.074,z:.121},"RightHandRing2.rotation":{x:.48,y:-.018,z:-.063},"RightHandRing3.rotation":{x:0,y:0,z:0},"RightHandPinky1.rotation":{x:.464,y:.086,z:.113},"RightHandPinky2.rotation":{x:.667,y:-.06,z:-.128},"RightHandPinky3.rotation":{x:0,y:0,z:0},"LeftShoulder.rotation":{x:1.545,y:-.116,z:-1.529},"LeftArm.rotation":{x:.799,y:.631,z:.556},"LeftForeArm.rotation":{x:-.002,y:.007,z:.926},"LeftHand.rotation":{x:-.508,y:.439,z:.502},"LeftHandThumb1.rotation":{x:.651,y:-.035,z:.308},"LeftHandThumb2.rotation":{x:-.053,y:.008,z:-.11},"LeftHandThumb3.rotation":{x:0,y:0,z:0},"LeftHandIndex1.rotation":{x:.662,y:-.053,z:-.116},"LeftHandIndex2.rotation":{x:.309,y:-.004,z:-.02},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:.501,y:-.062,z:-.12},"LeftHandMiddle2.rotation":{x:.144,y:-.002,z:.016},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.397,y:-.029,z:-.143},"LeftHandRing2.rotation":{x:.328,y:.01,z:.059},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.194,y:.008,z:-.164},"LeftHandPinky2.rotation":{x:.38,y:.031,z:.128},"LeftHandPinky3.rotation":{x:0,y:0,z:0},"RightUpLeg.rotation":{x:-1.594,y:-.251,z:2.792},"RightLeg.rotation":{x:-2.301,y:-.073,z:.055},"RightFoot.rotation":{x:1.553,y:-.207,z:-.094},"RightToeBase.rotation":{x:.459,y:.069,z:.016},"LeftUpLeg.rotation":{x:-.788,y:-.236,z:-2.881},"LeftLeg.rotation":{x:-2.703,y:.012,z:-.047},"LeftFoot.rotation":{x:2.191,y:-.102,z:.019},"LeftToeBase.rotation":{x:1.215,y:-.027,z:.01}}},kneel:{kneeling:!0,lying:!0,props:{"Hips.position":{x:0,y:.532,z:-.002},"Hips.rotation":{x:.018,y:-.008,z:-.017},"Spine.rotation":{x:-.139,y:-.01,z:.002},"Spine1.rotation":{x:.002,y:-.002,z:.001},"Spine2.rotation":{x:.028,y:-.002,z:.001},"Neck.rotation":{x:-.007,y:0,z:-.002},"Head.rotation":{x:-.02,y:-.008,z:-.004},"LeftShoulder.rotation":{x:1.77,y:-.428,z:-1.588},"LeftArm.rotation":{x:.911,y:.343,z:.083},"LeftForeArm.rotation":{x:0,y:0,z:.347},"LeftHand.rotation":{x:.033,y:-.052,z:-.105},"LeftHandThumb1.rotation":{x:.508,y:-.22,z:.708},"LeftHandThumb2.rotation":{x:-.323,y:-.139,z:-.56},"LeftHandThumb3.rotation":{x:-.328,y:.16,z:-.301},"LeftHandIndex1.rotation":{x:.178,y:.248,z:.045},"LeftHandIndex2.rotation":{x:.236,y:-.002,z:-.019},"LeftHandIndex3.rotation":{x:-.062,y:0,z:.005},"LeftHandMiddle1.rotation":{x:.123,y:-.005,z:-.019},"LeftHandMiddle2.rotation":{x:.589,y:-.014,z:-.045},"LeftHandMiddle3.rotation":{x:.231,y:-.002,z:-.019},"LeftHandRing1.rotation":{x:.196,y:-.008,z:-.091},"LeftHandRing2.rotation":{x:.483,y:-.009,z:-.038},"LeftHandRing3.rotation":{x:.367,y:-.005,z:-.029},"LeftHandPinky1.rotation":{x:.191,y:-.269,z:-.246},"LeftHandPinky2.rotation":{x:.37,y:-.006,z:-.029},"LeftHandPinky3.rotation":{x:.368,y:-.005,z:-.029},"RightShoulder.rotation":{x:1.73,y:.434,z:1.715},"RightArm.rotation":{x:.841,y:-.508,z:-.155},"RightForeArm.rotation":{x:0,y:0,z:-.355},"RightHand.rotation":{x:.091,y:.137,z:.197},"RightHandThumb1.rotation":{x:.33,y:.051,z:-.753},"RightHandThumb2.rotation":{x:-.113,y:.075,z:.612},"RightHandThumb3.rotation":{x:-.271,y:-.166,z:.164},"RightHandIndex1.rotation":{x:.073,y:.001,z:-.093},"RightHandIndex2.rotation":{x:.338,y:.006,z:.034},"RightHandIndex3.rotation":{x:.131,y:.001,z:.013},"RightHandMiddle1.rotation":{x:.13,y:.005,z:-.017},"RightHandMiddle2.rotation":{x:.602,y:.018,z:.058},"RightHandMiddle3.rotation":{x:-.031,y:0,z:-.003},"RightHandRing1.rotation":{x:.351,y:.019,z:.045},"RightHandRing2.rotation":{x:.19,y:.002,z:.019},"RightHandRing3.rotation":{x:.21,y:.002,z:.021},"RightHandPinky1.rotation":{x:.256,y:.17,z:.118},"RightHandPinky2.rotation":{x:.451,y:.01,z:.045},"RightHandPinky3.rotation":{x:.346,y:.006,z:.035},"LeftUpLeg.rotation":{x:-.06,y:.1,z:-2.918},"LeftLeg.rotation":{x:-1.933,y:-.01,z:.011},"LeftFoot.rotation":{x:.774,y:-.162,z:-.144},"LeftToeBase.rotation":{x:1.188,y:0,z:0},"RightUpLeg.rotation":{x:-.099,y:-.057,z:2.922},"RightLeg.rotation":{x:-1.93,y:.172,z:-.02},"RightFoot.rotation":{x:.644,y:.251,z:.212},"RightToeBase.rotation":{x:.638,y:-.034,z:-.001}}},sitting:{sitting:!0,lying:!0,props:{"Hips.position":{x:0,y:.117,z:.005},"Hips.rotation":{x:-.411,y:-.049,z:.056},"Spine.rotation":{x:.45,y:-.039,z:-.116},"Spine1.rotation":{x:.092,y:-.076,z:.08},"Spine2.rotation":{x:.073,y:.035,z:.066},"Neck.rotation":{x:.051,y:.053,z:-.079},"Head.rotation":{x:-.169,y:.009,z:.034},"LeftShoulder.rotation":{x:1.756,y:-.037,z:-1.301},"LeftArm.rotation":{x:-.098,y:.016,z:1.006},"LeftForeArm.rotation":{x:-.089,y:.08,z:.837},"LeftHand.rotation":{x:.262,y:-.399,z:.3},"LeftHandThumb1.rotation":{x:.149,y:-.043,z:.452},"LeftHandThumb2.rotation":{x:.032,y:.006,z:-.162},"LeftHandThumb3.rotation":{x:-.086,y:-.005,z:-.069},"LeftHandIndex1.rotation":{x:.145,y:.032,z:-.069},"LeftHandIndex2.rotation":{x:.325,y:-.001,z:-.004},"LeftHandIndex3.rotation":{x:.253,y:0,z:-.003},"LeftHandMiddle1.rotation":{x:.186,y:-.051,z:-.091},"LeftHandMiddle2.rotation":{x:.42,y:-.003,z:-.011},"LeftHandMiddle3.rotation":{x:.153,y:.001,z:-.001},"LeftHandRing1.rotation":{x:.087,y:-.19,z:-.078},"LeftHandRing2.rotation":{x:.488,y:-.004,z:-.005},"LeftHandRing3.rotation":{x:.183,y:-.001,z:-.012},"LeftHandPinky1.rotation":{x:.205,y:-.262,z:.051},"LeftHandPinky2.rotation":{x:.407,y:-.002,z:-.004},"LeftHandPinky3.rotation":{x:.068,y:0,z:-.002},"RightShoulder.rotation":{x:1.619,y:-.139,z:1.179},"RightArm.rotation":{x:.17,y:-.037,z:-1.07},"RightForeArm.rotation":{x:-.044,y:-.056,z:-.665},"RightHand.rotation":{x:.278,y:.454,z:-.253},"RightHandThumb1.rotation":{x:.173,y:.089,z:-.584},"RightHandThumb2.rotation":{x:-.003,y:-.004,z:.299},"RightHandThumb3.rotation":{x:-.133,y:-.002,z:.235},"RightHandIndex1.rotation":{x:.393,y:-.023,z:.108},"RightHandIndex2.rotation":{x:.391,y:.001,z:.004},"RightHandIndex3.rotation":{x:.326,y:0,z:.003},"RightHandMiddle1.rotation":{x:.285,y:.062,z:.086},"RightHandMiddle2.rotation":{x:.519,y:.003,z:.011},"RightHandMiddle3.rotation":{x:.252,y:-.001,z:.001},"RightHandRing1.rotation":{x:.207,y:.122,z:.155},"RightHandRing2.rotation":{x:.597,y:.004,z:.005},"RightHandRing3.rotation":{x:.292,y:.001,z:.012},"RightHandPinky1.rotation":{x:.338,y:.171,z:.149},"RightHandPinky2.rotation":{x:.533,y:.002,z:.004},"RightHandPinky3.rotation":{x:.194,y:0,z:.002},"LeftUpLeg.rotation":{x:-1.957,y:.083,z:-2.886},"LeftLeg.rotation":{x:-1.46,y:.123,z:.005},"LeftFoot.rotation":{x:-.013,y:.016,z:.09},"LeftToeBase.rotation":{x:.744,y:0,z:0},"RightUpLeg.rotation":{x:-1.994,y:.125,z:2.905},"RightLeg.rotation":{x:-1.5,y:-.202,z:-.006},"RightFoot.rotation":{x:-.012,y:-.065,z:.081},"RightToeBase.rotation":{x:.758,y:0,z:0}}}},this.gestureTemplates={handup:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.815,y:[-.4,0,1,2],z:1.575},"LeftHand.rotation":{x:-.529,y:-.2,z:.022},"LeftHandThumb1.rotation":{x:.745,y:-.526,z:.604},"LeftHandThumb2.rotation":{x:-.107,y:-.01,z:-.142},"LeftHandThumb3.rotation":{x:0,y:.001,z:0},"LeftHandIndex1.rotation":{x:-.126,y:-.035,z:-.087},"LeftHandIndex2.rotation":{x:.255,y:.007,z:-.085},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.019,y:-.128,z:-.082},"LeftHandMiddle2.rotation":{x:.233,y:.019,z:-.074},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.005,y:-.241,z:-.122},"LeftHandRing2.rotation":{x:.261,y:.021,z:-.076},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.059,y:-.336,z:-.2},"LeftHandPinky2.rotation":{x:.153,y:.019,z:.001},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},index:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.815,y:[-.4,0,1,2],z:1.575},"LeftHand.rotation":{x:-.276,y:-.506,z:-.208},"LeftHandThumb1.rotation":{x:.579,y:.228,z:.363},"LeftHandThumb2.rotation":{x:-.027,y:-.04,z:-.662},"LeftHandThumb3.rotation":{x:0,y:.001,z:0},"LeftHandIndex1.rotation":{x:0,y:-.105,z:.225},"LeftHandIndex2.rotation":{x:.256,y:-.103,z:-.213},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:1.453,y:.07,z:.021},"LeftHandMiddle2.rotation":{x:1.599,y:.062,z:.07},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:1.528,y:-.073,z:.052},"LeftHandRing2.rotation":{x:1.386,y:.044,z:.053},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:1.65,y:-.204,z:.031},"LeftHandPinky2.rotation":{x:1.302,y:.071,z:.085},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},ok:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,1],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.415,y:[-.4,0,1,2],z:1.575},"LeftHand.rotation":{x:-.476,y:-.506,z:-.208},"LeftHandThumb1.rotation":{x:.703,y:.445,z:.899},"LeftHandThumb2.rotation":{x:-.312,y:-.04,z:-.938},"LeftHandThumb3.rotation":{x:-.37,y:.024,z:-.393},"LeftHandIndex1.rotation":{x:.8,y:-.086,z:-.091},"LeftHandIndex2.rotation":{x:1.123,y:-.046,z:-.074},"LeftHandIndex3.rotation":{x:.562,y:-.013,z:-.043},"LeftHandMiddle1.rotation":{x:-.019,y:-.128,z:-.082},"LeftHandMiddle2.rotation":{x:.233,y:.019,z:-.074},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.005,y:-.241,z:-.122},"LeftHandRing2.rotation":{x:.261,y:.021,z:-.076},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.059,y:-.336,z:-.2},"LeftHandPinky2.rotation":{x:.153,y:.019,z:.001},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},thumbup:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-.415,y:.206,z:1.575},"LeftHand.rotation":{x:-.276,y:-.506,z:-.208},"LeftHandThumb1.rotation":{x:.208,y:-.189,z:.685},"LeftHandThumb2.rotation":{x:.129,y:-.285,z:-.163},"LeftHandThumb3.rotation":{x:-.047,y:.068,z:.401},"LeftHandIndex1.rotation":{x:1.412,y:-.102,z:-.152},"LeftHandIndex2.rotation":{x:1.903,y:-.16,z:-.114},"LeftHandIndex3.rotation":{x:.535,y:-.017,z:-.062},"LeftHandMiddle1.rotation":{x:1.424,y:-.103,z:-.12},"LeftHandMiddle2.rotation":{x:1.919,y:-.162,z:-.114},"LeftHandMiddle3.rotation":{x:.44,y:-.012,z:-.051},"LeftHandRing1.rotation":{x:1.619,y:-.127,z:-.053},"LeftHandRing2.rotation":{x:1.898,y:-.16,z:-.115},"LeftHandRing3.rotation":{x:.262,y:-.004,z:-.031},"LeftHandPinky1.rotation":{x:1.661,y:-.131,z:-.016},"LeftHandPinky2.rotation":{x:1.715,y:-.067,z:-.13},"LeftHandPinky3.rotation":{x:.627,y:-.023,z:-.071}},thumbdown:{"LeftShoulder.rotation":{x:[1.5,2,1,2],y:[.2,.4,1,2],z:[-1.5,-1.3,1,2]},"LeftArm.rotation":{x:[1.5,1.7,1,2],y:[-.6,-.4,1,2],z:[1,1.2,1,2]},"LeftForeArm.rotation":{x:-2.015,y:.406,z:1.575},"LeftHand.rotation":{x:-.176,y:-.206,z:-.208},"LeftHandThumb1.rotation":{x:.208,y:-.189,z:.685},"LeftHandThumb2.rotation":{x:.129,y:-.285,z:-.163},"LeftHandThumb3.rotation":{x:-.047,y:.068,z:.401},"LeftHandIndex1.rotation":{x:1.412,y:-.102,z:-.152},"LeftHandIndex2.rotation":{x:1.903,y:-.16,z:-.114},"LeftHandIndex3.rotation":{x:.535,y:-.017,z:-.062},"LeftHandMiddle1.rotation":{x:1.424,y:-.103,z:-.12},"LeftHandMiddle2.rotation":{x:1.919,y:-.162,z:-.114},"LeftHandMiddle3.rotation":{x:.44,y:-.012,z:-.051},"LeftHandRing1.rotation":{x:1.619,y:-.127,z:-.053},"LeftHandRing2.rotation":{x:1.898,y:-.16,z:-.115},"LeftHandRing3.rotation":{x:.262,y:-.004,z:-.031},"LeftHandPinky1.rotation":{x:1.661,y:-.131,z:-.016},"LeftHandPinky2.rotation":{x:1.715,y:-.067,z:-.13},"LeftHandPinky3.rotation":{x:.627,y:-.023,z:-.071}},side:{"LeftShoulder.rotation":{x:1.755,y:-.035,z:-1.63},"LeftArm.rotation":{x:1.263,y:-.955,z:1.024},"LeftForeArm.rotation":{x:0,y:0,z:.8},"LeftHand.rotation":{x:-.36,y:-1.353,z:-.184},"LeftHandThumb1.rotation":{x:.137,y:-.049,z:.863},"LeftHandThumb2.rotation":{x:-.293,y:.153,z:-.193},"LeftHandThumb3.rotation":{x:-.271,y:-.17,z:.18},"LeftHandIndex1.rotation":{x:-.018,y:.007,z:.28},"LeftHandIndex2.rotation":{x:.247,y:-.003,z:-.025},"LeftHandIndex3.rotation":{x:.13,y:-.001,z:-.013},"LeftHandMiddle1.rotation":{x:.333,y:-.015,z:.182},"LeftHandMiddle2.rotation":{x:.313,y:-.005,z:-.032},"LeftHandMiddle3.rotation":{x:.294,y:-.004,z:-.03},"LeftHandRing1.rotation":{x:.456,y:-.028,z:-.092},"LeftHandRing2.rotation":{x:.53,y:-.014,z:-.052},"LeftHandRing3.rotation":{x:.478,y:-.012,z:-.047},"LeftHandPinky1.rotation":{x:.647,y:-.049,z:-.184},"LeftHandPinky2.rotation":{x:.29,y:-.004,z:-.029},"LeftHandPinky3.rotation":{x:.501,y:-.013,z:-.049}},shrug:{"Neck.rotation":{x:[-.3,.3,1,2],y:[-.3,.3,1,2],z:[-.1,.1]},"Head.rotation":{x:[-.3,.3],y:[-.3,.3],z:[-.1,.1]},"RightShoulder.rotation":{x:1.732,y:-.058,z:1.407},"RightArm.rotation":{x:1.305,y:.46,z:.118},"RightForeArm.rotation":{x:[0,2],y:[-1,.2],z:-1.637},"RightHand.rotation":{x:-.048,y:.165,z:-.39},"RightHandThumb1.rotation":{x:1.467,y:.599,z:-1.315},"RightHandThumb2.rotation":{x:-.255,y:-.123,z:.119},"RightHandThumb3.rotation":{x:0,y:-.002,z:0},"RightHandIndex1.rotation":{x:-.293,y:-.066,z:-.112},"RightHandIndex2.rotation":{x:.181,y:.007,z:.069},"RightHandIndex3.rotation":{x:0,y:0,z:0},"RightHandMiddle1.rotation":{x:-.063,y:-.041,z:.032},"RightHandMiddle2.rotation":{x:.149,y:.005,z:.05},"RightHandMiddle3.rotation":{x:0,y:0,z:0},"RightHandRing1.rotation":{x:.152,y:-.03,z:.132},"RightHandRing2.rotation":{x:.194,y:.007,z:.058},"RightHandRing3.rotation":{x:0,y:0,z:0},"RightHandPinky1.rotation":{x:.306,y:-.015,z:.257},"RightHandPinky2.rotation":{x:.15,y:-.003,z:-.003},"RightHandPinky3.rotation":{x:0,y:0,z:0},"LeftShoulder.rotation":{x:1.713,y:.141,z:-1.433},"LeftArm.rotation":{x:1.136,y:-.422,z:-.416},"LeftForeArm.rotation":{x:1.42,y:.123,z:1.506},"LeftHand.rotation":{x:.073,y:-.138,z:.064},"LeftHandThumb1.rotation":{x:1.467,y:-.599,z:1.314},"LeftHandThumb2.rotation":{x:-.255,y:.123,z:-.119},"LeftHandThumb3.rotation":{x:0,y:.001,z:0},"LeftHandIndex1.rotation":{x:-.293,y:.066,z:.112},"LeftHandIndex2.rotation":{x:.181,y:-.007,z:-.069},"LeftHandIndex3.rotation":{x:0,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.062,y:.041,z:-.032},"LeftHandMiddle2.rotation":{x:.149,y:-.005,z:-.05},"LeftHandMiddle3.rotation":{x:0,y:0,z:0},"LeftHandRing1.rotation":{x:.152,y:.03,z:-.132},"LeftHandRing2.rotation":{x:.194,y:-.007,z:-.058},"LeftHandRing3.rotation":{x:0,y:0,z:0},"LeftHandPinky1.rotation":{x:.306,y:.015,z:-.257},"LeftHandPinky2.rotation":{x:.15,y:.003,z:.003},"LeftHandPinky3.rotation":{x:0,y:0,z:0}},namaste:{"RightShoulder.rotation":{x:1.758,y:.099,z:1.604},"RightArm.rotation":{x:.862,y:-.292,z:-.932},"RightForeArm.rotation":{x:.083,y:.066,z:-1.791},"RightHand.rotation":{x:-.52,y:-.001,z:-.176},"RightHandThumb1.rotation":{x:.227,y:.418,z:-.776},"RightHandThumb2.rotation":{x:-.011,y:-.003,z:.171},"RightHandThumb3.rotation":{x:-.041,y:-.001,z:-.013},"RightHandIndex1.rotation":{x:-.236,y:.003,z:-.028},"RightHandIndex2.rotation":{x:.004,y:0,z:.001},"RightHandIndex3.rotation":{x:.002,y:0,z:0},"RightHandMiddle1.rotation":{x:-.236,y:.003,z:-.028},"RightHandMiddle2.rotation":{x:.004,y:0,z:.001},"RightHandMiddle3.rotation":{x:.002,y:0,z:0},"RightHandRing1.rotation":{x:-.236,y:.003,z:-.028},"RightHandRing2.rotation":{x:.004,y:0,z:.001},"RightHandRing3.rotation":{x:.002,y:0,z:0},"RightHandPinky1.rotation":{x:-.236,y:.003,z:-.028},"RightHandPinky2.rotation":{x:.004,y:0,z:.001},"RightHandPinky3.rotation":{x:.002,y:0,z:0},"LeftShoulder.rotation":{x:1.711,y:-.002,z:-1.625},"LeftArm.rotation":{x:.683,y:.334,z:.977},"LeftForeArm.rotation":{x:.086,y:-.066,z:1.843},"LeftHand.rotation":{x:-.595,y:-.229,z:.096},"LeftHandThumb1.rotation":{x:.404,y:-.05,z:.537},"LeftHandThumb2.rotation":{x:-.02,y:.004,z:-.154},"LeftHandThumb3.rotation":{x:-.049,y:.002,z:-.019},"LeftHandIndex1.rotation":{x:-.113,y:-.001,z:.014},"LeftHandIndex2.rotation":{x:.003,y:0,z:0},"LeftHandIndex3.rotation":{x:.002,y:0,z:0},"LeftHandMiddle1.rotation":{x:-.113,y:-.001,z:.014},"LeftHandMiddle2.rotation":{x:.004,y:0,z:0},"LeftHandMiddle3.rotation":{x:.002,y:0,z:0},"LeftHandRing1.rotation":{x:-.113,y:-.001,z:.014},"LeftHandRing2.rotation":{x:.003,y:0,z:0},"LeftHandRing3.rotation":{x:.002,y:0,z:0},"LeftHandPinky1.rotation":{x:-.122,y:-.001,z:-.057},"LeftHandPinky2.rotation":{x:.012,y:.001,z:.07},"LeftHandPinky3.rotation":{x:.002,y:0,z:0}}},this.poseDelta={props:{"Hips.quaternion":{x:0,y:0,z:0},"Spine.quaternion":{x:0,y:0,z:0},"Spine1.quaternion":{x:0,y:0,z:0},"Neck.quaternion":{x:0,y:0,z:0},"Head.quaternion":{x:0,y:0,z:0},"Spine1.scale":{x:0,y:0,z:0},"Neck.scale":{x:0,y:0,z:0},"LeftArm.scale":{x:0,y:0,z:0},"RightArm.scale":{x:0,y:0,z:0}}},["Left","Right"].forEach(l=>{["Leg","UpLeg","Arm","ForeArm","Hand"].forEach(c=>{this.poseDelta.props[l+c+".quaternion"]={x:0,y:0,z:0}}),["HandThumb","HandIndex","HandMiddle","HandRing","HandPinky"].forEach(c=>{this.poseDelta.props[l+c+"1.quaternion"]={x:0,y:0,z:0},this.poseDelta.props[l+c+"2.quaternion"]={x:0,y:0,z:0},this.poseDelta.props[l+c+"3.quaternion"]={x:0,y:0,z:0}})});const i=new Set;Object.values(this.poseTemplates).forEach(l=>{Object.keys(this.propsToThreeObjects(l.props)).forEach(c=>i.add(c))}),Object.keys(this.poseDelta.props).forEach(l=>{i.add(l)}),this.posePropNames=[...i],this.poseName="side",this.poseWeightOnLeft=!0,this.gesture=null,this.poseCurrentTemplate=this.poseTemplates[this.poseName],this.poseBase=this.poseFactory(this.poseCurrentTemplate),this.poseTarget=this.poseFactory(this.poseCurrentTemplate),this.poseStraight=this.propsToThreeObjects(this.poseTemplates.straight.props),this.poseAvatar=null,this.avatarHeight=1.7,this.animMoods={neutral:{baseline:{eyesLookDown:.1},speech:{deltaRate:0,deltaPitch:0,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1200,500,1e3],vs:{chestInhale:[.5,.5,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["wide"]}}},{delay:[5e3,2e4],vs:{pose:["straight"]}}]},{name:"head",idle:{delay:[0,1e3],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.3,.3]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[200,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},happy:{baseline:{mouthSmile:.2,eyesLookDown:.1},speech:{deltaRate:0,deltaPitch:.1,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1200,500,1e3],vs:{chestInhale:[.5,.5,0]}},{name:"pose",idle:{alt:[{p:.6,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["side"]}}},{p:.1,delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,1e4],vs:{pose:["wide"]}},{delay:[1e3,3e3],vs:{pose:["turn"]}}]},talking:{alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["wide"]}}}]}},{name:"head",idle:{dt:[[1e3,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.3,.3]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthLeft:[[0,.3,2]],mouthSmile:[[0,.2,3]],mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},angry:{baseline:{eyesLookDown:.1,browDownLeft:.6,browDownRight:.6,jawForward:.3,mouthFrownLeft:.7,mouthFrownRight:.7,mouthRollLower:.2,mouthShrugLower:.3,handFistLeft:1,handFistRight:1},speech:{deltaRate:-.2,deltaPitch:.2,deltaVolume:0},anims:[{name:"breathing",delay:500,dt:[1e3,500,1e3],vs:{chestInhale:[.7,.7,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["straight"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["wide"]}}}]},{name:"head",idle:{delay:[100,500],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.2,.2]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},sad:{baseline:{eyesLookDown:.2,browDownRight:.1,browInnerUp:.6,browOuterUpRight:.2,eyeSquintLeft:.7,eyeSquintRight:.7,mouthFrownLeft:.8,mouthFrownRight:.8,mouthLeft:.2,mouthPucker:.5,mouthRollLower:.2,mouthRollUpper:.2,mouthShrugLower:.2,mouthShrugUpper:.2,mouthStretchLeft:.4},speech:{deltaRate:-.2,deltaPitch:-.2,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1e3,500,1e3],vs:{chestInhale:[.3,.3,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.4,delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,1e4],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["oneknee"]}}}]},{name:"head",idle:{delay:[100,500],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.2,.2]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[1e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},fear:{baseline:{browInnerUp:.7,eyeSquintLeft:.5,eyeSquintRight:.5,eyeWideLeft:.6,eyeWideRight:.6,mouthClose:.1,mouthFunnel:.3,mouthShrugLower:.5,mouthShrugUpper:.5},speech:{deltaRate:-.2,deltaPitch:0,deltaVolume:0},anims:[{name:"breathing",delay:500,dt:[1e3,500,1e3],vs:{chestInhale:[.7,.7,0]}},{name:"pose",alt:[{p:.8,delay:[5e3,2e4],vs:{pose:["side"]}},{delay:[5e3,2e4],vs:{pose:["straight"]}},{delay:[5e3,1e4],vs:{pose:["wide"]}},{delay:[5e3,1e4],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["oneknee"]}}}]},{name:"head",idle:{delay:[100,500],dt:[[200,3e3]],vs:{headRotateX:[[-.06,.12]],headRotateY:[[-.7,.7]],headRotateZ:[[-.1,.1]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,2e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-1,1]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[2e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},disgust:{baseline:{browDownLeft:.7,browDownRight:.1,browInnerUp:.3,eyeSquintLeft:1,eyeSquintRight:1,eyeWideLeft:.5,eyeWideRight:.5,eyesRotateX:.05,mouthLeft:.4,mouthPressLeft:.3,mouthRollLower:.3,mouthShrugLower:.3,mouthShrugUpper:.8,mouthUpperUpLeft:.3,noseSneerLeft:1,noseSneerRight:.7},speech:{deltaRate:-.2,deltaPitch:0,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1e3,500,1e3],vs:{chestInhale:[.5,.5,0]}},{name:"pose",alt:[{delay:[5e3,1e4],vs:{pose:["side"]}}]},{name:"head",idle:{delay:[100,500],dt:[[200,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.2,.2]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[2e3,8e3,1,2],dt:[50,[100,300],100],vs:{eyeBlinkLeft:[1,1,0],eyeBlinkRight:[1,1,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[0,.3]],browOuterUpLeft:[[0,.3]],browOuterUpRight:[[0,.3]]}}]},love:{baseline:{browInnerUp:.4,browOuterUpLeft:.2,browOuterUpRight:.2,mouthSmile:.2,eyeBlinkLeft:.6,eyeBlinkRight:.6,eyeWideLeft:.7,eyeWideRight:.7,headRotateX:.1,mouthDimpleLeft:.1,mouthDimpleRight:.1,mouthPressLeft:.2,mouthShrugUpper:.2,mouthUpperUpLeft:.1,mouthUpperUpRight:.1},speech:{deltaRate:-.1,deltaPitch:-.7,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1500,500,1500],vs:{chestInhale:[.8,.8,0]}},{name:"pose",alt:[{p:.4,delay:[5e3,2e4],vs:{pose:["side"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["straight"]}},{p:.2,delay:[5e3,2e4],vs:{pose:["hip"]},M:{delay:[5e3,2e4],vs:{pose:["side"]}}},{delay:[5e3,1e4],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["kneel"]}}},{delay:[1e3,3e3],vs:{pose:["turn"]},M:{delay:[1e3,3e3],vs:{pose:["wide"]}}},{delay:[1e3,3e3],vs:{pose:["back"]},M:{delay:[1e3,3e3],vs:{pose:["wide"]}}},{delay:[5e3,2e4],vs:{pose:["side"]},M:{delay:[5e3,2e4],vs:{pose:["side"]}},full:{delay:[5e3,2e4],vs:{pose:["bend"]}}},{delay:[1e3,3e3],vs:{pose:["side"]},full:{delay:[5e3,1e4],vs:{pose:["oneknee"]}}}]},{name:"head",idle:{dt:[[1e3,5e3]],vs:{headRotateX:[[-.04,.1]],headRotateY:[[-.3,.3]],headRotateZ:[[-.08,.08]]}},talking:{dt:[[0,1e3,0]],vs:{headRotateX:[[-.05,.15,1,2]],headRotateY:[[-.1,.1]],headRotateZ:[[-.1,.1]]}}},{name:"eyes",delay:[300,5e3],dt:[[100,500],[100,5e3,2]],vs:{eyesRotateY:[[-.6,.6]],eyesRotateX:[[-.2,.6]]}},{name:"blink",delay:[2e3,8e3,1,2],dt:[50,[200,300],100],vs:{eyeBlinkLeft:[.6,.6,0],eyeBlinkRight:[.6,.6,0]}},{name:"mouth",delay:[1e3,5e3],dt:[[100,500],[100,5e3,2]],vs:{mouthLeft:[[0,.3,2]],mouthRollLower:[[0,.3,2]],mouthRollUpper:[[0,.3,2]],mouthStretchLeft:[[0,.3]],mouthStretchRight:[[0,.3]],mouthPucker:[[0,.3]]}},{name:"misc",delay:[100,5e3],dt:[[500,1e3],[1e3,5e3,2]],vs:{eyeSquintLeft:[[0,.3,3]],eyeSquintRight:[[0,.3,3]],browInnerUp:[[.3,.6]],browOuterUpLeft:[[.1,.3]],browOuterUpRight:[[.1,.3]]}}]},sleep:{baseline:{eyeBlinkLeft:1,eyeBlinkRight:1,eyesClosed:.6},speech:{deltaRate:0,deltaPitch:-.2,deltaVolume:0},anims:[{name:"breathing",delay:1500,dt:[1e3,500,1e3],vs:{chestInhale:[.6,.6,0]}},{name:"pose",alt:[{delay:[5e3,2e4],vs:{pose:["side"]}}]},{name:"head",delay:[1e3,5e3],dt:[[2e3,1e4]],vs:{headRotateX:[[0,.4]],headRotateY:[[-.1,.1]],headRotateZ:[[-.04,.04]]}},{name:"eyes",delay:10010,dt:[],vs:{}},{name:"blink",delay:10020,dt:[],vs:{}},{name:"mouth",delay:10030,dt:[],vs:{}},{name:"misc",delay:10040,dt:[],vs:{}}]}},this.moodName=this.opt.avatarMood||"neutral",this.mood=this.animMoods[this.moodName],this.mood||(this.moodName="neutral",this.mood=this.animMoods.neutral),this.randomized=["mouthDippleLeft","mouthDippleRight","mouthLeft","mouthPress","mouthStretchLeft","mouthStretchRight","mouthShrugLower","mouthShrugUpper","noseSneerLeft","noseSneerRight","mouthRollLower","mouthRollUpper","browDownLeft","browDownRight","browOuterUpLeft","browOuterUpRight","cheekPuff","cheekSquintLeft","cheekSquintRight"],this.animEmojis={"😐":{dt:[300,2e3],vs:{pose:["straight"],browInnerUp:[.4],eyeWideLeft:[.7],eyeWideRight:[.7],mouthPressLeft:[.6],mouthPressRight:[.6],mouthRollLower:[.3],mouthStretchLeft:[1],mouthStretchRight:[1]}},"😶":{link:"😐"},"😏":{dt:[300,2e3],vs:{browDownRight:[.1],browInnerUp:[.7],browOuterUpRight:[.2],eyeLookInRight:[.7],eyeLookOutLeft:[.7],eyeSquintLeft:[1],eyeSquintRight:[.8],eyesRotateY:[.7],mouthLeft:[.4],mouthPucker:[.4],mouthShrugLower:[.3],mouthShrugUpper:[.2],mouthSmile:[.2],mouthSmileLeft:[.4],mouthSmileRight:[.2],mouthStretchLeft:[.5],mouthUpperUpLeft:[.6],noseSneerLeft:[.7]}},"🙂":{dt:[300,2e3],vs:{mouthSmile:[.5]}},"🙃":{link:"🙂"},"😊":{dt:[300,1e3,1e3],vs:{browInnerUp:[.6],eyeSquintLeft:[1],eyeSquintRight:[1],mouthSmile:[.7],noseSneerLeft:[.7],noseSneerRight:[.7]}},"😇":{link:"😊"},"😀":{dt:[300,2e3],vs:{browInnerUp:[.6],jawOpen:[.1],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"😃":{dt:[300,2e3],vs:{browInnerUp:[.6],eyeWideLeft:[.7],eyeWideRight:[.7],jawOpen:[.1],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"😄":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],jawOpen:[.2],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"😁":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],jawOpen:[.3],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthPressLeft:[.5],mouthPressRight:[.5],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"😆":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.6],jawOpen:[.3],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthPressLeft:[.5],mouthPressRight:[.5],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"😝":{dt:[300,100,1500,500,500],vs:{browInnerUp:[.8],eyesClosed:[1],jawOpen:[.7],mouthFunnel:[.5],mouthSmile:[1],tongueOut:[0,1,1,0]}},"😋":{link:"😝"},"😛":{link:"😝"},"😛":{link:"😝"},"😜":{link:"😝"},"🤪":{link:"😝"},"😂":{dt:[300,2e3],vs:{browInnerUp:[.3],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.6],jawOpen:[.3],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthPressLeft:[.5],mouthPressRight:[.5],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"🤣":{link:"😂"},"😅":{link:"😂"},"😉":{dt:[500,200,500,500],vs:{mouthSmile:[.5],mouthOpen:[.2],mouthSmileLeft:[0,.5,0],eyeBlinkLeft:[0,.7,0],eyeBlinkRight:[0,0,0],headRotateX:[.05,.05,.05,0],headRotateZ:[-.05,-.05,-.05,0],browDownLeft:[0,.7,0],cheekSquintLeft:[0,.7,0],eyeSquintLeft:[0,1,0],eyesClosed:[0]}},"😭":{dt:[1e3,1e3],vs:{browInnerUp:[1],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.1],jawOpen:[0],mouthFrownLeft:[1],mouthFrownRight:[1],mouthOpen:[.5],mouthPucker:[.5],mouthUpperUpLeft:[.6],mouthUpperUpRight:[.6]}},"🥺":{dt:[1e3,1e3],vs:{browDownLeft:[.2],browDownRight:[.2],browInnerUp:[1],eyeWideLeft:[.9],eyeWideRight:[.9],eyesClosed:[.1],mouthClose:[.2],mouthFrownLeft:[1],mouthFrownRight:[1],mouthPressLeft:[.4],mouthPressRight:[.4],mouthPucker:[1],mouthRollLower:[.6],mouthRollUpper:[.2],mouthUpperUpLeft:[.8],mouthUpperUpRight:[.8]}},"😞":{dt:[1e3,1e3],vs:{browInnerUp:[.7],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.5],headRotateX:[.3],mouthClose:[.2],mouthFrownLeft:[1],mouthFrownRight:[1],mouthPucker:[1],mouthRollLower:[1],mouthShrugLower:[.2],mouthUpperUpLeft:[.8],mouthUpperUpRight:[.8]}},"😔":{dt:[1e3,1e3],vs:{browInnerUp:[1],eyeSquintLeft:[1],eyeSquintRight:[1],eyesClosed:[.5],headRotateX:[.3],mouthClose:[.2],mouthFrownLeft:[1],mouthFrownRight:[1],mouthPressLeft:[.4],mouthPressRight:[.4],mouthPucker:[1],mouthRollLower:[.6],mouthRollUpper:[.2],mouthUpperUpLeft:[.8],mouthUpperUpRight:[.8]}},"😳":{dt:[1e3,1e3],vs:{browInnerUp:[1],eyeWideLeft:[.5],eyeWideRight:[.5],eyesRotateY:[.05],eyesRotateX:[.05],mouthClose:[.2],mouthFunnel:[.5],mouthPucker:[.4],mouthRollLower:[.4],mouthRollUpper:[.4]}},"☹️":{dt:[500,1500],vs:{mouthFrownLeft:[1],mouthFrownRight:[1],mouthPucker:[.1],mouthRollLower:[.8]}},"😚":{dt:[500,1e3,1e3],vs:{browInnerUp:[.6],eyeBlinkLeft:[1],eyeBlinkRight:[1],eyeSquintLeft:[1],eyeSquintRight:[1],mouthPucker:[0,.5],noseSneerLeft:[0,.7],noseSneerRight:[0,.7],viseme_U:[0,1]}},"😘":{dt:[500,500,200,500],vs:{browInnerUp:[.6],eyeBlinkLeft:[0,0,1,0],eyeBlinkRight:[0],eyesRotateY:[0],headRotateY:[0],headRotateX:[0,.05,.05,0],headRotateZ:[0,-.05,-.05,0],eyeSquintLeft:[1],eyeSquintRight:[1],mouthPucker:[0,.5,0],noseSneerLeft:[0,.7],noseSneerRight:[.7],viseme_U:[0,1]}},"🥰":{dt:[1e3,1e3],vs:{browInnerUp:[.6],eyeSquintLeft:[1],eyeSquintRight:[1],mouthSmile:[.7],noseSneerLeft:[.7],noseSneerRight:[.7]}},"😍":{dt:[1e3,1e3],vs:{browInnerUp:[.6],jawOpen:[.1],mouthDimpleLeft:[.2],mouthDimpleRight:[.2],mouthOpen:[.3],mouthPressLeft:[.3],mouthPressRight:[.3],mouthRollLower:[.4],mouthShrugUpper:[.4],mouthSmile:[.7],mouthUpperUpLeft:[.3],mouthUpperUpRight:[.3],noseSneerLeft:[.4],noseSneerRight:[.4]}},"🤩":{link:"😍"},"😡":{dt:[1e3,1500],vs:{browDownLeft:[1],browDownRight:[1],eyesLookUp:[.2],jawForward:[.3],mouthFrownLeft:[1],mouthFrownRight:[1],headRotateX:[.15]}},"😠":{dt:[1e3,1500],vs:{browDownLeft:[1],browDownRight:[1],eyesLookUp:[.2],jawForward:[.3],mouthFrownLeft:[1],mouthFrownRight:[1],headRotateX:[.15]}},"🤬":{link:"😠"},"😒":{dt:[1e3,1e3],vs:{browDownRight:[.1],browInnerUp:[.7],browOuterUpRight:[.2],eyeLookInRight:[.7],eyeLookOutLeft:[.7],eyeSquintLeft:[1],eyeSquintRight:[.8],eyesRotateY:[.7],mouthFrownLeft:[1],mouthFrownRight:[1],mouthLeft:[.2],mouthPucker:[.5],mouthRollLower:[.2],mouthRollUpper:[.2],mouthShrugLower:[.2],mouthShrugUpper:[.2],mouthStretchLeft:[.5]}},"😱":{dt:[500,1500],vs:{browInnerUp:[.8],eyeWideLeft:[.5],eyeWideRight:[.5],jawOpen:[.7],mouthFunnel:[.5]}},"😬":{dt:[500,1500],vs:{browDownLeft:[1],browDownRight:[1],browInnerUp:[1],mouthDimpleLeft:[.5],mouthDimpleRight:[.5],mouthLowerDownLeft:[1],mouthLowerDownRight:[1],mouthPressLeft:[.4],mouthPressRight:[.4],mouthPucker:[.5],mouthSmile:[.1],mouthSmileLeft:[.2],mouthSmileRight:[.2],mouthStretchLeft:[1],mouthStretchRight:[1],mouthUpperUpLeft:[1],mouthUpperUpRight:[1]}},"🙄":{dt:[500,1500],vs:{browInnerUp:[.8],eyeWideLeft:[1],eyeWideRight:[1],eyesRotateX:[-.8],headRotateX:[.15],mouthPucker:[.5],mouthRollLower:[.6],mouthRollUpper:[.5],mouthShrugLower:[0],mouthSmile:[0]}},"🤔":{dt:[500,1500],vs:{browDownLeft:[1],browOuterUpRight:[1],eyeSquintLeft:[.6],mouthFrownLeft:[.7],mouthFrownRight:[.7],mouthLowerDownLeft:[.3],mouthPressRight:[.4],mouthPucker:[.1],mouthRight:[.5],mouthRollLower:[.5],mouthRollUpper:[.2],handRight:[{x:.1,y:.1,z:.1,d:1e3},{d:1e3}],handFistRight:[.1]}},"👀":{dt:[500,1500],vs:{eyesRotateY:[-.8]}},"😴":{dt:[5e3,5e3],vs:{eyeBlinkLeft:[1],eyeBlinkRight:[1],headRotateX:[.2],headRotateZ:[.1]}},"✋":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["handup",2,!0],null]}},"🤚":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["handup",2],null]}},"👋":{link:"✋"},"👍":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["thumbup",2],null]}},"👎":{dt:[300,2e3],vs:{browDownLeft:[1],browDownRight:[1],eyesLookUp:[.2],jawForward:[.3],mouthFrownLeft:[1],mouthFrownRight:[1],headRotateX:[.15],gesture:[["thumbdown",2],null]}},"👌":{dt:[300,2e3],vs:{mouthSmile:[.5],gesture:[["ok",2],null]}},"🤷‍♂️":{dt:[1e3,1500],vs:{gesture:[["shrug",2],null]}},"🤷‍♀️":{link:"🤷‍♂️"},"🤷":{link:"🤷‍♂️"},"🙏":{dt:[1500,300,1e3],vs:{eyeBlinkLeft:[0,1],eyeBlinkRight:[0,1],headRotateX:[0],headRotateZ:[.1],gesture:[["namaste",2],null]}},yes:{dt:[[200,500],[200,500],[200,500],[200,500]],vs:{headRotateX:[[.1,.2],.1,[.1,.2],0],headRotateZ:[[-.2,.2]]}},no:{dt:[[200,500],[200,500],[200,500],[200,500],[200,500]],vs:{headRotateY:[[-.1,-.05],[.05,.1],[-.1,-.05],[.05,.1],0],headRotateZ:[[-.2,.2]]}}},this.animBaseline={},this.animFixed={},this.animQueue=[],this.animClips=[],this.animPoses=[],this.animFrameDur=1e3/this.opt.modelFPS,this.animClock=0,this.animSlowdownRate=1,this.animTimeLast=0,this.easing=this.sigmoidFactory(5),this.lipsync={},this.opt.lipsyncModules.forEach(l=>this.lipsyncGetProcessor(l)),this.visemeNames=["aa","E","I","O","U","PP","SS","TH","DD","FF","kk","nn","RR","CH","sil"],this.audioCtx=new AudioContext,this.audioSpeechSource=this.audioCtx.createBufferSource(),this.audioBackgroundSource=this.audioCtx.createBufferSource(),this.audioBackgroundGainNode=this.audioCtx.createGain(),this.audioSpeechGainNode=this.audioCtx.createGain(),this.audioReverbNode=this.audioCtx.createConvolver(),this.setReverb(null),this.audioBackgroundGainNode.connect(this.audioReverbNode),this.audioSpeechGainNode.connect(this.audioReverbNode),this.audioReverbNode.connect(this.audioCtx.destination),this.audioPlaylist=[];const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";this.b64Lookup=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let l=0;l<r.length;l++)this.b64Lookup[r.charCodeAt(l)]=l;if(this.stateName="idle",this.speechQueue=[],this.isSpeaking=!1,this.opt.ttsEndpoint){let l=new Audio;if(l.canPlayType("audio/ogg"))this.ttsAudioEncoding="OGG-OPUS";else if(l.canPlayType("audio/mp3"))this.ttsAudioEncoding="MP3";else throw new Error("There was no support for either OGG or MP3 audio.")}else throw new Error("You must provide some Google-compliant Text-To-Speech Endpoint.");this.renderer=new Hne({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this.opt.modelPixelRatio*window.devicePixelRatio),this.renderer.setSize(this.nodeAvatar.clientWidth,this.nodeAvatar.clientHeight),this.renderer.outputColorSpace=on,this.renderer.toneMapping=TB,this.renderer.shadowMap.enabled=!1,this.nodeAvatar.appendChild(this.renderer.domElement),this.camera=new cr(10,this.nodeAvatar.clientWidth/this.nodeAvatar.clientHeight,.1,2e3),this.scene=new t5,this.lightAmbient=new h5(new Ge(this.opt.lightAmbientColor),this.opt.lightAmbientIntensity),this.lightDirect=new nA(new Ge(this.opt.lightDirectColor),this.opt.lightDirectIntensity),this.lightSpot=new tA(new Ge(this.opt.lightSpotColor),this.opt.lightSpotIntensity,0,this.opt.lightSpotDispersion),this.setLighting(this.opt);const s=new YR(this.renderer);s.compileEquirectangularShader(),this.scene.environment=s.fromScene(new _se).texture,this.resizeobserver=new ResizeObserver(this.onResize.bind(this)),this.resizeobserver.observe(this.nodeAvatar),this.controls=new qie(this.camera,this.renderer.domElement),this.controls.enableZoom=this.opt.cameraZoomEnable,this.controls.enableRotate=this.opt.cameraRotateEnable,this.controls.enablePan=this.opt.cameraPanEnable,this.controls.minDistance=2,this.controls.maxDistance=2e3,this.controls.autoRotateSpeed=0,this.controls.autoRotate=!1,this.controls.update(),this.cameraClock=null,this.ikMesh=new Y2;const o={LeftShoulder:null,LeftArm:"LeftShoulder",LeftForeArm:"LeftArm",LeftHand:"LeftForeArm",LeftHandMiddle1:"LeftHand",RightShoulder:null,RightArm:"RightShoulder",RightForeArm:"RightArm",RightHand:"RightForeArm",RightHandMiddle1:"RightHand"},a=[];Object.entries(o).forEach((l,c)=>{const u=new Qg;u.name=l[0],l[1]?this.ikMesh.getObjectByName(l[1]).add(u):this.ikMesh.add(u),a.push(u)}),this.ikMesh.bind(new D0(a))}b64ToArrayBuffer(e){let n=3*e.length/4;e[e.length-1]==="="&&(n--,e[e.length-2]==="="&&n--);const i=new ArrayBuffer(n),r=new Uint8Array(i);let s,o=0,a,l,c,u;for(s=0;s<e.length;s+=4)a=this.b64Lookup[e.charCodeAt(s)],l=this.b64Lookup[e.charCodeAt(s+1)],c=this.b64Lookup[e.charCodeAt(s+2)],u=this.b64Lookup[e.charCodeAt(s+3)],r[o++]=a<<2|l>>4,r[o++]=(l&15)<<4|c>>2,r[o++]=(c&3)<<6|u&63;return i}concatArrayBuffers(e){let n=0;for(let o=0;o<e.length;o++)n+=e[o].byteLength;let i=new ArrayBuffer(n),r=new Uint8Array(i),s=0;for(let o=0;o<e.length;o++)r.set(new Uint8Array(e[o]),s),s+=e[o].byteLength;return i}pcmToAudioBuffer(e){const n=new Int16Array(e),i=new Float32Array(n.length);for(let s=0;s<n.length;s++)i[s]=n[s]>=32768?-(65536-n[s])/32768:n[s]/32767;const r=this.audioCtx.createBuffer(1,i.length,this.opt.pcmSampleRate);return r.copyToChannel(i,0,0),r}propsToThreeObjects(e){const n={};for(let[i,r]of Object.entries(e)){const s=i.split(".");let o,a=Array.isArray(r.x)?this.gaussianRandom(...r.x):r.x,l=Array.isArray(r.y)?this.gaussianRandom(...r.y):r.y,c=Array.isArray(r.z)?this.gaussianRandom(...r.z):r.z;s[1]==="position"||s[1]==="scale"?o=new N(a,l,c):s[1]==="rotation"?(i=s[0]+".quaternion",o=new qt().setFromEuler(new fn(a,l,c,"XYZ")).normalize()):s[1]==="quaternion"&&(o=new qt(a,l,c,r.w).normalize()),o&&(n[i]=o)}return n}clearThree(e){for(;e.children.length;)this.clearThree(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach(n=>{e.material[n]&&e.material[n]!==null&&typeof e.material[n].dispose=="function"&&e.material[n].dispose()}),e.material.dispose())}async showAvatar(e,n=null){if(!e||!e.hasOwnProperty("url"))throw new Error("Invalid parameter. The avatar must have at least 'url' specified.");let r=await new ore().loadAsync(e.url,n);const s=[this.opt.modelRoot];if(this.posePropNames.forEach(a=>s.push(a.split(".")[0])),s.forEach(a=>{if(!r.scene.getObjectByName(a))throw new Error("Avatar object "+a+" not found")}),this.stop(),this.avatar=e,this.mixer=null,this.armature&&this.clearThree(this.scene),this.armature=r.scene.getObjectByName(this.opt.modelRoot),this.armature.scale.setScalar(1),this.morphs=[],this.armature.traverse(a=>{a.morphTargetInfluences&&a.morphTargetInfluences.length&&a.morphTargetDictionary&&this.morphs.push(a),a.frustumCulled=!1}),this.morphs.length===0)throw new Error("Blend shapes not found");this.poseAvatar={props:{}},this.posePropNames.forEach(a=>{const l=a.split("."),c=this.armature.getObjectByName(l[0]);this.poseAvatar.props[a]=c[l[1]],this.poseBase.props.hasOwnProperty(a)?this.poseAvatar.props[a].copy(this.poseBase.props[a]):this.poseBase.props[a]=this.poseAvatar.props[a].clone(),this.poseDelta.props.hasOwnProperty(a)&&!this.poseTarget.props.hasOwnProperty(a)&&(this.poseTarget.props[a]=this.poseAvatar.props[a].clone()),this.poseTarget.props[a].t=this.animClock,this.poseTarget.props[a].d=2e3}),this.ikMesh.traverse(a=>{a.isBone&&a.position.copy(this.armature.getObjectByName(a.name).position)}),this.scene.add(r.scene),this.scene.add(this.lightAmbient),this.scene.add(this.lightDirect),this.scene.add(this.lightSpot),this.lightSpot.target=this.armature.getObjectByName("Head");const o=new N;this.armature.getObjectByName("LeftEye").getWorldPosition(o),this.avatarHeight=o.y+.2,this.viewName||this.setView(this.opt.cameraView),this.setMood(this.avatar.avatarMood||this.moodName||this.opt.avatarMood),this.start()}getViewNames(){return["full","mid","upper","head"]}getView(){return this.viewName}setView(e,n=null){if(e!=="full"&&e!=="upper"&&e!=="head"&&e!=="mid")return;if(!this.armature){this.opt.cameraView=e;return}this.viewName=e||this.viewName,n=n||{};const i=this.camera.fov*(Math.PI/180);let r=-(n.cameraX||this.opt.cameraX)*Math.tan(i/2),s=(1-(n.cameraY||this.opt.cameraY))*Math.tan(i/2),o=n.cameraDistance||this.opt.cameraDistance;this.viewName==="head"?(o+=2,s=s*o+4*this.avatarHeight/5):this.viewName==="upper"?(o+=4.5,s=s*o+2*this.avatarHeight/3):this.viewName==="mid"?(o+=8,s=s*o+this.avatarHeight/3):(o+=12,s=s*o),r=r*o,this.controlsEnd=new N(r,s,0),this.cameraEnd=new N(r,s,o).applyEuler(new fn(n.cameraRotateX||n.cameraRotateX,n.cameraRotateY||this.opt.cameraRotateY,0)),this.cameraClock===null&&(this.controls.target.copy(this.controlsEnd),this.camera.position.copy(this.cameraEnd)),this.controlsStart=this.controls.target.clone(),this.cameraStart=this.camera.position.clone(),this.cameraClock=0}setLighting(e){e=e||{},e.hasOwnProperty("lightAmbientColor")&&this.lightAmbient.color.set(new Ge(e.lightAmbientColor)),e.hasOwnProperty("lightAmbientIntensity")&&(this.lightAmbient.intensity=e.lightAmbientIntensity,this.lightAmbient.visible=e.lightAmbientIntensity!==0),e.hasOwnProperty("lightDirectColor")&&this.lightDirect.color.set(new Ge(e.lightDirectColor)),e.hasOwnProperty("lightDirectIntensity")&&(this.lightDirect.intensity=e.lightDirectIntensity,this.lightDirect.visible=e.lightDirectIntensity!==0),e.hasOwnProperty("lightDirectPhi")&&e.hasOwnProperty("lightDirectTheta")&&this.lightDirect.position.setFromSphericalCoords(2,e.lightDirectPhi,e.lightDirectTheta),e.hasOwnProperty("lightSpotColor")&&this.lightSpot.color.set(new Ge(e.lightSpotColor)),e.hasOwnProperty("lightSpotIntensity")&&(this.lightSpot.intensity=e.lightSpotIntensity,this.lightSpot.visible=e.lightSpotIntensity!==0),e.hasOwnProperty("lightSpotPhi")&&e.hasOwnProperty("lightSpotTheta")&&(this.lightSpot.position.setFromSphericalCoords(2,e.lightSpotPhi,e.lightSpotTheta),this.lightSpot.position.add(new N(0,1.5,0))),e.hasOwnProperty("lightSpotDispersion")&&(this.lightSpot.angle=e.lightSpotDispersion)}render(){if(this.isRunning){const e=this.getValue("eyeBlinkLeft"),n=this.getValue("eyeBlinkRight"),i=this.getValue("eyesLookDown")/2,r=i+this.getValue("browDownLeft")/2,s=i+this.getValue("browDownRight")/2;this.setValue("eyeBlinkLeft",Math.max(e,r)),this.setValue("eyeBlinkRight",Math.max(n,s)),this.renderer.render(this.scene,this.camera),this.setValue("eyeBlinkLeft",e),this.setValue("eyeBlinkRight",n)}}onResize(){this.camera.aspect=this.nodeAvatar.clientWidth/this.nodeAvatar.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.nodeAvatar.clientWidth,this.nodeAvatar.clientHeight),this.controls.update(),this.renderer.render(this.scene,this.camera)}updatePoseBase(e){for(const[n,i]of Object.entries(this.poseTarget.props)){const r=this.poseAvatar.props[n];if(r){const s=(e-i.t)/i.d;s>1||!this.poseBase.props.hasOwnProperty(n)?r.copy(i):r.isQuaternion?r.copy(this.poseBase.props[n].slerp(i,this.easing(s))):r.isVector3&&r.copy(this.poseBase.props[n].lerp(i,this.easing(s)))}}}updatePoseDelta(){for(const[e,n]of Object.entries(this.poseDelta.props)){const i=new fn(n.x,n.y,n.z),r=this.poseAvatar.props[e];if(r.isQuaternion){const s=new qt().setFromEuler(i).normalize();r.multiply(s)}else r.isVector3&&r.add(i)}}getPoseString(e,n=1e3){let i="{";return Object.entries(e).forEach((r,s)=>{const o=r[0].split(".");if(o[1]==="position"||o[1]==="rotation"||o[1]==="quaternion"){const a=o[1]==="quaternion"?o[0]+".rotation":r[0],l=r[1].isQuaternion?new fn().setFromQuaternion(r[1]):r[1];i+=(s?", ":"")+"'"+a+"':{",i+="x:"+Math.round(l.x*n)/n,i+=", y:"+Math.round(l.y*n)/n,i+=", z:"+Math.round(l.z*n)/n,i+="}"}}),i+="}",i}getPoseTemplateProp(e){const n=e.split(".");let i=n[0]+"."+(n[1]==="rotation"?"quaternion":n[1]);if(this.gesture&&this.gesture.hasOwnProperty(i))return this.gesture[i].clone();{let r=n[0]+"."+(n[1]==="quaternion"?"rotation":n[1]);this.poseWeightOnLeft||(r.startsWith("Left")?(r="Right"+r.substring(4),i="Right"+i.substring(4)):r.startsWith("Right")&&(r="Left"+r.substring(5),i="Left"+i.substring(5)));let s;if(this.poseTarget.template.props.hasOwnProperty(i)){const o={};o[i]=this.poseTarget.template.props[i],s=this.propsToThreeObjects(o)[i]}else if(this.poseTarget.template.props.hasOwnProperty(r)){const o={};o[r]=this.poseTarget.template.props[r],s=this.propsToThreeObjects(o)[i]}return s&&!this.poseWeightOnLeft&&s.isQuaternion&&(s.x*=-1,s.w*=-1),s}}mirrorPose(e){const n={};for(let[i,r]of Object.entries(e))r.isQuaternion&&(i.startsWith("Left")?i="Right"+i.substring(4):i.startsWith("Right")&&(i="Left"+i.substring(5)),r.x*=-1,r.w*=-1),n[i]=r.clone(),n[i].t=r.t,n[i].d=r.d;return n}poseFactory(e,n=2e3){const i={template:e,props:this.propsToThreeObjects(e.props)};for(const[r,s]of Object.entries(i.props)){if(this.opt.modelMovementFactor<1&&e.standing&&(r==="Hips.quaternion"||r==="Spine.quaternion"||r==="Spine1.quaternion"||r==="Spine2.quaternion"||r==="Neck.quaternion"||r==="LeftUpLeg.quaternion"||r==="LeftLeg.quaternion"||r==="RightUpLeg.quaternion"||r==="RightLeg.quaternion")){const o=this.poseStraight[r],a=s.angleTo(o);s.rotateTowards(o,(1-this.opt.modelMovementFactor)*a)}s.t=this.animClock,s.d=n}return i}setPoseFromTemplate(e,n=2e3){const i=e&&this.poseTarget&&this.poseTarget.template&&(this.poseTarget.template.standing&&e.lying||this.poseTarget.template.lying&&e.standing),r=e&&e===this.poseCurrentTemplate,s=this.poseWeightOnLeft;let o=i?1e3:n;if(i?(this.poseCurrentTemplate=this.poseTemplates.oneknee,setTimeout(()=>{this.setPoseFromTemplate(e,n)},o)):this.poseCurrentTemplate=e||this.poseCurrentTemplate,this.poseTarget=this.poseFactory(this.poseCurrentTemplate,o),this.poseWeightOnLeft=!0,(!r&&!s||r&&s)&&(this.poseTarget.props=this.mirrorPose(this.poseTarget.props),this.poseWeightOnLeft=!this.poseWeightOnLeft),this.gesture)for(let[a,l]of Object.entries(this.gesture))this.poseTarget.props.hasOwnProperty(a)&&(this.poseTarget.props[a].copy(l),this.poseTarget.props[a].t=l.t,this.poseTarget.props[a].d=l.d);Object.keys(this.poseDelta.props).forEach(a=>{this.poseTarget.props.hasOwnProperty(a)||(this.poseTarget.props[a]=this.poseBase.props[a].clone(),this.poseTarget.props[a].t=this.animClock,this.poseTarget.props[a].d=o)})}getValue(e){if(e==="headRotateX")return this.poseDelta.props["Head.quaternion"].x;if(e==="headRotateY")return this.poseDelta.props["Head.quaternion"].y;if(e==="headRotateZ")return this.poseDelta.props["Head.quaternion"].z;if(e.startsWith("handFist")){const n=e.substring(8);return this.poseDelta.props[n+"HandMiddle1.quaternion"].x}else{if(e==="chestInhale")return this.poseDelta.props["Spine1.scale"].x*20;{const n=this.morphs[0].morphTargetDictionary[e];return n!==void 0?this.morphs[0].morphTargetInfluences[n]:0}}}setValue(e,n){if(e==="headRotateX")this.poseDelta.props["Head.quaternion"].x=n,this.poseDelta.props["Spine1.quaternion"].x=n/2,this.poseDelta.props["Spine.quaternion"].x=n/8,this.poseDelta.props["Hips.quaternion"].x=n/24;else if(e==="headRotateY")this.poseDelta.props["Head.quaternion"].y=n,this.poseDelta.props["Spine1.quaternion"].y=n/2,this.poseDelta.props["Spine.quaternion"].y=n/2,this.poseDelta.props["Hips.quaternion"].y=n/4,this.poseDelta.props["LeftUpLeg.quaternion"].y=n/2,this.poseDelta.props["RightUpLeg.quaternion"].y=n/2,this.poseDelta.props["LeftLeg.quaternion"].y=n/4,this.poseDelta.props["RightLeg.quaternion"].y=n/4;else if(e==="headRotateZ")this.poseDelta.props["Head.quaternion"].z=n,this.poseDelta.props["Spine1.quaternion"].z=n/12,this.poseDelta.props["Spine.quaternion"].z=n/12,this.poseDelta.props["Hips.quaternion"].z=n/24;else if(e.startsWith("handFist")){const i=e.substring(8);["HandThumb","HandIndex","HandMiddle","HandRing","HandPinky"].forEach((r,s)=>{s===0?(this.poseDelta.props[i+r+"1.quaternion"].x=0,this.poseDelta.props[i+r+"2.quaternion"].z=(i==="Left"?-1:1)*n,this.poseDelta.props[i+r+"3.quaternion"].z=(i==="Left"?-1:1)*n):(this.poseDelta.props[i+r+"1.quaternion"].x=n,this.poseDelta.props[i+r+"2.quaternion"].x=1.5*n,this.poseDelta.props[i+r+"3.quaternion"].x=1.5*n)})}else if(e==="chestInhale"){const i=n/20,r={x:i,y:i/2,z:3*i},s={x:1/(1+i)-1,y:1/(1+i/2)-1,z:1/(1+3*i)-1};this.poseDelta.props["Spine1.scale"]=r,this.poseDelta.props["Neck.scale"]=s,this.poseDelta.props["LeftArm.scale"]=s,this.poseDelta.props["RightArm.scale"]=s}else this.morphs.forEach(i=>{const r=i.morphTargetDictionary[e];r!==void 0&&(i.morphTargetInfluences[r]=n)})}getMoodNames(){return Object.keys(this.animMoods)}getMood(){return this.opt.avatarMood}setMood(e){if(e=(e||"").trim().toLowerCase(),!this.animMoods.hasOwnProperty(e))throw new Error("Unknown mood.");this.moodName=e,this.mood=this.animMoods[this.moodName];for(let n of["handFistLeft","handFistRight",...Object.keys(this.morphs[0].morphTargetDictionary)])this.setBaselineValue(n,this.mood.baseline.hasOwnProperty(n)?this.mood.baseline[n]:0);this.mood.anims.forEach(n=>{let i=this.animQueue.findIndex(r=>r.template.name===n.name);i!==-1&&this.animQueue.splice(i,1),this.animQueue.push(this.animFactory(n,-1))})}getMorphTargetNames(){return["headRotateX","headRotateY","headRotateZ","eyesRotateX","eyesRotateY","chestInhale","handFistLeft","handFistRight",...Object.keys(this.morphs[0].morphTargetDictionary)].sort()}getBaselineValue(e){if(e==="eyesRotateY"){const n=this.getBaselineValue("eyeLookOutLeft");if(n===void 0)return;const i=this.getBaselineValue("eyeLookInLeft");return i===void 0||this.getBaselineValue("eyeLookOurRight")===void 0||this.getBaselineValue("eyeLookInRight")===void 0?void 0:n-i}else if(e==="eyesRotateX"){const n=this.getBaselineValue("eyesLookDown");if(n===void 0)return;const i=this.getBaselineValue("eyeLookUp");return i===void 0?void 0:n-i}else return this.animBaseline.hasOwnProperty(e)?this.animBaseline[e].target:void 0}setBaselineValue(e,n){e==="eyesRotateY"?(this.setBaselineValue("eyeLookOutLeft",n===null?null:n>0?n:0),this.setBaselineValue("eyeLookInLeft",n===null?null:n>0?0:-n),this.setBaselineValue("eyeLookOutRight",n===null?null:n>0?0:-n),this.setBaselineValue("eyeLookInRight",n===null?null:n>0?n:0)):e==="eyesRotateX"?(this.setBaselineValue("eyesLookDown",n===null?null:n>0?n:0),this.setBaselineValue("eyesLookUp",n===null?null:n>0?0:-n)):e==="eyeLookOutLeft"||e==="eyeLookInLeft"||e==="eyeLookOutRight"||e==="eyeLookInRight"||e==="eyesLookDown"||e==="eyesLookUp"||(n===null?this.animBaseline.hasOwnProperty(e)&&delete this.animBaseline[e]:this.animBaseline[e]={target:n})}getFixedValue(e){if(e==="eyesRotateY"){const n=this.getFixedValue("eyeLookOutLeft");if(n===void 0)return;const i=this.getFixedValue("eyeLookInLeft");return i===void 0||this.getFixedValue("eyeLookOutRight")===void 0||this.getFixedValue("eyeLookInRight")===void 0?void 0:n-i}else if(e==="eyesRotateX"){const n=this.getFixedValue("eyesLookDown");if(n===void 0)return;const i=this.getFixedValue("eyeLookUp");return i===void 0?void 0:n-i}else return this.animFixed.hasOwnProperty(e)?this.animFixed[e].target:void 0}setFixedValue(e,n){e==="eyesRotateY"?(this.setFixedValue("eyeLookOutLeft",n===null?null:n>0?n:0),this.setFixedValue("eyeLookInLeft",n===null?null:n>0?0:-n),this.setFixedValue("eyeLookOutRight",n===null?null:n>0?0:-n),this.setFixedValue("eyeLookInRight",n===null?null:n>0?n:0)):e==="eyesRotateX"?(this.setFixedValue("eyesLookDown",n===null?null:n>0?n:0),this.setFixedValue("eyesLookUp",n===null?null:n>0?0:-n)):n===null?this.animFixed.hasOwnProperty(e)&&delete this.animFixed[e]:this.animFixed[e]={target:n}}animFactory(e,n=!1,i=1,r=1){const s={template:e,ts:[0],vs:{}};let o=e;for(;;)if(o.hasOwnProperty(this.stateName))o=o[this.stateName];else if(o.hasOwnProperty(this.moodName))o=o[this.moodName];else if(o.hasOwnProperty(this.poseName))o=o[this.poseName];else if(o.hasOwnProperty(this.viewName))o=o[this.viewName];else if(this.avatar.body&&o.hasOwnProperty(this.avatar.body))o=o[this.avatar.body];else if(o.hasOwnProperty("alt")){let l=o.alt[0];if(o.alt.length>1){const c=Math.random();let u=0;for(let h=0;h<o.alt.length;h++)if(u+=o.alt[h].p||(1-u)/(o.alt.length-h),c<u){l=o.alt[h];break}}o=l}else break;const a=o.delay?Array.isArray(o.delay)?this.gaussianRandom(...o.delay):o.delay:0;o.hasOwnProperty("dt")&&o.dt.forEach((l,c)=>{s.ts[c+1]=s.ts[c]+(Array.isArray(l)?this.gaussianRandom(...l):l)}),s.ts=s.ts.map(l=>this.animClock+a+l*i);for(let[l,c]of Object.entries(o.vs)){const u=this.getBaselineValue(l),h=c.map(d=>d===null?null:typeof d=="function"?d:typeof d=="string"||d instanceof String?d.slice():Array.isArray(d)?l==="gesture"?d.slice():(u===void 0?0:u)+r*this.gaussianRandom(...d):d instanceof Object&&d.constructor===Object?Object.assign({},d):(u===void 0?0:u)+r*d);l==="eyesRotateY"?(s.vs.eyeLookOutLeft=[null,...h.map(d=>d>0?d:0)],s.vs.eyeLookInLeft=[null,...h.map(d=>d>0?0:-d)],s.vs.eyeLookOutRight=[null,...h.map(d=>d>0?0:-d)],s.vs.eyeLookInRight=[null,...h.map(d=>d>0?d:0)]):l==="eyesRotateX"?(s.vs.eyesLookDown=[null,...h.map(d=>d>0?d:0)],s.vs.eyesLookUp=[null,...h.map(d=>d>0?0:-d)]):s.vs[l]=[null,...h]}for(let l of Object.keys(s.vs))for(;s.vs[l].length-1<s.ts.length;)s.vs[l].push(s.vs[l][s.vs[l].length-1]);return e.hasOwnProperty("mood")&&(s.mood=e.mood.slice()),n&&(s.loop=n),s}valueAnimationSeq(e,n,i,r=null){let s=0,o=e.length-1;if(i<=e[s])return typeof n[s]=="function"?n[s]():n[s];if(i>=e[o])return typeof n[o]=="function"?n[o]():n[o];for(;i>e[s+1];)s++;o=s+1;let a=((typeof n[o]=="function"?n[o]():n[o])-(typeof n[s]=="function"?n[s]():n[s]))/(e[o]-e[s]);r&&(a=r((i-e[s])/(e[o]-e[s]))*a);const l=(typeof n[s]=="function"?n[s]():n[s])-a*e[s];return a*i+l}gaussianRandom(e,n,i=1,r=5){let s=0;for(let o=0;o<r;o++)s+=Math.random();return e+Math.pow(s/r,i)*(n-e)}sigmoidFactory(e){function n(r){return 1/(1+Math.exp(-e*r))-.5}var i=.5/n(1);return function(r){return i*n(2*Math.max(Math.min(r,1),0)-1)+.5}}convertRange(e,n,i){return(e-n[0])*(i[1]-i[0])/(n[1]-n[0])+i[0]}animate(e){if(this.isRunning)requestAnimationFrame(this.animate.bind(this));else return;let n=e-this.animTimeLast;if(n<this.animFrameDur)return;if(n=n/this.animSlowdownRate,this.animClock+=n,this.animTimeLast=e,this.stats&&this.stats.begin(),this.viewName!=="full"){const l=this.randomized[Math.floor(Math.random()*this.randomized.length)],c=this.getValue(l),u=this.getBaselineValue(l);if(c===u){const h=(this.mood.baseline[l]||0)+Math.random()/5;this.setBaselineValue(l,h)}}const i={};for(let[l,c]of Object.entries(this.animBaseline)){const u=this.getValue(l),h=this.isSpeaking&&l.startsWith("mouth")?3:1,d=c.target/h;if(u!==d){c.t0===void 0&&(c.t0=this.animClock,c.v0=u);let p=1e3;i[l]=this.valueAnimationSeq([c.t0,c.t0+p],[c.v0,d],this.animClock,this.easing)}else c.t0=void 0}for(let l=0;l<this.animQueue.length;l++){const c=this.animQueue[l];if(this.animClock>=c.ts[0]){for(let[u,h]of Object.entries(c.vs))if(u==="subtitles")i[u]=i.hasOwnProperty(u)?i[u]+h:""+h,delete c.vs[u];else if(u==="function")h.forEach(d=>{d&&typeof d=="function"&&d()}),delete c.vs[u];else if(u==="speak")i[u]=i.hasOwnProperty(u)?i[u]+" "+h:""+h,delete c.vs[u];else if(u==="pose")i[u]=""+h[1],delete c.vs[u];else if(u==="gesture")for(let d=0;d<c.ts.length;d++)h[d]&&this.animClock>=c.ts[d]&&(i[u]=h[d],h[d]=null);else if(u==="moveto"||u==="handLeft"||u==="handRight")for(let d=0;d<c.ts.length;d++)h[d]&&this.animClock>=c.ts[d]&&(i[u]=Object.assign(i[u]||{},h[d]),h[d]=null);else{h[0]===null&&(h[0]=this.getValue(u)),i[u]=this.valueAnimationSeq(c.ts,h,this.animClock,this.easing),this.animBaseline.hasOwnProperty(u)&&(this.animBaseline[u].t0=void 0);for(let d=0;d<l;d++)this.animQueue[d].vs.hasOwnProperty(u)&&delete this.animQueue[d].vs[u]}if(this.animClock>=c.ts[c.ts.length-1])if(c.hasOwnProperty("mood")&&this.setMood(c.mood),c.loop){let u=this.isSpeaking&&(c.template.name==="head"||c.template.name==="eyes")?4:1;this.animQueue[l]=this.animFactory(c.template,c.loop>0?c.loop-1:c.loop,1,1/u)}else this.animQueue.splice(l--,1)}}for(let[l,c]of Object.entries(this.animFixed)){const u=this.getValue(l);if(u!==c.target){c.t0===void 0&&(c.t0=this.animClock,c.v0=u);let h=1e3;i[l]=this.valueAnimationSeq([c.t0,c.t0+h],[c.v0,c.target],this.animClock,this.easing)}else i.hasOwnProperty(l)&&delete i[l],c.t0=void 0;this.animBaseline.hasOwnProperty(l)&&(this.animBaseline[l].t0=void 0)}for(let[l,c]of Object.entries(i))l==="subtitles"?this.onSubtitles&&typeof this.onSubtitles=="function"&&this.onSubtitles(""+c):l==="speak"?this.speakText(""+c):l==="pose"?(this.poseName=""+c,this.setPoseFromTemplate(this.poseTemplates[this.poseName])):l==="gesture"?this.playGesture(...c):l==="moveto"?Object.entries(c.props).forEach(u=>{u[1]?this.poseTarget.props[u[0]].copy(u[1]):this.poseTarget.props[u[0]].copy(this.getPoseTemplateProp(u[0])),this.poseTarget.props[u[0]].t=this.animClock,this.poseTarget.props[u[0]].d=u[1]&&u[1].d?u[1].d:c.duration||2e3}):l==="handLeft"?this.ikSolve({iterations:20,root:"LeftShoulder",effector:"LeftHandMiddle1",links:[{link:"LeftHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5},{link:"LeftForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-.5,maxz:3},{link:"LeftArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},c.x?new N(c.x,c.y,c.z):null,!0,c.d):l==="handRight"?this.ikSolve({iterations:20,root:"RightShoulder",effector:"RightHandMiddle1",links:[{link:"RightHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5,maxAngle:.1},{link:"RightForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-3,maxz:.5,maxAngle:.2},{link:"RightArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},c.x?new N(c.x,c.y,c.z):null,!0,c.d):this.setValue(l,c);this.updatePoseBase(this.animClock),this.mixer&&this.mixer.update(n/1e3*this.mixer.timeScale),this.updatePoseDelta();const r=new ha;r.setFromObject(this.armature);const s=new N,o=new N;this.armature.getObjectByName("LeftToeBase").getWorldPosition(s),this.armature.getObjectByName("RightToeBase").getWorldPosition(o);const a=this.armature.getObjectByName("Hips");if(a.position.y-=r.min.y/2,a.position.x-=(s.x+o.x)/4,a.position.z-=(s.z+o.z)/2,this.cameraClock!==null&&this.cameraClock<1e3){this.cameraClock+=n,this.cameraClock>1e3&&(this.cameraClock=1e3);let l=new D1().setFromVector3(this.cameraStart),c=new D1().setFromVector3(this.cameraEnd);l.phi+=this.easing(this.cameraClock/1e3)*(c.phi-l.phi),l.theta+=this.easing(this.cameraClock/1e3)*(c.theta-l.theta),l.radius+=this.easing(this.cameraClock/1e3)*(c.radius-l.radius),l.makeSafe(),this.camera.position.setFromSpherical(l),this.controlsStart.x!==this.controlsEnd.x?this.controls.target.copy(this.controlsStart.lerp(this.controlsEnd,this.easing(this.cameraClock/1e3))):(l.setFromVector3(this.controlsStart),c.setFromVector3(this.controlsEnd),l.phi+=this.easing(this.cameraClock/1e3)*(c.phi-l.phi),l.theta+=this.easing(this.cameraClock/1e3)*(c.theta-l.theta),l.radius+=this.easing(this.cameraClock/1e3)*(c.radius-l.radius),l.makeSafe(),this.controls.target.setFromSpherical(l)),this.controls.update()}this.controls.autoRotate&&this.controls.update(),this.stats&&this.stats.end(),this.render()}resetLips(){this.visemeNames.forEach(e=>{this.morphs.forEach(n=>{const i=n.morphTargetDictionary["viseme_"+e];i!==void 0&&(n.morphTargetInfluences[i]=0)})})}lipsyncGetProcessor(e,n="./"){if(!this.lipsync.hasOwnProperty(e)){const i=n+"lipsync-"+e.toLowerCase()+".mjs",r="Lipsync"+e.charAt(0).toUpperCase()+e.slice(1);import(i).then(s=>{this.lipsync[e]=new s[r]})}}lipsyncPreProcessText(e,n){return(this.lipsync[n]||Object.values(this.lipsync)[0]).preProcessText(e)}lipsyncWordsToVisemes(e,n){return(this.lipsync[n]||Object.values(this.lipsync)[0]).wordsToVisemes(e)}speakText(e,n=null,i=null,r=null){n=n||{};const s=/[!\.\?\n\p{Extended_Pictographic}]/ug,o=/[ ]/ug,a=/[\p{L}\p{N},\.'!€\$\+\p{Dash_Punctuation}%&\?]/ug,l=/[\p{Extended_Pictographic}]/ug,c=n.lipsyncLang||this.avatar.lipsyncLang||this.opt.lipsyncLang;let u="",h="",d=0,p=[],f=[];const v=[...e];for(let g=0;g<v.length;g++){const m=g===v.length-1,y=v[g].match(a),S=v[g].match(s),x=v[g].match(o);if(i&&(u+=v[g]),y&&(!r||r.every(w=>g<w[0]||g>w[1]))&&(h+=v[g]),(x||S||m)&&(h.length&&(h=this.lipsyncPreProcessText(h,c),h.length&&p.push({mark:d,word:h})),u.length&&(f.push({mark:d,template:{name:"subtitles"},ts:[0],vs:{subtitles:u}}),u=""),h.length)){const w=this.lipsyncWordsToVisemes(h,c);if(w&&w.visemes&&w.visemes.length){const C=w.times[w.visemes.length-1]+w.durations[w.visemes.length-1];for(let E=0;E<w.visemes.length;E++)f.push({mark:d,template:{name:"viseme"},ts:[(w.times[E]-.6)/C,(w.times[E]+.5)/C,(w.times[E]+w.durations[E]+.5)/C],vs:{["viseme_"+w.visemes[E]]:[null,w.visemes[E]==="PP"||w.visemes[E]==="FF"?.9:.6,0]}})}h="",d++}if(S||m){if(p.length||m&&f.length){const w={anim:f};i&&(w.onSubtitles=i),p.length&&!n.avatarMute&&(w.text=p,n.avatarMood&&(w.mood=n.avatarMood),n.ttsLang&&(w.lang=n.ttsLang),n.ttsVoice&&(w.voice=n.ttsVoice),n.ttsRate&&(w.rate=n.ttsRate),n.ttsVoice&&(w.pitch=n.ttsPitch),n.ttsVolume&&(w.volume=n.ttsVolume)),this.speechQueue.push(w),p=[],h="",d=0,f=[]}if(v[g].match(l)){let w=this.animEmojis[v[g]];w&&w.link&&(w=this.animEmojis[w.link]),w&&this.speechQueue.push({emoji:w})}this.speechQueue.push({break:100})}}this.speechQueue.push({break:1e3}),this.startSpeaking()}async speakEmoji(e){let n=this.animEmojis[e];n&&n.link&&(n=this.animEmojis[n.link]),n&&this.speechQueue.push({emoji:n}),this.startSpeaking()}async speakBreak(e){this.speechQueue.push({break:e}),this.startSpeaking()}async speakMarker(e){this.speechQueue.push({marker:e}),this.startSpeaking()}async playBackgroundAudio(e){let i=await(await fetch(e)).arrayBuffer();this.stopBackgroundAudio(),this.audioBackgroundSource=this.audioCtx.createBufferSource(),this.audioBackgroundSource.loop=!0,this.audioBackgroundSource.buffer=await this.audioCtx.decodeAudioData(i),this.audioBackgroundSource.playbackRate.value=1/this.animSlowdownRate,this.audioBackgroundSource.connect(this.audioBackgroundGainNode),this.audioBackgroundSource.start(0)}stopBackgroundAudio(){try{this.audioBackgroundSource.stop()}catch{}this.audioBackgroundSource.disconnect()}async setReverb(e=null){if(e){let i=await(await fetch(e)).arrayBuffer();this.audioReverbNode.buffer=await this.audioCtx.decodeAudioData(i)}else{const n=this.audioCtx.sampleRate,i=this.audioCtx.createBuffer(2,n,n);i.getChannelData(0)[0]=1,i.getChannelData(1)[0]=1,this.audioReverbNode.buffer=i}}setMixerGain(e,n){e!==null&&(this.audioSpeechGainNode.gain.value=e),n!==null&&(this.audioBackgroundGainNode.gain.value=n)}speakAudio(e,n=null,i=null){n=n||{};const r=n.lipsyncLang||this.avatar.lipsyncLang||this.opt.lipsyncLang,s={};if(e.words){let o=[];for(let a=0;a<e.words.length;a++){const l=e.words[a],c=e.wtimes[a];let u=e.wdurations[a];if(l.length&&(i&&o.push({template:{name:"subtitles"},ts:[c],vs:{subtitles:" "+l}}),!e.visemes)){const h=this.lipsyncPreProcessText(l,r),d=this.lipsyncWordsToVisemes(h,r);if(d&&d.visemes&&d.visemes.length){const p=d.times[d.visemes.length-1]+d.durations[d.visemes.length-1],f=Math.min(u,Math.max(0,u-d.visemes.length*150));let v=.6+this.convertRange(f,[0,u],[0,.4]);if(u=Math.min(u,d.visemes.length*200),p>0)for(let g=0;g<d.visemes.length;g++){const m=c+d.times[g]/p*u,y=d.durations[g]/p*u;o.push({template:{name:"viseme"},ts:[m-Math.min(60,2*y/3),m+Math.min(25,y/2),m+y+Math.min(60,y/2)],vs:{["viseme_"+d.visemes[g]]:[null,d.visemes[g]==="PP"||d.visemes[g]==="FF"?.9:v,0]}})}}}}if(e.visemes)for(let a=0;a<e.visemes.length;a++){const l=e.visemes[a],c=e.vtimes[a],u=e.vdurations[a];o.push({template:{name:"viseme"},ts:[c-2*u/3,c+u/2,c+u+u/2],vs:{["viseme_"+l]:[null,l==="PP"||l==="FF"?.9:.6,0]}})}if(e.markers)for(let a=0;a<e.markers.length;a++){const l=e.markers[a],c=e.mtimes[a];o.push({template:{name:"markers"},ts:[c],vs:{function:[l]}})}o.length&&(s.anim=o)}e.audio&&(s.audio=e.audio),i&&(s.onSubtitles=i),Object.keys(s).length&&(this.speechQueue.push(s),this.speechQueue.push({break:300}),this.startSpeaking())}async playAudio(e=!1){if(!(!this.armature||this.isAudioPlaying&&!e))if(this.isAudioPlaying=!0,this.audioPlaylist.length){const n=this.audioPlaylist.shift();if(this.audioCtx.state==="suspended"){const s=this.audioCtx.resume(),o=new Promise((a,l)=>setTimeout(()=>l("p2"),1e3));try{await Promise.race([s,o])}catch{console.log("Can't play audio. Web Audio API suspended. This is often due to calling some speak method before the first user action, which is typically prevented by the browser."),this.playAudio(!0);return}}let i;if(Array.isArray(n.audio)){let s=this.concatArrayBuffers(n.audio);i=this.pcmToAudioBuffer(s)}else i=n.audio;this.audioSpeechSource=this.audioCtx.createBufferSource(),this.audioSpeechSource.buffer=i,this.audioSpeechSource.playbackRate.value=1/this.animSlowdownRate,this.audioSpeechSource.connect(this.audioSpeechGainNode),this.audioSpeechSource.addEventListener("ended",()=>{this.audioSpeechSource.disconnect(),this.playAudio(!0)},{once:!0});const r=100;n.anim&&n.anim.forEach(s=>{for(let o=0;o<s.ts.length;o++)s.ts[o]=this.animClock+s.ts[o]+r;this.animQueue.push(s)}),this.audioSpeechSource.start(r/1e3)}else this.isAudioPlaying=!1,this.startSpeaking(!0)}async startSpeaking(e=!1){if(!(!this.armature||this.isSpeaking&&!e))if(this.stateName="talking",this.isSpeaking=!0,this.speechQueue.length){let n=this.speechQueue.shift();if(n.emoji){this.lookAtCamera(500);let i=n.emoji.dt.reduce((r,s)=>r+s,0);this.animQueue.push(this.animFactory(n.emoji)),setTimeout(this.startSpeaking.bind(this),i,!0)}else if(n.break)setTimeout(this.startSpeaking.bind(this),n.break,!0);else if(n.audio)this.lookAtCamera(500),this.speakWithHands(),this.audioPlaylist.push({anim:n.anim,audio:n.audio}),this.onSubtitles=n.onSubtitles||null,this.resetLips(),n.mood&&this.setMood(n.mood),this.playAudio();else if(n.text){this.lookAtCamera(500);try{let i="<speak>";n.text.forEach((a,l)=>{l>0&&(i+=" <mark name='"+a.mark+"'/>"),i+=a.word.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&apos;").replace(new RegExp("^\\p{Dash_Punctuation}$","ug"),'<break time="750ms"/>')}),i+="</speak>";const r={method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({input:{ssml:i},voice:{languageCode:n.lang||this.avatar.ttsLang||this.opt.ttsLang,name:n.voice||this.avatar.ttsVoice||this.opt.ttsVoice},audioConfig:{audioEncoding:this.ttsAudioEncoding,speakingRate:(n.rate||this.avatar.ttsRate||this.opt.ttsRate)+this.mood.speech.deltaRate,pitch:(n.pitch||this.avatar.ttsPitch||this.opt.ttsPitch)+this.mood.speech.deltaPitch,volumeGainDb:(n.volume||this.avatar.ttsVolume||this.opt.ttsVolume)+this.mood.speech.deltaVolume},enableTimePointing:[1]})};this.opt.jwtGet&&typeof this.opt.jwtGet=="function"&&(r.headers.Authorization="Bearer "+await this.opt.jwtGet());const s=await fetch(this.opt.ttsEndpoint+(this.opt.ttsApikey?"?key="+this.opt.ttsApikey:""),r),o=await s.json();if(s.status===200&&o&&o.audioContent){const a=this.b64ToArrayBuffer(o.audioContent),l=await this.audioCtx.decodeAudioData(a);this.speakWithHands();const c=[0];let u=0;n.text.forEach((p,f)=>{if(f>0){let v=c[c.length-1];o.timepoints[u]&&(v=o.timepoints[u].timeSeconds*1e3,o.timepoints[u].markName===""+p.mark&&u++),c.push(v)}});const h=[{mark:0,time:0}];c.forEach((p,f)=>{if(f>0){let v=p-c[f-1];v>150&&v-150,h[f-1].duration=v,h.push({mark:f,time:p})}});let d=1e3*l.duration;d>this.opt.ttsTrimEnd&&(d=d-this.opt.ttsTrimEnd),h[h.length-1].duration=d-h[h.length-1].time,n.anim.forEach(p=>{const f=h[p.mark];if(f)for(let v=0;v<p.ts.length;v++)p.ts[v]=f.time+p.ts[v]*f.duration+this.opt.ttsTrimStart}),this.audioPlaylist.push({anim:n.anim,audio:l}),this.onSubtitles=n.onSubtitles||null,this.resetLips(),n.mood&&this.setMood(n.mood),this.playAudio()}else this.startSpeaking(!0)}catch(i){console.error("Error:",i),this.startSpeaking(!0)}}else n.anim?(this.onSubtitles=n.onSubtitles||null,this.resetLips(),n.mood&&this.setMood(n.mood),n.anim.forEach((i,r)=>{for(let s=0;s<i.ts.length;s++)i.ts[s]=this.animClock+10*r;this.animQueue.push(i)}),setTimeout(this.startSpeaking.bind(this),10*n.anim.length,!0)):n.marker?(typeof n.marker=="function"&&n.marker(),this.startSpeaking(!0)):this.startSpeaking(!0)}else this.stateName="idle",this.isSpeaking=!1}pauseSpeaking(){try{this.audioSpeechSource.stop()}catch{}this.audioPlaylist.length=0,this.stateName="idle",this.isSpeaking=!1,this.isAudioPlaying=!1,this.animQueue=this.animQueue.filter(e=>e.template.name!=="viseme"),this.armature&&(this.resetLips(),this.render())}stopSpeaking(){try{this.audioSpeechSource.stop()}catch{}this.audioPlaylist.length=0,this.speechQueue.length=0,this.animQueue=this.animQueue.filter(e=>e.template.name!=="viseme"),this.stateName="idle",this.isSpeaking=!1,this.isAudioPlaying=!1,this.armature&&(this.resetLips(),this.render())}lookAtCamera(e){this.lookAt(null,null,e)}lookAt(e,n,i){const r=this.nodeAvatar.getBoundingClientRect(),s=this.armature.getObjectByName("LeftEye"),o=this.armature.getObjectByName("RightEye");s.updateMatrixWorld(!0),o.updateMatrixWorld(!0);const a=new N().setFromMatrixPosition(s.matrixWorld),l=new N().setFromMatrixPosition(o.matrixWorld),c=new N().addVectors(a,l).divideScalar(2);c.project(this.camera);let u=(c.x+1)/2*r.width+r.left,h=-(c.y-1)/2*r.height+r.top;e===null&&(e=u),n===null&&(n=h);let d=this.poseTarget.props["Hips.quaternion"].clone();d.multiply(this.poseTarget.props["Spine.quaternion"]),d.multiply(this.poseTarget.props["Spine1.quaternion"]),d.multiply(this.poseTarget.props["Spine2.quaternion"]),d.multiply(this.poseTarget.props["Neck.quaternion"]),d.multiply(this.poseTarget.props["Head.quaternion"]);let p=new fn().setFromQuaternion(d),f=p.x/(40/24),v=p.y/(9/4),g=Math.min(.4,Math.max(-.4,this.camera.rotation.x)),m=Math.min(.4,Math.max(-.4,this.camera.rotation.y)),y=Math.max(window.innerWidth-u,u),S=Math.max(window.innerHeight-h,h),x=this.convertRange(n,[h-S,h+S],[-.3,.6])-f+g,w=this.convertRange(e,[u-y,u+y],[-.8,.8])-v+m;x=Math.min(.6,Math.max(-.3,x)),w=Math.min(.8,Math.max(-.8,w));let C=(Math.random()-.5)/4,E=(Math.random()-.5)/4;if(i){let T=this.animQueue.findIndex(_=>_.template.name==="lookat");T!==-1&&this.animQueue.splice(T,1);const M={name:"lookat",dt:[750,i],vs:{headRotateX:[x+C],headRotateY:[w+E],eyesRotateX:[-3*C+.1],eyesRotateY:[-5*E],browInnerUp:[[0,.7]],mouthLeft:[[0,.7]],mouthRight:[[0,.7]]}};this.animQueue.push(this.animFactory(M))}}touchAt(e,n){const i=this.nodeAvatar.getBoundingClientRect(),r=new mt((e-i.left)/i.width*2-1,-((n-i.top)/i.height)*2+1),s=new jie;s.setFromCamera(r,this.camera);const o=s.intersectObject(this.armature);if(o.length>0){const a=o[0].point,l=new N,c=new N;this.armature.getObjectByName("LeftArm").getWorldPosition(l),this.armature.getObjectByName("RightArm").getWorldPosition(c);const u=l.distanceToSquared(a),h=c.distanceToSquared(a);u<h?(this.ikSolve({iterations:20,root:"LeftShoulder",effector:"LeftHandMiddle1",links:[{link:"LeftHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5,maxAngle:.1},{link:"LeftForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-.5,maxz:3,maxAngle:.2},{link:"LeftArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},a,!1,1e3),this.setValue("handFistLeft",0)):(this.ikSolve({iterations:20,root:"RightShoulder",effector:"RightHandMiddle1",links:[{link:"RightHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5,maxAngle:.1},{link:"RightForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-3,maxz:.5,maxAngle:.2},{link:"RightArm",minx:-1.5,maxx:1.5,miny:0,maxy:0,minz:-1,maxz:3}]},a,!1,1e3),this.setValue("handFistRight",0))}else["LeftArm","LeftForeArm","LeftHand","RightArm","RightForeArm","RightHand"].forEach(a=>{let l=a+".quaternion";this.poseTarget.props[l].copy(this.getPoseTemplateProp(l)),this.poseTarget.props[l].t=this.animClock,this.poseTarget.props[l].d=1e3});return o.length>0}speakWithHands(e=0,n=.5){if(this.mixer||this.gesture||!this.poseTarget.template.standing||this.poseTarget.template.bend||Math.random()>n)return;this.ikSolve({root:"LeftShoulder",effector:"LeftHandMiddle1",links:[{link:"LeftHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5},{link:"LeftForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-.5,maxz:3},{link:"LeftArm",minx:-1.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-1,maxz:3}]},new N(this.gaussianRandom(0,.5),this.gaussianRandom(-.8,-.2),this.gaussianRandom(0,.5)),!0),this.ikSolve({root:"RightShoulder",effector:"RightHandMiddle1",links:[{link:"RightHand",minx:-.5,maxx:.5,miny:-1,maxy:1,minz:-.5,maxz:.5},{link:"RightForeArm",minx:-.5,maxx:1.5,miny:-1.5,maxy:1.5,minz:-3,maxz:.5},{link:"RightArm"}]},new N(this.gaussianRandom(-.5,0),this.gaussianRandom(-.8,-.2),this.gaussianRandom(0,.5)),!0);const i=[],r=[];i.push(100+Math.round(Math.random()*500)),r.push({duration:1e3,props:{"LeftHand.quaternion":new qt().setFromEuler(new fn(0,-1-Math.random(),0)),"RightHand.quaternion":new qt().setFromEuler(new fn(0,1+Math.random(),0))}}),["LeftArm","LeftForeArm","RightArm","RightForeArm"].forEach(o=>{r[0].props[o+".quaternion"]=this.ikMesh.getObjectByName(o).quaternion.clone()}),i.push(1e3+Math.round(Math.random()*500)),r.push({duration:2e3,props:{}}),["LeftArm","LeftForeArm","RightArm","RightForeArm","LeftHand","RightHand"].forEach(o=>{r[1].props[o+".quaternion"]=null});const s=this.animFactory({name:"talkinghands",delay:e,dt:i,vs:{moveto:r}});this.animQueue.push(s)}getSlowdownRate(e){return this.animSlowdownRate}setSlowdownRate(e){this.animSlowdownRate=e,this.audioSpeechSource.playbackRate.value=1/this.animSlowdownRate,this.audioBackgroundSource.playbackRate.value=1/this.animSlowdownRate}getAutoRotateSpeed(e){return this.controls.autoRotateSpeed}setAutoRotateSpeed(e){this.controls.autoRotateSpeed=e,this.controls.autoRotate=e>0}start(){this.armature&&this.isRunning===!1&&(this.audioCtx.resume(),this.animTimeLast=performance.now(),this.isRunning=!0,requestAnimationFrame(this.animate.bind(this)))}stop(){this.isRunning=!1,this.audioCtx.suspend()}async playAnimation(e,n=null,i=10,r=0,s=.01){if(!this.armature)return;let o=this.animClips.find(a=>a.url===e+"-"+r);if(o){let a=this.animQueue.find(u=>u.template.name==="pose");a&&(a.ts[0]=1/0),Object.entries(o.pose.props).forEach(u=>{this.poseBase.props[u[0]]=u[1].clone(),this.poseTarget.props[u[0]]=u[1].clone(),this.poseTarget.props[u[0]].t=0,this.poseTarget.props[u[0]].d=1e3}),this.mixer=new Vie(this.armature),this.mixer.addEventListener("finished",this.stopAnimation.bind(this),{once:!0});const l=Math.ceil(i/o.clip.duration),c=this.mixer.clipAction(o.clip);c.setLoop(zB,l),c.clampWhenFinished=!0,c.fadeIn(.5).play()}else{let l=await new hD().loadAsync(e,n);if(l&&l.animations&&l.animations[r]){let c=l.animations[r];const u={};c.tracks.forEach(d=>{d.name=d.name.replaceAll("mixamorig","");const p=d.name.split(".");if(p[1]==="position"){for(let f=0;f<d.values.length;f++)d.values[f]=d.values[f]*s;u[d.name]=new N(d.values[0],d.values[1],d.values[2])}else p[1]==="quaternion"?u[d.name]=new qt(d.values[0],d.values[1],d.values[2],d.values[3]):p[1]==="rotation"&&(u[p[0]+".quaternion"]=new qt().setFromEuler(new fn(d.values[0],d.values[1],d.values[2],"XYZ")).normalize())});const h={props:u};u["Hips.position"]&&(u["Hips.position"].y<.5?h.lying=!0:h.standing=!0),this.animClips.push({url:e+"-"+r,clip:c,pose:h}),this.playAnimation(e,n,i,r,s)}else{const c="Animation "+e+" (ndx="+r+") not found";console.error(c)}}}stopAnimation(){if(this.mixer=null,this.gesture)for(let[n,i]of Object.entries(this.gesture))i.t=this.animClock,i.d=1e3,this.poseTarget.props.hasOwnProperty(n)&&(this.poseTarget.props[n].copy(i),this.poseTarget.props[n].t=this.animClock,this.poseTarget.props[n].d=1e3);let e=this.animQueue.find(n=>n.template.name==="pose");e&&(e.ts[0]=this.animClock),this.setPoseFromTemplate(null)}async playPose(e,n=null,i=5,r=0,s=.01){if(!this.armature)return;let o=this.poseTemplates[e];if(!o){const a=this.animPoses.find(l=>l.url===e+"-"+r);a&&(o=a.pose)}if(o){this.poseName=e,this.mixer=null;let a=this.animQueue.find(l=>l.template.name==="pose");a&&(a.ts[0]=this.animClock+i*1e3+2e3),this.setPoseFromTemplate(o)}else{let l=await new hD().loadAsync(e,n);if(l&&l.animations&&l.animations[r]){let c=l.animations[r];const u={};c.tracks.forEach(d=>{d.name=d.name.replaceAll("mixamorig","");const p=d.name.split(".");p[1]==="position"?u[d.name]=new N(d.values[0]*s,d.values[1]*s,d.values[2]*s):p[1]==="quaternion"?u[d.name]=new qt(d.values[0],d.values[1],d.values[2],d.values[3]):p[1]==="rotation"&&(u[p[0]+".quaternion"]=new qt().setFromEuler(new fn(d.values[0],d.values[1],d.values[2],"XYZ")).normalize())});const h={props:u};u["Hips.position"]&&(u["Hips.position"].y<.5?h.lying=!0:h.standing=!0),this.animPoses.push({url:e+"-"+r,pose:h}),this.playPose(e,n,i,r,s)}else{const c="Pose "+e+" (ndx="+r+") not found";console.error(c)}}}stopPose(){this.stopAnimation()}playGesture(e,n=3,i=!1,r=1e3){if(!this.armature)return;let s=this.gestureTemplates[e];if(s){this.gestureTimeout&&(clearTimeout(this.gestureTimeout),this.gestureTimeout=null);let a=this.animQueue.findIndex(l=>l.template.name==="talkinghands");a!==-1&&(this.animQueue[a].ts=this.animQueue[a].ts.map(l=>0)),this.gesture=this.propsToThreeObjects(s),i&&(this.gesture=this.mirrorPose(this.gesture)),e==="namaste"&&this.avatar.body==="M"&&(this.gesture["RightArm.quaternion"].rotateTowards(new qt(0,1,0,0),-.25),this.gesture["LeftArm.quaternion"].rotateTowards(new qt(0,1,0,0),-.25));for(let[l,c]of Object.entries(this.gesture))c.t=this.animClock,c.d=r,this.poseTarget.props.hasOwnProperty(l)&&(this.poseTarget.props[l].copy(c),this.poseTarget.props[l].t=this.animClock,this.poseTarget.props[l].d=r);n&&Number.isFinite(n)&&(this.gestureTimeout=setTimeout(this.stopGesture.bind(this,r),1e3*n))}let o=this.animEmojis[e];if(o&&(o&&o.link&&(o=this.animEmojis[o.link]),o)){this.lookAtCamera(500);const a=this.animFactory(o);if(a.gesture=!0,n&&Number.isFinite(n)){const l=a.ts[0],c=a.ts[a.ts.length-1],u=1e3*n/(c-l);a.ts=a.ts.map(h=>l+u*(h-l))}this.animQueue.push(a)}}stopGesture(e=1e3){if(this.gestureTimeout&&(clearTimeout(this.gestureTimeout),this.gestureTimeout=null),this.gesture){const i=Object.entries(this.gesture);this.gesture=null;for(const[r,s]of i)this.poseTarget.props.hasOwnProperty(r)&&(this.poseTarget.props[r].copy(this.getPoseTemplateProp(r)),this.poseTarget.props[r].t=this.animClock,this.poseTarget.props[r].d=e)}let n=this.animQueue.findIndex(i=>i.gesture);n!==-1&&this.animQueue.splice(n,1)}ikSolve(e,n=null,i=!1,r=null){const s=new qt,o=new N,a=new N,l=new N,c=new N,u=new qt,h=new N,d=new N,p=new N,f=this.ikMesh.getObjectByName(e.root);f.position.setFromMatrixPosition(this.armature.getObjectByName(e.root).matrixWorld),f.quaternion.setFromRotationMatrix(this.armature.getObjectByName(e.root).matrixWorld),n&&i&&n.add(f.position);const v=this.ikMesh.getObjectByName(e.effector),g=e.links;g.forEach(y=>{y.bone=this.ikMesh.getObjectByName(y.link),y.bone.quaternion.copy(this.getPoseTemplateProp(y.link+".quaternion"))}),f.updateMatrixWorld(!0);const m=e.iterations||10;if(n)for(let y=0;y<m;y++){let S=!1;for(let x=0,w=g.length;x<w;x++){const C=g[x].bone;C.matrixWorld.decompose(c,u,h),u.invert(),a.setFromMatrixPosition(v.matrixWorld),l.subVectors(a,c),l.applyQuaternion(u),l.normalize(),o.subVectors(n,c),o.applyQuaternion(u),o.normalize();let E=o.dot(l);E>1?E=1:E<-1&&(E=-1),E=Math.acos(E),!(E<1e-5)&&(g[x].minAngle!==void 0&&E<g[x].minAngle&&(E=g[x].minAngle),g[x].maxAngle!==void 0&&E>g[x].maxAngle&&(E=g[x].maxAngle),d.crossVectors(l,o),d.normalize(),s.setFromAxisAngle(d,E),C.quaternion.multiply(s),C.rotation.setFromVector3(p.setFromEuler(C.rotation).clamp(new N(g[x].minx!==void 0?g[x].minx:-1/0,g[x].miny!==void 0?g[x].miny:-1/0,g[x].minz!==void 0?g[x].minz:-1/0),new N(g[x].maxx!==void 0?g[x].maxx:1/0,g[x].maxy!==void 0?g[x].maxy:1/0,g[x].maxz!==void 0?g[x].maxz:1/0))),C.updateMatrixWorld(!0),S=!0)}if(!S)break}r&&g.forEach(y=>{this.poseTarget.props[y.link+".quaternion"].copy(y.bone.quaternion),this.poseTarget.props[y.link+".quaternion"].t=this.animClock,this.poseTarget.props[y.link+".quaternion"].d=r})}}const Ese="0f4404a5f9f56",Rse=he.forwardRef((t,e)=>{const n=he.useRef(null),i=he.useRef(null),r=he.useRef(null),s=he.useRef(null),o=he.useRef([]);he.useEffect(()=>!n.current||!i.current||r.current?void 0:(r.current=new wse(n.current,{ttsEndpoint:"https://eu-texttospeech.googleapis.com/v1beta1/text:synthesize",lipsyncModules:[],cameraView:"full",avatarMood:"neutral",statsNode:n.current,statsStyle:"position: absolute; bottom: 0px; left: 0px; cursor: pointer; opacity: 0.9; z-index: 10000;"}),(async h=>{try{h.textContent="Loading...",await r.current.showAvatar({url:"https://models.readyplayer.me/670a24c892f67441779a5bad.glb?morphTargets=ARKit,Oculus+Visemes,mouthOpen,mouthSmile,eyesClosed,eyesLookUp,eyesLookDown&textureSizeLimit=1024&textureFormat=png",body:"F",avatarMood:"neutral"},d=>{if(d.lengthComputable){let p=Math.min(100,Math.round(d.loaded/d.total*100));h.textContent="Loading "+p+"%"}}),h.style.display="none"}catch(d){console.error("Error loading avatar:",d),d instanceof Error?h.textContent=d.message:h.textContent="An unknown error occurred"}})(i.current),()=>{n.current}),[]);const a=u=>u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");async function l(u,h=null,d=null){if(!r.current)return;const p=o.current;if(u===null)p.push(null);else{const g="<speak version='1.0' xmlns:mstts='http://www.w3.org/2001/mstts' xml:lang='"+"zh-CN"+"'><voice name='"+"zh-CN-XiaoyuMultilingualNeural"+"'><mstts:viseme type='redlips_front'/>"+a(u)+"</voice></speak>";p.push({ssml:g,node:h,onprocessed:d,speak:{audio:[],words:[],wtimes:[],wdurations:[],visemes:[],vtimes:[],vdurations:[]}})}p.length===1&&c()}async function c(){const u=o.current;let h=s.current;if(u.length){const d=u[0];if(d===null)u.shift(),u.length===0&&h&&(h.close(),s.current=null);else{if(!h){const p=`https://api.zzcreation.com/web/ws?x-api-key=${Ese}`,f=Jm.SpeechConfig.fromEndpoint(new URL(p));f.setProperty("SpeechServiceConnection_Endpoint",p),f.speechSynthesisOutputFormat=Jm.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm,h=new Jm.SpeechSynthesizer(f);const v=["sil","aa","aa","O","E","E","I","U","O","aa","O","I","kk","RR","nn","SS","SS","TH","FF","DD","kk","PP"];h.visemeReceived=function(g,m){if(u[0]&&u[0].speak){const y=u[0].speak,S=v[m.visemeId],x=m.audioOffset/1e4;y.vdurations.length&&(y.visemes[y.visemes.length-1]===0?(y.visemes.pop(),y.vtimes.pop(),y.vdurations.pop()):y.vdurations[y.vdurations.length-1]=x-y.vtimes[y.vdurations.length-1]),y.visemes.push(S),y.vtimes.push(x),y.vdurations.push(75)}},h.wordBoundary=function(g,m){if(u[0]&&u[0].speak){const y=u[0].speak,S=m.text,x=m.audioOffset/1e4,w=m.duration/1e4;m.boundaryType==="PunctuationBoundary"&&y.words.length?y.words[y.words.length-1]+=S:(m.boundaryType==="WordBoundary"||m.boundaryType==="PunctuationBoundary")&&(y.words.push(S),y.wtimes.push(x),y.wdurations.push(w))}}}h.speakSsmlAsync(d.ssml,function(p){if(u[0]&&u[0].speak){if(p.reason===Jm.ResultReason.SynthesizingAudioCompleted){const f=u[0];f.speak.audio.push(p.audioData),r.current.speakAudio(f.speak,{},null),f.onprocessed&&f.onprocessed()}u.shift(),c()}},function(p){d.onprocessed&&d.onprocessed(),console.log(p),u.shift(),c()})}}}return he.useImperativeHandle(e,()=>({speak:async u=>{u&&await l(u,null)}})),ze.jsxs(ze.Fragment,{children:[ze.jsx("div",{ref:n,style:{display:"block",width:"100%",height:"100%",position:"relative"}}),ze.jsx("div",{ref:i})]})});function Tse(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const bse=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Ase=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Pse={};function fD(t,e){return(Pse.jsx?Ase:bse).test(t)}const Ise=/[ \t\n\f\r]/g;function Mse(t){return typeof t=="object"?t.type==="text"?mD(t.value):!1:mD(t)}function mD(t){return t.replace(Ise,"")===""}class F0{constructor(e,n,i){this.property=e,this.normal=n,i&&(this.space=i)}}F0.prototype.property={};F0.prototype.normal={};F0.prototype.space=null;function R5(t,e){const n={},i={};let r=-1;for(;++r<t.length;)Object.assign(n,t[r].property),Object.assign(i,t[r].normal);return new F0(n,i,e)}function oT(t){return t.toLowerCase()}class Zs{constructor(e,n){this.property=e,this.attribute=n}}Zs.prototype.space=null;Zs.prototype.boolean=!1;Zs.prototype.booleanish=!1;Zs.prototype.overloadedBoolean=!1;Zs.prototype.number=!1;Zs.prototype.commaSeparated=!1;Zs.prototype.spaceSeparated=!1;Zs.prototype.commaOrSpaceSeparated=!1;Zs.prototype.mustUseProperty=!1;Zs.prototype.defined=!1;let kse=0;const Tt=Ku(),ai=Ku(),T5=Ku(),ve=Ku(),xn=Ku(),fd=Ku(),ls=Ku();function Ku(){return 2**++kse}const aT=Object.freeze(Object.defineProperty({__proto__:null,boolean:Tt,booleanish:ai,commaOrSpaceSeparated:ls,commaSeparated:fd,number:ve,overloadedBoolean:T5,spaceSeparated:xn},Symbol.toStringTag,{value:"Module"})),Iw=Object.keys(aT);class oA extends Zs{constructor(e,n,i,r){let s=-1;if(super(e,n),gD(this,"space",r),typeof i=="number")for(;++s<Iw.length;){const o=Iw[s];gD(this,Iw[s],(i&aT[o])===aT[o])}}}oA.prototype.defined=!0;function gD(t,e,n){n&&(t[e]=n)}const Lse={}.hasOwnProperty;function pp(t){const e={},n={};let i;for(i in t.properties)if(Lse.call(t.properties,i)){const r=t.properties[i],s=new oA(i,t.transform(t.attributes||{},i),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,n[oT(i)]=i,n[oT(s.attribute)]=i}return new F0(e,n,t.space)}const b5=pp({space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),A5=pp({space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function P5(t,e){return e in t?t[e]:e}function I5(t,e){return P5(t,e.toLowerCase())}const M5=pp({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:I5,properties:{xmlns:null,xmlnsXLink:null}}),k5=pp({transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:ai,ariaAutoComplete:null,ariaBusy:ai,ariaChecked:ai,ariaColCount:ve,ariaColIndex:ve,ariaColSpan:ve,ariaControls:xn,ariaCurrent:null,ariaDescribedBy:xn,ariaDetails:null,ariaDisabled:ai,ariaDropEffect:xn,ariaErrorMessage:null,ariaExpanded:ai,ariaFlowTo:xn,ariaGrabbed:ai,ariaHasPopup:null,ariaHidden:ai,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:xn,ariaLevel:ve,ariaLive:null,ariaModal:ai,ariaMultiLine:ai,ariaMultiSelectable:ai,ariaOrientation:null,ariaOwns:xn,ariaPlaceholder:null,ariaPosInSet:ve,ariaPressed:ai,ariaReadOnly:ai,ariaRelevant:null,ariaRequired:ai,ariaRoleDescription:xn,ariaRowCount:ve,ariaRowIndex:ve,ariaRowSpan:ve,ariaSelected:ai,ariaSetSize:ve,ariaSort:null,ariaValueMax:ve,ariaValueMin:ve,ariaValueNow:ve,ariaValueText:null,role:null}}),Dse=pp({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:I5,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:fd,acceptCharset:xn,accessKey:xn,action:null,allow:null,allowFullScreen:Tt,allowPaymentRequest:Tt,allowUserMedia:Tt,alt:null,as:null,async:Tt,autoCapitalize:null,autoComplete:xn,autoFocus:Tt,autoPlay:Tt,blocking:xn,capture:null,charSet:null,checked:Tt,cite:null,className:xn,cols:ve,colSpan:null,content:null,contentEditable:ai,controls:Tt,controlsList:xn,coords:ve|fd,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Tt,defer:Tt,dir:null,dirName:null,disabled:Tt,download:T5,draggable:ai,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Tt,formTarget:null,headers:xn,height:ve,hidden:Tt,high:ve,href:null,hrefLang:null,htmlFor:xn,httpEquiv:xn,id:null,imageSizes:null,imageSrcSet:null,inert:Tt,inputMode:null,integrity:null,is:null,isMap:Tt,itemId:null,itemProp:xn,itemRef:xn,itemScope:Tt,itemType:xn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Tt,low:ve,manifest:null,max:null,maxLength:ve,media:null,method:null,min:null,minLength:ve,multiple:Tt,muted:Tt,name:null,nonce:null,noModule:Tt,noValidate:Tt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Tt,optimum:ve,pattern:null,ping:xn,placeholder:null,playsInline:Tt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Tt,referrerPolicy:null,rel:xn,required:Tt,reversed:Tt,rows:ve,rowSpan:ve,sandbox:xn,scope:null,scoped:Tt,seamless:Tt,selected:Tt,shadowRootClonable:Tt,shadowRootDelegatesFocus:Tt,shadowRootMode:null,shape:null,size:ve,sizes:null,slot:null,span:ve,spellCheck:ai,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ve,step:null,style:null,tabIndex:ve,target:null,title:null,translate:null,type:null,typeMustMatch:Tt,useMap:null,value:ai,width:ve,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:xn,axis:null,background:null,bgColor:null,border:ve,borderColor:null,bottomMargin:ve,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Tt,declare:Tt,event:null,face:null,frame:null,frameBorder:null,hSpace:ve,leftMargin:ve,link:null,longDesc:null,lowSrc:null,marginHeight:ve,marginWidth:ve,noResize:Tt,noHref:Tt,noShade:Tt,noWrap:Tt,object:null,profile:null,prompt:null,rev:null,rightMargin:ve,rules:null,scheme:null,scrolling:ai,standby:null,summary:null,text:null,topMargin:ve,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ve,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Tt,disableRemotePlayback:Tt,prefix:null,property:null,results:ve,security:null,unselectable:null}}),Nse=pp({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:P5,properties:{about:ls,accentHeight:ve,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ve,amplitude:ve,arabicForm:null,ascent:ve,attributeName:null,attributeType:null,azimuth:ve,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ve,by:null,calcMode:null,capHeight:ve,className:xn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ve,diffuseConstant:ve,direction:null,display:null,dur:null,divisor:ve,dominantBaseline:null,download:Tt,dx:null,dy:null,edgeMode:null,editable:null,elevation:ve,enableBackground:null,end:null,event:null,exponent:ve,externalResourcesRequired:null,fill:null,fillOpacity:ve,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:fd,g2:fd,glyphName:fd,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ve,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ve,horizOriginX:ve,horizOriginY:ve,id:null,ideographic:ve,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ve,k:ve,k1:ve,k2:ve,k3:ve,k4:ve,kernelMatrix:ls,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ve,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ve,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ve,overlineThickness:ve,paintOrder:null,panose1:null,path:null,pathLength:ve,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:xn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ve,pointsAtY:ve,pointsAtZ:ve,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:ls,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:ls,rev:ls,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:ls,requiredFeatures:ls,requiredFonts:ls,requiredFormats:ls,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ve,specularExponent:ve,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ve,strikethroughThickness:ve,string:null,stroke:null,strokeDashArray:ls,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ve,strokeOpacity:ve,strokeWidth:null,style:null,surfaceScale:ve,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:ls,tabIndex:ve,tableValues:null,target:null,targetX:ve,targetY:ve,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:ls,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ve,underlineThickness:ve,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ve,values:null,vAlphabetic:ve,vMathematical:ve,vectorEffect:null,vHanging:ve,vIdeographic:ve,version:null,vertAdvY:ve,vertOriginX:ve,vertOriginY:ve,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ve,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),Ose=/^data[-\w.:]+$/i,vD=/-[a-z]/g,Fse=/[A-Z]/g;function zse(t,e){const n=oT(e);let i=e,r=Zs;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&Ose.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(vD,Bse);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!vD.test(s)){let o=s.replace(Fse,Use);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}r=oA}return new r(i,e)}function Use(t){return"-"+t.toLowerCase()}function Bse(t){return t.charAt(1).toUpperCase()}const $se={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},Hse=R5([A5,b5,M5,k5,Dse],"html"),aA=R5([A5,b5,M5,k5,Nse],"svg");function Vse(t){return t.join(" ").trim()}var L5={},yD=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,jse=/\n/g,Wse=/^\s*/,Gse=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,qse=/^:\s*/,Xse=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,Kse=/^[;\s]*/,Yse=/^\s+|\s+$/g,Jse=`
`,SD="/",xD="*",nu="",Qse="comment",Zse="declaration",eoe=function(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,i=1;function r(f){var v=f.match(jse);v&&(n+=v.length);var g=f.lastIndexOf(Jse);i=~g?f.length-g:i+f.length}function s(){var f={line:n,column:i};return function(v){return v.position=new o(f),c(),v}}function o(f){this.start=f,this.end={line:n,column:i},this.source=e.source}o.prototype.content=t;function a(f){var v=new Error(e.source+":"+n+":"+i+": "+f);if(v.reason=f,v.filename=e.source,v.line=n,v.column=i,v.source=t,!e.silent)throw v}function l(f){var v=f.exec(t);if(v){var g=v[0];return r(g),t=t.slice(g.length),v}}function c(){l(Wse)}function u(f){var v;for(f=f||[];v=h();)v!==!1&&f.push(v);return f}function h(){var f=s();if(!(SD!=t.charAt(0)||xD!=t.charAt(1))){for(var v=2;nu!=t.charAt(v)&&(xD!=t.charAt(v)||SD!=t.charAt(v+1));)++v;if(v+=2,nu===t.charAt(v-1))return a("End of comment missing");var g=t.slice(2,v-2);return i+=2,r(g),t=t.slice(v),i+=2,f({type:Qse,comment:g})}}function d(){var f=s(),v=l(Gse);if(v){if(h(),!l(qse))return a("property missing ':'");var g=l(Xse),m=f({type:Zse,property:CD(v[0].replace(yD,nu)),value:g?CD(g[0].replace(yD,nu)):nu});return l(Kse),m}}function p(){var f=[];u(f);for(var v;v=d();)v!==!1&&(f.push(v),u(f));return f}return c(),p()};function CD(t){return t?t.replace(Yse,nu):nu}var toe=It&&It.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(L5,"__esModule",{value:!0});var _D=L5.default=ioe,noe=toe(eoe);function ioe(t,e){var n=null;if(!t||typeof t!="string")return n;var i=(0,noe.default)(t),r=typeof e=="function";return i.forEach(function(s){if(s.type==="declaration"){var o=s.property,a=s.value;r?e(o,a,s):a&&(n=n||{},n[o]=a)}}),n}const roe=_D.default||_D,D5=N5("end"),lA=N5("start");function N5(t){return e;function e(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function soe(t){const e=lA(t),n=D5(t);if(e&&n)return{start:e,end:n}}function _g(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?wD(t.position):"start"in t||"end"in t?wD(t):"line"in t||"column"in t?lT(t):""}function lT(t){return ED(t&&t.line)+":"+ED(t&&t.column)}function wD(t){return lT(t&&t.start)+"-"+lT(t&&t.end)}function ED(t){return t&&typeof t=="number"?t:1}class gr extends Error{constructor(e,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let r="",s={},o=!1;if(n&&("line"in n&&"column"in n?s={place:n}:"start"in n&&"end"in n?s={place:n}:"type"in n?s={ancestors:[n],place:n.position}:s={...n}),typeof e=="string"?r=e:!s.cause&&e&&(o=!0,r=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof i=="string"){const l=i.indexOf(":");l===-1?s.ruleId=i:(s.source=i.slice(0,l),s.ruleId=i.slice(l+1))}if(!s.place&&s.ancestors&&s.ancestors){const l=s.ancestors[s.ancestors.length-1];l&&(s.place=l.position)}const a=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file,this.message=r,this.line=a?a.line:void 0,this.name=_g(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=o&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual,this.expected,this.note,this.url}}gr.prototype.file="";gr.prototype.name="";gr.prototype.reason="";gr.prototype.message="";gr.prototype.stack="";gr.prototype.column=void 0;gr.prototype.line=void 0;gr.prototype.ancestors=void 0;gr.prototype.cause=void 0;gr.prototype.fatal=void 0;gr.prototype.place=void 0;gr.prototype.ruleId=void 0;gr.prototype.source=void 0;const cA={}.hasOwnProperty,ooe=new Map,aoe=/[A-Z]/g,loe=/-([a-z])/g,coe=new Set(["table","tbody","thead","tfoot","tr"]),uoe=new Set(["td","th"]),O5="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function hoe(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let i;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=Soe(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");i=yoe(n,e.jsx,e.jsxs)}const r={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:i,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?aA:Hse,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},s=F5(r,t,void 0);return s&&typeof s!="string"?s:r.create(t,r.Fragment,{children:s||void 0},void 0)}function F5(t,e,n){if(e.type==="element")return doe(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return poe(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return moe(t,e,n);if(e.type==="mdxjsEsm")return foe(t,e);if(e.type==="root")return goe(t,e,n);if(e.type==="text")return voe(t,e)}function doe(t,e,n){const i=t.schema;let r=i;e.tagName.toLowerCase()==="svg"&&i.space==="html"&&(r=aA,t.schema=r),t.ancestors.push(e);const s=U5(t,e.tagName,!1),o=xoe(t,e);let a=hA(t,e);return coe.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!Mse(l):!0})),z5(t,o,s,e),uA(o,a),t.ancestors.pop(),t.schema=i,t.create(e,s,o,n)}function poe(t,e){if(e.data&&e.data.estree&&t.evaluater){const i=e.data.estree.body[0];return i.type,t.evaluater.evaluateExpression(i.expression)}r0(t,e.position)}function foe(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);r0(t,e.position)}function moe(t,e,n){const i=t.schema;let r=i;e.name==="svg"&&i.space==="html"&&(r=aA,t.schema=r),t.ancestors.push(e);const s=e.name===null?t.Fragment:U5(t,e.name,!0),o=Coe(t,e),a=hA(t,e);return z5(t,o,s,e),uA(o,a),t.ancestors.pop(),t.schema=i,t.create(e,s,o,n)}function goe(t,e,n){const i={};return uA(i,hA(t,e)),t.create(e,t.Fragment,i,n)}function voe(t,e){return e.value}function z5(t,e,n,i){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=i)}function uA(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function yoe(t,e,n){return i;function i(r,s,o,a){const c=Array.isArray(o.children)?n:e;return a?c(s,o,a):c(s,o)}}function Soe(t,e){return n;function n(i,r,s,o){const a=Array.isArray(s.children),l=lA(i);return e(r,s,o,a,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function xoe(t,e){const n={};let i,r;for(r in e.properties)if(r!=="children"&&cA.call(e.properties,r)){const s=_oe(t,r,e.properties[r]);if(s){const[o,a]=s;t.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&uoe.has(e.tagName)?i=a:n[o]=a}}if(i){const s=n.style||(n.style={});s[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}return n}function Coe(t,e){const n={};for(const i of e.attributes)if(i.type==="mdxJsxExpressionAttribute")if(i.data&&i.data.estree&&t.evaluater){const s=i.data.estree.body[0];s.type;const o=s.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else r0(t,e.position);else{const r=i.name;let s;if(i.value&&typeof i.value=="object")if(i.value.data&&i.value.data.estree&&t.evaluater){const a=i.value.data.estree.body[0];a.type,s=t.evaluater.evaluateExpression(a.expression)}else r0(t,e.position);else s=i.value===null?!0:i.value;n[r]=s}return n}function hA(t,e){const n=[];let i=-1;const r=t.passKeys?new Map:ooe;for(;++i<e.children.length;){const s=e.children[i];let o;if(t.passKeys){const l=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(l){const c=r.get(l)||0;o=l+"-"+c,r.set(l,c+1)}}const a=F5(t,s,o);a!==void 0&&n.push(a)}return n}function _oe(t,e,n){const i=zse(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?Tse(n):Vse(n)),i.property==="style"){let r=typeof n=="object"?n:woe(t,String(n));return t.stylePropertyNameCase==="css"&&(r=Eoe(r)),["style",r]}return[t.elementAttributeNameCase==="react"&&i.space?$se[i.property]||i.property:i.attribute,n]}}function woe(t,e){const n={};try{roe(e,i)}catch(r){if(!t.ignoreInvalidStyle){const s=r,o=new gr("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:s,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw o.file=t.filePath||void 0,o.url=O5+"#cannot-parse-style-attribute",o}}return n;function i(r,s){let o=r;o.slice(0,2)!=="--"&&(o.slice(0,4)==="-ms-"&&(o="ms-"+o.slice(4)),o=o.replace(loe,Toe)),n[o]=s}}function U5(t,e,n){let i;if(!n)i={type:"Literal",value:e};else if(e.includes(".")){const r=e.split(".");let s=-1,o;for(;++s<r.length;){const a=fD(r[s])?{type:"Identifier",name:r[s]}:{type:"Literal",value:r[s]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(s&&a.type==="Literal"),optional:!1}:a}i=o}else i=fD(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(i.type==="Literal"){const r=i.value;return cA.call(t.components,r)?t.components[r]:r}if(t.evaluater)return t.evaluater.evaluateExpression(i);r0(t)}function r0(t,e){const n=new gr("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=O5+"#cannot-handle-mdx-estrees-without-createevaluater",n}function Eoe(t){const e={};let n;for(n in t)cA.call(t,n)&&(e[Roe(n)]=t[n]);return e}function Roe(t){let e=t.replace(aoe,boe);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function Toe(t,e){return e.toUpperCase()}function boe(t){return"-"+t.toLowerCase()}const Mw={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Aoe={};function Poe(t,e){const n=Aoe,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,r=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return B5(t,i,r)}function B5(t,e,n){if(Ioe(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return RD(t.children,e,n)}return Array.isArray(t)?RD(t,e,n):""}function RD(t,e,n){const i=[];let r=-1;for(;++r<t.length;)i[r]=B5(t[r],e,n);return i.join("")}function Ioe(t){return!!(t&&typeof t=="object")}const TD=document.createElement("i");function dA(t){const e="&"+t+";";TD.innerHTML=e;const n=TD.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Qa(t,e,n,i){const r=t.length;let s=0,o;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);s<i.length;)o=i.slice(s,s+1e4),o.unshift(e,0),t.splice(...o),s+=1e4,e+=1e4}function Os(t,e){return t.length>0?(Qa(t,t.length,0,e),t):e}const bD={}.hasOwnProperty;function Moe(t){const e={};let n=-1;for(;++n<t.length;)koe(e,t[n]);return e}function koe(t,e){let n;for(n in e){const r=(bD.call(t,n)?t[n]:void 0)||(t[n]={}),s=e[n];let o;if(s)for(o in s){bD.call(r,o)||(r[o]=[]);const a=s[o];Loe(r[o],Array.isArray(a)?a:a?[a]:[])}}}function Loe(t,e){let n=-1;const i=[];for(;++n<e.length;)(e[n].add==="after"?t:i).push(e[n]);Qa(t,0,0,i)}function $5(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"�":String.fromCodePoint(n)}function md(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ea=xc(/[A-Za-z]/),fs=xc(/[\dA-Za-z]/),Doe=xc(/[#-'*+\--9=?A-Z^-~]/);function cT(t){return t!==null&&(t<32||t===127)}const uT=xc(/\d/),Noe=xc(/[\dA-Fa-f]/),Ooe=xc(/[!-/:-@[-`{-~]/);function xt(t){return t!==null&&t<-2}function Gr(t){return t!==null&&(t<0||t===32)}function nn(t){return t===-2||t===-1||t===32}const Foe=xc(new RegExp("\\p{P}|\\p{S}","u")),zoe=xc(/\s/);function xc(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function fp(t){const e=[];let n=-1,i=0,r=0;for(;++n<t.length;){const s=t.charCodeAt(n);let o="";if(s===37&&fs(t.charCodeAt(n+1))&&fs(t.charCodeAt(n+2)))r=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(o=String.fromCharCode(s));else if(s>55295&&s<57344){const a=t.charCodeAt(n+1);s<56320&&a>56319&&a<57344?(o=String.fromCharCode(s,a),r=1):o="�"}else o=String.fromCharCode(s);o&&(e.push(t.slice(i,n),encodeURIComponent(o)),i=n+r+1,o=""),r&&(n+=r,r=0)}return e.join("")+t.slice(i)}function wn(t,e,n,i){const r=i?i-1:Number.POSITIVE_INFINITY;let s=0;return o;function o(l){return nn(l)?(t.enter(n),a(l)):e(l)}function a(l){return nn(l)&&s++<r?(t.consume(l),a):(t.exit(n),e(l))}}const Uoe={tokenize:Boe};function Boe(t){const e=t.attempt(this.parser.constructs.contentInitial,i,r);let n;return e;function i(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),wn(t,e,"linePrefix")}function r(a){return t.enter("paragraph"),s(a)}function s(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return xt(a)?(t.consume(a),t.exit("chunkText"),s):(t.consume(a),o)}}const $oe={tokenize:Hoe},AD={tokenize:Voe};function Hoe(t){const e=this,n=[];let i=0,r,s,o;return a;function a(S){if(i<n.length){const x=n[i];return e.containerState=x[1],t.attempt(x[0].continuation,l,c)(S)}return c(S)}function l(S){if(i++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,r&&y();const x=e.events.length;let w=x,C;for(;w--;)if(e.events[w][0]==="exit"&&e.events[w][1].type==="chunkFlow"){C=e.events[w][1].end;break}m(i);let E=x;for(;E<e.events.length;)e.events[E][1].end=Object.assign({},C),E++;return Qa(e.events,w+1,0,e.events.slice(x)),e.events.length=E,c(S)}return a(S)}function c(S){if(i===n.length){if(!r)return d(S);if(r.currentConstruct&&r.currentConstruct.concrete)return f(S);e.interrupt=!!(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(AD,u,h)(S)}function u(S){return r&&y(),m(i),d(S)}function h(S){return e.parser.lazy[e.now().line]=i!==n.length,o=e.now().offset,f(S)}function d(S){return e.containerState={},t.attempt(AD,p,f)(S)}function p(S){return i++,n.push([e.currentConstruct,e.containerState]),d(S)}function f(S){if(S===null){r&&y(),m(0),t.consume(S);return}return r=r||e.parser.flow(e.now()),t.enter("chunkFlow",{contentType:"flow",previous:s,_tokenizer:r}),v(S)}function v(S){if(S===null){g(t.exit("chunkFlow"),!0),m(0),t.consume(S);return}return xt(S)?(t.consume(S),g(t.exit("chunkFlow")),i=0,e.interrupt=void 0,a):(t.consume(S),v)}function g(S,x){const w=e.sliceStream(S);if(x&&w.push(null),S.previous=s,s&&(s.next=S),s=S,r.defineSkip(S.start),r.write(w),e.parser.lazy[S.start.line]){let C=r.events.length;for(;C--;)if(r.events[C][1].start.offset<o&&(!r.events[C][1].end||r.events[C][1].end.offset>o))return;const E=e.events.length;let T=E,M,_;for(;T--;)if(e.events[T][0]==="exit"&&e.events[T][1].type==="chunkFlow"){if(M){_=e.events[T][1].end;break}M=!0}for(m(i),C=E;C<e.events.length;)e.events[C][1].end=Object.assign({},_),C++;Qa(e.events,T+1,0,e.events.slice(E)),e.events.length=C}}function m(S){let x=n.length;for(;x-- >S;){const w=n[x];e.containerState=w[1],w[0].exit.call(e,t)}n.length=S}function y(){r.write([null]),s=void 0,r=void 0,e.containerState._closeFlow=void 0}}function Voe(t,e,n){return wn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function PD(t){if(t===null||Gr(t)||zoe(t))return 1;if(Foe(t))return 2}function pA(t,e,n){const i=[];let r=-1;for(;++r<t.length;){const s=t[r].resolveAll;s&&!i.includes(s)&&(e=s(e,n),i.push(s))}return e}const hT={name:"attention",tokenize:Woe,resolveAll:joe};function joe(t,e){let n=-1,i,r,s,o,a,l,c,u;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(i=n;i--;)if(t[i][0]==="exit"&&t[i][1].type==="attentionSequence"&&t[i][1]._open&&e.sliceSerialize(t[i][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[i][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[i][1].end.offset-t[i][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[i][1].end.offset-t[i][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const h=Object.assign({},t[i][1].end),d=Object.assign({},t[n][1].start);ID(h,-l),ID(d,l),o={type:l>1?"strongSequence":"emphasisSequence",start:h,end:Object.assign({},t[i][1].end)},a={type:l>1?"strongSequence":"emphasisSequence",start:Object.assign({},t[n][1].start),end:d},s={type:l>1?"strongText":"emphasisText",start:Object.assign({},t[i][1].end),end:Object.assign({},t[n][1].start)},r={type:l>1?"strong":"emphasis",start:Object.assign({},o.start),end:Object.assign({},a.end)},t[i][1].end=Object.assign({},o.start),t[n][1].start=Object.assign({},a.end),c=[],t[i][1].end.offset-t[i][1].start.offset&&(c=Os(c,[["enter",t[i][1],e],["exit",t[i][1],e]])),c=Os(c,[["enter",r,e],["enter",o,e],["exit",o,e],["enter",s,e]]),c=Os(c,pA(e.parser.constructs.insideSpan.null,t.slice(i+1,n),e)),c=Os(c,[["exit",s,e],["enter",a,e],["exit",a,e],["exit",r,e]]),t[n][1].end.offset-t[n][1].start.offset?(u=2,c=Os(c,[["enter",t[n][1],e],["exit",t[n][1],e]])):u=0,Qa(t,i-1,n-i+3,c),n=i+c.length-u-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function Woe(t,e){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,r=PD(i);let s;return o;function o(l){return s=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===s)return t.consume(l),a;const c=t.exit("attentionSequence"),u=PD(l),h=!u||u===2&&r||n.includes(l),d=!r||r===2&&u||n.includes(i);return c._open=!!(s===42?h:h&&(r||!d)),c._close=!!(s===42?d:d&&(u||!h)),e(l)}}function ID(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const Goe={name:"autolink",tokenize:qoe};function qoe(t,e,n){let i=0;return r;function r(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),s}function s(p){return ea(p)?(t.consume(p),o):p===64?n(p):c(p)}function o(p){return p===43||p===45||p===46||fs(p)?(i=1,a(p)):c(p)}function a(p){return p===58?(t.consume(p),i=0,l):(p===43||p===45||p===46||fs(p))&&i++<32?(t.consume(p),a):(i=0,c(p))}function l(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||cT(p)?n(p):(t.consume(p),l)}function c(p){return p===64?(t.consume(p),u):Doe(p)?(t.consume(p),c):n(p)}function u(p){return fs(p)?h(p):n(p)}function h(p){return p===46?(t.consume(p),i=0,u):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):d(p)}function d(p){if((p===45||fs(p))&&i++<63){const f=p===45?d:h;return t.consume(p),f}return n(p)}}const eC={tokenize:Xoe,partial:!0};function Xoe(t,e,n){return i;function i(s){return nn(s)?wn(t,r,"linePrefix")(s):r(s)}function r(s){return s===null||xt(s)?e(s):n(s)}}const H5={name:"blockQuote",tokenize:Koe,continuation:{tokenize:Yoe},exit:Joe};function Koe(t,e,n){const i=this;return r;function r(o){if(o===62){const a=i.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),s}return n(o)}function s(o){return nn(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function Yoe(t,e,n){const i=this;return r;function r(o){return nn(o)?wn(t,s,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):s(o)}function s(o){return t.attempt(H5,e,n)(o)}}function Joe(t){t.exit("blockQuote")}const V5={name:"characterEscape",tokenize:Qoe};function Qoe(t,e,n){return i;function i(s){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(s),t.exit("escapeMarker"),r}function r(s){return Ooe(s)?(t.enter("characterEscapeValue"),t.consume(s),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(s)}}const j5={name:"characterReference",tokenize:Zoe};function Zoe(t,e,n){const i=this;let r=0,s,o;return a;function a(h){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(h),t.exit("characterReferenceMarker"),l}function l(h){return h===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(h),t.exit("characterReferenceMarkerNumeric"),c):(t.enter("characterReferenceValue"),s=31,o=fs,u(h))}function c(h){return h===88||h===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(h),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),s=6,o=Noe,u):(t.enter("characterReferenceValue"),s=7,o=uT,u(h))}function u(h){if(h===59&&r){const d=t.exit("characterReferenceValue");return o===fs&&!dA(i.sliceSerialize(d))?n(h):(t.enter("characterReferenceMarker"),t.consume(h),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(h)&&r++<s?(t.consume(h),u):n(h)}}const MD={tokenize:tae,partial:!0},kD={name:"codeFenced",tokenize:eae,concrete:!0};function eae(t,e,n){const i=this,r={tokenize:w,partial:!0};let s=0,o=0,a;return l;function l(C){return c(C)}function c(C){const E=i.events[i.events.length-1];return s=E&&E[1].type==="linePrefix"?E[2].sliceSerialize(E[1],!0).length:0,a=C,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),u(C)}function u(C){return C===a?(o++,t.consume(C),u):o<3?n(C):(t.exit("codeFencedFenceSequence"),nn(C)?wn(t,h,"whitespace")(C):h(C))}function h(C){return C===null||xt(C)?(t.exit("codeFencedFence"),i.interrupt?e(C):t.check(MD,v,x)(C)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),d(C))}function d(C){return C===null||xt(C)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),h(C)):nn(C)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),wn(t,p,"whitespace")(C)):C===96&&C===a?n(C):(t.consume(C),d)}function p(C){return C===null||xt(C)?h(C):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),f(C))}function f(C){return C===null||xt(C)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),h(C)):C===96&&C===a?n(C):(t.consume(C),f)}function v(C){return t.attempt(r,x,g)(C)}function g(C){return t.enter("lineEnding"),t.consume(C),t.exit("lineEnding"),m}function m(C){return s>0&&nn(C)?wn(t,y,"linePrefix",s+1)(C):y(C)}function y(C){return C===null||xt(C)?t.check(MD,v,x)(C):(t.enter("codeFlowValue"),S(C))}function S(C){return C===null||xt(C)?(t.exit("codeFlowValue"),y(C)):(t.consume(C),S)}function x(C){return t.exit("codeFenced"),e(C)}function w(C,E,T){let M=0;return _;function _($){return C.enter("lineEnding"),C.consume($),C.exit("lineEnding"),R}function R($){return C.enter("codeFencedFence"),nn($)?wn(C,L,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)($):L($)}function L($){return $===a?(C.enter("codeFencedFenceSequence"),z($)):T($)}function z($){return $===a?(M++,C.consume($),z):M>=o?(C.exit("codeFencedFenceSequence"),nn($)?wn(C,G,"whitespace")($):G($)):T($)}function G($){return $===null||xt($)?(C.exit("codeFencedFence"),E($)):T($)}}}function tae(t,e,n){const i=this;return r;function r(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s)}function s(o){return i.parser.lazy[i.now().line]?n(o):e(o)}}const kw={name:"codeIndented",tokenize:iae},nae={tokenize:rae,partial:!0};function iae(t,e,n){const i=this;return r;function r(c){return t.enter("codeIndented"),wn(t,s,"linePrefix",5)(c)}function s(c){const u=i.events[i.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?o(c):n(c)}function o(c){return c===null?l(c):xt(c)?t.attempt(nae,o,l)(c):(t.enter("codeFlowValue"),a(c))}function a(c){return c===null||xt(c)?(t.exit("codeFlowValue"),o(c)):(t.consume(c),a)}function l(c){return t.exit("codeIndented"),e(c)}}function rae(t,e,n){const i=this;return r;function r(o){return i.parser.lazy[i.now().line]?n(o):xt(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),r):wn(t,s,"linePrefix",5)(o)}function s(o){const a=i.events[i.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):xt(o)?r(o):n(o)}}const sae={name:"codeText",tokenize:lae,resolve:oae,previous:aae};function oae(t){let e=t.length-4,n=3,i,r;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(i=n;++i<e;)if(t[i][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(i=n-1,e++;++i<=e;)r===void 0?i!==e&&t[i][1].type!=="lineEnding"&&(r=i):(i===e||t[i][1].type==="lineEnding")&&(t[r][1].type="codeTextData",i!==r+2&&(t[r][1].end=t[i-1][1].end,t.splice(r+2,i-r-2),e-=i-r-2,i=r+2),r=void 0);return t}function aae(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function lae(t,e,n){let i=0,r,s;return o;function o(h){return t.enter("codeText"),t.enter("codeTextSequence"),a(h)}function a(h){return h===96?(t.consume(h),i++,a):(t.exit("codeTextSequence"),l(h))}function l(h){return h===null?n(h):h===32?(t.enter("space"),t.consume(h),t.exit("space"),l):h===96?(s=t.enter("codeTextSequence"),r=0,u(h)):xt(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),l):(t.enter("codeTextData"),c(h))}function c(h){return h===null||h===32||h===96||xt(h)?(t.exit("codeTextData"),l(h)):(t.consume(h),c)}function u(h){return h===96?(t.consume(h),r++,u):r===i?(t.exit("codeTextSequence"),t.exit("codeText"),e(h)):(s.type="codeTextData",c(h))}}class cae{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(e,i):e>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(e,n,i){const r=n||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return i&&Fm(this.left,i),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Fm(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Fm(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);Fm(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Fm(this.left,n.reverse())}}}function Fm(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function W5(t){const e={};let n=-1,i,r,s,o,a,l,c;const u=new cae(t);for(;++n<u.length;){for(;n in e;)n=e[n];if(i=u.get(n),n&&i[1].type==="chunkFlow"&&u.get(n-1)[1].type==="listItemPrefix"&&(l=i[1]._tokenizer.events,s=0,s<l.length&&l[s][1].type==="lineEndingBlank"&&(s+=2),s<l.length&&l[s][1].type==="content"))for(;++s<l.length&&l[s][1].type!=="content";)l[s][1].type==="chunkText"&&(l[s][1]._isInFirstContentOfListItem=!0,s++);if(i[0]==="enter")i[1].contentType&&(Object.assign(e,uae(u,n)),n=e[n],c=!0);else if(i[1]._container){for(s=n,r=void 0;s--&&(o=u.get(s),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank");)o[0]==="enter"&&(r&&(u.get(r)[1].type="lineEndingBlank"),o[1].type="lineEnding",r=s);r&&(i[1].end=Object.assign({},u.get(r)[1].start),a=u.slice(r,n),a.unshift(i),u.splice(r,n-r+1,a))}}return Qa(t,0,Number.POSITIVE_INFINITY,u.slice(0)),!c}function uae(t,e){const n=t.get(e)[1],i=t.get(e)[2];let r=e-1;const s=[],o=n._tokenizer||i.parser[n.contentType](n.start),a=o.events,l=[],c={};let u,h,d=-1,p=n,f=0,v=0;const g=[v];for(;p;){for(;t.get(++r)[1]!==p;);s.push(r),p._tokenizer||(u=i.sliceStream(p),p.next||u.push(null),h&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),h=p,p=p.next}for(p=n;++d<a.length;)a[d][0]==="exit"&&a[d-1][0]==="enter"&&a[d][1].type===a[d-1][1].type&&a[d][1].start.line!==a[d][1].end.line&&(v=d+1,g.push(v),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):g.pop(),d=g.length;d--;){const m=a.slice(g[d],g[d+1]),y=s.pop();l.push([y,y+m.length-1]),t.splice(y,2,m)}for(l.reverse(),d=-1;++d<l.length;)c[f+l[d][0]]=f+l[d][1],f+=l[d][1]-l[d][0]-1;return c}const hae={tokenize:fae,resolve:pae},dae={tokenize:mae,partial:!0};function pae(t){return W5(t),t}function fae(t,e){let n;return i;function i(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),r(a)}function r(a){return a===null?s(a):xt(a)?t.check(dae,o,s)(a):(t.consume(a),r)}function s(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}}function mae(t,e,n){const i=this;return r;function r(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),wn(t,s,"linePrefix")}function s(o){if(o===null||xt(o))return n(o);const a=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(i.parser.constructs.flow,n,e)(o)}}function G5(t,e,n,i,r,s,o,a,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return h;function h(m){return m===60?(t.enter(i),t.enter(r),t.enter(s),t.consume(m),t.exit(s),d):m===null||m===32||m===41||cT(m)?n(m):(t.enter(i),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),v(m))}function d(m){return m===62?(t.enter(s),t.consume(m),t.exit(s),t.exit(r),t.exit(i),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),p(m))}function p(m){return m===62?(t.exit("chunkString"),t.exit(a),d(m)):m===null||m===60||xt(m)?n(m):(t.consume(m),m===92?f:p)}function f(m){return m===60||m===62||m===92?(t.consume(m),p):p(m)}function v(m){return!u&&(m===null||m===41||Gr(m))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(i),e(m)):u<c&&m===40?(t.consume(m),u++,v):m===41?(t.consume(m),u--,v):m===null||m===32||m===40||cT(m)?n(m):(t.consume(m),m===92?g:v)}function g(m){return m===40||m===41||m===92?(t.consume(m),v):v(m)}}function q5(t,e,n,i,r,s){const o=this;let a=0,l;return c;function c(p){return t.enter(i),t.enter(r),t.consume(p),t.exit(r),t.enter(s),u}function u(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(p):p===93?(t.exit(s),t.enter(r),t.consume(p),t.exit(r),t.exit(i),e):xt(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),u):(t.enter("chunkString",{contentType:"string"}),h(p))}function h(p){return p===null||p===91||p===93||xt(p)||a++>999?(t.exit("chunkString"),u(p)):(t.consume(p),l||(l=!nn(p)),p===92?d:h)}function d(p){return p===91||p===92||p===93?(t.consume(p),a++,h):h(p)}}function X5(t,e,n,i,r,s){let o;return a;function a(d){return d===34||d===39||d===40?(t.enter(i),t.enter(r),t.consume(d),t.exit(r),o=d===40?41:d,l):n(d)}function l(d){return d===o?(t.enter(r),t.consume(d),t.exit(r),t.exit(i),e):(t.enter(s),c(d))}function c(d){return d===o?(t.exit(s),l(o)):d===null?n(d):xt(d)?(t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),wn(t,c,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),u(d))}function u(d){return d===o||d===null||xt(d)?(t.exit("chunkString"),c(d)):(t.consume(d),d===92?h:u)}function h(d){return d===o||d===92?(t.consume(d),u):u(d)}}function wg(t,e){let n;return i;function i(r){return xt(r)?(t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),n=!0,i):nn(r)?wn(t,i,n?"linePrefix":"lineSuffix")(r):e(r)}}const gae={name:"definition",tokenize:yae},vae={tokenize:Sae,partial:!0};function yae(t,e,n){const i=this;let r;return s;function s(p){return t.enter("definition"),o(p)}function o(p){return q5.call(i,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return r=md(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),l):n(p)}function l(p){return Gr(p)?wg(t,c)(p):c(p)}function c(p){return G5(t,u,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function u(p){return t.attempt(vae,h,h)(p)}function h(p){return nn(p)?wn(t,d,"whitespace")(p):d(p)}function d(p){return p===null||xt(p)?(t.exit("definition"),i.parser.defined.push(r),e(p)):n(p)}}function Sae(t,e,n){return i;function i(a){return Gr(a)?wg(t,r)(a):n(a)}function r(a){return X5(t,s,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function s(a){return nn(a)?wn(t,o,"whitespace")(a):o(a)}function o(a){return a===null||xt(a)?e(a):n(a)}}const xae={name:"hardBreakEscape",tokenize:Cae};function Cae(t,e,n){return i;function i(s){return t.enter("hardBreakEscape"),t.consume(s),r}function r(s){return xt(s)?(t.exit("hardBreakEscape"),e(s)):n(s)}}const _ae={name:"headingAtx",tokenize:Eae,resolve:wae};function wae(t,e){let n=t.length-2,i=3,r,s;return t[i][1].type==="whitespace"&&(i+=2),n-2>i&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&t[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(r={type:"atxHeadingText",start:t[i][1].start,end:t[n][1].end},s={type:"chunkText",start:t[i][1].start,end:t[n][1].end,contentType:"text"},Qa(t,i,n-i+1,[["enter",r,e],["enter",s,e],["exit",s,e],["exit",r,e]])),t}function Eae(t,e,n){let i=0;return r;function r(u){return t.enter("atxHeading"),s(u)}function s(u){return t.enter("atxHeadingSequence"),o(u)}function o(u){return u===35&&i++<6?(t.consume(u),o):u===null||Gr(u)?(t.exit("atxHeadingSequence"),a(u)):n(u)}function a(u){return u===35?(t.enter("atxHeadingSequence"),l(u)):u===null||xt(u)?(t.exit("atxHeading"),e(u)):nn(u)?wn(t,a,"whitespace")(u):(t.enter("atxHeadingText"),c(u))}function l(u){return u===35?(t.consume(u),l):(t.exit("atxHeadingSequence"),a(u))}function c(u){return u===null||u===35||Gr(u)?(t.exit("atxHeadingText"),a(u)):(t.consume(u),c)}}const Rae=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],LD=["pre","script","style","textarea"],Tae={name:"htmlFlow",tokenize:Iae,resolveTo:Pae,concrete:!0},bae={tokenize:kae,partial:!0},Aae={tokenize:Mae,partial:!0};function Pae(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function Iae(t,e,n){const i=this;let r,s,o,a,l;return c;function c(k){return u(k)}function u(k){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(k),h}function h(k){return k===33?(t.consume(k),d):k===47?(t.consume(k),s=!0,v):k===63?(t.consume(k),r=3,i.interrupt?e:P):ea(k)?(t.consume(k),o=String.fromCharCode(k),g):n(k)}function d(k){return k===45?(t.consume(k),r=2,p):k===91?(t.consume(k),r=5,a=0,f):ea(k)?(t.consume(k),r=4,i.interrupt?e:P):n(k)}function p(k){return k===45?(t.consume(k),i.interrupt?e:P):n(k)}function f(k){const J="CDATA[";return k===J.charCodeAt(a++)?(t.consume(k),a===J.length?i.interrupt?e:L:f):n(k)}function v(k){return ea(k)?(t.consume(k),o=String.fromCharCode(k),g):n(k)}function g(k){if(k===null||k===47||k===62||Gr(k)){const J=k===47,oe=o.toLowerCase();return!J&&!s&&LD.includes(oe)?(r=1,i.interrupt?e(k):L(k)):Rae.includes(o.toLowerCase())?(r=6,J?(t.consume(k),m):i.interrupt?e(k):L(k)):(r=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(k):s?y(k):S(k))}return k===45||fs(k)?(t.consume(k),o+=String.fromCharCode(k),g):n(k)}function m(k){return k===62?(t.consume(k),i.interrupt?e:L):n(k)}function y(k){return nn(k)?(t.consume(k),y):_(k)}function S(k){return k===47?(t.consume(k),_):k===58||k===95||ea(k)?(t.consume(k),x):nn(k)?(t.consume(k),S):_(k)}function x(k){return k===45||k===46||k===58||k===95||fs(k)?(t.consume(k),x):w(k)}function w(k){return k===61?(t.consume(k),C):nn(k)?(t.consume(k),w):S(k)}function C(k){return k===null||k===60||k===61||k===62||k===96?n(k):k===34||k===39?(t.consume(k),l=k,E):nn(k)?(t.consume(k),C):T(k)}function E(k){return k===l?(t.consume(k),l=null,M):k===null||xt(k)?n(k):(t.consume(k),E)}function T(k){return k===null||k===34||k===39||k===47||k===60||k===61||k===62||k===96||Gr(k)?w(k):(t.consume(k),T)}function M(k){return k===47||k===62||nn(k)?S(k):n(k)}function _(k){return k===62?(t.consume(k),R):n(k)}function R(k){return k===null||xt(k)?L(k):nn(k)?(t.consume(k),R):n(k)}function L(k){return k===45&&r===2?(t.consume(k),H):k===60&&r===1?(t.consume(k),q):k===62&&r===4?(t.consume(k),le):k===63&&r===3?(t.consume(k),P):k===93&&r===5?(t.consume(k),Z):xt(k)&&(r===6||r===7)?(t.exit("htmlFlowData"),t.check(bae,Se,z)(k)):k===null||xt(k)?(t.exit("htmlFlowData"),z(k)):(t.consume(k),L)}function z(k){return t.check(Aae,G,Se)(k)}function G(k){return t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),$}function $(k){return k===null||xt(k)?z(k):(t.enter("htmlFlowData"),L(k))}function H(k){return k===45?(t.consume(k),P):L(k)}function q(k){return k===47?(t.consume(k),o="",D):L(k)}function D(k){if(k===62){const J=o.toLowerCase();return LD.includes(J)?(t.consume(k),le):L(k)}return ea(k)&&o.length<8?(t.consume(k),o+=String.fromCharCode(k),D):L(k)}function Z(k){return k===93?(t.consume(k),P):L(k)}function P(k){return k===62?(t.consume(k),le):k===45&&r===2?(t.consume(k),P):L(k)}function le(k){return k===null||xt(k)?(t.exit("htmlFlowData"),Se(k)):(t.consume(k),le)}function Se(k){return t.exit("htmlFlow"),e(k)}}function Mae(t,e,n){const i=this;return r;function r(o){return xt(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):n(o)}function s(o){return i.parser.lazy[i.now().line]?n(o):e(o)}}function kae(t,e,n){return i;function i(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),t.attempt(eC,e,n)}}const Lae={name:"htmlText",tokenize:Dae};function Dae(t,e,n){const i=this;let r,s,o;return a;function a(P){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(P),l}function l(P){return P===33?(t.consume(P),c):P===47?(t.consume(P),w):P===63?(t.consume(P),S):ea(P)?(t.consume(P),T):n(P)}function c(P){return P===45?(t.consume(P),u):P===91?(t.consume(P),s=0,f):ea(P)?(t.consume(P),y):n(P)}function u(P){return P===45?(t.consume(P),p):n(P)}function h(P){return P===null?n(P):P===45?(t.consume(P),d):xt(P)?(o=h,q(P)):(t.consume(P),h)}function d(P){return P===45?(t.consume(P),p):h(P)}function p(P){return P===62?H(P):P===45?d(P):h(P)}function f(P){const le="CDATA[";return P===le.charCodeAt(s++)?(t.consume(P),s===le.length?v:f):n(P)}function v(P){return P===null?n(P):P===93?(t.consume(P),g):xt(P)?(o=v,q(P)):(t.consume(P),v)}function g(P){return P===93?(t.consume(P),m):v(P)}function m(P){return P===62?H(P):P===93?(t.consume(P),m):v(P)}function y(P){return P===null||P===62?H(P):xt(P)?(o=y,q(P)):(t.consume(P),y)}function S(P){return P===null?n(P):P===63?(t.consume(P),x):xt(P)?(o=S,q(P)):(t.consume(P),S)}function x(P){return P===62?H(P):S(P)}function w(P){return ea(P)?(t.consume(P),C):n(P)}function C(P){return P===45||fs(P)?(t.consume(P),C):E(P)}function E(P){return xt(P)?(o=E,q(P)):nn(P)?(t.consume(P),E):H(P)}function T(P){return P===45||fs(P)?(t.consume(P),T):P===47||P===62||Gr(P)?M(P):n(P)}function M(P){return P===47?(t.consume(P),H):P===58||P===95||ea(P)?(t.consume(P),_):xt(P)?(o=M,q(P)):nn(P)?(t.consume(P),M):H(P)}function _(P){return P===45||P===46||P===58||P===95||fs(P)?(t.consume(P),_):R(P)}function R(P){return P===61?(t.consume(P),L):xt(P)?(o=R,q(P)):nn(P)?(t.consume(P),R):M(P)}function L(P){return P===null||P===60||P===61||P===62||P===96?n(P):P===34||P===39?(t.consume(P),r=P,z):xt(P)?(o=L,q(P)):nn(P)?(t.consume(P),L):(t.consume(P),G)}function z(P){return P===r?(t.consume(P),r=void 0,$):P===null?n(P):xt(P)?(o=z,q(P)):(t.consume(P),z)}function G(P){return P===null||P===34||P===39||P===60||P===61||P===96?n(P):P===47||P===62||Gr(P)?M(P):(t.consume(P),G)}function $(P){return P===47||P===62||Gr(P)?M(P):n(P)}function H(P){return P===62?(t.consume(P),t.exit("htmlTextData"),t.exit("htmlText"),e):n(P)}function q(P){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(P),t.exit("lineEnding"),D}function D(P){return nn(P)?wn(t,Z,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(P):Z(P)}function Z(P){return t.enter("htmlTextData"),o(P)}}const fA={name:"labelEnd",tokenize:Bae,resolveTo:Uae,resolveAll:zae},Nae={tokenize:$ae},Oae={tokenize:Hae},Fae={tokenize:Vae};function zae(t){let e=-1;for(;++e<t.length;){const n=t[e][1];(n.type==="labelImage"||n.type==="labelLink"||n.type==="labelEnd")&&(t.splice(e+1,n.type==="labelImage"?4:2),n.type="data",e++)}return t}function Uae(t,e){let n=t.length,i=0,r,s,o,a;for(;n--;)if(r=t[n][1],s){if(r.type==="link"||r.type==="labelLink"&&r._inactive)break;t[n][0]==="enter"&&r.type==="labelLink"&&(r._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(r.type==="labelImage"||r.type==="labelLink")&&!r._balanced&&(s=n,r.type!=="labelLink")){i=2;break}}else r.type==="labelEnd"&&(o=n);const l={type:t[s][1].type==="labelLink"?"link":"image",start:Object.assign({},t[s][1].start),end:Object.assign({},t[t.length-1][1].end)},c={type:"label",start:Object.assign({},t[s][1].start),end:Object.assign({},t[o][1].end)},u={type:"labelText",start:Object.assign({},t[s+i+2][1].end),end:Object.assign({},t[o-2][1].start)};return a=[["enter",l,e],["enter",c,e]],a=Os(a,t.slice(s+1,s+i+3)),a=Os(a,[["enter",u,e]]),a=Os(a,pA(e.parser.constructs.insideSpan.null,t.slice(s+i+4,o-3),e)),a=Os(a,[["exit",u,e],t[o-2],t[o-1],["exit",c,e]]),a=Os(a,t.slice(o+1)),a=Os(a,[["exit",l,e]]),Qa(t,s,t.length,a),t}function Bae(t,e,n){const i=this;let r=i.events.length,s,o;for(;r--;)if((i.events[r][1].type==="labelImage"||i.events[r][1].type==="labelLink")&&!i.events[r][1]._balanced){s=i.events[r][1];break}return a;function a(d){return s?s._inactive?h(d):(o=i.parser.defined.includes(md(i.sliceSerialize({start:s.end,end:i.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(d),t.exit("labelMarker"),t.exit("labelEnd"),l):n(d)}function l(d){return d===40?t.attempt(Nae,u,o?u:h)(d):d===91?t.attempt(Oae,u,o?c:h)(d):o?u(d):h(d)}function c(d){return t.attempt(Fae,u,h)(d)}function u(d){return e(d)}function h(d){return s._balanced=!0,n(d)}}function $ae(t,e,n){return i;function i(h){return t.enter("resource"),t.enter("resourceMarker"),t.consume(h),t.exit("resourceMarker"),r}function r(h){return Gr(h)?wg(t,s)(h):s(h)}function s(h){return h===41?u(h):G5(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function o(h){return Gr(h)?wg(t,l)(h):u(h)}function a(h){return n(h)}function l(h){return h===34||h===39||h===40?X5(t,c,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):u(h)}function c(h){return Gr(h)?wg(t,u)(h):u(h)}function u(h){return h===41?(t.enter("resourceMarker"),t.consume(h),t.exit("resourceMarker"),t.exit("resource"),e):n(h)}}function Hae(t,e,n){const i=this;return r;function r(a){return q5.call(i,t,s,o,"reference","referenceMarker","referenceString")(a)}function s(a){return i.parser.defined.includes(md(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function Vae(t,e,n){return i;function i(s){return t.enter("reference"),t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),r}function r(s){return s===93?(t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),t.exit("reference"),e):n(s)}}const jae={name:"labelStartImage",tokenize:Wae,resolveAll:fA.resolveAll};function Wae(t,e,n){const i=this;return r;function r(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),s}function s(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(a):e(a)}}const Gae={name:"labelStartLink",tokenize:qae,resolveAll:fA.resolveAll};function qae(t,e,n){const i=this;return r;function r(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),s}function s(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(o):e(o)}}const Lw={name:"lineEnding",tokenize:Xae};function Xae(t,e){return n;function n(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),wn(t,e,"linePrefix")}}const Uy={name:"thematicBreak",tokenize:Kae};function Kae(t,e,n){let i=0,r;return s;function s(c){return t.enter("thematicBreak"),o(c)}function o(c){return r=c,a(c)}function a(c){return c===r?(t.enter("thematicBreakSequence"),l(c)):i>=3&&(c===null||xt(c))?(t.exit("thematicBreak"),e(c)):n(c)}function l(c){return c===r?(t.consume(c),i++,l):(t.exit("thematicBreakSequence"),nn(c)?wn(t,a,"whitespace")(c):a(c))}}const Fr={name:"list",tokenize:Qae,continuation:{tokenize:Zae},exit:tle},Yae={tokenize:nle,partial:!0},Jae={tokenize:ele,partial:!0};function Qae(t,e,n){const i=this,r=i.events[i.events.length-1];let s=r&&r[1].type==="linePrefix"?r[2].sliceSerialize(r[1],!0).length:0,o=0;return a;function a(p){const f=i.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(f==="listUnordered"?!i.containerState.marker||p===i.containerState.marker:uT(p)){if(i.containerState.type||(i.containerState.type=f,t.enter(f,{_container:!0})),f==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(Uy,n,c)(p):c(p);if(!i.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(p)}return n(p)}function l(p){return uT(p)&&++o<10?(t.consume(p),l):(!i.interrupt||o<2)&&(i.containerState.marker?p===i.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),c(p)):n(p)}function c(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||p,t.check(eC,i.interrupt?n:u,t.attempt(Yae,d,h))}function u(p){return i.containerState.initialBlankLine=!0,s++,d(p)}function h(p){return nn(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),d):n(p)}function d(p){return i.containerState.size=s+i.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function Zae(t,e,n){const i=this;return i.containerState._closeFlow=void 0,t.check(eC,r,s);function r(a){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,wn(t,e,"listItemIndent",i.containerState.size+1)(a)}function s(a){return i.containerState.furtherBlankLines||!nn(a)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,o(a)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,t.attempt(Jae,e,o)(a))}function o(a){return i.containerState._closeFlow=!0,i.interrupt=void 0,wn(t,t.attempt(Fr,e,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function ele(t,e,n){const i=this;return wn(t,r,"listItemIndent",i.containerState.size+1);function r(s){const o=i.events[i.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===i.containerState.size?e(s):n(s)}}function tle(t){t.exit(this.containerState.type)}function nle(t,e,n){const i=this;return wn(t,r,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function r(s){const o=i.events[i.events.length-1];return!nn(s)&&o&&o[1].type==="listItemPrefixWhitespace"?e(s):n(s)}}const DD={name:"setextUnderline",tokenize:rle,resolveTo:ile};function ile(t,e){let n=t.length,i,r,s;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){i=n;break}t[n][1].type==="paragraph"&&(r=n)}else t[n][1].type==="content"&&t.splice(n,1),!s&&t[n][1].type==="definition"&&(s=n);const o={type:"setextHeading",start:Object.assign({},t[r][1].start),end:Object.assign({},t[t.length-1][1].end)};return t[r][1].type="setextHeadingText",s?(t.splice(r,0,["enter",o,e]),t.splice(s+1,0,["exit",t[i][1],e]),t[i][1].end=Object.assign({},t[s][1].end)):t[i][1]=o,t.push(["exit",o,e]),t}function rle(t,e,n){const i=this;let r;return s;function s(c){let u=i.events.length,h;for(;u--;)if(i.events[u][1].type!=="lineEnding"&&i.events[u][1].type!=="linePrefix"&&i.events[u][1].type!=="content"){h=i.events[u][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||h)?(t.enter("setextHeadingLine"),r=c,o(c)):n(c)}function o(c){return t.enter("setextHeadingLineSequence"),a(c)}function a(c){return c===r?(t.consume(c),a):(t.exit("setextHeadingLineSequence"),nn(c)?wn(t,l,"lineSuffix")(c):l(c))}function l(c){return c===null||xt(c)?(t.exit("setextHeadingLine"),e(c)):n(c)}}const sle={tokenize:ole};function ole(t){const e=this,n=t.attempt(eC,i,t.attempt(this.parser.constructs.flowInitial,r,wn(t,t.attempt(this.parser.constructs.flow,r,t.attempt(hae,r)),"linePrefix")));return n;function i(s){if(s===null){t.consume(s);return}return t.enter("lineEndingBlank"),t.consume(s),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function r(s){if(s===null){t.consume(s);return}return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const ale={resolveAll:Y5()},lle=K5("string"),cle=K5("text");function K5(t){return{tokenize:e,resolveAll:Y5(t==="text"?ule:void 0)};function e(n){const i=this,r=this.parser.constructs[t],s=n.attempt(r,o,a);return o;function o(u){return c(u)?s(u):a(u)}function a(u){if(u===null){n.consume(u);return}return n.enter("data"),n.consume(u),l}function l(u){return c(u)?(n.exit("data"),s(u)):(n.consume(u),l)}function c(u){if(u===null)return!0;const h=r[u];let d=-1;if(h)for(;++d<h.length;){const p=h[d];if(!p.previous||p.previous.call(i,i.previous))return!0}return!1}}}function Y5(t){return e;function e(n,i){let r=-1,s;for(;++r<=n.length;)s===void 0?n[r]&&n[r][1].type==="data"&&(s=r,r++):(!n[r]||n[r][1].type!=="data")&&(r!==s+2&&(n[s][1].end=n[r-1][1].end,n.splice(s+2,r-s-2),r=s+2),s=void 0);return t?t(n,i):n}}function ule(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const i=t[n-1][1],r=e.sliceStream(i);let s=r.length,o=-1,a=0,l;for(;s--;){const c=r[s];if(typeof c=="string"){for(o=c.length;c.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(c===-2)l=!0,a++;else if(c!==-1){s++;break}}if(a){const c={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{line:i.end.line,column:i.end.column-a,offset:i.end.offset-a,_index:i.start._index+s,_bufferIndex:s?o:i.start._bufferIndex+o},end:Object.assign({},i.end)};i.end=Object.assign({},c.start),i.start.offset===i.end.offset?Object.assign(i,c):(t.splice(n,0,["enter",c,e],["exit",c,e]),n+=2)}n++}return t}function hle(t,e,n){let i=Object.assign(n?Object.assign({},n):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const r={},s=[];let o=[],a=[];const l={consume:y,enter:S,exit:x,attempt:E(w),check:E(C),interrupt:E(C,{interrupt:!0})},c={previous:null,code:null,containerState:{},events:[],parser:t,sliceStream:p,sliceSerialize:d,now:f,defineSkip:v,write:h};let u=e.tokenize.call(c,l);return e.resolveAll&&s.push(e),c;function h(R){return o=Os(o,R),g(),o[o.length-1]!==null?[]:(T(e,0),c.events=pA(s,c.events,c),c.events)}function d(R,L){return ple(p(R),L)}function p(R){return dle(o,R)}function f(){const{line:R,column:L,offset:z,_index:G,_bufferIndex:$}=i;return{line:R,column:L,offset:z,_index:G,_bufferIndex:$}}function v(R){r[R.line]=R.column,_()}function g(){let R;for(;i._index<o.length;){const L=o[i._index];if(typeof L=="string")for(R=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===R&&i._bufferIndex<L.length;)m(L.charCodeAt(i._bufferIndex));else m(L)}}function m(R){u=u(R)}function y(R){xt(R)?(i.line++,i.column=1,i.offset+=R===-3?2:1,_()):R!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===o[i._index].length&&(i._bufferIndex=-1,i._index++)),c.previous=R}function S(R,L){const z=L||{};return z.type=R,z.start=f(),c.events.push(["enter",z,c]),a.push(z),z}function x(R){const L=a.pop();return L.end=f(),c.events.push(["exit",L,c]),L}function w(R,L){T(R,L.from)}function C(R,L){L.restore()}function E(R,L){return z;function z(G,$,H){let q,D,Z,P;return Array.isArray(G)?Se(G):"tokenize"in G?Se([G]):le(G);function le(pe){return ye;function ye(nt){const Je=nt!==null&&pe[nt],_t=nt!==null&&pe.null,at=[...Array.isArray(Je)?Je:Je?[Je]:[],...Array.isArray(_t)?_t:_t?[_t]:[]];return Se(at)(nt)}}function Se(pe){return q=pe,D=0,pe.length===0?H:k(pe[D])}function k(pe){return ye;function ye(nt){return P=M(),Z=pe,pe.partial||(c.currentConstruct=pe),pe.name&&c.parser.constructs.disable.null.includes(pe.name)?oe():pe.tokenize.call(L?Object.assign(Object.create(c),L):c,l,J,oe)(nt)}}function J(pe){return R(Z,P),$}function oe(pe){return P.restore(),++D<q.length?k(q[D]):H}}}function T(R,L){R.resolveAll&&!s.includes(R)&&s.push(R),R.resolve&&Qa(c.events,L,c.events.length-L,R.resolve(c.events.slice(L),c)),R.resolveTo&&(c.events=R.resolveTo(c.events,c))}function M(){const R=f(),L=c.previous,z=c.currentConstruct,G=c.events.length,$=Array.from(a);return{restore:H,from:G};function H(){i=R,c.previous=L,c.currentConstruct=z,c.events.length=G,a=$,_()}}function _(){i.line in r&&i.column<2&&(i.column=r[i.line],i.offset+=r[i.line]-1)}}function dle(t,e){const n=e.start._index,i=e.start._bufferIndex,r=e.end._index,s=e.end._bufferIndex;let o;if(n===r)o=[t[n].slice(i,s)];else{if(o=t.slice(n,r),i>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(i):o.shift()}s>0&&o.push(t[r].slice(0,s))}return o}function ple(t,e){let n=-1;const i=[];let r;for(;++n<t.length;){const s=t[n];let o;if(typeof s=="string")o=s;else switch(s){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&r)continue;o=" ";break}default:o=String.fromCharCode(s)}r=s===-2,i.push(o)}return i.join("")}const fle={42:Fr,43:Fr,45:Fr,48:Fr,49:Fr,50:Fr,51:Fr,52:Fr,53:Fr,54:Fr,55:Fr,56:Fr,57:Fr,62:H5},mle={91:gae},gle={[-2]:kw,[-1]:kw,32:kw},vle={35:_ae,42:Uy,45:[DD,Uy],60:Tae,61:DD,95:Uy,96:kD,126:kD},yle={38:j5,92:V5},Sle={[-5]:Lw,[-4]:Lw,[-3]:Lw,33:jae,38:j5,42:hT,60:[Goe,Lae],91:Gae,92:[xae,V5],93:fA,95:hT,96:sae},xle={null:[hT,ale]},Cle={null:[42,95]},_le={null:[]},wle=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Cle,contentInitial:mle,disable:_le,document:fle,flow:vle,flowInitial:gle,insideSpan:xle,string:yle,text:Sle},Symbol.toStringTag,{value:"Module"}));function Ele(t){const n=Moe([wle,...(t||{}).extensions||[]]),i={defined:[],lazy:{},constructs:n,content:r(Uoe),document:r($oe),flow:r(sle),string:r(lle),text:r(cle)};return i;function r(s){return o;function o(a){return hle(i,s,a)}}}function Rle(t){for(;!W5(t););return t}const ND=/[\0\t\n\r]/g;function Tle(){let t=1,e="",n=!0,i;return r;function r(s,o,a){const l=[];let c,u,h,d,p;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(o||void 0).decode(s)),h=0,e="",n&&(s.charCodeAt(0)===65279&&h++,n=void 0);h<s.length;){if(ND.lastIndex=h,c=ND.exec(s),d=c&&c.index!==void 0?c.index:s.length,p=s.charCodeAt(d),!c){e=s.slice(h);break}if(p===10&&h===d&&i)l.push(-3),i=void 0;else switch(i&&(l.push(-5),i=void 0),h<d&&(l.push(s.slice(h,d)),t+=d-h),p){case 0:{l.push(65533),t++;break}case 9:{for(u=Math.ceil(t/4)*4,l.push(-2);t++<u;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:i=!0,t=1}h=d+1}return a&&(i&&l.push(-5),e&&l.push(e),l.push(null)),l}}const ble=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Ale(t){return t.replace(ble,Ple)}function Ple(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const r=n.charCodeAt(1),s=r===120||r===88;return $5(n.slice(s?2:1),s?16:10)}return dA(n)||t}const J5={}.hasOwnProperty;function Ile(t,e,n){return typeof e!="string"&&(n=e,e=void 0),Mle(n)(Rle(Ele(n).document().write(Tle()(t,e,!0))))}function Mle(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(dt),autolinkProtocol:M,autolinkEmail:M,atxHeading:s(St),blockQuote:s(_t),characterEscape:M,characterReference:M,codeFenced:s(at),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:s(at,o),codeText:s(yt,o),codeTextData:M,data:M,codeFlowValue:M,definition:s(U),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:s(di),hardBreakEscape:s(Mt),hardBreakTrailing:s(Mt),htmlFlow:s(ct,o),htmlFlowData:M,htmlText:s(ct,o),htmlTextData:M,image:s(Zt),label:o,link:s(dt),listItem:s(b),listItemValue:d,listOrdered:s(I,h),listUnordered:s(I),paragraph:s(Y),reference:k,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:s(St),strong:s(ie),thematicBreak:s(ae)},exit:{atxHeading:l(),atxHeadingSequence:w,autolink:l(),autolinkEmail:Je,autolinkProtocol:nt,blockQuote:l(),characterEscapeValue:_,characterReferenceMarkerHexadecimal:oe,characterReferenceMarkerNumeric:oe,characterReferenceValue:pe,characterReference:ye,codeFenced:l(g),codeFencedFence:v,codeFencedFenceInfo:p,codeFencedFenceMeta:f,codeFlowValue:_,codeIndented:l(m),codeText:l($),codeTextData:_,data:_,definition:l(),definitionDestinationString:x,definitionLabelString:y,definitionTitleString:S,emphasis:l(),hardBreakEscape:l(L),hardBreakTrailing:l(L),htmlFlow:l(z),htmlFlowData:_,htmlText:l(G),htmlTextData:_,image:l(q),label:Z,labelText:D,lineEnding:R,link:l(H),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:J,resourceDestinationString:P,resourceTitleString:le,resource:Se,setextHeading:l(T),setextHeadingLineSequence:E,setextHeadingText:C,strong:l(),thematicBreak:l()}};Q5(e,(t||{}).mdastExtensions||[]);const n={};return i;function i(V){let K={type:"root",children:[]};const re={stack:[K],tokenStack:[],config:e,enter:a,exit:c,buffer:o,resume:u,data:n},Ie=[];let se=-1;for(;++se<V.length;)if(V[se][1].type==="listOrdered"||V[se][1].type==="listUnordered")if(V[se][0]==="enter")Ie.push(se);else{const xe=Ie.pop();se=r(V,xe,se)}for(se=-1;++se<V.length;){const xe=e[V[se][0]];J5.call(xe,V[se][1].type)&&xe[V[se][1].type].call(Object.assign({sliceSerialize:V[se][2].sliceSerialize},re),V[se][1])}if(re.tokenStack.length>0){const xe=re.tokenStack[re.tokenStack.length-1];(xe[1]||OD).call(re,void 0,xe[0])}for(K.position={start:gl(V.length>0?V[0][1].start:{line:1,column:1,offset:0}),end:gl(V.length>0?V[V.length-2][1].end:{line:1,column:1,offset:0})},se=-1;++se<e.transforms.length;)K=e.transforms[se](K)||K;return K}function r(V,K,re){let Ie=K-1,se=-1,xe=!1,Te,Qe,Ae,wt;for(;++Ie<=re;){const Ze=V[Ie];switch(Ze[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Ze[0]==="enter"?se++:se--,wt=void 0;break}case"lineEndingBlank":{Ze[0]==="enter"&&(Te&&!wt&&!se&&!Ae&&(Ae=Ie),wt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:wt=void 0}if(!se&&Ze[0]==="enter"&&Ze[1].type==="listItemPrefix"||se===-1&&Ze[0]==="exit"&&(Ze[1].type==="listUnordered"||Ze[1].type==="listOrdered")){if(Te){let Dt=Ie;for(Qe=void 0;Dt--;){const B=V[Dt];if(B[1].type==="lineEnding"||B[1].type==="lineEndingBlank"){if(B[0]==="exit")continue;Qe&&(V[Qe][1].type="lineEndingBlank",xe=!0),B[1].type="lineEnding",Qe=Dt}else if(!(B[1].type==="linePrefix"||B[1].type==="blockQuotePrefix"||B[1].type==="blockQuotePrefixWhitespace"||B[1].type==="blockQuoteMarker"||B[1].type==="listItemIndent"))break}Ae&&(!Qe||Ae<Qe)&&(Te._spread=!0),Te.end=Object.assign({},Qe?V[Qe][1].start:Ze[1].end),V.splice(Qe||Ie,0,["exit",Te,Ze[2]]),Ie++,re++}if(Ze[1].type==="listItemPrefix"){const Dt={type:"listItem",_spread:!1,start:Object.assign({},Ze[1].start),end:void 0};Te=Dt,V.splice(Ie,0,["enter",Dt,Ze[2]]),Ie++,re++,Ae=void 0,wt=!0}}}return V[K][1]._spread=xe,re}function s(V,K){return re;function re(Ie){a.call(this,V(Ie),Ie),K&&K.call(this,Ie)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(V,K,re){this.stack[this.stack.length-1].children.push(V),this.stack.push(V),this.tokenStack.push([K,re]),V.position={start:gl(K.start),end:void 0}}function l(V){return K;function K(re){V&&V.call(this,re),c.call(this,re)}}function c(V,K){const re=this.stack.pop(),Ie=this.tokenStack.pop();if(Ie)Ie[0].type!==V.type&&(K?K.call(this,V,Ie[0]):(Ie[1]||OD).call(this,V,Ie[0]));else throw new Error("Cannot close `"+V.type+"` ("+_g({start:V.start,end:V.end})+"): it’s not open");re.position.end=gl(V.end)}function u(){return Poe(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function d(V){if(this.data.expectingFirstListItemValue){const K=this.stack[this.stack.length-2];K.start=Number.parseInt(this.sliceSerialize(V),10),this.data.expectingFirstListItemValue=void 0}}function p(){const V=this.resume(),K=this.stack[this.stack.length-1];K.lang=V}function f(){const V=this.resume(),K=this.stack[this.stack.length-1];K.meta=V}function v(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function g(){const V=this.resume(),K=this.stack[this.stack.length-1];K.value=V.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function m(){const V=this.resume(),K=this.stack[this.stack.length-1];K.value=V.replace(/(\r?\n|\r)$/g,"")}function y(V){const K=this.resume(),re=this.stack[this.stack.length-1];re.label=K,re.identifier=md(this.sliceSerialize(V)).toLowerCase()}function S(){const V=this.resume(),K=this.stack[this.stack.length-1];K.title=V}function x(){const V=this.resume(),K=this.stack[this.stack.length-1];K.url=V}function w(V){const K=this.stack[this.stack.length-1];if(!K.depth){const re=this.sliceSerialize(V).length;K.depth=re}}function C(){this.data.setextHeadingSlurpLineEnding=!0}function E(V){const K=this.stack[this.stack.length-1];K.depth=this.sliceSerialize(V).codePointAt(0)===61?1:2}function T(){this.data.setextHeadingSlurpLineEnding=void 0}function M(V){const re=this.stack[this.stack.length-1].children;let Ie=re[re.length-1];(!Ie||Ie.type!=="text")&&(Ie=de(),Ie.position={start:gl(V.start),end:void 0},re.push(Ie)),this.stack.push(Ie)}function _(V){const K=this.stack.pop();K.value+=this.sliceSerialize(V),K.position.end=gl(V.end)}function R(V){const K=this.stack[this.stack.length-1];if(this.data.atHardBreak){const re=K.children[K.children.length-1];re.position.end=gl(V.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(K.type)&&(M.call(this,V),_.call(this,V))}function L(){this.data.atHardBreak=!0}function z(){const V=this.resume(),K=this.stack[this.stack.length-1];K.value=V}function G(){const V=this.resume(),K=this.stack[this.stack.length-1];K.value=V}function $(){const V=this.resume(),K=this.stack[this.stack.length-1];K.value=V}function H(){const V=this.stack[this.stack.length-1];if(this.data.inReference){const K=this.data.referenceType||"shortcut";V.type+="Reference",V.referenceType=K,delete V.url,delete V.title}else delete V.identifier,delete V.label;this.data.referenceType=void 0}function q(){const V=this.stack[this.stack.length-1];if(this.data.inReference){const K=this.data.referenceType||"shortcut";V.type+="Reference",V.referenceType=K,delete V.url,delete V.title}else delete V.identifier,delete V.label;this.data.referenceType=void 0}function D(V){const K=this.sliceSerialize(V),re=this.stack[this.stack.length-2];re.label=Ale(K),re.identifier=md(K).toLowerCase()}function Z(){const V=this.stack[this.stack.length-1],K=this.resume(),re=this.stack[this.stack.length-1];if(this.data.inReference=!0,re.type==="link"){const Ie=V.children;re.children=Ie}else re.alt=K}function P(){const V=this.resume(),K=this.stack[this.stack.length-1];K.url=V}function le(){const V=this.resume(),K=this.stack[this.stack.length-1];K.title=V}function Se(){this.data.inReference=void 0}function k(){this.data.referenceType="collapsed"}function J(V){const K=this.resume(),re=this.stack[this.stack.length-1];re.label=K,re.identifier=md(this.sliceSerialize(V)).toLowerCase(),this.data.referenceType="full"}function oe(V){this.data.characterReferenceType=V.type}function pe(V){const K=this.sliceSerialize(V),re=this.data.characterReferenceType;let Ie;re?(Ie=$5(K,re==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Ie=dA(K);const se=this.stack[this.stack.length-1];se.value+=Ie}function ye(V){const K=this.stack.pop();K.position.end=gl(V.end)}function nt(V){_.call(this,V);const K=this.stack[this.stack.length-1];K.url=this.sliceSerialize(V)}function Je(V){_.call(this,V);const K=this.stack[this.stack.length-1];K.url="mailto:"+this.sliceSerialize(V)}function _t(){return{type:"blockquote",children:[]}}function at(){return{type:"code",lang:null,meta:null,value:""}}function yt(){return{type:"inlineCode",value:""}}function U(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function di(){return{type:"emphasis",children:[]}}function St(){return{type:"heading",depth:0,children:[]}}function Mt(){return{type:"break"}}function ct(){return{type:"html",value:""}}function Zt(){return{type:"image",title:null,url:"",alt:null}}function dt(){return{type:"link",title:null,url:"",children:[]}}function I(V){return{type:"list",ordered:V.type==="listOrdered",start:null,spread:V._spread,children:[]}}function b(V){return{type:"listItem",spread:V._spread,checked:null,children:[]}}function Y(){return{type:"paragraph",children:[]}}function ie(){return{type:"strong",children:[]}}function de(){return{type:"text",value:""}}function ae(){return{type:"thematicBreak"}}}function gl(t){return{line:t.line,column:t.column,offset:t.offset}}function Q5(t,e){let n=-1;for(;++n<e.length;){const i=e[n];Array.isArray(i)?Q5(t,i):kle(t,i)}}function kle(t,e){let n;for(n in e)if(J5.call(e,n))switch(n){case"canContainEols":{const i=e[n];i&&t[n].push(...i);break}case"transforms":{const i=e[n];i&&t[n].push(...i);break}case"enter":case"exit":{const i=e[n];i&&Object.assign(t[n],i);break}}}function OD(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+_g({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+_g({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+_g({start:e.start,end:e.end})+") is still open")}function Lle(t){const e=this;e.parser=n;function n(i){return Ile(i,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function Dle(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function Nle(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function Ole(t,e){const n=e.value?e.value+`
`:"",i={};e.lang&&(i.className=["language-"+e.lang]);let r={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return e.meta&&(r.data={meta:e.meta}),t.patch(e,r),r=t.applyData(e,r),r={type:"element",tagName:"pre",properties:{},children:[r]},t.patch(e,r),r}function Fle(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function zle(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function Ule(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",i=String(e.identifier).toUpperCase(),r=fp(i.toLowerCase()),s=t.footnoteOrder.indexOf(i);let o,a=t.footnoteCounts.get(i);a===void 0?(a=0,t.footnoteOrder.push(i),o=t.footnoteOrder.length):o=s+1,a+=1,t.footnoteCounts.set(i,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+r,id:n+"fnref-"+r+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(e,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,c),t.applyData(e,c)}function Ble(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function $le(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function Z5(t,e){const n=e.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+i}];const r=t.all(e),s=r[0];s&&s.type==="text"?s.value="["+s.value:r.unshift({type:"text",value:"["});const o=r[r.length-1];return o&&o.type==="text"?o.value+=i:r.push({type:"text",value:i}),r}function Hle(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return Z5(t,e);const r={src:fp(i.url||""),alt:e.alt};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"img",properties:r,children:[]};return t.patch(e,s),t.applyData(e,s)}function Vle(t,e){const n={src:fp(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,i),t.applyData(e,i)}function jle(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,i),t.applyData(e,i)}function Wle(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return Z5(t,e);const r={href:fp(i.url||"")};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"a",properties:r,children:t.all(e)};return t.patch(e,s),t.applyData(e,s)}function Gle(t,e){const n={href:fp(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function qle(t,e,n){const i=t.all(e),r=n?Xle(n):e6(e),s={},o=[];if(typeof e.checked=="boolean"){const u=i[0];let h;u&&u.type==="element"&&u.tagName==="p"?h=u:(h={type:"element",tagName:"p",properties:{},children:[]},i.unshift(h)),h.children.length>0&&h.children.unshift({type:"text",value:" "}),h.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let a=-1;for(;++a<i.length;){const u=i[a];(r||a!==0||u.type!=="element"||u.tagName!=="p")&&o.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!r?o.push(...u.children):o.push(u)}const l=i[i.length-1];l&&(r||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:s,children:o};return t.patch(e,c),t.applyData(e,c)}function Xle(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let i=-1;for(;!e&&++i<n.length;)e=e6(n[i])}return e}function e6(t){const e=t.spread;return e??t.children.length>1}function Kle(t,e){const n={},i=t.all(e);let r=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++r<i.length;){const o=i[r];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(i,!0)};return t.patch(e,s),t.applyData(e,s)}function Yle(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function Jle(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function Qle(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function Zle(t,e){const n=t.all(e),i=n.shift(),r=[];if(i){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([i],!0)};t.patch(e.children[0],o),r.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=lA(e.children[1]),l=D5(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),r.push(o)}const s={type:"element",tagName:"table",properties:{},children:t.wrap(r,!0)};return t.patch(e,s),t.applyData(e,s)}function ece(t,e,n){const i=n?n.children:void 0,s=(i?i.indexOf(e):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:e.children.length;let l=-1;const c=[];for(;++l<a;){const h=e.children[l],d={},p=o?o[l]:void 0;p&&(d.align=p);let f={type:"element",tagName:s,properties:d,children:[]};h&&(f.children=t.all(h),t.patch(h,f),f=t.applyData(h,f)),c.push(f)}const u={type:"element",tagName:"tr",properties:{},children:t.wrap(c,!0)};return t.patch(e,u),t.applyData(e,u)}function tce(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const FD=9,zD=32;function nce(t){const e=String(t),n=/\r?\n|\r/g;let i=n.exec(e),r=0;const s=[];for(;i;)s.push(UD(e.slice(r,i.index),r>0,!0),i[0]),r=i.index+i[0].length,i=n.exec(e);return s.push(UD(e.slice(r),r>0,!1)),s.join("")}function UD(t,e,n){let i=0,r=t.length;if(e){let s=t.codePointAt(i);for(;s===FD||s===zD;)i++,s=t.codePointAt(i)}if(n){let s=t.codePointAt(r-1);for(;s===FD||s===zD;)r--,s=t.codePointAt(r-1)}return r>i?t.slice(i,r):""}function ice(t,e){const n={type:"text",value:nce(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function rce(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const sce={blockquote:Dle,break:Nle,code:Ole,delete:Fle,emphasis:zle,footnoteReference:Ule,heading:Ble,html:$le,imageReference:Hle,image:Vle,inlineCode:jle,linkReference:Wle,link:Gle,listItem:qle,list:Kle,paragraph:Yle,root:Jle,strong:Qle,table:Zle,tableCell:tce,tableRow:ece,text:ice,thematicBreak:rce,toml:Zv,yaml:Zv,definition:Zv,footnoteDefinition:Zv};function Zv(){}const t6=-1,tC=0,N1=1,O1=2,mA=3,gA=4,vA=5,yA=6,n6=7,i6=8,BD=typeof self=="object"?self:globalThis,oce=(t,e)=>{const n=(r,s)=>(t.set(s,r),r),i=r=>{if(t.has(r))return t.get(r);const[s,o]=e[r];switch(s){case tC:case t6:return n(o,r);case N1:{const a=n([],r);for(const l of o)a.push(i(l));return a}case O1:{const a=n({},r);for(const[l,c]of o)a[i(l)]=i(c);return a}case mA:return n(new Date(o),r);case gA:{const{source:a,flags:l}=o;return n(new RegExp(a,l),r)}case vA:{const a=n(new Map,r);for(const[l,c]of o)a.set(i(l),i(c));return a}case yA:{const a=n(new Set,r);for(const l of o)a.add(i(l));return a}case n6:{const{name:a,message:l}=o;return n(new BD[a](l),r)}case i6:return n(BigInt(o),r);case"BigInt":return n(Object(BigInt(o)),r)}return n(new BD[s](o),r)};return i},$D=t=>oce(new Map,t)(0),Ah="",{toString:ace}={},{keys:lce}=Object,zm=t=>{const e=typeof t;if(e!=="object"||!t)return[tC,e];const n=ace.call(t).slice(8,-1);switch(n){case"Array":return[N1,Ah];case"Object":return[O1,Ah];case"Date":return[mA,Ah];case"RegExp":return[gA,Ah];case"Map":return[vA,Ah];case"Set":return[yA,Ah]}return n.includes("Array")?[N1,n]:n.includes("Error")?[n6,n]:[O1,n]},ey=([t,e])=>t===tC&&(e==="function"||e==="symbol"),cce=(t,e,n,i)=>{const r=(o,a)=>{const l=i.push(o)-1;return n.set(a,l),l},s=o=>{if(n.has(o))return n.get(o);let[a,l]=zm(o);switch(a){case tC:{let u=o;switch(l){case"bigint":a=i6,u=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);u=null;break;case"undefined":return r([t6],o)}return r([a,u],o)}case N1:{if(l)return r([l,[...o]],o);const u=[],h=r([a,u],o);for(const d of o)u.push(s(d));return h}case O1:{if(l)switch(l){case"BigInt":return r([l,o.toString()],o);case"Boolean":case"Number":case"String":return r([l,o.valueOf()],o)}if(e&&"toJSON"in o)return s(o.toJSON());const u=[],h=r([a,u],o);for(const d of lce(o))(t||!ey(zm(o[d])))&&u.push([s(d),s(o[d])]);return h}case mA:return r([a,o.toISOString()],o);case gA:{const{source:u,flags:h}=o;return r([a,{source:u,flags:h}],o)}case vA:{const u=[],h=r([a,u],o);for(const[d,p]of o)(t||!(ey(zm(d))||ey(zm(p))))&&u.push([s(d),s(p)]);return h}case yA:{const u=[],h=r([a,u],o);for(const d of o)(t||!ey(zm(d)))&&u.push(s(d));return h}}const{message:c}=o;return r([a,{name:l,message:c}],o)};return s},HD=(t,{json:e,lossy:n}={})=>{const i=[];return cce(!(e||n),!!e,new Map,i)(t),i},F1=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?$D(HD(t,e)):structuredClone(t):(t,e)=>$D(HD(t,e));function uce(t,e){const n=[{type:"text",value:"↩"}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function hce(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function dce(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||uce,i=t.options.footnoteBackLabel||hce,r=t.options.footnoteLabel||"Footnotes",s=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const c=t.footnoteById.get(t.footnoteOrder[l]);if(!c)continue;const u=t.all(c),h=String(c.identifier).toUpperCase(),d=fp(h.toLowerCase());let p=0;const f=[],v=t.footnoteCounts.get(h);for(;v!==void 0&&++p<=v;){f.length>0&&f.push({type:"text",value:" "});let y=typeof n=="string"?n:n(l,p);typeof y=="string"&&(y={type:"text",value:y}),f.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+d+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(l,p),className:["data-footnote-backref"]},children:Array.isArray(y)?y:[y]})}const g=u[u.length-1];if(g&&g.type==="element"&&g.tagName==="p"){const y=g.children[g.children.length-1];y&&y.type==="text"?y.value+=" ":g.children.push({type:"text",value:" "}),g.children.push(...f)}else u.push(...f);const m={type:"element",tagName:"li",properties:{id:e+"fn-"+d},children:t.wrap(u,!0)};t.patch(c,m),a.push(m)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...F1(o),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const r6=function(t){if(t==null)return gce;if(typeof t=="function")return nC(t);if(typeof t=="object")return Array.isArray(t)?pce(t):fce(t);if(typeof t=="string")return mce(t);throw new Error("Expected function, string, or object as test")};function pce(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=r6(t[n]);return nC(i);function i(...r){let s=-1;for(;++s<e.length;)if(e[s].apply(this,r))return!0;return!1}}function fce(t){const e=t;return nC(n);function n(i){const r=i;let s;for(s in t)if(r[s]!==e[s])return!1;return!0}}function mce(t){return nC(e);function e(n){return n&&n.type===t}}function nC(t){return e;function e(n,i,r){return!!(vce(n)&&t.call(this,n,typeof i=="number"?i:void 0,r||void 0))}}function gce(){return!0}function vce(t){return t!==null&&typeof t=="object"&&"type"in t}const s6=[],yce=!0,VD=!1,Sce="skip";function xce(t,e,n,i){let r;typeof e=="function"&&typeof n!="function"?(i=n,n=e):r=e;const s=r6(r),o=i?-1:1;a(t,void 0,[])();function a(l,c,u){const h=l&&typeof l=="object"?l:{};if(typeof h.type=="string"){const p=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(d,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return d;function d(){let p=s6,f,v,g;if((!e||s(l,c,u[u.length-1]||void 0))&&(p=Cce(n(l,u)),p[0]===VD))return p;if("children"in l&&l.children){const m=l;if(m.children&&p[0]!==Sce)for(v=(i?m.children.length:-1)+o,g=u.concat(m);v>-1&&v<m.children.length;){const y=m.children[v];if(f=a(y,v,g)(),f[0]===VD)return f;v=typeof f[1]=="number"?f[1]:v+o}}return p}}}function Cce(t){return Array.isArray(t)?t:typeof t=="number"?[yce,t]:t==null?s6:[t]}function o6(t,e,n,i){let r,s,o;typeof e=="function"&&typeof n!="function"?(s=void 0,o=e,r=n):(s=e,o=n,r=i),xce(t,s,a,r);function a(l,c){const u=c[c.length-1],h=u?u.children.indexOf(l):void 0;return o(l,h,u)}}const dT={}.hasOwnProperty,_ce={};function wce(t,e){const n=e||_ce,i=new Map,r=new Map,s=new Map,o={...sce,...n.handlers},a={all:c,applyData:Rce,definitionById:i,footnoteById:r,footnoteCounts:s,footnoteOrder:[],handlers:o,one:l,options:n,patch:Ece,wrap:bce};return o6(t,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){const h=u.type==="definition"?i:r,d=String(u.identifier).toUpperCase();h.has(d)||h.set(d,u)}}),a;function l(u,h){const d=u.type,p=a.handlers[d];if(dT.call(a.handlers,d)&&p)return p(a,u,h);if(a.options.passThrough&&a.options.passThrough.includes(d)){if("children"in u){const{children:v,...g}=u,m=F1(g);return m.children=a.all(u),m}return F1(u)}return(a.options.unknownHandler||Tce)(a,u,h)}function c(u){const h=[];if("children"in u){const d=u.children;let p=-1;for(;++p<d.length;){const f=a.one(d[p],u);if(f){if(p&&d[p-1].type==="break"&&(!Array.isArray(f)&&f.type==="text"&&(f.value=jD(f.value)),!Array.isArray(f)&&f.type==="element")){const v=f.children[0];v&&v.type==="text"&&(v.value=jD(v.value))}Array.isArray(f)?h.push(...f):h.push(f)}}}return h}}function Ece(t,e){t.position&&(e.position=soe(t))}function Rce(t,e){let n=e;if(t&&t.data){const i=t.data.hName,r=t.data.hChildren,s=t.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const o="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:o}}n.type==="element"&&s&&Object.assign(n.properties,F1(s)),"children"in n&&n.children&&r!==null&&r!==void 0&&(n.children=r)}return n}function Tce(t,e){const n=e.data||{},i="value"in e&&!(dT.call(n,"hProperties")||dT.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function bce(t,e){const n=[];let i=-1;for(e&&n.push({type:"text",value:`
`});++i<t.length;)i&&n.push({type:"text",value:`
`}),n.push(t[i]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function jD(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function WD(t,e){const n=wce(t,e),i=n.one(t,void 0),r=dce(n),s=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return r&&s.children.push({type:"text",value:`
`},r),s}function Ace(t,e){return t&&"run"in t?async function(n,i){const r=WD(n,{file:i,...e});await t.run(r,i)}:function(n,i){return WD(n,{file:i,...t||e})}}function GD(t){if(t)throw t}var By=Object.prototype.hasOwnProperty,a6=Object.prototype.toString,qD=Object.defineProperty,XD=Object.getOwnPropertyDescriptor,KD=function(e){return typeof Array.isArray=="function"?Array.isArray(e):a6.call(e)==="[object Array]"},YD=function(e){if(!e||a6.call(e)!=="[object Object]")return!1;var n=By.call(e,"constructor"),i=e.constructor&&e.constructor.prototype&&By.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!i)return!1;var r;for(r in e);return typeof r>"u"||By.call(e,r)},JD=function(e,n){qD&&n.name==="__proto__"?qD(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},QD=function(e,n){if(n==="__proto__")if(By.call(e,n)){if(XD)return XD(e,n).value}else return;return e[n]},Pce=function t(){var e,n,i,r,s,o,a=arguments[0],l=1,c=arguments.length,u=!1;for(typeof a=="boolean"&&(u=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<c;++l)if(e=arguments[l],e!=null)for(n in e)i=QD(a,n),r=QD(e,n),a!==r&&(u&&r&&(YD(r)||(s=KD(r)))?(s?(s=!1,o=i&&KD(i)?i:[]):o=i&&YD(i)?i:{},JD(a,{name:n,newValue:t(u,o,r)})):typeof r<"u"&&JD(a,{name:n,newValue:r}));return a};const Dw=fS(Pce);function pT(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function Ice(){const t=[],e={run:n,use:i};return e;function n(...r){let s=-1;const o=r.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...r);function a(l,...c){const u=t[++s];let h=-1;if(l){o(l);return}for(;++h<r.length;)(c[h]===null||c[h]===void 0)&&(c[h]=r[h]);r=c,u?Mce(u,a)(...c):o(null,...c)}}function i(r){if(typeof r!="function")throw new TypeError("Expected `middelware` to be a function, not "+r);return t.push(r),e}}function Mce(t,e){let n;return i;function i(...o){const a=t.length>o.length;let l;a&&o.push(r);try{l=t.apply(this,o)}catch(c){const u=c;if(a&&n)throw u;return r(u)}a||(l&&l.then&&typeof l.then=="function"?l.then(s,r):l instanceof Error?r(l):s(l))}function r(o,...a){n||(n=!0,e(o,...a))}function s(o){r(null,o)}}const Xo={basename:kce,dirname:Lce,extname:Dce,join:Nce,sep:"/"};function kce(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');z0(t);let n=0,i=-1,r=t.length,s;if(e===void 0||e.length===0||e.length>t.length){for(;r--;)if(t.codePointAt(r)===47){if(s){n=r+1;break}}else i<0&&(s=!0,i=r+1);return i<0?"":t.slice(n,i)}if(e===t)return"";let o=-1,a=e.length-1;for(;r--;)if(t.codePointAt(r)===47){if(s){n=r+1;break}}else o<0&&(s=!0,o=r+1),a>-1&&(t.codePointAt(r)===e.codePointAt(a--)?a<0&&(i=r):(a=-1,i=o));return n===i?i=o:i<0&&(i=t.length),t.slice(n,i)}function Lce(t){if(z0(t),t.length===0)return".";let e=-1,n=t.length,i;for(;--n;)if(t.codePointAt(n)===47){if(i){e=n;break}}else i||(i=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function Dce(t){z0(t);let e=t.length,n=-1,i=0,r=-1,s=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){i=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?r<0?r=e:s!==1&&(s=1):r>-1&&(s=-1)}return r<0||n<0||s===0||s===1&&r===n-1&&r===i+1?"":t.slice(r,n)}function Nce(...t){let e=-1,n;for(;++e<t.length;)z0(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":Oce(n)}function Oce(t){z0(t);const e=t.codePointAt(0)===47;let n=Fce(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function Fce(t,e){let n="",i=0,r=-1,s=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||s===1))if(r!==o-1&&s===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",i=0):(n=n.slice(0,l),i=n.length-1-n.lastIndexOf("/")),r=o,s=0;continue}}else if(n.length>0){n="",i=0,r=o,s=0;continue}}e&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+t.slice(r+1,o):n=t.slice(r+1,o),i=o-r-1;r=o,s=0}else a===46&&s>-1?s++:s=-1}return n}function z0(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const zce={cwd:Uce};function Uce(){return"/"}function fT(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function Bce(t){if(typeof t=="string")t=new URL(t);else if(!fT(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return $ce(t)}function $ce(t){if(t.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const i=e.codePointAt(n+2);if(i===70||i===102){const r=new TypeError("File URL path must not include encoded / characters");throw r.code="ERR_INVALID_FILE_URL_PATH",r}}return decodeURIComponent(e)}const Nw=["history","path","basename","stem","extname","dirname"];class l6{constructor(e){let n;e?fT(e)?n={path:e}:typeof e=="string"||Hce(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":zce.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<Nw.length;){const s=Nw[i];s in n&&n[s]!==void 0&&n[s]!==null&&(this[s]=s==="history"?[...n[s]]:n[s])}let r;for(r in n)Nw.includes(r)||(this[r]=n[r])}get basename(){return typeof this.path=="string"?Xo.basename(this.path):void 0}set basename(e){Fw(e,"basename"),Ow(e,"basename"),this.path=Xo.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Xo.dirname(this.path):void 0}set dirname(e){ZD(this.basename,"dirname"),this.path=Xo.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Xo.extname(this.path):void 0}set extname(e){if(Ow(e,"extname"),ZD(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Xo.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){fT(e)&&(e=Bce(e)),Fw(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Xo.basename(this.path,this.extname):void 0}set stem(e){Fw(e,"stem"),Ow(e,"stem"),this.path=Xo.join(this.dirname||"",e+(this.extname||""))}fail(e,n,i){const r=this.message(e,n,i);throw r.fatal=!0,r}info(e,n,i){const r=this.message(e,n,i);return r.fatal=void 0,r}message(e,n,i){const r=new gr(e,n,i);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Ow(t,e){if(t&&t.includes(Xo.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Xo.sep+"`")}function Fw(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function ZD(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Hce(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const Vce=function(t){const i=this.constructor.prototype,r=i[t],s=function(){return r.apply(s,arguments)};return Object.setPrototypeOf(s,i),s},jce={}.hasOwnProperty;class SA extends Vce{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Ice()}copy(){const e=new SA;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];e.use(...i)}return e.data(Dw(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Bw("data",this.frozen),this.namespace[e]=n,this):jce.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Bw("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const r=n.call(e,...i);typeof r=="function"&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=ty(e),i=this.parser||this.Parser;return zw("parse",i),i(String(n),n)}process(e,n){const i=this;return this.freeze(),zw("process",this.parser||this.Parser),Uw("process",this.compiler||this.Compiler),n?r(void 0,n):new Promise(r);function r(s,o){const a=ty(e),l=i.parse(a);i.run(l,a,function(u,h,d){if(u||!h||!d)return c(u);const p=h,f=i.stringify(p,d);qce(f)?d.value=f:d.result=f,c(u,d)});function c(u,h){u||!h?o(u):s?s(h):n(void 0,h)}}}processSync(e){let n=!1,i;return this.freeze(),zw("processSync",this.parser||this.Parser),Uw("processSync",this.compiler||this.Compiler),this.process(e,r),tN("processSync","process",n),i;function r(s,o){n=!0,GD(s),i=o}}run(e,n,i){eN(e),this.freeze();const r=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?s(void 0,i):new Promise(s);function s(o,a){const l=ty(n);r.run(e,l,c);function c(u,h,d){const p=h||e;u?a(u):o?o(p):i(void 0,p,d)}}}runSync(e,n){let i=!1,r;return this.run(e,n,s),tN("runSync","run",i),r;function s(o,a){GD(o),r=a,i=!0}}stringify(e,n){this.freeze();const i=ty(n),r=this.compiler||this.Compiler;return Uw("stringify",r),eN(e),r(e,i)}use(e,...n){const i=this.attachers,r=this.namespace;if(Bw("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(c){if(typeof c=="function")l(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[u,...h]=c;l(u,h)}else o(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function o(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(r.settings=Dw(!0,r.settings,c.settings))}function a(c){let u=-1;if(c!=null)if(Array.isArray(c))for(;++u<c.length;){const h=c[u];s(h)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function l(c,u){let h=-1,d=-1;for(;++h<i.length;)if(i[h][0]===c){d=h;break}if(d===-1)i.push([c,...u]);else if(u.length>0){let[p,...f]=u;const v=i[d][1];pT(v)&&pT(p)&&(p=Dw(!0,v,p)),i[d]=[c,p,...f]}}}}const Wce=new SA().freeze();function zw(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Uw(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Bw(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function eN(t){if(!pT(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function tN(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function ty(t){return Gce(t)?t:new l6(t)}function Gce(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function qce(t){return typeof t=="string"||Xce(t)}function Xce(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const Kce="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",nN=[],iN={allowDangerousHtml:!0},Yce=/^(https?|ircs?|mailto|xmpp)$/i,Jce=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function Qce(t){const e=t.allowedElements,n=t.allowElement,i=t.children||"",r=t.className,s=t.components,o=t.disallowedElements,a=t.rehypePlugins||nN,l=t.remarkPlugins||nN,c=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...iN}:iN,u=t.skipHtml,h=t.unwrapDisallowed,d=t.urlTransform||Zce,p=Wce().use(Lle).use(l).use(Ace,c).use(a),f=new l6;typeof i=="string"&&(f.value=i);for(const y of Jce)Object.hasOwn(t,y.from)&&(""+y.from+(y.to?"use `"+y.to+"` instead":"remove it")+Kce+y.id,void 0);const v=p.parse(f);let g=p.runSync(v,f);return r&&(g={type:"element",tagName:"div",properties:{className:r},children:g.type==="root"?g.children:[g]}),o6(g,m),hoe(g,{Fragment:ze.Fragment,components:s,ignoreInvalidStyle:!0,jsx:ze.jsx,jsxs:ze.jsxs,passKeys:!0,passNode:!0});function m(y,S,x){if(y.type==="raw"&&x&&typeof S=="number")return u?x.children.splice(S,1):x.children[S]={type:"text",value:y.value},S;if(y.type==="element"){let w;for(w in Mw)if(Object.hasOwn(Mw,w)&&Object.hasOwn(y.properties,w)){const C=y.properties[w],E=Mw[w];(E===null||E.includes(y.tagName))&&(y.properties[w]=d(String(C||""),w,y))}}if(y.type==="element"){let w=e?!e.includes(y.tagName):o?o.includes(y.tagName):!1;if(!w&&n&&typeof S=="number"&&(w=!n(y,S,x)),w&&x&&typeof S=="number")return h&&y.children?x.children.splice(S,1,...y.children):x.children.splice(S,1),S}}}function Zce(t){const e=t.indexOf(":"),n=t.indexOf("?"),i=t.indexOf("#"),r=t.indexOf("/");return e<0||r>-1&&e>r||n>-1&&e>n||i>-1&&e>i||Yce.test(t.slice(0,e))?t:""}class eue{constructor({interimResults:e=!1,baseUrl:n,apiKey:i,silenceThreshold:r=15,silenceDetectionTime:s=3e3}={}){this.onstart=null,this.onend=null,this.onresult=null,this.onerror=null,this.interimResults=e,this.mediaRecorder=null,this.recordedChunks=[],this.isRecording=!1,this.audioContext=null,this.silenceTimeout=null,this.silenceDetectionTime=s,this.baseUrl=n,this.apiKey=i,this.silenceThreshold=r}async start(){if(!this.isRecording){this.recordedChunks=[],this.isRecording=!0;try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(e),this.audioContext=new(window.AudioContext||window.webkitAudioContext);const n=this.audioContext.createMediaStreamSource(e),i=this.audioContext.createAnalyser();i.fftSize=512,n.connect(i),this.detectSilence(i),this.mediaRecorder.onstart=()=>{typeof this.onstart=="function"&&this.onstart()},this.mediaRecorder.ondataavailable=r=>{r.data.size>0&&this.recordedChunks.push(r.data)},this.mediaRecorder.onstop=async()=>{this.isRecording=!1;try{const r=new Blob(this.recordedChunks,{type:"audio/webm"}),s=await this.convertToWav(r),o=await this.sendToSpeechAPI(s);typeof this.onresult=="function"&&this.onresult({transcript:o,audioBlob:s})}catch(r){typeof this.onerror=="function"&&this.onerror(r)}typeof this.onend=="function"&&this.onend()},this.mediaRecorder.start()}catch(e){typeof this.onerror=="function"&&this.onerror(e)}}}stop(){this.isRecording&&this.mediaRecorder&&this.mediaRecorder.stop(),clearTimeout(this.silenceTimeout),this.silenceTimeout=null}abort(){this.isRecording&&this.mediaRecorder&&(this.mediaRecorder.stop(),typeof this.onend=="function"&&this.onend(),clearTimeout(this.silenceTimeout))}detectSilence(e){const n=new Uint8Array(e.fftSize),i=()=>{e.getByteFrequencyData(n);const r=n.reduce((s,o)=>s+o,0)/n.length;console.debug(`debug: volume = ${r}`),r<this.silenceThreshold?this.silenceTimeout||(this.silenceTimeout=setTimeout(()=>{this.stop()},this.silenceDetectionTime)):(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.isRecording&&requestAnimationFrame(i)};requestAnimationFrame(i)}async convertToWav(e){return new Promise((n,i)=>{const r=new FileReader;r.onload=s=>{const o=s.target.result;new AudioContext().decodeAudioData(o,l=>{const c=this.audioBufferToWav(l);n(c)},i)},r.onerror=i,r.readAsArrayBuffer(e)})}audioBufferToWav(e){let n=e.numberOfChannels,i=e.length*n*2+44,r=new DataView(new ArrayBuffer(i)),s=[],o=0,a=0;this.writeString(r,a,"RIFF"),a+=4,r.setUint32(a,i-8,!0),a+=4,this.writeString(r,a,"WAVE"),a+=4,this.writeString(r,a,"fmt "),a+=4,r.setUint32(a,16,!0),a+=4,r.setUint16(a,1,!0),a+=2,r.setUint16(a,n,!0),a+=2,r.setUint32(a,e.sampleRate,!0),a+=4,r.setUint32(a,e.sampleRate*2*n,!0),a+=4,r.setUint16(a,n*2,!0),a+=2,r.setUint16(a,16,!0),a+=2,this.writeString(r,a,"data"),a+=4,r.setUint32(a,i-a-4,!0),a+=4;for(let l=0;l<e.numberOfChannels;l++)s.push(e.getChannelData(l));for(;a<i;){for(let l=0;l<n;l++)r.setInt16(a,s[l][o]*32767,!0),a+=2;o++}return new Blob([r],{type:"audio/wav"})}writeString(e,n,i){for(let r=0;r<i.length;r++)e.setUint8(n+r,i.charCodeAt(r))}async sendToSpeechAPI(e){const n=`${this.baseUrl}/stt`,i=await fetch(n,{method:"POST",headers:{"x-api-key":this.apiKey},body:e});if(!i.ok){const s=await i.text();throw new Error(`API request failed with status: ${i.status}, message: ${s}`)}const r=await i.json();return r.NBest&&r.NBest.length>0?r.NBest[0].Display:"No speech recognized."}}const mT=fb.forwardRef(({className:t,variant:e="default",...n},i)=>ze.jsx("button",{className:`px-4 py-2 rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 ${e==="default"?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-destructive text-destructive-foreground hover:bg-destructive/90"} ${t}`,ref:i,...n}));mT.displayName="Button";const c6=fb.forwardRef(({className:t,...e},n)=>ze.jsx("input",{className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${t}`,ref:n,...e}));c6.displayName="Input";function tue(){const[t,e]=he.useState(""),[n,i]=he.useState([]),[r,s]=he.useState(!1),o=he.useRef(null),a=he.useRef(null);he.useEffect(()=>{o.current=new eue({interimResults:!1,baseUrl:"https://api.zzcreation.com/web",apiKey:"0f4404a5f9f56",silenceDetectionTime:1500}),o.current.onresult=d=>{d.transcript.trim()&&(i(p=>[...p,{type:"user",content:d.transcript}]),l(d.transcript))},o.current.onend=()=>{s(!1)}},[]);const l=d=>{const v=btoa("zzc-test:123456");fetch("https://app.zzcreation.com/draw/generate-image/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${v}`},body:JSON.stringify({prompt:d,session_id:"4"})}).then(g=>g.json()).then(g=>{var m;i(y=>[...y,{type:"avatar",content:g.answer}]),(m=a.current)==null||m.speak(g.answer.replace(/https?:\/\/\S+/g,"").trim())}).catch(g=>{console.error("Error:",g),i(m=>[...m,{type:"avatar",content:"Sorry, I couldn't generate an image."}])})},c=()=>{t.trim()&&(i(d=>[...d,{type:"user",content:t}]),l(t),e(""))},u=()=>{var d,p;r?(d=o.current)==null||d.stop():(p=o.current)==null||p.start(),s(!r)},h=he.useMemo(()=>n.map((d,p)=>ze.jsx("div",{className:`flex ${d.type==="user"?"justify-end":"justify-start"}`,children:ze.jsx("div",{className:`rounded-lg p-2 max-w-xs ${d.type==="user"?"bg-blue-500 text-white":"bg-white"}`,children:ze.jsx(Qce,{children:d.content,components:{img:({node:f,...v})=>ze.jsx("img",{className:"max-w-full h-auto rounded-lg",...v})}})})},p)),[n]);return ze.jsxs("div",{className:"flex flex-row h-screen bg-gray-100",children:[ze.jsx("div",{className:"w-3/5 flex justify-center items-center bg-gray-500",children:ze.jsx(Rse,{ref:a})}),ze.jsxs("div",{className:"w-2/5 flex flex-col justify-center",children:[ze.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:h}),ze.jsx("div",{className:"p-4 bg-white border-t",children:ze.jsxs("div",{className:"flex space-x-2",children:[ze.jsx(c6,{value:t,onChange:d=>e(d.target.value),onKeyDown:d=>{d.key==="Enter"&&c()},placeholder:"你好，有什么可以帮您的吗？",className:"flex-1"}),ze.jsxs(mT,{onClick:c,children:[ze.jsx(Kj,{className:"w-4 h-4"}),ze.jsx("span",{className:"sr-only",children:"Send"})]}),ze.jsxs(mT,{onClick:u,variant:r?"destructive":"default",children:[ze.jsx(Xj,{className:"w-4 h-4"}),ze.jsx("span",{className:"sr-only",children:"Toggle speech recognition"})]})]})})]})]})}/**
 * @remix-run/router v1.21.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dn(){return Dn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Dn.apply(this,arguments)}var li;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(li||(li={}));const rN="popstate";function nue(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return s0("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:U0(r)}return rue(e,n,null,t)}function Kt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ud(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function iue(){return Math.random().toString(36).substr(2,8)}function sN(t,e){return{usr:t.state,key:t.key,idx:e}}function s0(t,e,n,i){return n===void 0&&(n=null),Dn({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Cc(e):e,{state:n,key:e&&e.key||i||iue()})}function U0(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Cc(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function rue(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=li.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(Dn({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function h(){a=li.Pop;let g=u(),m=g==null?null:g-c;c=g,l&&l({action:a,location:v.location,delta:m})}function d(g,m){a=li.Push;let y=s0(v.location,g,m);c=u()+1;let S=sN(y,c),x=v.createHref(y);try{o.pushState(S,"",x)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;r.location.assign(x)}s&&l&&l({action:a,location:v.location,delta:1})}function p(g,m){a=li.Replace;let y=s0(v.location,g,m);c=u();let S=sN(y,c),x=v.createHref(y);o.replaceState(S,"",x),s&&l&&l({action:a,location:v.location,delta:0})}function f(g){let m=r.location.origin!=="null"?r.location.origin:r.location.href,y=typeof g=="string"?g:U0(g);return y=y.replace(/ $/,"%20"),Kt(m,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,m)}let v={get action(){return a},get location(){return t(r,o)},listen(g){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(rN,h),l=g,()=>{r.removeEventListener(rN,h),l=null}},createHref(g){return e(r,g)},createURL:f,encodeLocation(g){let m=f(g);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:d,replace:p,go(g){return o.go(g)}};return v}var pn;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(pn||(pn={}));const sue=new Set(["lazy","caseSensitive","path","id","index","children"]);function oue(t){return t.index===!0}function z1(t,e,n,i){return n===void 0&&(n=[]),i===void 0&&(i={}),t.map((r,s)=>{let o=[...n,String(s)],a=typeof r.id=="string"?r.id:o.join("-");if(Kt(r.index!==!0||!r.children,"Cannot specify children on an index route"),Kt(!i[a],'Found a route id collision on id "'+a+`".  Route id's must be globally unique within Data Router usages`),oue(r)){let l=Dn({},r,e(r),{id:a});return i[a]=l,l}else{let l=Dn({},r,e(r),{id:a,children:void 0});return i[a]=l,r.children&&(l.children=z1(r.children,e,o,i)),l}})}function iu(t,e,n){return n===void 0&&(n="/"),$y(t,e,n,!1)}function $y(t,e,n,i){let r=typeof e=="string"?Cc(e):e,s=B0(r.pathname||"/",n);if(s==null)return null;let o=u6(t);lue(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=Sue(s);a=vue(o[l],c,i)}return a}function aue(t,e){let{route:n,pathname:i,params:r}=t;return{id:n.id,pathname:i,params:r,data:e[n.id],handle:n.handle}}function u6(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(Kt(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let c=yu([i,l.relativePath]),u=n.concat(l);s.children&&s.children.length>0&&(Kt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),u6(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:mue(c,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let l of h6(s.path))r(s,o,l)}),e}function h6(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=h6(i.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function lue(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:gue(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const cue=/^:[\w-]+$/,uue=3,hue=2,due=1,pue=10,fue=-2,oN=t=>t==="*";function mue(t,e){let n=t.split("/"),i=n.length;return n.some(oN)&&(i+=fue),e&&(i+=hue),n.filter(r=>!oN(r)).reduce((r,s)=>r+(cue.test(s)?uue:s===""?due:pue),i)}function gue(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function vue(t,e,n){n===void 0&&(n=!1);let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let l=i[a],c=a===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",h=aN({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h&&c&&n&&!i[i.length-1].route.index&&(h=aN({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(r,h.params),o.push({params:r,pathname:yu([s,h.pathname]),pathnameBase:Eue(yu([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=yu([s,h.pathnameBase]))}return o}function aN(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=yue(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((c,u,h)=>{let{paramName:d,isOptional:p}=u;if(d==="*"){let v=a[h]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const f=a[h];return p&&!f?c[d]=void 0:c[d]=(f||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:o,pattern:t}}function yue(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Ud(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(i.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function Sue(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ud(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function B0(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function xue(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?Cc(t):t;return{pathname:n?n.startsWith("/")?n:Cue(n,e):e,search:Rue(i),hash:Tue(r)}}function Cue(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function $w(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function d6(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function _ue(t,e){let n=d6(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function wue(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=Cc(t):(r=Dn({},t),Kt(!r.pathname||!r.pathname.includes("?"),$w("?","pathname","search",r)),Kt(!r.pathname||!r.pathname.includes("#"),$w("#","pathname","hash",r)),Kt(!r.search||!r.search.includes("#"),$w("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!i&&o.startsWith("..")){let d=o.split("/");for(;d[0]==="..";)d.shift(),h-=1;r.pathname=d.join("/")}a=h>=0?e[h]:"/"}let l=xue(r,a),c=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const yu=t=>t.join("/").replace(/\/\/+/g,"/"),Eue=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Rue=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Tue=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;class U1{constructor(e,n,i,r){r===void 0&&(r=!1),this.status=e,this.statusText=n||"",this.internal=r,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}}function iC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const p6=["post","put","patch","delete"],bue=new Set(p6),Aue=["get",...p6],Pue=new Set(Aue),Iue=new Set([301,302,303,307,308]),Mue=new Set([307,308]),Hw={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},kue={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Um={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},xA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Lue=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),f6="remix-router-transitions";function Due(t){const e=t.window?t.window:typeof window<"u"?window:void 0,n=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",i=!n;Kt(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let r;if(t.mapRouteProperties)r=t.mapRouteProperties;else if(t.detectErrorBoundary){let O=t.detectErrorBoundary;r=W=>({hasErrorBoundary:O(W)})}else r=Lue;let s={},o=z1(t.routes,r,void 0,s),a,l=t.basename||"/",c=t.dataStrategy||zue,u=t.patchRoutesOnNavigation,h=Dn({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},t.future),d=null,p=new Set,f=null,v=null,g=null,m=t.hydrationData!=null,y=iu(o,t.history.location,l),S=null;if(y==null&&!u){let O=zr(404,{pathname:t.history.location.pathname}),{matches:W,route:te}=yN(o);y=W,S={[te.id]:O}}y&&!t.hydrationData&&Qn(y,o,t.history.location.pathname).active&&(y=null);let x;if(y)if(y.some(O=>O.route.lazy))x=!1;else if(!y.some(O=>O.route.loader))x=!0;else if(h.v7_partialHydration){let O=t.hydrationData?t.hydrationData.loaderData:null,W=t.hydrationData?t.hydrationData.errors:null;if(W){let te=y.findIndex(ue=>W[ue.route.id]!==void 0);x=y.slice(0,te+1).every(ue=>!vT(ue.route,O,W))}else x=y.every(te=>!vT(te.route,O,W))}else x=t.hydrationData!=null;else if(x=!1,y=[],h.v7_partialHydration){let O=Qn(null,o,t.history.location.pathname);O.active&&O.matches&&(y=O.matches)}let w,C={historyAction:t.history.action,location:t.history.location,matches:y,initialized:x,navigation:Hw,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||S,fetchers:new Map,blockers:new Map},E=li.Pop,T=!1,M,_=!1,R=new Map,L=null,z=!1,G=!1,$=[],H=new Set,q=new Map,D=0,Z=-1,P=new Map,le=new Set,Se=new Map,k=new Map,J=new Set,oe=new Map,pe=new Map,ye;function nt(){if(d=t.history.listen(O=>{let{action:W,location:te,delta:ue}=O;if(ye){ye(),ye=void 0;return}Ud(pe.size===0||ue!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let De=ke({currentLocation:C.location,nextLocation:te,historyAction:W});if(De&&ue!=null){let et=new Promise(ut=>{ye=ut});t.history.go(ue*-1),B(De,{state:"blocked",location:te,proceed(){B(De,{state:"proceeding",proceed:void 0,reset:void 0,location:te}),et.then(()=>t.history.go(ue))},reset(){let ut=new Map(C.blockers);ut.set(De,Um),at({blockers:ut})}});return}return St(W,te)}),n){Que(e,R);let O=()=>Zue(e,R);e.addEventListener("pagehide",O),L=()=>e.removeEventListener("pagehide",O)}return C.initialized||St(li.Pop,C.location,{initialHydration:!0}),w}function Je(){d&&d(),L&&L(),p.clear(),M&&M.abort(),C.fetchers.forEach((O,W)=>se(W)),C.blockers.forEach((O,W)=>Dt(W))}function _t(O){return p.add(O),()=>p.delete(O)}function at(O,W){W===void 0&&(W={}),C=Dn({},C,O);let te=[],ue=[];h.v7_fetcherPersist&&C.fetchers.forEach((De,et)=>{De.state==="idle"&&(J.has(et)?ue.push(et):te.push(et))}),[...p].forEach(De=>De(C,{deletedFetchers:ue,viewTransitionOpts:W.viewTransitionOpts,flushSync:W.flushSync===!0})),h.v7_fetcherPersist&&(te.forEach(De=>C.fetchers.delete(De)),ue.forEach(De=>se(De)))}function yt(O,W,te){var ue,De;let{flushSync:et}=te===void 0?{}:te,ut=C.actionData!=null&&C.navigation.formMethod!=null&&go(C.navigation.formMethod)&&C.navigation.state==="loading"&&((ue=O.state)==null?void 0:ue._isRedirect)!==!0,Fe;W.actionData?Object.keys(W.actionData).length>0?Fe=W.actionData:Fe=null:ut?Fe=C.actionData:Fe=null;let Oe=W.loaderData?gN(C.loaderData,W.loaderData,W.matches||[],W.errors):C.loaderData,Ne=C.blockers;Ne.size>0&&(Ne=new Map(Ne),Ne.forEach((Vt,pi)=>Ne.set(pi,Um)));let it=T===!0||C.navigation.formMethod!=null&&go(C.navigation.formMethod)&&((De=O.state)==null?void 0:De._isRedirect)!==!0;a&&(o=a,a=void 0),z||E===li.Pop||(E===li.Push?t.history.push(O,O.state):E===li.Replace&&t.history.replace(O,O.state));let Ot;if(E===li.Pop){let Vt=R.get(C.location.pathname);Vt&&Vt.has(O.pathname)?Ot={currentLocation:C.location,nextLocation:O}:R.has(O.pathname)&&(Ot={currentLocation:O,nextLocation:C.location})}else if(_){let Vt=R.get(C.location.pathname);Vt?Vt.add(O.pathname):(Vt=new Set([O.pathname]),R.set(C.location.pathname,Vt)),Ot={currentLocation:C.location,nextLocation:O}}at(Dn({},W,{actionData:Fe,loaderData:Oe,historyAction:E,location:O,initialized:!0,navigation:Hw,revalidation:"idle",restoreScrollPosition:bn(O,W.matches||C.matches),preventScrollReset:it,blockers:Ne}),{viewTransitionOpts:Ot,flushSync:et===!0}),E=li.Pop,T=!1,_=!1,z=!1,G=!1,$=[]}async function U(O,W){if(typeof O=="number"){t.history.go(O);return}let te=gT(C.location,C.matches,l,h.v7_prependBasename,O,h.v7_relativeSplatPath,W==null?void 0:W.fromRouteId,W==null?void 0:W.relative),{path:ue,submission:De,error:et}=lN(h.v7_normalizeFormMethod,!1,te,W),ut=C.location,Fe=s0(C.location,ue,W&&W.state);Fe=Dn({},Fe,t.history.encodeLocation(Fe));let Oe=W&&W.replace!=null?W.replace:void 0,Ne=li.Push;Oe===!0?Ne=li.Replace:Oe===!1||De!=null&&go(De.formMethod)&&De.formAction===C.location.pathname+C.location.search&&(Ne=li.Replace);let it=W&&"preventScrollReset"in W?W.preventScrollReset===!0:void 0,Ot=(W&&W.flushSync)===!0,Vt=ke({currentLocation:ut,nextLocation:Fe,historyAction:Ne});if(Vt){B(Vt,{state:"blocked",location:Fe,proceed(){B(Vt,{state:"proceeding",proceed:void 0,reset:void 0,location:Fe}),U(O,W)},reset(){let pi=new Map(C.blockers);pi.set(Vt,Um),at({blockers:pi})}});return}return await St(Ne,Fe,{submission:De,pendingError:et,preventScrollReset:it,replace:W&&W.replace,enableViewTransition:W&&W.viewTransition,flushSync:Ot})}function di(){if(V(),at({revalidation:"loading"}),C.navigation.state!=="submitting"){if(C.navigation.state==="idle"){St(C.historyAction,C.location,{startUninterruptedRevalidation:!0});return}St(E||C.historyAction,C.navigation.location,{overrideNavigation:C.navigation,enableViewTransition:_===!0})}}async function St(O,W,te){M&&M.abort(),M=null,E=O,z=(te&&te.startUninterruptedRevalidation)===!0,Ft(C.location,C.matches),T=(te&&te.preventScrollReset)===!0,_=(te&&te.enableViewTransition)===!0;let ue=a||o,De=te&&te.overrideNavigation,et=iu(ue,W,l),ut=(te&&te.flushSync)===!0,Fe=Qn(et,ue,W.pathname);if(Fe.active&&Fe.matches&&(et=Fe.matches),!et){let{error:A,notFoundMatches:F,route:X}=ne(W.pathname);yt(W,{matches:F,loaderData:{},errors:{[X.id]:A}},{flushSync:ut});return}if(C.initialized&&!G&&jue(C.location,W)&&!(te&&te.submission&&go(te.submission.formMethod))){yt(W,{matches:et},{flushSync:ut});return}M=new AbortController;let Oe=Ph(t.history,W,M.signal,te&&te.submission),Ne;if(te&&te.pendingError)Ne=[ru(et).route.id,{type:pn.error,error:te.pendingError}];else if(te&&te.submission&&go(te.submission.formMethod)){let A=await Mt(Oe,W,te.submission,et,Fe.active,{replace:te.replace,flushSync:ut});if(A.shortCircuited)return;if(A.pendingActionResult){let[F,X]=A.pendingActionResult;if(hs(X)&&iC(X.error)&&X.error.status===404){M=null,yt(W,{matches:A.matches,loaderData:{},errors:{[F]:X.error}});return}}et=A.matches||et,Ne=A.pendingActionResult,De=Vw(W,te.submission),ut=!1,Fe.active=!1,Oe=Ph(t.history,Oe.url,Oe.signal)}let{shortCircuited:it,matches:Ot,loaderData:Vt,errors:pi}=await ct(Oe,W,et,Fe.active,De,te&&te.submission,te&&te.fetcherSubmission,te&&te.replace,te&&te.initialHydration===!0,ut,Ne);it||(M=null,yt(W,Dn({matches:Ot||et},vN(Ne),{loaderData:Vt,errors:pi})))}async function Mt(O,W,te,ue,De,et){et===void 0&&(et={}),V();let ut=Yue(W,te);if(at({navigation:ut},{flushSync:et.flushSync===!0}),De){let Ne=await Nt(ue,W.pathname,O.signal);if(Ne.type==="aborted")return{shortCircuited:!0};if(Ne.type==="error"){let it=ru(Ne.partialMatches).route.id;return{matches:Ne.partialMatches,pendingActionResult:[it,{type:pn.error,error:Ne.error}]}}else if(Ne.matches)ue=Ne.matches;else{let{notFoundMatches:it,error:Ot,route:Vt}=ne(W.pathname);return{matches:it,pendingActionResult:[Vt.id,{type:pn.error,error:Ot}]}}}let Fe,Oe=tg(ue,W);if(!Oe.route.action&&!Oe.route.lazy)Fe={type:pn.error,error:zr(405,{method:O.method,pathname:W.pathname,routeId:Oe.route.id})};else if(Fe=(await de("action",C,O,[Oe],ue,null))[Oe.route.id],O.signal.aborted)return{shortCircuited:!0};if(hu(Fe)){let Ne;return et&&et.replace!=null?Ne=et.replace:Ne=pN(Fe.response.headers.get("Location"),new URL(O.url),l)===C.location.pathname+C.location.search,await ie(O,Fe,!0,{submission:te,replace:Ne}),{shortCircuited:!0}}if(Ol(Fe))throw zr(400,{type:"defer-action"});if(hs(Fe)){let Ne=ru(ue,Oe.route.id);return(et&&et.replace)!==!0&&(E=li.Push),{matches:ue,pendingActionResult:[Ne.route.id,Fe]}}return{matches:ue,pendingActionResult:[Oe.route.id,Fe]}}async function ct(O,W,te,ue,De,et,ut,Fe,Oe,Ne,it){let Ot=De||Vw(W,et),Vt=et||ut||xN(Ot),pi=!z&&(!h.v7_partialHydration||!Oe);if(ue){if(pi){let gt=Zt(it);at(Dn({navigation:Ot},gt!==void 0?{actionData:gt}:{}),{flushSync:Ne})}let qe=await Nt(te,W.pathname,O.signal);if(qe.type==="aborted")return{shortCircuited:!0};if(qe.type==="error"){let gt=ru(qe.partialMatches).route.id;return{matches:qe.partialMatches,loaderData:{},errors:{[gt]:qe.error}}}else if(qe.matches)te=qe.matches;else{let{error:gt,notFoundMatches:rn,route:fi}=ne(W.pathname);return{matches:rn,loaderData:{},errors:{[fi.id]:gt}}}}let A=a||o,[F,X]=uN(t.history,C,te,Vt,W,h.v7_partialHydration&&Oe===!0,h.v7_skipActionErrorRevalidation,G,$,H,J,Se,le,A,l,it);if(ce(qe=>!(te&&te.some(gt=>gt.route.id===qe))||F&&F.some(gt=>gt.route.id===qe)),Z=++D,F.length===0&&X.length===0){let qe=Ae();return yt(W,Dn({matches:te,loaderData:{},errors:it&&hs(it[1])?{[it[0]]:it[1].error}:null},vN(it),qe?{fetchers:new Map(C.fetchers)}:{}),{flushSync:Ne}),{shortCircuited:!0}}if(pi){let qe={};if(!ue){qe.navigation=Ot;let gt=Zt(it);gt!==void 0&&(qe.actionData=gt)}X.length>0&&(qe.fetchers=dt(X)),at(qe,{flushSync:Ne})}X.forEach(qe=>{Te(qe.key),qe.controller&&q.set(qe.key,qe.controller)});let ee=()=>X.forEach(qe=>Te(qe.key));M&&M.signal.addEventListener("abort",ee);let{loaderResults:j,fetcherResults:fe}=await ae(C,te,F,X,O);if(O.signal.aborted)return{shortCircuited:!0};M&&M.signal.removeEventListener("abort",ee),X.forEach(qe=>q.delete(qe.key));let _e=ny(j);if(_e)return await ie(O,_e.result,!0,{replace:Fe}),{shortCircuited:!0};if(_e=ny(fe),_e)return le.add(_e.key),await ie(O,_e.result,!0,{replace:Fe}),{shortCircuited:!0};let{loaderData:$e,errors:He}=mN(C,te,j,it,X,fe,oe);oe.forEach((qe,gt)=>{qe.subscribe(rn=>{(rn||qe.done)&&oe.delete(gt)})}),h.v7_partialHydration&&Oe&&C.errors&&(He=Dn({},C.errors,He));let ot=Ae(),pt=wt(Z),Ke=ot||pt||X.length>0;return Dn({matches:te,loaderData:$e,errors:He},Ke?{fetchers:new Map(C.fetchers)}:{})}function Zt(O){if(O&&!hs(O[1]))return{[O[0]]:O[1].data};if(C.actionData)return Object.keys(C.actionData).length===0?null:C.actionData}function dt(O){return O.forEach(W=>{let te=C.fetchers.get(W.key),ue=Bm(void 0,te?te.data:void 0);C.fetchers.set(W.key,ue)}),new Map(C.fetchers)}function I(O,W,te,ue){if(i)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Te(O);let De=(ue&&ue.flushSync)===!0,et=a||o,ut=gT(C.location,C.matches,l,h.v7_prependBasename,te,h.v7_relativeSplatPath,W,ue==null?void 0:ue.relative),Fe=iu(et,ut,l),Oe=Qn(Fe,et,ut);if(Oe.active&&Oe.matches&&(Fe=Oe.matches),!Fe){re(O,W,zr(404,{pathname:ut}),{flushSync:De});return}let{path:Ne,submission:it,error:Ot}=lN(h.v7_normalizeFormMethod,!0,ut,ue);if(Ot){re(O,W,Ot,{flushSync:De});return}let Vt=tg(Fe,Ne),pi=(ue&&ue.preventScrollReset)===!0;if(it&&go(it.formMethod)){b(O,W,Ne,Vt,Fe,Oe.active,De,pi,it);return}Se.set(O,{routeId:W,path:Ne}),Y(O,W,Ne,Vt,Fe,Oe.active,De,pi,it)}async function b(O,W,te,ue,De,et,ut,Fe,Oe){V(),Se.delete(O);function Ne(ft){if(!ft.route.action&&!ft.route.lazy){let Xe=zr(405,{method:Oe.formMethod,pathname:te,routeId:W});return re(O,W,Xe,{flushSync:ut}),!0}return!1}if(!et&&Ne(ue))return;let it=C.fetchers.get(O);K(O,Jue(Oe,it),{flushSync:ut});let Ot=new AbortController,Vt=Ph(t.history,te,Ot.signal,Oe);if(et){let ft=await Nt(De,te,Vt.signal);if(ft.type==="aborted")return;if(ft.type==="error"){re(O,W,ft.error,{flushSync:ut});return}else if(ft.matches){if(De=ft.matches,ue=tg(De,te),Ne(ue))return}else{re(O,W,zr(404,{pathname:te}),{flushSync:ut});return}}q.set(O,Ot);let pi=D,F=(await de("action",C,Vt,[ue],De,O))[ue.route.id];if(Vt.signal.aborted){q.get(O)===Ot&&q.delete(O);return}if(h.v7_fetcherPersist&&J.has(O)){if(hu(F)||hs(F)){K(O,Sl(void 0));return}}else{if(hu(F))if(q.delete(O),Z>pi){K(O,Sl(void 0));return}else return le.add(O),K(O,Bm(Oe)),ie(Vt,F,!1,{fetcherSubmission:Oe,preventScrollReset:Fe});if(hs(F)){re(O,W,F.error);return}}if(Ol(F))throw zr(400,{type:"defer-action"});let X=C.navigation.location||C.location,ee=Ph(t.history,X,Ot.signal),j=a||o,fe=C.navigation.state!=="idle"?iu(j,C.navigation.location,l):C.matches;Kt(fe,"Didn't find any matches after fetcher action");let _e=++D;P.set(O,_e);let $e=Bm(Oe,F.data);C.fetchers.set(O,$e);let[He,ot]=uN(t.history,C,fe,Oe,X,!1,h.v7_skipActionErrorRevalidation,G,$,H,J,Se,le,j,l,[ue.route.id,F]);ot.filter(ft=>ft.key!==O).forEach(ft=>{let Xe=ft.key,si=C.fetchers.get(Xe),en=Bm(void 0,si?si.data:void 0);C.fetchers.set(Xe,en),Te(Xe),ft.controller&&q.set(Xe,ft.controller)}),at({fetchers:new Map(C.fetchers)});let pt=()=>ot.forEach(ft=>Te(ft.key));Ot.signal.addEventListener("abort",pt);let{loaderResults:Ke,fetcherResults:qe}=await ae(C,fe,He,ot,ee);if(Ot.signal.aborted)return;Ot.signal.removeEventListener("abort",pt),P.delete(O),q.delete(O),ot.forEach(ft=>q.delete(ft.key));let gt=ny(Ke);if(gt)return ie(ee,gt.result,!1,{preventScrollReset:Fe});if(gt=ny(qe),gt)return le.add(gt.key),ie(ee,gt.result,!1,{preventScrollReset:Fe});let{loaderData:rn,errors:fi}=mN(C,fe,Ke,void 0,ot,qe,oe);if(C.fetchers.has(O)){let ft=Sl(F.data);C.fetchers.set(O,ft)}wt(_e),C.navigation.state==="loading"&&_e>Z?(Kt(E,"Expected pending action"),M&&M.abort(),yt(C.navigation.location,{matches:fe,loaderData:rn,errors:fi,fetchers:new Map(C.fetchers)})):(at({errors:fi,loaderData:gN(C.loaderData,rn,fe,fi),fetchers:new Map(C.fetchers)}),G=!1)}async function Y(O,W,te,ue,De,et,ut,Fe,Oe){let Ne=C.fetchers.get(O);K(O,Bm(Oe,Ne?Ne.data:void 0),{flushSync:ut});let it=new AbortController,Ot=Ph(t.history,te,it.signal);if(et){let F=await Nt(De,te,Ot.signal);if(F.type==="aborted")return;if(F.type==="error"){re(O,W,F.error,{flushSync:ut});return}else if(F.matches)De=F.matches,ue=tg(De,te);else{re(O,W,zr(404,{pathname:te}),{flushSync:ut});return}}q.set(O,it);let Vt=D,A=(await de("loader",C,Ot,[ue],De,O))[ue.route.id];if(Ol(A)&&(A=await CA(A,Ot.signal,!0)||A),q.get(O)===it&&q.delete(O),!Ot.signal.aborted){if(J.has(O)){K(O,Sl(void 0));return}if(hu(A))if(Z>Vt){K(O,Sl(void 0));return}else{le.add(O),await ie(Ot,A,!1,{preventScrollReset:Fe});return}if(hs(A)){re(O,W,A.error);return}Kt(!Ol(A),"Unhandled fetcher deferred data"),K(O,Sl(A.data))}}async function ie(O,W,te,ue){let{submission:De,fetcherSubmission:et,preventScrollReset:ut,replace:Fe}=ue===void 0?{}:ue;W.response.headers.has("X-Remix-Revalidate")&&(G=!0);let Oe=W.response.headers.get("Location");Kt(Oe,"Expected a Location header on the redirect Response"),Oe=pN(Oe,new URL(O.url),l);let Ne=s0(C.location,Oe,{_isRedirect:!0});if(n){let F=!1;if(W.response.headers.has("X-Remix-Reload-Document"))F=!0;else if(xA.test(Oe)){const X=t.history.createURL(Oe);F=X.origin!==e.location.origin||B0(X.pathname,l)==null}if(F){Fe?e.location.replace(Oe):e.location.assign(Oe);return}}M=null;let it=Fe===!0||W.response.headers.has("X-Remix-Replace")?li.Replace:li.Push,{formMethod:Ot,formAction:Vt,formEncType:pi}=C.navigation;!De&&!et&&Ot&&Vt&&pi&&(De=xN(C.navigation));let A=De||et;if(Mue.has(W.response.status)&&A&&go(A.formMethod))await St(it,Ne,{submission:Dn({},A,{formAction:Oe}),preventScrollReset:ut||T,enableViewTransition:te?_:void 0});else{let F=Vw(Ne,De);await St(it,Ne,{overrideNavigation:F,fetcherSubmission:et,preventScrollReset:ut||T,enableViewTransition:te?_:void 0})}}async function de(O,W,te,ue,De,et){let ut,Fe={};try{ut=await Uue(c,O,W,te,ue,De,et,s,r)}catch(Oe){return ue.forEach(Ne=>{Fe[Ne.route.id]={type:pn.error,error:Oe}}),Fe}for(let[Oe,Ne]of Object.entries(ut))if(Wue(Ne)){let it=Ne.result;Fe[Oe]={type:pn.redirect,response:Hue(it,te,Oe,De,l,h.v7_relativeSplatPath)}}else Fe[Oe]=await $ue(Ne);return Fe}async function ae(O,W,te,ue,De){let et=O.matches,ut=de("loader",O,De,te,W,null),Fe=Promise.all(ue.map(async it=>{if(it.matches&&it.match&&it.controller){let Vt=(await de("loader",O,Ph(t.history,it.path,it.controller.signal),[it.match],it.matches,it.key))[it.match.route.id];return{[it.key]:Vt}}else return Promise.resolve({[it.key]:{type:pn.error,error:zr(404,{pathname:it.path})}})})),Oe=await ut,Ne=(await Fe).reduce((it,Ot)=>Object.assign(it,Ot),{});return await Promise.all([Xue(W,Oe,De.signal,et,O.loaderData),Kue(W,Ne,ue)]),{loaderResults:Oe,fetcherResults:Ne}}function V(){G=!0,$.push(...ce()),Se.forEach((O,W)=>{q.has(W)&&H.add(W),Te(W)})}function K(O,W,te){te===void 0&&(te={}),C.fetchers.set(O,W),at({fetchers:new Map(C.fetchers)},{flushSync:(te&&te.flushSync)===!0})}function re(O,W,te,ue){ue===void 0&&(ue={});let De=ru(C.matches,W);se(O),at({errors:{[De.route.id]:te},fetchers:new Map(C.fetchers)},{flushSync:(ue&&ue.flushSync)===!0})}function Ie(O){return h.v7_fetcherPersist&&(k.set(O,(k.get(O)||0)+1),J.has(O)&&J.delete(O)),C.fetchers.get(O)||kue}function se(O){let W=C.fetchers.get(O);q.has(O)&&!(W&&W.state==="loading"&&P.has(O))&&Te(O),Se.delete(O),P.delete(O),le.delete(O),J.delete(O),H.delete(O),C.fetchers.delete(O)}function xe(O){if(h.v7_fetcherPersist){let W=(k.get(O)||0)-1;W<=0?(k.delete(O),J.add(O)):k.set(O,W)}else se(O);at({fetchers:new Map(C.fetchers)})}function Te(O){let W=q.get(O);W&&(W.abort(),q.delete(O))}function Qe(O){for(let W of O){let te=Ie(W),ue=Sl(te.data);C.fetchers.set(W,ue)}}function Ae(){let O=[],W=!1;for(let te of le){let ue=C.fetchers.get(te);Kt(ue,"Expected fetcher: "+te),ue.state==="loading"&&(le.delete(te),O.push(te),W=!0)}return Qe(O),W}function wt(O){let W=[];for(let[te,ue]of P)if(ue<O){let De=C.fetchers.get(te);Kt(De,"Expected fetcher: "+te),De.state==="loading"&&(Te(te),P.delete(te),W.push(te))}return Qe(W),W.length>0}function Ze(O,W){let te=C.blockers.get(O)||Um;return pe.get(O)!==W&&pe.set(O,W),te}function Dt(O){C.blockers.delete(O),pe.delete(O)}function B(O,W){let te=C.blockers.get(O)||Um;Kt(te.state==="unblocked"&&W.state==="blocked"||te.state==="blocked"&&W.state==="blocked"||te.state==="blocked"&&W.state==="proceeding"||te.state==="blocked"&&W.state==="unblocked"||te.state==="proceeding"&&W.state==="unblocked","Invalid blocker state transition: "+te.state+" -> "+W.state);let ue=new Map(C.blockers);ue.set(O,W),at({blockers:ue})}function ke(O){let{currentLocation:W,nextLocation:te,historyAction:ue}=O;if(pe.size===0)return;pe.size>1&&Ud(!1,"A router only supports one blocker at a time");let De=Array.from(pe.entries()),[et,ut]=De[De.length-1],Fe=C.blockers.get(et);if(!(Fe&&Fe.state==="proceeding")&&ut({currentLocation:W,nextLocation:te,historyAction:ue}))return et}function ne(O){let W=zr(404,{pathname:O}),te=a||o,{matches:ue,route:De}=yN(te);return ce(),{notFoundMatches:ue,route:De,error:W}}function ce(O){let W=[];return oe.forEach((te,ue)=>{(!O||O(ue))&&(te.cancel(),W.push(ue),oe.delete(ue))}),W}function Me(O,W,te){if(f=O,g=W,v=te||null,!m&&C.navigation===Hw){m=!0;let ue=bn(C.location,C.matches);ue!=null&&at({restoreScrollPosition:ue})}return()=>{f=null,g=null,v=null}}function Le(O,W){return v&&v(O,W.map(ue=>aue(ue,C.loaderData)))||O.key}function Ft(O,W){if(f&&g){let te=Le(O,W);f[te]=g()}}function bn(O,W){if(f){let te=Le(O,W),ue=f[te];if(typeof ue=="number")return ue}return null}function Qn(O,W,te){if(u)if(O){if(Object.keys(O[0].params).length>0)return{active:!0,matches:$y(W,te,l,!0)}}else return{active:!0,matches:$y(W,te,l,!0)||[]};return{active:!1,matches:null}}async function Nt(O,W,te){if(!u)return{type:"success",matches:O};let ue=O;for(;;){let De=a==null,et=a||o,ut=s;try{await u({path:W,matches:ue,patch:(Ne,it)=>{te.aborted||dN(Ne,it,et,ut,r)}})}catch(Ne){return{type:"error",error:Ne,partialMatches:ue}}finally{De&&!te.aborted&&(o=[...o])}if(te.aborted)return{type:"aborted"};let Fe=iu(et,W,l);if(Fe)return{type:"success",matches:Fe};let Oe=$y(et,W,l,!0);if(!Oe||ue.length===Oe.length&&ue.every((Ne,it)=>Ne.route.id===Oe[it].route.id))return{type:"success",matches:null};ue=Oe}}function Ti(O){s={},a=z1(O,r,void 0,s)}function Zr(O,W){let te=a==null;dN(O,W,a||o,s,r),te&&(o=[...o],at({}))}return w={get basename(){return l},get future(){return h},get state(){return C},get routes(){return o},get window(){return e},initialize:nt,subscribe:_t,enableScrollRestoration:Me,navigate:U,fetch:I,revalidate:di,createHref:O=>t.history.createHref(O),encodeLocation:O=>t.history.encodeLocation(O),getFetcher:Ie,deleteFetcher:xe,dispose:Je,getBlocker:Ze,deleteBlocker:Dt,patchRoutes:Zr,_internalFetchControllers:q,_internalActiveDeferreds:oe,_internalSetRoutes:Ti},w}function Nue(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function gT(t,e,n,i,r,s,o,a){let l,c;if(o){l=[];for(let h of e)if(l.push(h),h.route.id===o){c=h;break}}else l=e,c=e[e.length-1];let u=wue(r||".",_ue(l,s),B0(t.pathname,n)||t.pathname,a==="path");if(r==null&&(u.search=t.search,u.hash=t.hash),(r==null||r===""||r===".")&&c){let h=_A(u.search);if(c.route.index&&!h)u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index";else if(!c.route.index&&h){let d=new URLSearchParams(u.search),p=d.getAll("index");d.delete("index"),p.filter(v=>v).forEach(v=>d.append("index",v));let f=d.toString();u.search=f?"?"+f:""}}return i&&n!=="/"&&(u.pathname=u.pathname==="/"?n:yu([n,u.pathname])),U0(u)}function lN(t,e,n,i){if(!i||!Nue(i))return{path:n};if(i.formMethod&&!que(i.formMethod))return{path:n,error:zr(405,{method:i.formMethod})};let r=()=>({path:n,error:zr(400,{type:"invalid-body"})}),s=i.formMethod||"get",o=t?s.toUpperCase():s.toLowerCase(),a=v6(n);if(i.body!==void 0){if(i.formEncType==="text/plain"){if(!go(o))return r();let d=typeof i.body=="string"?i.body:i.body instanceof FormData||i.body instanceof URLSearchParams?Array.from(i.body.entries()).reduce((p,f)=>{let[v,g]=f;return""+p+v+"="+g+`
`},""):String(i.body);return{path:n,submission:{formMethod:o,formAction:a,formEncType:i.formEncType,formData:void 0,json:void 0,text:d}}}else if(i.formEncType==="application/json"){if(!go(o))return r();try{let d=typeof i.body=="string"?JSON.parse(i.body):i.body;return{path:n,submission:{formMethod:o,formAction:a,formEncType:i.formEncType,formData:void 0,json:d,text:void 0}}}catch{return r()}}}Kt(typeof FormData=="function","FormData is not available in this environment");let l,c;if(i.formData)l=yT(i.formData),c=i.formData;else if(i.body instanceof FormData)l=yT(i.body),c=i.body;else if(i.body instanceof URLSearchParams)l=i.body,c=fN(l);else if(i.body==null)l=new URLSearchParams,c=new FormData;else try{l=new URLSearchParams(i.body),c=fN(l)}catch{return r()}let u={formMethod:o,formAction:a,formEncType:i&&i.formEncType||"application/x-www-form-urlencoded",formData:c,json:void 0,text:void 0};if(go(u.formMethod))return{path:n,submission:u};let h=Cc(n);return e&&h.search&&_A(h.search)&&l.append("index",""),h.search="?"+l,{path:U0(h),submission:u}}function cN(t,e,n){n===void 0&&(n=!1);let i=t.findIndex(r=>r.route.id===e);return i>=0?t.slice(0,n?i+1:i):t}function uN(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,v){let g=v?hs(v[1])?v[1].error:v[1].data:void 0,m=t.createURL(e.location),y=t.createURL(r),S=n;s&&e.errors?S=cN(n,Object.keys(e.errors)[0],!0):v&&hs(v[1])&&(S=cN(n,v[0]));let x=v?v[1].statusCode:void 0,w=o&&x&&x>=400,C=S.filter((T,M)=>{let{route:_}=T;if(_.lazy)return!0;if(_.loader==null)return!1;if(s)return vT(_,e.loaderData,e.errors);if(Oue(e.loaderData,e.matches[M],T)||l.some(z=>z===T.route.id))return!0;let R=e.matches[M],L=T;return hN(T,Dn({currentUrl:m,currentParams:R.params,nextUrl:y,nextParams:L.params},i,{actionResult:g,actionStatus:x,defaultShouldRevalidate:w?!1:a||m.pathname+m.search===y.pathname+y.search||m.search!==y.search||m6(R,L)}))}),E=[];return h.forEach((T,M)=>{if(s||!n.some(G=>G.route.id===T.routeId)||u.has(M))return;let _=iu(p,T.path,f);if(!_){E.push({key:M,routeId:T.routeId,path:T.path,matches:null,match:null,controller:null});return}let R=e.fetchers.get(M),L=tg(_,T.path),z=!1;d.has(M)?z=!1:c.has(M)?(c.delete(M),z=!0):R&&R.state!=="idle"&&R.data===void 0?z=a:z=hN(L,Dn({currentUrl:m,currentParams:e.matches[e.matches.length-1].params,nextUrl:y,nextParams:n[n.length-1].params},i,{actionResult:g,actionStatus:x,defaultShouldRevalidate:w?!1:a})),z&&E.push({key:M,routeId:T.routeId,path:T.path,matches:_,match:L,controller:new AbortController})}),[C,E]}function vT(t,e,n){if(t.lazy)return!0;if(!t.loader)return!1;let i=e!=null&&e[t.id]!==void 0,r=n!=null&&n[t.id]!==void 0;return!i&&r?!1:typeof t.loader=="function"&&t.loader.hydrate===!0?!0:!i&&!r}function Oue(t,e,n){let i=!e||n.route.id!==e.route.id,r=t[n.route.id]===void 0;return i||r}function m6(t,e){let n=t.route.path;return t.pathname!==e.pathname||n!=null&&n.endsWith("*")&&t.params["*"]!==e.params["*"]}function hN(t,e){if(t.route.shouldRevalidate){let n=t.route.shouldRevalidate(e);if(typeof n=="boolean")return n}return e.defaultShouldRevalidate}function dN(t,e,n,i,r){var s;let o;if(t){let c=i[t];Kt(c,"No route found to patch children into: routeId = "+t),c.children||(c.children=[]),o=c.children}else o=n;let a=e.filter(c=>!o.some(u=>g6(c,u))),l=z1(a,r,[t||"_","patch",String(((s=o)==null?void 0:s.length)||"0")],i);o.push(...l)}function g6(t,e){return"id"in t&&"id"in e&&t.id===e.id?!0:t.index===e.index&&t.path===e.path&&t.caseSensitive===e.caseSensitive?(!t.children||t.children.length===0)&&(!e.children||e.children.length===0)?!0:t.children.every((n,i)=>{var r;return(r=e.children)==null?void 0:r.some(s=>g6(n,s))}):!1}async function Fue(t,e,n){if(!t.lazy)return;let i=await t.lazy();if(!t.lazy)return;let r=n[t.id];Kt(r,"No route found in manifest");let s={};for(let o in i){let l=r[o]!==void 0&&o!=="hasErrorBoundary";Ud(!l,'Route "'+r.id+'" has a static property "'+o+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+o+'" will be ignored.')),!l&&!sue.has(o)&&(s[o]=i[o])}Object.assign(r,s),Object.assign(r,Dn({},e(r),{lazy:void 0}))}async function zue(t){let{matches:e}=t,n=e.filter(r=>r.shouldLoad);return(await Promise.all(n.map(r=>r.resolve()))).reduce((r,s,o)=>Object.assign(r,{[n[o].route.id]:s}),{})}async function Uue(t,e,n,i,r,s,o,a,l,c){let u=s.map(p=>p.route.lazy?Fue(p.route,l,a):void 0),h=s.map((p,f)=>{let v=u[f],g=r.some(y=>y.route.id===p.route.id);return Dn({},p,{shouldLoad:g,resolve:async y=>(y&&i.method==="GET"&&(p.route.lazy||p.route.loader)&&(g=!0),g?Bue(e,i,p,v,y,c):Promise.resolve({type:pn.data,result:void 0}))})}),d=await t({matches:h,request:i,params:s[0].params,fetcherKey:o,context:c});try{await Promise.all(u)}catch{}return d}async function Bue(t,e,n,i,r,s){let o,a,l=c=>{let u,h=new Promise((f,v)=>u=v);a=()=>u(),e.signal.addEventListener("abort",a);let d=f=>typeof c!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+t+'" [routeId: '+n.route.id+"]"))):c({request:e,params:n.params,context:s},...f!==void 0?[f]:[]),p=(async()=>{try{return{type:"data",result:await(r?r(v=>d(v)):d())}}catch(f){return{type:"error",result:f}}})();return Promise.race([p,h])};try{let c=n.route[t];if(i)if(c){let u,[h]=await Promise.all([l(c).catch(d=>{u=d}),i]);if(u!==void 0)throw u;o=h}else if(await i,c=n.route[t],c)o=await l(c);else if(t==="action"){let u=new URL(e.url),h=u.pathname+u.search;throw zr(405,{method:e.method,pathname:h,routeId:n.route.id})}else return{type:pn.data,result:void 0};else if(c)o=await l(c);else{let u=new URL(e.url),h=u.pathname+u.search;throw zr(404,{pathname:h})}Kt(o.result!==void 0,"You defined "+(t==="action"?"an action":"a loader")+" for route "+('"'+n.route.id+"\" but didn't return anything from your `"+t+"` ")+"function. Please return a value or `null`.")}catch(c){return{type:pn.error,result:c}}finally{a&&e.signal.removeEventListener("abort",a)}return o}async function $ue(t){let{result:e,type:n}=t;if(y6(e)){let c;try{let u=e.headers.get("Content-Type");u&&/\bapplication\/json\b/.test(u)?e.body==null?c=null:c=await e.json():c=await e.text()}catch(u){return{type:pn.error,error:u}}return n===pn.error?{type:pn.error,error:new U1(e.status,e.statusText,c),statusCode:e.status,headers:e.headers}:{type:pn.data,data:c,statusCode:e.status,headers:e.headers}}if(n===pn.error){if(SN(e)){var i;if(e.data instanceof Error){var r;return{type:pn.error,error:e.data,statusCode:(r=e.init)==null?void 0:r.status}}e=new U1(((i=e.init)==null?void 0:i.status)||500,void 0,e.data)}return{type:pn.error,error:e,statusCode:iC(e)?e.status:void 0}}if(Gue(e)){var s,o;return{type:pn.deferred,deferredData:e,statusCode:(s=e.init)==null?void 0:s.status,headers:((o=e.init)==null?void 0:o.headers)&&new Headers(e.init.headers)}}if(SN(e)){var a,l;return{type:pn.data,data:e.data,statusCode:(a=e.init)==null?void 0:a.status,headers:(l=e.init)!=null&&l.headers?new Headers(e.init.headers):void 0}}return{type:pn.data,data:e}}function Hue(t,e,n,i,r,s){let o=t.headers.get("Location");if(Kt(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!xA.test(o)){let a=i.slice(0,i.findIndex(l=>l.route.id===n)+1);o=gT(new URL(e.url),a,r,!0,o,s),t.headers.set("Location",o)}return t}function pN(t,e,n){if(xA.test(t)){let i=t,r=i.startsWith("//")?new URL(e.protocol+i):new URL(i),s=B0(r.pathname,n)!=null;if(r.origin===e.origin&&s)return r.pathname+r.search+r.hash}return t}function Ph(t,e,n,i){let r=t.createURL(v6(e)).toString(),s={signal:n};if(i&&go(i.formMethod)){let{formMethod:o,formEncType:a}=i;s.method=o.toUpperCase(),a==="application/json"?(s.headers=new Headers({"Content-Type":a}),s.body=JSON.stringify(i.json)):a==="text/plain"?s.body=i.text:a==="application/x-www-form-urlencoded"&&i.formData?s.body=yT(i.formData):s.body=i.formData}return new Request(r,s)}function yT(t){let e=new URLSearchParams;for(let[n,i]of t.entries())e.append(n,typeof i=="string"?i:i.name);return e}function fN(t){let e=new FormData;for(let[n,i]of t.entries())e.append(n,i);return e}function Vue(t,e,n,i,r){let s={},o=null,a,l=!1,c={},u=n&&hs(n[1])?n[1].error:void 0;return t.forEach(h=>{if(!(h.route.id in e))return;let d=h.route.id,p=e[d];if(Kt(!hu(p),"Cannot handle redirect results in processLoaderData"),hs(p)){let f=p.error;u!==void 0&&(f=u,u=void 0),o=o||{};{let v=ru(t,d);o[v.route.id]==null&&(o[v.route.id]=f)}s[d]=void 0,l||(l=!0,a=iC(p.error)?p.error.status:500),p.headers&&(c[d]=p.headers)}else Ol(p)?(i.set(d,p.deferredData),s[d]=p.deferredData.data,p.statusCode!=null&&p.statusCode!==200&&!l&&(a=p.statusCode),p.headers&&(c[d]=p.headers)):(s[d]=p.data,p.statusCode&&p.statusCode!==200&&!l&&(a=p.statusCode),p.headers&&(c[d]=p.headers))}),u!==void 0&&n&&(o={[n[0]]:u},s[n[0]]=void 0),{loaderData:s,errors:o,statusCode:a||200,loaderHeaders:c}}function mN(t,e,n,i,r,s,o){let{loaderData:a,errors:l}=Vue(e,n,i,o);return r.forEach(c=>{let{key:u,match:h,controller:d}=c,p=s[u];if(Kt(p,"Did not find corresponding fetcher result"),!(d&&d.signal.aborted))if(hs(p)){let f=ru(t.matches,h==null?void 0:h.route.id);l&&l[f.route.id]||(l=Dn({},l,{[f.route.id]:p.error})),t.fetchers.delete(u)}else if(hu(p))Kt(!1,"Unhandled fetcher revalidation redirect");else if(Ol(p))Kt(!1,"Unhandled fetcher deferred data");else{let f=Sl(p.data);t.fetchers.set(u,f)}}),{loaderData:a,errors:l}}function gN(t,e,n,i){let r=Dn({},e);for(let s of n){let o=s.route.id;if(e.hasOwnProperty(o)?e[o]!==void 0&&(r[o]=e[o]):t[o]!==void 0&&s.route.loader&&(r[o]=t[o]),i&&i.hasOwnProperty(o))break}return r}function vN(t){return t?hs(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function ru(t,e){return(e?t.slice(0,t.findIndex(i=>i.route.id===e)+1):[...t]).reverse().find(i=>i.route.hasErrorBoundary===!0)||t[0]}function yN(t){let e=t.length===1?t[0]:t.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function zr(t,e){let{pathname:n,routeId:i,method:r,type:s,message:o}=e===void 0?{}:e,a="Unknown Server Error",l="Unknown @remix-run/router error";return t===400?(a="Bad Request",r&&n&&i?l="You made a "+r+' request to "'+n+'" but '+('did not provide a `loader` for route "'+i+'", ')+"so there is no way to handle the request.":s==="defer-action"?l="defer() is not supported in actions":s==="invalid-body"&&(l="Unable to encode submission body")):t===403?(a="Forbidden",l='Route "'+i+'" does not match URL "'+n+'"'):t===404?(a="Not Found",l='No route matches URL "'+n+'"'):t===405&&(a="Method Not Allowed",r&&n&&i?l="You made a "+r.toUpperCase()+' request to "'+n+'" but '+('did not provide an `action` for route "'+i+'", ')+"so there is no way to handle the request.":r&&(l='Invalid request method "'+r.toUpperCase()+'"')),new U1(t||500,a,new Error(l),!0)}function ny(t){let e=Object.entries(t);for(let n=e.length-1;n>=0;n--){let[i,r]=e[n];if(hu(r))return{key:i,result:r}}}function v6(t){let e=typeof t=="string"?Cc(t):t;return U0(Dn({},e,{hash:""}))}function jue(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function Wue(t){return y6(t.result)&&Iue.has(t.result.status)}function Ol(t){return t.type===pn.deferred}function hs(t){return t.type===pn.error}function hu(t){return(t&&t.type)===pn.redirect}function SN(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function Gue(t){let e=t;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function y6(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function que(t){return Pue.has(t.toLowerCase())}function go(t){return bue.has(t.toLowerCase())}async function Xue(t,e,n,i,r){let s=Object.entries(e);for(let o=0;o<s.length;o++){let[a,l]=s[o],c=t.find(d=>(d==null?void 0:d.route.id)===a);if(!c)continue;let u=i.find(d=>d.route.id===c.route.id),h=u!=null&&!m6(u,c)&&(r&&r[c.route.id])!==void 0;Ol(l)&&h&&await CA(l,n,!1).then(d=>{d&&(e[a]=d)})}}async function Kue(t,e,n){for(let i=0;i<n.length;i++){let{key:r,routeId:s,controller:o}=n[i],a=e[r];t.find(c=>(c==null?void 0:c.route.id)===s)&&Ol(a)&&(Kt(o,"Expected an AbortController for revalidating fetcher deferred result"),await CA(a,o.signal,!0).then(c=>{c&&(e[r]=c)}))}}async function CA(t,e,n){if(n===void 0&&(n=!1),!await t.deferredData.resolveData(e)){if(n)try{return{type:pn.data,data:t.deferredData.unwrappedData}}catch(r){return{type:pn.error,error:r}}return{type:pn.data,data:t.deferredData.data}}}function _A(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function tg(t,e){let n=typeof e=="string"?Cc(e).search:e.search;if(t[t.length-1].route.index&&_A(n||""))return t[t.length-1];let i=d6(t);return i[i.length-1]}function xN(t){let{formMethod:e,formAction:n,formEncType:i,text:r,formData:s,json:o}=t;if(!(!e||!n||!i)){if(r!=null)return{formMethod:e,formAction:n,formEncType:i,formData:void 0,json:void 0,text:r};if(s!=null)return{formMethod:e,formAction:n,formEncType:i,formData:s,json:void 0,text:void 0};if(o!==void 0)return{formMethod:e,formAction:n,formEncType:i,formData:void 0,json:o,text:void 0}}}function Vw(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function Yue(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function Bm(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function Jue(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function Sl(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function Que(t,e){try{let n=t.sessionStorage.getItem(f6);if(n){let i=JSON.parse(n);for(let[r,s]of Object.entries(i||{}))s&&Array.isArray(s)&&e.set(r,new Set(s||[]))}}catch{}}function Zue(t,e){if(e.size>0){let n={};for(let[i,r]of e)n[i]=[...r];try{t.sessionStorage.setItem(f6,JSON.stringify(n))}catch(i){Ud(!1,"Failed to save applied view transitions in sessionStorage ("+i+").")}}}/**
 * React Router v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ST(){return ST=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ST.apply(this,arguments)}const S6=he.createContext(null),x6=he.createContext(null),C6=he.createContext(null),wA=he.createContext(null),rC=he.createContext({outlet:null,matches:[],isDataRoute:!1}),_6=he.createContext(null);function EA(){return he.useContext(wA)!=null}function ehe(){return EA()||Kt(!1),he.useContext(wA).location}function the(t,e,n,i){EA()||Kt(!1);let{navigator:r}=he.useContext(C6),{matches:s}=he.useContext(rC),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=ehe(),u;u=c;let h=u.pathname||"/",d=h;if(l!=="/"){let v=l.replace(/^\//,"").split("/");d="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let p=iu(t,{pathname:d});return ohe(p&&p.map(v=>Object.assign({},v,{params:Object.assign({},a,v.params),pathname:yu([l,r.encodeLocation?r.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?l:yu([l,r.encodeLocation?r.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),s,n,i)}function nhe(){let t=uhe(),e=iC(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return he.createElement(he.Fragment,null,he.createElement("h2",null,"Unexpected Application Error!"),he.createElement("h3",{style:{fontStyle:"italic"}},e),n?he.createElement("pre",{style:r},n):null,null)}const ihe=he.createElement(nhe,null);class rhe extends he.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?he.createElement(rC.Provider,{value:this.props.routeContext},he.createElement(_6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function she(t){let{routeContext:e,match:n,children:i}=t,r=he.useContext(S6);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),he.createElement(rC.Provider,{value:e},i)}function ohe(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let u=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);u>=0||Kt(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<o.length;u++){let h=o[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:d,errors:p}=n,f=h.route.loader&&d[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||f){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,h,d)=>{let p,f=!1,v=null,g=null;n&&(p=a&&h.route.id?a[h.route.id]:void 0,v=h.route.errorElement||ihe,l&&(c<0&&d===0?(hhe("route-fallback"),f=!0,g=null):c===d&&(f=!0,g=h.route.hydrateFallbackElement||null)));let m=e.concat(o.slice(0,d+1)),y=()=>{let S;return p?S=v:f?S=g:h.route.Component?S=he.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=u,he.createElement(she,{match:h,routeContext:{outlet:u,matches:m,isDataRoute:n!=null},children:S})};return n&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?he.createElement(rhe,{location:n.location,revalidation:n.revalidation,component:v,error:p,children:y(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):y()},null)}var xT=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(xT||{});function ahe(t){let e=he.useContext(x6);return e||Kt(!1),e}function lhe(t){let e=he.useContext(rC);return e||Kt(!1),e}function che(t){let e=lhe(),n=e.matches[e.matches.length-1];return n.route.id||Kt(!1),n.route.id}function uhe(){var t;let e=he.useContext(_6),n=ahe(xT.UseRouteError),i=che(xT.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}const CN={};function hhe(t,e,n){CN[t]||(CN[t]=!0)}const _N={};function dhe(t,e){_N[e]||(_N[e]=!0,console.warn(e))}const Ih=(t,e,n)=>dhe(t,"⚠️ React Router Future Flag Warning: "+e+". "+("You can use the `"+t+"` future flag to opt-in early. ")+("For more information, see "+n+"."));function phe(t,e){t!=null&&t.v7_startTransition||Ih("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),!(t!=null&&t.v7_relativeSplatPath)&&(!e||!e.v7_relativeSplatPath)&&Ih("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath"),e&&(e.v7_fetcherPersist||Ih("v7_fetcherPersist","The persistence behavior of fetchers is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist"),e.v7_normalizeFormMethod||Ih("v7_normalizeFormMethod","Casing of `formMethod` fields is being normalized to uppercase in v7","https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod"),e.v7_partialHydration||Ih("v7_partialHydration","`RouterProvider` hydration behavior is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_partialhydration"),e.v7_skipActionErrorRevalidation||Ih("v7_skipActionErrorRevalidation","The revalidation behavior after 4xx/5xx `action` responses is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation"))}function fhe(t){let{basename:e="/",children:n=null,location:i,navigationType:r=li.Pop,navigator:s,static:o=!1,future:a}=t;EA()&&Kt(!1);let l=e.replace(/^\/*/,"/"),c=he.useMemo(()=>({basename:l,navigator:s,static:o,future:ST({v7_relativeSplatPath:!1},a)}),[l,a,s,o]);typeof i=="string"&&(i=Cc(i));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:f="default"}=i,v=he.useMemo(()=>{let g=B0(u,l);return g==null?null:{location:{pathname:g,search:h,hash:d,state:p,key:f},navigationType:r}},[l,u,h,d,p,f,r]);return v==null?null:he.createElement(C6.Provider,{value:c},he.createElement(wA.Provider,{children:n,value:v}))}new Promise(()=>{});function mhe(t){let e={hasErrorBoundary:t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&Object.assign(e,{element:he.createElement(t.Component),Component:void 0}),t.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:he.createElement(t.HydrateFallback),HydrateFallback:void 0}),t.ErrorBoundary&&Object.assign(e,{errorElement:he.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function B1(){return B1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},B1.apply(this,arguments)}const ghe="6";try{window.__reactRouterVersion=ghe}catch{}function vhe(t,e){return Due({basename:e==null?void 0:e.basename,future:B1({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:nue({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||yhe(),routes:t,mapRouteProperties:mhe,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function yhe(){var t;let e=(t=window)==null?void 0:t.__staticRouterHydrationData;return e&&e.errors&&(e=B1({},e,{errors:She(e.errors)})),e}function She(t){if(!t)return null;let e=Object.entries(t),n={};for(let[i,r]of e)if(r&&r.__type==="RouteErrorResponse")n[i]=new U1(r.status,r.statusText,r.data,r.internal===!0);else if(r&&r.__type==="Error"){if(r.__subType){let s=window[r.__subType];if(typeof s=="function")try{let o=new s(r.message);o.stack="",n[i]=o}catch{}}if(n[i]==null){let s=new Error(r.message);s.stack="",n[i]=s}}else n[i]=r;return n}const xhe=he.createContext({isTransitioning:!1}),Che=he.createContext(new Map),_he="startTransition",wN=k7[_he],whe="flushSync",EN=jj[whe];function Ehe(t){wN?wN(t):t()}function $m(t){EN?EN(t):t()}class Rhe{constructor(){this.status="pending",this.promise=new Promise((e,n)=>{this.resolve=i=>{this.status==="pending"&&(this.status="resolved",e(i))},this.reject=i=>{this.status==="pending"&&(this.status="rejected",n(i))}})}}function The(t){let{fallbackElement:e,router:n,future:i}=t,[r,s]=he.useState(n.state),[o,a]=he.useState(),[l,c]=he.useState({isTransitioning:!1}),[u,h]=he.useState(),[d,p]=he.useState(),[f,v]=he.useState(),g=he.useRef(new Map),{v7_startTransition:m}=i||{},y=he.useCallback(T=>{m?Ehe(T):T()},[m]),S=he.useCallback((T,M)=>{let{deletedFetchers:_,flushSync:R,viewTransitionOpts:L}=M;_.forEach(G=>g.current.delete(G)),T.fetchers.forEach((G,$)=>{G.data!==void 0&&g.current.set($,G.data)});let z=n.window==null||n.window.document==null||typeof n.window.document.startViewTransition!="function";if(!L||z){R?$m(()=>s(T)):y(()=>s(T));return}if(R){$m(()=>{d&&(u&&u.resolve(),d.skipTransition()),c({isTransitioning:!0,flushSync:!0,currentLocation:L.currentLocation,nextLocation:L.nextLocation})});let G=n.window.document.startViewTransition(()=>{$m(()=>s(T))});G.finished.finally(()=>{$m(()=>{h(void 0),p(void 0),a(void 0),c({isTransitioning:!1})})}),$m(()=>p(G));return}d?(u&&u.resolve(),d.skipTransition(),v({state:T,currentLocation:L.currentLocation,nextLocation:L.nextLocation})):(a(T),c({isTransitioning:!0,flushSync:!1,currentLocation:L.currentLocation,nextLocation:L.nextLocation}))},[n.window,d,u,g,y]);he.useLayoutEffect(()=>n.subscribe(S),[n,S]),he.useEffect(()=>{l.isTransitioning&&!l.flushSync&&h(new Rhe)},[l]),he.useEffect(()=>{if(u&&o&&n.window){let T=o,M=u.promise,_=n.window.document.startViewTransition(async()=>{y(()=>s(T)),await M});_.finished.finally(()=>{h(void 0),p(void 0),a(void 0),c({isTransitioning:!1})}),p(_)}},[y,o,u,n.window]),he.useEffect(()=>{u&&o&&r.location.key===o.location.key&&u.resolve()},[u,d,r.location,o]),he.useEffect(()=>{!l.isTransitioning&&f&&(a(f.state),c({isTransitioning:!0,flushSync:!1,currentLocation:f.currentLocation,nextLocation:f.nextLocation}),v(void 0))},[l.isTransitioning,f]),he.useEffect(()=>{},[]);let x=he.useMemo(()=>({createHref:n.createHref,encodeLocation:n.encodeLocation,go:T=>n.navigate(T),push:(T,M,_)=>n.navigate(T,{state:M,preventScrollReset:_==null?void 0:_.preventScrollReset}),replace:(T,M,_)=>n.navigate(T,{replace:!0,state:M,preventScrollReset:_==null?void 0:_.preventScrollReset})}),[n]),w=n.basename||"/",C=he.useMemo(()=>({router:n,navigator:x,static:!1,basename:w}),[n,x,w]),E=he.useMemo(()=>({v7_relativeSplatPath:n.future.v7_relativeSplatPath}),[n.future.v7_relativeSplatPath]);return he.useEffect(()=>phe(i,n.future),[i,n.future]),he.createElement(he.Fragment,null,he.createElement(S6.Provider,{value:C},he.createElement(x6.Provider,{value:r},he.createElement(Che.Provider,{value:g.current},he.createElement(xhe.Provider,{value:l},he.createElement(fhe,{basename:w,location:r.location,navigationType:r.historyAction,navigator:x,future:E},r.initialized||n.future.v7_partialHydration?he.createElement(bhe,{routes:n.routes,future:n.future,state:r}):e))))),null)}const bhe=he.memo(Ahe);function Ahe(t){let{routes:e,future:n,state:i}=t;return the(e,void 0,i,n)}var RN;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(RN||(RN={}));var TN;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(TN||(TN={}));var Nu=typeof self<"u"?self:{};function CT(t,e){e:{for(var n=["CLOSURE_FLAGS"],i=Nu,r=0;r<n.length;r++)if((i=i[n[r]])==null){n=null;break e}n=i}return(t=n&&n[t])!=null?t:e}function qc(){throw Error("Invalid UTF8")}function bN(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}let iy,jw;const Phe=typeof TextDecoder<"u";let Ihe;const Mhe=typeof TextEncoder<"u";function w6(t){if(Mhe)t=(Ihe||(Ihe=new TextEncoder)).encode(t);else{let n=0;const i=new Uint8Array(3*t.length);for(let r=0;r<t.length;r++){var e=t.charCodeAt(r);if(e<128)i[n++]=e;else{if(e<2048)i[n++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&r<t.length){const s=t.charCodeAt(++r);if(s>=56320&&s<=57343){e=1024*(e-55296)+s-56320+65536,i[n++]=e>>18|240,i[n++]=e>>12&63|128,i[n++]=e>>6&63|128,i[n++]=63&e|128;continue}r--}e=65533}i[n++]=e>>12|224,i[n++]=e>>6&63|128}i[n++]=63&e|128}}t=n===i.length?i:i.subarray(0,n)}return t}var o0,E6=CT(610401301,!1),khe=CT(653718497,CT(1,!0));const AN=Nu.navigator;function _T(t){return!!E6&&!!o0&&o0.brands.some(({brand:e})=>e&&e.indexOf(t)!=-1)}function Fs(t){var e;return(e=Nu.navigator)&&(e=e.userAgent)||(e=""),e.indexOf(t)!=-1}function Pl(){return!!E6&&!!o0&&o0.brands.length>0}function Ww(){return Pl()?_T("Chromium"):(Fs("Chrome")||Fs("CriOS"))&&!(!Pl()&&Fs("Edge"))||Fs("Silk")}function RA(t){return RA[" "](t),t}o0=AN&&AN.userAgentData||null,RA[" "]=function(){};var Lhe=!Pl()&&(Fs("Trident")||Fs("MSIE"));!Fs("Android")||Ww(),Ww(),Fs("Safari")&&(Ww()||!Pl()&&Fs("Coast")||!Pl()&&Fs("Opera")||!Pl()&&Fs("Edge")||(Pl()?_T("Microsoft Edge"):Fs("Edg/"))||Pl()&&_T("Opera"));var R6={},ng=null;function Dhe(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):"=.".indexOf(t[e-1])!=-1&&(n="=.".indexOf(t[e-2])!=-1?n-2:n-1);var i=new Uint8Array(n),r=0;return function(s,o){function a(p){for(;l<s.length;){var f=s.charAt(l++),v=ng[f];if(v!=null)return v;if(!/^[\s\xa0]*$/.test(f))throw Error("Unknown base64 encoding at char: "+f)}return p}T6();for(var l=0;;){var c=a(-1),u=a(0),h=a(64),d=a(64);if(d===64&&c===-1)break;o(c<<2|u>>4),h!=64&&(o(u<<4&240|h>>2),d!=64&&o(h<<6&192|d))}}(t,function(s){i[r++]=s}),r!==n?i.subarray(0,r):i}function T6(){if(!ng){ng={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;n<5;n++){var i=t.concat(e[n].split(""));R6[n]=i;for(var r=0;r<i.length;r++){var s=i[r];ng[s]===void 0&&(ng[s]=r)}}}}var b6=typeof Uint8Array<"u",A6=!Lhe&&typeof btoa=="function";function PN(t){if(!A6){var e;e===void 0&&(e=0),T6(),e=R6[e];var n=Array(Math.floor(t.length/3)),i=e[64]||"";let l=0,c=0;for(;l<t.length-2;l+=3){var r=t[l],s=t[l+1],o=t[l+2],a=e[r>>2];r=e[(3&r)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],n[c++]=a+r+s+o}switch(a=0,o=i,t.length-l){case 2:o=e[(15&(a=t[l+1]))<<2]||i;case 1:t=t[l],n[c]=e[t>>2]+e[(3&t)<<4|a>>4]+o+i}return n.join("")}for(e="",n=0,i=t.length-10240;n<i;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const IN=/[-_.]/g,Nhe={"-":"+",_:"/",".":"="};function Ohe(t){return Nhe[t]||""}function P6(t){if(!A6)return Dhe(t);IN.test(t)&&(t=t.replace(IN,Ohe)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function $0(t){return b6&&t!=null&&t instanceof Uint8Array}var Bd={};let Fhe;function I6(t){if(t!==Bd)throw Error("illegal external caller")}function Ou(){return Fhe||(Fhe=new Va(null,Bd))}function TA(t){I6(Bd);var e=t.g;return(e=e==null||$0(e)?e:typeof e=="string"?P6(e):null)==null?e:t.g=e}var Va=class{constructor(t,e){if(I6(e),this.g=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}h(){return new Uint8Array(TA(this)||0)}};function M6(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}let zhe;function sC(){const t=Error();M6(t,"incident"),function(e){Nu.setTimeout(()=>{throw e},0)}(t)}function wT(t){return M6(t=Error(t),"warning"),t}function bA(){return typeof BigInt=="function"}function Cs(t){return Array.prototype.slice.call(t)}var mp=typeof Symbol=="function"&&typeof Symbol()=="symbol";function oC(t){return typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():t}var H0=oC(),MN=oC("0di"),Gw=oC("2ex"),Hm=oC("1oa"),aC=mp?(t,e)=>{t[H0]|=e}:(t,e)=>{t.G!==void 0?t.G|=e:Object.defineProperties(t,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})},$1=mp?(t,e)=>{t[H0]&=~e}:(t,e)=>{t.G!==void 0&&(t.G&=~e)},Wn=mp?t=>0|t[H0]:t=>0|t.G,un=mp?t=>t[H0]:t=>t.G,Hn=mp?(t,e)=>{t[H0]=e}:(t,e)=>{t.G!==void 0?t.G=e:Object.defineProperties(t,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})};function Yu(t){return aC(t,34),t}function Uhe(t,e){Hn(e,-30975&(0|t))}function ET(t,e){Hn(e,-30941&(34|t))}var AA,V0={},k6={};function kN(t){return!(!t||typeof t!="object"||t.Ja!==k6)}function lC(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}function PA(t,e,n){if(t!=null){if(typeof t=="string")t=t?new Va(t,Bd):Ou();else if(t.constructor!==Va)if($0(t))t=t.length?new Va(n?t:new Uint8Array(t),Bd):Ou();else{if(!e)throw Error();t=void 0}}return t}function H1(t){return!(!Array.isArray(t)||t.length)&&!!(1&Wn(t))}const LN=[];function nl(t){if(2&t)throw Error()}Hn(LN,55),AA=Object.freeze(LN);class V1{constructor(e,n,i){this.l=0,this.g=e,this.h=n,this.m=i}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new V1(this.g,this.h,this.m)}}let Yl;function L6(t,e){(e=Yl?e[Yl]:void 0)&&(t[Yl]=Cs(e))}var Bhe=Object.freeze({}),$he=Object.freeze({}),Hhe=Object.freeze({});function cC(t){return t.Qa=!0,t}var Vhe=cC(t=>typeof t=="number"),DN=cC(t=>typeof t=="string"),jhe=cC(t=>typeof t=="boolean"),uC=typeof Nu.BigInt=="function"&&typeof Nu.BigInt(0)=="bigint",RT=cC(t=>uC?t>=Ghe&&t<=Xhe:t[0]==="-"?NN(t,Whe):NN(t,qhe));const Whe=Number.MIN_SAFE_INTEGER.toString(),Ghe=uC?BigInt(Number.MIN_SAFE_INTEGER):void 0,qhe=Number.MAX_SAFE_INTEGER.toString(),Xhe=uC?BigInt(Number.MAX_SAFE_INTEGER):void 0;function NN(t,e){if(t.length>e.length)return!1;if(t.length<e.length||t===e)return!0;for(let n=0;n<t.length;n++){const i=t[n],r=e[n];if(i>r)return!1;if(i<r)return!0}}const Khe=typeof Uint8Array.prototype.slice=="function";let D6,vn=0,Kn=0;function ON(t){const e=t>>>0;vn=e,Kn=(t-e)/4294967296>>>0}function $d(t){if(t<0){ON(-t);const[e,n]=LA(vn,Kn);vn=e>>>0,Kn=n>>>0}else ON(t)}function IA(t){const e=D6||(D6=new DataView(new ArrayBuffer(8)));e.setFloat32(0,+t,!0),Kn=0,vn=e.getUint32(0,!0)}function MA(t,e){return 4294967296*e+(t>>>0)}function kA(t,e){const n=2147483648&e;return n&&(e=~e>>>0,(t=1+~t>>>0)==0&&(e=e+1>>>0)),t=MA(t,e),n?-t:t}function j1(t,e){if(t>>>=0,(e>>>=0)<=2097151)var n=""+(4294967296*e+t);else bA()?n=""+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,t>=1e7&&(n+=t/1e7>>>0,t%=1e7),n>=1e7&&(e+=n/1e7>>>0,n%=1e7),n=e+FN(n)+FN(t));return n}function FN(t){return t=String(t),"0000000".slice(t.length)+t}function hC(t){if(t.length<16)$d(Number(t));else if(bA())t=BigInt(t),vn=Number(t&BigInt(4294967295))>>>0,Kn=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+(t[0]==="-");Kn=vn=0;const n=t.length;for(let i=e,r=(n-e)%6+e;r<=n;i=r,r+=6){const s=Number(t.slice(i,r));Kn*=1e6,vn=1e6*vn+s,vn>=4294967296&&(Kn+=Math.trunc(vn/4294967296),Kn>>>=0,vn>>>=0)}if(e){const[i,r]=LA(vn,Kn);vn=i,Kn=r}}}function LA(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}function _c(t){return t==null||typeof t=="number"?t:t==="NaN"||t==="Infinity"||t==="-Infinity"?Number(t):void 0}function N6(t){return t==null||typeof t=="boolean"?t:typeof t=="number"?!!t:void 0}const Yhe=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function dC(t){const e=typeof t;switch(e){case"bigint":return!0;case"number":return Number.isFinite(t)}return e==="string"&&Yhe.test(t)}function gp(t){if(t==null)return t;if(typeof t=="string"){if(!t)return;t=+t}return typeof t=="number"&&Number.isFinite(t)?0|t:void 0}function Jhe(t){if(t==null)return t;if(typeof t=="string"){if(!t)return;t=+t}return typeof t=="number"&&Number.isFinite(t)?t>>>0:void 0}function zN(t){return t[0]!=="-"&&(t.length<20||t.length===20&&Number(t.substring(0,6))<184467)}function DA(t){return t=Math.trunc(t),Number.isSafeInteger(t)||($d(t),t=kA(vn,Kn)),t}function NA(t){var e=Math.trunc(Number(t));if(Number.isSafeInteger(e))return String(e);if((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),!(t[0]==="-"?t.length<20||t.length===20&&Number(t.substring(0,7))>-922337:t.length<19||t.length===19&&Number(t.substring(0,6))<922337))if(hC(t),t=vn,2147483648&(e=Kn))if(bA())t=""+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,i]=LA(t,e);t="-"+j1(n,i)}else t=j1(t,e);return t}function W1(t){return t==null?t:typeof t=="bigint"?(RT(t)?t=Number(t):(t=BigInt.asIntN(64,t),t=RT(t)?Number(t):String(t)),t):dC(t)?typeof t=="number"?DA(t):NA(t):void 0}function Qhe(t){if(t==null)return t;var e=typeof t;if(e==="bigint")return String(BigInt.asUintN(64,t));if(dC(t)){if(e==="string")return e=Math.trunc(Number(t)),Number.isSafeInteger(e)&&e>=0?t=String(e):((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),zN(t)||(hC(t),t=j1(vn,Kn))),t;if(e==="number")return(t=Math.trunc(t))>=0&&Number.isSafeInteger(t)?t:function(n){if(n<0){$d(n);const i=j1(vn,Kn);return n=Number(i),Number.isSafeInteger(n)?n:i}return zN(String(n))?n:($d(n),MA(vn,Kn))}(t)}}function O6(t){if(typeof t!="string")throw Error();return t}function vp(t){if(t!=null&&typeof t!="string")throw Error();return t}function Jl(t){return t==null||typeof t=="string"?t:void 0}function OA(t,e,n,i){if(t!=null&&typeof t=="object"&&t.X===V0)return t;if(!Array.isArray(t))return n?2&i?(t=e[MN])?e=t:(Yu((t=new e).u),e=e[MN]=t):e=new e:e=void 0,e;let r=n=Wn(t);return r===0&&(r|=32&i),r|=2&i,r!==n&&Hn(t,r),new e(t)}function Zhe(t,e,n){if(e)e:{if(!dC(e=t))throw wT("int64");switch(typeof e){case"string":e=NA(e);break e;case"bigint":if(t=e=BigInt.asIntN(64,e),DN(t)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(t))throw Error(String(t))}else if(Vhe(t)&&!Number.isSafeInteger(t))throw Error(String(t));e=uC?BigInt(e):jhe(e)?e?"1":"0":DN(e)?e.trim()||"0":String(e);break e;default:e=DA(e)}}else e=W1(t);return typeof(n=(t=e)==null?n?0:void 0:t)=="string"&&(e=+n,Number.isSafeInteger(e))?e:n}function F6(t){if(Vm===void 0&&(Vm=typeof Proxy=="function"?B6(Proxy):null),!Vm||!U6())return t;let e=ur==null?void 0:ur.get(t);return e||(Math.random()>.01?t:(function(n){if(qw===void 0){const i=new Vm([],{});qw=Array.prototype.concat.call([],i).length===1}qw&&typeof Symbol=="function"&&Symbol.isConcatSpreadable&&(n[Symbol.isConcatSpreadable]=!0)}(t),e=new Vm(t,{set:(n,i,r)=>(sC(),n[i]=r,!0)}),function(n,i){(ur||(ur=new Su)).set(n,i),(Hy||(Hy=new Su)).set(i,n)}(t,e),e))}let ur,Hy,Vm,Su,qw,ms,G1,z6,ede;function U6(){return Su===void 0&&(Su=typeof WeakMap=="function"?B6(WeakMap):null),Su}function B6(t){try{return t.toString().indexOf("[native code]")!==-1?t:null}catch{return null}}function FA(t,e,n){var o;if(U6()){if((o=ms==null?void 0:ms.get(e))!=null&&o.get(t)){if(n)return}else if(Math.random()>.01)return;var i=t.length;n={length:i};for(var r=0;r<Math.min(i,10);r++){if(i<=10)var s=r;else{s=i/10;const a=Math.floor(r*s);s=a+Math.floor(Math.random()*(Math.floor((r+1)*s)-a))}n[s]=t[s]}$6(t,n)?((r=(i=ms||(ms=new Su)).get(e))||(r=new Su,i.set(e,r)),r.set(t,n)):(sC(),a0(t,e))}}function q1(t,e){var i;const n=(i=ms==null?void 0:ms.get(e))==null?void 0:i.get(t);n&&!$6(t,n)&&(sC(),a0(t,e))}function $6(t,e){if(t.length!==e.length)return!1;for(const r in e){var n,i=Number(r);if((n=Number.isInteger(i))&&(n=t[i],i=e[i],n=!(Number.isNaN(n)?Number.isNaN(i):n===i)),n)return!1}return!0}function pC(t){if(t&&(ms!=null&&ms.has(t))){var e=t.u;if(e)for(let n=0;n<e.length;n++){const i=e[n];if(n===e.length-1&&lC(i))for(const r in i){const s=i[r];Array.isArray(s)&&q1(s,t)}else Array.isArray(i)&&q1(i,t)}}}function a0(t,e){var n;(n=ms==null?void 0:ms.get(e))==null||n.delete(t)}function Ql(t,e,n){return t=H6(t,e[0],e[1],n?1:2),e!==z6&&n&&aC(t,16384),t}function H6(t,e,n,i){if(i=i??0,t==null&&(t=G1),G1=void 0,t==null){var r=96;n?(t=[n],r|=512):t=[],e&&(r=-33521665&r|(1023&e)<<15)}else{if(!Array.isArray(t))throw Error("narr");if(2048&(r=Wn(t)))throw Error("farr");if(64&r)return t;if(i===1||i===2||(r|=64),n&&(r|=512,n!==t[0]))throw Error("mid");e:{if(i=(n=t).length){const s=i-1;if(lC(n[s])){if((e=s-(+!!(512&(r|=256))-1))>=1024)throw Error("pvtlmt");r=-33521665&r|(1023&e)<<15;break e}}if(e){if((e=Math.max(e,i-(+!!(512&r)-1)))>1024)throw Error("spvt");r=-33521665&r|(1023&e)<<15}}}return Hn(t,r),t}const tde={};let nde=function(){try{return RA(new class extends Map{constructor(){super()}}),!1}catch{return!0}}();class Xw{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,n){return this.g.set(e,n),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,n){return this.g.forEach(e,n)}[Symbol.iterator](){return this.entries()}}const ide=nde?(Object.setPrototypeOf(Xw.prototype,Map.prototype),Object.defineProperties(Xw.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),Xw):class extends Map{constructor(){super()}};function UN(t){return t}function Kw(t){if(2&t.M)throw Error("Cannot mutate an immutable Map")}var Js=class extends ide{constructor(t,e,n=UN,i=UN){super();let r=Wn(t);r|=64,Hn(t,r),this.M=r,this.T=e,this.S=n,this.Z=this.T?rde:i;for(let s=0;s<t.length;s++){const o=t[s],a=n(o[0],!1,!0);let l=o[1];e?l===void 0&&(l=null):l=i(o[1],!1,!0,void 0,void 0,r),super.set(a,l)}}pa(t=BN){if(this.size!==0)return this.Y(t)}Y(t=BN){const e=[],n=super.entries();for(var i;!(i=n.next()).done;)(i=i.value)[0]=t(i[0]),i[1]=t(i[1]),e.push(i);return e}clear(){Kw(this),super.clear()}delete(t){return Kw(this),super.delete(this.S(t,!0,!1))}entries(){var t=this.oa();return new V1(t,sde,this)}keys(){return this.Ia()}values(){var t=this.oa();return new V1(t,Js.prototype.get,this)}forEach(t,e){super.forEach((n,i)=>{t.call(e,this.get(i),i,this)})}set(t,e){return Kw(this),(t=this.S(t,!0,!1))==null?this:e==null?(super.delete(t),this):super.set(t,this.Z(e,!0,!0,this.T,!1,this.M))}Oa(t){const e=this.S(t[0],!1,!0);t=t[1],t=this.T?t===void 0?null:t:this.Z(t,!1,!0,void 0,!1,this.M),super.set(e,t)}has(t){return super.has(this.S(t,!1,!1))}get(t){t=this.S(t,!1,!1);const e=super.get(t);if(e!==void 0){var n=this.T;return n?((n=this.Z(e,!1,!0,n,this.ta,this.M))!==e&&super.set(t,n),n):e}}oa(){return Array.from(super.keys())}Ia(){return super.keys()}[Symbol.iterator](){return this.entries()}};function rde(t,e,n,i,r,s){return t=OA(t,i,n,s),r&&(t=mC(t)),t}function BN(t){return t}function sde(t){return[t,this.get(t)]}let ode;function $N(){return ode||(ode=new Js(Yu([]),void 0,void 0,void 0,tde))}function zA(t,e,n,i,r){if(t!=null){if(Array.isArray(t))t=H1(t)?void 0:r&&2&Wn(t)?t:fC(t,e,n,i!==void 0,r);else if(lC(t)){const s={};for(let o in t)s[o]=zA(t[o],e,n,i,r);t=s}else t=e(t,i);return t}}function fC(t,e,n,i,r){const s=i||n?Wn(t):0;i=i?!!(32&s):void 0;const o=Cs(t);for(let a=0;a<o.length;a++)o[a]=zA(o[a],e,n,i,r);return n&&(L6(o,t),n(s,o)),o}function ade(t){return zA(t,UA,void 0,void 0,!1)}function UA(t){return t.X===V0?t.toJSON():t instanceof Js?t.pa(ade):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return RT(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(H1(e))return}else{if($0(e))return PN(e);if(e instanceof Va){const n=e.g;return n==null?"":typeof n=="string"?n:e.g=PN(n)}if(e instanceof Js)return e.pa()}}return e}(t)}function TT(t,e,n=ET){if(t!=null){if(b6&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var i=Wn(t);return 2&i?t:(e&&(e=i===0||!!(32&i)&&!(64&i||!(16&i))),e?(Hn(t,-12293&(34|i)),t):fC(t,TT,4&i?ET:n,!0,!0))}return t.X===V0?(n=t.u,t=2&(i=un(n))?t:BA(t,n,i,!0)):t instanceof Js&&!(2&t.M)&&(n=Yu(t.Y(TT)),t=new Js(n,t.T,t.S,t.Z)),t}}function BA(t,e,n,i){return pC(t),t=t.constructor,G1=e=V6(e,n,i),e=new t(e),G1=void 0,e}function V6(t,e,n){const i=n||2&e?ET:Uhe,r=!!(32&e);return t=function(s,o,a){const l=Cs(s);var c=l.length;const u=256&o?l[c-1]:void 0;for(c+=u?-1:0,o=512&o?1:0;o<c;o++)l[o]=a(l[o]);if(u){o=l[o]={};for(const h in u)o[h]=a(u[h])}return L6(l,s),l}(t,e,s=>TT(s,r,i)),aC(t,32|(n?2:0)),t}function mC(t){const e=t.u,n=un(e);return 2&n?BA(t,e,n,!1):t}function j6(t,e,n,i){return!(4&e)||n!=null}function oc(t,e){return ma(t=t.u,un(t),e)}function HN(t,e,n,i){if(!((e=i+(+!!(512&e)-1))<0||e>=t.length||e>=n))return t[e]}function ma(t,e,n,i){if(n===-1)return null;const r=e>>15&1023||536870912;if(!(n>=r)){var s=t.length;return i&&256&e&&(i=t[s-1][n])!=null?(HN(t,e,r,n)&&Gw!=null&&((e=(t=zhe??(zhe={}))[Gw]||0)>=4||(t[Gw]=e+1,sC())),i):HN(t,e,r,n)}return 256&e?t[t.length-1][n]:void 0}function Cn(t,e,n){const i=t.u;let r=un(i);return nl(r),On(i,r,e,n),t}function On(t,e,n,i){const r=e>>15&1023||536870912;if(n>=r){let s,o=e;if(256&e)s=t[t.length-1];else{if(i==null)return o;s=t[r+(+!!(512&e)-1)]={},o|=256}return s[n]=i,n<r&&(t[n+(+!!(512&e)-1)]=void 0),o!==e&&Hn(t,o),o}return t[n+(+!!(512&e)-1)]=i,256&e&&n in(t=t[t.length-1])&&delete t[n],e}function yp(t,e,n,i,r){var s=2&e;r=ma(t,e,n,r),Array.isArray(r)||(r=AA);const o=!(2&i);i=!(1&i);const a=!!(32&e);let l=Wn(r);return l!==0||!a||s||o?1&l||(l|=1,Hn(r,l)):(l|=33,Hn(r,l)),s?(t=!1,2&l||(Yu(r),t=!!(4&l)),(i||t)&&Object.freeze(r)):(s=!!(2&l)||!!(2048&l),i&&s?(r=Cs(r),s=1,a&&!o&&(s|=32),Hn(r,s),On(t,e,n,r)):o&&32&l&&!s&&$1(r,32)),r}function Vy(t,e){t=t.u;let n=un(t);const i=ma(t,n,e),r=_c(i);return r!=null&&r!==i&&On(t,n,e,r),r}function W6(t){t=t.u;let e=un(t);const n=ma(t,e,1),i=PA(n,!0,!!(34&e));return i!=null&&i!==n&&On(t,e,1,i),i}function du(){return Bhe===void 0?2:5}function pu(t,e,n,i,r,s){const o=t.u;let a=un(o);i=2&a?1:i,s=!!s,r=G6(o,a,e,r);var l=Wn(r),c=r;if(q1(c,t),i!==2&&i!==1||a0(c,t),j6(t,l,void 0)){4&l&&(r=Cs(r),l=Fu(l,a),a=On(o,a,e,r));let h=c=0;for(;c<r.length;c++){const d=n(r[c]);d!=null&&(r[h++]=d)}h<c&&(r.length=h),l=-4097&(20|(l=q6(l,a))),Hn(r,l&=-8193),2&l&&Object.freeze(r)}let u;return i===1||i===4&&32&l?La(l)||(t=l,(l|=2)!==t&&Hn(r,l),Object.freeze(r)):(n=i===5&&(!!(32&l)||La(l)||!!(ur!=null&&ur.get(r))),(i===2||n)&&La(l)&&(r=Cs(r),l=Hd(l=Fu(l,a),a,s),Hn(r,l),a=On(o,a,e,r)),La(l)||(e=l,(l=Hd(l,a,s))!==e&&Hn(r,l)),n?(u=F6(r),FA(r,t,!0)):i!==2||s||(ur==null||ur.delete(r))),u||r}function G6(t,e,n,i){return t=ma(t,e,n,i),Array.isArray(t)?t:AA}function q6(t,e){return t===0&&(t=Fu(t,e)),1|t}function La(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function X6(t){t=Cs(t);for(let e=0;e<t.length;e++){const n=t[e]=Cs(t[e]);Array.isArray(n[1])&&(n[1]=Yu(n[1]))}return t}function bT(t,e,n,i){t=t.u;let r=un(t);nl(r),On(t,r,e,(i==="0"?Number(n)===0:n===i)?void 0:n)}function Yw(t,e){var n=O$;return HA($A(t=t.u),t,un(t),n)===e?e:-1}function $A(t){if(mp)return t[Hm]??(t[Hm]=new Map);if(Hm in t)return t[Hm];const e=new Map;return Object.defineProperty(t,Hm,{value:e}),e}function K6(t,e,n,i){const r=$A(t),s=HA(r,t,e,n);return s!==i&&(s&&(e=On(t,e,s)),r.set(n,i)),e}function HA(t,e,n,i){let r=t.get(i);if(r!=null)return r;r=0;for(let s=0;s<i.length;s++){const o=i[s];ma(e,n,o)!=null&&(r!==0&&(n=On(e,n,r)),r=o)}return t.set(i,r),r}function VA(t,e,n,i){let r,s=un(t);if((i=ma(t,s,n,i))!=null&&i.X===V0)return(e=mC(i))!==i&&On(t,s,n,e),e.u;if(Array.isArray(i)){const o=Wn(i);r=2&o?Ql(V6(i,o,!1),e,!0):64&o?i:Ql(r,e,!0)}else r=Ql(void 0,e,!0);return r!==i&&On(t,s,n,r),r}function Y6(t,e,n,i){t=t.u;let r=un(t);return(e=OA(i=ma(t,r,n,i),e,!1,r))!==i&&e!=null&&On(t,r,n,e),e}function Jt(t,e,n,i=!1){if((e=Y6(t,e,n,i))==null)return e;if(t=t.u,!(2&(i=un(t)))){const r=mC(e);r!==e&&On(t,i,n,e=r)}return e}function J6(t,e,n,i,r,s,o){const a=t.u;var l=!!(2&e);r=l?1:r,s=!!s,o&&(o=!l),l=G6(a,e,i);var c=Wn(l),u=l;if(q1(u,t),r!==2&&r!==1||a0(u,t),!(u=!!(4&c))){var h=l,d=e;const f=!!(2&(c=q6(c,e)));f&&(d|=2);let v=!f,g=!0,m=0,y=0;for(;m<h.length;m++){const S=OA(h[m],n,!1,d);if(S instanceof n){if(!f){const x=!!(2&Wn(S.u));v&&(v=!x),g&&(g=x)}h[y++]=S}}y<m&&(h.length=y),c|=4,c=g?16|c:-17&c,Hn(h,c=v?8|c:-9&c),f&&Object.freeze(h)}if(o&&!(8&c||!l.length&&(r===1||r===4&&32&c))){for(La(c)?(l=Cs(l),c=Fu(c,e),e=On(a,e,i,l)):a0(l,t),n=l,o=c,h=0;h<n.length;h++)(c=n[h])!==(d=mC(c))&&(n[h]=d);o|=8,o=n.length?-17&o:16|o,Hn(n,o),c=o}let p;return r===1||r===4&&32&c?La(c)||(t=c,(c|=!l.length||16&c&&(!u||32&c)?2:2048)!==t&&Hn(l,c),Object.freeze(l)):(u=r===5&&(!!(32&c)||La(c)||!!(ur!=null&&ur.get(l))),(r===2||u)&&La(c)&&(l=Cs(l),c=Hd(c=Fu(c,e),e,s),Hn(l,c),e=On(a,e,i,l)),La(c)||(i=c,(c=Hd(c,e,s))!==i&&Hn(l,c)),u?(p=F6(l),FA(l,t,!0)):r!==2||s||(ur==null||ur.delete(l))),p||l}function Za(t,e,n){const i=un(t.u);return J6(t,i,e,n,du(),!1,!(2&i))}function lt(t,e,n,i){return i==null&&(i=void 0),Cn(t,n,i)}function Eg(t,e,n,i){i==null&&(i=void 0);e:{t=t.u;let r=un(t);if(nl(r),i==null){const s=$A(t);if(HA(s,t,r,n)!==e)break e;s.set(n,0)}else r=K6(t,r,n,e);On(t,r,e,i)}}function Fu(t,e){return-2049&(t=32|(2&e?2|t:-3&t))}function Hd(t,e,n){return 32&e&&n||(t&=-33),t}function X1(t,e,n,i){const r=un(t.u);nl(r),t=J6(t,r,n,e,2,!0),i=i??new n,t.push(i),2&Wn(i.u)?$1(t,8):$1(t,16)}function Io(t,e){return t??e}function $s(t,e){return gp(oc(t,e))}function ti(t,e){return Io(Vy(t,e),0)}function la(t,e){return Io(Jl(oc(t,e)),"")}function l0(t,e,n){if(n!=null&&typeof n!="boolean")throw t=typeof n,Error(`Expected boolean but got ${t!="object"?t:n?Array.isArray(n)?"array":t:"null"}: ${n}`);Cn(t,e,n)}function ca(t,e,n){if(n!=null){if(typeof n!="number"||!Number.isFinite(n))throw wT("int32");n|=0}Cn(t,e,n)}function tt(t,e,n){if(n!=null&&typeof n!="number")throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);Cn(t,e,n)}function K1(t,e,n){{const a=t.u;let l=un(a);if(nl(l),n==null)On(a,l,e);else{n=(Hy==null?void 0:Hy.get(n))||n;var i,r=Wn(n),s=r,o=!!(2&r)||Object.isFrozen(n);if((i=!o)&&((i=Hhe===void 0)||(i=!!khe&&$he!==void 0)),j6(t,r)){r=21,o&&(n=Cs(n),s=0,r=Hd(r=Fu(r,l),l,!0));for(let c=0;c<n.length;c++)n[c]=O6(n[c])}i?(n=Cs(n),s=0,r=Hd(r=Fu(r,l),l,!0)):o||FA(n,t),r!==s&&Hn(n,r),On(a,l,e,n)}}}function gC(t,e,n){nl(un(t.u)),pu(t,e,Jl,2,void 0,!0).push(O6(n))}function Q6(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function jA(){return Error("Failed to read varint, encoding is invalid.")}function Z6(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function WA(t){if(typeof t=="string")return{buffer:P6(t),O:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),O:!1};if(t.constructor===Uint8Array)return{buffer:t,O:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),O:!1};if(t.constructor===Va)return{buffer:TA(t)||new Uint8Array(0),O:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),O:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function GA(t,e){let n,i=0,r=0,s=0;const o=t.h;let a=t.g;do n=o[a++],i|=(127&n)<<s,s+=7;while(s<32&&128&n);for(s>32&&(r|=(127&n)>>4),s=3;s<32&&128&n;s+=7)n=o[a++],r|=(127&n)<<s;if(xu(t,a),n<128)return e(i>>>0,r>>>0);throw jA()}function qA(t){let e=0,n=t.g;const i=n+10,r=t.h;for(;n<i;){const s=r[n++];if(e|=s,(128&s)==0)return xu(t,n),!!(127&e)}throw jA()}function ac(t){const e=t.h;let n=t.g,i=e[n++],r=127&i;if(128&i&&(i=e[n++],r|=(127&i)<<7,128&i&&(i=e[n++],r|=(127&i)<<14,128&i&&(i=e[n++],r|=(127&i)<<21,128&i&&(i=e[n++],r|=i<<28,128&i&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw jA();return xu(t,n),r}function lc(t){return ac(t)>>>0}function AT(t){var e=t.h;const n=t.g,i=e[n],r=e[n+1],s=e[n+2];return e=e[n+3],xu(t,t.g+4),(i<<0|r<<8|s<<16|e<<24)>>>0}function PT(t){var e=AT(t);t=2*(e>>31)+1;const n=e>>>23&255;return e&=8388607,n==255?e?NaN:t*(1/0):n==0?1401298464324817e-60*t*e:t*Math.pow(2,n-150)*(e+8388608)}function lde(t){return ac(t)}function Jw(t,e,{ca:n=!1}={}){t.ca=n,e&&(e=WA(e),t.h=e.buffer,t.m=e.O,t.j=0,t.l=t.h.length,t.g=t.j)}function xu(t,e){if(t.g=e,e>t.l)throw Z6(t.l,e)}function e$(t,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,i=n+e;if(i>t.l)throw Z6(e,t.l-n);return t.g=i,n}function t$(t,e){if(e==0)return Ou();var n=e$(t,e);return t.ca&&t.m?n=t.h.subarray(n,n+e):(t=t.h,n=n===(e=n+e)?new Uint8Array(0):Khe?t.slice(n,e):new Uint8Array(t.subarray(n,e))),n.length==0?Ou():new Va(n,Bd)}Js.prototype.toJSON=void 0,Js.prototype.Ja=k6;var VN=[];function n$(t){var e=t.g;if(e.g==e.l)return!1;t.l=t.g.g;var n=lc(t.g);if(e=n>>>3,!((n&=7)>=0&&n<=5))throw Q6(n,t.l);if(e<1)throw Error(`Invalid field number: ${e} (at position ${t.l})`);return t.m=e,t.h=n,!0}function jy(t){switch(t.h){case 0:t.h!=0?jy(t):qA(t.g);break;case 1:xu(t=t.g,t.g+8);break;case 2:if(t.h!=2)jy(t);else{var e=lc(t.g);xu(t=t.g,t.g+e)}break;case 5:xu(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!n$(t))throw Error("Unmatched start-group tag: stream EOF");if(t.h==4){if(t.m!=e)throw Error("Unmatched end-group tag");break}jy(t)}break;default:throw Q6(t.h,t.l)}}function j0(t,e,n){const i=t.g.l,r=lc(t.g),s=t.g.g+r;let o=s-i;if(o<=0&&(t.g.l=s,n(e,t,void 0,void 0,void 0),o=s-t.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${r} bytes, instead read ${r-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return t.g.g=s,t.g.l=i,e}function XA(t){var e=lc(t.g),n=e$(t=t.g,e);if(t=t.h,Phe){var i,r=t;(i=jw)||(i=jw=new TextDecoder("utf-8",{fatal:!0})),e=n+e,r=n===0&&e===r.length?r:r.subarray(n,e);try{var s=i.decode(r)}catch(a){if(iy===void 0){try{i.decode(new Uint8Array([128]))}catch{}try{i.decode(new Uint8Array([97])),iy=!0}catch{iy=!1}}throw!iy&&(jw=void 0),a}}else{e=(s=n)+e,n=[];let a,l=null;for(;s<e;){var o=t[s++];o<128?n.push(o):o<224?s>=e?qc():(a=t[s++],o<194||(192&a)!=128?(s--,qc()):n.push((31&o)<<6|63&a)):o<240?s>=e-1?qc():(a=t[s++],(192&a)!=128||o===224&&a<160||o===237&&a>=160||(192&(i=t[s++]))!=128?(s--,qc()):n.push((15&o)<<12|(63&a)<<6|63&i)):o<=244?s>=e-2?qc():(a=t[s++],(192&a)!=128||a-144+(o<<28)>>30||(192&(i=t[s++]))!=128||(192&(r=t[s++]))!=128?(s--,qc()):(o=(7&o)<<18|(63&a)<<12|(63&i)<<6|63&r,o-=65536,n.push(55296+(o>>10&1023),56320+(1023&o)))):qc(),n.length>=8192&&(l=bN(l,n),n.length=0)}s=bN(l,n)}return s}function i$(t){const e=lc(t.g);return t$(t.g,e)}function vC(t,e,n){var i=lc(t.g);for(i=t.g.g+i;t.g.g<i;)n.push(e(t.g))}var ry=[];let Y1;function Oo(t,e,n){e.g?e.m(t,e.g,e.h,n,!0):e.m(t,e.h,n,!0)}var Ye=class{constructor(t,e){this.u=H6(t,e)}toJSON(){return r$(this)}l(){var t=Vde;return t.g?t.l(this,t.g,t.h,!0):t.l(this,t.h,t.defaultValue,!0)}clone(){const t=this.u;return BA(this,t,un(t),!1)}O(){return!!(2&Wn(this.u))}};function r$(t){pC(t),t=Y1?t.u:fC(t.u,UA,void 0,void 0,!1);{var e=!Y1;let c=t.length;if(c){var n=t[c-1],i=lC(n);i?c--:n=void 0;var r=t;if(i){e:{var s,o=n,a=!1;if(o)for(let u in o)isNaN(+u)?(s??(s={}))[u]=o[u]:(i=o[u],Array.isArray(i)&&(H1(i)||kN(i)&&i.size===0)&&(i=null),i==null&&(a=!0),i!=null&&((s??(s={}))[u]=i));if(a||(s=o),s)for(let u in s){a=s;break e}a=null}o=a==null?n!=null:a!==n}for(;c>0&&((s=r[c-1])==null||H1(s)||kN(s)&&s.size===0);c--)var l=!0;(r!==t||o||l)&&(e?(l||o||a)&&(r.length=c):r=Array.prototype.slice.call(r,0,c),a&&r.push(a)),l=r}else l=t}return l}function jN(t){return t?/^\d+$/.test(t)?(hC(t),new IT(vn,Kn)):null:cde||(cde=new IT(0,0))}Ye.prototype.X=V0,Ye.prototype.toString=function(){try{return Y1=!0,r$(this).toString()}finally{Y1=!1}};var IT=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let cde;function WN(t){return t?/^-?\d+$/.test(t)?(hC(t),new MT(vn,Kn)):null:ude||(ude=new MT(0,0))}var MT=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let ude;function gd(t,e,n){for(;n>0||e>127;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function W0(t,e){for(;e>127;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function yC(t,e){if(e>=0)W0(t,e);else{for(let n=0;n<9;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function c0(t,e){t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function Vd(t,e){e.length!==0&&(t.l.push(e),t.h+=e.length)}function eo(t,e,n){W0(t.g,8*e+n)}function KA(t,e){return eo(t,e,2),e=t.g.end(),Vd(t,e),e.push(t.h),e}function YA(t,e){var n=e.pop();for(n=t.h+t.g.length()-n;n>127;)e.push(127&n|128),n>>>=7,t.h++;e.push(n),t.h++}function SC(t,e,n){eo(t,e,2),W0(t.g,n.length),Vd(t,t.g.end()),Vd(t,n)}function J1(t,e,n,i){n!=null&&(e=KA(t,e),i(n,t),YA(t,e))}function Fo(){const t=class{constructor(){throw Error()}};return Object.setPrototypeOf(t,t.prototype),t}var JA=Fo(),s$=Fo(),QA=Fo(),ZA=Fo(),o$=Fo(),eP=Fo(),a$=Fo(),l$=Fo(),Sp=class{constructor(t,e,n){this.g=t,this.h=e,t=JA,this.l=!!t&&n===t||!1}};function xC(t,e){return new Sp(t,e,JA)}function c$(t,e,n,i,r){J1(t,n,p$(e,i),r)}const hde=xC(function(t,e,n,i,r){return t.h===2&&(j0(t,VA(e,i,n),r),!0)},c$),dde=xC(function(t,e,n,i,r){return t.h===2&&(j0(t,VA(e,i,n,!0),r),!0)},c$);var CC=Symbol(),tP=Symbol(),GN=Symbol(),qN=Symbol();let u$,h$;function Ju(t,e,n,i){var r=i[t];if(r)return r;(r={}).W=function(h){switch(typeof h){case"boolean":return z6||(z6=[0,void 0,!0]);case"number":return h>0?void 0:h===0?ede||(ede=[0,void 0]):[-h,void 0];case"string":return[0,h];case"object":return h}}(i[0]);var s=i[1];let o=1;s&&s.constructor===Object&&(r.ia=s,typeof(s=i[++o])=="function"&&(r.na=!0,u$??(u$=s),h$??(h$=i[o+1]),s=i[o+=2]));const a={};for(;s&&Array.isArray(s)&&s.length&&typeof s[0]=="number"&&s[0]>0;){for(var l=0;l<s.length;l++)a[s[l]]=s;s=i[++o]}for(l=1;s!==void 0;){let h;typeof s=="number"&&(l+=s,s=i[++o]);var c=void 0;if(s instanceof Sp?h=s:(h=hde,o--),h==null?void 0:h.l){s=i[++o],c=i;var u=o;typeof s=="function"&&(s=s(),c[u]=s),c=s}for(u=l+1,typeof(s=i[++o])=="number"&&s<0&&(u-=s,s=i[++o]);l<u;l++){const d=a[l];c?n(r,l,h,c,d):e(r,l,h,d)}}return i[t]=r}function d$(t){return Array.isArray(t)?t[0]instanceof Sp?t:[dde,t]:[t,void 0]}function p$(t,e){return t instanceof Ye?(pC(t),t.u):Array.isArray(t)?Ql(t,e,!1):void 0}function nP(t,e,n,i){const r=n.g;t[e]=i?(s,o,a)=>r(s,o,a,i):r}function iP(t,e,n,i,r){const s=n.g;let o,a;t[e]=(l,c,u)=>s(l,c,u,a||(a=Ju(tP,nP,iP,i).W),o||(o=rP(i)),r)}function rP(t){let e=t[GN];if(e!=null)return e;const n=Ju(tP,nP,iP,t);return e=n.na?(i,r)=>u$(i,r,n):(i,r)=>{const s=un(i);for(;n$(r)&&r.h!=4;){var o=r.m,a=n[o];if(a==null){var l=n.ia;l&&(l=l[o])&&(l=pde(l))!=null&&(a=n[o]=l)}a!=null&&a(r,i,o)||(o=(a=r).l,jy(a),a.ha?a=void 0:(l=a.g.g-o,a.g.g=o,a=t$(a.g,l)),o=i,a&&(Yl||(Yl=Symbol()),(l=o[Yl])?l.push(a):o[Yl]=[a]))}return 16384&s&&Yu(i),!0},t[GN]=e}function pde(t){const e=(t=d$(t))[0].g;if(t=t[1]){const n=rP(t),i=Ju(tP,nP,iP,t).W;return(r,s,o)=>e(r,s,o,i,n)}return e}function _C(t,e,n){t[e]=n.h}function wC(t,e,n,i){let r,s;const o=n.h;t[e]=(a,l,c)=>o(a,l,c,s||(s=Ju(CC,_C,wC,i).W),r||(r=f$(i)))}function f$(t){let e=t[qN];if(!e){const n=Ju(CC,_C,wC,t);e=(i,r)=>m$(i,r,n),t[qN]=e}return e}function m$(t,e,n){for(var i=Wn(t),r=+!!(512&i)-1,s=t.length,o=512&i?1:0,a=s+(256&i?-1:0);o<a;o++){const l=t[o];if(l==null)continue;const c=o-r,u=XN(n,c);u&&u(e,l,c)}if(256&i){i=t[s-1];for(const l in i)r=+l,Number.isNaN(r)||(s=i[r])!=null&&(a=XN(n,r))&&a(e,s,r)}if(t=Yl?t[Yl]:void 0)for(Vd(e,e.g.end()),n=0;n<t.length;n++)Vd(e,TA(t[n])||new Uint8Array(0))}function XN(t,e){var n=t[e];if(n)return n;if((n=t.ia)&&(n=n[e])){var i=(n=d$(n))[0].h;if(n=n[1]){const r=f$(n),s=Ju(CC,_C,wC,n).W;n=t.na?h$(s,r):(o,a,l)=>i(o,a,l,s,r)}else n=i;return t[e]=n}}function xp(t,e){if(Array.isArray(e)){var n=Wn(e);if(4&n)return e;for(var i=0,r=0;i<e.length;i++){const s=t(e[i]);s!=null&&(e[r++]=s)}return r<i&&(e.length=r),Hn(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}function Kr(t,e,n){return new Sp(t,e,n)}function Cp(t,e,n){return new Sp(t,e,n)}function Yr(t,e,n){On(t,un(t),e,n)}var fde=xC(function(t,e,n,i,r){return t.h===2&&(t=j0(t,Ql([void 0,void 0],i,!0),r),nl(i=un(e)),(r=ma(e,i,n))instanceof Js?2&r.M?((r=r.Y()).push(t),On(e,i,n,r)):r.Oa(t):Array.isArray(r)?(2&Wn(r)&&On(e,i,n,r=X6(r)),r.push(t)):On(e,i,n,[t]),!0)},function(t,e,n,i,r){if(e instanceof Js)e.forEach((s,o)=>{J1(t,n,Ql([o,s],i,!1),r)});else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&J1(t,n,Ql(o,i,!1),r)}});function g$(t,e,n){if(e=function(i){if(i==null)return i;const r=typeof i;if(r==="bigint")return String(BigInt.asIntN(64,i));if(dC(i)){if(r==="string")return NA(i);if(r==="number")return DA(i)}}(e),e!=null&&(typeof e=="string"&&WN(e),e!=null))switch(eo(t,n,0),typeof e){case"number":t=t.g,$d(e),gd(t,vn,Kn);break;case"bigint":n=BigInt.asUintN(64,e),n=new MT(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),gd(t.g,n.h,n.g);break;default:n=WN(e),gd(t.g,n.h,n.g)}}function v$(t,e,n){(e=gp(e))!=null&&e!=null&&(eo(t,n,0),yC(t.g,e))}function y$(t,e,n){(e=N6(e))!=null&&(eo(t,n,0),t.g.g.push(e?1:0))}function S$(t,e,n){(e=Jl(e))!=null&&SC(t,n,w6(e))}function x$(t,e,n,i,r){J1(t,n,p$(e,i),r)}function C$(t,e,n){(e=e==null||typeof e=="string"||$0(e)||e instanceof Va?e:void 0)!=null&&SC(t,n,WA(e).buffer)}function _$(t,e,n){return(t.h===5||t.h===2)&&(e=yp(e,un(e),n,2,!1),t.h==2?vC(t,PT,e):e.push(PT(t.g)),!0)}var ka=Kr(function(t,e,n){if(t.h!==1)return!1;var i=t.g;t=AT(i);const r=AT(i);i=2*(r>>31)+1;const s=r>>>20&2047;return t=4294967296*(1048575&r)+t,Yr(e,n,s==2047?t?NaN:i*(1/0):s==0?5e-324*i*t:i*Math.pow(2,s-1075)*(t+4503599627370496)),!0},function(t,e,n){(e=_c(e))!=null&&(eo(t,n,1),t=t.g,(n=D6||(D6=new DataView(new ArrayBuffer(8)))).setFloat64(0,+e,!0),vn=n.getUint32(0,!0),Kn=n.getUint32(4,!0),c0(t,vn),c0(t,Kn))},Fo()),Ci=Kr(function(t,e,n){return t.h===5&&(Yr(e,n,PT(t.g)),!0)},function(t,e,n){(e=_c(e))!=null&&(eo(t,n,5),t=t.g,IA(e),c0(t,vn))},eP),mde=Cp(_$,function(t,e,n){if((e=xp(_c,e))!=null)for(let o=0;o<e.length;o++){var i=t,r=n,s=e[o];s!=null&&(eo(i,r,5),i=i.g,IA(s),c0(i,vn))}},eP),sP=Cp(_$,function(t,e,n){if((e=xp(_c,e))!=null&&e.length){eo(t,n,2),W0(t.g,4*e.length);for(let i=0;i<e.length;i++)n=t.g,IA(e[i]),c0(n,vn)}},eP),cc=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,GA(t.g,kA)),!0)},g$,o$),Qw=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,(t=GA(t.g,kA))===0?void 0:t),!0)},g$,o$),gde=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,GA(t.g,MA)),!0)},function(t,e,n){if((e=Qhe(e))!=null&&(typeof e=="string"&&jN(e),e!=null))switch(eo(t,n,0),typeof e){case"number":t=t.g,$d(e),gd(t,vn,Kn);break;case"bigint":n=BigInt.asUintN(64,e),n=new IT(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),gd(t.g,n.h,n.g);break;default:n=jN(e),gd(t.g,n.h,n.g)}},Fo()),Yn=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,ac(t.g)),!0)},v$,ZA),EC=Cp(function(t,e,n){return(t.h===0||t.h===2)&&(e=yp(e,un(e),n,2,!1),t.h==2?vC(t,ac,e):e.push(ac(t.g)),!0)},function(t,e,n){if((e=xp(gp,e))!=null&&e.length){n=KA(t,n);for(let i=0;i<e.length;i++)yC(t.g,e[i]);YA(t,n)}},ZA),ed=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,(t=ac(t.g))===0?void 0:t),!0)},v$,ZA),Bn=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,qA(t.g)),!0)},y$,s$),Rg=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,(t=qA(t.g))===!1?void 0:t),!0)},y$,s$),sr=Cp(function(t,e,n){if(t.h!==2)return!1;t=XA(t);const i=un(e);return nl(i),yp(e,i,n,2).push(t),!0},function(t,e,n){if((e=xp(Jl,e))!=null)for(let o=0;o<e.length;o++){var i=t,r=n,s=e[o];s!=null&&SC(i,r,w6(s))}},QA),Il=Kr(function(t,e,n){return t.h===2&&(Yr(e,n,(t=XA(t))===""?void 0:t),!0)},S$,QA),ln=Kr(function(t,e,n){return t.h===2&&(Yr(e,n,XA(t)),!0)},S$,QA),vi=function(t,e,n=JA){return new Sp(t,e,n)}(function(t,e,n,i,r){if(t.h!==2)return!1;i=Ql(void 0,i,!0);let s=un(e);nl(s);let o=yp(e,s,n,3);return s=un(e),4&Wn(o)&&(o=Cs(o),Hn(o,-2079&(1|Wn(o))),On(e,s,n,o)),o.push(i),j0(t,i,r),!0},function(t,e,n,i,r){if(Array.isArray(e))for(let s=0;s<e.length;s++)x$(t,e[s],n,i,r)}),dn=xC(function(t,e,n,i,r,s){return t.h===2&&(K6(e,Wn(e),s,n),j0(t,e=VA(e,i,n),r),!0)},x$),w$=Kr(function(t,e,n){return t.h===2&&(Yr(e,n,i$(t)),!0)},C$,a$),vde=Cp(function(t,e,n){return(t.h===0||t.h===2)&&(e=yp(e,un(e),n,2,!1),t.h==2?vC(t,lc,e):e.push(lc(t.g)),!0)},function(t,e,n){if((e=xp(Jhe,e))!=null)for(let o=0;o<e.length;o++){var i=t,r=n,s=e[o];s!=null&&(eo(i,r,0),W0(i.g,s))}},Fo()),Mo=Kr(function(t,e,n){return t.h===0&&(Yr(e,n,ac(t.g)),!0)},function(t,e,n){(e=gp(e))!=null&&(e=parseInt(e,10),eo(t,n,0),yC(t.g,e))},l$);class yde{constructor(e,n){this.h=e,this.g=n,this.l=Jt,this.m=lt,this.defaultValue=void 0}}function zo(t,e){return new yde(t,e)}function wc(t,e){return(n,i)=>{if(ry.length){const s=ry.pop();s.o(i),Jw(s.g,n,i),n=s}else n=new class{constructor(s,o){if(VN.length){const a=VN.pop();Jw(a,s,o),s=a}else s=new class{constructor(a,l){this.h=null,this.m=!1,this.g=this.l=this.j=0,Jw(this,a,l)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ca=!1}}(s,o);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(o)}o({ha:s=!1}={}){this.ha=s}}(n,i);try{const s=new t,o=s.u;rP(e)(o,n);var r=s}finally{n.g.clear(),n.m=-1,n.h=-1,ry.length<100&&ry.push(n)}return r}}function RC(t){return function(){pC(this);const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const o=this.g;return this.g=[],o}}}};m$(this.u,e,Ju(CC,_C,wC,t)),Vd(e,e.g.end());const n=new Uint8Array(e.h),i=e.l,r=i.length;let s=0;for(let o=0;o<r;o++){const a=i[o];n.set(a,s),s+=a.length}return e.l=[n],n}}var KN=class extends Ye{constructor(t){super(t)}},YN=[0,Il,Kr(function(t,e,n){return t.h===2&&(Yr(e,n,(t=i$(t))===Ou()?void 0:t),!0)},function(t,e,n){if(e!=null){if(e instanceof Ye){const i=e.Ra;return void(i&&(e=i(e),e!=null&&SC(t,n,WA(e).buffer)))}if(Array.isArray(e))return}C$(t,e,n)},a$)];let Zw,JN=globalThis.trustedTypes;function QN(t){Zw===void 0&&(Zw=function(){let n=null;if(!JN)return n;try{const i=r=>r;n=JN.createPolicy("goog#html",{createHTML:i,createScript:i,createScriptURL:i})}catch{}return n}());var e=Zw;return new class{constructor(n){this.g=n}toString(){return this.g+""}}(e?e.createScriptURL(t):t)}function Sde(t,...e){if(e.length===0)return QN(t[0]);let n=t[0];for(let i=0;i<e.length;i++)n+=encodeURIComponent(e[i])+t[i+1];return QN(n)}var E$=[0,Yn,Mo,Bn,-1,EC,Mo,-1],xde=class extends Ye{constructor(){super()}},R$=[0,Bn,ln,Bn,Mo,-1,Cp(function(t,e,n){return(t.h===0||t.h===2)&&(e=yp(e,un(e),n,2,!1),t.h==2?vC(t,lde,e):e.push(ac(t.g)),!0)},function(t,e,n){if((e=xp(gp,e))!=null&&e.length){n=KA(t,n);for(let i=0;i<e.length;i++)yC(t.g,e[i]);YA(t,n)}},l$),ln,-1,[0,Bn,-1],Mo,Bn,-1],T$=[0,ln,-2],ZN=class extends Ye{constructor(){super()}},b$=[0],A$=[0,Yn,Bn,1,Bn,-3],_s=class extends Ye{constructor(t){super(t,2)}},hi={};hi[336783863]=[0,ln,Bn,-1,Yn,[0,[1,2,3,4,5,6,7],dn,b$,dn,R$,dn,T$,dn,A$,dn,E$,dn,[0,ln,-2],dn,[0,ln,Mo]],[0,ln],Bn,[0,[1,3],[2,4],dn,[0,EC],-1,dn,[0,sr],-1,vi,[0,ln,-1]],ln];var eO=[0,Qw,-1,Rg,-3,Qw,EC,Il,ed,Qw,-1,Rg,ed,Rg,-2,Il];function Rs(t,e){bT(t,2,vp(e),"")}function En(t,e){gC(t,3,e)}function jt(t,e){gC(t,4,e)}var Ar=class extends Ye{constructor(t){super(t,500)}o(t){return lt(this,0,7,t)}},Tg=[-1,{}],tO=[0,ln,1,Tg],nO=[0,ln,sr,Tg];function Ts(t,e){X1(t,1,Ar,e)}function kn(t,e){gC(t,10,e)}function tn(t,e){gC(t,15,e)}var Jr=class extends Ye{constructor(t){super(t,500)}o(t){return lt(this,0,1001,t)}},P$=[-500,vi,[-500,Il,-1,sr,-3,[-2,hi,Bn],vi,YN,ed,-1,tO,nO,vi,[0,Il,Rg],Il,eO,ed,sr,987,sr],4,vi,[-500,ln,-1,[-1,{}],998,ln],vi,[-500,ln,sr,-1,[-2,{},Bn],997,sr,-1],ed,vi,[-500,ln,sr,Tg,998,sr],sr,ed,tO,nO,vi,[0,Il,-1,Tg],sr,-2,eO,Il,-1,Rg,979,Tg,vi,YN];Jr.prototype.g=RC(P$);var Cde=wc(Jr,P$),_de=class extends Ye{constructor(t){super(t)}},I$=class extends Ye{constructor(t){super(t)}g(){return Za(this,_de,1)}},M$=[0,vi,[0,Yn,Ci,ln,-1]],TC=wc(I$,M$),wde=class extends Ye{constructor(t){super(t)}},Ede=class extends Ye{constructor(t){super(t)}},eE=class extends Ye{constructor(t){super(t)}h(){return Jt(this,wde,2)}g(){return Za(this,Ede,5)}},k$=wc(class extends Ye{constructor(t){super(t)}},[0,sr,EC,sP,[0,Mo,[0,Yn,-3],[0,Ci,-3],[0,Yn,-1,[0,vi,[0,Yn,-2]]],vi,[0,Ci,-1,ln,Ci]],ln,-1,cc,vi,[0,Yn,Ci],sr,cc]),L$=class extends Ye{constructor(t){super(t)}},vd=wc(class extends Ye{constructor(t){super(t)}},[0,vi,[0,Ci,-4]]),D$=class extends Ye{constructor(t){super(t)}},G0=wc(class extends Ye{constructor(t){super(t)}},[0,vi,[0,Ci,-4]]),Rde=class extends Ye{constructor(t){super(t)}},Tde=[0,Yn,-1,sP,Mo],N$=class extends Ye{constructor(){super()}};N$.prototype.g=RC([0,Ci,-4,cc]);var bde=class extends Ye{constructor(t){super(t)}},Ade=wc(class extends Ye{constructor(t){super(t)}},[0,vi,[0,1,Yn,ln,M$],cc]),iO=class extends Ye{constructor(t){super(t)}},Pde=class extends Ye{constructor(t){super(t)}qa(){const t=W6(this);return t??Ou()}},Ide=class extends Ye{constructor(t){super(t)}},O$=[1,2],Mde=wc(class extends Ye{constructor(t){super(t)}},[0,vi,[0,O$,dn,[0,sP],dn,[0,w$],Yn,ln],cc]),oP=class extends Ye{constructor(t){super(t)}},F$=[0,ln,Yn,Ci,sr,-1],rO=class extends Ye{constructor(t){super(t)}},kde=[0,Bn,-1],sO=class extends Ye{constructor(t){super(t)}},Wy=[1,2,3,4,5],Q1=class extends Ye{constructor(t){super(t)}g(){return W6(this)!=null}h(){return Jl(oc(this,2))!=null}},Fn=class extends Ye{constructor(t){super(t)}g(){return N6(oc(this,2))??!1}},z$=[0,w$,ln,[0,Yn,cc,-1],[0,gde,cc]],ri=[0,z$,Bn,[0,Wy,dn,A$,dn,R$,dn,E$,dn,b$,dn,T$],Mo],bC=class extends Ye{constructor(t){super(t)}},aP=[0,ri,Ci,-1,Yn],Lde=zo(502141897,bC);hi[502141897]=aP;var Dde=wc(class extends Ye{constructor(t){super(t)}},[0,[0,Mo,-1,mde,vde],Tde]),U$=class extends Ye{constructor(t){super(t)}},B$=class extends Ye{constructor(t){super(t)}},lP=[0,ri,Ci,[0,ri],Bn],$$=[0,ri,aP,lP,Ci,[0,[0,z$]]],Nde=zo(508968150,B$);hi[508968150]=$$,hi[508968149]=lP;var H$=class extends Ye{constructor(t){super(t)}},Ode=zo(513916220,H$);hi[513916220]=[0,ri,$$,Yn];var Mh=class extends Ye{constructor(t){super(t)}h(){return Jt(this,oP,2)}g(){Cn(this,2)}},V$=[0,ri,F$];hi[478825465]=V$;var Fde=class extends Ye{constructor(t){super(t)}},j$=class extends Ye{constructor(t){super(t)}},cP=class extends Ye{constructor(t){super(t)}},uP=class extends Ye{constructor(t){super(t)}},W$=class extends Ye{constructor(t){super(t)}},oO=[0,ri,[0,ri],V$,-1],G$=[0,ri,Ci,Yn],hP=[0,ri,Ci],q$=[0,ri,G$,hP,Ci],zde=zo(479097054,W$);hi[479097054]=[0,ri,q$,oO],hi[463370452]=oO,hi[464864288]=G$;var Ude=zo(462713202,uP);hi[462713202]=q$,hi[474472470]=hP;var Bde=class extends Ye{constructor(t){super(t)}},X$=class extends Ye{constructor(t){super(t)}},K$=class extends Ye{constructor(t){super(t)}},Y$=class extends Ye{constructor(){super()}},dP=[0,ri,Ci,-1,Yn],kT=[0,ri,Ci,Bn];Y$.prototype.g=RC([0,ri,hP,[0,ri],aP,lP,dP,kT]);var J$=class extends Ye{constructor(t){super(t)}},$de=zo(456383383,J$);hi[456383383]=[0,ri,F$];var Q$=class extends Ye{constructor(t){super(t)}},Hde=zo(476348187,Q$);hi[476348187]=[0,ri,kde];var Z$=class extends Ye{constructor(t){super(t)}},aO=class extends Ye{constructor(t){super(t)}},e8=[0,Mo,-1],Vde=zo(458105876,class extends Ye{constructor(t){super(t)}g(){var t=this.u;const e=un(t),n=2&e;return t=function(i,r,s){var o=aO;const a=2&r;let l=!1;if(s==null){if(a)return $N();s=[]}else if(s.constructor===Js){if(!(2&s.M)||a)return s;s=s.Y()}else Array.isArray(s)?l=!!(2&Wn(s)):s=[];if(a){if(!s.length)return $N();l||(l=!0,Yu(s))}else l&&(l=!1,s=X6(s));return l||(64&Wn(s)?$1(s,32):32&r&&aC(s,32)),On(i,r,2,o=new Js(s,o,Zhe,void 0)),o}(t,e,ma(t,e,2)),!n&&aO&&(t.ta=!0),t}});hi[458105876]=[0,e8,fde,[!0,cc,[0,ln,-1,sr]]];var pP=class extends Ye{constructor(t){super(t)}},t8=zo(458105758,pP);hi[458105758]=[0,ri,ln,e8];var n8=class extends Ye{constructor(t){super(t)}},jde=zo(443442058,n8);hi[443442058]=[0,ri,ln,Yn,Ci,sr,-1],hi[514774813]=dP;var i8=class extends Ye{constructor(t){super(t)}},Wde=zo(516587230,i8);function LT(t,e){return e=e?e.clone():new oP,t.displayNamesLocale!==void 0?Cn(e,1,vp(t.displayNamesLocale)):t.displayNamesLocale===void 0&&Cn(e,1),t.maxResults!==void 0?ca(e,2,t.maxResults):"maxResults"in t&&Cn(e,2),t.scoreThreshold!==void 0?tt(e,3,t.scoreThreshold):"scoreThreshold"in t&&Cn(e,3),t.categoryAllowlist!==void 0?K1(e,4,t.categoryAllowlist):"categoryAllowlist"in t&&Cn(e,4),t.categoryDenylist!==void 0?K1(e,5,t.categoryDenylist):"categoryDenylist"in t&&Cn(e,5),e}function fP(t,e=-1,n=""){return{categories:t.map(i=>({index:Io($s(i,1),0)??-1,score:ti(i,2)??0,categoryName:la(i,3)??"",displayName:la(i,4)??""})),headIndex:e,headName:n}}function r8(t){var o,a;var e=pu(t,3,_c,du()),n=pu(t,2,gp,du()),i=pu(t,1,Jl,du()),r=pu(t,9,Jl,du());const s={categories:[],keypoints:[]};for(let l=0;l<e.length;l++)s.categories.push({score:e[l],index:n[l]??-1,categoryName:i[l]??"",displayName:r[l]??""});if((e=(o=Jt(t,eE,4))==null?void 0:o.h())&&(s.boundingBox={originX:$s(e,1)??0,originY:$s(e,2)??0,width:$s(e,3)??0,height:$s(e,4)??0,angle:0}),(a=Jt(t,eE,4))==null?void 0:a.g().length)for(const l of Jt(t,eE,4).g())s.keypoints.push({x:Vy(l,1)??0,y:Vy(l,2)??0,score:Vy(l,4)??0,label:Jl(oc(l,3))??""});return s}function AC(t){const e=[];for(const n of Za(t,D$,1))e.push({x:ti(n,1)??0,y:ti(n,2)??0,z:ti(n,3)??0,visibility:ti(n,4)??0});return e}function bg(t){const e=[];for(const n of Za(t,L$,1))e.push({x:ti(n,1)??0,y:ti(n,2)??0,z:ti(n,3)??0,visibility:ti(n,4)??0});return e}function lO(t){return Array.from(t,e=>e>127?e-256:e)}function cO(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,i=0,r=0;for(let s=0;s<t.length;s++)n+=t[s]*e[s],i+=t[s]*t[s],r+=e[s]*e[s];if(i<=0||r<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(i*r)}let sy;hi[516587230]=[0,ri,dP,kT,Ci],hi[518928384]=kT;const Gde=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function s8(){if(sy===void 0)try{await WebAssembly.instantiate(Gde),sy=!0}catch{sy=!1}return sy}async function jm(t,e=Sde``){const n=await s8()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var Qc=class{};function o8(){var t=navigator;return typeof OffscreenCanvas<"u"&&(!function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(t)||!!((t=t.userAgent.match(/Version\/([\d]+).*Safari/))&&t.length>=1&&Number(t[1])>=17))}async function uO(t){if(typeof importScripts!="function"){const e=document.createElement("script");return e.src=t.toString(),e.crossOrigin="anonymous",new Promise((n,i)=>{e.addEventListener("load",()=>{n()},!1),e.addEventListener("error",r=>{i(r)},!1),document.body.appendChild(e)})}importScripts(t.toString())}function a8(t){return t.videoWidth!==void 0?[t.videoWidth,t.videoHeight]:t.naturalWidth!==void 0?[t.naturalWidth,t.naturalHeight]:t.displayWidth!==void 0?[t.displayWidth,t.displayHeight]:[t.width,t.height]}function rt(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(e=t.i.stringToNewUTF8(e)),t.i._free(e)}function hO(t,e,n){if(!t.i.canvas)throw Error("No OpenGL canvas configured.");if(n?t.i._bindTextureToStream(n):t.i._bindTextureToCanvas(),!(n=t.i.canvas.getContext("webgl2")||t.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[i,r]=a8(e);return!t.l||i===t.i.canvas.width&&r===t.i.canvas.height||(t.i.canvas.width=i,t.i.canvas.height=r),[i,r]}function dO(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const i=new Uint32Array(e.length);for(let r=0;r<e.length;r++)i[r]=t.i.stringToNewUTF8(e[r]);e=t.i._malloc(4*i.length),t.i.HEAPU32.set(i,e>>2),n(e);for(const r of i)t.i._free(r);t.i._free(e)}function jo(t,e,n){t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=n}function vl(t,e,n){let i=[];t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=(r,s,o)=>{s?(n(i,o),i=[]):i.push(r)}}Qc.forVisionTasks=function(t){return jm("vision",t)},Qc.forTextTasks=function(t){return jm("text",t)},Qc.forGenAiExperimentalTasks=function(t){return jm("genai_experimental",t)},Qc.forGenAiTasks=function(t){return jm("genai",t)},Qc.forAudioTasks=function(t){return jm("audio",t)},Qc.isSimdSupported=function(){return s8()};async function qde(t,e,n,i){return t=await(async(r,s,o,a,l)=>{if(s&&await uO(s),!self.ModuleFactory||o&&(await uO(o),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&l&&((s=self.Module).locateFile=l.locateFile,l.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=l.mainScriptUrlOrBlob)),l=await self.ModuleFactory(self.Module||l),self.ModuleFactory=self.Module=void 0,new r(l,a)})(t,n.wasmLoaderPath,n.assetLoaderPath,e,{locateFile:r=>r.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&r.endsWith(".data")?n.assetBinaryPath.toString():r}),await t.o(i),t}function tE(t,e){const n=Jt(t.baseOptions,Q1,1)||new Q1;typeof e=="string"?(Cn(n,2,vp(e)),Cn(n,1)):e instanceof Uint8Array&&(Cn(n,1,PA(e,!1,!1)),Cn(n,2)),lt(t.baseOptions,0,1,n)}function pO(t){try{const e=t.H.length;if(e===1)throw Error(t.H[0].message);if(e>1)throw Error("Encountered multiple errors: "+t.H.map(n=>n.message).join(", "))}finally{t.H=[]}}function Be(t,e){t.B=Math.max(t.B,e)}function PC(t,e){t.A=new Ar,Rs(t.A,"PassThroughCalculator"),En(t.A,"free_memory"),jt(t.A,"free_memory_unused_out"),kn(e,"free_memory"),Ts(e,t.A)}function jd(t,e){En(t.A,e),jt(t.A,e+"_unused_out")}function IC(t){t.g.addBoolToStream(!0,"free_memory",t.B)}var Gy=class{constructor(t){this.g=t,this.H=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(t,e=!0){var n,i,r,s,o,a;if(e){const l=t.baseOptions||{};if((n=t.baseOptions)!=null&&n.modelAssetBuffer&&((i=t.baseOptions)!=null&&i.modelAssetPath))throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!((r=Jt(this.baseOptions,Q1,1))!=null&&r.g()||(s=Jt(this.baseOptions,Q1,1))!=null&&s.h()||(o=t.baseOptions)!=null&&o.modelAssetBuffer||(a=t.baseOptions)!=null&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(c,u){let h=Jt(c.baseOptions,sO,3);if(!h){var d=h=new sO,p=new ZN;Eg(d,4,Wy,p)}"delegate"in u&&(u.delegate==="GPU"?(u=h,d=new xde,Eg(u,2,Wy,d)):(u=h,d=new ZN,Eg(u,4,Wy,d))),lt(c.baseOptions,0,3,h)}(this,l),l.modelAssetPath)return fetch(l.modelAssetPath.toString()).then(c=>{if(c.ok)return c.arrayBuffer();throw Error(`Failed to fetch model: ${l.modelAssetPath} (${c.status})`)}).then(c=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(c),!0,!1,!1),tE(this,"/model.dat"),this.m(),this.J()});if(l.modelAssetBuffer instanceof Uint8Array)tE(this,l.modelAssetBuffer);else if(l.modelAssetBuffer)return async function(c){const u=[];for(var h=0;;){const{done:d,value:p}=await c.read();if(d)break;u.push(p),h+=p.length}if(u.length===0)return new Uint8Array(0);if(u.length===1)return u[0];c=new Uint8Array(h),h=0;for(const d of u)c.set(d,h),h+=d.length;return c}(l.modelAssetBuffer).then(c=>{tE(this,c),this.m(),this.J()})}return this.m(),this.J(),Promise.resolve()}J(){}ea(){let t;if(this.g.ea(e=>{t=Cde(e)}),!t)throw Error("Failed to retrieve CalculatorGraphConfig");return t}setGraph(t,e){this.g.attachErrorListener((n,i)=>{this.H.push(Error(i))}),this.g.Ma(),this.g.setGraph(t,e),this.A=void 0,pO(this)}finishProcessing(){this.g.finishProcessing(),pO(this)}close(){this.A=void 0,this.g.closeGraph()}};function ja(t,e){if(!t)throw Error(`Unable to obtain required WebGL resource: ${e}`);return t}Gy.prototype.close=Gy.prototype.close,function(t,e){t=t.split(".");var n,i=Nu;for((t[0]in i)||i.execScript===void 0||i.execScript("var "+t[0]);t.length&&(n=t.shift());)t.length||e===void 0?i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={}:i[n]=e}("TaskRunner",Gy);class Xde{constructor(e,n,i,r){this.g=e,this.h=n,this.m=i,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function fO(t,e,n){const i=t.g;if(n=ja(i.createShader(n),"Failed to create WebGL shader"),i.shaderSource(n,e),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${i.getShaderInfoLog(n)}`);return i.attachShader(t.h,n),n}function mO(t,e){const n=t.g,i=ja(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(i);const r=ja(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,r),n.enableVertexAttribArray(t.P),n.vertexAttribPointer(t.P,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=ja(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(t.J),n.vertexAttribPointer(t.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new Xde(n,i,r,s)}function mP(t,e){if(t.g){if(e!==t.g)throw Error("Cannot change GL context once initialized")}else t.g=e}function gP(t,e,n,i){return mP(t,e),t.h||(t.m(),t.C()),n?(t.s||(t.s=mO(t,!0)),n=t.s):(t.v||(t.v=mO(t,!1)),n=t.v),e.useProgram(t.h),n.bind(),t.l(),t=i(),n.g.bindVertexArray(null),t}function MC(t,e,n){return mP(t,e),t=ja(e.createTexture(),"Failed to create texture"),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),t}function kC(t,e,n){mP(t,e),t.A||(t.A=ja(e.createFramebuffer(),"Failed to create framebuffe.")),e.bindFramebuffer(e.FRAMEBUFFER,t.A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function vP(t){var e;(e=t.g)==null||e.bindFramebuffer(t.g.FRAMEBUFFER,null)}var yP=class{H(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const t=this.g;if(this.h=ja(t.createProgram(),"Failed to create WebGL program"),this.ba=fO(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,t.VERTEX_SHADER),this.aa=fO(this,this.H(),t.FRAGMENT_SHADER),t.linkProgram(this.h),!t.getProgramParameter(this.h,t.LINK_STATUS))throw Error(`Error during program linking: ${t.getProgramInfoLog(this.h)}`);this.P=t.getAttribLocation(this.h,"aVertex"),this.J=t.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const t=this.g;t.deleteProgram(this.h),t.deleteShader(this.ba),t.deleteShader(this.aa)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function Da(t,e){switch(e){case 0:return t.g.find(n=>n instanceof Uint8Array);case 1:return t.g.find(n=>n instanceof Float32Array);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function DT(t){var e=Da(t,1);if(!e){if(e=Da(t,0))e=new Float32Array(e).map(i=>i/255);else{e=new Float32Array(t.width*t.height);const i=Wd(t);var n=SP(t);if(kC(n,i,l8(t)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){n=new Float32Array(t.width*t.height*4),i.readPixels(0,0,t.width,t.height,i.RGBA,i.FLOAT,n);for(let r=0,s=0;r<e.length;++r,s+=4)e[r]=n[s]}else i.readPixels(0,0,t.width,t.height,i.RED,i.FLOAT,e)}t.g.push(e)}return e}function l8(t){let e=Da(t,2);if(!e){const n=Wd(t);e=u8(t);const i=DT(t),r=c8(t);n.texImage2D(n.TEXTURE_2D,0,r,t.width,t.height,0,n.RED,n.FLOAT,i),NT(t)}return e}function Wd(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=ja(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function c8(t){if(t=Wd(t),!oy)if(t.getExtension("EXT_color_buffer_float")&&t.getExtension("OES_texture_float_linear")&&t.getExtension("EXT_float_blend"))oy=t.R32F;else{if(!t.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");oy=t.R16F}return oy}function SP(t){return t.l||(t.l=new yP),t.l}function u8(t){const e=Wd(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Da(t,2);return n||(n=MC(SP(t),e,t.m?e.LINEAR:e.NEAREST),t.g.push(n),t.j=!0),e.bindTexture(e.TEXTURE_2D,n),n}function NT(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}var oy,Ai=class{constructor(t,e,n,i,r,s,o){this.g=t,this.m=e,this.j=n,this.canvas=i,this.l=r,this.width=s,this.height=o,this.j&&--gO===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Ha(){return!!Da(this,0)}la(){return!!Da(this,1)}R(){return!!Da(this,2)}ka(){return(e=Da(t=this,0))||(e=DT(t),e=new Uint8Array(e.map(n=>255*n)),t.g.push(e)),e;var t,e}ja(){return DT(this)}N(){return l8(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof Uint8Array)n=new Uint8Array(e);else if(e instanceof Float32Array)n=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const i=Wd(this),r=SP(this);i.activeTexture(i.TEXTURE1),n=MC(r,i,this.m?i.LINEAR:i.NEAREST),i.bindTexture(i.TEXTURE_2D,n);const s=c8(this);i.texImage2D(i.TEXTURE_2D,0,s,this.width,this.height,0,i.RED,i.FLOAT,null),i.bindTexture(i.TEXTURE_2D,null),kC(r,i,n),gP(r,i,!1,()=>{u8(this),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),NT(this)}),vP(r),NT(this)}}t.push(n)}return new Ai(t,this.m,this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Wd(this).deleteTexture(Da(this,2)),gO=-1}};Ai.prototype.close=Ai.prototype.close,Ai.prototype.clone=Ai.prototype.clone,Ai.prototype.getAsWebGLTexture=Ai.prototype.N,Ai.prototype.getAsFloat32Array=Ai.prototype.ja,Ai.prototype.getAsUint8Array=Ai.prototype.ka,Ai.prototype.hasWebGLTexture=Ai.prototype.R,Ai.prototype.hasFloat32Array=Ai.prototype.la,Ai.prototype.hasUint8Array=Ai.prototype.Ha;var gO=250;function Jo(t,e){switch(e){case 0:return t.g.find(n=>n instanceof ImageData);case 1:return t.g.find(n=>typeof ImageBitmap<"u"&&n instanceof ImageBitmap);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function h8(t){var e=Jo(t,0);if(!e){e=Gd(t);const n=LC(t),i=new Uint8Array(t.width*t.height*4);kC(n,e,qy(t)),e.readPixels(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,i),vP(n),e=new ImageData(new Uint8ClampedArray(i.buffer),t.width,t.height),t.g.push(e)}return e}function qy(t){let e=Jo(t,2);if(!e){const n=Gd(t);e=Xy(t);const i=Jo(t,1)||h8(t);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i),ig(t)}return e}function Gd(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when iniitializing the image.");return t.h||(t.h=ja(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function LC(t){return t.l||(t.l=new yP),t.l}function Xy(t){const e=Gd(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Jo(t,2);return n||(n=MC(LC(t),e),t.g.push(n),t.m=!0),e.bindTexture(e.TEXTURE_2D,n),n}function ig(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}function vO(t){const e=Gd(t);return gP(LC(t),e,!0,()=>function(n,i){const r=n.canvas;if(r.width===n.width&&r.height===n.height)return i();const s=r.width,o=r.height;return r.width=n.width,r.height=n.height,n=i(),r.width=s,r.height=o,n}(t,()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(t.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return t.canvas.transferToImageBitmap()}))}var Pi=class{constructor(t,e,n,i,r,s,o){this.g=t,this.j=e,this.m=n,this.canvas=i,this.l=r,this.width=s,this.height=o,(this.j||this.m)&&--yO===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ga(){return!!Jo(this,0)}ma(){return!!Jo(this,1)}R(){return!!Jo(this,2)}Ea(){return h8(this)}Da(){var t=Jo(this,1);return t||(qy(this),Xy(this),t=vO(this),ig(this),this.g.push(t),this.j=!0),t}N(){return qy(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof ImageData)n=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const i=Gd(this),r=LC(this);i.activeTexture(i.TEXTURE1),n=MC(r,i),i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindTexture(i.TEXTURE_2D,null),kC(r,i,n),gP(r,i,!1,()=>{Xy(this),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),ig(this)}),vP(r),ig(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);qy(this),Xy(this),n=vO(this),ig(this)}t.push(n)}return new Pi(t,this.ma(),this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Jo(this,1).close(),this.m&&Gd(this).deleteTexture(Jo(this,2)),yO=-1}};Pi.prototype.close=Pi.prototype.close,Pi.prototype.clone=Pi.prototype.clone,Pi.prototype.getAsWebGLTexture=Pi.prototype.N,Pi.prototype.getAsImageBitmap=Pi.prototype.Da,Pi.prototype.getAsImageData=Pi.prototype.Ea,Pi.prototype.hasWebGLTexture=Pi.prototype.R,Pi.prototype.hasImageBitmap=Pi.prototype.ma,Pi.prototype.hasImageData=Pi.prototype.Ga;var yO=250;function Uo(...t){return t.map(([e,n])=>({start:e,end:n}))}const Kde=function(t){return class extends t{Ma(){this.i._registerModelResourcesGraphService()}}}((SO=class{constructor(t,e){this.l=!0,this.i=t,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",e!==void 0?this.i.canvas=e:o8()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(".pbtxt")||t.endsWith(".textproto")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph(new TextEncoder().encode(t),!1)}setGraph(t,e){const n=t.length,i=this.i._malloc(n);this.i.HEAPU8.set(t,i),e?this.i._changeBinaryGraph(n,i):this.i._changeTextGraph(n,i),this.i._free(i)}configureAudio(t,e,n,i,r){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),rt(this,i||"input_audio",s=>{rt(this,r=r||"audio_header",o=>{this.i._configureAudio(s,o,t,e??0,n)})})}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.i._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.i.gpuOriginForWebTexturesIsBottomLeft=t}ea(t){jo(this,"__graph_config__",e=>{t(e)}),rt(this,"__graph_config__",e=>{this.i._getGraphConfig(e,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(t){this.i.errorListener=t}attachEmptyPacketListener(t,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,i,r){const s=4*t.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(t,this.g/4),rt(this,i,o=>{this.i._addAudioToInputStream(this.g,e,n,o,r)})}addGpuBufferToStream(t,e,n){rt(this,e,i=>{const[r,s]=hO(this,t,i);this.i._addBoundTextureToStream(i,r,s,n)})}addBoolToStream(t,e,n){rt(this,e,i=>{this.i._addBoolToInputStream(t,i,n)})}addDoubleToStream(t,e,n){rt(this,e,i=>{this.i._addDoubleToInputStream(t,i,n)})}addFloatToStream(t,e,n){rt(this,e,i=>{this.i._addFloatToInputStream(t,i,n)})}addIntToStream(t,e,n){rt(this,e,i=>{this.i._addIntToInputStream(t,i,n)})}addUintToStream(t,e,n){rt(this,e,i=>{this.i._addUintToInputStream(t,i,n)})}addStringToStream(t,e,n){rt(this,e,i=>{rt(this,t,r=>{this.i._addStringToInputStream(r,i,n)})})}addStringRecordToStream(t,e,n){rt(this,e,i=>{dO(this,Object.keys(t),r=>{dO(this,Object.values(t),s=>{this.i._addFlatHashMapToInputStream(r,s,Object.keys(t).length,i,n)})})})}addProtoToStream(t,e,n,i){rt(this,n,r=>{rt(this,e,s=>{const o=this.i._malloc(t.length);this.i.HEAPU8.set(t,o),this.i._addProtoToInputStream(o,t.length,s,r,i),this.i._free(o)})})}addEmptyPacketToStream(t,e){rt(this,t,n=>{this.i._addEmptyPacketToInputStream(n,e)})}addBoolVectorToStream(t,e,n){rt(this,e,i=>{const r=this.i._allocateBoolVector(t.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const s of t)this.i._addBoolVectorEntry(r,s);this.i._addBoolVectorToInputStream(r,i,n)})}addDoubleVectorToStream(t,e,n){rt(this,e,i=>{const r=this.i._allocateDoubleVector(t.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const s of t)this.i._addDoubleVectorEntry(r,s);this.i._addDoubleVectorToInputStream(r,i,n)})}addFloatVectorToStream(t,e,n){rt(this,e,i=>{const r=this.i._allocateFloatVector(t.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const s of t)this.i._addFloatVectorEntry(r,s);this.i._addFloatVectorToInputStream(r,i,n)})}addIntVectorToStream(t,e,n){rt(this,e,i=>{const r=this.i._allocateIntVector(t.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const s of t)this.i._addIntVectorEntry(r,s);this.i._addIntVectorToInputStream(r,i,n)})}addUintVectorToStream(t,e,n){rt(this,e,i=>{const r=this.i._allocateUintVector(t.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const s of t)this.i._addUintVectorEntry(r,s);this.i._addUintVectorToInputStream(r,i,n)})}addStringVectorToStream(t,e,n){rt(this,e,i=>{const r=this.i._allocateStringVector(t.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const s of t)rt(this,s,o=>{this.i._addStringVectorEntry(r,o)});this.i._addStringVectorToInputStream(r,i,n)})}addBoolToInputSidePacket(t,e){rt(this,e,n=>{this.i._addBoolToInputSidePacket(t,n)})}addDoubleToInputSidePacket(t,e){rt(this,e,n=>{this.i._addDoubleToInputSidePacket(t,n)})}addFloatToInputSidePacket(t,e){rt(this,e,n=>{this.i._addFloatToInputSidePacket(t,n)})}addIntToInputSidePacket(t,e){rt(this,e,n=>{this.i._addIntToInputSidePacket(t,n)})}addUintToInputSidePacket(t,e){rt(this,e,n=>{this.i._addUintToInputSidePacket(t,n)})}addStringToInputSidePacket(t,e){rt(this,e,n=>{rt(this,t,i=>{this.i._addStringToInputSidePacket(i,n)})})}addProtoToInputSidePacket(t,e,n){rt(this,n,i=>{rt(this,e,r=>{const s=this.i._malloc(t.length);this.i.HEAPU8.set(t,s),this.i._addProtoToInputSidePacket(s,t.length,r,i),this.i._free(s)})})}addBoolVectorToInputSidePacket(t,e){rt(this,e,n=>{const i=this.i._allocateBoolVector(t.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const r of t)this.i._addBoolVectorEntry(i,r);this.i._addBoolVectorToInputSidePacket(i,n)})}addDoubleVectorToInputSidePacket(t,e){rt(this,e,n=>{const i=this.i._allocateDoubleVector(t.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const r of t)this.i._addDoubleVectorEntry(i,r);this.i._addDoubleVectorToInputSidePacket(i,n)})}addFloatVectorToInputSidePacket(t,e){rt(this,e,n=>{const i=this.i._allocateFloatVector(t.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const r of t)this.i._addFloatVectorEntry(i,r);this.i._addFloatVectorToInputSidePacket(i,n)})}addIntVectorToInputSidePacket(t,e){rt(this,e,n=>{const i=this.i._allocateIntVector(t.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const r of t)this.i._addIntVectorEntry(i,r);this.i._addIntVectorToInputSidePacket(i,n)})}addUintVectorToInputSidePacket(t,e){rt(this,e,n=>{const i=this.i._allocateUintVector(t.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const r of t)this.i._addUintVectorEntry(i,r);this.i._addUintVectorToInputSidePacket(i,n)})}addStringVectorToInputSidePacket(t,e){rt(this,e,n=>{const i=this.i._allocateStringVector(t.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const r of t)rt(this,r,s=>{this.i._addStringVectorEntry(i,s)});this.i._addStringVectorToInputSidePacket(i,n)})}attachBoolListener(t,e){jo(this,t,e),rt(this,t,n=>{this.i._attachBoolListener(n)})}attachBoolVectorListener(t,e){vl(this,t,e),rt(this,t,n=>{this.i._attachBoolVectorListener(n)})}attachIntListener(t,e){jo(this,t,e),rt(this,t,n=>{this.i._attachIntListener(n)})}attachIntVectorListener(t,e){vl(this,t,e),rt(this,t,n=>{this.i._attachIntVectorListener(n)})}attachUintListener(t,e){jo(this,t,e),rt(this,t,n=>{this.i._attachUintListener(n)})}attachUintVectorListener(t,e){vl(this,t,e),rt(this,t,n=>{this.i._attachUintVectorListener(n)})}attachDoubleListener(t,e){jo(this,t,e),rt(this,t,n=>{this.i._attachDoubleListener(n)})}attachDoubleVectorListener(t,e){vl(this,t,e),rt(this,t,n=>{this.i._attachDoubleVectorListener(n)})}attachFloatListener(t,e){jo(this,t,e),rt(this,t,n=>{this.i._attachFloatListener(n)})}attachFloatVectorListener(t,e){vl(this,t,e),rt(this,t,n=>{this.i._attachFloatVectorListener(n)})}attachStringListener(t,e){jo(this,t,e),rt(this,t,n=>{this.i._attachStringListener(n)})}attachStringVectorListener(t,e){vl(this,t,e),rt(this,t,n=>{this.i._attachStringVectorListener(n)})}attachProtoListener(t,e,n){jo(this,t,e),rt(this,t,i=>{this.i._attachProtoListener(i,n||!1)})}attachProtoVectorListener(t,e,n){vl(this,t,e),rt(this,t,i=>{this.i._attachProtoVectorListener(i,n||!1)})}attachAudioListener(t,e,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),jo(this,t,(i,r)=>{i=new Float32Array(i.buffer,i.byteOffset,i.length/4),e(i,r)}),rt(this,t,i=>{this.i._attachAudioListener(i,n||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends SO{get ga(){return this.i}sa(t,e,n){rt(this,e,i=>{const[r,s]=hO(this,t,i);this.ga._addBoundTextureAsImageToStream(i,r,s,n)})}V(t,e){jo(this,t,e),rt(this,t,n=>{this.ga._attachImageListener(n)})}da(t,e){vl(this,t,e),rt(this,t,n=>{this.ga._attachImageVectorListener(n)})}}));var SO,to=class extends Kde{};async function Ht(t,e,n){return async function(i,r,s,o){return qde(i,r,s,o)}(t,n.canvas??(o8()?void 0:document.createElement("canvas")),e,n)}function d8(t,e,n,i){if(t.U){const s=new N$;if(n!=null&&n.regionOfInterest){if(!t.ra)throw Error("This task doesn't support region-of-interest.");var r=n.regionOfInterest;if(r.left>=r.right||r.top>=r.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(r.left<0||r.top<0||r.right>1||r.bottom>1)throw Error("Expected RectF values to be in [0,1].");tt(s,1,(r.left+r.right)/2),tt(s,2,(r.top+r.bottom)/2),tt(s,4,r.right-r.left),tt(s,3,r.bottom-r.top)}else tt(s,1,.5),tt(s,2,.5),tt(s,4,1),tt(s,3,1);if(n!=null&&n.rotationDegrees){if((n==null?void 0:n.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(tt(s,5,-Math.PI*n.rotationDegrees/180),(n==null?void 0:n.rotationDegrees)%180!=0){const[o,a]=a8(e);n=ti(s,3)*a/o,r=ti(s,4)*o/a,tt(s,4,n),tt(s,3,r)}}t.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",t.U,i)}t.g.sa(e,t.ba,i??performance.now()),t.finishProcessing()}function no(t,e,n){var i;if((i=t.baseOptions)!=null&&i.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");d8(t,e,n,t.B+1)}function ga(t,e,n,i){var r;if(!((r=t.baseOptions)!=null&&r.g()))throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");d8(t,e,n,i)}function qd(t,e,n,i){var r=e.data;const s=e.width,o=s*(e=e.height);if((r instanceof Uint8Array||r instanceof Float32Array)&&r.length!==o)throw Error("Unsupported channel count: "+r.length/o);return t=new Ai([r],n,!1,t.g.i.canvas,t.P,s,e),i?t.clone():t}var qr=class extends Gy{constructor(t,e,n,i){super(t),this.g=t,this.ba=e,this.U=n,this.ra=i,this.P=new yP}l(t,e=!0){if("runningMode"in t&&l0(this.baseOptions,2,!!t.runningMode&&t.runningMode!=="IMAGE"),t.canvas!==void 0&&this.g.i.canvas!==t.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(t,e)}close(){this.P.close(),super.close()}};qr.prototype.close=qr.prototype.close;var cs=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect_in",!1),this.j={detections:[]},lt(t=this.h=new bC,0,1,e=new Fn),tt(this.h,2,.5),tt(this.h,3,.3)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return"minDetectionConfidence"in t&&tt(this.h,2,t.minDetectionConfidence??.5),"minSuppressionThreshold"in t&&tt(this.h,3,t.minSuppressionThreshold??.3),this.l(t)}D(t,e){return this.j={detections:[]},no(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},ga(this,t,n,e),this.j}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect_in"),tn(t,"detections");const e=new _s;Oo(e,Lde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect_in"),jt(n,"DETECTIONS:detections"),n.o(e),Ts(t,n),this.g.attachProtoVectorListener("detections",(i,r)=>{for(const s of i)i=k$(s),this.j.detections.push(r8(i));Be(this,r)}),this.g.attachEmptyPacketListener("detections",i=>{Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};cs.prototype.detectForVideo=cs.prototype.F,cs.prototype.detect=cs.prototype.D,cs.prototype.setOptions=cs.prototype.o,cs.createFromModelPath=async function(t,e){return Ht(cs,t,{baseOptions:{modelAssetPath:e}})},cs.createFromModelBuffer=function(t,e){return Ht(cs,t,{baseOptions:{modelAssetBuffer:e}})},cs.createFromOptions=function(t,e){return Ht(cs,t,e)};var xP=Uo([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),CP=Uo([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),_P=Uo([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),p8=Uo([474,475],[475,476],[476,477],[477,474]),wP=Uo([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),EP=Uo([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),f8=Uo([469,470],[470,471],[471,472],[472,469]),RP=Uo([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),m8=[...xP,...CP,..._P,...wP,...EP,...RP],g8=Uo([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function xO(t){t.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var Gn=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,lt(t=this.h=new B$,0,1,e=new Fn),this.v=new U$,lt(this.h,0,3,this.v),this.s=new bC,lt(this.h,0,2,this.s),ca(this.s,4,1),tt(this.s,2,.5),tt(this.v,2,.5),tt(this.h,4,.5)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return"numFaces"in t&&ca(this.s,4,t.numFaces??1),"minFaceDetectionConfidence"in t&&tt(this.s,2,t.minFaceDetectionConfidence??.5),"minTrackingConfidence"in t&&tt(this.h,4,t.minTrackingConfidence??.5),"minFacePresenceConfidence"in t&&tt(this.v,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in t&&(this.outputFacialTransformationMatrixes=!!t.outputFacialTransformationMatrixes),this.l(t)}D(t,e){return xO(this),no(this,t,e),this.j}F(t,e,n){return xO(this),ga(this,t,n,e),this.j}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"face_landmarks");const e=new _s;Oo(e,Nde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"NORM_LANDMARKS:face_landmarks"),n.o(e),Ts(t,n),this.g.attachProtoVectorListener("face_landmarks",(i,r)=>{for(const s of i)i=G0(s),this.j.faceLandmarks.push(AC(i));Be(this,r)}),this.g.attachEmptyPacketListener("face_landmarks",i=>{Be(this,i)}),this.outputFaceBlendshapes&&(tn(t,"blendshapes"),jt(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(i,r)=>{if(this.outputFaceBlendshapes)for(const s of i)i=TC(s),this.j.faceBlendshapes.push(fP(i.g()??[]));Be(this,r)}),this.g.attachEmptyPacketListener("blendshapes",i=>{Be(this,i)})),this.outputFacialTransformationMatrixes&&(tn(t,"face_geometry"),jt(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(i,r)=>{if(this.outputFacialTransformationMatrixes)for(const s of i)(i=Jt(Dde(s),Rde,2))&&this.j.facialTransformationMatrixes.push({rows:Io($s(i,1),0)??0,columns:Io($s(i,2),0)??0,data:pu(i,3,_c,du()).slice()??[]});Be(this,r)}),this.g.attachEmptyPacketListener("face_geometry",i=>{Be(this,i)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Gn.prototype.detectForVideo=Gn.prototype.F,Gn.prototype.detect=Gn.prototype.D,Gn.prototype.setOptions=Gn.prototype.o,Gn.createFromModelPath=function(t,e){return Ht(Gn,t,{baseOptions:{modelAssetPath:e}})},Gn.createFromModelBuffer=function(t,e){return Ht(Gn,t,{baseOptions:{modelAssetBuffer:e}})},Gn.createFromOptions=function(t,e){return Ht(Gn,t,e)},Gn.FACE_LANDMARKS_LIPS=xP,Gn.FACE_LANDMARKS_LEFT_EYE=CP,Gn.FACE_LANDMARKS_LEFT_EYEBROW=_P,Gn.FACE_LANDMARKS_LEFT_IRIS=p8,Gn.FACE_LANDMARKS_RIGHT_EYE=wP,Gn.FACE_LANDMARKS_RIGHT_EYEBROW=EP,Gn.FACE_LANDMARKS_RIGHT_IRIS=f8,Gn.FACE_LANDMARKS_FACE_OVAL=RP,Gn.FACE_LANDMARKS_CONTOURS=m8,Gn.FACE_LANDMARKS_TESSELATION=g8;var Wo=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!0),lt(t=this.j=new H$,0,1,e=new Fn)}get baseOptions(){return Jt(this.j,Fn,1)}set baseOptions(t){lt(this.j,0,1,t)}o(t){return super.l(t)}Pa(t,e,n){const i=typeof e!="function"?e:{};if(this.h=typeof e=="function"?e:n,no(this,t,i??{}),!this.h)return this.s}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"stylized_image");const e=new _s;Oo(e,Ode,this.j);const n=new Ar;Rs(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"STYLIZED_IMAGE:stylized_image"),n.o(e),Ts(t,n),this.g.V("stylized_image",(i,r)=>{var s=!this.h,o=i.data,a=i.width;const l=a*(i=i.height);if(o instanceof Uint8Array)if(o.length===3*l){const c=new Uint8ClampedArray(4*l);for(let u=0;u<l;++u)c[4*u]=o[3*u],c[4*u+1]=o[3*u+1],c[4*u+2]=o[3*u+2],c[4*u+3]=255;o=new ImageData(c,a,i)}else{if(o.length!==4*l)throw Error("Unsupported channel count: "+o.length/l);o=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,o.length),a,i)}else if(!(o instanceof WebGLTexture))throw Error(`Unsupported format: ${o.constructor.name}`);a=new Pi([o],!1,!1,this.g.i.canvas,this.P,a,i),this.s=s=s?a.clone():a,this.h&&this.h(s),Be(this,r)}),this.g.attachEmptyPacketListener("stylized_image",i=>{this.s=null,this.h&&this.h(null),Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Wo.prototype.stylize=Wo.prototype.Pa,Wo.prototype.setOptions=Wo.prototype.o,Wo.createFromModelPath=function(t,e){return Ht(Wo,t,{baseOptions:{modelAssetPath:e}})},Wo.createFromModelBuffer=function(t,e){return Ht(Wo,t,{baseOptions:{modelAssetBuffer:e}})},Wo.createFromOptions=function(t,e){return Ht(Wo,t,e)};var TP=Uo([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function CO(t){t.gestures=[],t.landmarks=[],t.worldLandmarks=[],t.handedness=[]}function _O(t){return t.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:t.gestures,landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handedness:t.handedness,handednesses:t.handedness}}function wO(t,e=!0){const n=[];for(const r of t){var i=TC(r);t=[];for(const s of i.g())i=e&&$s(s,1)!=null?Io($s(s,1),0):-1,t.push({score:ti(s,2)??0,index:i,categoryName:la(s,3)??"",displayName:la(s,4)??""});n.push(t)}return n}var rs=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],lt(t=this.j=new W$,0,1,e=new Fn),this.s=new uP,lt(this.j,0,2,this.s),this.C=new cP,lt(this.s,0,3,this.C),this.v=new j$,lt(this.s,0,2,this.v),this.h=new Fde,lt(this.j,0,3,this.h),tt(this.v,2,.5),tt(this.s,4,.5),tt(this.C,2,.5)}get baseOptions(){return Jt(this.j,Fn,1)}set baseOptions(t){lt(this.j,0,1,t)}o(t){var r,s,o,a;if(ca(this.v,3,t.numHands??1),"minHandDetectionConfidence"in t&&tt(this.v,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&tt(this.s,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&tt(this.C,2,t.minHandPresenceConfidence??.5),t.cannedGesturesClassifierOptions){var e=new Mh,n=e,i=LT(t.cannedGesturesClassifierOptions,(r=Jt(this.h,Mh,3))==null?void 0:r.h());lt(n,0,2,i),lt(this.h,0,3,e)}else t.cannedGesturesClassifierOptions===void 0&&((s=Jt(this.h,Mh,3))==null||s.g());return t.customGesturesClassifierOptions?(lt(n=e=new Mh,0,2,i=LT(t.customGesturesClassifierOptions,(o=Jt(this.h,Mh,4))==null?void 0:o.h())),lt(this.h,0,4,e)):t.customGesturesClassifierOptions===void 0&&((a=Jt(this.h,Mh,4))==null||a.g()),this.l(t)}Ka(t,e){return CO(this),no(this,t,e),_O(this)}La(t,e,n){return CO(this),ga(this,t,n,e),_O(this)}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"hand_gestures"),tn(t,"hand_landmarks"),tn(t,"world_hand_landmarks"),tn(t,"handedness");const e=new _s;Oo(e,zde,this.j);const n=new Ar;Rs(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"HAND_GESTURES:hand_gestures"),jt(n,"LANDMARKS:hand_landmarks"),jt(n,"WORLD_LANDMARKS:world_hand_landmarks"),jt(n,"HANDEDNESS:handedness"),n.o(e),Ts(t,n),this.g.attachProtoVectorListener("hand_landmarks",(i,r)=>{for(const s of i){i=G0(s);const o=[];for(const a of Za(i,D$,1))o.push({x:ti(a,1)??0,y:ti(a,2)??0,z:ti(a,3)??0,visibility:ti(a,4)??0});this.landmarks.push(o)}Be(this,r)}),this.g.attachEmptyPacketListener("hand_landmarks",i=>{Be(this,i)}),this.g.attachProtoVectorListener("world_hand_landmarks",(i,r)=>{for(const s of i){i=vd(s);const o=[];for(const a of Za(i,L$,1))o.push({x:ti(a,1)??0,y:ti(a,2)??0,z:ti(a,3)??0,visibility:ti(a,4)??0});this.worldLandmarks.push(o)}Be(this,r)}),this.g.attachEmptyPacketListener("world_hand_landmarks",i=>{Be(this,i)}),this.g.attachProtoVectorListener("hand_gestures",(i,r)=>{this.gestures.push(...wO(i,!1)),Be(this,r)}),this.g.attachEmptyPacketListener("hand_gestures",i=>{Be(this,i)}),this.g.attachProtoVectorListener("handedness",(i,r)=>{this.handedness.push(...wO(i)),Be(this,r)}),this.g.attachEmptyPacketListener("handedness",i=>{Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};function EO(t){return{landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handednesses:t.handedness,handedness:t.handedness}}rs.prototype.recognizeForVideo=rs.prototype.La,rs.prototype.recognize=rs.prototype.Ka,rs.prototype.setOptions=rs.prototype.o,rs.createFromModelPath=function(t,e){return Ht(rs,t,{baseOptions:{modelAssetPath:e}})},rs.createFromModelBuffer=function(t,e){return Ht(rs,t,{baseOptions:{modelAssetBuffer:e}})},rs.createFromOptions=function(t,e){return Ht(rs,t,e)},rs.HAND_CONNECTIONS=TP;var ss=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],lt(t=this.h=new uP,0,1,e=new Fn),this.s=new cP,lt(this.h,0,3,this.s),this.j=new j$,lt(this.h,0,2,this.j),ca(this.j,3,1),tt(this.j,2,.5),tt(this.s,2,.5),tt(this.h,4,.5)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return"numHands"in t&&ca(this.j,3,t.numHands??1),"minHandDetectionConfidence"in t&&tt(this.j,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&tt(this.h,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&tt(this.s,2,t.minHandPresenceConfidence??.5),this.l(t)}D(t,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],no(this,t,e),EO(this)}F(t,e,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],ga(this,t,n,e),EO(this)}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"hand_landmarks"),tn(t,"world_hand_landmarks"),tn(t,"handedness");const e=new _s;Oo(e,Ude,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"LANDMARKS:hand_landmarks"),jt(n,"WORLD_LANDMARKS:world_hand_landmarks"),jt(n,"HANDEDNESS:handedness"),n.o(e),Ts(t,n),this.g.attachProtoVectorListener("hand_landmarks",(i,r)=>{for(const s of i)i=G0(s),this.landmarks.push(AC(i));Be(this,r)}),this.g.attachEmptyPacketListener("hand_landmarks",i=>{Be(this,i)}),this.g.attachProtoVectorListener("world_hand_landmarks",(i,r)=>{for(const s of i)i=vd(s),this.worldLandmarks.push(bg(i));Be(this,r)}),this.g.attachEmptyPacketListener("world_hand_landmarks",i=>{Be(this,i)}),this.g.attachProtoVectorListener("handedness",(i,r)=>{var s=this.handedness,o=s.push;const a=[];for(const l of i){i=TC(l);const c=[];for(const u of i.g())c.push({score:ti(u,2)??0,index:Io($s(u,1),0)??-1,categoryName:la(u,3)??"",displayName:la(u,4)??""});a.push(c)}o.call(s,...a),Be(this,r)}),this.g.attachEmptyPacketListener("handedness",i=>{Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};ss.prototype.detectForVideo=ss.prototype.F,ss.prototype.detect=ss.prototype.D,ss.prototype.setOptions=ss.prototype.o,ss.createFromModelPath=function(t,e){return Ht(ss,t,{baseOptions:{modelAssetPath:e}})},ss.createFromModelBuffer=function(t,e){return Ht(ss,t,{baseOptions:{modelAssetBuffer:e}})},ss.createFromOptions=function(t,e){return Ht(ss,t,e)},ss.HAND_CONNECTIONS=TP;var v8=Uo([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function RO(t){t.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function TO(t){try{if(!t.C)return t.h;t.C(t.h)}finally{IC(t)}}function ay(t,e){t=G0(t),e.push(AC(t))}var Ln=class extends qr{constructor(t,e){super(new to(t,e),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,lt(t=this.j=new Y$,0,1,e=new Fn),this.K=new cP,lt(this.j,0,2,this.K),this.aa=new Bde,lt(this.j,0,3,this.aa),this.s=new bC,lt(this.j,0,4,this.s),this.I=new U$,lt(this.j,0,5,this.I),this.v=new X$,lt(this.j,0,6,this.v),this.L=new K$,lt(this.j,0,7,this.L),tt(this.s,2,.5),tt(this.s,3,.3),tt(this.I,2,.5),tt(this.v,2,.5),tt(this.v,3,.3),tt(this.L,2,.5),tt(this.K,2,.5)}get baseOptions(){return Jt(this.j,Fn,1)}set baseOptions(t){lt(this.j,0,1,t)}o(t){return"minFaceDetectionConfidence"in t&&tt(this.s,2,t.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in t&&tt(this.s,3,t.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in t&&tt(this.I,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"minPoseDetectionConfidence"in t&&tt(this.v,2,t.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in t&&tt(this.v,3,t.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in t&&tt(this.L,2,t.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in t&&(this.outputPoseSegmentationMasks=!!t.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in t&&tt(this.K,2,t.minHandLandmarksConfidence??.5),this.l(t)}D(t,e,n){const i=typeof e!="function"?e:{};return this.C=typeof e=="function"?e:n,RO(this),no(this,t,i),TO(this)}F(t,e,n,i){const r=typeof n!="function"?n:{};return this.C=typeof n=="function"?n:i,RO(this),ga(this,t,r,e),TO(this)}m(){var t=new Jr;kn(t,"input_frames_image"),tn(t,"pose_landmarks"),tn(t,"pose_world_landmarks"),tn(t,"face_landmarks"),tn(t,"left_hand_landmarks"),tn(t,"left_hand_world_landmarks"),tn(t,"right_hand_landmarks"),tn(t,"right_hand_world_landmarks");const e=new _s,n=new KN;bT(n,1,vp("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(r,s){if(s!=null)if(Array.isArray(s))Cn(r,2,fC(s,UA,void 0,void 0,!1));else{if(!(typeof s=="string"||s instanceof Va||$0(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");bT(r,2,PA(s,!1,!1),Ou())}}(n,this.j.g());const i=new Ar;Rs(i,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),X1(i,8,KN,n),En(i,"IMAGE:input_frames_image"),jt(i,"POSE_LANDMARKS:pose_landmarks"),jt(i,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),jt(i,"FACE_LANDMARKS:face_landmarks"),jt(i,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),jt(i,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),jt(i,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),jt(i,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),i.o(e),Ts(t,i),PC(this,t),this.g.attachProtoListener("pose_landmarks",(r,s)=>{ay(r,this.h.poseLandmarks),Be(this,s)}),this.g.attachEmptyPacketListener("pose_landmarks",r=>{Be(this,r)}),this.g.attachProtoListener("pose_world_landmarks",(r,s)=>{var o=this.h.poseWorldLandmarks;r=vd(r),o.push(bg(r)),Be(this,s)}),this.g.attachEmptyPacketListener("pose_world_landmarks",r=>{Be(this,r)}),this.outputPoseSegmentationMasks&&(jt(i,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),jd(this,"pose_segmentation_mask"),this.g.V("pose_segmentation_mask",(r,s)=>{this.h.poseSegmentationMasks=[qd(this,r,!0,!this.C)],Be(this,s)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",r=>{this.h.poseSegmentationMasks=[],Be(this,r)})),this.g.attachProtoListener("face_landmarks",(r,s)=>{ay(r,this.h.faceLandmarks),Be(this,s)}),this.g.attachEmptyPacketListener("face_landmarks",r=>{Be(this,r)}),this.outputFaceBlendshapes&&(tn(t,"extra_blendshapes"),jt(i,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(r,s)=>{var o=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(r=TC(r),o.push(fP(r.g()??[]))),Be(this,s)}),this.g.attachEmptyPacketListener("extra_blendshapes",r=>{Be(this,r)})),this.g.attachProtoListener("left_hand_landmarks",(r,s)=>{ay(r,this.h.leftHandLandmarks),Be(this,s)}),this.g.attachEmptyPacketListener("left_hand_landmarks",r=>{Be(this,r)}),this.g.attachProtoListener("left_hand_world_landmarks",(r,s)=>{var o=this.h.leftHandWorldLandmarks;r=vd(r),o.push(bg(r)),Be(this,s)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",r=>{Be(this,r)}),this.g.attachProtoListener("right_hand_landmarks",(r,s)=>{ay(r,this.h.rightHandLandmarks),Be(this,s)}),this.g.attachEmptyPacketListener("right_hand_landmarks",r=>{Be(this,r)}),this.g.attachProtoListener("right_hand_world_landmarks",(r,s)=>{var o=this.h.rightHandWorldLandmarks;r=vd(r),o.push(bg(r)),Be(this,s)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",r=>{Be(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ln.prototype.detectForVideo=Ln.prototype.F,Ln.prototype.detect=Ln.prototype.D,Ln.prototype.setOptions=Ln.prototype.o,Ln.createFromModelPath=function(t,e){return Ht(Ln,t,{baseOptions:{modelAssetPath:e}})},Ln.createFromModelBuffer=function(t,e){return Ht(Ln,t,{baseOptions:{modelAssetBuffer:e}})},Ln.createFromOptions=function(t,e){return Ht(Ln,t,e)},Ln.HAND_CONNECTIONS=TP,Ln.POSE_CONNECTIONS=v8,Ln.FACE_LANDMARKS_LIPS=xP,Ln.FACE_LANDMARKS_LEFT_EYE=CP,Ln.FACE_LANDMARKS_LEFT_EYEBROW=_P,Ln.FACE_LANDMARKS_LEFT_IRIS=p8,Ln.FACE_LANDMARKS_RIGHT_EYE=wP,Ln.FACE_LANDMARKS_RIGHT_EYEBROW=EP,Ln.FACE_LANDMARKS_RIGHT_IRIS=f8,Ln.FACE_LANDMARKS_FACE_OVAL=RP,Ln.FACE_LANDMARKS_CONTOURS=m8,Ln.FACE_LANDMARKS_TESSELATION=g8;var Is=class extends qr{constructor(t,e){super(new to(t,e),"input_image","norm_rect",!0),this.j={classifications:[]},lt(t=this.h=new J$,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return lt(this.h,0,2,LT(t,Jt(this.h,oP,2))),this.l(t)}ua(t,e){return this.j={classifications:[]},no(this,t,e),this.j}va(t,e,n){return this.j={classifications:[]},ga(this,t,n,e),this.j}m(){var t=new Jr;kn(t,"input_image"),kn(t,"norm_rect"),tn(t,"classifications");const e=new _s;Oo(e,$de,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),En(n,"IMAGE:input_image"),En(n,"NORM_RECT:norm_rect"),jt(n,"CLASSIFICATIONS:classifications"),n.o(e),Ts(t,n),this.g.attachProtoListener("classifications",(i,r)=>{this.j=function(s){const o={classifications:Za(s,bde,1).map(a=>{var l;return fP(((l=Jt(a,I$,4))==null?void 0:l.g())??[],Io($s(a,2),0),la(a,3))})};return W1(oc(s,2))!=null&&(o.timestampMs=Io(W1(oc(s,2)),0)),o}(Ade(i)),Be(this,r)}),this.g.attachEmptyPacketListener("classifications",i=>{Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Is.prototype.classifyForVideo=Is.prototype.va,Is.prototype.classify=Is.prototype.ua,Is.prototype.setOptions=Is.prototype.o,Is.createFromModelPath=function(t,e){return Ht(Is,t,{baseOptions:{modelAssetPath:e}})},Is.createFromModelBuffer=function(t,e){return Ht(Is,t,{baseOptions:{modelAssetBuffer:e}})},Is.createFromOptions=function(t,e){return Ht(Is,t,e)};var os=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!0),this.h=new Q$,this.embeddings={embeddings:[]},lt(t=this.h,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){var e=this.h,n=Jt(this.h,rO,2);return n=n?n.clone():new rO,t.l2Normalize!==void 0?l0(n,1,t.l2Normalize):"l2Normalize"in t&&Cn(n,1),t.quantize!==void 0?l0(n,2,t.quantize):"quantize"in t&&Cn(n,2),lt(e,0,2,n),this.l(t)}Ba(t,e){return no(this,t,e),this.embeddings}Ca(t,e,n){return ga(this,t,n,e),this.embeddings}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"embeddings_out");const e=new _s;Oo(e,Hde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"EMBEDDINGS:embeddings_out"),n.o(e),Ts(t,n),this.g.attachProtoListener("embeddings_out",(i,r)=>{i=Mde(i),this.embeddings=function(s){return{embeddings:Za(s,Ide,1).map(o=>{var l,c;const a={headIndex:Io($s(o,3),0)??-1,headName:la(o,4)??""};if(Y6(o,iO,Yw(o,1))!==void 0)o=pu(o=Jt(o,iO,Yw(o,1)),1,_c,du()),a.floatEmbedding=o.slice();else{const u=new Uint8Array(0);a.quantizedEmbedding=((c=(l=Jt(o,Pde,Yw(o,2)))==null?void 0:l.qa())==null?void 0:c.h())??u}return a}),timestampMs:Io(W1(oc(s,2)),0)}}(i),Be(this,r)}),this.g.attachEmptyPacketListener("embeddings_out",i=>{Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};os.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=cO(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");t=cO(lO(t.quantizedEmbedding),lO(e.quantizedEmbedding))}return t},os.prototype.embedForVideo=os.prototype.Ca,os.prototype.embed=os.prototype.Ba,os.prototype.setOptions=os.prototype.o,os.createFromModelPath=function(t,e){return Ht(os,t,{baseOptions:{modelAssetPath:e}})},os.createFromModelBuffer=function(t,e){return Ht(os,t,{baseOptions:{modelAssetBuffer:e}})},os.createFromOptions=function(t,e){return Ht(os,t,e)};var OT=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){var t,e;(t=this.confidenceMasks)==null||t.forEach(n=>{n.close()}),(e=this.categoryMask)==null||e.close()}};function bO(t){t.categoryMask=void 0,t.confidenceMasks=void 0,t.qualityScores=void 0}function AO(t){try{const e=new OT(t.confidenceMasks,t.categoryMask,t.qualityScores);if(!t.j)return e;t.j(e)}finally{IC(t)}}OT.prototype.close=OT.prototype.close;var Nr=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new pP,this.v=new Z$,lt(this.h,0,3,this.v),lt(t=this.h,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Cn(this.h,2,vp(t.displayNamesLocale)):"displayNamesLocale"in t&&Cn(this.h,2),"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}J(){(function(t){var n,i;const e=Za(t.ea(),Ar,1).filter(r=>la(r,1).includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(t.s=[],e.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");e.length===1&&(((i=(n=Jt(e[0],_s,7))==null?void 0:n.l())==null?void 0:i.g())??new Map).forEach((r,s)=>{t.s[Number(s)]=la(r,1)})})(this)}fa(t,e,n){const i=typeof e!="function"?e:{};return this.j=typeof e=="function"?e:n,bO(this),no(this,t,i),AO(this)}Na(t,e,n,i){const r=typeof n!="function"?n:{};return this.j=typeof n=="function"?n:i,bO(this),ga(this,t,r,e),AO(this)}Fa(){return this.s}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect");const e=new _s;Oo(e,t8,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),n.o(e),Ts(t,n),PC(this,t),this.outputConfidenceMasks&&(tn(t,"confidence_masks"),jt(n,"CONFIDENCE_MASKS:confidence_masks"),jd(this,"confidence_masks"),this.g.da("confidence_masks",(i,r)=>{this.confidenceMasks=i.map(s=>qd(this,s,!0,!this.j)),Be(this,r)}),this.g.attachEmptyPacketListener("confidence_masks",i=>{this.confidenceMasks=[],Be(this,i)})),this.outputCategoryMask&&(tn(t,"category_mask"),jt(n,"CATEGORY_MASK:category_mask"),jd(this,"category_mask"),this.g.V("category_mask",(i,r)=>{this.categoryMask=qd(this,i,!1,!this.j),Be(this,r)}),this.g.attachEmptyPacketListener("category_mask",i=>{this.categoryMask=void 0,Be(this,i)})),tn(t,"quality_scores"),jt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(i,r)=>{this.qualityScores=i,Be(this,r)}),this.g.attachEmptyPacketListener("quality_scores",i=>{this.categoryMask=void 0,Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Nr.prototype.getLabels=Nr.prototype.Fa,Nr.prototype.segmentForVideo=Nr.prototype.Na,Nr.prototype.segment=Nr.prototype.fa,Nr.prototype.setOptions=Nr.prototype.o,Nr.createFromModelPath=function(t,e){return Ht(Nr,t,{baseOptions:{modelAssetPath:e}})},Nr.createFromModelBuffer=function(t,e){return Ht(Nr,t,{baseOptions:{modelAssetBuffer:e}})},Nr.createFromOptions=function(t,e){return Ht(Nr,t,e)};var FT=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){var t,e;(t=this.confidenceMasks)==null||t.forEach(n=>{n.close()}),(e=this.categoryMask)==null||e.close()}};FT.prototype.close=FT.prototype.close;var Yde=class extends Ye{constructor(t){super(t)}},kh=[0,Yn,-2],Z1=[0,ka,-3,Bn,ka,-1],PO=[0,Z1],IO=[0,Z1,Yn,-1],nE=class extends Ye{constructor(t){super(t)}},MO=[0,ka,-1,Bn],Jde=class extends Ye{constructor(){super()}},kO=class extends Ye{constructor(t){super(t)}},zT=[1,2,3,4,5,6,7,8,9,10,14,15],y8=class extends Ye{constructor(){super()}};y8.prototype.g=RC([0,vi,[0,zT,dn,Z1,dn,[0,Z1,kh],dn,PO,dn,[0,PO,kh],dn,MO,dn,[0,ka,-3,Bn,Mo],dn,[0,ka,-3,Bn],dn,[0,ln,ka,-2,Bn,Yn,Bn,-1,2,ka,kh],dn,IO,dn,[0,IO,kh],ka,kh,ln,dn,[0,ka,-3,Bn,kh,-1],dn,[0,vi,MO]],ln,[0,ln,Yn,-1,Bn]]);var Go=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new pP,this.s=new Z$,lt(this.h,0,3,this.s),lt(t=this.h,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}fa(t,e,n,i){const r=typeof n!="function"?n:{};this.j=typeof n=="function"?n:i,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,i=new y8;const s=new kO;var o=new Yde;if(ca(o,1,255),lt(s,0,12,o),e.keypoint&&e.scribble)throw Error("Cannot provide both keypoint and scribble.");if(e.keypoint){var a=new nE;l0(a,3,!0),tt(a,1,e.keypoint.x),tt(a,2,e.keypoint.y),Eg(s,5,zT,a)}else{if(!e.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(o=new Jde,e.scribble))l0(e=new nE,3,!0),tt(e,1,a.x),tt(e,2,a.y),X1(o,1,nE,e);Eg(s,15,zT,o)}X1(i,1,kO,s),this.g.addProtoToStream(i.g(),"drishti.RenderData","roi_in",n),no(this,t,r);e:{try{const c=new FT(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=c;break e}this.j(c)}finally{IC(this)}l=void 0}return l}m(){var t=new Jr;kn(t,"image_in"),kn(t,"roi_in"),kn(t,"norm_rect_in");const e=new _s;Oo(e,t8,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),En(n,"IMAGE:image_in"),En(n,"ROI:roi_in"),En(n,"NORM_RECT:norm_rect_in"),n.o(e),Ts(t,n),PC(this,t),this.outputConfidenceMasks&&(tn(t,"confidence_masks"),jt(n,"CONFIDENCE_MASKS:confidence_masks"),jd(this,"confidence_masks"),this.g.da("confidence_masks",(i,r)=>{this.confidenceMasks=i.map(s=>qd(this,s,!0,!this.j)),Be(this,r)}),this.g.attachEmptyPacketListener("confidence_masks",i=>{this.confidenceMasks=[],Be(this,i)})),this.outputCategoryMask&&(tn(t,"category_mask"),jt(n,"CATEGORY_MASK:category_mask"),jd(this,"category_mask"),this.g.V("category_mask",(i,r)=>{this.categoryMask=qd(this,i,!1,!this.j),Be(this,r)}),this.g.attachEmptyPacketListener("category_mask",i=>{this.categoryMask=void 0,Be(this,i)})),tn(t,"quality_scores"),jt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(i,r)=>{this.qualityScores=i,Be(this,r)}),this.g.attachEmptyPacketListener("quality_scores",i=>{this.categoryMask=void 0,Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Go.prototype.segment=Go.prototype.fa,Go.prototype.setOptions=Go.prototype.o,Go.createFromModelPath=function(t,e){return Ht(Go,t,{baseOptions:{modelAssetPath:e}})},Go.createFromModelBuffer=function(t,e){return Ht(Go,t,{baseOptions:{modelAssetBuffer:e}})},Go.createFromOptions=function(t,e){return Ht(Go,t,e)};var Ms=class extends qr{constructor(t,e){super(new to(t,e),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},lt(t=this.h=new n8,0,1,e=new Fn)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Cn(this.h,2,vp(t.displayNamesLocale)):"displayNamesLocale"in t&&Cn(this.h,2),t.maxResults!==void 0?ca(this.h,3,t.maxResults):"maxResults"in t&&Cn(this.h,3),t.scoreThreshold!==void 0?tt(this.h,4,t.scoreThreshold):"scoreThreshold"in t&&Cn(this.h,4),t.categoryAllowlist!==void 0?K1(this.h,5,t.categoryAllowlist):"categoryAllowlist"in t&&Cn(this.h,5),t.categoryDenylist!==void 0?K1(this.h,6,t.categoryDenylist):"categoryDenylist"in t&&Cn(this.h,6),this.l(t)}D(t,e){return this.j={detections:[]},no(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},ga(this,t,n,e),this.j}m(){var t=new Jr;kn(t,"input_frame_gpu"),kn(t,"norm_rect"),tn(t,"detections");const e=new _s;Oo(e,jde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),En(n,"IMAGE:input_frame_gpu"),En(n,"NORM_RECT:norm_rect"),jt(n,"DETECTIONS:detections"),n.o(e),Ts(t,n),this.g.attachProtoVectorListener("detections",(i,r)=>{for(const s of i)i=k$(s),this.j.detections.push(r8(i));Be(this,r)}),this.g.attachEmptyPacketListener("detections",i=>{Be(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ms.prototype.detectForVideo=Ms.prototype.F,Ms.prototype.detect=Ms.prototype.D,Ms.prototype.setOptions=Ms.prototype.o,Ms.createFromModelPath=async function(t,e){return Ht(Ms,t,{baseOptions:{modelAssetPath:e}})},Ms.createFromModelBuffer=function(t,e){return Ht(Ms,t,{baseOptions:{modelAssetBuffer:e}})},Ms.createFromOptions=function(t,e){return Ht(Ms,t,e)};var UT=class{constructor(t,e,n){this.landmarks=t,this.worldLandmarks=e,this.segmentationMasks=n}close(){var t;(t=this.segmentationMasks)==null||t.forEach(e=>{e.close()})}};function LO(t){t.landmarks=[],t.worldLandmarks=[],t.segmentationMasks=void 0}function DO(t){try{const e=new UT(t.landmarks,t.worldLandmarks,t.segmentationMasks);if(!t.s)return e;t.s(e)}finally{IC(t)}}UT.prototype.close=UT.prototype.close;var as=class extends qr{constructor(t,e){super(new to(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,lt(t=this.h=new i8,0,1,e=new Fn),this.v=new K$,lt(this.h,0,3,this.v),this.j=new X$,lt(this.h,0,2,this.j),ca(this.j,4,1),tt(this.j,2,.5),tt(this.v,2,.5),tt(this.h,4,.5)}get baseOptions(){return Jt(this.h,Fn,1)}set baseOptions(t){lt(this.h,0,1,t)}o(t){return"numPoses"in t&&ca(this.j,4,t.numPoses??1),"minPoseDetectionConfidence"in t&&tt(this.j,2,t.minPoseDetectionConfidence??.5),"minTrackingConfidence"in t&&tt(this.h,4,t.minTrackingConfidence??.5),"minPosePresenceConfidence"in t&&tt(this.v,2,t.minPosePresenceConfidence??.5),"outputSegmentationMasks"in t&&(this.outputSegmentationMasks=t.outputSegmentationMasks??!1),this.l(t)}D(t,e,n){const i=typeof e!="function"?e:{};return this.s=typeof e=="function"?e:n,LO(this),no(this,t,i),DO(this)}F(t,e,n,i){const r=typeof n!="function"?n:{};return this.s=typeof n=="function"?n:i,LO(this),ga(this,t,r,e),DO(this)}m(){var t=new Jr;kn(t,"image_in"),kn(t,"norm_rect"),tn(t,"normalized_landmarks"),tn(t,"world_landmarks"),tn(t,"segmentation_masks");const e=new _s;Oo(e,Wde,this.h);const n=new Ar;Rs(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),En(n,"IMAGE:image_in"),En(n,"NORM_RECT:norm_rect"),jt(n,"NORM_LANDMARKS:normalized_landmarks"),jt(n,"WORLD_LANDMARKS:world_landmarks"),n.o(e),Ts(t,n),PC(this,t),this.g.attachProtoVectorListener("normalized_landmarks",(i,r)=>{this.landmarks=[];for(const s of i)i=G0(s),this.landmarks.push(AC(i));Be(this,r)}),this.g.attachEmptyPacketListener("normalized_landmarks",i=>{this.landmarks=[],Be(this,i)}),this.g.attachProtoVectorListener("world_landmarks",(i,r)=>{this.worldLandmarks=[];for(const s of i)i=vd(s),this.worldLandmarks.push(bg(i));Be(this,r)}),this.g.attachEmptyPacketListener("world_landmarks",i=>{this.worldLandmarks=[],Be(this,i)}),this.outputSegmentationMasks&&(jt(n,"SEGMENTATION_MASK:segmentation_masks"),jd(this,"segmentation_masks"),this.g.da("segmentation_masks",(i,r)=>{this.segmentationMasks=i.map(s=>qd(this,s,!0,!this.s)),Be(this,r)}),this.g.attachEmptyPacketListener("segmentation_masks",i=>{this.segmentationMasks=[],Be(this,i)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};as.prototype.detectForVideo=as.prototype.F,as.prototype.detect=as.prototype.D,as.prototype.setOptions=as.prototype.o,as.createFromModelPath=function(t,e){return Ht(as,t,{baseOptions:{modelAssetPath:e}})},as.createFromModelBuffer=function(t,e){return Ht(as,t,{baseOptions:{modelAssetBuffer:e}})},as.createFromOptions=function(t,e){return Ht(as,t,e)},as.POSE_CONNECTIONS=v8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qde=1e-7,Zde=1e-4;class epe{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class S8{refCount(e){return Or("refCount")}incRef(e){return Or("incRef")}timerAvailable(){return!0}time(e){return Or("time")}read(e){return Or("read")}readSync(e){return Or("readSync")}readToGPU(e,n){return Or("readToGPU")}numDataIds(){return Or("numDataIds")}disposeData(e,n){return Or("disposeData")}write(e,n,i){return Or("write")}move(e,n,i,r,s){return Or("move")}createTensorFromGPUData(e,n,i){return Or("createTensorFromGPUData")}memory(){return Or("memory")}floatPrecision(){return Or("floatPrecision")}epsilon(){return this.floatPrecision()===32?Qde:Zde}dispose(){return Or("dispose")}}function Or(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eS(t,e,n){return Math.max(t,Math.min(e,n))}function bP(t){return t%2===0?t:t+1}function Wm(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function tpe(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function we(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function x8(t,e,n=""){we(Ni(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function Re(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Ni(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function tS(t){return t%1===0}function BT(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function yd(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function NO(t,e=r=>0,n,i){return new Promise((r,s)=>{let o=0;const a=()=>{if(t()){r();return}o++;const l=e(o);if(n!=null&&o>=n){s();return}i!=null?i(a,l):setTimeout(a,l)};a()})}function npe(t,e){let n=1,i=-1;for(let s=0;s<t.length;++s)if(t[s]>=0)n*=t[s];else if(t[s]===-1){if(i!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${i} and dim ${s}`);i=s}else if(t[s]<0)throw Error(`Shapes can not be < 0. Found ${t[s]} at dim ${s}`);if(i===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[i]=e/n,r}function kr(t,e){const n=e.length;return t=t==null?e.map((i,r)=>r):[].concat(t),we(t.every(i=>i>=-n&&i<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),we(t.every(i=>tS(i)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(i=>i<0?n+i:i)}function Qu(t,e){const n=[],i=[];for(let r=0;r<t.length;++r)t[r]!==1&&(n.push(t[r]),i.push(r));return{newShape:n,keptDims:i}}function zu(t,e){return _i(t,e)}function _i(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function ipe(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${e} being uploaded contains ${i}.`)}}function rpe(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function spe(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function nS(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function ope(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function DC(t){return typeof t=="string"||t instanceof String}function ape(t){return typeof t=="boolean"}function lpe(t){return typeof t=="number"}function q0(t){return Array.isArray(t)?q0(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":lpe(t)?"float32":DC(t)?"string":ape(t)?"bool":"float32"}function $T(t){return!!(t&&t.constructor&&t.call&&t.apply)}function HT(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Di(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let i=e-3;i>=0;--i)n[i]=n[i+1]*t[i+1];return n}function C8(t,e,n,i=!1){const r=new Array;if(e.length===1){const s=e[0]*(i?2:1);for(let o=0;o<s;o++)r[o]=n[t+o]}else{const s=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(i?2:1);for(let l=0;l<s;l++)r[l]=C8(t+l*a,o,n,i)}return r}function OO(t,e,n=!1){if(t.length===0)return e[0];const i=t.reduce((r,s)=>r*s)*(n?2:1);if(i===0)return[];if(i!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return C8(0,t,e,n)}function cpe(t,e){const n=uc(t,e);for(let i=0;i<n.length;i++)n[i]=1;return n}function uc(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function X0(t){t.forEach(e=>{we(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function VT(t,e,n){if(e===0)return 0;if(e===1)return t[0];let i=t[t.length-1];for(let r=0;r<t.length-1;++r)i+=n[r]*t[r];return i}function AP(t,e,n){if(e===0)return[];if(e===1)return[t];const i=new Array(e);for(let r=0;r<i.length-1;++r)i[r]=Math.floor(t/n[r]),t-=i[r]*n[r];return i[i.length-1]=t,i}function PP(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FO="tfjsflags";class upe{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=hpe,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,i){if(this.flagRegistry[e]={evaluationFn:n,setHook:i},this.urlFlags[e]!=null){const r=this.urlFlags[e];Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(PP(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);FO in e&&e[FO].split(",").forEach(i=>{const[r,s]=i.split(":");this.urlFlags[r]=ppe(r,s)})}}function hpe(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...i)=>(dpe(e,i[0],i[1]),i.join("="))),e}function dpe(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function ppe(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function Q(){return _8}let _8=null;function fpe(t){_8=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let iE;function w8(){if(iE==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");iE=t}return iE}function mpe(){const t=w8();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function IP(t,e){const n=mpe();if(n.has(t))return n.get(t);{const i=e();return n.set(t,i),n.get(t)}}const E8="Abs",gpe="Acos",vpe="Acosh",MP="Add",ype="AddN",Spe="All",xpe="Any",Cpe="ArgMax",_pe="ArgMin",wpe="Asin",Epe="Asinh",Rpe="Atan",Tpe="Atanh",bpe="Atan2",Ape="AvgPool",Ppe="AvgPoolGrad",Ipe="AvgPool3D",Mpe="AvgPool3DGrad",kpe="BatchMatMul",Lpe="BatchToSpaceND",Dpe="Bincount",Npe="BitwiseAnd",Ope="BroadcastArgs",kP="Cast",Fpe="Ceil",zpe="ClipByValue",R8="Complex",T8="ComplexAbs",Upe="Concat",Bpe="Conv2D",$pe="Conv2DBackpropFilter",Hpe="Conv2DBackpropInput",Vpe="Conv3D",jpe="Conv3DBackpropFilterV2",Wpe="Conv3DBackpropInputV2",Gpe="Cos",qpe="Cosh",Xpe="Cumprod",Kpe="Cumsum",Ype="CropAndResize",Jpe="DenseBincount",Qpe="DepthToSpace",Zpe="DepthwiseConv2dNative",efe="DepthwiseConv2dNativeBackpropFilter",tfe="DepthwiseConv2dNativeBackpropInput",nfe="Diag",ife="Dilation2D",b8="RealDiv",rfe="Einsum",A8="Elu",sfe="EluGrad",ofe="Erf",afe="Equal",lfe="Exp",cfe="ExpandDims",ufe="Expm1",hfe="FFT",P8="Fill",dfe="FlipLeftRight",pfe="Floor",I8="FloorDiv",ffe="FusedBatchNorm",mfe="GatherV2",gfe="GatherNd",vfe="Greater",yfe="GreaterEqual",LP="Identity",Sfe="IFFT",xfe="Imag",Cfe="IsFinite",_fe="IsInf",wfe="IsNan",M8="LeakyRelu",Efe="Less",Rfe="LessEqual",Tfe="LinSpace",bfe="Log",Afe="Log1p",Pfe="LogicalAnd",Ife="LogicalNot",Mfe="LogicalOr",kfe="LRN",Lfe="LRNGrad",Dfe="Max",k8="Maximum",Nfe="MaxPool",Ofe="MaxPoolGrad",Ffe="MaxPool3D",zfe="MaxPool3DGrad",Ufe="MaxPoolWithArgmax",Bfe="Mean",$fe="Min",Hfe="Minimum",Vfe="MirrorPad",jfe="Mod",Wfe="Multinomial",L8="Multiply",Gfe="Neg",qfe="NotEqual",Xfe="NonMaxSuppressionV3",Kfe="NonMaxSuppressionV4",Yfe="NonMaxSuppressionV5",Jfe="OnesLike",Qfe="OneHot",Zfe="Pack",eme="PadV2",D8="Pow",N8="Prelu",tme="Prod",nme="RaggedGather",ime="RaggedRange",rme="RaggedTensorToTensor",sme="Range",ome="Real",ame="Reciprocal",O8="Relu",F8="Reshape",lme="ResizeNearestNeighbor",cme="ResizeNearestNeighborGrad",ume="ResizeBilinear",hme="ResizeBilinearGrad",z8="Relu6",dme="Reverse",pme="Round",fme="Rsqrt",mme="ScatterNd",gme="TensorScatterUpdate",vme="SearchSorted",yme="Select",Sme="Selu",xme="Slice",Cme="Sin",_me="Sinh",wme="Sign",U8="Sigmoid",Eme="Softplus",B8="Sqrt",$8="Sum",Rme="SpaceToBatchND",Tme="SplitV",bme="Softmax",Ame="SparseFillEmptyRows",Pme="SparseReshape",Ime="SparseSegmentMean",Mme="SparseSegmentSum",kme="SparseToDense",Lme="SquaredDifference",Dme="Square",Nme="StaticRegexReplace",Ome="StridedSlice",Fme="StringNGrams",zme="StringSplit",Ume="StringToHashBucketFast",H8="Sub",Bme="Tan",$me="Tanh",V8="Tile",Hme="TopK",Vme="Transform",jme="Transpose",Wme="Unique",Gme="Unpack",qme="UnsortedSegmentSum",j8="ZerosLike",W8="Step",Xme="FromPixels",Kme="RotateWithOffset",Yme="_FusedMatMul",Jme="FusedConv2D",Qme="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eo(...t){Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(...t)}function Zme(...t){Q().getBool("IS_TEST")||Q().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iS=IP("kernelRegistry",()=>new Map),ege=IP("gradRegistry",()=>new Map);function zO(t,e){const n=G8(t,e);return iS.get(n)}function UO(t){return ege.get(t)}function BO(t){const e=iS.entries(),n=[];for(;;){const{done:i,value:r}=e.next();if(i)break;const[s,o]=r,[a]=s.split("_");a===t&&n.push(o)}return n}function tge(t){const{kernelName:e,backendName:n}=t,i=G8(e,n);iS.has(i)&&Eo(`The kernel '${e}' for backend '${n}' is already registered`),iS.set(i,t)}function G8(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var X8=Rn,Hs=null;try{Hs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Rn(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Rn.prototype.__isLong__;Object.defineProperty(Rn.prototype,"__isLong__",{value:!0});function Qr(t){return(t&&t.__isLong__)===!0}Rn.isLong=Qr;var $O={},HO={};function Zu(t,e){var n,i,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(i=HO[t],i)?i:(n=Tn(t,(t|0)<0?-1:0,!0),r&&(HO[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(i=$O[t],i)?i:(n=Tn(t,t<0?-1:0,!1),r&&($O[t]=n),n))}Rn.fromInt=Zu;function Vs(t,e){if(isNaN(t))return e?fu:js;if(e){if(t<0)return fu;if(t>=K8)return Q8}else{if(t<=-jO)return Hr;if(t+1>=jO)return J8}return t<0?Vs(-t,e).neg():Tn(t%Xd|0,t/Xd|0,e)}Rn.fromNumber=Vs;function Tn(t,e,n){return new Rn(t,e,n)}Rn.fromBits=Tn;var rS=Math.pow;function DP(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return js;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return DP(t.substring(1),e,n).neg();for(var r=Vs(rS(n,8)),s=js,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=Vs(rS(n,a));s=s.mul(c).add(Vs(l))}else s=s.mul(r),s=s.add(Vs(l))}return s.unsigned=e,s}Rn.fromString=DP;function Bo(t,e){return typeof t=="number"?Vs(t,e):typeof t=="string"?DP(t,e):Tn(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Rn.fromValue=Bo;var VO=65536,nge=1<<24,Xd=VO*VO,K8=Xd*Xd,jO=K8/2,WO=Zu(nge),js=Zu(0);Rn.ZERO=js;var fu=Zu(0,!0);Rn.UZERO=fu;var td=Zu(1);Rn.ONE=td;var Y8=Zu(1,!0);Rn.UONE=Y8;var jT=Zu(-1);Rn.NEG_ONE=jT;var J8=Tn(-1,2147483647,!1);Rn.MAX_VALUE=J8;var Q8=Tn(-1,-1,!0);Rn.MAX_UNSIGNED_VALUE=Q8;var Hr=Tn(0,-2147483648,!1);Rn.MIN_VALUE=Hr;var Ee=Rn.prototype;Ee.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ee.toNumber=function(){return this.unsigned?(this.high>>>0)*Xd+(this.low>>>0):this.high*Xd+(this.low>>>0)};Ee.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Hr)){var n=Vs(e),i=this.div(n),r=i.mul(n).sub(this);return i.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=Vs(rS(e,6),this.unsigned),o=this,a="";;){var l=o.div(s),c=o.sub(l.mul(s)).toInt()>>>0,u=c.toString(e);if(o=l,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};Ee.getHighBits=function(){return this.high};Ee.getHighBitsUnsigned=function(){return this.high>>>0};Ee.getLowBits=function(){return this.low};Ee.getLowBitsUnsigned=function(){return this.low>>>0};Ee.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Hr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};Ee.isZero=function(){return this.high===0&&this.low===0};Ee.eqz=Ee.isZero;Ee.isNegative=function(){return!this.unsigned&&this.high<0};Ee.isPositive=function(){return this.unsigned||this.high>=0};Ee.isOdd=function(){return(this.low&1)===1};Ee.isEven=function(){return(this.low&1)===0};Ee.equals=function(e){return Qr(e)||(e=Bo(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Ee.eq=Ee.equals;Ee.notEquals=function(e){return!this.eq(e)};Ee.neq=Ee.notEquals;Ee.ne=Ee.notEquals;Ee.lessThan=function(e){return this.comp(e)<0};Ee.lt=Ee.lessThan;Ee.lessThanOrEqual=function(e){return this.comp(e)<=0};Ee.lte=Ee.lessThanOrEqual;Ee.le=Ee.lessThanOrEqual;Ee.greaterThan=function(e){return this.comp(e)>0};Ee.gt=Ee.greaterThan;Ee.greaterThanOrEqual=function(e){return this.comp(e)>=0};Ee.gte=Ee.greaterThanOrEqual;Ee.ge=Ee.greaterThanOrEqual;Ee.compare=function(e){if(Qr(e)||(e=Bo(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Ee.comp=Ee.compare;Ee.negate=function(){return!this.unsigned&&this.eq(Hr)?Hr:this.not().add(td)};Ee.neg=Ee.negate;Ee.add=function(e){Qr(e)||(e=Bo(e));var n=this.high>>>16,i=this.high&65535,r=this.low>>>16,s=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,h=0,d=0,p=0;return p+=s+c,d+=p>>>16,p&=65535,d+=r+l,h+=d>>>16,d&=65535,h+=i+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,Tn(d<<16|p,u<<16|h,this.unsigned)};Ee.subtract=function(e){return Qr(e)||(e=Bo(e)),this.add(e.neg())};Ee.sub=Ee.subtract;Ee.multiply=function(e){if(this.isZero())return js;if(Qr(e)||(e=Bo(e)),Hs){var n=Hs.mul(this.low,this.high,e.low,e.high);return Tn(n,Hs.get_high(),this.unsigned)}if(e.isZero())return js;if(this.eq(Hr))return e.isOdd()?Hr:js;if(e.eq(Hr))return this.isOdd()?Hr:js;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(WO)&&e.lt(WO))return Vs(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=this.high&65535,s=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,h=0,d=0,p=0,f=0;return f+=o*u,p+=f>>>16,f&=65535,p+=s*u,d+=p>>>16,p&=65535,p+=o*c,d+=p>>>16,p&=65535,d+=r*u,h+=d>>>16,d&=65535,d+=s*c,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=i*u+r*c+s*l+o*a,h&=65535,Tn(p<<16|f,h<<16|d,this.unsigned)};Ee.mul=Ee.multiply;Ee.divide=function(e){if(Qr(e)||(e=Bo(e)),e.isZero())throw Error("division by zero");if(Hs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Hs.div_u:Hs.div_s)(this.low,this.high,e.low,e.high);return Tn(n,Hs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?fu:js;var i,r,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return fu;if(e.gt(this.shru(1)))return Y8;s=fu}else{if(this.eq(Hr)){if(e.eq(td)||e.eq(jT))return Hr;if(e.eq(Hr))return td;var o=this.shr(1);return i=o.div(e).shl(1),i.eq(js)?e.isNegative()?td:jT:(r=this.sub(e.mul(i)),s=i.add(r.div(e)),s)}else if(e.eq(Hr))return this.unsigned?fu:js;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=js}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),l=a<=48?1:rS(2,a-48),c=Vs(i),u=c.mul(e);u.isNegative()||u.gt(r);)i-=l,c=Vs(i,this.unsigned),u=c.mul(e);c.isZero()&&(c=td),s=s.add(c),r=r.sub(u)}return s};Ee.div=Ee.divide;Ee.modulo=function(e){if(Qr(e)||(e=Bo(e)),Hs){var n=(this.unsigned?Hs.rem_u:Hs.rem_s)(this.low,this.high,e.low,e.high);return Tn(n,Hs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Ee.mod=Ee.modulo;Ee.rem=Ee.modulo;Ee.not=function(){return Tn(~this.low,~this.high,this.unsigned)};Ee.and=function(e){return Qr(e)||(e=Bo(e)),Tn(this.low&e.low,this.high&e.high,this.unsigned)};Ee.or=function(e){return Qr(e)||(e=Bo(e)),Tn(this.low|e.low,this.high|e.high,this.unsigned)};Ee.xor=function(e){return Qr(e)||(e=Bo(e)),Tn(this.low^e.low,this.high^e.high,this.unsigned)};Ee.shiftLeft=function(e){return Qr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Tn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Tn(0,this.low<<e-32,this.unsigned)};Ee.shl=Ee.shiftLeft;Ee.shiftRight=function(e){return Qr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Tn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Tn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Ee.shr=Ee.shiftRight;Ee.shiftRightUnsigned=function(e){if(Qr(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var i=this.low;return Tn(i>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?Tn(n,0,this.unsigned):Tn(n>>>e-32,0,this.unsigned)};Ee.shru=Ee.shiftRightUnsigned;Ee.shr_u=Ee.shiftRightUnsigned;Ee.toSigned=function(){return this.unsigned?Tn(this.low,this.high,!1):this};Ee.toUnsigned=function(){return this.unsigned?this:Tn(this.low,this.high,!0)};Ee.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Ee.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Ee.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Rn.fromBytes=function(e,n,i){return i?Rn.fromBytesLE(e,n):Rn.fromBytesBE(e,n)};Rn.fromBytesLE=function(e,n){return new Rn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Rn.fromBytesBE=function(e,n){return new Rn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const Z8=fS(X8),ige=cb({__proto__:null,default:Z8},[X8]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const su=Z8||ige;function NC(t){return su.fromString(t,!0,16)}const eH=NC("c3a5c85c97cb3127"),Zc=NC("b492b66fbe98f273"),hr=NC("9ae16a3b2f90404f");function WT(t){return t.xor(t.shru(47))}function tH(t,e,n){const i=t.slice(e,e+n);return su.fromBytes(Array.from(i),!0,!0)}function yn(t,e){return tH(t,e,8)}function GO(t,e){return tH(t,e,4)}function Si(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function Zl(t,e,n=NC("9ddfea08eb382d69")){let i=t.xor(e).mul(n);i=i.xor(i.shru(47));let r=e.xor(i).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function rge(t,e,n,i,r,s){r=r.add(t),s=Si(s.add(r).add(i),21);const o=r;return r=r.add(e),r=r.add(n),s=s.add(Si(r,44)),[r.add(i),s.add(o)]}function ly(t,e,n,i){return rge(yn(t,e),yn(t,e+8),yn(t,e+16),yn(t,e+24),n,i)}function sge(t,e=t.length){if(e>=8){const n=hr.add(e*2),i=yn(t,0).add(hr),r=yn(t,e-8),s=Si(r,37).mul(n).add(i),o=Si(i,25).add(r).mul(n);return Zl(s,o,n)}if(e>=4){const n=hr.add(e*2),i=GO(t,0);return Zl(i.shl(3).add(e),GO(t,e-4),n)}if(e>0){const n=t[0],i=t[e>>1],r=t[e-1],s=n+(i<<8),o=e+(r<<2);return WT(hr.mul(s).xor(eH.mul(o))).mul(hr)}return hr}function oge(t,e=t.length){const n=hr.add(e*2),i=yn(t,0).mul(Zc),r=yn(t,8),s=yn(t,e-8).mul(n),o=yn(t,e-16).mul(hr);return Zl(Si(i.add(r),43).add(Si(s,30)).add(o),i.add(Si(r.add(hr),18)).add(s),n)}function age(t,e=t.length){const n=hr.add(e*2),i=yn(t,0).mul(hr),r=yn(t,8),s=yn(t,e-8).mul(n),o=yn(t,e-16).mul(hr),a=Si(i.add(r),43).add(Si(s,30)).add(o),l=Zl(a,i.add(Si(r.add(hr),18)).add(s),n),c=yn(t,16).mul(n),u=yn(t,24),h=a.add(yn(t,e-32)).mul(n),d=l.add(yn(t,e-24)).mul(n);return Zl(Si(c.add(u),43).add(Si(h,30)).add(d),c.add(Si(u.add(i),18)).add(h),n)}function lge(t,e=t.length){const n=su.fromNumber(81,!0);if(e<=32)return e<=16?sge(t,e):oge(t,e);if(e<=64)return age(t,e);let i=n,r=n.mul(Zc).add(113),s=WT(r.mul(hr).add(113)).mul(hr),o=[su.UZERO,su.UZERO],a=[su.UZERO,su.UZERO];i=i.mul(hr).add(yn(t,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do i=Si(i.add(r).add(o[0]).add(yn(t,l+8)),37).mul(Zc),r=Si(r.add(o[1]).add(yn(t,l+48)),42).mul(Zc),i=i.xor(a[1]),r=r.add(o[0]).add(yn(t,l+40)),s=Si(s.add(a[0]),33).mul(Zc),o=ly(t,l,o[1].mul(Zc),i.add(a[0])),a=ly(t,l+32,s.add(a[1]),r.add(yn(t,l+16))),[s,i]=[i,s],l+=64;while(l!==c);const h=Zc.add(s.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),i=Si(i.add(r).add(o[0]).add(yn(t,l+8)),37).mul(h),r=Si(r.add(o[1]).add(yn(t,l+48)),42).mul(h),i=i.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(yn(t,l+40))),s=Si(s.add(a[0]),33).mul(h),o=ly(t,l,o[1].mul(h),i.add(a[0])),a=ly(t,l+32,s.add(a[1]),r.add(yn(t,l+16))),[s,i]=[i,s],Zl(Zl(o[0],a[0],h).add(WT(r).mul(eH)).add(s),Zl(o[1],a[1],h).add(i),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _p(t,e){return e==="string"?Cu(t):OC([t],e)}function cge(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function OC(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Uu(t)),Q().getBool("DEBUG")&&ipe(t,e),cge(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let i=0;i<n.length;++i)Math.round(t[i])!==0&&(n[i]=1);return n}else throw new Error(`Unknown data type ${e}`)}function vo(){return Q().platform.now()}function Cu(t,e="utf-8"){return e=e||"utf-8",Q().platform.encode(t,e)}function Kd(t,e="utf-8"){return e=e||"utf-8",Q().platform.decode(t,e)}function Qs(t){return Q().platform.isTypedArray!=null?Q().platform.isTypedArray(t):q8(t)}function Uu(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||PP(t)||t==null||Qs(t)&&n)e.push(t);else if(Array.isArray(t)||Qs(t))for(let i=0;i<t.length;++i)Uu(t[i],e,n);else{let i=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(i=Math.max(i,Number(r)));for(let r=0;r<=i;r++)Uu(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uge{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new dge)}profileKernel(e,n,i){let r;const s=()=>{r=i()};let o;const a=vo();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const c of r)c.dataSync();o=Promise.resolve({kernelMs:vo()-a})}if(Q().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const u=r[c];u.data().then(h=>{hge(h,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:i,timeMs:r,inputs:s,extraInfo:o}=e;i.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],s,l[2])})})}}function hge(t,e,n){if(e!=="float32")return!1;for(let i=0;i<t.length;i++){const r=t[i];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class dge{logKernelProfile(e,n,i,r,s,o){const a=typeof r=="number"?yd(`${r}ms`,9):r.error,l=yd(e,25),c=n.rank,u=n.size,h=yd(n.shape.toString(),14);let d="";for(const p in s){const f=s[p];if(f!=null){const v=f.shape||n.shape,g=v.length;d+=`${p}: ${g}D ${g>0?v:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${h}	%c${u}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pge(t,e,n){const i={},r={};for(let l=0;l<e.length;l++)i[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const h in u){const d=u[h];let p=!1;for(let f=0;f<e.length;f++)if(i[d.id]){c.outputs.forEach(v=>i[v.id]=!0),p=!0,r[c.id]=!0;break}if(p)break}}const s={};s[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let h=0;h<c.outputs.length;h++)if(s[c.outputs[h].id]){for(const d in u)s[u[d].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(r[c.id]&&o[c.id]){const u={};for(const d in c.inputs){const p=c.inputs[d];i[p.id]&&(u[d]=p)}const h=Object.assign({},c);h.inputs=u,h.outputs=c.outputs,a.push(h)}}return a}function fge(t,e,n,i){for(let r=e.length-1;r>=0;r--){const s=e[r],o=[];if(s.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const l in s.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=s.inputs[l];if(!Ni(c.shape,u.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const h=t[u.id];t[u.id]=i(h,c),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qO=20,Gm=3,rE=7;function mge(t,e,n,i){const r=Di(e),s=gge(t,e,n,r),o=e.length,a=Ky(t,e,n,r,s),l=["Tensor"];return i&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function gge(t,e,n,i){const r=Re(e),s=i[i.length-1],o=new Array(s).fill(0),a=e.length,l=n==="complex64"?sg(t):t;if(a>1)for(let c=0;c<r/s;c++){const u=c*s;for(let h=0;h<s;h++)o[h]=Math.max(o[h],rg(l[u+h],0,n).length)}return o}function rg(t,e,n){let i;return Array.isArray(t)?i=`${parseFloat(t[0].toFixed(rE))} + ${parseFloat(t[1].toFixed(rE))}j`:DC(t)?i=`'${t}'`:n==="bool"?i=nH(t):i=parseFloat(t.toFixed(rE)).toString(),yd(i,e)}function nH(t){return t===0?"false":"true"}function Ky(t,e,n,i,r,s=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const v=sg(t);return[rg(v[0],0,n)]}return n==="bool"?[nH(t[0])]:[t[0].toString()]}if(l===1){if(a>qO){const g=Gm*o;let m=Array.from(t.slice(0,g)),y=Array.from(t.slice((a-Gm)*o,a*o));return n==="complex64"&&(m=sg(m),y=sg(y)),["["+m.map((S,x)=>rg(S,r[x],n)).join(", ")+", ..., "+y.map((S,x)=>rg(S,r[a-Gm+x],n)).join(", ")+"]"]}return["["+(n==="complex64"?sg(t):Array.from(t)).map((g,m)=>rg(g,r[m],n)).join(", ")+"]"]}const c=e.slice(1),u=i.slice(1),h=i[0]*o,d=[];if(a>qO){for(let v=0;v<Gm;v++){const g=v*h,m=g+h;d.push(...Ky(t.slice(g,m),c,n,u,r,!1))}d.push("...");for(let v=a-Gm;v<a;v++){const g=v*h,m=g+h;d.push(...Ky(t.slice(g,m),c,n,u,r,v===a-1))}}else for(let v=0;v<a;v++){const g=v*h,m=g+h;d.push(...Ky(t.slice(g,m),c,n,u,r,v===a-1))}const p=l===2?",":"";d[0]="["+(a>0?d[0]+p:"");for(let v=1;v<d.length-1;v++)d[v]=" "+d[v]+p;let f=`,
`;for(let v=2;v<l;v++)f+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function sg(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sS{constructor(e,n,i){if(this.dtype=n,this.shape=e.slice(),this.size=Re(e),i!=null){const r=i.length;we(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=i||_i(n,this.size),this.strides=Di(e)}set(e,...n){n.length===0&&(n=[0]),we(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const i=this.locToIndex(n);this.values[i]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const s=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(s)}n++}let i=e[e.length-1];for(let r=0;r<e.length-1;++r)i+=this.strides[r]*e[r];return this.values[i]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let i=0;i<e.length-1;++i)n+=this.strides[i]*e[i];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let i=0;i<n.length-1;++i)n[i]=Math.floor(e/this.strides[i]),e-=n[i]*this.strides[i];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return So().makeTensor(this.values,this.shape,this.dtype)}}let So=null,Dh=null;function vge(t){So=t}function yge(t){Dh=t}class xo{constructor(e,n,i,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=Re(e),this.strides=Di(e),this.dataId=i,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Dh.buffer(this.shape,this.dtype,e)}bufferSync(){return Dh.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return OO(this.shape,e,this.dtype==="complex64")}arraySync(){return OO(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=So().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(i=>Kd(i))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),So().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=So().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Kd(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await So().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),So().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Dh.print(this,e)}clone(){return this.throwIfDisposed(),Dh.clone(this)}toString(e=!1){const n=this.dataSync();return mge(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Dh.cast(this,e)}variable(e=!0,n,i){return this.throwIfDisposed(),So().makeVariable(this,e,n,i)}}Object.defineProperty(xo,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function iH(){return IP("Tensor",()=>xo)}iH();class oS extends xo{constructor(e,n,i,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=i}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ni(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);So().disposeTensor(this),this.dataId=e.dataId,So().incRef(this,null)}dispose(){So().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(oS,Symbol.hasInstance,{value:t=>t instanceof xo&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var XO;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(XO||(XO={}));var GT;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(GT||(GT={}));var qT;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(qT||(qT={}));var XT;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(XT||(XT={}));var KT;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(KT||(KT={}));const Sge={float32:XT,int32:GT,bool:qT,complex64:KT};function ua(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Sge[t][e]}function NP(t){return ua(t,"int32")}function rH(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function sH(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eh(t,e){if(t.dtype===e.dtype)return[t,e];const n=ua(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function oH(t){const e=[];return aH(t,e,new Set),e}function aH(t,e,n){if(t==null)return;if(t instanceof xo){e.push(t);return}if(!xge(t))return;const i=t;for(const r in i){const s=i[r];n.has(s)||(n.add(s),aH(s,e,n))}}function xge(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sE(t){return t.kernelName!=null}class KO{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Yd{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new KO}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const i=e[n];if(await this.initializeBackend(i).success){await this.setBackend(i);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,i=1){return e in this.registryFactory?(Eo(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:i},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:i}=this.initializeBackend(e);if(!(i?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new uge(this.backendInstance),!0}setupRegisteredKernels(){BO(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){BO(e).forEach(i=>{i.disposeFunc!=null&&i.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const i=n.factory();if(i&&!(i instanceof S8)&&typeof i.then=="function"){const r=++this.pendingBackendInitId,s=i.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Eo(`Initialization of backend ${e} failed`),Eo(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(i){return Eo(`Initialization of backend ${e} failed`),Eo(i.stack||i.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const i=e[n],{success:r,asyncInit:s}=this.initializeBackend(i);if(s||r)return{name:i,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const i=this.state.tensorInfo.get(n),r=i.backend,s=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),i.backend=e,e.move(n,s,i.shape,i.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let i=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}let r;return this.scopedRun(()=>this.startScope(i),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,i){e();try{const r=i();return n(),r}catch(r){throw n(),r}}nextTensorId(){return Yd.nextTensorId++}nextVariableId(){return Yd.nextVariableId++}clone(e){const n=st.runKernel(LP,{x:e}),i={x:e},r=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return st.runKernel(kP,l,c)}}),s=[];return this.addTapeNode(this.state.activeScope.name,i,[n],r,s,{}),n}runKernel(e,n,i){if(this.backendName==null&&this.backend,!(zO(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:i})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,i){const r=this.backend.numDataIds();let s=0;i.forEach(l=>{s+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-s-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,i=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=sE(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(sE(e)){const{kernelName:f,inputs:v,attrs:g}=e;this.backendName==null&&this.backend;const m=zO(f,this.backendName);we(m!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),a=()=>{const y=this.backend.numDataIds();l=m.kernelFunc({inputs:v,attrs:g,backend:this.backend});const S=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,y,S);const x=S.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(r){const w=this.getTensorsForGradient(f,v,x);i=this.saveTensorsForBackwardMode(w)}return x}}else{const{forwardFunc:f}=e,v=g=>{r&&(i=g.map(m=>this.keep(this.clone(m))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>f(this.backend,v));const m=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,g,m),m}}const{inputs:u,attrs:h}=e,d=sE(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(p=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),n=p.outputs)}),r&&this.addTapeNode(c,u,n,d,i,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(f=>u[f]!=null?u[f].shape:null),outputShapes:n.map(f=>f.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(i=>this.keep(this.clone(i)))}getTensorsForGradient(e,n,i){const r=UO(e);if(r!=null){const s=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(we(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=s.map(c=>n[c]);const l=i.filter((c,u)=>o[u]);return a.concat(l)}return[]}makeTensor(e,n,i,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");i=i||"float32",r=r||this.backend;let s=e;i==="string"&&DC(e[0])&&(s=e.map(l=>Cu(l)));const o=r.write(s,n,i),a=new xo(n,i,o,this.nextTensorId());if(this.trackTensor(a,r),i==="string"){const l=this.state.tensorInfo.get(o),c=ope(s);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,i,r){i=i||"float32";const s={dataId:e,shape:n,dtype:i};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(e,n){const{dataId:i,shape:r,dtype:s}=e,o=new xo(r,s,i,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,i,r){i=i||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const s=new oS(e,n,i,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*nS(e.dtype)),this.state.numBytes+=i,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:i})),e instanceof oS||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const i=e.size*nS(e.dtype);this.state.numBytes-=i}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,i=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-i;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,i,r,s,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:i,saved:s},l=UO(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=c=>(c=c.map((u,h)=>{if(u==null){const d=i[h],p=uc(d.size,d.dtype);return this.makeTensor(p,d.shape,d.dtype)}return u}),r(c.length>1?c:c[0],s,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=oH(e),i=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const o=this.state.activeScope.track[s];!o.kept&&!i.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===r.id&&this.track(s)})}gradients(e,n,i,r=!1){if(we(n.length>0,()=>"gradients() received an empty list of xs."),i!=null&&i.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${i.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));we(s instanceof xo,()=>"The result y returned by f() must be a tensor.");const o=pge(this.state.activeTape,n,s);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=i??Cge(s.shape),fge(a,o,c=>this.tidy(c),_ge);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:s,grads:l}})}customGrad(e){return we($T(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{we(n.every(a=>a instanceof xo),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let i;const r={};n.forEach((a,l)=>{r[l]=a});const s=(a,l)=>(i=e(...n,l),we(i.value instanceof xo,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),we($T(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),o=(a,l)=>{const c=i.gradFunc(a,l),u=Array.isArray(c)?c:[c];we(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),we(u.every(d=>d instanceof xo),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((d,p)=>{h[p]=()=>d}),h};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=vo(),i=await this.backend.time(e);return i.wallMs=vo()-n,i}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new KO;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Yd.nextTensorId=0;Yd.nextVariableId=0;function Cge(t){const e=cpe(Re(t),"float32");return st.makeTensor(e,t,"float32")}function lH(){const t=w8();if(t._tfengine==null){const e=new upe(t);t._tfengine=new Yd(e)}return fpe(t._tfengine.ENV),vge(()=>t._tfengine),t._tfengine}const st=lH();function _ge(t,e){const n={a:t,b:e};return st.runKernel(MP,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wge(){return typeof navigator<"u"&&navigator!=null}function cH(t){if(t||wge()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function uH(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pr=Q();Pr.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Pr.registerFlag("IS_BROWSER",()=>uH());Pr.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Pr.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Pr.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Pr.registerFlag("PROD",()=>!1);Pr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Pr.getBool("DEBUG"));Pr.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Pr.registerFlag("IS_TEST",()=>!1);Pr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Pr.getBool("DEBUG"));Pr.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Pr.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Pr.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ege(t,e){let n=t;if(Qs(t))return e==="string"?[]:[t.length];if(rH(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(sH(t))return[t.buffer.size/(e==null?4:nS(e))];if(!Array.isArray(t))return[];const i=[];for(;Array.isArray(n)||Qs(n)&&e!=="string";)i.push(n.length),n=n[0];return Array.isArray(t)&&Q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&hH(t,i,[]),i}function hH(t,e,n){if(n=n||[],!Array.isArray(t)&&!Qs(t)){we(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}we(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),we(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const i=e.slice(1);for(let r=0;r<t.length;++r)hH(t[r],i,n.concat(r))}function YO(t,e,n,i){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${i}' must be ${t} tensor, but got ${e} tensor`)}}function Qt(t,e,n,i="numeric"){if(t instanceof iH())return YO(i,t.dtype,e,n),t;let r=q0(t);if(r!=="string"&&["bool","int32","float32"].indexOf(i)>=0&&(r=i),YO(i,r,e,n),t==null||!Qs(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const s=Ege(t,r);!Qs(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?OC(t,r):Uu(t,[],!0);return st.makeTensor(a,s,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rge="__op";function zn(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const i=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+Rge;const r=(...s)=>{st.startScope(n);try{const o=i(...s);return PP(o)&&console.error("Cannot return a Promise inside of tidy."),st.endScope(o),o}catch(o){throw st.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tge(t,e){const n=Qt(t,"real","complex"),i=Qt(e,"imag","complex");x8(n.shape,i.shape,`real and imag shapes, ${n.shape} and ${i.shape}, must match in call to tf.complex().`);const r={real:n,imag:i};return st.runKernel(R8,r)}const bge=zn({complex_:Tge});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Age(t,e,n,i){if(i==null)i=q0(t);else if(i==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(sH(t)||rH(t)){if(i!=="float32"&&i!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${i}.`);return st.backend.createTensorFromGPUData(t,e||n,i)}if(!Qs(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){X0(e);const r=Re(e),s=Re(n);we(r===s,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${s}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==Re(e.slice(o)):!0;we(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Qs(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=i!=="string"?OC(t,i):Uu(t,[],!0),st.makeTensor(t,e,i)}class th{static join(e){return new th(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(i=>Qs(i)?i.buffer:i),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let i=0;i<e.length;i++){const r=e[i];i!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const s=n+r.byteLength;this.shards.push({buffer:r,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const i=this.findShardForByte(e);if(i===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,s=new ArrayBuffer(r),o=new Uint8Array(s);let a=0;for(let l=i;l<this.shards.length;l++){const c=this.shards[l],h=e+a-c.start,d=a,f=Math.min(n,c.end)-c.start,v=new Uint8Array(c.buffer,h,f-h);if(o.set(v,d),a+=v.length,n<c.end)break}return s}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const i=Pge(this.shards,n);return i===-1?-1:(this.previousShardIndex=i,this.previousShardIndex)}}function Pge(t,e){let n=0,i=t.length;for(;n<=i;){const r=Math.floor((i-n)/2)+n,s=e(t[r]);if(s===0)return r;s<0?i=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yl(){return st}function ii(t,e){return st.tidy(t,e)}function Ss(t){oH(t).forEach(n=>n.dispose())}function Ige(t){return st.keep(t)}function Mge(t){return st.setBackend(t)}function kge(t,e,n=1){return st.registerBackend(t,e,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OP=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function JO(t){return OP?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function Lge(t){if(OP)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let i=0,r=e.length;i<r;i++)n+=String.fromCharCode(e[i]);return btoa(n)}function Dge(t){if(OP){const i=Buffer.from(t,"base64");return i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let i=0;i<e.length;++i)n.set([e.charCodeAt(i)],i);return n.buffer}function dH(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function Nge(t,e,n){const i={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(i.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=e,i.weightData=n}return t.signature!=null&&(i.signature=t.signature),t.userDefinedMetadata!=null&&(i.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(i.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(i.initializerSignature=t.initializerSignature),i}async function Oge(t,e){let n,i;return t.weightsManifest!=null&&([n,i]=await e(t.weightsManifest)),Nge(t,n,i)}function FC(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:JO(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:JO(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new th(t.weightData).byteLength}}function QO(t){const e=[];for(const n of t)e.push(...n.weights);return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ii{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Ii.instance==null&&(Ii.instance=new Ii),Ii.instance}static registerSaveRouter(e){Ii.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Ii.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Ii.getHandlers(e,"save")}static getLoadHandlers(e,n){return Ii.getHandlers(e,"load",n)}static getHandlers(e,n,i){const r=[];return(n==="load"?Ii.getInstance().loadRouters:Ii.getInstance().saveRouters).forEach(o=>{const a=o(e,i);a!==null&&r.push(a)}),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YT="tensorflowjs",JT=1,mu="models_store",Fl="model_info_store";function pH(){if(!Q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function QT(t){const e=t.result;e.createObjectStore(mu,{keyPath:"modelPath"}),e.createObjectStore(Fl,{keyPath:"modelPath"})}class Bu{constructor(e){if(this.indexedDB=pH(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((i,r)=>{const s=this.indexedDB.open(YT,JT);s.onupgradeneeded=()=>QT(s),s.onsuccess=()=>{const o=s.result;if(n==null){const a=o.transaction(mu,"readonly"),c=a.objectStore(mu).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));i(c.result.modelArtifacts)},c.onerror=u=>(o.close(),r(c.error)),a.oncomplete=()=>o.close()}else{n.weightData=th.join(n.weightData);const a=FC(n),l=o.transaction(Fl,"readwrite");let c=l.objectStore(Fl),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return r(d)}let h;u.onsuccess=()=>{h=o.transaction(mu,"readwrite");const d=h.objectStore(mu);let p;try{p=d.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(f){return r(f)}p.onsuccess=()=>i({modelArtifactsInfo:a}),p.onerror=f=>{c=l.objectStore(Fl);const v=c.delete(this.modelPath);v.onsuccess=()=>(o.close(),r(p.error)),v.onerror=g=>(o.close(),r(p.error))}},u.onerror=d=>(o.close(),r(u.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},s.onerror=o=>r(s.error)})}}Bu.URL_SCHEME="indexeddb://";const fH=t=>Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Bu.URL_SCHEME)?Fge(t.slice(Bu.URL_SCHEME.length)):null;Ii.registerSaveRouter(fH);Ii.registerLoadRouter(fH);function Fge(t){return new Bu(t)}function zge(t){return t.startsWith(Bu.URL_SCHEME)?t.slice(Bu.URL_SCHEME.length):t}class Uge{constructor(){this.indexedDB=pH()}async listModels(){return new Promise((e,n)=>{const i=this.indexedDB.open(YT,JT);i.onupgradeneeded=()=>QT(i),i.onsuccess=()=>{const r=i.result,s=r.transaction(Fl,"readonly"),a=s.objectStore(Fl).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),s.oncomplete=()=>r.close()},i.onerror=r=>n(i.error)})}async removeModel(e){return e=zge(e),new Promise((n,i)=>{const r=this.indexedDB.open(YT,JT);r.onupgradeneeded=()=>QT(r),r.onsuccess=()=>{const s=r.result,o=s.transaction(Fl,"readwrite"),a=o.objectStore(Fl),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return s.close(),i(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),h=()=>{c=s.transaction(mu,"readwrite");const p=c.objectStore(mu).delete(e);p.onsuccess=()=>n(l.result.modelArtifactsInfo),p.onerror=f=>i(l.error)};u.onsuccess=h,u.onerror=d=>(h(),s.close(),i(l.error))}},l.onerror=u=>(s.close(),i(l.error)),o.oncomplete=()=>{c==null?s.close():c.oncomplete=()=>s.close()}},r.onerror=s=>i(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Na="/",Nh="tensorflowjs_models",mH="info",Bge="model_topology",$ge="weight_specs",Hge="weight_data",Vge="model_metadata";function gH(t){return{info:[Nh,t,mH].join(Na),topology:[Nh,t,Bge].join(Na),weightSpecs:[Nh,t,$ge].join(Na),weightData:[Nh,t,Hge].join(Na),modelMetadata:[Nh,t,Vge].join(Na)}}function vH(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function jge(t){const e=t.split(Na);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Na)}function Wge(t){return t.startsWith($u.URL_SCHEME)?t.slice($u.URL_SCHEME.length):t}class $u{constructor(e){if(!Q().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=gH(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),i=JSON.stringify(e.weightSpecs),r=FC(e),s=th.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,Lge(s));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw vH(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},i=JSON.parse(this.LS.getItem(this.keys.topology));if(i==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=i;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){const a=JSON.parse(s);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=Dge(o),n}}$u.URL_SCHEME="localstorage://";const yH=t=>Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith($u.URL_SCHEME)?Gge(t.slice($u.URL_SCHEME.length)):null;Ii.registerSaveRouter(yH);Ii.registerLoadRouter(yH);function Gge(t){return new $u(t)}class qge{constructor(){we(Q().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),we(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Nh+Na,i=Na+mH;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(n)&&s.endsWith(i)){const o=jge(s);e[o]=JSON.parse(this.LS.getItem(s))}}return e}async removeModel(e){e=Wge(e);const n=gH(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const i=JSON.parse(this.LS.getItem(n.info));return vH(n),i}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZO="://";class Ko{constructor(){this.managers={}}static getInstance(){return Ko.instance==null&&(Ko.instance=new Ko),Ko.instance}static registerManager(e,n){we(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(ZO)&&(e=e.slice(0,e.indexOf(ZO))),we(e.length>0,()=>"scheme must not be an empty string.");const i=Ko.getInstance();we(i.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),i.managers[e]=n}static getManager(e){const n=Ko.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Ko.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xge{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!Q().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",i=>{if(i.source===window&&i.data.name===this.messageName){i.stopPropagation();const r=this.functionRefs[i.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return q8(e)}}if(Q().get("IS_BROWSER")){Q().setPlatform("browser",new Xge);try{Ko.registerManager($u.URL_SCHEME,new qge)}catch{}try{Ko.registerManager(Bu.URL_SCHEME,new Uge)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kge={importFetch:()=>require("node-fetch")};let oE;class Yge{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return Q().global.fetch!=null?Q().global.fetch(e,n):(oE==null&&(oE=Kge.importFetch()),oE(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}Q().get("IS_NODE")&&!Q().get("IS_BROWSER")&&Q().setPlatform("node",new Yge);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oi(t,e="float32",n){return e=e||"float32",X0(t),new sS(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jge(t,e){const n=Qt(t,"x","cast");if(!rpe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const i={x:n},r={dtype:e};return st.runKernel(kP,i,r)}const aS=zn({cast_:Jge});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qge(t){const n={x:Qt(t,"x","clone","string_or_numeric")};return st.runKernel(LP,n)}const SH=zn({clone_:Qge});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zge(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */lH();const e0e={buffer:Oi,cast:aS,clone:SH,print:Zge};yge(e0e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0e(t,e){let n=Qt(t,"a","add"),i=Qt(e,"b","add");[n,i]=eh(n,i);const r={a:n,b:i};return st.runKernel(MP,r)}const an=zn({add_:t0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(t,e){let n=Qt(t,"a","floorDiv"),i=Qt(e,"b","floorDiv");[n,i]=eh(n,i);const r={a:n,b:i};return st.runKernel(I8,r)}const i0e=zn({floorDiv_:n0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r0e(t,e){let n=Qt(t,"a","div"),i=Qt(e,"b","div");if([n,i]=eh(n,i),n.dtype==="int32"&&i.dtype==="int32")return i0e(n,i);const r={a:n,b:i},s={};return st.runKernel(b8,r,s)}const oa=zn({div_:r0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s0e(t,e){let n=Qt(t,"a","mul"),i=Qt(e,"b","mul");[n,i]=eh(n,i);const r={a:n,b:i};return st.runKernel(L8,r)}const $t=zn({mul_:s0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(t){const e=Qt(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return st.runKernel(T8,n)}else{const n={x:e};return st.runKernel(E8,n)}}const a0e=zn({abs_:o0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xH(t,e,n,i,r="NHWC",s){const o=t[3],a=[...e,o],l=Rp(r);return $o(t,a,n,s,i,null,null,l)}function wp(t,e,n,i,r,s,o="channelsLast"){const[a,l]=u0(e);let c;if(o==="channelsLast")c=[a,l,t[3],t[3]];else if(o==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return $o(t,c,n,i,r,s,!1,o)}function K0(t,e,n,i,r,s,o="NDHWC"){const[a,l,c]=ZT(e);let u,h;if(o==="NDHWC")h="channelsLast",u=[a,l,c,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Y0(t,u,n,i,r,!1,h,s)}function $o(t,e,n,i,r,s,o=!1,a="channelsLast"){let[l,c,u,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,h]=t;else if(a==="channelsFirst")[l,h,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[d,p,,f]=e,[v,g]=u0(n),[m,y]=u0(i),S=Sd(d,m),x=Sd(p,y),{padInfo:w,outHeight:C,outWidth:E}=u0e(r,c,u,v,g,S,x,s,a),T=o?f*h:f;let M;return a==="channelsFirst"?M=[l,T,C,E]:a==="channelsLast"&&(M=[l,C,E,T]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:h,outHeight:C,outWidth:E,outChannels:T,padInfo:w,strideHeight:v,strideWidth:g,filterHeight:d,filterWidth:p,effectiveFilterHeight:S,effectiveFilterWidth:x,dilationHeight:m,dilationWidth:y,inShape:t,outShape:M,filterShape:e}}function Y0(t,e,n,i,r,s=!1,o="channelsLast",a){let[l,c,u,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,u,h,d]=t;else if(o==="channelsFirst")[l,d,c,u,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[p,f,v,,g]=e,[m,y,S]=ZT(n),[x,w,C]=ZT(i),E=Sd(p,x),T=Sd(f,w),M=Sd(v,C),{padInfo:_,outDepth:R,outHeight:L,outWidth:z}=h0e(r,c,u,h,m,y,S,E,T,M,a),G=s?g*d:g;let $;return o==="channelsFirst"?$=[l,G,R,L,z]:o==="channelsLast"&&($=[l,R,L,z,G]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:u,inWidth:h,inChannels:d,outDepth:R,outHeight:L,outWidth:z,outChannels:G,padInfo:_,strideDepth:m,strideHeight:y,strideWidth:S,filterDepth:p,filterHeight:f,filterWidth:v,effectiveFilterDepth:E,effectiveFilterHeight:T,effectiveFilterWidth:M,dilationDepth:x,dilationHeight:w,dilationWidth:C,inShape:t,outShape:$,filterShape:e}}function l0e(t,e,n,i,r){i==null&&(i=FP(t,e,n));const s=t[0],o=t[1],a=h0((s-e+2*i)/n+1,r),l=h0((o-e+2*i)/n+1,r);return[a,l]}function c0e(t,e,n,i,r,s){r==null&&(r=FP(t,e[0],i[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=h0((t[a]-e[a]+2*r)/i[a]+1,s));return o}function FP(t,e,n,i=1){const r=Sd(e,i);return Math.floor((t[0]*(n-1)-n+r)/2)}function u0(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function ZT(t){return typeof t=="number"?[t,t,t]:t}function Sd(t,e){return e<=1?t:t+(t-1)*(e-1)}function u0e(t,e,n,i,r,s,o,a,l){let c,u,h;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const p=l0e([e,n],s,i,t,a);u=p[0],h=p[1]}else if(t==="same"){u=Math.ceil(e/i),h=Math.ceil(n/r);const d=Math.max(0,(u-1)*i+s-e),p=Math.max(0,(h-1)*r+o-n),f=Math.floor(d/2),v=d-f,g=Math.floor(p/2),m=p-g;c={top:f,bottom:v,left:g,right:m,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/i),h=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const d=l==="channelsLast"?t[1][0]:t[2][0],p=l==="channelsLast"?t[1][1]:t[2][1],f=l==="channelsLast"?t[2][0]:t[3][0],v=l==="channelsLast"?t[2][1]:t[3][1];c={top:d,bottom:p,left:f,right:v,type:d===0&&p===0&&f===0&&v===0?"VALID":"EXPLICIT"},u=h0((e-s+d+p)/i+1,a),h=h0((n-o+f+v)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:h}}function h0e(t,e,n,i,r,s,o,a,l,c,u){let h,d,p,f;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=c0e([e,n,i,1],[a,l,c],1,[r,s,o],t,u);d=g[0],p=g[1],f=g[2]}else if(t==="same"){d=Math.ceil(e/r),p=Math.ceil(n/s),f=Math.ceil(i/o);const v=(d-1)*r+a-e,g=(p-1)*s+l-n,m=(f-1)*o+c-i,y=Math.floor(v/2),S=v-y,x=Math.floor(g/2),w=g-x,C=Math.floor(m/2),E=m-C;h={top:x,bottom:w,left:C,right:E,front:y,back:S,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}function h0(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function eb(t){const[e,n,i]=u0(t);return e===1&&n===1&&i===1}function Ep(t,e){return eb(t)||eb(e)}function d0e(t){return u0(t).every(e=>e>0)}function Rp(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function p0e(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")we(tS(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(i=>{i.forEach(r=>{we(tS(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0e(t,e){const i={x:Qt(t,"x","reshape","string_or_numeric")},r={shape:e};return st.runKernel(F8,i,r)}const zP=zn({reshape_:f0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m0e(t){const n={x:Qt(t,"x","sigmoid","float32")};return st.runKernel(U8,n)}const g0e=zn({sigmoid_:m0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0e(t,e){let n=Qt(t,"broadcastTo","x");const i=n.shape;if(X0(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=zP(n,c)}const r=n.shape,s=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])s[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${e}].`);if(s.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return SH(n);const a={x:n},l={reps:s};return st.runKernel(V8,a,l)}const y0e=zn({broadcastTo_:v0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0e(t,e,n){X0(t),n=n||q0(e);const i={shape:t,value:e,dtype:n};return st.runKernel(P8,{},i)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lS(t,e){const n=t.length,i=[];for(let r=0;r<n;r++){const s=n-1-r,o=t[s]||1;(e[e.length-1-r]||1)>1&&o===1&&i.unshift(s)}return i}function CH(t,e){const n=[];for(let i=0;i<e.length;i++){const r=t[t.length-i-1],s=e.length-i-1,o=e[s];(r==null||r===1&&o>1)&&n.unshift(s)}return n}function pr(t,e){const n=Math.max(t.length,e.length),i=new Array(n);for(let r=0;r<n;r++){let s=t[t.length-r-1];s==null&&(s=1);let o=e[e.length-r-1];if(o==null&&(o=1),s===1)i[n-r-1]=o;else if(o===1)i[n-r-1]=s;else if(s!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else i[n-r-1]=s}return i}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x0e(t){const n={x:Qt(t,"x","zerosLike")};return st.runKernel(j8,n)}const aa=zn({zerosLike_:x0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C0e(t){const n={x:Qt(t,"x","elu","float32")};return st.runKernel(A8,n)}const _0e=zn({elu_:C0e});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function _H(t,e,n){const i=t.length+e.length,r=[];let s=0,o=0;for(let a=0;a<i;a++)n.indexOf(a)===-1?r.push(t[s++]):r.push(e[o++]);return r}function va(t,e){const n=[],i=t.length;for(let s=0;s<i;s++)e.indexOf(s)===-1&&n.push(t[s]);const r=e.map(s=>t[s]);return[n,r]}function il(t,e){const n=e.map(i=>1);return _H(t,n,e)}function Ho(t,e,n){we(UP(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function io(t,e){if(UP(t,e))return null;const n=[];for(let i=0;i<e;++i)t.indexOf(i)===-1&&n.push(i);return t.forEach(i=>n.push(i)),n}function BP(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function ro(t,e){const n=[];for(let i=e-t;i<e;++i)n.push(i);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0e(t,e){let n=Qt(t,"base","pow"),i=Qt(e,"exp","pow");[n,i]=eh(n,i);const r={a:n,b:i};return st.runKernel(D8,r)}const e4=zn({pow_:w0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hc(t,e){if((Qs(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Qs(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Age(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E0e(t){const n={x:Qt(t,"x","sqrt","float32")};return st.runKernel(B8,n)}const Jd=zn({sqrt_:E0e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R0e(t){const e=Qt(t,"x","square"),n={};return st.runKernel("Square",{x:e},n)}const _u=zn({square_:R0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0e(t,e=null,n=!1){let i=Qt(t,"x","sum");i.dtype==="bool"&&(i=aS(i,"int32"));const r={x:i},s={axis:e,keepDims:n};return st.runKernel($8,r,s)}const b0e=zn({sum_:T0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A0e(t,e=.2){const i={x:Qt(t,"x","leakyRelu")},r={alpha:e};return st.runKernel(M8,i,r)}const P0e=zn({leakyRelu_:A0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0e(t,e){we($T(t),()=>"The f passed in variableGrads(f) must be a function"),we(e==null||Array.isArray(e)&&e.every(c=>c instanceof oS),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in st.registeredVariables)e.push(st.registeredVariables[c])}const i=n?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),we(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const s=!0,{value:o,grads:a}=st.gradients(t,e,null,s);we(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),we(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),i!=null&&i.forEach(c=>l[c.name]=null),{value:o,grads:l}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(t,e){let n=Qt(t,"a","sub"),i=Qt(e,"b","sub");[n,i]=eh(n,i);const r={a:n,b:i};return st.runKernel(H8,r)}const xd=zn({sub_:M0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0e(t,e){let n=Qt(t,"a","maximum"),i=Qt(e,"b","maximum");[n,i]=eh(n,i),n.dtype==="bool"&&(n=aS(n,"int32"),i=aS(i,"int32")),pr(n.shape,i.shape);const r={a:n,b:i};return st.runKernel(k8,r)}const L0e=zn({maximum_:k0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tb(t,e="float32"){if(X0(t),e==="complex64"){const i=tb(t,"float32"),r=tb(t,"float32");return bge(i,r)}const n=uc(Re(t),e);return st.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0e(t,e){const n=Qt(t,"x","prelu"),i=Qt(e,"alpha","prelu"),r={x:n,alpha:i};return st.runKernel(N8,r)}const N0e=zn({prelu_:D0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O0e(t){const n={x:Qt(t,"x","relu")};return st.runKernel(O8,n)}const F0e=zn({relu_:O0e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z0e(t){const n={x:Qt(t,"x","relu6")};return st.runKernel(z8,n)}const U0e=zn({relu6_:z0e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B0e(t,e=0){const i={x:Qt(t,"x","step")},r={alpha:e};return st.runKernel(W8,i,r)}const $0e=zn({step_:B0e});function wH(t,e,n){const i=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${i}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(s+` update.rank < ${r}. `);if(t.length<i+(n.rank-r))throw new Error(s+` Output shape length < ${i+(n.rank-r)}`);if(n.rank!==r+t.length-i)throw new Error(s+` update.rank != ${r+t.length-i}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+i])throw new Error(s+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function H0e(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}wH(n,e,t)}function zC(t,e,n){const i=e.shape.length,r=i>1?e.shape[i-1]:1,s=n.length;let o=1;for(let h=r;h<s;++h)o*=n[h];const a=r<1?1:r,l=Re(e.shape)/a,c=[...Di(n.slice(0,r)),1],u=Re(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V0e(t,e){const n=[];for(let s=0;s<e.length;s++)e[s]&&n.push(s);const i=Oi(t,"int32"),r=Oi([n.length,t.length],"int32");for(let s=0;s<n.length;s++){const o=i.indexToLoc(n[s]),a=s*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0e(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return $t(t,$0e(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function W0e(t,e){let n=e;const i=CH(t.shape,e.shape);return i.length>0&&(n=b0e(n,i)),zP(n,t.shape)}function G0e(t,e,n,i){if(e==="linear")return t;if(e==="relu")return F0e(t);if(e==="elu")return _0e(t);if(e==="relu6")return U0e(t);if(e==="prelu")return N0e(t,n);if(e==="leakyrelu")return P0e(t,i);if(e==="sigmoid")return g0e(t);throw new Error(`Unknown fused activation ${e}.`)}const q0e=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X0e(t,e,n){const i=K0e(t,e,n),r=i<0?-(i+1):i;t.splice(r,0,e)}function K0e(t,e,n){return J0e(t,e,n||Y0e)}function Y0e(t,e){return t>e?1:t<e?-1:0}function J0e(t,e,n){let i=0,r=t.length,s=0,o=!1;for(;i<r;){s=i+(r-i>>>1);const a=n(e,t[s]);a>0?i=s+1:(r=s,o=!a)}return o?i:-i-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0e(t,e,n,i,r){return $P(t,e,n,i,r,0)}function Z0e(t,e,n,i,r,s){return $P(t,e,n,i,r,0,!1,s,!0)}function eve(t,e,n,i,r,s){return $P(t,e,n,i,r,s,!0)}function $P(t,e,n,i,r,s,o=!1,a=!1,l=!1){const c=[];for(let g=0;g<e.length;g++)e[g]>r&&c.push({score:e[g],boxIndex:g,suppressBeginIndex:0});c.sort(t4);const u=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&c.length>0;){const g=c.pop(),{score:m,boxIndex:y,suppressBeginIndex:S}=g;if(m<r)break;let x=!1;for(let w=h.length-1;w>=S;--w){const C=tve(t,y,h[w]);if(C>=i){x=!0;break}if(g.score=g.score*nve(i,u,C),g.score<=r)break}g.suppressBeginIndex=h.length,x||(g.score===m?(h.push(y),d.push(g.score)):g.score>r&&X0e(c,g,t4))}const p=h.length,f=n-p;a&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const v={selectedIndices:h};return o&&(v.selectedScores=d),l&&(v.validOutputs=p),v}function tve(t,e,n){const i=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),s=Math.min(i[0],i[2]),o=Math.min(i[1],i[3]),a=Math.max(i[0],i[2]),l=Math.max(i[1],i[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),p=(a-s)*(l-o),f=(h-c)*(d-u);if(p<=0||f<=0)return 0;const v=Math.max(s,c),g=Math.max(o,u),m=Math.min(a,h),y=Math.min(l,d),S=Math.max(m-v,0)*Math.max(y-g,0);return S/(p+f-S)}function nve(t,e,n){const i=Math.exp(e*n*n);return n<=t?i:0}function t4(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ive=new Map,rve=new Map;class sve{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class ou{constructor(){this.classNameMap={}}static getMap(){return ou.instance==null&&(ou.instance=new ou),ou.instance}static register(e){ou.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ove(t,e,n){we(t.className!=null,()=>"Class being registered does not have the static className property defined."),we(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),we(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const i=n,r=e+">"+i;return ou.register(t),ive.set(r,t),rve.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nh extends sve{minimize(e,n=!1,i){const{value:r,grads:s}=this.computeGradients(e,i);if(i!=null){const o=i.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(o)}else this.applyGradients(s);return Ss(s),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return I0e(e,n)}dispose(){this.iterations_!=null&&Ss(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:hc(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(nh,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ave extends nh{static get className(){return"Adadelta"}constructor(e,n,i=null){super(),this.learningRate=e,this.rho=n,this.epsilon=i,this.accumulatedGrads=[],this.accumulatedUpdates=[],i==null&&(this.epsilon=st.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=st.registeredVariables[i],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${i}/accum_grad`,variable:ii(()=>aa(s).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${i}/accum_var`,variable:ii(()=>aa(s).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[i];if(a==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;ii(()=>{const u=an($t(l,this.rho),$t(_u(a),1-this.rho)),h=$t(oa(Jd(an(c,this.epsilon)),Jd(an(l,this.epsilon))),a),d=an($t(c,this.rho),$t(_u(h),1-this.rho));l.assign(u),c.assign(d);const p=an($t(h,-this.learningRate),s);s.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ss(this.accumulatedGrads.map(e=>e.variable)),Ss(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,i=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lve extends nh{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=st.registeredVariables[i];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${i}/accumulator`,variable:ii(()=>S0e(s.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[i];if(o==null)return;const a=this.accumulatedGrads[r].variable;ii(()=>{const l=an(a,_u(o));a.assign(l);const c=an($t(oa(o,Jd(an(l,st.backend.epsilon()))),-this.learningRate),s);s.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ss(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cve extends nh{static get className(){return"Adam"}constructor(e,n,i,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=i,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ii(()=>{this.accBeta1=hc(n).variable(),this.accBeta2=hc(i).variable()}),r==null&&(this.epsilon=st.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ii(()=>{const i=xd(1,this.accBeta1),r=xd(1,this.accBeta2);n.forEach((s,o)=>{const a=st.registeredVariables[s],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:ii(()=>aa(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${s}/v`,variable:ii(()=>aa(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[s];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=an($t(u,this.beta1),$t(c,1-this.beta1)),p=an($t(h,this.beta2),$t(_u(c),1-this.beta2)),f=oa(d,i),v=oa(p,r);u.assign(d),h.assign(p);const g=an($t(oa(f,an(Jd(v),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign($t(this.accBeta1,this.beta1)),this.accBeta2.assign($t(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ss(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ss(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),ii(()=>{this.accBeta1.assign(e4(this.beta1,this.iterations_+1)),this.accBeta2.assign(e4(this.beta2,this.iterations_+1))});const n=e.length/2,i=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uve extends nh{static get className(){return"Adamax"}constructor(e,n,i,r=null,s=0){super(),this.learningRate=e,this.beta1=n,this.beta2=i,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ii(()=>{this.iteration=hc(0).variable(),this.accBeta1=hc(n).variable()}),r==null&&(this.epsilon=st.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);ii(()=>{const i=xd(1,this.accBeta1),r=oa(-this.learningRate,an($t(this.iteration,this.decay),1));n.forEach((s,o)=>{const a=st.registeredVariables[s],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:aa(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${s}/v`,variable:aa(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[s];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=an($t(u,this.beta1),$t(c,1-this.beta1)),p=$t(h,this.beta2),f=a0e(c),v=L0e(p,f);u.assign(d),h.assign(v);const g=an($t(oa(r,i),oa(d,an(v,this.epsilon))),a);a.assign(g)}),this.iteration.assign(an(this.iteration,1)),this.accBeta1.assign($t(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ss(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ss(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EH extends nh{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=Array.isArray(e)?e[r].tensor:e[i];if(s==null)return;const o=st.registeredVariables[i];ii(()=>{const a=an($t(this.c,s),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Ige(hc(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hve extends EH{static get className(){return"Momentum"}constructor(e,n,i=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=i,this.accumulations=[],this.m=hc(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=st.registeredVariables[i];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${i}/momentum`,variable:ii(()=>aa(s).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[i];a!=null&&ii(()=>{let l;const c=an($t(this.m,o),a);this.useNesterov?l=an($t(this.c,an(a,$t(c,this.m))),s):l=an($t(this.c,c),s),o.assign(c),s.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ss(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dve extends nh{static get className(){return"RMSProp"}constructor(e,n=.9,i=0,r=null,s=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=i,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,r==null&&(this.epsilon=st.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(i=>i.name):Object.keys(e)).forEach((i,r)=>{const s=st.registeredVariables[i],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${i}/rms`,variable:ii(()=>aa(s).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${i}/momentum`,variable:ii(()=>aa(s).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${i}/mg`,variable:ii(()=>aa(s).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[i];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;ii(()=>{const u=an($t(l,this.decay),$t(_u(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,d=an($t(h,this.decay),$t(a,1-this.decay)),p=oa($t(a,this.learningRate),Jd(xd(u,an(_u(d),this.epsilon)))),f=an($t(c,this.momentum),p);l.assign(u),h.assign(d),c.assign(f);const v=xd(s,f);s.assign(v)}else{const h=an($t(l,this.decay),$t(_u(a),1-this.decay)),d=an($t(c,this.momentum),oa($t(a,this.learningRate),Jd(an(h,this.epsilon))));l.assign(h),c.assign(d);const p=xd(s,d);s.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ss(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ss(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ss(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,i=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(i)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pve=[ave,lve,cve,uve,hve,dve,EH];function fve(){for(const t of pve)ove(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mve="model",gve=".json",vve=".weights.bin";function n4(t){return new Promise(e=>setTimeout(e)).then(t)}class Hu{constructor(e){if(!Q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Hu.URL_SCHEME)&&(e=e.slice(Hu.URL_SCHEME.length)),(e==null||e.length===0)&&(e=mve),this.modelJsonFileName=e+gve,this.weightDataFileName=e+vve}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=th.join(e.weightData),i=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s=dH(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await n4(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=i,await n4(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:FC(e)}}}}Hu.URL_SCHEME="downloads://";const yve=t=>Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Hu.URL_SCHEME)?Sve(t.slice(Hu.URL_SCHEME.length)):null;Ii.registerSaveRouter(yve);function Sve(t="model"){return new Hu(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i4(t,e,n,i){o(t),n=n??0,i=i??1,a(n,i);let r=0;const s=l=>(l.then(c=>{const u=n+ ++r/t.length*(i-n);return e(u),c}),l);function o(l){we(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){we(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),we(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),we(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function xve(t,e){e==null&&(e={});const n=e.fetchFunc==null?Q().platform.fetch:e.fetchFunc,i=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(i):await i4(i,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await i4(a,e.onProgress,.5,1)}function Cve(t,e){var n;const i=e.fetchFunc==null?Q().platform.fetch:e.fetchFunc;let r=0,s;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<t.length;){s||(s=(await i(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await s.read();if(l){r++,s=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}o.enqueue(c);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ve="application/octet-stream",wve="application/json";class HP{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(we(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Q().platform.fetch,we(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&we(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const i=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=dH(e,i);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:wve}),"model.json"),e.weightData!=null){const o=th.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:_ve}),"model.weights.bin")}const s=await this.fetch(this.path,n);if(s.ok)return{modelArtifactsInfo:FC(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const i=n.modelTopology,r=n.weightsManifest;if(i==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return Oge(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),i=QO(e.weightsManifest),r=()=>Cve(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:i,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[i,r]=Eve(n),s=this.weightPathPrefix||i,o=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):o.push(s+c+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),i=QO(e),r=await xve(n,this.loadOptions);return[i,r]}}HP.URL_SCHEME_REGEX=/^https?:\/\//;function Eve(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),i=t.substring(0,e),r=n>e?t.substring(n):"";return[i+"/",r]}function r4(t){return t.match(HP.URL_SCHEME_REGEX)!=null}const RH=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(i=>r4(i)):n=r4(t),n)return Rve(t,e)}return null};Ii.registerSaveRouter(RH);Ii.registerLoadRouter(RH);function Rve(t,e){return new HP(t,e)}function TH(t,e){const n=t.shape.length,i=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(i<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${i}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[i-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[i-1]} vs. ${n}`);if(Re(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,s=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=t.shape,l=r.slice();l.pop();let c=1;for(let h=s;h<n;++h)c*=a[h],l.push(a[h]);const u=[...Di(t.shape).map(h=>h/c),1].slice(0,s);return[l,o,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nb=-2,Tve=-1;function bH(t,e,n){const i=t.shape.length;we(i===e.length,()=>`Error in slice${i}D: Length of begin ${e} must match the rank of the array (${i}).`),we(i===n.length,()=>`Error in slice${i}D: Length of size ${n} must match the rank of the array (${i}).`);for(let r=0;r<i;++r)we(e[r]+n[r]<=t.shape[r],()=>`Error in slice${i}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function bve(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function AH(t,e,n){const i=[];for(let r=0;r<t.length;r++)i[r]=Math.ceil((e[r]-t[r])/n[r]);return i}function PH(t,e,n,i){const r=[...t];for(let s=r.length;s<i.length;s++)r.push(1);for(let s=0;s<n;s++)s===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function IH(t,e,n){return n<=t?n:n-(e-1)}function MH(t,e){const n=[];for(let i=0;i<t;i++)n.push(e+i);return n}function Ave(t,e,n,i,r,s,o,a,l){const c=t.length;let u=new Array(c),h=new Array(c),d=new Array(c);if(e.length&&n>0){const p=e[0],f=n+1;u=kH(o,p,f,i,t),h=LH(a,p,f,r,t),d=PH(s,p,f,t)}else for(let p=0;p<c;p++)u[p]=NH(o,i,s,t,p,l),h[p]=OH(a,r,s,t,p,l),d[p]=DH(s,p,l);return{begin:u,end:h,strides:d}}function kH(t,e,n,i,r){const s=[...r],o=MH(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const l=IH(e,n,a);let c=i[l];t&1<<l&&(c=0),s[a]=c}return s}function LH(t,e,n,i,r){const s=[...r],o=MH(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const l=IH(e,n,a);let c=i[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),s[a]=c}for(let a=0;a<s.length;a++){const l=r[a];s[a]<0&&(s[a]+=l),s[a]=eS(0,s[a],r[a])}return s}function DH(t,e,n){let i=t[e];return(n&1<<e||i==null)&&(i=1),i}function NH(t,e,n,i,r,s){let o=e[r];const a=n[r]||1;(t&1<<r||s&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=i[r];return o<0&&(o+=l),o=eS(0,o,l-1),o}function OH(t,e,n,i,r,s){let o=e[r];const a=n[r]||1;(t&1<<r||s&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=i[r];return o<0&&(o+=l),a>0?o=eS(0,o,l):o=eS(-1,o,l-1),o}function VP(t,e,n){let i=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){i=r;break}for(let r=i+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function jP(t,e){let n=t.length>0?t[t.length-1]:1;for(let i=0;i<t.length-1;i++)n+=t[i]*e[i];return n}function FH(t,e,n){let i;const r=t.shape.length;typeof e=="number"?i=[e,...new Array(r-1).fill(0)]:e.length<r?i=e.concat(new Array(r-e.length).fill(0)):i=e.slice(),i.forEach(o=>{we(o!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(r).fill(-1):typeof n=="number"?s=[n,...new Array(r-1).fill(-1)]:n.length<r?s=n.concat(new Array(r-n.length).fill(-1)):s=n,s=s.map((o,a)=>o>=0?o:(we(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-i[a])),[i,s]}function zH(t,e,n,i,r,s,o,a,l){let c;if(i==null?(c=new Array(e.length),c.fill(1)):c=i,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:r,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let S=0;S<h.dims;S++)u&&1<<S&a&&h.numAddAxisAfterEllipsis++,1<<S&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Pve(h,d);let p=!0,f=!0,v=!0;const g=[],m=[];for(let S=0;S<t.length;++S){if(d.strides[S]===0)throw Error(`strides[${S}] must be non-zero`);const x=!!(d.shrinkAxisMask&1<<S),w=t[S];if(w===-1){g.push(x?1:-1);continue}const C=[d.beginMask&1<<S,d.endMask&1<<S],E=[d.strides[S]>0?0:-1,d.strides[S]>0?w:w-1];if(x&&d.strides[S]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&d.strides[S]===1;const T=!!(d.beginMask&1<<S&&d.endMask&1<<S);if(d.beginValid&&d.endValid){if(x){const L=d.begin[S]<0?w+d.begin[S]:d.begin[S];if(d.begin[S]=L,d.end[S]=d.begin[S]+1,L<0||L>=w)throw Error(`slice index ${d.begin[S]} of dimension ${S} out of bounds.`)}else d.begin[S]=s4(d.begin[S],0,d.strides[S],w,C,E),d.end[S]=s4(d.end[S],1,d.strides[S],w,C,E);const R=d.strides[S]===1&&d.begin[S]===0&&d.end[S]===w;p=p&&R,f=f&&(S===0&&d.strides[S]===1||R)}else p=p&&d.strides[S]===1&&T,f=f&&(S===0&&d.strides[S]===1||T);let M,_=!1;if(d.beginValid&&d.endValid?(M=d.end[S]-d.begin[S],_=!0):x?(M=1,_=!0):T&&w>=0&&(d.strides[S]<0?M=-w:M=w,_=!0),_){let R;M===0||M<0!=d.strides[S]<0?R=0:R=Math.trunc(M/d.strides[S])+(M%d.strides[S]!==0?1:0),g.push(R)}else g.push(-1)}for(let S=0;S<d.finalShapeGatherIndices.length;++S){const x=d.finalShapeGatherIndices[S];x>=0?m.push(g[x]):x===nb&&m.push(1)}return{finalShapeSparse:m.filter((S,x)=>d.finalShapeGatherIndices[x]!==nb),finalShape:m,isIdentity:p,sliceDim0:f,isSimpleSlice:v,begin:d.begin,end:d.end,strides:d.strides}}function Pve(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let i=0;i<t.dims;i++)if(1<<i&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-i)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=i}else if(1<<i&t.newAxisMask)e.finalShapeGatherIndices.push(nb),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[i]),t.end!=null&&(e.end[n]=t.end[i]),e.strides[n]=t.strides[i],t.beginMask&1<<i&&(e.beginMask|=1<<n),t.endMask&1<<i&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<i?(e.finalShapeGatherIndices.push(Tve),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(i)),e.inputShapeGatherIndicesSparse[n]=i,n++}}function s4(t,e,n,i,r,s){if(r[e])return n>0?s[e]:s[e+1&1];{const o=t<0?i+t:t;return o<s[0]?s[0]:o>s[1]?s[1]:o}}const Ive=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:bH,computeFlatOffset:jP,computeOutShape:AH,getNormalizedAxes:Ave,isSliceContinous:VP,maskToAxes:bve,parseSliceParams:FH,sliceInfo:zH,startForAxis:NH,startIndicesWithElidedDims:kH,stopForAxis:OH,stopIndicesWithElidedDims:LH,stridesForAxis:DH,stridesWithElidedDims:PH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mve=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function kve(){return new Promise(t=>Mve(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UH(t,e){const n=t[0].length;t.forEach((r,s)=>{we(r.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),we(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const i=t[0];t.forEach((r,s)=>{for(let o=0;o<n;o++)we(o===e||r[o]===i[o],()=>`Error in concat${n}D: Shape of tensors[${s}] (${r}) does not match the shape of the rest (${i}) along the non-concatenated axis ${s}.`)})}function Vu(t,e){const n=t[0].slice();for(let i=1;i<t.length;i++)n[e]+=t[i][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Co;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Co||(Co={}));function BH(t,e,n){let i=new Array;if(n==null&&e==null)return i;if(e==null)for(;i.length<t+n.length;)i.push(-1);else i=e.slice();if(n==null)return i;if(t+n.length!==i.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${i.length}`);for(let r=1;r<n.length;++r){const s=n[r],o=i[i.length-n.length+r],a=i[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${s} but shape[${r+t}] = ${a}`)}else i[o]=s}return i}function $H(t){const e={FIRST_DIM_SIZE:Co.FIRST_DIM_SIZE,VALUE_ROWIDS:Co.VALUE_ROWIDS,ROW_LENGTHS:Co.ROW_LENGTHS,ROW_SPLITS:Co.ROW_SPLITS,ROW_LIMITS:Co.ROW_LIMITS,ROW_STARTS:Co.ROW_STARTS},n=[];for(const i of t)if(i in e)n.push(e[i]);else break;return n}function HH(t){return t.length===0?0:t[0]===Co.FIRST_DIM_SIZE?t.length-1:t.length}function VH(t,e){if(t==null||e==null)return;const n=t.length,i=e.length;if(n>=i)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${i})`);for(let r=0;r<Math.min(n,i-1);++r){const s=t[r],o=e[r+1];if(s>=0&&o>=0&&s!==1&&s!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${s} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WP=30;function UC(t){return t<=WP?t:HT(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jH(t,e,n){const i=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[i,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GP(t,e,n,i=!0){let r=[];if(i)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const s=e.length;for(let o=0;o<s;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(s+1))}return r}function qP(t,e,n=!0){const i=[];if(n){i.push(e);for(let r=e+1;r<t;++r)r<=2*e?(i.push(r),i.push(r-(e+1))):i.push(r)}else{const r=[],s=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?s.push(o):r.push(o);i.push(...r),i.push(0),i.push(...s)}return i}function XP(t,e,n,i=!0){const r=[];i?r.push(t[0]/n):r.push(t[0]*n);for(let s=1;s<t.length;++s)s<=e.length?i?r.push(e[s-1]*t[s]):r.push(t[s]/e[s-1]):r.push(t[s]);return r}function WH(t,e){const n=[0];for(let i=0;i<e;++i)n.push(t[i][0]);return n}function GH(t,e,n){const i=t.slice(0,1);for(let r=0;r<n;++r)i.push(t[r+1]-e[r][0]-e[r][1]);return i}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qH=1.7580993408473768,XH=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KH=.3275911,YH=.254829592,JH=-.284496736,QH=1.421413741,ZH=-1.453152027,eV=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ib(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let i=0;i<n.length;i+=2)n[i]=t[i/2],n[i+1]=e[i/2];return n}function Lve(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let i=0;i<t.length;i+=2)e[i/2]=t[i],n[i/2]=t[i+1];return{real:e,imag:n}}function Dve(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],i[Math.floor(r/4)]=t[r+1];return{real:n,imag:i}}function Nve(t){const e=Math.floor(t.length/4),n=new Float32Array(e),i=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],i[Math.floor(r/4)]=t[r+1];return{real:n,imag:i}}function Ove(t,e){const n=t[e*2],i=t[e*2+1];return{real:n,imag:i}}function Fve(t,e,n,i){t[i*2]=e,t[i*2+1]=n}function zve(t,e){const n=new Float32Array(t/2),i=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const s=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(s),i[r]=Math.sin(s)}return{real:n,imag:i}}function Uve(t,e,n){const i=(n?2:-2)*Math.PI*(t/e),r=Math.cos(i),s=Math.sin(i);return{real:r,imag:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aE="->",Bve=/->/g,o4=",",a4="...";function tV(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(Bve,"").length)/aE.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${aE}").`);const[i,r]=t.split(aE);we(i.indexOf(a4)===-1,()=>`The ellipsis notation ("${a4}") is not supported yet.`);const s=i.split(o4),o=s.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<r.length;++d){const p=r[d];if(!s.some(f=>f.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let d=0;d<i.length;++d){const p=i[d];a.indexOf(p)===-1&&p!==o4&&a.push(p)}const l=new Array(s.length);for(let d=0;d<o;++d){if(new Set(s[d].split("")).size!==s[d].length)throw new Error(`Found duplicate axes in input component ${s[d]}. Support for duplicate axes in input is not implemented yet.`);l[d]=[];for(let p=0;p<s[d].length;++p)l[d].push(a.indexOf(s[d][p]))}const c=a.length,u=r.length,h=[];for(let d=u;d<c;++d)h.push(d);return{allDims:a,summedDims:h,idDims:l}}function nV(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const i=[];for(let r=0;r<t;++r)n[r]===-1&&i.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:i}}function iV(t,e,n){const i=new Array(t);for(let r=0;r<n.length;++r){const s=n[r].shape;for(let o=0;o<e[r].length;++o)i[e[r][o]]===void 0?i[e[r][o]]=s[o]:we(i[e[r][o]]===s[o],()=>`Expected dimension ${i[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(s)}, but got dimension ${s[o]}`)}}function rV(t,e){const n=t,i=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)i.push([]);const s=[];for(let o=0;o<n.length;++o){const a=n[o],l=$ve(e,a);for(const c of l)s.indexOf(c)===-1&&(i[o].push(c),s.push(c))}return{path:n,steps:i}}function sV(t){return t.every((e,n)=>e===n)}function $ve(t,e){const n=[];for(let i=0;i<t.length;++i)(t[i].length===0||t[i].indexOf(e)!==-1||e===-1)&&n.push(i);return n}function oV(t,e,n=0){let i=[];if(typeof e=="number")we(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),i=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);we(r<=1,()=>"There should be only one negative value in split array.");const s=e.indexOf(-1);if(s!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[s]=t.shape[n]-o}we(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),i=e}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function lV(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function cV(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function hV(t,e){return`size ${t} must be non-negative, not ${e}`}function dV(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function pV(t,e){const n=Re(t),i=Re(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${i}. inputShape=${t} outputShape= ${e}`}function fV(t,e){const n=Re(t),i=Re(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${i}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rb(){return"segment ids must be >= 0"}function mV(){return"segment ids are not increasing"}function gV(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function vV(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(t,e){let n=!1,i;for(t<=WP?(i=t,n=!0):i=HT(t,Math.floor(Math.sqrt(t)));!n;)i>e||i===t?n=!0:i=HT(t,i+1);return i}function SV(t,e,n){const i=[],r=t.length;for(let s=0;s<r;s++)s!==e?i.push(t[s]):i.push(n);return i}function xV(t,e,n,i){const r=e.shape.length,s=t.shape.length;if(i!==0&&(i<-r||i>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${i}`);if(i<0&&(i+=r),i>s)throw new Error(`batchDims (${i}) must be less than rank(x) (
    ${s}).`);if(n<i)throw new Error(`batchDims (${i}) must be less than or equal to axis (${n}).`);for(let h=0;h<i;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let l=1,c=1,u=1;for(let h=0;h<i;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=i;h<n;h++)a.push(t.shape[h]),c*=t.shape[h];for(let h=i;h<r;h++)a.push(e.shape[h]);for(let h=n+1;h<s;h++)a.push(t.shape[h]),u*=t.shape[h];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:o,outputShape:a}}const Hve=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:xV,computeOutShape:SV,segOpComputeOptimalWindowSize:yV},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qd(t){try{return t.map(e=>Kd(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function CV(t){return t.map(e=>Cu(e))}const Vve=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:YH,ERF_A2:JH,ERF_A3:QH,ERF_A4:ZH,ERF_A5:eV,ERF_P:KH,PARALLELIZE_THRESHOLD:WP,get RowPartitionType(){return Co},SELU_SCALE:XH,SELU_SCALEALPHA:qH,applyActivation:G0e,assertAndGetBroadcastShape:pr,assertAxesAreInnerMostDims:Ho,assertParamsConsistent:UH,assignToTypedArray:Fve,axesAreInnerMostDims:UP,calculateShapes:zC,checkEinsumDimSizes:iV,checkPadOnDimRoundingMode:p0e,combineLocations:_H,combineRaggedTensorToTensorShapes:BH,complexWithEvenIndex:Dve,complexWithOddIndex:Nve,computeConv2DInfo:$o,computeConv3DInfo:Y0,computeDefaultPad:FP,computeDilation2DInfo:xH,computeOptimalWindowSize:UC,computeOutAndReduceShapes:va,computeOutShape:Vu,computePool2DInfo:wp,computePool3DInfo:K0,convertConv2DDataFormat:Rp,decodeEinsumEquation:tV,eitherStridesOrDilationsAreOne:Ep,expandShapeToKeepDim:il,exponent:Uve,exponents:zve,fromStringArrayToUint8:CV,fromUint8ToStringArray:Qd,getAxesPermutation:io,getBroadcastDims:lS,getComplexWithIndex:Ove,getEinsumComputePath:rV,getEinsumPermutation:nV,getFusedBiasGradient:W0e,getFusedDyActivation:j0e,getImageCenter:jH,getInnerMostAxes:ro,getPermuted:qP,getRaggedRank:HH,getReductionAxes:CH,getReshaped:GP,getReshapedPermuted:XP,getRowPartitionTypesHelper:$H,getSliceBeginCoords:WH,getSliceSize:GH,getSparseFillEmptyRowsIndicesDenseShapeMismatch:aV,getSparseFillEmptyRowsNegativeIndexErrorMessage:lV,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:cV,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:dV,getSparseReshapeInputOutputMismatchErrorMessage:fV,getSparseReshapeInputOutputMultipleErrorMessage:pV,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:uV,getSparseReshapeNegativeOutputDimErrorMessage:hV,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:vV,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:rb,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:mV,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:gV,getUndoAxesPermutation:BP,isIdentityPermutation:sV,log:Zme,mergeRealAndImagArrays:ib,prepareAndValidate:TH,prepareSplitSize:oV,segment_util:Hve,shouldFuse:q0e,slice_util:Ive,splitRealAndImagArrays:Lve,stridesOrDilationsArePositive:d0e,tupleValuesAreOne:eb,upcastType:ua,validateDefaultValueShape:VH,validateInput:H0e,validateUpdateShape:wH,warn:Eo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fve();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const au={},cy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function jve(t,e){au[t]=e}function ko(t,e){if(!(t in au)||e!=null){const i=Gve(t,e);if(i!==null)au[t]=i;else return console.log("Could not get context for WebGL version",t),null}const n=au[t];return n==null||n.isContextLost()?(delete au[t],ko(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),au[t])}function Wve(t){if(!Q().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Gve(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??Wve(t);return n.addEventListener("webglcontextlost",i=>{i.preventDefault(),delete au[t]},!1),Q().getBool("SOFTWARE_WEBGL_ENABLED")&&(cy.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",cy)||n.getContext("experimental-webgl",cy):n.getContext("webgl2",cy)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var d0;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(d0||(d0={}));var gs;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(gs||(gs={}));var ki;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ki||(ki={}));function J0(t,e){return[e,t]}function qve(t,e){return t*e}function uy(t){const e=Re(t),n=Math.ceil(e/4);return BT(n)}function Tp(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Xve(t,e){const[n,i]=Tp(t,e);return n*i*4}function KP(t,e){const n=t;let i,r,s,o,a,l,c,u,h,d;return Q().getNumber("WEBGL_VERSION")===2?(i=n.R32F,r=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(i=t.RGBA,r=t.RGBA,s=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,u=4,h=e!=null?e.HALF_FLOAT_OES:null,d=t.FLOAT,l=t.RGBA),{internalFormatFloat:i,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pe(t,e){const n=e();return Q().getBool("DEBUG")&&Kve(t),n}function Kve(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Zve(t,e))}const Yve=596e-10,Jve=65504;function Qve(t){return!!(Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Yve<Math.abs(t)&&Math.abs(t)<Jve)}function Zve(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function hy(t,e){return rl(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function eye(t,e){const n=rl(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Pe(t,()=>t.shaderSource(n,e)),Pe(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function tye(t,e){const n=rl(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Pe(t,()=>t.shaderSource(n,e)),Pe(t,()=>t.compileShader(n)),Q().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw _V(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const nye=/ERROR: [0-9]+:([0-9]+):/g;function _V(t,e){const n=nye.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const i=+n[1],r=t.split(`
`),s=r.length.toString().length+2,o=r.map((h,d)=>yd((d+1).toString(),s)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,i-1),c=o.slice(i-1,i),u=o.slice(i);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${yd(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function iye(t){return rl(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function rye(t,e){if(Pe(t,()=>t.linkProgram(e)),!Q().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function lE(t,e){if(Pe(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function sye(t,e){const n=rl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Pe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Pe(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function oye(t,e){const n=rl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Pe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),Pe(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function aye(t){return rl(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function lye(t,e){const n=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const i=`[${t}x${e}]`;throw new Error("Requested texture size "+i+" is invalid.")}if(t>n||e>n){const i=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+r+".")}}function cye(t){return rl(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function l4(t,e,n,i,r,s,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(Pe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,i)),Pe(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,s,o)),Pe(t,()=>t.enableVertexAttribArray(a)),!0)}function uye(t,e,n){mye(t,n),Pe(t,()=>t.activeTexture(t.TEXTURE0+n)),Pe(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function hye(t,e,n){return rl(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function dye(t,e,n){return t.getUniformLocation(e,n)}function pye(t,e,n,i){Pe(t,()=>uye(t,e,i)),Pe(t,()=>t.uniform1i(n,i))}function cE(t,e,n){Pe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Pe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function c4(t,e){Pe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Pe(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function dy(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+fye(t,e))}function fye(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function rl(t,e,n){const i=Pe(t,()=>e());if(i==null)throw new Error(n);return i}function mye(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=e+t.TEXTURE0;if(i<t.TEXTURE0||i>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Zd(t,e=2){return Re(t.slice(0,t.length-e))}function ep(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function py(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Zd(t),...ep(t)]),e}function gye(t,e=!1){let n=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE"),i=Q().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");i===1/0&&Q().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(i=n/2),e&&(n=n*2,i=i*2,t=t.map((a,l)=>l>=t.length-2?bP(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Qu(t).newShape);let r=Re(t),s=null;t.length<=1&&r<=n?s=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?s=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?s=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?s=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?s=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(s=[t[0],t[1]*t[2]*t[3]]);const o=s!=null&&Math.max(...s)>i&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(s==null||o)if(e){const a=Zd(t);let l=2,c=2;t.length&&([l,c]=ep(t)),r=a*(l/2)*(c/2),s=BT(r).map(u=>u*2)}else s=BT(r);return s}function fy(t){return t%2===0}function cS(t,e){if(t=t.slice(-2),e=e.slice(-2),Ni(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],i=e[e.length-1];if(n===i||fy(n)&&fy(i)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&fy(t[0])&&fy(e[0])}let uE,hE;function vye(t){if(uE==null){const e=ko(t);uE=e.getParameter(e.MAX_TEXTURE_SIZE)}return uE}function yye(t){if(hE==null){const e=ko(t);hE=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,hE)}function Sye(t){if(t===0)return 0;let e;const n=ko(t);return Ws(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Ws(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ws(t,e){return t.getExtension(e)!=null}function u4(t){try{if(ko(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function xye(t){if(t===0)return!1;const e=ko(t);if(t===1){if(!Ws(e,"OES_texture_float"))return!1}else if(!Ws(e,"EXT_color_buffer_float"))return!1;return sb(e)}function Cye(t){if(t===0)return!1;const e=ko(t);if(t===1){if(!Ws(e,"OES_texture_float")||!Ws(e,"WEBGL_color_buffer_float"))return!1}else{if(Ws(e,"EXT_color_buffer_float"))return sb(e);const i="EXT_color_buffer_half_float";if(Ws(e,i)){const r=e.getExtension(i);return _ye(e,r)}return!1}return sb(e)}function sb(t){const e=KP(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(s),o}function _ye(t,e){const n=KP(t,e),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(i),t.deleteFramebuffer(o),a}function wye(t){return t!==2?!1:ko(t).fenceSync!=null}function Q0(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&we(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const We=Q();We.registerFlag("HAS_WEBGL",()=>We.getNumber("WEBGL_VERSION")>0);We.registerFlag("WEBGL_VERSION",()=>u4(2)?2:u4(1)?1:0);We.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);We.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>We.get("WEBGL_VERSION")===2);We.registerFlag("WEBGL_CPU_FORWARD",()=>!0);We.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);We.registerFlag("WEBGL_PACK",()=>We.getBool("HAS_WEBGL"));We.registerFlag("WEBGL_PACK_NORMALIZATION",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_CLIP",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_REDUCE",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_LAZILY_UNPACK",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_CONV_IM2COL",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>We.getBool("WEBGL_PACK"));We.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>vye(We.getNumber("WEBGL_VERSION")));We.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>yye(We.getNumber("WEBGL_VERSION")));We.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=We.getNumber("WEBGL_VERSION");return t===0?0:Sye(t)});We.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>We.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!cH());We.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>xye(We.getNumber("WEBGL_VERSION")));We.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>We.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:We.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));We.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Cye(We.getNumber("WEBGL_VERSION")));We.registerFlag("WEBGL_FENCE_API_ENABLED",()=>wye(We.getNumber("WEBGL_VERSION")));We.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>We.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);We.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});We.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>cH()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});We.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);We.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);We.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);We.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);We.registerFlag("WEBGL_EXP_CONV",()=>!1);We.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>We.getBool("IS_TEST"));We.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);We.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);We.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);We.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vr(){let t,e,n,i,r,s,o,a,l,c;return Q().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",i="in",r="texture",s="outputColor",o="out vec4 outputColor;",a=Q().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",i="varying",r="texture2D",s="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:i,texture2D:r,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ih(t,e,n="index"){const i=Di(e);return i.map((r,s)=>{const o=`int ${t[s]} = ${n} / ${r}`,a=s===i.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * ${r}`:`index -= ${t[s]} * ${r}`;return`${o}; ${a};`}).join("")}function BC(t,e,n="index"){const i=Di(e);return i.map((r,s)=>{const o=`int ${t[s]} = ${n} / outShapeStrides[${s}]`,a=s===i.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * outShapeStrides[${s}]`:`index -= ${t[s]} * outShapeStrides[${s}]`;return`${o}; ${a};`}).join("")}function Eye(t,e){const n=t.length,i=t.map(s=>`${e}[${s}]`),r=new Array(n-1);r[n-2]=i[n-1];for(let s=n-3;s>=0;--s)r[s]=`(${r[s+1]} * ${i[s+1]})`;return r}function Rye(t,e,n="index"){const i=t.map((s,o)=>o),r=Eye(i,e);return r.map((s,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,l=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function YP(t){const e=Di(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function JP(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const wV=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:EV}=Vve;function Tye(t,e,n){const i=[];if(t.forEach(p=>{const f=Re(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?i.push(`uniform float ${p.name}${f>1?`[${f}]`:""};`):(i.push(`uniform sampler2D ${p.name};`),i.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){const{uniformShape:v}=QP(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(v.length){case 1:i.push(`uniform int ${p.name}Shape;`);break;case 2:i.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:i.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:i.push(`uniform ivec4 ${p.name}Shape;`);break}i.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;");break}i.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{i.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=i.join(`
`),s=t.map(p=>bye(p,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=vr(),l=Iye(a);let c,u,h=Lye(a);return e.isPacked?(c=Aye(e.logicalShape,o,n.enableShapeUniforms),u=kye(a)):(c=Pye(e.logicalShape,o,n.enableShapeUniforms),u=Mye(a)),n.packedInputs&&(h+=Fye),[h,l,u,r,c,s,n.userCode].join(`
`)}function bp(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return Kye(t,e);case 1:return Jye(t,e);case 2:return Zye(t,e);case 3:return t1e(t,e);case 4:return i1e(t,e);case 5:return r1e(t);case 6:return s1e(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function RV(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return Xye(t);case 1:return Yye(t,e);case 2:return Qye(t,e);case 3:return e1e(t,e);default:return n1e(t,e)}}function bye(t,e,n=!1,i){let r="";n?r+=RV(t,i):r+=bp(t,i);const s=t.shapeInfo.logicalShape,o=e.logicalShape;return s.length<=o.length&&(n?r+=o1e(t,e):r+=a1e(t,e)),r}function Aye(t,e,n){switch(t.length){case 0:return TV();case 1:return zye(t,e,n);case 2:return Gye(t,e,n);case 3:return Bye(t,e,n);default:return Hye(t,e,n)}}function Pye(t,e,n){switch(t.length){case 0:return TV();case 1:return Uye(t,e,n);case 2:return qye(t,e,n);case 3:return $ye(t,e,n);case 4:return Vye(t,e,n);case 5:return jye(t,e);case 6:return Wye(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Iye(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Mye(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function kye(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Lye(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Dye}
    ${Nye}
    ${Oye}
  `}const Dye=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Nye=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Oye=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Fye=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function TV(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function zye(t,e,n){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return i[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${i[1]}.0);
      }
    `:i[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${i[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      return 2 * (resTexRC.x * ${i[1]} + resTexRC.y);
    }
  `}function Uye(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Bye(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),s=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function $ye(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${BC(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const i=ih(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec3(r, c, d);
    }
  `}function Hye(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),s=r*Math.ceil(t[t.length-2]/2);let o=s,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)o*=t[t.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function Vye(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${BC(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const i=ih(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${i}
      return ivec4(r, c, d, d2);
    }
  `}function jye(t,e){const n=ih(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Wye(t,e){const n=ih(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Gye(t,e,n){const i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ni(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${i[0]}, ${i[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));

      int index = resTexRC.x * ${i[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function qye(t,e,n){return Ni(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function rh(t){return`offset${t}`}function Xye(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),i=vr();return`
    vec4 ${n}() {
      return ${i.texture2D}(${e}, halfCR);
    }
  `}function Kye(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${i}() {return ${n};}`;const[r,s]=t.shapeInfo.texShape;if(r===1&&s===1)return`
      float ${i}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=rh(n);if(e)return`
    float ${i}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${i}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function Yye(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,s=vr();if(e)return`
    vec4 ${i}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${i}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function Jye(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${i}(int index) {
        ${Ap(t)}
      }
    `;const r=t.shapeInfo.texShape,s=r[0],o=r[1];if(o===1&&s===1)return`
      float ${i}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=rh(n);return o===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?e?`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function Qye(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape,o=s[0],a=s[1],l=vr();if(s!=null&&Ni(n,s))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);

        return ${l.texture2D}(${i}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${i}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${i}, uv);
    }
  `;const c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${i}, uv);
    }
  `}function Zye(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(s!=null&&Ni(n,s)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `;const d=s[0],p=s[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${i}, uv);
    }
  `}const{newShape:o,keptDims:a}=Qu(n),l=o;if(l.length<n.length){const d=Pp(t,l),p=["row","col"];return`
      ${bp(d,e)}
      float ${r}(int row, int col) {
        return ${r}(${Ip(p,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Ap(t)}
      }
    `;const c=s[0],u=s[1],h=rh(i);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${i}TexShape[0]));
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${i}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${i}TexShape[1]), 0.5);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${i}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
        return sampleTexture(${i}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${i}, uv);
  }
`}function e1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){const d=n.slice(1),p=[1,2],f=Pp(t,d),v=["b","row","col"];return`
        ${RV(f,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Ip(v,p)});
        }
      `}const a=vr();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `;const l=o[0],c=o[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${h}, ${u}, b, row, col);
      return ${a.texture2D}(${i}, uv);
    }
  `}function t1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=Qu(n),c=a;if(c.length<n.length){const v=Pp(t,c),g=["row","col","depth"];return`
        ${bp(v,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Ip(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${o}, 1)));
        ${Ap(t)}
      }
    `;const u=t.shapeInfo.texShape,h=u[0],d=u[1],p=t.shapeInfo.flatOffset;if(d===s&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${i}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${i}, uv);
        }
      `;if(d===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${i}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${i}, uv);
    }
  `;const f=rh(i);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${i}Shape[1] * ${i}Shape[2];
      int stride1 = ${i}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
      return sampleTexture(${i}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${o} + depth + ${f};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${i}, uv);
      }
  `}function n1e(t,e){const n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=vr();if(e)return`
    vec4 ${i}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const s=t.shapeInfo.logicalShape,o=s.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],h=Math.ceil(s[o-1]/2);let d=h*Math.ceil(s[o-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let v=2;v<o-1;v++)p=`int b${v}, `+p,d*=s[o-v-1],f=`b${v} * ${d} + `+f;return`
    vec4 ${i}(${p}) {
      int index = ${f};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${r.texture2D}(${n}, uv);
    }
  `}function i1e(t,e){const n=t.shapeInfo.logicalShape,i=t.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:l,keptDims:c}=Qu(n);if(l.length<n.length){const y=Pp(t,l),S=["row","col","depth","depth2"];return`
      ${bp(y,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Ip(S,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${s}, 1)));
        ${Ap(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${i}Shape[3];`,v=`int stride1 = ${i}Shape[2] * stride2;`,g=`int stride0 = ${i}Shape[1] * stride1;`;if(p===a&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${f}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${i}, uv);
      }
    `;if(p===s&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${i}Shape[1] * ${i}Shape[2], ${i}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${i}, uv);
      }
    `;const m=rh(i);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${v}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index + ${m});
      return sampleTexture(${i}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${m});
      return sampleTexture(${i}, uv);
    }
  `}function r1e(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],s=e[3]*r,o=e[2]*s,a=e[1]*o,{newShape:l,keptDims:c}=Qu(e);if(l.length<e.length){const v=Pp(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${bp(v)}
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        return ${i}(${Ip(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${s}, ${r})) +
          depth3;
        ${Ap(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];if(p===a&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${s}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===r&&u==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const f=rh(n);return`
    float ${i}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${s} +
          depth2 * ${r} + depth3 + ${f};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function s1e(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:s}=Qu(e);if(r.length<e.length){const g=Pp(t,r),m=["row","col","depth","depth2","depth3","depth4"];return`
      ${bp(g)}
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${i}(${Ip(m,s)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Ap(t)}
      }
    `;const h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&h==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===o&&h==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const v=rh(n);return`
    float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${v};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Ap(t){const e=t.name,n=Re(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function o1e(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=EV(t.shapeInfo.logicalShape,e.logicalShape),l=hn(o),c=o-s;let u;const h=["x","y","z","w","u","v"];s===0?u="":o<2&&a.length>=1?u="coords = 0;":u=a.map(y=>`coords.${h[y+c]} = 0;`).join(`
`);let d="";o<2&&s>0?d="coords":d=t.shapeInfo.logicalShape.map((y,S)=>`coords.${h[S+c]}`).join(", ");let p="return outputValue;";const v=Re(t.shapeInfo.logicalShape)===1,m=Re(e.logicalShape)===1;if(s===1&&!v&&!m)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!m)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const y=s-2,S=s-1;a.indexOf(y)>-1&&a.indexOf(S)>-1?p="return vec4(outputValue.x);":a.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${i}(${d});
      ${p}
    }
  `}function a1e(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&Ni(o,s))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=hn(l),u=EV(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const p=["x","y","z","w","u","v"];a===0?d="":l<2&&u.length>=1?d="coords = 0;":d=u.map(v=>`coords.${p[v+h]} = 0;`).join(`
`);let f="";return l<2&&a>0?f="coords":f=t.shapeInfo.logicalShape.map((v,g)=>`coords.${p[g+h]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${d}
      return get${i}(${f});
    }
  `}function hn(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function QP(t,e,n){const{newShape:i,keptDims:r}=Qu(e),s=e.length,o=t&&s===3&&e[0]===1,a=o?e.slice(1):i,l=!t&&s>1&&!Ni(e,n)&&i.length<s||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Pp(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Ip(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l1e(t,e,n,i){const r=n.map((u,h)=>{const d={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(d.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:d}}),s=r.map(u=>u.shapeInfo),o={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},a=Tye(r,o,e),l=tye(t.gl,a),c=t.createProgram(l);return Q().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:s,outShapeInfo:o},bV(t,e,c)))}function bV(t,e,n){const i=[],r=[];let s,o,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),Q().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const h of e.variableNames){const d={name:h,uniform:t.getUniformLocation(n,h,u),offset:t.getUniformLocation(n,`offset${h}`,u)};e.enableShapeUniforms&&(d.shape=t.getUniformLocation(n,`${h}Shape`,u),d.texShape=t.getUniformLocation(n,`${h}TexShape`,u)),i.push(d)}if(e.enableShapeUniforms&&(s=t.getUniformLocation(n,"outShape",u),a=t.getUniformLocation(n,"outShapeStrides",u),o=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const h of e.customUniforms)r.push(t.getUniformLocation(n,h.name,u));return{variablesLocations:i,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}}function h4(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,i)=>{const r=n.logicalShape,s=e[i],o=s.shape;if(!Ni(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&s.isUniform)return;const a=n.texShape,l=s.isUniform?null:s.texData.texShape;if(!Ni(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function c1e(t,e,n,i,r){e.program.enableShapeUniforms||(h4(e.inShapeInfos,n),h4([e.outShapeInfo],[i]));const s=i.texData.texture,o=i.texData.texShape;i.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):t.setOutputMatrixTexture(s.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),Q().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:u,offset:h,shape:d,texShape:p}=e.variablesLocations[l];if(d){const{uniformShape:f}=QP(e.program.packedInputs,c.shape,c.texData.texShape);switch(f.length){case 1:t.gl.uniform1iv(d,new Int32Array(f));break;case 2:t.gl.uniform2iv(d,new Int32Array(f));break;case 3:t.gl.uniform3iv(d,new Int32Array(f));break;case 4:t.gl.uniform4iv(d,new Int32Array(f));break}}if(p&&t.gl.uniform2i(p,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(Re(c.shape)<2)t.gl.uniform1f(u,c.uniformValues[0]);else{let f=c.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),t.gl.uniform1fv(u,f)}continue}c.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(i.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(i.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(i.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(i.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(i.shape));break}if(e.outShapeStridesLocation){const l=Di(i.shape);switch(i.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],h=r[l];if(c.type==="float")t.gl.uniform1fv(u,h);else if(c.type==="vec2")t.gl.uniform2fv(u,h);else if(c.type==="vec3")t.gl.uniform3fv(u,h);else if(c.type==="vec4")t.gl.uniform4fv(u,h);else if(c.type==="int")t.gl.uniform1iv(u,h);else if(c.type==="ivec2")t.gl.uniform2iv(u,h);else if(c.type==="ivec3")t.gl.uniform3iv(u,h);else if(c.type==="ivec4")t.gl.uniform4iv(u,h);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function u1e(t,e,n){let i="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:h}=QP(t.packedInputs,o.shape,l);let d="",p="",f="";if(u.length===1&&t.packedInputs){const w=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];d=`${w[0]>1}_${w[1]>1}`}else if(u.length===2&&!t.packedInputs)p=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const w=Di(u);f=`${w[0]===l[1]}_${w[w.length-1]===l[1]}`}const v=o.shape.length,g=u.length===2&&Ni(o.shape,l),m=Re(o.shape)===1,y=lS(o.shape,n.shape),S=!t.packedInputs&&v===n.shape.length&&Ni(l,n.texData.texShape),x=t.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;i+=`${v}_${S}_${c?h:""}_${u.length}_${m}_${y}_${g}_${d}_${p}_${f}_${x}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;i+=`${o.shape}_${l}_${a}`}});const r=t.userCode;let s=t.constructor.name;return s+="_"+i+"_"+r+`${Q().getNumber("WEBGL_VERSION")}`,s}function Yi(t){return Q().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h1e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=d0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?BC(["r","c","d"],e):ih(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d1e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=d0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?BC(["r","c","d"],e):ih(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p1e{constructor(e){this.variableNames=["A"],this.outTexUsage=gs.DOWNLOAD;const n=vr();this.outputShape=e,this.userCode=`
      ${wV}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f1e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=gs.DOWNLOAD;const n=vr();this.outputShape=e,this.userCode=`
      ${wV}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m1e={R:0,G:1,B:2,A:3};class d4{constructor(e,n=!1,i="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);let s="result";n&&(s="floor(result * 255. + 0.5)");let o="";for(let a=0;a<i.length;a++){const l=i[a];o+=`
          if(offset == ${a}) {
            result = values[${m1e[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?JP():YP(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${i.length});

        flatIndex = idiv(flatIndex, ${i.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${s}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g1e{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=vr();this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);let r="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${i.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?JP():YP(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${i.output} = ${s};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1e(t){const e=vr(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return eye(t,n)}function y1e(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return sye(t,e)}function S1e(t){const e=new Uint16Array([0,1,2,2,1,3]);return oye(t,e)}function Z0(t,e,n,i,r,s){lye(e,n);const o=aye(t),a=t.TEXTURE_2D;return Pe(t,()=>t.bindTexture(a,o)),Pe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Pe(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Pe(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Pe(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),Q().getNumber("WEBGL_VERSION")===1?Pe(t,()=>t.texImage2D(a,0,i,e,n,0,r,s,null)):Pe(t,()=>t.texStorage2D(a,1,i,e,n)),Pe(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function AV(t){return t.internalFormatFloat}function x1e(t,e,n,i){const[r,s]=J0(e,n);return Z0(t,r,s,AV(i),i.textureFormatFloat,t.FLOAT)}function PV(t){return t.internalFormatHalfFloat}function C1e(t,e,n,i){const[r,s]=J0(e,n);return Z0(t,r,s,PV(i),i.textureFormatFloat,i.textureTypeHalfFloat)}function IV(t){return t.downloadTextureFormat}function _1e(t,e,n,i){const[r,s]=J0(e,n);return Z0(t,r,s,IV(i),t.RGBA,t.UNSIGNED_BYTE)}function MV(t){return t.internalFormatPackedFloat}function w1e(t,e,n,i){const[r,s]=Tp(e,n);return Z0(t,r,s,MV(i),t.RGBA,t.FLOAT)}function kV(t){return t.internalFormatPackedHalfFloat}function E1e(t,e,n,i){const[r,s]=Tp(e,n);return Z0(t,r,s,kV(i),t.RGBA,i.textureTypeHalfFloat)}function R1e(t,e,n){return Pe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),l4(t,e,"clipSpacePos",n,3,20,0)&&l4(t,e,"uv",n,2,20,12)}function T1e(t,e,n,i,r,s){Pe(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(n*i*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*i*4),a=t.FLOAT,l=s.internalFormatPackedFloat),o.set(r),Q().getNumber("WEBGL_VERSION")===2?Pe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,i,t.RGBA,a,o)):Pe(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,i,0,t.RGBA,a,o)),Pe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function b1e(t,e,n){Pe(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?Q().getNumber("WEBGL_VERSION")===2?Pe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):Pe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):Q().getNumber("WEBGL_VERSION")===2?Pe(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):Pe(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),Pe(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function A1e(t,e,n,i){const r=t.createBuffer();Pe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return Pe(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Pe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),Pe(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function P1e(t,e,n){const i=t,r=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,r),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),r}function I1e(t,e,n,i){const[r,s]=J0(e,n),o=4,a=new Uint8Array(qve(e*n,o));return Pe(t,()=>t.readPixels(0,0,r,s,i.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function M1e(t,e,n,i,r,s,o,a){const l=t,c=new Float32Array(Xve(s,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function k1e(t,e,n){const i=new Float32Array(e*n*4);return Pe(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,i)),i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dE{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=Q().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,jve(n,e)):this.gl=ko(n),e=this.gl,Q().getNumber("WEBGL_VERSION")===2){const s=e;this.createVertexArray=()=>Pe(s,()=>s.createVertexArray()),this.bindVertexArray=o=>Pe(s,()=>s.bindVertexArray(o)),this.deleteVertexArray=o=>Pe(s,()=>s.deleteVertexArray(o)),this.getVertexArray=()=>Pe(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(e!=null){const s=e.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Pe(e,()=>s.createVertexArrayOES()),this.bindVertexArray=o=>Pe(e,()=>s.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Pe(e,()=>s.deleteVertexArrayOES(o)),this.getVertexArray=()=>Pe(e,()=>e.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let i="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Q().getNumber("WEBGL_VERSION")===1){const s="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=hy(this.gl,s),Ws(this.gl,o))this.textureHalfFloatExtension=hy(this.gl,o);else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),Ws(this.gl,r))this.colorBufferHalfFloatExtension=hy(this.gl,r);else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",Ws(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(Ws(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=y1e(this.gl),this.indexBuffer=S1e(this.gl),this.framebuffer=cye(this.gl),this.textureConfig=KP(this.gl,this.textureHalfFloatExtension)}get debug(){return Q().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Pe(e,()=>e.finish()),Pe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Pe(e,()=>e.deleteFramebuffer(this.framebuffer)),Pe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Pe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Pe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),x1e(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),C1e(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),_1e(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),b1e(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,i,r){this.throwIfDisposed(),T1e(this.gl,e,n,i,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),E1e(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),w1e(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(c4(this.gl,this.framebuffer),this.outputTexture=null),Pe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,i){return this.downloadMatrixDriver(e,()=>I1e(this.gl,n,i,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,i,r,s,o){return M1e(this.gl,e,n,i,r,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return P1e(this.gl,e,n)}createBufferFromTexture(e,n,i){this.bindTextureToFrameBuffer(e);const r=A1e(this.gl,n,i,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,i;if(Q().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,s=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),i=()=>{const o=r.clientWaitSync(s,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=s}else Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),i=()=>this.isQueryAvailable(n,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):i=()=>!0;return{query:n,isFencePassed:i}}downloadMatrixFromPackedTexture(e,n,i){return this.downloadMatrixDriver(e,()=>k1e(this.gl,n,i))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=v1e(n));const i=iye(n);Pe(n,()=>n.attachShader(i,this.vertexShader)),Pe(n,()=>n.attachShader(i,e)),rye(n,i);const r=Object.assign(i,{vao:this.createVertexArray()});return this.debug&&lE(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;Pe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),R1e(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Pe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&lE(this.gl,this.program),Pe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,i=!0){return this.throwIfDisposed(),i?hye(this.gl,e,n):dye(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),Pe(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,i){this.throwIfDisposed(),this.throwIfNoProgram(),pye(this.gl,e,n,i)}setOutputMatrixTexture(e,n,i){this.setOutputMatrixTextureDriver(e,i,n)}setOutputPackedMatrixTexture(e,n,i){this.throwIfDisposed();const[r,s]=Tp(n,i);this.setOutputMatrixTextureDriver(e,r,s)}setOutputMatrixWriteRegion(e,n,i,r){this.setOutputMatrixWriteRegionDriver(i,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,i,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&lE(this.gl,this.program),dy(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Pe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Pe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=hy(this.gl,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const i=this.gl,r=this.getQueryTimerExtensionWebGL2(),s=i.createQuery();return i.beginQuery(r.TIME_ELAPSED_EXT,s),s}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,i=this.getQueryTimerExtensionWebGL2();n.endQuery(i.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await NO(()=>this.disposed||this.isQueryAvailable(e,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const i=this.gl;return i.getQueryParameter(e,i.QUERY_RESULT)/1e6}else{const i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const i=this.gl,r=this.getQueryTimerExtensionWebGL2(),s=i.getQueryParameter(e,i.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{const i=this.getQueryTimerExtensionWebGL1(),r=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=L1e(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:i}=this.itemsToPoll[n];i()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let i;"setTimeoutCustom"in Q().platform&&(i=Q().platform.setTimeoutCustom.bind(Q().platform)),NO(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,i)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),cE(this.gl,e,this.framebuffer),this.debug&&dy(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(cE(this.gl,this.outputTexture,this.framebuffer),this.debug&&dy(this.gl)):c4(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const i=n();return this.unbindTextureToFrameBuffer(),i}setOutputMatrixTextureDriver(e,n,i){this.throwIfDisposed();const r=this.gl;cE(r,e,this.framebuffer),this.debug&&dy(r),this.outputTexture=e,Pe(r,()=>r.viewport(0,0,n,i)),Pe(r,()=>r.scissor(0,0,n,i))}setOutputMatrixWriteRegionDriver(e,n,i,r){this.throwIfDisposed(),Pe(this.gl,()=>this.gl.scissor(e,n,i,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function L1e(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1e(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lr(t){return(e,n,i,r,s)=>{const o=pr(e,n),a=o.length,l=Di(o),c=Re(o),u=zu(s,c),h=e.length,d=n.length,p=Di(e),f=Di(n),v=lS(e,o),g=lS(n,o);if(v.length+g.length===0)for(let m=0;m<u.length;++m)u[m]=t(i[m%i.length],r[m%r.length]);else for(let m=0;m<u.length;++m){const y=AP(m,a,l),S=y.slice(-h);v.forEach(E=>S[E]=0);const x=VT(S,h,p),w=y.slice(-d);g.forEach(E=>w[E]=0);const C=VT(w,d,f);u[m]=t(i[x],r[C])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N1e(t,e,n,i){if(i==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(i==="bool"){const r=OC([0],n),[s,o]=Lr((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[o,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${i}`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O1e=Lr((t,e)=>t+e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1e(t,e,n,i,r){const s=Re(i),o=uc(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(s>0?o[l]+=e[a]:o[l]+=1)}return o}function z1e(t,e,n,i=!1){const r=t.shape[0],s=t.shape[1],o=Oi([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<s;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(i?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U1e=Lr((t,e)=>t&e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sl(t){return(e,n,i)=>{const r=_i(n,e.length);for(let s=0;s<e.length;++s)r[s]=t(e[s],i);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B1e=sl(t=>Math.ceil(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1e(t,e,n,i){const r=_i(n,Re(e));if(i&&n!=="string"){let s=0;t.forEach(o=>{const a=Re(o.shape);r.set(o.vals,s),s+=a})}else{let s=0;t.forEach(o=>{const a=n==="string"?Qd(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const u=c*e[1]+s;for(let h=0;h<o.shape[1];++h)r[u+h]=a[l++]}s+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1e=Lr((t,e)=>t===e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V1e=sl(t=>Math.exp(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j1e=sl(t=>Math.expm1(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W1e=sl(t=>Math.floor(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G1e=Lr((t,e)=>Math.floor(t/e));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q1e(t,e,n,i,r,s,o,a,l){const c=Oi([i,s],n);for(let u=0;u<i;u++){const h=[];let d=0;for(let p=0;p<r;p++){const f=t[u*r+p];d+=f*o[p],h.push(f)}if(d<0||d>=l/s)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let p=0;p<s;p++)c.values[u*s+p]=e.get(...e.indexToLoc(d*s+p))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X1e(t,e,n){const i=Oi(n,t.dtype);for(let r=0;r<i.size;++r){const o=i.indexToLoc(r).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const u=t.locToIndex(o);0<=u&&u<t.values.length&&(i.values[r]=t.values[u])}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1e=Lr((t,e)=>t>e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y1e=Lr((t,e)=>t>=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1e=Lr((t,e)=>t<e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1e=Lr((t,e)=>t<=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1e(t,e,n){const i=(e-t)/(n-1),r=uc(n,"float32");r[0]=t;for(let s=1;s<r.length;s++)r[s]=r[s-1]+i;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eSe=sl(t=>Math.log(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tSe(t,e,n,i){const r=zu(i,Re(n));for(let s=0;s<r.length;++s){const o=s*e;let a=t[o];for(let l=0;l<e;++l){const c=t[o+l];(Number.isNaN(c)||c>a)&&(a=c)}r[s]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nSe=Lr((t,e)=>Math.max(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iSe=Lr((t,e)=>Math.min(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LV=Lr((t,e)=>t*e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rSe(t,e,n){const i=_p(-1,n);return LV([],e,i,t,n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sSe=Lr((t,e)=>t!==e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oSe(t,e,n,i,r){const s=e.length,o=Re(e),a=Di(e),l=Di(r),c=zu(n,Re(r));for(let u=0;u<o;++u){const h=AP(u,s,a),d=new Array(h.length);for(let f=0;f<d.length;f++)d[f]=h[i[f]];const p=VT(d,s,l);c[p]=t[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSe(t,e,n,i){const[r,s]=va(t,i),o=ua(e,"int32"),a=uc(Re(r),o),l=Re(s);for(let c=0;c<a.length;++c){const u=c*l;let h=1;for(let d=0;d<l;++d)h*=n[u+d];a[c]=h}return{outVals:a,outShape:r,outDtype:o}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lSe(t,e,n){t.forEach((i,r)=>{if(i<0||i>=n){const s=AP(r,e.length,Di(e)).join(",");throw new Error(`indices[${s}] = ${i} is not in [0, ${n})`)}})}function cSe(t,e){for(let n=0;n<t.length;++n){const i=t[n],r=n===t.length-1?e:t[n+1].length;if(i.length===0)throw new Error("Ragged splits may not be empty");if(i[0]<0)throw new Error("Ragged splits must be non-negative");if(i[i.length-1]>r)throw new Error("Ragged splits must not point past values");for(let s=1;s<i.length;++s)if(i[s-1]>i[s])throw new Error("Ragged splits must be sorted in ascending order")}}function uSe(t,e,n,i){const r=[];let s=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);cSe(n,i);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let h=1;h<l+1;++h)a[c].push(h*u)}for(let c=0;c<t.length;++c){let u=t[c],h=t[c]+1;for(let d=0;d<n.length;++d){const p=n[d],f=d+e.length-1;if(f>=0){const v=a[f],g=v[v.length-1]-p[u];for(let m=u;m<h;++m)a[f].push(p[m+1]+g)}u=p[u],h=p[h]}h!==u&&(r.push([u,h]),s+=h-u)}return{outSplits:a,valueSlices:r,numValues:s}}function hSe(t){const e=[];for(let n=0;n<t.length;++n){const i=t[n].length,r=_i("int32",i);e.push(r),t[n].forEach((s,o)=>r[o]=s)}return e}function p4(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let i=e;i<t.length;i++)n[e-1]*=t[i];return n}function dSe(t,e,n,i,r,s){const o=p4(e,2)[1],a=p4(s,2)[1];let l=0;for(const c of n)for(let u=c[0];u<c[1];++u){for(let h=0;h<i;++h)r[l*a+h]=t[u*o+h];++l}}function pSe(t,e,n,i,r){const s=e.slice();s[0]=r;const o=_i(n,Re(s)),a=t.length,l=a===0?0:a/e[0];return dSe(t,e,i,l,o,s),[o,s]}function fSe(t,e,n,i,r,s,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(lSe(s,o,l),i.length===0)throw new Error("params.rank must be nonzero");const c=i[0],{outSplits:u,valueSlices:h,numValues:d}=uSe(s,o,t,c),p=hSe(u),f=pSe(n,i,r,h,d);return[p,f[0],f[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f4=2147483647;function mSe(t,e,n,i,r,s,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,c=o.length===0,u=[];a||u.push(e[0]),l||u.push(r[0]),c||u.push(o[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=u.length===0?1:u[0],d=_i("int32",h+1);d[0]=0;for(let g=0;g<h;++g){const m=a?t[0]:t[g],y=l?i[0]:i[g],S=c?s[0]:s[g];if(S===0)throw new Error("Requires delta != 0");let x;if(S>0&&y<m||S<0&&y>m)x=0;else if(x=Math.ceil(Math.abs((y-m)/S)),x>f4)throw new Error(`Requires ((limit - start) / delta) <= ${f4}`);d[g+1]=d[g]+x}const p=d[h],f=_i(n,p);let v=0;for(let g=0;g<h;++g){const m=d[g+1]-d[g];let y=a?t[0]:t[g];const S=c?s[0]:s[g];for(let x=0;x<m;++x)f[v++]=y,y+=S}return[d,f]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ks=Co;class uS{constructor(e,n,i,r,s,o,a,l,c,u){this.shape=e,this.shapeShape=n,this.values=i,this.valuesShape=r,this.valuesDType=s,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=$H(u),this.raggedRank=HH(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ks.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ks.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ks.VALUE_ROWIDS:return uS.getMaxWidthValueRowID(n);case ks.ROW_SPLITS:return uS.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${ks[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let i=0;for(let r=0;r<n-1;++r){const s=e[r+1]-e[r];s>i&&(i=s)}return i}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let i=0,r=e[0],s=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,s=Math.max(o-i,s),i=o)}return Math.max(n-i,s)}tensorShapeFromTensor(e,n,i=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return g4(e,i)}calculateOutputSize(e){const n=this.valuesShape,i=this.defaultValueShape;VH(i,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=BH(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,i){const r=Math.min(e,i),s=[];let o=0;for(let a=0;a<r;++a,o+=n)s.push(o);for(let a=r;a<e;++a)s.push(-1);return we(s.length===e,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(e,n,i,r){const s=e.length,o=[];for(let a=0;a<s-1;++a){const l=e[a+1]-e[a];let c=Math.min(r,l),u=n[a];u===-1&&(c=0);for(let h=0;h<c;++h)o.push(u),u+=i;for(let h=0;h<l-c;++h)o.push(-1)}if(s>0&&o.length!==e[s-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,i,r){const s=e.length,o=[];if(s===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];o.push(c);for(let u=1;u<s;++u){const h=e[u];if(h===l)c>=0&&(++a,a<r?c+=i:c=-1);else{if(a=0,l=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);c=n[h]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,i,r){const s=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ks.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,i,r);case ks.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,i,r);default:throw new Error(`Unsupported partition type: ${ks[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case ks.FIRST_DIM_SIZE:return e[0];case ks.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ks.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ks[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),i=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*i[l+1];const s=g4(i,!1),o=_i(this.valuesDType,Re(s));if(r[0]*i[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],i[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],i[c]);this.setOutput(this.raggedRank,l,o,s)}return[s,o]}setOutput(e,n,i,r){if(i.length===0)return;const s=this.values,o=i;let a=r.slice();a=a.slice(e+1);const l=Re(a),c=n.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const f=this.defaultValueShape;ii(()=>{const v=zP(u,f);u=y0e(v,a).dataSync()})}let h=0,d=0,p=0;for(let f=0;f<=c;++f){let v=f<c?n[f]:-1;if(v===p){++p;continue}if(d<p){const g=s.subarray(h*l),m=o.subarray(d*l),y=(p-d)*l;m4(m,g,y)}if(f>=c){const g=i.length;v=Math.floor(g/l)}if(v>p)if(this.defaultValue.length===1)o.subarray(p*l,v*l).fill(this.defaultValue[0]),p=v;else for(;v>p;){const g=o.slice(p*l);m4(g,u,l),++p}v<0?(h=f+1,d=p):(h=f,d=p,p=d+1)}}}function m4(t,e,n){for(let i=0;i<n;i++)t[i]=e[i]}function g4(t,e){const n=[];for(let i of t){if(i<0){if(!e)throw new Error(`Dimension ${i} must be >= 0`);if(i<-1)throw new Error(`Dimension ${i} must be >= -1`);i=-1}n.push(i)}return n}function gSe(t,e,n,i,r,s,o,a,l,c){return new uS(t,e,n,i,r,s,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vSe(t,e,n,i){const r=t===e,s=t<e&&n<0,o=e<t&&n>1;if(r||s||o)return uc(0,i);const a=Math.abs(Math.ceil((e-t)/n)),l=uc(a,i);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ySe=sl(t=>1/Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SSe(t,e,n,i,r,s,o,a,l,c){const u=[i/r,r],h=t.values,d=e.values;if(i===0)return Oi(n,e.dtype);const p=l instanceof sS?l:Oi(u,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let f=0;f<s;f++){const v=[];let g=0;for(let m=0;m<o;m++){const y=h[f*o+m];v.push(y),g+=y*a[m]}if(g<0||g>=i/r)throw new Error(`Invalid indices: ${v} does not index into ${n}`);for(let m=0;m<r;m++)c?p.values[g*r+m]+=d[f*r+m]:p.values[g*r+m]=e.rank===0?d[0]:d[f*r+m]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xSe=sl(t=>1/(1+Math.exp(-t)));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CSe(t,e,n,i,r){const s=VP(i,e,n),o=Re(n),a=Di(i);if(s){const h=jP(e,a);return r==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const l=r==="string"?Qd(t):t,c=Oi(i,r,l),u=Oi(n,r);for(let h=0;h<u.size;++h){const d=u.indexToLoc(h),p=d.map((f,v)=>f+e[v]);u.set(c.get(...p),...d)}return r==="string"?CV(u.values):u.values}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Se(t,e,n,i,r,s,o){const a=e[0],l=s[0],c=new Array(l),u=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(aV(a));const g=_i(n,0),m=_i(r,0);return[g,[0,h],m,c,u]}let d=!0,p=0;const f=new Array(l).fill(0);for(let g=0;g<a;++g){const m=t[g*h];if(m<0)throw new Error(lV(g,m));if(m>=l)throw new Error(cV(g,m,l));++f[m],d=d&&m>=p,p=m}let v=!0;for(let g=0;g<l;++g){const m=f[g]===0;c[g]=m,v=v&&!m,f[g]=Math.max(f[g],1),g>0&&(f[g]+=f[g-1])}if(v&&d){const g=t,m=i;for(let y=0;y<a;++y)u[y]=y;return[g,[a,h],m,c,u]}else{const g=f[l-1],m=_i(n,g*h),y=_i(r,g),S=new Array(l).fill(0);for(let x=0;x<a;++x){const w=t[x*h],C=S[w],E=(w===0?0:f[w-1])+C;S[w]++;for(let T=0;T<h;++T)m[E*h+T]=t[x*h+T];y[E]=i[x],u[x]=E}for(let x=0;x<l;++x)if(S[x]===0){const C=x===0?0:f[x-1];m[C*h+0]=x;for(let E=1;E<h;++E)m[C*h+E]=0;y[C]=o}return[m,[g,h],y,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wSe(t,e,n,i,r){const s=Re(i),o=e[0],a=r.length,l=[];let c=1,u=-1;for(let g=0;g<a;++g){const m=r[g];if(m===-1){if(u!==-1)throw new Error(uV(u,g));u=g,l.push(1)}else{if(m<0)throw new Error(hV(g,m));c*=m,l.push(m)}}if(u!==-1){if(c<=0)throw new Error(dV());const g=Math.trunc(s/c);if(c*g!==s)throw new Error(pV(i,l));l[u]=g}if(Re(l)!==s)throw new Error(fV(i,l));const d=i.length,p=[];if(d>0){p[d-1]=1;for(let g=d-2;g>=0;--g)p[g]=p[g+1]*i[g+1]}const f=[];if(a>0){f[a-1]=1;for(let g=a-2;g>=0;--g)f[g]=f[g+1]*l[g+1]}const v=_i(n,o*a);for(let g=0;g<o;++g){let m=0;for(let y=0;y<d;++y)m+=t[g*d+y]*p[y];for(let y=0;y<a;++y)v[g*a+y]=Math.trunc(m/f[y]),m%=f[y]}return[v,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(t,e,n,i,r,s=!1,o=0){const a=i.length,l=[e[0],t.length/e[0]],c=l[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(rb());const d=e.slice();d[0]=h;const p=d.reduce((S,x)=>S*x,1),f=_i(n,p);if(a===0)return h>0&&f.fill(o),[f,d];if(h<=0)throw new Error(rb());let v=0,g=1,m=0,y=r[v];for(;;){let S=0;if(g<a){if(S=r[g],y===S){++g;continue}if(y>=S)throw new Error(mV())}if(y<0||y>=h)throw new Error(gV(y,h));y>m&&f.fill(o,m*c,y*c);for(let x=v;x<g;++x){const w=i[x];if(w<0||w>=l[0])throw new Error(vV(x,i[x],l[0]));for(let C=0;C<c;C++)f[y*c+C]+=t[w*c+C]}if(s)for(let x=0;x<c;x++)f[y*c+x]/=g-v;if(v=g,++g,m=y+1,y=S,g>a)break}return m<h&&f.fill(o,m*c,h*c),[f,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RSe=sl(t=>Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TSe=Lr((t,e)=>{const n=t-e;return n*n});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bSe=sl((t,e)=>{const{pattern:n,replaceGlobal:i,rewrite:r}=e;return t.replace(new RegExp(n,i?"g":""),r)});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ASe(t,e,n,i){const r=Oi(t,e.dtype);for(let s=0;s<r.size;s++){const o=r.indexToLoc(s),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+i[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PSe{constructor(e,n,i,r,s,o){this.separator=Cu(e),this.nGramWidths=n,this.leftPad=Cu(i),this.rightPad=Cu(r),this.padWidth=s,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const i=this.getPadWidth(n);return Math.max(0,e+2*i-n+1)}createNGrams(e,n,i,r,s,o){for(let a=0;a<s;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),u=Math.max(0,l-(s-(a+1))),h=o-(c+u),d=n+(c>0?0:a-l);let p=0;p+=c*this.leftPad.length;for(let y=0;y<h;++y)p+=e[d+y].length;p+=u*this.rightPad.length;const f=c+u+h-1;p+=f*this.separator.length,i[r+a]=new Uint8Array(p);const v=i[r+a];let g=0;const m=y=>y.forEach(S=>v[g++]=S);for(let y=0;y<c;++y)m(this.leftPad),m(this.separator);for(let y=0;y<h-1;++y)m(e[d+y]),m(this.separator);if(h>0){m(e[d+h-1]);for(let y=0;y<u;++y)m(this.separator),m(this.rightPad)}else{for(let y=0;y<u-1;++y)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,n){const i=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let u=n[c]>=l;if(u=u&&n[c]<=i,!u)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${i}]`);l=n[c]}if(l!==i)throw new Error(`Last split value must be data size. Expected ${i}, got ${l}`)}const s=r-1,o=_i("int32",r);if(i===0||r===0){const l=new Array(i);for(let c=0;c<=s;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=s;++l){const c=n[l]-n[l-1];let u=0;this.nGramWidths.forEach(h=>{u+=this.getNumNGrams(c,h)}),this.preserveShort&&c>0&&u===0&&(u=1),o[l]=o[l-1]+u}const a=new Array(o[s]);for(let l=0;l<s;++l){const c=n[l];let u=o[l];if(this.nGramWidths.forEach(h=>{const d=n[l+1]-n[l],p=this.getNumNGrams(d,h);this.createNGrams(e,c,a,u,p,h),u+=p}),this.preserveShort&&u===o[l]){const h=n[l+1]-n[l];if(h===0)continue;const d=h+2*this.padWidth;this.createNGrams(e,c,a,u,1,d)}}return[a,o]}}function ISe(t,e,n,i,r,s,o,a){return new PSe(n,i,r,s,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MSe(t,e,n,i){if(!t.length)return;if(e.length===0){for(let s=0;s<t.length;++s)i.push(t.subarray(s,s+1));return}if(e.length===1){const s=e[0];let o=t.indexOf(s);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&i.push(a),t=t.subarray(o+1),o=t.indexOf(s)}(!n||t.length!==0)&&i.push(t);return}let r=0;for(let s=0;s<t.length+1;s++)if(s===t.length||e.indexOf(t[s])!==-1){const o=t.subarray(r,s);(!n||o.length!==0)&&i.push(o),r=s+1}}function kSe(t,e,n){const i=t.length,r=[];let s=0,o=0;const a=new Array(i);for(let d=0;d<i;++d){const p=r.length;MSe(t[d],e,n,r);const f=r.length-p;a[d]=f,s+=f,o=Math.max(o,f)}const l=_i("int32",s*2),c=new Array(s),u=[i,o];let h=0;for(let d=0;d<i;++d)for(let p=0;p<a[d];++p)l[h*2]=d,l[h*2+1]=p,c[h]=r[h],++h;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSe(t,e){const n=_i("int32",t.length);for(let i=0;i<t.length;++i)n[i]=lge(t[i]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DSe=Lr((t,e)=>t-e);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const i=Oi(n,t.dtype);for(let r=0;r<i.values.length;++r){const s=i.indexToLoc(r),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=s[l]%t.shape[l];const a=t.locToIndex(o);i.values[r]=t.values[a]}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const og=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function DV(t,e,n=0,i=t.length-1){for(;i>n;){if(i-n>600){const a=i-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),d=Math.max(n,Math.floor(e-l*u/a+h)),p=Math.min(i,Math.floor(e+(a-l)*u/a+h));DV(t,e,d,p)}const r=t[e];let s=n,o=i;for(Wm(t,n,e),og(t[i],r)>0&&Wm(t,n,i);s<o;){for(Wm(t,s,o),s++,o--;og(t[s],r)<0;)s=s+1;for(;og(t[o],r)>0;)o=o-1}og(t[n],r)===0?Wm(t,n,o):(o=o+1,Wm(t,o,i)),o<=e&&(n=o+1),e<=o&&(i=o-1)}}function OSe(t,e,n,i,r){const s=e[e.length-1],[o,a]=[t.length/s,s],l=zu(n,o*i),c=zu("int32",o*i);for(let h=0;h<o;h++){const d=h*a,p=t.subarray(d,d+a);let f=new Array(p.length);p.forEach((y,S)=>f[S]={value:y,index:S}),i<f.length&&(DV(f,i),f=f.slice(0,i)),r&&f.sort(og);const v=h*i,g=l.subarray(v,v+i),m=c.subarray(v,v+i);for(let y=0;y<i;y++)g[y]=f[y].value,m[y]=f[y].index}const u=e.slice();return u[u.length-1]=i,[Oi(u,n,l),Oi(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FSe(t,e,n,i){const r=kr(e,n)[0],s=[1,n[0],1];for(let f=0;f<r;f++)s[0]*=n[f];s[1]=n[r];for(let f=r+1;f<n.length;f++)s[2]*=n[f];const o=new Map,a=new Int32Array(n[r]),l=new sS(s,i,t),c=[],u=s[0]===1&&s[2]===1;for(let f=0;f<n[r];f++){let v;if(u)v=t[f].toString();else{const m=[];for(let y=0;y<s[0];y++)for(let S=0;S<s[2];S++)m.push(l.get(y,f,S));v=m.join(",")}const g=o.get(v);if(g!=null)a[f]=g;else{const m=o.size;o.set(v,m),a[f]=m,c.push(f)}}const h=s.slice();h[1]=o.size;const d=new sS(h,i);c.forEach((f,v)=>{for(let g=0;g<s[0];g++)for(let m=0;m<s[2];m++)d.set(l.get(g,f,m),g,v,m)});const p=n.slice();return p[r]=h[1],{outputValues:d.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zSe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:O1e,bincountImpl:F1e,bincountReduceImpl:z1e,bitwiseAndImpl:U1e,castImpl:N1e,ceilImpl:B1e,concatImpl:$1e,equalImpl:H1e,expImpl:V1e,expm1Impl:j1e,floorDivImpl:G1e,floorImpl:W1e,gatherNdImpl:q1e,gatherV2Impl:X1e,greaterEqualImpl:Y1e,greaterImpl:K1e,lessEqualImpl:Q1e,lessImpl:J1e,linSpaceImpl:Z1e,logImpl:eSe,maxImpl:tSe,maximumImpl:nSe,minimumImpl:iSe,multiplyImpl:LV,negImpl:rSe,notEqualImpl:sSe,prodImpl:aSe,raggedGatherImpl:fSe,raggedRangeImpl:mSe,raggedTensorToTensorImpl:gSe,rangeImpl:vSe,rsqrtImpl:ySe,scatterImpl:SSe,sigmoidImpl:xSe,simpleAbsImpl:D1e,sliceImpl:CSe,sparseFillEmptyRowsImpl:_Se,sparseReshapeImpl:wSe,sparseSegmentReductionImpl:ESe,sqrtImpl:RSe,squaredDifferenceImpl:TSe,staticRegexReplaceImpl:bSe,stridedSliceImpl:ASe,stringNGramsImpl:ISe,stringSplitImpl:kSe,stringToHashBucketFastImpl:LSe,subImpl:DSe,tileImpl:NSe,topKImpl:OSe,transposeImpl:oSe,uniqueImpl:FSe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:USe,bincountImpl:NV,bincountReduceImpl:BSe,bitwiseAndImpl:$Se,castImpl:HSe,ceilImpl:VSe,concatImpl:jSe,equalImpl:WSe,expImpl:GSe,expm1Impl:qSe,floorImpl:XSe,gatherNdImpl:KSe,gatherV2Impl:YSe,greaterImpl:JSe,greaterEqualImpl:QSe,lessImpl:ZSe,lessEqualImpl:exe,linSpaceImpl:txe,logImpl:nxe,maxImpl:ixe,maximumImpl:rxe,minimumImpl:sxe,multiplyImpl:oxe,negImpl:axe,notEqualImpl:lxe,prodImpl:cxe,raggedGatherImpl:uxe,raggedRangeImpl:hxe,raggedTensorToTensorImpl:dxe,rangeImpl:pxe,rsqrtImpl:fxe,scatterImpl:mxe,sigmoidImpl:gxe,simpleAbsImpl:OV,sliceImpl:vxe,sparseFillEmptyRowsImpl:yxe,sparseReshapeImpl:Sxe,sparseSegmentReductionImpl:FV,sqrtImpl:xxe,staticRegexReplaceImpl:Cxe,stridedSliceImpl:_xe,stringNGramsImpl:wxe,stringSplitImpl:Exe,stringToHashBucketFastImpl:Rxe,subImpl:Txe,tileImpl:bxe,topKImpl:Axe,transposeImpl:ZP,uniqueImpl:Pxe}=zSe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function dr(t,e){return e===1?[t]:zV(t,e)}function Ixe(t,e){if(t===1)return"rc";let n="";for(let i=0;i<t;i++)n+=e[i],i<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mxe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Yi(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=dr("rc",this.rank),i=hn(this.rank),r=this.getOutOfBoundsCondition(n),s=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let i=0;i<=1;i++)for(let r=0;r<=1;r++){let s=`${i===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)s=`${e[e.length-1-o]},`+s;n.push(s)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let i=this.rank-2;i<this.rank;i++)n+=`${e[i]} >= ${this.enableShapeUniforms?`outShape[${i}]`:this.outputShape[i]}`,i<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),i=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${i};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UV{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);let i="";for(let r=0;r<4;r++){let s="thisRC = rc;";r%2===1&&(s+="thisRC.z += 1;"),r>1&&(s+="thisRC.y += 1;"),i+=`
        ${s}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${kxe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?JP():YP(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${i}

        setOutput(result);
      }
    `}}function kxe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Rye(["r","c","d"],"inputShape"):ih(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lxe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,i){const r=y4(n,i),s=S4(e,r,i);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=v4(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,i);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[s].pop();return this.usedTextures[s].push(l),l}let a;return r===ki.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===ki.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===ki.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===ki.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===ki.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,i,r){if(this.freeTextures==null)return;const s=y4(i,r),o=S4(n,s,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=v4(n,s,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=Q().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Dxe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function v4(t,e,n,i,r){const s=Nxe(e,i);let o;if(r){const[l,c]=Tp(t[0],t[1]);o=l*c}else{const[l,c]=J0(t[0],t[1]);o=l*c}const a=Dxe(n,s);return o*a}function Nxe(t,e){switch(t){case ki.PACKED_2X2_FLOAT32:return MV(e);case ki.PACKED_2X2_FLOAT16:return kV(e);case ki.UNPACKED_FLOAT32:return AV(e);case ki.UNPACKED_FLOAT16:return PV(e);case ki.PACKED_4X1_UNSIGNED_BYTE:return IV(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function Oxe(t){return Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?ki.PACKED_2X2_FLOAT32:ki.UNPACKED_FLOAT32:t?ki.PACKED_2X2_FLOAT16:ki.UNPACKED_FLOAT16}function y4(t,e){if(t===gs.UPLOAD)return ki.PACKED_2X2_FLOAT32;if(t===gs.RENDER||t==null)return Oxe(e);if(t===gs.DOWNLOAD||t===gs.PIXELS)return ki.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function S4(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ia{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const so="if (isnan(x)) return x;",Fxe="return x;",x4="return abs(x);",zxe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Uxe=so+`
  return (x < 0.0) ? 0.0 : x;
`,Bxe=so+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Rl="return x;",$xe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hxe="return x;",Vxe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,jxe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Wxe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Gxe="return 1.0 / (1.0 + exp(-1.0 * x));";class zl{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qxe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);const n=e.length,i=dr("rc",n),r=hn(n),s=Ixe(n,i),o=i.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xxe=V0e,Kxe=1e-7,Yxe=1e-4,my={};function Jxe(t){return t in my||(my[t]={}),my[t]}const Qxe=Q().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Zxe=600;function eCe(){return Q().global.screen==null?1024:Q().global.screen.height*Q().global.screen.width*window.devicePixelRatio*Zxe/1024/1024}class $C extends S8{nextDataId(){return $C.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof dE)n=e;else{const i=ko(Q().getNumber("WEBGL_VERSION"),e);n=new dE(i)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const i=ko(Q().getNumber("WEBGL_VERSION"));n=new dE(i),this.binaryCache=Jxe(Q().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Lxe(this.gpgpu),this.numMBBeforeWarning=eCe(),this.texData=new epe(this,yl())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,i,r,s,o){const a=this.makeTensorInfo(n,i),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,s]},l.texShape=[r,s];const c=py(n),u=new d4(c,!1,o),h=this.runWebGLProgram(u,[a],i,[[r,s]]);return h.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,i){if((Q().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Q().getBool("DEBUG"))&&this.checkNumericalProblems(e),i==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:i,values:e,usage:gs.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,i,r,s){if(Q().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:i,dtype:r,values:n,usage:gs.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:i,dtype:r,complexTensorInfos:s,slice:o,shape:a,isPacked:l}=n;if(o!=null){let d;l?d=new zl(a,Rl):d=new ia(a,Rl);const p=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:r}],r),f=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),f}if(i!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return i;const c=this.activeTimers!=null;let u;c&&(u=vo());let h;if(r==="complex64"){const d=this.readSync(s.real.dataId),p=this.readSync(s.imag.dataId);h=ib(d,p)}else h=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=vo()-u),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const f=this.pendingRead.get(e);return new Promise(v=>f.push(v))}const n=this.texData.get(e),{values:i,shape:r,slice:s,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(s!=null){let f;l?f=new zl(r,Rl):f=new ia(r,Rl);const v=this.runWebGLProgram(f,[{dataId:e,shape:r,dtype:o}],o),g=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),g}if(i!=null)return this.convertAndCacheOnCPU(e);if(Q().getBool("DEBUG")&&!Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(o!=="complex64"&&Q().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const f=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(f.texture.texture,...uy(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const f=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),v=f[0],g=f[1];h=ib(v,g)}else if(c==null)h=this.getValuesFromTexture(e);else{const f=Re(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(c,f)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const f=this.gpgpu.gl;Pe(f,()=>f.deleteBuffer(c))}const d=this.convertAndCacheOnCPU(e,h),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(f=>f(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&yl().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,n={}){const i=this.texData.get(e),{values:r,shape:s,slice:o,dtype:a,isPacked:l,texture:c}=i;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let p;l?p=new zl(s,Rl):p=new ia(s,Rl);const f=this.runWebGLProgram(p,[{dataId:e,shape:s,dtype:a}],a),v=this.readToGPU(f,n);return this.disposeIntermediateTensorInfo(f),v}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,n.customTexShape),h=yl().makeTensorFromTensorInfo(u),d=this.texData.get(u.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const i=n.map(r=>Kd(r));return Oi(e.shape,e.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Oi(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const i=e[n];if(!Qve(i))throw Q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${i} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${i} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:i,isPacked:r}=this.texData.get(e),s=Re(n);if(Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(e),p=this.texData.get(d.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...uy(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(d),f}const o=Q().getBool("WEBGL_PACK")&&r===!0,a=o?py(n):n,l=o?new f1e(a):new p1e(a),c=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],"float32"),u=this.texData.get(c.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(c),h}timerAvailable(){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,i=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=i,r=!0):this.activeTimers.push(i),this.activeTimers=i,e();const s=Uu(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Uu(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(s);a.kernelMs=tpe(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:o[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:vo(),endMs:null}}endTimer(e){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=vo(),e)}async getQueryTime(e){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:i}=this.texData.get(e);return i!=null&&(this.disposeData(i.real.dataId,n),this.disposeData(i.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:i,texShape:r,usage:s,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,i),this.textureManager.releaseTexture(n,r,s,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=Qxe){return Q().getBool("WEBGL_CPU_FORWARD")&&e.every(i=>this.texData.get(i.dataId).texture==null&&Re(i.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Eo("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return Xxe(e.shape,n)}packedUnaryOp(e,n,i){const r=new zl(e.shape,n),s=this.compileAndRun(r,[e],i);return yl().makeTensorFromTensorInfo(s)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=OV(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,x4,e.dtype);const n=new ia(e.shape,x4),i=this.compileAndRun(n,[e]);return yl().makeTensorFromTensorInfo(i)}makeTensorInfo(e,n,i){let r;if(n==="string"&&i!=null&&i.length>0&&DC(i[0])){const s=i.map(o=>Cu(o));r=this.write(s,e,n)}else r=this.write(i,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,i){return yl().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,i),this)}unpackTensor(e){const n=new qxe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new Mxe(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const i=[Zd(e.shape),...ep(e.shape)],r={dtype:e.dtype,shape:i,dataId:e.dataId},s=[Zd(n),...ep(n)],o=new UV(s,i),a=!0,l=[i],c=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const i=this.texData.get(e),{isPacked:r,shape:s,dtype:o}=i;if(n!=null){const d=Re(s),p=n[0]*n[1]*4;we(d<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=py(s);let l;r?l=new d1e(a):l=new h1e(a);const c=!0,u=[n??uy(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,u,c,n);return{dtype:o,shape:s,dataId:h.dataId}}runWebGLProgram(e,n,i,r,s=!1,o){const a=this.makeTensorInfo(e.outputShape,i),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===d0.DENSE){const m=o??uy(e.outputShape);l.texShape=m.map(y=>y*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),Re(a.shape)===0)return l.values=zu(a.dtype,0),a;const c=[],u=n.map(m=>{if(m.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(m.dataId);if(y.texture==null){if(!e.packedInputs&&Re(m.shape)<=Q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:m.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=m.shape)}if(this.uploadToGPU(m.dataId),!!y.isPacked!=!!e.packedInputs)m=y.isPacked?this.unpackTensor(m):this.packTensor(m),c.push(m),y=this.texData.get(m.dataId);else if(y.isPacked&&!cS(y.shape,m.shape)){const S=m,x=m.shape;m.shape=y.shape,m=this.packedReshape(m,x),c.push(m),y=this.texData.get(m.dataId),S.shape=x}return{shape:m.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},d=u1e(e,u,h),p=this.getAndSaveBinary(d,()=>l1e(this.gpgpu,e,u,h)),f=this.activeTimers!=null;let v;f&&(v=this.startTimer()),Q().get("ENGINE_COMPILE_ONLY")||c1e(this.gpgpu,p,u,h,r),c.forEach(m=>this.disposeIntermediateTensorInfo(m)),f&&(v=this.endTimer(v),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(v)}));const g=Q().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const m=vo();m-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=m)}if(!Q().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){const m=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),m}return a}compileAndRun(e,n,i,r,s=!1){return i=i||n[0].dtype,this.runWebGLProgram(e,n,i,r,s)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ii(()=>{if(!Q().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Q().getBool("DEBUG");Q().set("DEBUG",!1);const n=this.abs(hc(1e-8)).dataSync()[0];if(Q().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Kxe:Yxe}uploadToGPU(e){const n=this.texData.get(e),{shape:i,dtype:r,values:s,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const c=this.activeTimers!=null;let u;c&&(u=vo());let h=n.texShape;if(h==null&&(h=gye(i,l),n.texShape=h),s!=null){const d=py(i);let p,f=h[1],v=h[0];const g=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!g)&&([f,v]=Tp(h[0],h[1])),l?p=new g1e(d,g):p=new d4(d,g);const m=g?[v,f]:h,y=this.makeTensorInfo(m,r),S=this.texData.get(y.dataId);g?S.usage=gs.PIXELS:S.usage=gs.UPLOAD,S.texShape=m,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),f,v,s);const x=[[v,f]],C=this.runWebGLProgram(p,[y],r,x,!0),E=this.texData.get(C.dataId);n.texShape=E.texShape,n.isPacked=E.isPacked,n.usage=E.usage,Q().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=E.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(y),c&&(this.uploadWaitMs+=vo()-u)}else{const d=this.acquireTexture(h,a,r,l);n.texture=d}}convertAndCacheOnCPU(e,n){const i=this.texData.get(e),{dtype:r}=i;return n!=null&&(i.values=tCe(n,r)),i.values}acquireTexture(e,n,i,r){if(this.numBytesInGPU+=this.computeBytes(e,i),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*nS(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const i=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(s){throw s}});e.push(i)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await kve(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(_V(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:i,infLoc:r,nanLoc:s,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=bV(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=i,e.infLoc=r,e.nanLoc=s,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,i){e.channels=e.channels||"RGBA";const{texture:r,height:s,width:o,channels:a}=e,l=yl().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,n,i,s,o,a);return yl().makeTensorFromDataId(c,n,i,l)}}$C.nextDataId=0;function tCe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let i=0;i<n.length;++i)n[i]=Math.round(t[i]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */uH()&&kge("webgl",()=>new $C,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eI=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class ju{constructor(e,n,i){this.variableNames=["A","B"],this.outputShape=pr(n,i),this.enableShapeUniforms=Yi(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Mp{constructor(e,n,i,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=pr(n,i);const s=this.outputShape.length;this.enableShapeUniforms=Yi(s);let o="";if(r)if(s===0||Re(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${hn(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=dr("coords",s);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xr(t){const{inputs:e,backend:n}=t,{x:i}=e;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const nCe={kernelName:LP,backendName:"webgl",kernelFunc:Xr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ec(t){const{inputs:e,backend:n}=t,{real:i,imag:r}=e,s=n.makeTensorInfo(i.shape,"complex64"),o=n.texData.get(s.dataId),a=Xr({inputs:{x:i},backend:n}),l=Xr({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},s}const iCe={kernelName:R8,backendName:"webgl",kernelFunc:Ec};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BV="return (a < 0.) ? b * a : a;",$V=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function rCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{alpha:s}=i,o=n.makeTensorInfo([],"float32",_p(s,"float32")),a=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mp($V,r.shape,o.shape):new ju(BV,r.shape,o.shape),l=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const sCe={kernelName:M8,backendName:"webgl",kernelFunc:rCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HV="return (a < 0.) ? b * a : a;",VV=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function oCe(t){const{inputs:e,backend:n}=t,{x:i,alpha:r}=e,s=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mp(VV,i.shape,r.shape):new ju(HV,i.shape,r.shape);return n.runWebGLProgram(s,[i,r],"float32")}const aCe={kernelName:N8,backendName:"webgl",kernelFunc:oCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kp="if (isnan(x)) return x;";function Gt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:i}){return({inputs:r,backend:s})=>{const{x:o}=r,a=s,l=i||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),d=n(h.values,l);return a.makeTensorInfo(o.shape,l,d)}const c=Q().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new zl(o.shape,e):u=new ia(o.shape,t),a.runWebGLProgram(u,[o],l)}}function Ui({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:i=!1,cpuKernelImpl:r,dtype:s}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(i&&l.dtype==="complex64"){const f=u.texData.get(l.dataId),v=u.texData.get(c.dataId),[g,m]=[[f.complexTensorInfos.real,v.complexTensorInfos.real],[f.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(S=>{const[x,w]=S,C={dataId:x.dataId,dtype:x.dtype,shape:l.shape},E={dataId:w.dataId,dtype:w.dtype,shape:c.shape},T=new ju(t,l.shape,c.shape);return u.runWebGLProgram(T,[C,E],ua(x.dtype,w.dtype))}),y=Ec({inputs:{real:g,imag:m},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(m),y}const h=s||ua(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&r!=null){const f=u.texData.get(l.dataId).values,v=u.texData.get(c.dataId).values,g=l.dtype==="string"?Qd(f):f,m=l.dtype==="string"?Qd(v):v,[y,S]=r(l.shape,c.shape,g,m,h),x=u.makeTensorInfo(S,h),w=u.texData.get(x.dataId);return w.values=y,x}const d=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return d?p=new Mp(e,l.shape,c.shape,n):p=new ju(t,l.shape,c.shape),u.runWebGLProgram(p,[l,c],h)}}function p0(t,e=!1){if(t==="linear")return e?Hxe:Fxe;if(t==="relu")return e?jxe:Uxe;if(t==="elu")return e?Vxe:zxe;if(t==="relu6")return e?Wxe:Bxe;if(t==="prelu")return e?VV:HV;if(t==="leakyrelu")return e?$V:BV;if(t==="sigmoid")return e?Gxe:$xe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jV{constructor(e,n,i,r=!1,s=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i,this.enableShapeUniforms=Yi(this.outputShape.length);const u=r?e[1]:e[2],h=Math.ceil(u/2),d=r?"i * 2, rc.y":"rc.y, i * 2",p=s?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",m="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,m="result = activation(result);");const y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let S="rc.x",x="rc.x";e[0]<n[0]?S=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(x=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${S};
        int batchB = ${x};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${f[0]} * ${v[0]});
          result += (${f[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${m}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C4={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class _4{constructor(e,n,i){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=pr(n,i),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w4="return a * b;";function tI(t){const{inputs:e,backend:n}=t,{a:i,b:r}=e,s=ua(i.dtype,r.dtype);if(i.dtype==="complex64"){const a=n.texData.get(i.dataId),l=n.texData.get(r.dataId),c=new _4(C4.REAL,i.shape,r.shape),u=new _4(C4.IMAG,i.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:i.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],d=n.runWebGLProgram(c,h,"float32"),p=n.runWebGLProgram(u,h,"float32"),f=Ec({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}if(n.shouldExecuteOnCPU([i,r])){const a=n.texData.get(i.dataId),l=n.texData.get(r.dataId),[c,u]=oxe(i.shape,r.shape,a.values,l.values,s),h=n.makeTensorInfo(u,s),d=n.texData.get(h.dataId);return d.values=c,h}let o;return Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Mp(w4,i.shape,r.shape):o=new ju(w4,i.shape,r.shape),n.runWebGLProgram(o,[i,r],s)}const lCe={kernelName:L8,backendName:"webgl",kernelFunc:tI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cCe(t,e,n){const i=[Zd(t.shape),...ep(t.shape)],r={dtype:t.dtype,shape:i,dataId:t.dataId},s=[Zd(e),...ep(e)],o=new UV(s,i),a=!0,l=[i],c=n.runWebGLProgram(o,[r],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ce(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{shape:s}=i,o=n,a=Re(r.shape),l=npe(s,a),c=Re(l);we(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(r.dataId);return u.isPacked&&!cS(r.shape,l)&&!(u.texture!==null&&cS(u.shape,l))?cCe(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const uCe={kernelName:F8,backendName:"webgl",kernelFunc:Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E4{constructor(e,n){this.variableNames=["x"];const{windowSize:i,batchSize:r,inSize:s,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(i/4)*4,l=i%4;let c="sumValue += dot(values, ones);";if(n!=null){const h=1/n;c=`sumValue += dot(values * ${tS(h)?h.toPrecision(2):h}, ones);`}let u="";s%i>0&&(u=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hCe{constructor(e,n){this.variableNames=["x"];const{windowSize:i,batchSize:r,inSize:s,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const u=Math.floor(i/4)*4,h=i%4;let d=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";n==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let f="";s%i>0&&(f=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dCe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],i=UC(n);e.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return e}function oh(t,e,n,i){const r=dCe(t.shape);let s=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:c}=r[o];let u,h;n==="mean"?u=o===0?new E4({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new E4({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new hCe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),h=s,s=i.runWebGLProgram(u,[s],e),h.dataId!==t.dataId&&i.disposeIntermediateTensorInfo(h)}return s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pCe{constructor(e,n){this.variableNames=["A"];const i=new Array(e.length);for(let o=0;o<i.length;o++)i[o]=e[n[o]];this.outputShape=i,this.rank=i.length;const r=hn(this.rank),s=fCe(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}function fCe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(e);for(let r=0;r<t.length;r++)i[t[r]]=n[r];return i.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mCe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const i=new Array(e.length);for(let u=0;u<i.length;u++)i[u]=e[n[u]];if(this.outputShape=i,this.rank=i.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=hn(this.rank),s=zV("rc",this.rank),o=new Array(this.rank);for(let u=0;u<n.length;u++)o[n[u]]=s[u];const a=`vec2(${o.slice(-2).join()})`,l=`++${s[this.rank-1]} < ${i[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${i[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HC(t,e,n){const i=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mCe(t.shape,e):new pCe(t.shape,e);return n.runWebGLProgram(i,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gCe(t,e,n,i){const r=e,s=t.shape.length,o=kr(r,t.shape);let a=o;const l=io(a,s),c=l!=null;let u=t;c&&(u=HC(t,l,i),a=ro(a.length,s)),Ho("sum",a,s);const[h,d]=va(u.shape,a);let p=h;n&&(p=il(h,o));const f=Re(d),g=Re(t.shape)/f,m=Ce({inputs:{x:u},attrs:{shape:[g,f]},backend:i}),y=NP(t.dtype),S=oh(m,y,"sum",i),x=Ce({inputs:{x:S},attrs:{shape:p},backend:i});return i.disposeIntermediateTensorInfo(m),i.disposeIntermediateTensorInfo(S),c&&i.disposeIntermediateTensorInfo(u),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VC(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i;return gCe(r,s,o,n)}const vCe={kernelName:$8,backendName:"webgl",kernelFunc:VC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mr(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{perm:s}=i,o=n,a=r.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=r.shape[s[u]];let c;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,d=ZP(h,r.shape,r.dtype,s,l);c=o.makeTensorInfo(l,r.dtype);const p=o.texData.get(c.dataId);p.values=d}else c=HC(r,s,o);return c}const yCe={kernelName:jme,backendName:"webgl",kernelFunc:mr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WV=1e3;function hS({a:t,b:e,transposeA:n,transposeB:i,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,u=e.shape.length,h=n?t.shape[c-2]:t.shape[c-1],d=i?e.shape[u-1]:e.shape[u-2],p=n?t.shape[c-1]:t.shape[c-2],f=i?e.shape[u-2]:e.shape[u-1],v=t.shape.slice(0,-2),g=e.shape.slice(0,-2),m=Re(v),y=Re(g),x=pr(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);we(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${i} must match.`);const w=n?[m,h,p]:[m,p,h],C=i?[y,f,d]:[y,d,f],E=Ce({inputs:{x:t},backend:r,attrs:{shape:w}}),T=Ce({inputs:{x:e},backend:r,attrs:{shape:C}}),M=[E,T],_=Math.max(m,y),R=n?E.shape[1]:E.shape[2],L=s!=null,z=o!=null,G=l==="leakyrelu",$=l!=null?p0(l,!0):null,H=L||z||G||$!=null;let q;if((p===1||f===1)&&R>WV&&H===!1){let Z=E,P=T;n&&(Z=mr({inputs:{x:E},backend:r,attrs:{perm:[0,2,1]}}),M.push(Z)),i&&(P=mr({inputs:{x:T},backend:r,attrs:{perm:[0,2,1]}}),M.push(P));const le=f!==1,Se=f===1;let k=Z;le&&(k=Ce({inputs:{x:Z},backend:r,attrs:{shape:[_,R,1]}}),M.push(k));const J=f===1?2:1;let oe=P;Se&&(oe=Ce({inputs:{x:P},backend:r,attrs:{shape:[_,1,R]}}),M.push(oe));const pe=tI({inputs:{a:k,b:oe},backend:r});q=VC({inputs:{x:pe},backend:r,attrs:{axis:J,keepDims:!0}}),M.push(pe)}else{const Z=ua(t.dtype,e.dtype),P=new jV(w,C,[_,p,f],n,i,L,$,z,G),le=[E,T];if(s!=null&&le.push(s),z&&le.push(o),G){const Se=r.makeTensorInfo([],"float32",_p(a,"float32"));le.push(Se),M.push(Se)}q=r.runWebGLProgram(P,le,Z)}const D=Ce({inputs:{x:q},backend:r,attrs:{shape:x}});M.push(q);for(const Z of M)r.disposeIntermediateTensorInfo(Z);return D}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SCe(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:s,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=i;return hS({a:r,b:s,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}const xCe={kernelName:Yme,backendName:"webgl",kernelFunc:SCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R4="return abs(x);";function CCe(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])&&i.dtype!=="complex64"){const s=n.texData.get(i.dataId),o=OV(s.values);return n.makeTensorInfo(i.shape,i.dtype,o)}let r;return Q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new zl(i.shape,R4):r=new ia(i.shape,R4),n.runWebGLProgram(r,[i],i.dtype)}const _Ce={kernelName:E8,backendName:"webgl",kernelFunc:CCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wCe=so+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ECe=Gt({opSnippet:wCe}),RCe={kernelName:gpe,backendName:"webgl",kernelFunc:ECe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TCe=so+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,bCe=Gt({opSnippet:TCe}),ACe={kernelName:vpe,backendName:"webgl",kernelFunc:bCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4="return a + b;",PCe=Ui({opSnippet:T4,packedOpSnippet:T4,supportsComplex:!0,cpuKernelImpl:USe}),ICe={kernelName:MP,backendName:"webgl",kernelFunc:PCe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MCe{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((s,o)=>`T${o}`);const i=[];this.variableNames.forEach(s=>{i.push(`float v${s} = get${s}AtOutCoords();`)});const r=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kCe{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((s,o)=>`T${o}`);const i=[];this.variableNames.forEach(s=>{i.push(`vec4 v${s} = get${s}AtOutCoords();`)});const r=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yy(t){const{inputs:e,backend:n}=t,i=e;if(i.length===1)return Xr({inputs:{x:i[0]},backend:n});if(i.length>Q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(i.length/2),c=Yy({inputs:i.slice(0,l),backend:n}),u=Yy({inputs:i.slice(l),backend:n});return Yy({inputs:[c,u],backend:n})}const r=i.map(l=>l.dtype).reduce((l,c)=>ua(l,c)),s=i.map(l=>l.shape),a=Q().getBool("WEBGL_PACK")?new kCe(i[0].shape,s):new MCe(i[0].shape,s);return n.runWebGLProgram(a,i,r)}const LCe={kernelName:ype,backendName:"webgl",kernelFunc:Yy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,l=kr(s,r.shape);let c=l;const u=io(c,a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),c=ro(c.length,a)),Ho("all",c,a);const[d,p]=va(h.shape,c),f=Re(p),v=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=oh(v,v.dtype,"all",n);let m;if(o){const y=il(d,l);m=Ce({inputs:{x:g},backend:n,attrs:{shape:y}})}else m=Ce({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(h),m}const NCe={kernelName:Spe,backendName:"webgl",kernelFunc:DCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,l=kr(s,r.shape);let c=l;const u=io(c,a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),c=ro(c.length,a)),Ho("any",c,a);const[d,p]=va(h.shape,c),f=Re(p),v=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=oh(v,v.dtype,"any",n);let m;if(o){const y=il(d,l);m=Ce({inputs:{x:g},backend:n,attrs:{shape:y}})}else m=Ce({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(h),m}const FCe={kernelName:xpe,backendName:"webgl",kernelFunc:OCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zCe{constructor(e,n,i){this.variableNames=["A"];const{windowSize:r,batchSize:s,outSize:o}=e;i||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const a=n==="max"?">":"<",l=i?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UCe{constructor(e,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,we(e.length>2,()=>`Packed arg${i.charAt(0).toUpperCase()+i.slice(1)} supports only inputs with rank above 2.`);const s=e[e.length-1],o=Math.ceil(s/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=hn(l),u=dr("coords",l);let h,d;if(o===1){d=l+1;const T=hn(d);h=`
        ${T} sourceLocR = ${T}(${u.join()}, 0);
        ++${u[l-1]};
        ${T} sourceLocG = ${T}(${u.join()}, 0);
        ++${u[l-2]};
        ${T} sourceLocA = ${T}(${u.join()}, 0);
        --${u[l-1]};
        ${T} sourceLocB = ${T}(${u.join()}, 0);
        --${u[l-2]};`}else d=l,h=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],v=p.map(T=>"int "+T),g=dr("sourceLocR",d-1).concat("inIdx.r"),m=dr("sourceLocG",d-1).concat("inIdx.g"),y=dr("sourceLocB",d-1).concat("inIdx.b"),S=dr("sourceLocA",d-1).concat("inIdx.a"),x=i==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${S.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${m.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,E=r?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${E}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},
          sourceLocB${f}, sourceLocA${f}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t,e,n,i=null){let r=e.shape[0],s=e.shape[1];i!=null&&(r=i.shape[0],s=i.shape[1]);const o=UC(s),a={windowSize:o,inSize:s,batchSize:r,outSize:Math.ceil(s/o)},l=new zCe(a,n,i==null),c=[e];i!=null&&c.push(i);const u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const h=GV(t,e,n,u);return t.disposeIntermediateTensorInfo(u),h}function qV(t,e,n,i=null){const r=i!=null?i.shape:e.shape,s=r[r.length-1],o=UC(s),a=new UCe(r,o,n,i==null),l=i==null?[e]:[e,i],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=qV(t,e,n,c);return t.disposeIntermediateTensorInfo(c),u}return c}function XV(t,e,n,i){const r=[n];if(Ho("arg"+i.charAt(0).toUpperCase()+i.slice(1),r,e.shape.length),!Q().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const s=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),s.push(l));const[c,u]=va(l.shape,r),h=Re(u),d=Ce({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});s.push(d);const p=GV(t,d,i);s.push(p);const f=Ce({inputs:{x:p},backend:t,attrs:{shape:c}});return s.forEach(v=>t.disposeIntermediateTensorInfo(v)),f}return qV(t,e,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s}=i;let o=kr(s,r.shape);const a=io(o,r.shape.length);let l=r;const c=[];a!=null&&(l=mr({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=ro(o.length,l.shape.length)),Ho("argMax",[o[0]],l.shape.length);const u=XV(n,l,o[0],"max");return c.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const $Ce={kernelName:Cpe,backendName:"webgl",kernelFunc:BCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HCe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s}=i;let o=kr(s,r.shape);const a=io(o,r.shape.length);let l=r;const c=[];a!=null&&(l=mr({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=ro(o.length,l.shape.length)),Ho("argMin",[o[0]],l.shape.length);const u=XV(n,l,o[0],"min");return c.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const VCe={kernelName:_pe,backendName:"webgl",kernelFunc:HCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jCe=so+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,WCe=Gt({opSnippet:jCe}),GCe={kernelName:wpe,backendName:"webgl",kernelFunc:WCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qCe=so+"return log(x + sqrt(x * x + 1.0));",XCe=Gt({opSnippet:qCe}),KCe={kernelName:Epe,backendName:"webgl",kernelFunc:XCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YCe=so+`
  return atan(x);
`,JCe=Gt({opSnippet:YCe}),QCe={kernelName:Rpe,backendName:"webgl",kernelFunc:JCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZCe=eI+`
  return atan(a, b);
`,e_e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sh+`
  return result;
`,t_e=Ui({opSnippet:ZCe,packedOpSnippet:e_e}),n_e={kernelName:bpe,backendName:"webgl",kernelFunc:t_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i_e=so+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,r_e=Gt({opSnippet:i_e}),s_e={kernelName:Tpe,backendName:"webgl",kernelFunc:r_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f0{constructor(e,n,i,r=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const v=n==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,m=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(v||(y="-1.0 / 1e-20"),i){const T=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${f});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${T} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?s?g:m:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let x=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(x="avgValue / max(count, 1.0)");const w=Math.floor(o/4)*4,C=o%4,E=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${f});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${E}
          }

          int xC = xCCorner + ${w};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${E}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${E}
          }
        }
        setOutput(${x});
      }
    `}}class nI{constructor(e,n,i,r=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,v=e.effectiveFilterWidth,g=e.padInfo.front,m=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const S=n==="avg";let x="0.0";if(S||(x="-1.0 / 1e-20"),i){const _=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${m}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${f};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${_} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?s?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const E=Math.floor(o/4)*4,T=o%4,M=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${m}, ${y});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${E}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${M}
            }

            int xC = xCCorner + ${E};
            if (${T===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${T===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${T===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${M}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;Q0(r,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=i,c=1;we(Ep(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=wp(r.shape,s,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Ni(u.inShape,u.outShape))return Xr({inputs:{x:r},backend:n});const h=new f0(u,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const a_e={kernelName:Ape,backendName:"webgl",kernelFunc:o_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=i,u=[1,1,1],h=K0(r.shape,s,o,u,a,l,c),d=new nI(h,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const c_e={kernelName:Ipe,backendName:"webgl",kernelFunc:l_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,r=e.strideHeight,s=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,h=c-1-e.padInfo.left,d=1/(n*i);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class h_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,i=e.filterHeight,r=e.filterWidth,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=h-1-e.padInfo.front,v=d-1-e.padInfo.top,g=p-1-e.padInfo.left,m=1/(n*i*r);this.userCode=`
      const ivec3 pads = ivec3(${f}, ${v}, ${g});
      const float avgMultiplier = float(${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,h=[1,1,1],d=K0(o.shape,a,l,h,c,u),p=new h_e(d);return n.runWebGLProgram(p,[r],o.dtype)}const p_e={kernelName:Mpe,backendName:"webgl",kernelFunc:d_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s}=e,o=s;Q0([r,s],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=i,u=wp(o.shape,a,l,1,c),h=new u_e(u);return n.runWebGLProgram(h,[r],o.dtype)}const m_e={kernelName:Ppe,backendName:"webgl",kernelFunc:f_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_e(t){const{inputs:e,backend:n,attrs:i}=t,{a:r,b:s}=e,{transposeA:o,transposeB:a}=i;return hS({a:r,b:s,transposeA:o,transposeB:a,backend:n})}const v_e={kernelName:kpe,backendName:"webgl",kernelFunc:g_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y_e{constructor(e,n,i,r,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],pr(e,n),pr(e,i);let a="0.0";r!=null&&(pr(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";s!=null&&(pr(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S_e{constructor(e,n,i,r,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],pr(e,n),pr(e,i);let a="vec4(0.0)";r!=null&&(pr(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";s!=null&&(pr(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x_e=({inputs:t,backend:e,attrs:n})=>{const{x:i,mean:r,variance:s,offset:o,scale:a}=t;we(r.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),we(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),we(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[i,r,s];let u=null;o!=null&&(u=o.shape,c.push(o));let h=null;a!=null&&(h=a.shape,c.push(a));const d=Q().getBool("WEBGL_PACK_NORMALIZATION")?new S_e(i.shape,r.shape,s.shape,u,h,l):new y_e(i.shape,r.shape,s.shape,u,h,l);return e.runWebGLProgram(d,c,c[0].dtype)},C_e={kernelName:ffe,backendName:"webgl",kernelFunc:x_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class __e{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=hn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const i=w_e(this.rank);let r;const s=e.map((o,a)=>`sourceLoc.${ob[a]} = start[${a}] + coords.${ob[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${i}));
      }
    `}}const ob=["x","y","z","w","u","v"];function w_e(t){if(t===1)return"sourceLoc";if(t<=6)return ob.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E_e{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=hn(this.rank),i=dr("coords",this.rank),r=dr("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${s})`,a=`
      result.x = ${o};
      if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${i[this.rank-1]};
      if (++${i[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${i[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,h)=>`start[${h}]`).join()});`:e.map((u,h)=>`${r[h]} = ${i[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_e(t,e,n,i){const r=i.texData.get(t.dataId),s=i.makeTensorInfo(n,t.dtype),o=i.texData.get(s.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=jP(e,Di(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=i.dataRefCount.get(o.slice.origDataId)||1;return i.dataRefCount.set(o.slice.origDataId,l+1),s}function Lp(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:s,size:o}=i,[a,l]=FH(r,s,o);if(bH(r,a,l),Re(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.texData.get(r.dataId),d=vxe(h.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,d)}const{isPacked:c}=n.texData.get(r.dataId),u=VP(r.shape,a,l);if(c||!u){const h=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new E_e(l):new __e(l),d=[a];return n.runWebGLProgram(h,[r],r.dtype,d)}return n.uploadToGPU(r.dataId),R_e(r,a,l,n)}const T_e={kernelName:xme,backendName:"webgl",kernelFunc:Lp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_e=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:s,crops:o}=i;we(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((y,S)=>y*S),l=GP(r.shape,s,a),c=qP(l.length,s.length),u=XP(r.shape,s,a),h=WH(o,s.length),d=GH(u,o,s.length),p=[],f=Ce({inputs:{x:r},backend:n,attrs:{shape:l}}),v=mr({inputs:{x:f},backend:n,attrs:{perm:c}}),g=Ce({inputs:{x:v},backend:n,attrs:{shape:u}}),m=Lp({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(v),p.push(g),p.forEach(y=>n.disposeIntermediateTensorInfo(y)),m},A_e={kernelName:Lpe,backendName:"webgl",kernelFunc:b_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:s}=e,{size:o}=i,a=n.readSync(r.dataId),l=n.readSync(s.dataId),c=NV(a,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}const I_e={kernelName:Dpe,backendName:"webgl",kernelFunc:P_e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M_e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,k_e=`
  return float(int(a.r) & int(b.r));
`;function L_e(t){const{inputs:e,backend:n}=t,{a:i,b:r}=e,s=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=Q().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([i,r])||o===1){const l=n.texData.get(i.dataId).values,c=n.texData.get(r.dataId).values,[u,h]=$Se(i.shape,r.shape,l,c,i.dtype),d=n.makeTensorInfo(h,i.dtype),p=n.texData.get(d.dataId);return p.values=u,d}let a;return s?a=new Mp(M_e,i.shape,r.shape,!1):a=new ju(k_e,i.shape,r.shape),n.runWebGLProgram(a,[i,r],i.dtype)}const D_e={kernelName:Npe,backendName:"webgl",kernelFunc:L_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_e(t){const{inputs:e,backend:n}=t,{s0:i,s1:r}=e,s=n.readSync(i.dataId),o=n.readSync(r.dataId),a=pr(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const O_e={kernelName:Ope,backendName:"webgl",kernelFunc:N_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F_e="return float(a != b);",KV=Ui({opSnippet:F_e,cpuKernelImpl:lxe,dtype:"bool"}),z_e={kernelName:qfe,backendName:"webgl",kernelFunc:KV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(t){const{inputs:e,backend:n}=t,{input:i}=e,r=n.texData.get(i.dataId);return Xr({inputs:{x:r.complexTensorInfos.real},backend:n})}const U_e={kernelName:ome,backendName:"webgl",kernelFunc:ev};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B_e="return float(int(x));";function $_e(t,e){const n=new ia(t.shape,B_e),i=e.runWebGLProgram(n,[t],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ab(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{dtype:s}=i;if(s==="complex64"){if(r.dtype==="complex64")return Xr({inputs:{x:r},backend:n});const o=tb(r.shape),a=ab({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Ec({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=ev({inputs:{input:r},backend:n}),a=ab({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),a}if(!spe(r.dtype,s)){const o=Xr({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,l,c]=HSe(o,r.shape,r.dtype,s);return n.makeTensorInfo(a,l,c)}if(s==="int32")return $_e(r,n);if(s==="bool"){const o=n.makeTensorInfo([],"bool",zu("bool",1)),l=KV({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${s}`)}const H_e={kernelName:kP,backendName:"webgl",kernelFunc:ab};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b4="return ceil(x);",V_e=Gt({opSnippet:b4,packedOpSnippet:b4,cpuKernelImpl:VSe}),j_e={kernelName:Fpe,backendName:"webgl",kernelFunc:V_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W_e{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G_e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{clipValueMin:s,clipValueMax:o}=i;let a;Q().getBool("WEBGL_PACK_CLIP")?a=new G_e(r.shape):a=new W_e(r.shape);const l=[[s],[o]];return n.runWebGLProgram(a,[r],r.dtype,l)}const X_e={kernelName:zpe,backendName:"webgl",kernelFunc:q_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K_e{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A4(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function Y_e(t){const{inputs:e,backend:n}=t,{x:i}=e,r=n.texData.get(i.dataId),s=new K_e(i.shape),o=[A4(i,r.complexTensorInfos.real),A4(i,r.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}const J_e={kernelName:T8,backendName:"webgl",kernelFunc:Y_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q_e{constructor(e){this.outputShape=[],this.outputShape=Vu(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const i=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];i.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,s=n[n.length-1];i.push(`else setOutput(getT${r}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${i.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z_e{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Vu(e,n);const i=this.outputShape,r=i.length,s=hn(r),o=dr("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((v,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let v=1;v<l.length;v++)l[v]=l[v-1]+e[v][n];const c=a[n],u=a.slice(-2),h=a.join();let d=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${u.join()}));
        }`;for(let v=1;v<l.length;v++){const g=l[v-1];d+=`
        if (${c} < ${l[v]}  && ${c} >= ${l[v-1]}) {
          return getChannel(
            getT${v}(${gy(a,c,g)}),
            vec2(${gy(u,c,g)}));
        }`}const p=l.length,f=l[l.length-1];d+=`
        return getChannel(
          getT${p}(${gy(a,c,f)}),
          vec2(${gy(u,c,f)}));`,this.userCode=`
      float getValue(${a.map(v=>"int "+v)}) {
        ${d}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${i[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${i[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${i[r-2]} &&
            ${o[r-1]} < ${i[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function gy(t,e,n){const i=t.indexOf(e);return t.map((s,o)=>o===i?`${s} - ${n}`:s).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jC(t){const{inputs:e,backend:n}=t,{input:i}=e,r=n.texData.get(i.dataId);return Xr({inputs:{x:r.complexTensorInfos.imag},backend:n})}const ewe={kernelName:xfe,backendName:"webgl",kernelFunc:jC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ag(t,e,n){const i=t[0].dtype;if(i==="complex64"){const p=t.map(y=>ev({inputs:{input:y},backend:n})),f=t.map(y=>jC({inputs:{input:y},backend:n})),v=ag(p,e,n),g=ag(f,e,n),m=Ec({inputs:{real:v,imag:g},backend:n});return p.forEach(y=>n.disposeIntermediateTensorInfo(y)),f.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),m}let r=n.shouldExecuteOnCPU(t);if(i==="string"&&(r=!0),r){const p=t.map(x=>{const C=[-1,Re(x.shape.slice(e))];return Ce({inputs:{x},backend:n,attrs:{shape:C}})}),f=p.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),v=Vu(p.map(x=>x.shape),1),g=p[0].shape[0]===1,m=jSe(f,v,i,g),y=Vu(t.map(x=>x.shape),e),S=n.makeTensorInfo(y,i,m);return p.forEach(x=>n.disposeIntermediateTensorInfo(x)),S}const s=t.filter(p=>Re(p.shape)>0),o=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){const p=o?new ia(t[0].shape,Rl):new zl(t[0].shape,Rl);return n.runWebGLProgram(p,t,i)}const a=Q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){const p=[];for(let v=0;v<s.length;v+=a){const g=s.slice(v,v+a);p.push(ag(g,e,n))}const f=ag(p,e,n);for(const v of p)n.disposeIntermediateTensorInfo(v);return f}if(o){const p=new Z_e(s.map(f=>f.shape),e);return n.runWebGLProgram(p,s,i)}const{tensors2D:l,outShape:c}=twe(s,e,n),u=new Q_e(l.map(p=>p.shape)),h=n.runWebGLProgram(u,l,i);l.forEach(p=>n.disposeIntermediateTensorInfo(p));const d=Ce({inputs:{x:h},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(h),d}function twe(t,e,n){const i=Vu(t.map(s=>s.shape),e);return{tensors2D:t.map(s=>Ce({inputs:{x:s},attrs:{shape:[-1,Re(s.shape.slice(e))]},backend:n})),outShape:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YV(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i,s=kr(r,e[0].shape)[0],o=e.map(c=>c.shape);UH(o,s);const a=Vu(e.map(c=>c.shape),s);if(Re(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>Re(c.shape)>0);return l.length===1?Xr({inputs:{x:l[0]},backend:n}):ag(l,s,n)}const nwe={kernelName:Upe,backendName:"webgl",kernelFunc:YV};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JV{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,g=e.dataFormat==="channelsLast",m=g?1:2,y=g?2:3,S=g?3:1;let x="",w="";i&&(r?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:s?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:x=`
          float activation(float x) {
            ${i}
          }
        `,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${m}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${f}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${f}) *
                    getW(wR, wC, ${f}, d2);
              } else {
                dotProd +=
                    getX(batch, ${f}, xR, xC) *
                    getW(wR, wC, ${f}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2),
                getW(wR, wC, ${f} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1),
                  getX(batch, xR, xC, ${f} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC),
                  getX(batch, ${f} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${w}
        setOutput(result);
      }
    `}}class iwe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,i=e.padInfo.top,r=e.padInfo.left,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,h=e.filterDepth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${i}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${f}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${f}) *
                  getW(wF, wR, wC, ${f}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1),
                  getX(batch, xF, xR, xC, ${f} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2),
                  getW(wF, wR, wC, ${f} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QV{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Yi(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,h=u;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)d+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;d+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)d+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(h+1)/2;g++){const m=g*2;if(d+=`
           xC = xCCorner + ${m*l};
           `,a===1){if(m<u&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }
               `,l===1&&m>0?d+=`
                 xC${m} = vec4(xTexelC${m-2}.zw, xTexelC${m}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${m} = vec4(previous.zw, xTexelC${m}.xy);
                   } else {
                     xC${m} = vec4(0.0, 0.0, xTexelC${m}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 xC${m} = xTexelC${m};
                 `,m+1<u)){const y=o%2===0?bP(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                     xTexelC${m+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${m+1}.zw = vec2(0.0);
                     }
                     xTexelC${m+1}Ready = 1;
                   }
                   `,l>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${m+1} = vec4(previous.zw, xTexelC${m+1}.xy);
                     } else {
                      xC${m+1} = vec4(0.0, 0.0, xTexelC${m+1}.xy);
                     }
                     `:d+=`
                     xC${m+1} = vec4(xTexelC${m}.zw, xTexelC${m+1}.xy);
                     `):y===1?d+=`
                     xC${m+1} = xTexelC${m};
                     `:d+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                       xTexelC${m+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${m+1}.zw = vec2(0.0);
                       }
                       xTexelC${m+1}Ready = 1;
                     }

                     xC${m+1} = xTexelC${m+1};
                     `}}else m<u&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${m+1}Ready == 0) {
                   xTexelC${m+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${m+1}.zw = vec2(0.0);
                   }
                   xTexelC${m+1}Ready = 1;
                 }

                 xC${m} = vec4(xTexelC${m}.zw, xTexelC${m+1}.zw);
               `,m+1<u&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${m+1} = vec4(xTexelC${m+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                   xTexelC${m+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m+1}.zw = vec2(0.);
                   }
                   xTexelC${m+1}Ready = 1;
                 }

                 xC${m} = vec4(
                   xTexelC${m}.xy, xTexelC${m+1}.xy);
               `,m+1<u&&(d+=`
                   xC${m+1} = vec4(xTexelC${m}.zw, xTexelC${m+1}.zw);
                 `)));m<u&&(d+=`
             wTexel = getW(r, ${m}, d1, d2);
             dotProd += xC${m}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${m}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,m+1<u&&(d+=`
               wTexel = getW(r, ${m+1}, d1, d2);
               dotProd += xC${m+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${m+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let p="",f="";i&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${i}
         }`:s?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${i}
         }`:p=`vec4 activation(vec4 x) {
           ${i}
         }`,f="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${f}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rwe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Yi(this.outputShape.length);const{dataFormat:i}=n,r=vr(),s=i==="channelsLast",o=s?1:2,a=s?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)c+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dS(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function ZV({x:t,filter:e,convInfo:n,backend:i,bias:r=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=i.texData.get(t.dataId),u=n.inChannels,h=l[0]*l[1]*l[2],d=n.outChannels,p=n.dataFormat==="channelsLast",f=!1,v=!1;let g;const m=[];if(s!=null){const x=dS(s.shape,p);x!=null&&(s=Ce({inputs:{x:s},backend:i,attrs:{shape:x}}),m.push(s))}if(r!=null){const x=dS(r.shape,p);x!=null&&(r=Ce({inputs:{x:r},backend:i,attrs:{shape:x}}),m.push(r))}if(!((h===1||d===1)&&u>WV)&&c.isPacked&&p&&c.texture!=null&&l[2]%2!==0&&Ni(c.shape.slice(-3),l.slice(-3))){const x=l[0]*l[1]*(l[2]+1),w={dataId:t.dataId,shape:[1,x,n.inChannels],dtype:t.dtype},C=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,we(cS(c.shape,w.shape),()=>`packed reshape ${c.shape} to ${w.shape} isn't free`);const E=Ce({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(E);const T=hS({a:w,b:E,backend:i,transposeA:f,transposeB:v,bias:r,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),M=i.texData.get(T.dataId);we(M.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=C,M.shape=n.outShape,g=Xr({inputs:{x:T},backend:i}),g.shape=n.outShape,m.push(T)}else{const x=n.outHeight*n.outWidth,w=Ce({inputs:{x:t},backend:i,attrs:{shape:p?[n.batchSize,x,n.inChannels]:[n.batchSize,n.inChannels,x]}}),C=Ce({inputs:{x:e},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}}),E=hS({a:p?w:C,b:p?C:w,transposeA:!p,transposeB:v,backend:i,bias:r,activation:a,preluActivationWeights:s,leakyreluAlpha:o});g=Ce({inputs:{x:E},backend:i,attrs:{shape:n.outShape}}),m.push(w),m.push(C),m.push(E)}for(const x of m)i.disposeIntermediateTensorInfo(x);return g}function e7({x:t,filter:e,convInfo:n,backend:i,bias:r=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:h,outHeight:d,dataFormat:p}=n,f=p==="channelsLast",v=l*c*u,g=d*h,m=[n.batchSize,v,g],y=!0,S=!1,x=[];if(s!=null){const D=dS(s.shape,f);D!=null&&(s=Ce({inputs:{x:s},backend:i,attrs:{shape:D}}),x.push(s))}if(r!=null){const D=dS(r.shape,f);D!=null&&(r=Ce({inputs:{x:r},backend:i,attrs:{shape:D}}),x.push(r))}const w=Ce({inputs:{x:e},backend:i,attrs:{shape:[1,v,Re(e.shape)/v]}});x.push(w);const C=new rwe(m,n),E=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],T=i.runWebGLProgram(C,[t],"float32",E),M=Ce({inputs:{x:T},backend:i,attrs:{shape:m}});x.push(T),x.push(M);const _=r!=null,R=s!=null,L=a==="leakyrelu",z=a?p0(a,!0):null,G=new jV(f?M.shape:w.shape,f?w.shape:M.shape,f?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],y,S,_,z,R,L),$=f?[M,w]:[w,M];if(r&&$.push(r),R&&$.push(s),L){const D=i.makeTensorInfo([],"float32",_p(o,"float32"));$.push(D),x.push(D)}const H=i.runWebGLProgram(G,$,"float32"),q=Ce({inputs:{x:H},backend:i,attrs:{shape:n.outShape}});x.push(H);for(const D of x)i.disposeIntermediateTensorInfo(D);return q}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function swe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=i,h=Rp(l),d=$o(r.shape,s.shape,o,c,a,u,!1,h);let p;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))p=ZV({x:r,filter:s,convInfo:d,backend:n});else if(d.strideWidth<=2&&h==="channelsLast"&&Q().getBool("WEBGL_EXP_CONV")){const v=new QV(d),g=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(v,[r,s],"float32",g)}else if(Q().getBool("WEBGL_CONV_IM2COL"))p=e7({x:r,filter:s,convInfo:d,backend:n});else{const v=new JV(d);p=n.runWebGLProgram(v,[r,s],"float32")}const f=Ce({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}const owe={kernelName:Bpe,backendName:"webgl",kernelFunc:swe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class awe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,i=e.strideWidth,r=e.padInfo.top,s=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class lwe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,r=e.strideHeight,s=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=i-1-e.padInfo.left,c=o?1:2,u=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class cwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,i=e.strideHeight,r=e.strideWidth,s=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${s};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${i} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class uwe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,i=e.filterHeight,r=e.filterWidth,s=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=i-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${i}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${i} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:s}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=i,h=Rp(l),d=$o(r.shape,u,o,1,a,c,!1,h),p=new awe(d);return n.runWebGLProgram(p,[r,s],"float32")}const dwe={kernelName:$pe,backendName:"webgl",kernelFunc:hwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pwe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Yi(this.outputShape.length);const n=e.filterHeight,i=e.filterWidth,r=n-1-e.padInfo.top,s=i-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            int wCPerm = ${i} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fwe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:s}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=i,h=Rp(c),d=$o(o,s.shape,a,1,l,u,!1,h);if(Q().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[d.strideHeight,d.strideWidth]],f=new pwe(d);return n.runWebGLProgram(f,[r,s],"float32",p)}else{const p=new lwe(d);return n.runWebGLProgram(p,[r,s],"float32")}}const mwe={kernelName:Hpe,backendName:"webgl",kernelFunc:fwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dilations:l}=i,c=Y0(r.shape,s.shape,o,l,a),u=new iwe(c);return n.runWebGLProgram(u,[r,s],"float32")}const vwe={kernelName:Vpe,backendName:"webgl",kernelFunc:gwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ywe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:s}=e,{strides:o,pad:a,filterShape:l}=i,c=Y0(r.shape,l,o,1,a),u=new cwe(c);return n.runWebGLProgram(u,[r,s],"float32")}const Swe={kernelName:jpe,backendName:"webgl",kernelFunc:ywe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xwe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:s}=e,{pad:o,strides:a,inputShape:l}=i,c=Y0(l,s.shape,a,1,o),u=new uwe(c);return n.runWebGLProgram(u,[r,s],"float32")}const Cwe={kernelName:Wpe,backendName:"webgl",kernelFunc:xwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _we=kp+`
  return cos(x);
`,wwe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${sh}
  return result;
`,Ewe=Gt({opSnippet:_we,packedOpSnippet:wwe}),Rwe={kernelName:Gpe,backendName:"webgl",kernelFunc:Ewe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Twe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,bwe=Gt({opSnippet:Twe}),Awe={kernelName:qpe,backendName:"webgl",kernelFunc:bwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pwe{constructor(e,n,i,r,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[u]=n,[h,d]=i;this.outputShape=[u,h,d,c];const p=r==="bilinear"?1:0,[f,v]=[`${a-1}.0`,`${l-1}.0`],[g,m,y]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[S,x,w]=d>1?[`${(l-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${m};
        float width_scale = ${x};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${f} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iwe=t=>{const{inputs:e,backend:n,attrs:i}=t,{image:r,boxes:s,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=i,u=new Pwe(r.shape,s.shape,a,l,c);return n.runWebGLProgram(u,[r,s,o],"float32")},Mwe={kernelName:Ype,backendName:"webgl",kernelFunc:Iwe};var m0;(function(t){t.Prod="*",t.Sum="+"})(m0||(m0={}));class P4{constructor(e,n,i,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,o=this.op===m0.Prod?"1.0":"0.0",a=i?o:`getX(${I4(s,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";i?(c=r?`end != ${l-1}`:"end != 0",u=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${hn(s)} coords = getOutputCoords();
        int end = ${M4(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${M4(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${I4(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function I4(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function M4(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t7(t,e,n,i,r,s){const o=e.shape.length,a=io([i],o);let l=e;a!=null&&(l=mr({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=ro(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${i}`);const u=l.shape[c];let h=Xr({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){const p=new P4(t,l.shape,!1,s),f=[[d]],v=h;h=n.runWebGLProgram(p,[h],h.dtype,f),n.disposeIntermediateTensorInfo(v)}if(r){const d=new P4(t,l.shape,r,s),p=h;h=n.runWebGLProgram(d,[h],h.dtype),n.disposeIntermediateTensorInfo(p)}if(a!=null){const d=BP(a),p=mr({inputs:{x:h},backend:n,attrs:{perm:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,exclusive:o,reverse:a}=i;return t7(m0.Prod,r,n,s,o,a)}const Lwe={kernelName:Xpe,backendName:"webgl",kernelFunc:kwe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,exclusive:o,reverse:a}=i;return t7(m0.Sum,r,n,s,o,a)}const Nwe={kernelName:Kpe,backendName:"webgl",kernelFunc:Dwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Owe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,weights:s}=e,{size:o,binaryOutput:a}=i;if(r.shape.length===1){const l=n.readSync(r.dataId),c=n.readSync(s.dataId),u=NV(l,c,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,u)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(s),u=BSe(l,c,o,a);return n.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Fwe={kernelName:Jpe,backendName:"webgl",kernelFunc:Owe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zwe{constructor(e,n,i){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=i,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockSize:s,dataFormat:o}=i,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],c=o==="NHWC"?r.shape[2]:r.shape[3],u=o==="NHWC"?r.shape[3]:r.shape[1],h=l*s,d=c*s,p=u/(s*s),f=o==="NHWC"?[a,h,d,p]:[a,p,h,d],v=new zwe(f,s,o);return n.runWebGLProgram(v,[r],r.dtype)}const Bwe={kernelName:Qpe,backendName:"webgl",kernelFunc:Uwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n7{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Yi(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";i&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:s?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:c=`
          float activation(float x) {
            ${i}
          }
        `,u="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i7{constructor(e,n=!1,i=null,r=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Yi(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,d=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<h;m++)p+=`
          vec4 xTexelC${m*2};
          int xTexelC${m*2}Ready;
          vec4 xTexelC${m*2+1};
          int xTexelC${m*2+1}Ready;
          vec4 xC${m};`;p+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let m=0;m<h;m++)p+=`
          xTexelC${m*2} = vec4(0.0);
          xTexelC${m*2}Ready = 0;
          xTexelC${m*2+1} = vec4(0.0);
          xTexelC${m*2+1}Ready = 0;
          xC${m} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let m=0;m<(d+1)/2;m++){const y=m*2;if(p+=`
          xC = xCCorner + ${y*c};
          `,l===1){if(y<h&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,c===1&&y>0?p+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<h)){const S=a%2===0?bP(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${S};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:p+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):S===1?p+=`
                    xC${y+1} = xTexelC${y};
                    `:p+=`
                    xCOffset = xC + ${S};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<h&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<h&&(p+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<h&&(p+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<h&&(p+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let f="",v="";i&&(r?f=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:s?f=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:f=`vec4 activation(vec4 x) {
          ${i}
        }`,v="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $we(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=i;let u=l;u==null&&(u=[1,1]),we(Ep(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=$o(r.shape,s.shape,o,u,a,c,!0);let d;Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new i7(h):d=new n7(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[r,s],"float32",p)}const Hwe={kernelName:Zpe,backendName:"webgl",kernelFunc:$we};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,i=e.strideWidth,r=e.padInfo.top,s=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jwe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,i=e.filterWidth,r=e.strideHeight,s=e.strideWidth,o=n-1-e.padInfo.top,a=i-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,dy:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=i,h=$o(r.shape,u,o,a,l,c,!0),d=new Vwe(h);return n.runWebGLProgram(d,[r,s],"float32")}const Gwe={kernelName:efe,backendName:"webgl",kernelFunc:Wwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qwe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,filter:s}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=i,h=$o(u,s.shape,o,a,l,c,!0),d=new jwe(h);return n.runWebGLProgram(d,[r,s],"float32")}const Xwe={kernelName:tfe,backendName:"webgl",kernelFunc:qwe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kwe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ywe(t){const{inputs:e,backend:n}=t,{x:i}=e,r=[...i.shape,...i.shape],s=Re(i.shape),o=Ce({inputs:{x:i},backend:n,attrs:{shape:[s]}}),a=new Kwe(s),l=n.runWebGLProgram(a,[o],o.dtype),c=Ce({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}const Jwe={kernelName:nfe,backendName:"webgl",kernelFunc:Ywe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qwe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:i,padInfo:r,strideHeight:s,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:h,left:d}=r;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${i}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zwe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s}=e,{strides:o,pad:a,dilations:l}=i,c=xH(r.shape,s.shape,o,a,"NHWC",l);let u;const h=new Qwe(c);u=n.runWebGLProgram(h,[r,s],"float32");const d=Ce({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),d}const eEe={kernelName:ife,backendName:"webgl",kernelFunc:Zwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tEe(t){const{inputs:e,backend:n,attrs:i}=t,{equation:r}=i,s=e,{allDims:o,summedDims:a,idDims:l}=tV(r,s.length);iV(o.length,l,s);const{path:c,steps:u}=rV(a,l),h=u.length;let d=null,p=o.length;const f=[];for(let v=0;v<h;++v){for(const g of u[v]){const{permutationIndices:m,expandDims:y}=nV(p,l[g]);let S;sV(m)?S=s[g]:(S=mr({inputs:{x:s[g]},backend:n,attrs:{perm:m}}),f.push(S));const x=S.shape.slice();for(let w=0;w<y.length;++w)x.splice(y[w],0,1);Ni(S.shape,x)||(S=Ce({inputs:{x:S},backend:n,attrs:{shape:x}}),f.push(S)),d===null?d=S:(d=tI({inputs:{a:S,b:d},backend:n}),f.push(d))}v<h-1&&(c[v]>=0&&(d=VC({inputs:{x:d},backend:n,attrs:{axis:c[v]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const v of f)v!==d&&n.disposeIntermediateTensorInfo(v);return d}const nEe={kernelName:rfe,backendName:"webgl",kernelFunc:tEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iEe="return (x >= 0.0) ? x : (exp(x) - 1.0);",rEe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,sEe=Gt({opSnippet:iEe,packedOpSnippet:rEe}),oEe={kernelName:A8,backendName:"webgl",kernelFunc:sEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aEe="return (b >= 0.0) ? a : a * (b + 1.0);",lEe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,cEe=t=>{const{inputs:e,backend:n}=t,{dy:i,y:r}=e,s=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mp(lEe,i.shape,r.shape):new ju(aEe,i.shape,r.shape);return n.runWebGLProgram(s,[i,r],i.dtype)},uEe={kernelName:sfe,backendName:"webgl",kernelFunc:cEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hEe=`
  return vec4(equal(a, b));
`,dEe="return float(a == b);",pEe=Ui({opSnippet:dEe,packedOpSnippet:hEe,dtype:"bool",cpuKernelImpl:WSe}),fEe={kernelName:afe,backendName:"webgl",kernelFunc:pEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mEe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${KH};
  float a1 = ${YH};
  float a2 = ${JH};
  float a3 = ${QH};
  float a4 = ${ZH};
  float a5 = ${eV};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,gEe=Gt({opSnippet:mEe}),vEe={kernelName:ofe,backendName:"webgl",kernelFunc:gEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yEe=kp+`
  return exp(x);
`,SEe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,r7=Gt({opSnippet:yEe,packedOpSnippet:SEe,cpuKernelImpl:GSe,dtype:"float32"}),xEe={kernelName:lfe,backendName:"webgl",kernelFunc:r7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lb(t){const{inputs:e,attrs:n,backend:i}=t,{dim:r}=n,{input:s}=e,o=s.shape.length,a=s.shape.slice();let l=r;return r<0&&(we(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Ce({inputs:{x:s},backend:i,attrs:{shape:a}})}const CEe={kernelName:cfe,backendName:"webgl",kernelFunc:lb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k4="return exp(x) - 1.0;",_Ee=Gt({opSnippet:k4,packedOpSnippet:k4,cpuKernelImpl:qSe}),wEe={kernelName:ufe,backendName:"webgl",kernelFunc:_Ee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L4{constructor(e,n,i){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const s=i?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=i?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(t,e,n){const i=n.texData.get(t.dataId),r=Re(t.shape),s=t.shape[t.shape.length-1],o=r/s,a=Ce({inputs:{x:t},backend:n,attrs:{shape:[o,s]}}),l=a.shape,c=new L4("real",l,e),u=new L4("imag",l,e),h=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:l},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:l}],d=n.runWebGLProgram(c,h,"float32"),p=n.runWebGLProgram(u,h,"float32"),f=Ec({inputs:{real:d,imag:p},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p);const v=Ce({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(f),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EEe(t){const{inputs:e,backend:n}=t,{input:i}=e;return s7(i,!1,n)}const REe={kernelName:hfe,backendName:"webgl",kernelFunc:EEe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TEe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tv(t){const{backend:e,attrs:n}=t,{shape:i,value:r}=n;let{dtype:s}=n;if(s=s||q0(r),s==="string"){const o=_i(s,Re(i));return o.fill(r),e.makeTensorInfo(i,s,o)}else{const o=new TEe(i,r),a=[[r]];return e.runWebGLProgram(o,[],s,a)}}const bEe={kernelName:P8,backendName:"webgl",kernelFunc:tv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AEe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PEe={kernelName:dfe,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,i=e,r=new AEe(n.shape);return i.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D4="return floor(x);",IEe=Gt({opSnippet:D4,packedOpSnippet:D4,cpuKernelImpl:XSe}),MEe={kernelName:pfe,backendName:"webgl",kernelFunc:IEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kEe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,LEe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,DEe=Ui({opSnippet:kEe,packedOpSnippet:LEe,dtype:"int32"}),NEe={kernelName:I8,backendName:"webgl",kernelFunc:DEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OEe{constructor(e){this.variableNames=["A"];const n=vr(),[i,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${i}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FEe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=vr(),[i,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${i}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zEe={kernelName:Xme,backendName:"webgl",kernelFunc:UEe};let Lh,pE=Q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function UEe(t){const{inputs:e,backend:n,attrs:i}=t;let{pixels:r}=e;const{numChannels:s}=i,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],h=[c,l,s];if(a||o){const v=Q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Lh==null||v!==pE)&&(pE=v,Lh=document.createElement("canvas").getContext("2d",{willReadFrequently:pE})),Lh.canvas.width=l,Lh.canvas.height=c,Lh.drawImage(r,0,0,l,c),r=Lh.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=gs.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),r);const p=Q().getBool("WEBGL_PACK")?new FEe(h):new OEe(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BEe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i,v=Rp(u),g=$o(r.shape,s.shape,l,h,c,d,!1,v);let m;const y=[],S=o!=null,x=a!=null,w=p==="leakyrelu",C=()=>{const T=[r,s],M=(_,R)=>{if(R==="NCHW"&&_.shape.length===1&&_.shape[0]!==1){const L=Ce({inputs:{x:_},backend:n,attrs:{shape:[_.shape[0],1,1]}});return y.push(L),L}return _};if(S&&T.push(M(o,u)),x&&T.push(M(a,u)),w){const _=n.makeTensorInfo([],"float32",_p(f,"float32"));T.push(_),y.push(_)}return T};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))m=ZV({x:r,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else if(g.strideWidth<=2&&v==="channelsLast"&&Q().getBool("WEBGL_EXP_CONV")){const T=p?p0(p,!0):null,M=new QV(g,S,T,x,w),_=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],R=C();m=n.runWebGLProgram(M,R,"float32",_)}else if(Q().getBool("WEBGL_CONV_IM2COL"))m=e7({x:r,filter:s,convInfo:g,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const T=p?p0(p,!1):null,M=new JV(g,S,T,x,w),_=C();m=n.runWebGLProgram(M,_,"float32")}const E=Ce({inputs:{x:m},backend:n,attrs:{shape:g.outShape}});return y.push(m),y.forEach(T=>n.disposeIntermediateTensorInfo(T)),E}const $Ee={kernelName:Jme,backendName:"webgl",kernelFunc:BEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HEe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,filter:s,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=i,f=[];let v=u;v==null&&(v=[1,1]),we(Ep(l,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${v}'`);const g=$o(r.shape,s.shape,l,v,c,h,!0),m=Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,y=d?p0(d,m):null,S=[r,s],x=o!=null,w=a!=null,C=d==="leakyrelu";if(x&&S.push(o),w&&S.push(a),C){const _=n.makeTensorInfo([],"float32",_p(p,"float32"));S.push(_),f.push(_)}let E;m?E=new i7(g,x,y,w,C):E=new n7(g,x,y,w,C);const T=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],M=n.runWebGLProgram(E,S,"float32",T);return f.forEach(_=>n.disposeIntermediateTensorInfo(_)),M}const VEe={kernelName:Qme,backendName:"webgl",kernelFunc:HEe};class jEe{constructor(e,n,i,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=i;const s=hn(i.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WEe(t){const{inputs:e,backend:n}=t,{params:i,indices:r}=e,s=r.shape,o=s[s.length-1],a=Re(i.shape),[l,c,u,h]=TH(i,r),d=Ce({inputs:{x:r},backend:n,attrs:{shape:[c,o]}}),p=Ce({inputs:{x:i},backend:n,attrs:{shape:[Re(i.shape)/u,u]}});if(n.shouldExecuteOnCPU([i,r])||i.dtype==="string"){const m=n.readSync(r.dataId),y=n.bufferSync(i),S=KSe(m,y,i.dtype,c,o,u,h,i.shape,a);return n.makeTensorInfo(l,i.dtype,S.values)}const f=new jEe(o,h,[c,u],i.shape),v=n.runWebGLProgram(f,[p,d],p.dtype),g=Ce({inputs:{x:v},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),g}const GEe={kernelName:gfe,backendName:"webgl",kernelFunc:WEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qEe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const i=hn(this.rank),r=XEe(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function XEe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let r=0;r<t.length;r++)r===2?i.push("index"):i.push(`${n[r]}`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,indices:s}=e,{axis:o,batchDims:a}=i,l=kr(o,r.shape)[0];if(Q().get("DEBUG")){const y=n.readSync(s.dataId),S=r.shape[l];for(let x=0;x<y.length;++x){const w=y[x];we(w<=S-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${S-1}]`)}}const c=xV(r,s,l,a),u=Re(s.shape),h=[],d=Ce({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=Ce({inputs:{x:s},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});h.push(d),h.push(p);const f=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const y=n.bufferSync(p),S=n.bufferSync(d),x=YSe(S,y,f);return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(c.outputShape,x.dtype,x.values)}const v=new qEe(d.shape,f),g=n.runWebGLProgram(v,[d,p],d.dtype);h.push(g);const m=Ce({inputs:{x:g},backend:n,attrs:{shape:c.outputShape}});return h.forEach(y=>n.disposeIntermediateTensorInfo(y)),m}const KEe={kernelName:mfe,backendName:"webgl",kernelFunc:o7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YEe="return float(a > b);",JEe=`
  return vec4(greaterThan(a, b));
`,QEe=Ui({opSnippet:YEe,packedOpSnippet:JEe,cpuKernelImpl:JSe,dtype:"bool"}),ZEe={kernelName:vfe,backendName:"webgl",kernelFunc:QEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eRe="return float(a >= b);",tRe=`
  return vec4(greaterThanEqual(a, b));
`,nRe=Ui({opSnippet:eRe,packedOpSnippet:tRe,dtype:"bool",cpuKernelImpl:QSe}),iRe={kernelName:yfe,backendName:"webgl",kernelFunc:nRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rRe(t){const{inputs:e,backend:n}=t,{input:i}=e;return s7(i,!0,n)}const sRe={kernelName:Sfe,backendName:"webgl",kernelFunc:rRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oRe="return float(!isnan(x) && !isinf(x));",aRe=Gt({opSnippet:oRe,dtype:"bool"}),lRe={kernelName:Cfe,backendName:"webgl",kernelFunc:aRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cRe="return float(isinf(x));",uRe=Gt({opSnippet:cRe,dtype:"bool"}),hRe={kernelName:_fe,backendName:"webgl",kernelFunc:uRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dRe="return float(isnan(x));",pRe=Gt({opSnippet:dRe,dtype:"bool"}),fRe={kernelName:wfe,backendName:"webgl",kernelFunc:pRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mRe="return float(a < b);",gRe=`
  return vec4(lessThan(a, b));
`,vRe=Ui({opSnippet:mRe,packedOpSnippet:gRe,cpuKernelImpl:ZSe,dtype:"bool"}),yRe={kernelName:Efe,backendName:"webgl",kernelFunc:vRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SRe="return float(a <= b);",xRe=`
  return vec4(lessThanEqual(a, b));
`,CRe=Ui({opSnippet:SRe,packedOpSnippet:xRe,cpuKernelImpl:exe,dtype:"bool"}),_Re={kernelName:Rfe,backendName:"webgl",kernelFunc:CRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wRe(t){const{backend:e,attrs:n}=t,{start:i,stop:r,num:s}=n,o=txe(i,r,s);return e.makeTensorInfo([o.length],"float32",o)}const ERe={kernelName:Tfe,backendName:"webgl",kernelFunc:wRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RRe=kp+`
  return x < 0.0 ? 0./0. : log(x);
`,TRe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,bRe=Gt({opSnippet:RRe,packedOpSnippet:TRe,cpuKernelImpl:nxe}),ARe={kernelName:bfe,backendName:"webgl",kernelFunc:bRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PRe=kp+`
  return log(1.0 + x);
`,IRe=Gt({opSnippet:PRe}),MRe={kernelName:Afe,backendName:"webgl",kernelFunc:IRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kRe="return float(a >= 1.0 && b >= 1.0);",LRe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,DRe=Ui({opSnippet:kRe,packedOpSnippet:LRe,dtype:"bool"}),NRe={kernelName:Pfe,backendName:"webgl",kernelFunc:DRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ORe="return float(!(x >= 1.0));",FRe=Gt({opSnippet:ORe}),zRe={kernelName:Ife,backendName:"webgl",kernelFunc:FRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const URe="return float(a >= 1.0 || b >= 1.0);",BRe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,$Re=Ui({opSnippet:URe,packedOpSnippet:BRe,dtype:"bool"}),HRe={kernelName:Mfe,backendName:"webgl",kernelFunc:$Re};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VRe{constructor(e,n,i,r,s){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${i}) + float(${r}) * sum`;s===.5?l=`inversesqrt(${c})`:s===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jRe{constructor(e,n,i,r,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${i}) + float(${r}) * sum`;s===.5?l=`inversesqrt(${c})`:s===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WRe=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{depthRadius:s,bias:o,alpha:a,beta:l}=i,c=Q().getBool("WEBGL_PACK_NORMALIZATION")?new jRe(r.shape,s,o,a,l):new VRe(r.shape,s,o,a,l);return n.runWebGLProgram(c,[r],r.dtype)},GRe={kernelName:kfe,backendName:"webgl",kernelFunc:WRe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qRe{constructor(e,n,i,r,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=i,this.alpha=r,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${i});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XRe=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r,y:s,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=i,h=new qRe(r.shape,a,l,c,u);return n.runWebGLProgram(h,[r,s,o],r.dtype)},KRe={kernelName:Lfe,backendName:"webgl",kernelFunc:XRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YRe(t,e,n,i){const r=Re(e),o=Re(t.shape)/r,a=Ce({inputs:{x:t},attrs:{shape:[o,r]},backend:i}),l=oh(a,t.dtype,"max",i),c=Ce({inputs:{x:l},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reductionIndices:s,keepDims:o}=i,a=r.shape.length,l=kr(s,r.shape);let c=l;const u=io(c,a),h=u!=null,d=n.shouldExecuteOnCPU([r]);let p=r;if(h){if(d){const S=n.texData.get(p.dataId).values,x=new Array(a);for(let E=0;E<x.length;E++)x[E]=r.shape[u[E]];const w=ZP(S,r.shape,r.dtype,u,x);p=n.makeTensorInfo(x,r.dtype);const C=n.texData.get(p.dataId);C.values=w}else p=HC(r,u,n);c=ro(c.length,a)}Ho("max",c,a);const[f,v]=va(p.shape,c);let g=f;o&&(g=il(f,l));let m;if(d){const S=n.texData.get(p.dataId).values,x=ixe(S,Re(v),g,r.dtype);m=n.makeTensorInfo(g,r.dtype);const w=n.texData.get(m.dataId);w.values=x}else m=YRe(p,v,g,n);return h&&n.disposeIntermediateTensorInfo(p),m}const JRe={kernelName:Dfe,backendName:"webgl",kernelFunc:a7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QRe=eI+`
  return max(a, b);
`,ZRe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sh+`
  return result;
`,eTe=Ui({opSnippet:QRe,packedOpSnippet:ZRe,cpuKernelImpl:rxe}),tTe={kernelName:k8,backendName:"webgl",kernelFunc:eTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nTe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;Q0(r,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:l}=i,c=1;we(Ep(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=wp(r.shape,s,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Ni(u.inShape,u.outShape))return Xr({inputs:{x:r},backend:n});const h=new f0(u,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const iTe={kernelName:Nfe,backendName:"webgl",kernelFunc:nTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rTe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{filterSize:s,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=i,u=[1,1,1],h=K0(r.shape,s,o,u,a,c,l),d=new nI(h,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const sTe={kernelName:Ffe,backendName:"webgl",kernelFunc:rTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oTe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,i=e.strideWidth,r=e.dilationHeight,s=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=s-1-e.padInfo.top,l=o-1-e.padInfo.left,c=s*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class aTe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,i=e.strideHeight,r=e.strideWidth,s=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=c-1-e.padInfo.top,p=u-1-e.padInfo.left,f=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${f} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lTe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s}=e,o=s,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,h=[1,1,1],d=K0(o.shape,a,l,h,c,u),p=new nI(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),v=new aTe(d),g=n.runWebGLProgram(v,[r,f],o.dtype);return n.disposeIntermediateTensorInfo(f),g}const cTe={kernelName:zfe,backendName:"webgl",kernelFunc:lTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uTe(t){const{inputs:e,backend:n,attrs:i}=t,{dy:r,input:s,output:o}=e,a=s;Q0([s,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=i,d=wp(a.shape,l,c,1,u,h),p=!0,f=new f0(d,"max",p),v=n.runWebGLProgram(f,[a],a.dtype),g=new oTe(d),m=n.runWebGLProgram(g,[r,v],a.dtype);return n.disposeIntermediateTensorInfo(v),m}const hTe={kernelName:Ofe,backendName:"webgl",kernelFunc:uTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dTe(t,e,n,i){let r=new f0(n,"max",!1);const s=i.runWebGLProgram(r,[t],"float32");r=new f0(n,"max",!0,!0,e);const o=i.runWebGLProgram(r,[t],"float32");return[s,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pTe={kernelName:Ufe,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:r,strides:s,pad:o,includeBatchInIndex:a}=e,l=n;we(i.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const c=[1,1];we(Ep(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=wp(i.shape,r,s,c,o),[h,d]=dTe(i,a,u,l);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fTe(t,e,n,i){const r=Re(e),o=Re(t.shape)/r,a=Ce({inputs:{x:t},attrs:{shape:[o,r]},backend:i}),l=oh(a,"float32","mean",i),c=Ce({inputs:{x:l},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mTe={kernelName:Bfe,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{keepDims:r,axis:s}=e,o=n,a=i.shape.length,l=kr(s,i.shape);let c=l;const u=io(c,a),h=u!=null,d=o.shouldExecuteOnCPU([i]),p=[];let f=i;if(h){if(d){const x=o.texData.get(f.dataId).values,w=new Array(a);for(let T=0;T<w.length;T++)w[T]=i.shape[u[T]];const C=ZP(x,i.shape,i.dtype,u,w);f=o.makeTensorInfo(w,i.dtype);const E=o.texData.get(f.dataId);E.values=C}else f=HC(i,u,o);p.push(f),c=ro(c.length,a)}Ho("sum",c,a);const[v,g]=va(f.shape,c);let m=v;r&&(m=il(v,l));const y=fTe(f,g,m,o);for(const S of p)o.disposeIntermediateTensorInfo(S);return y}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gTe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,l=kr(s,r.shape);let c=l;const u=io(c,a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),c=ro(c.length,r.shape.length)),Ho("min",c,a);const[d,p]=va(h.shape,c),f=Re(p),v=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=oh(v,v.dtype,"min",n);let m;if(o){const y=il(d,l);m=Ce({inputs:{x:g},backend:n,attrs:{shape:y}})}else m=Ce({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(h),m}const vTe={kernelName:$fe,backendName:"webgl",kernelFunc:gTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yTe=eI+`
  return min(a, b);
`,STe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sh+`
  return result;
`,xTe=Ui({opSnippet:yTe,packedOpSnippet:STe,cpuKernelImpl:sxe}),CTe={kernelName:Hfe,backendName:"webgl",kernelFunc:xTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Te{constructor(e,n,i){this.variableNames=["x"],this.outputShape=n.map((u,h)=>u[0]+e[h]+u[1]);const r=e.length,s=hn(r),o=n.map(u=>u[0]).join(","),a=n.map((u,h)=>u[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=i==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wTe{constructor(e,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((f,v)=>f[0]+e[v]+f[1]);const r=e.length,s=hn(r),o=n.map(f=>f[0]).join(","),a=n.map((f,v)=>f[0]+e[v]).join(","),l=dr("rc",r),c=dr("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${c.slice(-2).join()})`,d=i==="reflect"?0:1;let p="";if(r===1){const f=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;p=`
        ${s} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
      `}else{const f=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;p=`
        ${s} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${f}
          result[2] = getChannel(getX(${c.join()}), ${h});
          ${l[r-1]} += 1;
          if(${u}) {
            ${f}
            result[3] = getChannel(getX(${c.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ETe=({inputs:t,backend:e,attrs:n})=>{const{x:i}=t,{paddings:r,mode:s}=n,o=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wTe(i.shape,r,s):new _Te(i.shape,r,s);return e.runWebGLProgram(o,[i],i.dtype)},RTe={kernelName:Vfe,backendName:"webgl",kernelFunc:ETe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TTe=`if (b == 0.0) return NAN;
  return mod(a, b);`,bTe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+sh+`
  return result;
`,ATe=Ui({opSnippet:TTe,packedOpSnippet:bTe}),PTe={kernelName:jfe,backendName:"webgl",kernelFunc:ATe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ITe{constructor(e,n,i){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,i],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MTe=`
if (a == b) {
  return 1.0;
};
return a / b;`,kTe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,l7=Ui({opSnippet:MTe,packedOpSnippet:kTe,checkOutOfBounds:!0}),LTe={kernelName:b8,backendName:"webgl",kernelFunc:l7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N4="return a - b;",c7=Ui({opSnippet:N4,packedOpSnippet:N4,supportsComplex:!0,cpuKernelImpl:Txe}),DTe={kernelName:H8,backendName:"webgl",kernelFunc:c7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{dim:s}=i,o=kr([s],r.shape),a=a7({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=il(a.shape,o),c=Ce({inputs:{x:a},backend:n,attrs:{shape:l}}),u=c7({inputs:{a:r,b:c},backend:n}),h=r7({inputs:{x:u},backend:n}),d=VC({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=Ce({inputs:{x:d},backend:n,attrs:{shape:l}}),f=l7({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const NTe={kernelName:bme,backendName:"webgl",kernelFunc:u7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OTe(t){const{inputs:e,backend:n,attrs:i}=t,{logits:r}=e,{numSamples:s,seed:o,normalized:a}=i,l=a?r:u7({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new ITe(c,u,s),d=[[o]],p=n.runWebGLProgram(h,[l],"int32",d);return a||n.disposeIntermediateTensorInfo(l),p}const FTe={kernelName:Wfe,backendName:"webgl",kernelFunc:OTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zTe=so+`
  return -x;
`,UTe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function BTe(t){const{inputs:e,backend:n}=t,{x:i}=e;if(n.shouldExecuteOnCPU([i])){const s=n.texData.get(i.dataId),[o,a]=axe(s.values,i.shape,i.dtype);return n.makeTensorInfo(a,i.dtype,o)}let r;return Q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new zl(i.shape,UTe):r=new ia(i.shape,zTe),n.runWebGLProgram(r,[i],i.dtype)}const $Te={kernelName:Gfe,backendName:"webgl",kernelFunc:BTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HTe=Q0e;function VTe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=i,c=n.readSync(r.dataId),u=n.readSync(s.dataId),{selectedIndices:h}=HTe(c,u,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const jTe={kernelName:Xfe,backendName:"webgl",kernelFunc:VTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WTe=Z0e;function GTe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=i,u=n.readSync(r.dataId),h=n.readSync(s.dataId),{selectedIndices:d,validOutputs:p}=WTe(u,h,o,a,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const qTe={kernelName:Kfe,backendName:"webgl",kernelFunc:GTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XTe=eve;function KTe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:i}=t,{boxes:r,scores:s}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=i,u=n.readSync(r.dataId),h=n.readSync(s.dataId),d=o,p=a,f=l,v=c,{selectedIndices:g,selectedScores:m}=XTe(u,h,d,p,f,v);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}const YTe={kernelName:Yfe,backendName:"webgl",kernelFunc:KTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JTe{constructor(e,n,i,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${i}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QTe=t=>{const{inputs:e,backend:n,attrs:i}=t,{indices:r}=e,{dtype:s,depth:o,onValue:a,offValue:l}=i,c=Re(r.shape),u=new JTe(c,o,a,l),h=Ce({inputs:{x:r},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(u,[h],s);n.disposeIntermediateTensorInfo(h);const p=[...r.shape,o],f=Ce({inputs:{x:d},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(d),f},ZTe={kernelName:Qfe,backendName:"webgl",kernelFunc:QTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pS(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="complex64"){const r=ev({inputs:{input:i},backend:n}),s=pS({inputs:{x:r},backend:n}),o=jC({inputs:{input:i},backend:n}),a=pS({inputs:{x:o},backend:n}),l=Ec({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return tv({attrs:{shape:i.shape,dtype:i.dtype,value:i.dtype==="string"?"":0},backend:n})}const ebe={kernelName:j8,backendName:"webgl",kernelFunc:pS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7(t){const{inputs:e,backend:n}=t,{x:i}=e;if(i.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(i.dtype==="complex64"){const r=ev({inputs:{input:i},backend:n}),s=h7({inputs:{x:r},backend:n}),o=jC({inputs:{input:i},backend:n}),a=pS({inputs:{x:o},backend:n}),l=Ec({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return tv({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:n})}const tbe={kernelName:Jfe,backendName:"webgl",kernelFunc:h7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nbe(t){const{inputs:e,backend:n,attrs:i}=t,{axis:r}=i;if(e.length===1)return lb({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const s=e[0].shape,o=e[0].dtype;e.forEach(u=>{x8(s,u.shape,"All tensors passed to stack must have matching shapes"),we(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const h=lb({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(h),h}),c=YV({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const ibe={kernelName:Zfe,backendName:"webgl",kernelFunc:nbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rbe{constructor(e,n,i){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,u)=>c[0]+e[u]+c[1]);const r=e.length,s=hn(r),o=n.map(c=>c[0]).join(","),a=n.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sbe{constructor(e,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((v,g)=>v[0]+e[g]+v[1]);const r=e.length,s=hn(r),o=n.map(v=>v[0]).join(","),a=n.map((v,g)=>v[0]+e[g]).join(","),l=dr("rc",r),c=dr("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${c.slice(-2).join()})`,d=[`${s} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${u}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let v=0,g=r===1?2:4;v<g;v++)f+=`
        ${d[v]}
        if (${p}) {
          result[${v}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${v}] = getChannel(getX(${c.join()}), ${h});
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{paddings:s,constantValue:o}=i;if(Re(r.shape)===0){const c=s.map((u,h)=>u[0]+r.shape[h]+u[1]);return tv({backend:n,attrs:{shape:c,value:o,dtype:r.dtype}})}const a=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sbe(r.shape,s,o):new rbe(r.shape,s,o),l=[[o]];return n.runWebGLProgram(a,[r],r.dtype,l)},obe={kernelName:eme,backendName:"webgl",kernelFunc:d7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const abe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,lbe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+sh+`
  return result;
`,cbe=Ui({opSnippet:abe,packedOpSnippet:lbe}),ube={kernelName:D8,backendName:"webgl",kernelFunc:cbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hbe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{axis:s,keepDims:o}=i,a=r.shape.length,l=[],c=kr(s,r.shape);let u=c;const h=io(u,a);let d=r;h!=null&&(d=mr({inputs:{x:r},backend:n,attrs:{perm:h}}),u=ro(u.length,a),l.push(d)),Ho("prod",u,a);let p;if(n.shouldExecuteOnCPU([d])){const f=n.texData.get(d.dataId).values,{outVals:v,outShape:g,outDtype:m}=cxe(d.shape,d.dtype,f,u);p=n.makeTensorInfo(g,m,v)}else{const[f,v]=va(d.shape,u),g=Re(v),m=Ce({inputs:{x:d},backend:n,attrs:{shape:[-1,g]}}),y=NP(r.dtype),S=oh(m,y,"prod",n);p=Ce({inputs:{x:S},backend:n,attrs:{shape:f}}),l.push(m),l.push(S)}if(o){l.push(p);const f=il(p.shape,c);p=Ce({inputs:{x:p},backend:n,attrs:{shape:f}})}return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const dbe={kernelName:tme,backendName:"webgl",kernelFunc:hbe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pbe(t){const{inputs:e,backend:n,attrs:i}=t,{paramsNestedSplits:r,paramsDenseValues:s,indices:o}=e,{outputRaggedRank:a}=i,l=r.map(m=>n.readSync(m.dataId)),c=r.map(m=>m.shape),u=n.readSync(s.dataId),h=n.readSync(o.dataId),[d,p,f]=uxe(l,c,u,s.shape,s.dtype,h,o.shape,a),v=d.map(m=>n.makeTensorInfo([m.length],"int32",m)),g=n.makeTensorInfo(f,s.dtype,p);return v.concat([g])}const fbe={kernelName:nme,backendName:"webgl",kernelFunc:pbe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mbe(t){const{inputs:e,backend:n}=t,{starts:i,limits:r,deltas:s}=e,o=n.readSync(i.dataId),a=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=hxe(o,i.shape,i.dtype,a,r.shape,l,s.shape),h=n.makeTensorInfo([c.length],"int32",c),d=n.makeTensorInfo([u.length],i.dtype,u);return[h,d]}const gbe={kernelName:ime,backendName:"webgl",kernelFunc:mbe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(t){const{inputs:e,backend:n,attrs:i}=t,{shape:r,values:s,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=i,c=n.readSync(r.dataId),u=n.readSync(s.dataId),h=n.readSync(o.dataId),d=a.map(g=>n.readSync(g.dataId)),p=a.map(g=>g.shape),[f,v]=dxe(c,r.shape,u,s.shape,s.dtype,h,o.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,v)}const ybe={kernelName:rme,backendName:"webgl",kernelFunc:vbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7=t=>{const{backend:e,attrs:n}=t,{start:i,stop:r,step:s,dtype:o}=n,a=pxe(i,r,s,o);return e.makeTensorInfo([a.length],o,a)},Sbe={kernelName:sme,backendName:"webgl",kernelFunc:p7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xbe="return 1.0 / x;",Cbe=Gt({opSnippet:xbe}),_be={kernelName:ame,backendName:"webgl",kernelFunc:Cbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wbe=so+`
  return (x < 0.0) ? 0.0 : x;
`,Ebe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Rbe=Gt({opSnippet:wbe,packedOpSnippet:Ebe}),Tbe={kernelName:O8,backendName:"webgl",kernelFunc:Rbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bbe=so+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Abe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Pbe=Gt({opSnippet:bbe,packedOpSnippet:Abe}),Ibe={kernelName:z8,backendName:"webgl",kernelFunc:Pbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mbe{constructor(e,n,i,r,s){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,i,c];const u=[r&&n>1?a-1:a,r&&i>1?l-1:l],h=[r&&n>1?n-1:n,r&&i>1?i-1:i];let d;s?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kbe{constructor(e,n,i,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,i,c];const u=[r&&n>1?a-1:a,r&&i>1?l-1:l],h=[r&&n>1?n-1:n,r&&i>1?i-1:i];let d;s?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${i-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lbe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:s,halfPixelCenters:o,size:a}=i,[l,c]=a,u=Q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new kbe(r.shape,l,c,s,o):new Mbe(r.shape,l,c,s,o);return n.runWebGLProgram(u,[r],"float32")}const Dbe={kernelName:ume,backendName:"webgl",kernelFunc:Lbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nbe{constructor(e,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,s]=n,[,o,a]=e,l=[i&&o>1?r-1:r,i&&a>1?s-1:s],c=[i&&o>1?o-1:o,i&&a>1?a-1:a],u=l[0]/c[0],h=l[1]/c[1],d=1/u,p=1/h,f=Math.ceil(d)*2+2,v=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Obe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:s}=e,{alignCorners:o}=i,a=new Nbe(s.shape,r.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const Fbe={kernelName:hme,backendName:"webgl",kernelFunc:Obe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zbe{constructor(e,n,i,r,s){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,i,c];const u=[r&&n>1?a-1:a,r&&i>1?l-1:l],h=[r&&n>1?n-1:n,r&&i>1?i-1:i],d=r?"0.5":"0.0";let p;s?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ube{constructor(e,n,i,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,i,c];const u=[r&&n>1?a-1:a,r&&i>1?l-1:l],h=[r&&n>1?n-1:n,r&&i>1?i-1:i],d=r?"0.5":"0.0";let p;s?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${i-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bbe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r}=e,{alignCorners:s,halfPixelCenters:o,size:a}=i,[l,c]=a,u=Q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Ube(r.shape,l,c,s,o):new zbe(r.shape,l,c,s,o);return n.runWebGLProgram(u,[r],r.dtype)}const $be={kernelName:lme,backendName:"webgl",kernelFunc:Bbe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hbe{constructor(e,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,s]=n,[,o,a]=e,l=[i&&o>1?r-1:r,i&&a>1?s-1:s],c=[i&&o>1?o-1:o,i&&a>1?a-1:a],u=l[0]/c[0],h=l[1]/c[1],d=1/u,p=1/h,f=Math.ceil(d)*2+2,v=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${i} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${i} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vbe(t){const{inputs:e,backend:n,attrs:i}=t,{images:r,dy:s}=e,{alignCorners:o}=i,a=new Hbe(s.shape,r.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const jbe={kernelName:cme,backendName:"webgl",kernelFunc:Vbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wbe{constructor(e,n){this.variableNames=["x"];const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);if(this.outputShape=e,i===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,s=e.map((a,l)=>r(l)).join(","),o=hn(i);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gbe{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const i=e.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);this.outputShape=e;const r=dr("rc",i),s=`${r[i-1]} + 1 < ${this.outputShape[i-1]}`,o=`${r[i-2]} + 1 < ${this.outputShape[i-2]}`,a=hn(i);i===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${s}){
            result.g = ${c(r.slice())};
          }
          if(${o}) {
            result.b = ${u(r.slice())};
            if(${s}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(f){return d(f)}function c(f){return f[i-1]="("+f[i-1]+" + 1)",d(f)}function u(f){return f[i-2]="("+f[i-2]+" + 1)",d(f)}function h(f){return f[i-1]="("+f[i-1]+" + 1)",f[i-2]="("+f[i-2]+" + 1)",d(f)}function d(f){const v=e.map((y,S)=>p(S,f)),g=v.join(","),m=v.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${m}))`}function p(f,v){return n.indexOf(f)!==-1&&e[f]!==1?`${e[f]} - ${v[f]} - 1`:`${v[f]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qbe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{dims:s}=i,o=r.shape.length,a=kr(s,r.shape);if(o===0)return Xr({inputs:{x:r},backend:n});const l=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gbe(r.shape,a):new Wbe(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const Xbe={kernelName:dme,backendName:"webgl",kernelFunc:qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kbe{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const i=e[1],r=e[2];this.outputShape=e;let s="";typeof n=="number"?s=`float outputValue = ${n.toFixed(2)};`:s=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${i}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ybe={kernelName:Kme,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,{radians:r,fillValue:s,center:o}=e,a=n,l=new Kbe(i.shape,s),[c,u]=jH(o,i.shape[1],i.shape[2]),h=[[c,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[i],i.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jbe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Qbe=Gt({opSnippet:Jbe}),Zbe={kernelName:pme,backendName:"webgl",kernelFunc:Qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e2e="return inversesqrt(x);",t2e=Gt({opSnippet:e2e,cpuKernelImpl:fxe}),n2e={kernelName:fme,backendName:"webgl",kernelFunc:t2e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iI{constructor(e,n,i,r,s,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=hn(s.length),u=hn(o.length);let h="";i===1?h="i":i===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let v="";l&&(v="coords[0], coords[1]");const g=`getDefaultValue(${v})`,m=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i2e{constructor(e,n,i,r,s,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=hn(s.length),u=hn(o.length);let h="";i===1?h="i":i===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let v="";l&&(v="coords[0], coords[1]");const g=`getDefaultValue(${v})`,m=n>1?"strides[j]":"strides",y=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${m};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${f};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2e(t){const{inputs:e,backend:n,attrs:i}=t,{indices:r,updates:s}=e,{shape:o}=i,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=zC(s,r,o),d=[h/c,c];if(h===0)return n.makeTensorInfo(o,r.dtype);const p=Ce({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),f=Ce({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;Q().getBool("WEBGL_PACK")?g=new i2e(l,a,p.shape.length,f.shape.length,u,d):g=new iI(l,a,p.shape.length,f.shape.length,u,d);const m=n.runWebGLProgram(g,[f,p,v],f.dtype),y=Ce({inputs:{x:m},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),y}const s2e={kernelName:mme,backendName:"webgl",kernelFunc:r2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o2e{constructor(e,n,i,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,i];const s="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=Q().getNumber("WEBGL_VERSION")===2?s:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a2e(t){const{inputs:e,backend:n,attrs:i}=t,{sortedSequence:r,values:s}=e,{side:o}=i,a=new o2e(r.shape[0],r.shape[1],s.shape[1],o),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,s],"int32",l)}const l2e={kernelName:vme,backendName:"webgl",kernelFunc:a2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c2e{constructor(e,n,i){this.variableNames=["c","a","b"],this.outputShape=n;let r,s;if(i>4)throw Error(`Where for rank ${i} is not yet supported`);if(i===1)s="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<n.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);r=l.join(),s=c.join()}const o=hn(i);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u2e(t){const{inputs:e,backend:n}=t,{condition:i,t:r,e:s}=e,o=new c2e(i.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[i,r,s],ua(r.dtype,s.dtype))}const h2e={kernelName:yme,backendName:"webgl",kernelFunc:u2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d2e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${qH};
  float scale = ${XH};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,p2e=Gt({opSnippet:d2e}),f2e={kernelName:Sme,backendName:"webgl",kernelFunc:p2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m2e=kp+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,g2e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,v2e=Gt({opSnippet:m2e,packedOpSnippet:g2e,cpuKernelImpl:gxe}),y2e={kernelName:U8,backendName:"webgl",kernelFunc:v2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S2e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,x2e=Gt({opSnippet:S2e}),C2e={kernelName:wme,backendName:"webgl",kernelFunc:x2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _2e=kp+`
  return sin(x);
`,w2e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${sh}
  return result;
`,E2e=Gt({opSnippet:_2e,packedOpSnippet:w2e}),R2e={kernelName:Cme,backendName:"webgl",kernelFunc:E2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T2e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,b2e=Gt({opSnippet:T2e}),A2e={kernelName:_me,backendName:"webgl",kernelFunc:b2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P2e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,I2e=Gt({opSnippet:P2e}),M2e={kernelName:Eme,backendName:"webgl",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k2e=t=>{const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{blockShape:s,paddings:o}=i;we(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((m,y)=>m*y),l=[[0,0]];l.push(...o);for(let m=1+s.length;m<r.shape.length;++m)l.push([0,0]);const c=[],u=d7({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),h=GP(u.shape,s,a,!1),d=qP(h.length,s.length,!1),p=XP(u.shape,s,a,!1),f=Ce({inputs:{x:u},backend:n,attrs:{shape:h}}),v=mr({inputs:{x:f},backend:n,attrs:{perm:d}}),g=Ce({inputs:{x:v},backend:n,attrs:{shape:p}});return c.push(u),c.push(f),c.push(v),c.forEach(m=>n.disposeIntermediateTensorInfo(m)),g},L2e={kernelName:Rme,backendName:"webgl",kernelFunc:k2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D2e(t){const{inputs:e,backend:n}=t,{indices:i,values:r,denseShape:s,defaultValue:o}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${i.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(r.dataId),c=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[h,d,p,f,v]=yxe(a,i.shape,i.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([d[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(g=>Number(g)))),n.makeTensorInfo([v.length],i.dtype,new Int32Array(v))]}const N2e={kernelName:Ame,backendName:"webgl",kernelFunc:D2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O2e(t){const{inputs:e,backend:n}=t,{inputIndices:i,inputShape:r,newShape:s}=e;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(i.dataId),l=Array.from(n.readSync(s.dataId)),[c,u,h]=Sxe(a,i.shape,i.dtype,o,l);return[n.makeTensorInfo(u,i.dtype,c),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}const F2e={kernelName:Pme,backendName:"webgl",kernelFunc:O2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z2e(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:s}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);const o=n.readSync(i.dataId),a=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=FV(o,i.shape,i.dtype,a,l,!0);return n.makeTensorInfo(u,i.dtype,c)}const U2e={kernelName:Ime,backendName:"webgl",kernelFunc:z2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B2e(t){const{inputs:e,backend:n}=t,{data:i,indices:r,segmentIds:s}=e;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);const o=n.readSync(i.dataId),a=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=FV(o,i.shape,i.dtype,a,l);return n.makeTensorInfo(u,i.dtype,c)}const $2e={kernelName:Mme,backendName:"webgl",kernelFunc:B2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H2e(t){const{inputs:e,backend:n,attrs:i}=t,{sparseIndices:r,sparseValues:s,defaultValue:o}=e,{outputShape:a}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=zC(s,r,a),p=!1;if(s.dtype==="string"){const m=n.bufferSync(r),y=n.bufferSync(s),S=Kd(n.readSync(o.dataId)[0]),x=mxe(m,y,a,d,u,c,l,h,S,p);return n.makeTensorInfo(a,x.dtype,x.values)}const f=new iI(c,l,r.shape.length,s.shape.length,h,[d,1],p),v=n.runWebGLProgram(f,[s,r,o],s.dtype),g=Ce({inputs:{x:v},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(v),g}const V2e={kernelName:kme,backendName:"webgl",kernelFunc:H2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{numOrSizeSplits:s,axis:o}=i,a=kr(o,r.shape)[0],l=oV(r,s,a),c=r.shape.length,u=new Array(c).fill(0),h=r.shape.slice();return l.map(d=>{const p=[...h];p[a]=d;const f=Lp({inputs:{x:r},backend:n,attrs:{begin:u,size:p}});return u[a]+=d,f})}const W2e={kernelName:Tme,backendName:"webgl",kernelFunc:j2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O4="return sqrt(x);",G2e=Gt({opSnippet:O4,packedOpSnippet:O4,cpuKernelImpl:xxe}),q2e={kernelName:B8,backendName:"webgl",kernelFunc:G2e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X2e="return x * x;",K2e=Gt({opSnippet:X2e}),Y2e={kernelName:Dme,backendName:"webgl",kernelFunc:K2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F4="return (a - b) * (a - b);",J2e=Ui({opSnippet:F4,packedOpSnippet:F4}),Q2e={kernelName:Lme,backendName:"webgl",kernelFunc:J2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z2e(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const s=n.readSync(r.dataId),o=Qd(s),a=Cxe(o,"string",i);return n.makeTensorInfo(r.shape,"string",a)}const eAe={kernelName:Nme,backendName:"webgl",kernelFunc:Z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tAe({inputs:t,attrs:e,backend:n}){const{x:i}=t,r=so+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,s=new ia(i.shape,r);return n.runWebGLProgram(s,[i],i.dtype)}const nAe={kernelName:W8,backendName:"webgl",kernelFunc:tAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iAe{constructor(e,n,i){this.variableNames=["x"],this.outputShape=i;const r=i.length,s=hn(i.length),o=hn(i.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=i.map((c,u)=>(l++,i.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${e});
      ${s} strides = ${s}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rAe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{begin:s,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=i,{finalShapeSparse:p,finalShape:f,isIdentity:v,sliceDim0:g,isSimpleSlice:m,begin:y,end:S,strides:x}=zH(r.shape,s,o,a,l,c,u,h,d);let w;if(v)w=Ce({inputs:{x:r},backend:n,attrs:{shape:f}});else if(g||m){we(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const E=AH(y,S,x),T=Lp({inputs:{x:r},backend:n,attrs:{begin:y,size:E}});w=Ce({inputs:{x:T},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(T)}else if(n.shouldExecuteOnCPU([r])){const T=n.readSync(r.dataId),M=Oi(r.shape,r.dtype,T),_=_xe(p,M,x,y);w=n.makeTensorInfo(f,r.dtype,_.values)}else{const T=new iAe(y,x,p);w=n.runWebGLProgram(T,[r],r.dtype)}const C=Ce({inputs:{x:w},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(w),C}const sAe={kernelName:Ome,backendName:"webgl",kernelFunc:rAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oAe(t){const{inputs:e,backend:n,attrs:i}=t,{separator:r,nGramWidths:s,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:h}=e,d=n.readSync(u.dataId),p=n.readSync(h.dataId),[f,v]=wxe(d,p,r,s,o,a,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",v)]}const aAe={kernelName:Fme,backendName:"webgl",kernelFunc:oAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lAe(t){const{inputs:e,backend:n,attrs:i}=t,{skipEmpty:r}=i,{input:s,delimiter:o}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(o.dataId)[0],[c,u,h]=Exe(a,l,r),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const cAe={kernelName:zme,backendName:"webgl",kernelFunc:lAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uAe(t){const{inputs:e,backend:n,attrs:i}=t,{numBuckets:r}=i,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=Rxe(o,r);return n.makeTensorInfo(s.shape,"int32",a)}const hAe={kernelName:Ume,backendName:"webgl",kernelFunc:uAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dAe="return tan(x);",pAe=Gt({opSnippet:dAe}),fAe={kernelName:Bme,backendName:"webgl",kernelFunc:pAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mAe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,gAe=Gt({opSnippet:mAe}),vAe={kernelName:$me,backendName:"webgl",kernelFunc:gAe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yAe(t){const{inputs:e,backend:n,attrs:i}=t,{tensor:r,indices:s,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=zC(o,s,r.shape),d=[h/c,c];if(h===0)return n.makeTensorInfo(r.shape,s.dtype);const p=Ce({inputs:{x:s},backend:n,attrs:{shape:[l,a]}}),f=Ce({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),v=Ce({inputs:{x:r},backend:n,attrs:{shape:d}}),g=new iI(l,a,p.shape.length,f.shape.length,u,d,!1,!0),m=n.runWebGLProgram(g,[f,p,v],v.dtype),y=Ce({inputs:{x:m},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),y}const SAe={kernelName:gme,backendName:"webgl",kernelFunc:yAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xAe{constructor(e,n){this.variableNames=["A"];const i=new Array(e.length);for(let o=0;o<i.length;o++)i[o]=e[o]*n[o];this.outputShape=i,this.rank=i.length;const r=hn(this.rank),s=CAe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}function CAe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let r=0;r<t.length;r++)i.push(`imod(${n[r]}, ${t[r]})`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{reps:s}=i;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),c=r.dtype==="string"?l.map(d=>Kd(d)):l,u=Oi(r.shape,r.dtype,c),h=bxe(u,s);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new xAe(r.shape,s);return n.runWebGLProgram(o,[r],r.dtype)}const _Ae={kernelName:V8,backendName:"webgl",kernelFunc:f7};class wAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class EAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xc(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function z4(t){let e=1;for(;e<t;)e*=2;return e}function RAe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r}=e,{k:s,sorted:o}=i,a=Q().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Q().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([r])||u<a||s>l){const _=n.readSync(r.dataId),[R,L]=Axe(_,c,r.dtype,s,o);return[n.makeTensorInfo(R.shape,R.dtype,R.values),n.makeTensorInfo(L.shape,L.dtype,L.values)]}if(s===0)return c[c.length-1]=0,[n.makeTensorInfo(c,r.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(u===1)return[r,tv({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),d=h!==null&&h.isPacked,p=d?n.unpackTensor(r):r,v=Re(c)/u,g=Ce({inputs:{x:p},attrs:{shape:[v,u]},backend:n});d&&Xc(n,p);const m=z4(s),y=z4(u);let S=null;const x=()=>S===null?[g,g]:[g,S],w=(_,R,L)=>{const z=x(),G=new wAe(L),H=[[u],[S===null?1:0],[Number.NEGATIVE_INFINITY],[_],[R]],q=S;S=n.runWebGLProgram(G,z,"int32",H),Xc(n,q)};for(let _=1;_<m;_*=2){const R=_*2;for(let L=_;L>=1;L/=2)w(R,L,[v,y])}for(let _=y;_>m;_/=2){const R=x(),L=new EAe([v,_/2]),G=[[u],[S===null?1:0],[m]],$=S;S=n.runWebGLProgram(L,R,"int32",G),Xc(n,$);const H=m/2,q=H*2;for(let D=H;D>=1;D/=2)w(q,D,S.shape)}let C=S;S=Lp({inputs:{x:S},backend:n,attrs:{begin:0,size:[v,s]}}),Xc(n,C);let E=o7({inputs:{x:g,indices:S},backend:n,attrs:{axis:1,batchDims:1}});Xc(n,g);const T=c.slice(0,-1);T.push(s),C=S,S=Ce({inputs:{x:S},attrs:{shape:T},backend:n}),Xc(n,C);const M=E;return E=Ce({inputs:{x:E},attrs:{shape:T},backend:n}),Xc(n,M),[E,S]}const TAe={kernelName:Hme,backendName:"webgl",kernelFunc:RAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bAe{constructor(e,n,i,r,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=i==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AAe(t){const{inputs:e,backend:n,attrs:i}=t,{image:r,transforms:s}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=i,[u,h,d,p]=r.shape,[f,v]=c??[h,d],g=[u,f,v,p],m=new bAe(h,d,o,a,l,g);return n.runWebGLProgram(m,[r,s],"float32")}const PAe={kernelName:Vme,backendName:"webgl",kernelFunc:AAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IAe(t){const{inputs:e,attrs:n,backend:i}=t,{axis:r}=n,{x:s}=e;Q0(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=i.readSync(s.dataId),{outputValues:a,outputShape:l,indices:c}=Pxe(o,r,s.shape,s.dtype);return[i.makeTensorInfo(l,s.dtype,a),i.makeTensorInfo([c.length],"int32",c)]}const MAe={kernelName:Wme,backendName:"webgl",kernelFunc:IAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kAe(t){const{inputs:e,backend:n,attrs:i}=t,{value:r}=e;let{axis:s}=i;s<0&&(s+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[s],c=new Array(a-1);let u=0;for(let v=0;v<a;v++)v!==s&&(c[u++]=o.shape[v]);const h=[],d=new Array(a).fill(0),p=o.shape.slice();p[s]=1;const f=new Array(l);for(let v=0;v<f.length;v++){d[s]=v;const g=Lp({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),m=Ce({inputs:{x:g},backend:n,attrs:{shape:c}});f[v]=m,h.push(g)}return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),f}const LAe={kernelName:Gme,backendName:"webgl",kernelFunc:kAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DAe{constructor(e,n){this.variableNames=["x","segmentIds"];const i=e.windowSize,r=e.batchSize,s=e.inSize,o=e.numSegments,a=o*Math.ceil(s/i);this.outputShape=[r,a];const l="0.0",c="sumValue",u=Math.floor(i/4)*4,h=i%4,d=`
        sumValue += dot(values, segFilter);
    `;let p="";s%i>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let f="";s%i>0&&(f=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${f}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${i}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NAe(t){const{inputs:e,backend:n,attrs:i}=t,{x:r,segmentIds:s}=e,{numSegments:o}=i,a=r.shape.length,l=[];let c=0;const u=io([c],a);let h=r;u!=null&&(h=mr({inputs:{x:r},backend:n,attrs:{perm:u}}),l.push(h),c=ro(1,a)[0]);const d=SV(h.shape,c,o),p=Re([h.shape[c]]),f=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(f);const v=NP(r.dtype),g=(x,w,C,E,T)=>{const M=x.shape[0],_=x.shape[1],R=yV(_,T),L={windowSize:R,inSize:_,batchSize:M,numSegments:T},z=new DAe(L,w),G=n.compileAndRun(z,[x,C],E);if(l.push(G),G.shape[1]===T)return G;const $=p7({backend:n,attrs:{start:0,stop:T,step:1,dtype:"float32"}}),H=f7({inputs:{x:$},backend:n,attrs:{reps:[_/R]}});return l.push($),l.push(H),g(G,w,H,E,T)},m=g(f,"unsortedSegmentSum",s,v,o),y=Ce({inputs:{x:m},backend:n,attrs:{shape:d}});let S=y;if(u!=null){l.push(y);const x=BP(u);S=mr({inputs:{x:S},backend:n,attrs:{perm:x}})}return l.forEach(x=>n.disposeIntermediateTensorInfo(x)),S}const OAe={kernelName:qme,backendName:"webgl",kernelFunc:NAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FAe=[xCe,_Ce,RCe,ACe,ICe,LCe,NCe,FCe,$Ce,VCe,GCe,KCe,QCe,n_e,s_e,a_e,c_e,p_e,m_e,v_e,C_e,A_e,I_e,D_e,O_e,H_e,j_e,X_e,iCe,J_e,nwe,owe,dwe,mwe,vwe,Swe,Cwe,Rwe,Awe,Mwe,Lwe,Nwe,Fwe,Bwe,Hwe,Gwe,Xwe,Jwe,eEe,nEe,oEe,uEe,fEe,vEe,xEe,CEe,wEe,REe,bEe,PEe,MEe,NEe,zEe,$Ee,VEe,GEe,KEe,ZEe,iRe,nCe,sRe,ewe,lRe,hRe,fRe,sCe,yRe,_Re,ERe,ARe,MRe,NRe,zRe,HRe,GRe,KRe,JRe,tTe,iTe,sTe,cTe,hTe,pTe,mTe,vTe,CTe,RTe,PTe,FTe,lCe,$Te,jTe,qTe,YTe,z_e,ZTe,tbe,ibe,obe,ube,aCe,dbe,fbe,gbe,ybe,Sbe,U_e,LTe,_be,Tbe,Ibe,uCe,Dbe,Fbe,$be,jbe,Xbe,Ybe,Zbe,n2e,s2e,l2e,h2e,f2e,y2e,C2e,R2e,A2e,T_e,NTe,M2e,L2e,N2e,F2e,U2e,$2e,V2e,W2e,q2e,Y2e,Q2e,eAe,nAe,sAe,aAe,cAe,hAe,DTe,vCe,fAe,vAe,SAe,_Ae,TAe,PAe,yCe,MAe,LAe,OAe,ebe];for(const t of FAe)tge(t);const zAe=[{key:"hermione.mp4",name:"Hermione",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/hermione.gif",description:"It’s Leviosa, Not Leviosaaa!"},{key:"natasha_tony.mp4",name:"Natasha",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/natasha.gif",description:"Need your impression, i mean fingerprint"},{key:"peterparker.mp4",name:"Peter Parker",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/peterparker.gif",description:"Spider-Man awakens"},{key:"peterparker2.mp4",name:"Peter Parker II",thumbnail:"https://cdn.zzcreation.com/test_comfy/video_templates/peterparker2.gif",description:"Trying to be a hero"}],UAe=["male","female","any"],BAe=()=>{const t=he.useRef(null),e=he.useRef(null),[n,i]=he.useState(!1),[r,s]=he.useState(!1),[o,a]=he.useState(null),[l,c]=he.useState(!1),u=he.useRef(null),h=he.useRef(-1),[d,p]=he.useState(null),[f,v]=he.useState("idle"),[g,m]=he.useState(null),[y,S]=he.useState(0),x=he.useRef(),[w,C]=he.useState(null),[E,T]=he.useState("any");he.useEffect(()=>(Mge("webgl"),n&&(async()=>{if(!t.current)return;const H=await Qc.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm");u.current=await cs.createFromOptions(H,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_detector/blaze_face_short_range/float16/1/blaze_face_short_range.tflite",delegate:"GPU"},runningMode:"VIDEO"});const q=async()=>{if(!(!t.current||!e.current||!u.current)){if(t.current.currentTime!==h.current){h.current=t.current.currentTime;const D=performance.now(),Z=u.current.detectForVideo(t.current,D),P=e.current.getContext("2d");if(!P)return;P.clearRect(0,0,e.current.width,e.current.height),P.drawImage(t.current,0,0,e.current.width,e.current.height),s(Z.detections.length>0),Z.detections.forEach(le=>{const{boundingBox:Se,keypoints:k}=le;Se&&(P.strokeStyle="#00ff00",P.lineWidth=2,P.strokeRect(Se.originX,Se.originY,Se.width,Se.height),k&&k.forEach(J=>{P.beginPath(),P.arc(J.x*e.current.width,J.y*e.current.height,3,0,2*Math.PI),P.fillStyle="#ff0000",P.fill()}))})}requestAnimationFrame(q)}};try{const D=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480},audio:!1});t.current.srcObject=D,await t.current.play(),q()}catch(D){console.error("Error accessing camera:",D)}})(),()=>{var H;(H=t.current)!=null&&H.srcObject&&t.current.srcObject.getTracks().forEach(D=>D.stop())}),[n]),he.useEffect(()=>(f==="processing"?(S(0),x.current=setInterval(()=>{S($=>$+1)},1e3)):x.current&&clearInterval(x.current),()=>{x.current&&clearInterval(x.current)}),[f]);const M=()=>{i(!0),a(null)},_=()=>{i(!1)},R=()=>{if(!e.current||!t.current||!r)return;const $=document.createElement("canvas");$.width=e.current.width,$.height=e.current.height;const H=$.getContext("2d");if(!H)return;H.drawImage(t.current,0,0,$.width,$.height);const q=$.toDataURL("image/jpeg");a(q),_()},L=async $=>{try{const q=await(await fetch(`https://app.zzcreation.com/mini/comfy_task_status?task_id=${$}`)).json();q.status==="processing"?(v("processing"),setTimeout(()=>L($),2e3)):q.status==="completed"&&q.video_url&&(v("completed"),m(q.video_url))}catch(H){console.error("Error checking task status:",H)}},z=async()=>{if(!(!o||!w))try{c(!0);const H=await(await fetch(o)).blob(),q=new FormData;q.append("image",H,"selfie.jpg"),q.append("videoFile",w.key),q.append("genderToSwap",E);const D=await fetch("https://api.zzcreation.com/web/face_swap_task",{method:"POST",body:q,headers:{"x-api-key":"0f4404a5f9f56"}});if(!D.ok)throw new Error("Upload failed");alert("Image uploaded successfully!");const Z=await D.json();Z.success&&Z.taskId&&(p(Z.taskId),v("processing"),L(Z.taskId))}catch($){console.error("Upload error:",$),alert("Failed to upload image")}finally{c(!1)}},G=$=>{const H=Math.floor($/60),q=$%60;return`${H.toString().padStart(2,"0")}:${q.toString().padStart(2,"0")}`};return ze.jsxs("div",{className:"flex flex-col items-center p-4 max-w-2xl mx-auto",children:[ze.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Face Swapper"}),ze.jsx("div",{className:"relative w-full aspect-video bg-gray-100 rounded-lg overflow-hidden",children:n?ze.jsxs(ze.Fragment,{children:[ze.jsx("video",{ref:t,className:"absolute top-0 left-0 w-full h-full object-cover",autoPlay:!0,playsInline:!0}),ze.jsx("canvas",{ref:e,className:"absolute top-0 left-0 w-full h-full object-cover",width:640,height:480}),ze.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center",children:ze.jsx("button",{onClick:R,disabled:!r,className:`px-4 py-2 rounded-full ${r?"bg-green-500 hover:bg-green-600":"bg-gray-400"} text-white transition-colors`,children:r?"照相 📷":"未检测到人脸"})})]}):o?ze.jsx("img",{src:o,alt:"Captured selfie",className:"w-full h-full object-cover"}):ze.jsx("div",{className:"flex items-center justify-center h-full",children:ze.jsx("button",{onClick:M,className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"1.自拍一张"})})}),f==="processing"&&ze.jsxs("div",{className:"mt-4 text-center",children:[ze.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"}),ze.jsxs("p",{children:["正在生成... (Task ID: ",d,")"]}),ze.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["已用时: ",G(y)]})]}),f==="completed"&&g&&ze.jsxs("div",{className:"mt-4",children:[ze.jsx("h2",{className:"text-xl font-bold mb-2",children:"Result"}),ze.jsx("video",{controls:!0,autoPlay:!0,loop:!0,className:"w-full rounded-lg",src:g})]}),o&&ze.jsxs("div",{className:"mt-4 space-x-4",children:[ze.jsx("button",{onClick:M,disabled:f==="processing",className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:bg-gray-300",children:"重拍"}),ze.jsx("button",{onClick:z,disabled:l||f==="processing"||!w,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:bg-blue-300",children:l?"生成中...":"3. 生成！"})]}),!w&&o&&ze.jsx("p",{className:"mt-2 text-red-500",children:"请先选择一个模板视频后，再生成"}),ze.jsxs("div",{className:"w-full mb-6",children:[ze.jsx("h2",{className:"text-xl font-semibold mb-2",children:"2. 选择一个模板"}),ze.jsx("div",{className:"flex overflow-x-auto gap-4 pb-4 hide-scrollbar",children:zAe.map($=>ze.jsxs("div",{onClick:()=>C($),className:`flex-shrink-0 w-64 cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${(w==null?void 0:w.key)===$.key?"border-blue-500 scale-105":"border-gray-200 hover:border-blue-300"}`,children:[ze.jsx("img",{src:$.thumbnail,alt:$.name,className:"w-full aspect-video object-cover"}),ze.jsxs("div",{className:"p-2",children:[ze.jsx("h3",{className:"font-medium",children:$.name}),ze.jsx("p",{className:"text-sm text-gray-500",children:$.description})]})]},$.key))})]}),ze.jsxs("div",{className:"w-full mb-6",children:[ze.jsx("h2",{className:"text-xl font-semibold mb-2",children:"替换的性别 Target Gender"}),ze.jsx("div",{className:"flex gap-4",children:UAe.map($=>ze.jsx("button",{onClick:()=>T($),className:`px-4 py-2 rounded-lg capitalize ${E===$?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:$},$))})]})]})},$Ae=vhe([{path:"/",element:ze.jsx(tue,{})},{path:"/playground",element:ze.jsx(BAe,{})}],{basename:"/m2-avatar-web/"});Jz(document.getElementById("root")).render(ze.jsx(he.StrictMode,{children:ze.jsx(The,{router:$Ae})}));
